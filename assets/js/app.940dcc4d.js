(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[]]);!function(n){function e(e){for(var a,s,o=e[0],l=e[1],c=e[2],u=0,m=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&m.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(n[a]=l[a]);for(d&&d(e);m.length;)m.shift()();return i.push.apply(i,c||[]),t()}function t(){for(var n,e=0;e<i.length;e++){for(var t=i[e],a=!0,o=1;o<t.length;o++){var l=t[o];0!==r[l]&&(a=!1)}a&&(i.splice(e--,1),n=s(s.s=t[0]))}return n}var a={},r={1:0},i=[];function s(e){if(a[e])return a[e].exports;var t=a[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(n){var e=[],t=r[n];if(0!==t)if(t)e.push(t[2]);else{var a=new Promise((function(e,a){t=r[n]=[e,a]}));e.push(t[2]=a);var i,o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=function(n){return s.p+"assets/js/"+({}[n]||n)+"."+{2:"4e32ee2e",3:"0ff5540c",4:"2e9ed9f0",5:"c51a9698",6:"4476abbb",7:"4487a643",8:"647c82b0",9:"f6be5cfa",10:"02c02386",11:"42a18bcf",12:"2b118160",13:"7814d084",14:"c08a0650",15:"e459c644",16:"4ee1eedd",17:"3bc0bf3e",18:"611b1264",19:"ba1a9989",20:"a55eed2e",21:"57330fd8",22:"0922cbfd",23:"13a05379",24:"7d43a075",25:"c2664c97",26:"18958123",27:"4e5f228c",28:"ff033a27",29:"b0a7b26f",30:"10572f0d",31:"75cb518d",32:"e3a9db0e",33:"5b72c19e",34:"424e5a82",35:"d9199101",36:"ad2c6744",37:"54458e3e",38:"0f76b68b",39:"8852ef4d",40:"41b2d3b5",41:"e6505511",42:"5f60dcaa",43:"a4cf9e44",44:"85352ba6",45:"2ab14b1f",46:"dbeea3df",47:"9990e130",48:"396dc47c",49:"669653b3",50:"051126eb",51:"fba95844",52:"8fecc3be",53:"0500141f",54:"1ee7ed0e",55:"81de2ae5",56:"1e304dba",57:"344cf3d2",58:"be416770",59:"454997ef",60:"6bcdcdd0",61:"69b76c5b",62:"3e9b0d05",63:"cea50d68",64:"dfc202b7",65:"dc95297f",66:"f971662e",67:"038a8a89",68:"afd446d7",69:"5164d8c8",70:"1472a602",71:"3511b41c",72:"41f8e9cb",73:"fe9208d3",74:"a1f606bb",75:"0dce22cf",76:"f02d488e",77:"c113d954",78:"7750882b",79:"36a315ff",80:"ac2eb2f3"}[n]+".js"}(n);var l=new Error;i=function(e){o.onerror=o.onload=null,clearTimeout(c);var t=r[n];if(0!==t){if(t){var a=e&&("load"===e.type?"missing":e.type),i=e&&e.target&&e.target.src;l.message="Loading chunk "+n+" failed.\n("+a+": "+i+")",l.name="ChunkLoadError",l.type=a,l.request=i,t[1](l)}r[n]=void 0}};var c=setTimeout((function(){i({type:"timeout",target:o})}),12e4);o.onerror=o.onload=i,document.head.appendChild(o)}return Promise.all(e)},s.m=n,s.c=a,s.d=function(n,e,t){s.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},s.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},s.t=function(n,e){if(1&e&&(n=s(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var a in n)s.d(t,a,function(e){return n[e]}.bind(null,a));return t},s.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return s.d(e,"a",e),e},s.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},s.p="/db-tutorial/",s.oe=function(n){throw console.error(n),n};var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var d=l;i.push([244,0]),t()}([function(n,e){var t=function(n){return n&&n.Math==Math&&n};n.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||function(){return this}()||Function("return this")()},function(n,e,t){var a=t(0),r=t(40).f,i=t(29),s=t(15),o=t(120),l=t(124),c=t(112);n.exports=function(n,e){var t,d,u,m,p,h=n.target,g=n.global,f=n.stat;if(t=g?a:f?a[h]||o(h,{}):(a[h]||{}).prototype)for(d in e){if(m=e[d],u=n.dontCallGetSet?(p=r(t,d))&&p.value:t[d],!c(g?d:h+(f?".":"#")+d,n.forced)&&void 0!==u){if(typeof m==typeof u)continue;l(m,u)}(n.sham||u&&u.sham)&&i(m,"sham",!0),s(t,d,m,n)}}},function(n,e){n.exports=function(n){try{return!!n()}catch(n){return!0}}},function(n,e,t){var a=t(68),r=Function.prototype,i=r.bind,s=r.call,o=a&&i.bind(s,s);n.exports=a?function(n){return n&&o(n)}:function(n){return n&&function(){return s.apply(n,arguments)}}},function(n,e){n.exports=function(n){return"function"==typeof n}},function(n,e,t){var a=t(127),r=t(15),i=t(272);a||r(Object.prototype,"toString",i,{unsafe:!0})},function(n,e,t){var a=t(0),r=t(54),i=t(9),s=t(89),o=t(55),l=t(162),c=r("wks"),d=a.Symbol,u=d&&d.for,m=l?d:d&&d.withoutSetter||s;n.exports=function(n){if(!i(c,n)||!o&&"string"!=typeof c[n]){var e="Symbol."+n;o&&i(d,n)?c[n]=d[n]:c[n]=l&&u?u(e):m(e)}return c[n]}},function(n,e,t){var a=t(68),r=Function.prototype.call;n.exports=a?r.bind(r):function(){return r.apply(r,arguments)}},function(n,e,t){var a=t(2);n.exports=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(n,e,t){var a=t(3),r=t(16),i=a({}.hasOwnProperty);n.exports=Object.hasOwn||function(n,e){return i(r(n),e)}},function(n,e,t){var a=t(0),r=t(11),i=a.String,s=a.TypeError;n.exports=function(n){if(r(n))return n;throw s(i(n)+" is not an object")}},function(n,e,t){var a=t(4);n.exports=function(n){return"object"==typeof n?null!==n:a(n)}},function(n,e,t){var a=t(0),r=t(86),i=a.String;n.exports=function(n){if("Symbol"===r(n))throw TypeError("Cannot convert a Symbol value to a string");return i(n)}},function(n,e,t){var a=t(0),r=t(8),i=t(164),s=t(163),o=t(10),l=t(91),c=a.TypeError,d=Object.defineProperty,u=Object.getOwnPropertyDescriptor;e.f=r?s?function(n,e,t){if(o(n),e=l(e),o(t),"function"==typeof n&&"prototype"===e&&"value"in t&&"writable"in t&&!t.writable){var a=u(n,e);a&&a.writable&&(n[e]=t.value,t={configurable:"configurable"in t?t.configurable:a.configurable,enumerable:"enumerable"in t?t.enumerable:a.enumerable,writable:!1})}return d(n,e,t)}:d:function(n,e,t){if(o(n),e=l(e),o(t),i)try{return d(n,e,t)}catch(n){}if("get"in t||"set"in t)throw c("Accessors not supported");return"value"in t&&(n[e]=t.value),n}},function(n,e,t){var a=t(0),r=t(4),i=function(n){return r(n)?n:void 0};n.exports=function(n,e){return arguments.length<2?i(a[n]):a[n]&&a[n][e]}},function(n,e,t){var a=t(4),r=t(29),i=t(169),s=t(120);n.exports=function(n,e,t,o){o||(o={});var l=o.enumerable,c=void 0!==o.name?o.name:e;return a(t)&&i(t,c,o),o.global?l?n[e]=t:s(e,t):(o.unsafe?n[e]&&(l=!0):delete n[e],l?n[e]=t:r(n,e,t)),n}},function(n,e,t){var a=t(0),r=t(18),i=a.Object;n.exports=function(n){return i(r(n))}},function(n,e){n.exports=!1},function(n,e,t){var a=t(0).TypeError;n.exports=function(n){if(null==n)throw a("Can't call method on "+n);return n}},function(n,e,t){"use strict";var a=t(1),r=t(102);a({target:"RegExp",proto:!0,forced:/./.exec!==r},{exec:r})},function(n,e,t){var a=t(57);n.exports=function(n){return a(n.length)}},function(n,e,t){var a=t(67),r=t(18);n.exports=function(n){return a(r(n))}},function(n,e,t){"use strict";var a=t(185).charAt,r=t(12),i=t(39),s=t(168),o=i.set,l=i.getterFor("String Iterator");s(String,"String",(function(n){o(this,{type:"String Iterator",string:r(n),index:0})}),(function(){var n,e=l(this),t=e.string,r=e.index;return r>=t.length?{value:void 0,done:!0}:(n=a(t,r),e.index+=n.length,{value:n,done:!1})}))},function(n,e,t){var a=t(15),r=t(281),i=Error.prototype;i.toString!==r&&a(i,"toString",r)},function(n,e,t){var a=t(0),r=t(4),i=t(70),s=a.TypeError;n.exports=function(n){if(r(n))return n;throw s(i(n)+" is not a function")}},function(n,e,t){var a=t(0),r=t(186),i=t(187),s=t(151),o=t(29),l=t(6),c=l("iterator"),d=l("toStringTag"),u=s.values,m=function(n,e){if(n){if(n[c]!==u)try{o(n,c,u)}catch(e){n[c]=u}if(n[d]||o(n,d,e),r[e])for(var t in s)if(n[t]!==s[t])try{o(n,t,s[t])}catch(e){n[t]=s[t]}}};for(var p in r)m(a[p]&&a[p].prototype,p);m(i,"DOMTokenList")},function(n,e,t){"use strict";var a=t(1),r=t(189);a({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},function(n,e,t){var a=t(0),r=t(186),i=t(187),s=t(189),o=t(29),l=function(n){if(n&&n.forEach!==s)try{o(n,"forEach",s)}catch(e){n.forEach=s}};for(var c in r)r[c]&&l(a[c]&&a[c].prototype);l(i)},function(n,e,t){var a=t(3),r=a({}.toString),i=a("".slice);n.exports=function(n){return i(r(n),8,-1)}},function(n,e,t){var a=t(8),r=t(13),i=t(51);n.exports=a?function(n,e,t){return r.f(n,e,i(1,t))}:function(n,e,t){return n[e]=t,n}},function(n,e){var t=Array.isArray;n.exports=t},function(n,e,t){var a=t(14);n.exports=a("navigator","userAgent")||""},function(n,e,t){var a=t(196),r="object"==typeof self&&self&&self.Object===Object&&self,i=a||r||Function("return this")();n.exports=i},function(n,e,t){"use strict";function a(n,e,t,a,r,i,s,o){var l,c="function"==typeof n?n.options:n;if(e&&(c.render=e,c.staticRenderFns=t,c._compiled=!0),a&&(c.functional=!0),i&&(c._scopeId="data-v-"+i),s?(l=function(n){(n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(n=__VUE_SSR_CONTEXT__),r&&r.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(s)},c._ssrRegister=l):r&&(l=o?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),l)if(c.functional){c._injectStyles=l;var d=c.render;c.render=function(n,e){return l.call(e),d(n,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,l):[l]}return{exports:n,options:c}}t.d(e,"a",(function(){return a}))},function(n,e,t){"use strict";var a=t(1),r=t(63).filter;a({target:"Array",proto:!0,forced:!t(79)("filter")},{filter:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){var a,r=t(10),i=t(152),s=t(122),o=t(71),l=t(167),c=t(90),d=t(94),u=d("IE_PROTO"),m=function(){},p=function(n){return"<script>"+n+"<\/script>"},h=function(n){n.write(p("")),n.close();var e=n.parentWindow.Object;return n=null,e},g=function(){try{a=new ActiveXObject("htmlfile")}catch(n){}var n,e;g="undefined"!=typeof document?document.domain&&a?h(a):((e=c("iframe")).style.display="none",l.appendChild(e),e.src=String("javascript:"),(n=e.contentWindow.document).open(),n.write(p("document.F=Object")),n.close(),n.F):h(a);for(var t=s.length;t--;)delete g.prototype[s[t]];return g()};o[u]=!0,n.exports=Object.create||function(n,e){var t;return null!==n?(m.prototype=r(n),t=new m,m.prototype=null,t[u]=n):t=g(),void 0===e?t:i.f(t,e)}},function(n,e,t){var a=t(3);n.exports=a({}.isPrototypeOf)},function(n,e,t){var a=t(13).f,r=t(9),i=t(6)("toStringTag");n.exports=function(n,e,t){n&&!t&&(n=n.prototype),n&&!r(n,i)&&a(n,i,{configurable:!0,value:e})}},function(n,e,t){var a=t(1),r=t(0),i=t(41),s=t(277),o=r.WebAssembly,l=7!==Error("e",{cause:7}).cause,c=function(n,e){var t={};t[n]=s(n,e,l),a({global:!0,constructor:!0,arity:1,forced:l},t)},d=function(n,e){if(o&&o[n]){var t={};t[n]=s("WebAssembly."+n,e,l),a({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:l},t)}};c("Error",(function(n){return function(e){return i(n,this,arguments)}})),c("EvalError",(function(n){return function(e){return i(n,this,arguments)}})),c("RangeError",(function(n){return function(e){return i(n,this,arguments)}})),c("ReferenceError",(function(n){return function(e){return i(n,this,arguments)}})),c("SyntaxError",(function(n){return function(e){return i(n,this,arguments)}})),c("TypeError",(function(n){return function(e){return i(n,this,arguments)}})),c("URIError",(function(n){return function(e){return i(n,this,arguments)}})),d("CompileError",(function(n){return function(e){return i(n,this,arguments)}})),d("LinkError",(function(n){return function(e){return i(n,this,arguments)}})),d("RuntimeError",(function(n){return function(e){return i(n,this,arguments)}}))},function(n,e,t){var a,r,i,s=t(247),o=t(0),l=t(3),c=t(11),d=t(29),u=t(9),m=t(119),p=t(94),h=t(71),g=o.TypeError,f=o.WeakMap;if(s||m.state){var b=m.state||(m.state=new f),y=l(b.get),v=l(b.has),_=l(b.set);a=function(n,e){if(v(b,n))throw new g("Object already initialized");return e.facade=n,_(b,n,e),e},r=function(n){return y(b,n)||{}},i=function(n){return v(b,n)}}else{var x=p("state");h[x]=!0,a=function(n,e){if(u(n,x))throw new g("Object already initialized");return e.facade=n,d(n,x,e),e},r=function(n){return u(n,x)?n[x]:{}},i=function(n){return u(n,x)}}n.exports={set:a,get:r,has:i,enforce:function(n){return i(n)?r(n):a(n,{})},getterFor:function(n){return function(e){var t;if(!c(e)||(t=r(e)).type!==n)throw g("Incompatible receiver, "+n+" required");return t}}}},function(n,e,t){var a=t(8),r=t(7),i=t(123),s=t(51),o=t(21),l=t(91),c=t(9),d=t(164),u=Object.getOwnPropertyDescriptor;e.f=a?u:function(n,e){if(n=o(n),e=l(e),d)try{return u(n,e)}catch(n){}if(c(n,e))return s(!r(i.f,n,e),n[e])}},function(n,e,t){var a=t(68),r=Function.prototype,i=r.apply,s=r.call;n.exports="object"==typeof Reflect&&Reflect.apply||(a?s.bind(i):function(){return s.apply(i,arguments)})},function(n,e,t){var a=t(311),r=t(314);n.exports=function(n,e){var t=r(n,e);return a(t)?t:void 0}},function(n,e,t){"use strict";var a=t(1),r=t(0),i=t(52),s=t(98),o=t(11),l=t(93),c=t(20),d=t(21),u=t(59),m=t(6),p=t(79),h=t(75),g=p("slice"),f=m("species"),b=r.Array,y=Math.max;a({target:"Array",proto:!0,forced:!g},{slice:function(n,e){var t,a,r,m=d(this),p=c(m),g=l(n,p),v=l(void 0===e?p:e,p);if(i(m)&&(t=m.constructor,(s(t)&&(t===b||i(t.prototype))||o(t)&&null===(t=t[f]))&&(t=void 0),t===b||void 0===t))return h(m,g,v);for(a=new(void 0===t?b:t)(y(v-g,0)),r=0;g<v;g++,r++)g in m&&u(a,r,m[g]);return a.length=r,a}})},function(n,e,t){t(387),t(388)},function(n,e,t){"use strict";t.d(e,"e",(function(){return a})),t.d(e,"b",(function(){return i})),t.d(e,"j",(function(){return s})),t.d(e,"g",(function(){return l})),t.d(e,"h",(function(){return c})),t.d(e,"i",(function(){return d})),t.d(e,"c",(function(){return u})),t.d(e,"f",(function(){return m})),t.d(e,"l",(function(){return p})),t.d(e,"m",(function(){return h})),t.d(e,"d",(function(){return f})),t.d(e,"k",(function(){return b})),t.d(e,"n",(function(){return y})),t.d(e,"a",(function(){return _}));t(19),t(47),t(148),t(85),t(146),t(118),t(46),t(26),t(5),t(27),t(34),t(88),t(84),t(161),t(83),t(217),t(23),t(150);var a=/#.*$/,r=/\.(md|html)$/,i=/\/$/,s=/^[a-z]+:/i;function o(n){return decodeURI(n).replace(a,"").replace(r,"")}function l(n){return s.test(n)}function c(n){return/^mailto:/.test(n)}function d(n){return/^tel:/.test(n)}function u(n){if(l(n))return n;if(!n)return"404";var e=n.match(a),t=e?e[0]:"",r=o(n);return i.test(r)?n:r+".html"+t}function m(n,e){var t=n.hash,r=function(n){var e=n&&n.match(a);if(e)return e[0]}(e);return(!r||t===r)&&o(n.path)===o(e)}function p(n,e,t){if(l(e))return{type:"external",path:e};t&&(e=function(n,e,t){var a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;var r=e.split("/");t&&r[r.length-1]||r.pop();for(var i=n.replace(/^\//,"").split("/"),s=0;s<i.length;s++){var o=i[s];".."===o?r.pop():"."!==o&&r.push(o)}""!==r[0]&&r.unshift("");return r.join("/")}(e,t));for(var a=o(e),r=0;r<n.length;r++)if(o(n[r].regularPath)===a)return Object.assign({},n[r],{type:"page",path:u(n[r].path)});return console.error('[vuepress] No matching page found for sidebar item "'.concat(e,'"')),{}}function h(n,e,t,a){var r=t.pages,i=t.themeConfig,s=a&&i.locales&&i.locales[a]||i;if("auto"===(n.frontmatter.sidebar||s.sidebar||i.sidebar))return g(n);var o=s.sidebar||i.sidebar;if(o){var l=function(n,e){if(Array.isArray(e))return{base:"/",config:e};for(var t in e)if(0===(a=n,/(\.html|\/)$/.test(a)?a:a+"/").indexOf(encodeURI(t)))return{base:t,config:e[t]};var a;return{}}(e,o),c=l.base,d=l.config;return"auto"===d?g(n):d?d.map((function(n){return function n(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if("string"==typeof e)return p(t,e,a);if(Array.isArray(e))return Object.assign(p(t,e[0],a),{title:e[1]});r>3&&console.error("[vuepress] detected a too deep nested sidebar group.");var i=e.children||[];return 0===i.length&&e.path?Object.assign(p(t,e.path,a),{title:e.title}):{type:"group",path:e.path,title:e.title,sidebarDepth:e.sidebarDepth,initialOpenGroupIndex:e.initialOpenGroupIndex,children:i.map((function(e){return n(e,t,a,r+1)})),collapsable:!1!==e.collapsable}}(n,r,c)})):[]}return[]}function g(n){var e=f(n.headers||[]);return[{type:"group",collapsable:!1,title:n.title,path:null,children:e.map((function(e){return{type:"auto",title:e.title,basePath:n.path,path:n.path+"#"+e.slug,children:e.children||[]}}))}]}function f(n){var e;return(n=n.map((function(n){return Object.assign({},n)}))).forEach((function(n){2===n.level?e=n:e&&(e.children||(e.children=[])).push(n)})),n.filter((function(n){return 2===n.level}))}function b(n){return Object.assign(n,{type:n.items&&n.items.length?"links":"link"})}function y(n){return Object.prototype.toString.call(n).match(/\[object (.*?)\]/)[1].toLowerCase()}function v(n){var e=n.frontmatter.date||n.lastUpdated||new Date,t=new Date(e);return"Invalid Date"==t&&e&&(t=new Date(e.replace(/-/g,"/"))),t.getTime()}function _(n,e){return v(e)-v(n)}},function(n,e,t){"use strict";var a=t(1),r=t(63).map;a({target:"Array",proto:!0,forced:!t(79)("map")},{map:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var a=t(41),r=t(7),i=t(3),s=t(116),o=t(2),l=t(10),c=t(4),d=t(48),u=t(57),m=t(12),p=t(18),h=t(134),g=t(50),f=t(292),b=t(117),y=t(6)("replace"),v=Math.max,_=Math.min,x=i([].concat),E=i([].push),T=i("".indexOf),I=i("".slice),k="$0"==="a".replace(/./,"$0"),S=!!/./[y]&&""===/./[y]("a","$0");s("replace",(function(n,e,t){var i=S?"$":"$0";return[function(n,t){var a=p(this),i=null==n?void 0:g(n,y);return i?r(i,n,a,t):r(e,m(a),n,t)},function(n,r){var s=l(this),o=m(n);if("string"==typeof r&&-1===T(r,i)&&-1===T(r,"$<")){var p=t(e,s,o,r);if(p.done)return p.value}var g=c(r);g||(r=m(r));var y=s.global;if(y){var k=s.unicode;s.lastIndex=0}for(var S=[];;){var q=b(s,o);if(null===q)break;if(E(S,q),!y)break;""===m(q[0])&&(s.lastIndex=h(o,u(s.lastIndex),k))}for(var w,R="",A=0,z=0;z<S.length;z++){for(var L=m((q=S[z])[0]),M=v(_(d(q.index),o.length),0),D=[],B=1;B<q.length;B++)E(D,void 0===(w=q[B])?w:String(w));var O=q.groups;if(g){var C=x([L],D,M,o);void 0!==O&&E(C,O);var N=m(a(r,void 0,C))}else N=f(L,o,M,D,O,r);M>=A&&(R+=I(o,A,M)+N,A=M+L.length)}return R+I(o,A)}]}),!!o((function(){var n=/./;return n.exec=function(){var n=[];return n.groups={a:"7"},n},"7"!=="".replace(n,"$<a>")}))||!k||S)},function(n,e,t){var a=t(246);n.exports=function(n){var e=+n;return e!=e||0===e?0:a(e)}},function(n,e,t){"use strict";var a=t(2);n.exports=function(n,e){var t=[][n];return!!t&&a((function(){t.call(null,e||function(){return 1},1)}))}},function(n,e,t){var a=t(24);n.exports=function(n,e){var t=n[e];return null==t?void 0:a(t)}},function(n,e){n.exports=function(n,e){return{enumerable:!(1&n),configurable:!(2&n),writable:!(4&n),value:e}}},function(n,e,t){var a=t(28);n.exports=Array.isArray||function(n){return"Array"==a(n)}},function(n,e){n.exports=function(n){return null!=n&&"object"==typeof n}},function(n,e,t){var a=t(17),r=t(119);(n.exports=function(n,e){return r[n]||(r[n]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.7",mode:a?"pure":"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.7/LICENSE",source:"https://github.com/zloirock/core-js"})},function(n,e,t){var a=t(56),r=t(2);n.exports=!!Object.getOwnPropertySymbols&&!r((function(){var n=Symbol();return!String(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&a&&a<41}))},function(n,e,t){var a,r,i=t(0),s=t(31),o=i.process,l=i.Deno,c=o&&o.versions||l&&l.version,d=c&&c.v8;d&&(r=(a=d.split("."))[0]>0&&a[0]<4?1:+(a[0]+a[1])),!r&&s&&(!(a=s.match(/Edge\/(\d+)/))||a[1]>=74)&&(a=s.match(/Chrome\/(\d+)/))&&(r=+a[1]),n.exports=r},function(n,e,t){var a=t(48),r=Math.min;n.exports=function(n){return n>0?r(a(n),9007199254740991):0}},function(n,e,t){var a=t(0);n.exports=a.Promise},function(n,e,t){"use strict";var a=t(91),r=t(13),i=t(51);n.exports=function(n,e,t){var s=a(e);s in n?r.f(n,s,i(0,t)):n[s]=t}},function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));t(65),t(78),t(5),t(100),t(22),t(25),t(273),t(274),t(275),t(276),t(111),t(131),t(38),t(23),t(132),t(26),t(27),t(87),t(133),t(282),t(43);var a=t(61);function r(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
r=function(){return n};var n={},e=Object.prototype,t=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(n,e,t){return Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}),n[e]}try{c({},"")}catch(n){c=function(n,e,t){return n[e]=t}}function d(n,e,t,a){var r=e&&e.prototype instanceof p?e:p,i=Object.create(r.prototype),s=new k(a||[]);return i._invoke=function(n,e,t){var a="suspendedStart";return function(r,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw i;return q()}for(t.method=r,t.arg=i;;){var s=t.delegate;if(s){var o=E(s,t);if(o){if(o===m)continue;return o}}if("next"===t.method)t.sent=t._sent=t.arg;else if("throw"===t.method){if("suspendedStart"===a)throw a="completed",t.arg;t.dispatchException(t.arg)}else"return"===t.method&&t.abrupt("return",t.arg);a="executing";var l=u(n,e,t);if("normal"===l.type){if(a=t.done?"completed":"suspendedYield",l.arg===m)continue;return{value:l.arg,done:t.done}}"throw"===l.type&&(a="completed",t.method="throw",t.arg=l.arg)}}}(n,t,s),i}function u(n,e,t){try{return{type:"normal",arg:n.call(e,t)}}catch(n){return{type:"throw",arg:n}}}n.wrap=d;var m={};function p(){}function h(){}function g(){}var f={};c(f,s,(function(){return this}));var b=Object.getPrototypeOf,y=b&&b(b(S([])));y&&y!==e&&t.call(y,s)&&(f=y);var v=g.prototype=p.prototype=Object.create(f);function _(n){["next","throw","return"].forEach((function(e){c(n,e,(function(n){return this._invoke(e,n)}))}))}function x(n,e){var r;this._invoke=function(i,s){function o(){return new e((function(r,o){!function r(i,s,o,l){var c=u(n[i],n,s);if("throw"!==c.type){var d=c.arg,m=d.value;return m&&"object"==Object(a.a)(m)&&t.call(m,"__await")?e.resolve(m.__await).then((function(n){r("next",n,o,l)}),(function(n){r("throw",n,o,l)})):e.resolve(m).then((function(n){d.value=n,o(d)}),(function(n){return r("throw",n,o,l)}))}l(c.arg)}(i,s,r,o)}))}return r=r?r.then(o,o):o()}}function E(n,e){var t=n.iterator[e.method];if(void 0===t){if(e.delegate=null,"throw"===e.method){if(n.iterator.return&&(e.method="return",e.arg=void 0,E(n,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=u(t,n.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,m;var r=a.arg;return r?r.done?(e[n.resultName]=r.value,e.next=n.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,m):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function T(n){var e={tryLoc:n[0]};1 in n&&(e.catchLoc=n[1]),2 in n&&(e.finallyLoc=n[2],e.afterLoc=n[3]),this.tryEntries.push(e)}function I(n){var e=n.completion||{};e.type="normal",delete e.arg,n.completion=e}function k(n){this.tryEntries=[{tryLoc:"root"}],n.forEach(T,this),this.reset(!0)}function S(n){if(n){var e=n[s];if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,r=function e(){for(;++a<n.length;)if(t.call(n,a))return e.value=n[a],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:q}}function q(){return{value:void 0,done:!0}}return h.prototype=g,c(v,"constructor",g),c(g,"constructor",h),h.displayName=c(g,l,"GeneratorFunction"),n.isGeneratorFunction=function(n){var e="function"==typeof n&&n.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,g):(n.__proto__=g,c(n,l,"GeneratorFunction")),n.prototype=Object.create(v),n},n.awrap=function(n){return{__await:n}},_(x.prototype),c(x.prototype,o,(function(){return this})),n.AsyncIterator=x,n.async=function(e,t,a,r,i){void 0===i&&(i=Promise);var s=new x(d(e,t,a,r),i);return n.isGeneratorFunction(t)?s:s.next().then((function(n){return n.done?n.value:s.next()}))},_(v),c(v,l,"Generator"),c(v,s,(function(){return this})),c(v,"toString",(function(){return"[object Generator]"})),n.keys=function(n){var e=[];for(var t in n)e.push(t);return e.reverse(),function t(){for(;e.length;){var a=e.pop();if(a in n)return t.value=a,t.done=!1,t}return t.done=!0,t}},n.values=S,k.prototype={constructor:k,reset:function(n){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!n)for(var e in this)"t"===e.charAt(0)&&t.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var e=this;function a(t,a){return s.type="throw",s.arg=n,e.next=t,a&&(e.method="next",e.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var o=t.call(i,"catchLoc"),l=t.call(i,"finallyLoc");if(o&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(n,e){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&t.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===n||"continue"===n)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=n,s.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(s)},complete:function(n,e){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&e&&(this.next=e),m},finish:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.finallyLoc===n)return this.complete(t.completion,t.afterLoc),I(t),m}},catch:function(n){for(var e=this.tryEntries.length-1;e>=0;--e){var t=this.tryEntries[e];if(t.tryLoc===n){var a=t.completion;if("throw"===a.type){var r=a.arg;I(t)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(n,e,t){return this.delegate={iterator:S(n),resultName:e,nextLoc:t},"next"===this.method&&(this.arg=void 0),m}},n}},function(n,e,t){"use strict";t.d(e,"a",(function(){return a}));t(65),t(78),t(5),t(100),t(22),t(25);function a(n){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}},function(n,e,t){var a=t(3),r=t(24),i=t(68),s=a(a.bind);n.exports=function(n,e){return r(n),void 0===e?n:i?s(n,e):function(){return n.apply(e,arguments)}}},function(n,e,t){var a=t(62),r=t(3),i=t(67),s=t(16),o=t(20),l=t(114),c=r([].push),d=function(n){var e=1==n,t=2==n,r=3==n,d=4==n,u=6==n,m=7==n,p=5==n||u;return function(h,g,f,b){for(var y,v,_=s(h),x=i(_),E=a(g,f),T=o(x),I=0,k=b||l,S=e?k(h,T):t||m?k(h,0):void 0;T>I;I++)if((p||I in x)&&(v=E(y=x[I],I,_),n))if(e)S[I]=v;else if(v)switch(n){case 3:return!0;case 5:return y;case 6:return I;case 2:c(S,y)}else switch(n){case 4:return!1;case 7:c(S,y)}return u?-1:r||d?d:S}};n.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6),filterReject:d(7)}},function(n,e,t){var a=t(166),r=t(122).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(n){return a(n,r)}},function(n,e,t){t(265),t(269),t(270),t(130),t(271)},function(n,e,t){var a=t(80),r=t(296),i=t(297),s=a?a.toStringTag:void 0;n.exports=function(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":s&&s in Object(n)?r(n):i(n)}},function(n,e,t){var a=t(0),r=t(3),i=t(2),s=t(28),o=a.Object,l=r("".split);n.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(n){return"String"==s(n)?l(n,""):o(n)}:o},function(n,e,t){var a=t(2);n.exports=!a((function(){var n=function(){}.bind();return"function"!=typeof n||n.hasOwnProperty("prototype")}))},function(n,e,t){var a=t(0),r=t(14),i=t(4),s=t(36),o=t(162),l=a.Object;n.exports=o?function(n){return"symbol"==typeof n}:function(n){var e=r("Symbol");return i(e)&&s(e.prototype,l(n))}},function(n,e,t){var a=t(0).String;n.exports=function(n){try{return a(n)}catch(n){return"Object"}}},function(n,e){n.exports={}},function(n,e){n.exports={}},function(n,e,t){var a=t(8),r=t(9),i=Function.prototype,s=a&&Object.getOwnPropertyDescriptor,o=r(i,"name"),l=o&&"something"===function(){}.name,c=o&&(!a||a&&s(i,"name").configurable);n.exports={EXISTS:o,PROPER:l,CONFIGURABLE:c}},function(n,e,t){var a=t(3),r=t(10),i=t(248);n.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var n,e=!1,t={};try{(n=a(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(t,[]),e=t instanceof Array}catch(n){}return function(t,a){return r(t),i(a),e?n(t,a):t.__proto__=a,t}}():void 0)},function(n,e,t){var a=t(3);n.exports=a([].slice)},function(n,e,t){var a=t(0),r=t(58),i=t(4),s=t(112),o=t(95),l=t(6),c=t(256),d=t(17),u=t(56),m=r&&r.prototype,p=l("species"),h=!1,g=i(a.PromiseRejectionEvent),f=s("Promise",(function(){var n=o(r),e=n!==String(r);if(!e&&66===u)return!0;if(d&&(!m.catch||!m.finally))return!0;if(u>=51&&/native code/.test(n))return!1;var t=new r((function(n){n(1)})),a=function(n){n((function(){}),(function(){}))};return(t.constructor={})[p]=a,!(h=t.then((function(){}))instanceof a)||!e&&c&&!g}));n.exports={CONSTRUCTOR:f,REJECTION_EVENT:g,SUBCLASSING:h}},function(n,e,t){"use strict";var a=t(24),r=function(n){var e,t;this.promise=new n((function(n,a){if(void 0!==e||void 0!==t)throw TypeError("Bad Promise constructor");e=n,t=a})),this.resolve=a(e),this.reject=a(t)};n.exports.f=function(n){return new r(n)}},function(n,e,t){"use strict";var a=t(1),r=t(8),i=t(0),s=t(3),o=t(9),l=t(4),c=t(36),d=t(12),u=t(13).f,m=t(124),p=i.Symbol,h=p&&p.prototype;if(r&&l(p)&&(!("description"in h)||void 0!==p().description)){var g={},f=function(){var n=arguments.length<1||void 0===arguments[0]?void 0:d(arguments[0]),e=c(h,this)?new p(n):void 0===n?p():p(n);return""===n&&(g[e]=!0),e};m(f,p),f.prototype=h,h.constructor=f;var b="Symbol(test)"==String(p("test")),y=s(h.toString),v=s(h.valueOf),_=/^Symbol\((.*)\)[^)]+$/,x=s("".replace),E=s("".slice);u(h,"description",{configurable:!0,get:function(){var n=v(this),e=y(n);if(o(g,n))return"";var t=b?E(e,7,-1):x(e,_,"$1");return""===t?void 0:t}}),a({global:!0,constructor:!0,forced:!0},{Symbol:f})}},function(n,e,t){var a=t(2),r=t(6),i=t(56),s=r("species");n.exports=function(n){return i>=51||!a((function(){var e=[];return(e.constructor={})[s]=function(){return{foo:1}},1!==e[n](Boolean).foo}))}},function(n,e,t){var a=t(32).Symbol;n.exports=a},function(n,e,t){"use strict";t.d(e,"a",(function(){return i}));t(88);var a=t(82);t(65),t(78),t(5),t(100),t(22),t(25),t(193);var r=t(108);t(38),t(23);function i(n){return function(n){if(Array.isArray(n))return Object(a.a)(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||Object(r.a)(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(n,e,t){"use strict";function a(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=n[t];return a}t.d(e,"a",(function(){return a}))},function(n,e,t){"use strict";var a=t(1),r=t(0),i=t(2),s=t(52),o=t(11),l=t(16),c=t(20),d=t(59),u=t(114),m=t(79),p=t(6),h=t(56),g=p("isConcatSpreadable"),f=r.TypeError,b=h>=51||!i((function(){var n=[];return n[g]=!1,n.concat()[0]!==n})),y=m("concat"),v=function(n){if(!o(n))return!1;var e=n[g];return void 0!==e?!!e:s(n)};a({target:"Array",proto:!0,arity:1,forced:!b||!y},{concat:function(n){var e,t,a,r,i,s=l(this),o=u(s,0),m=0;for(e=-1,a=arguments.length;e<a;e++)if(v(i=-1===e?s:arguments[e])){if(m+(r=c(i))>9007199254740991)throw f("Maximum allowed index exceeded");for(t=0;t<r;t++,m++)t in i&&d(o,m,i[t])}else{if(m>=9007199254740991)throw f("Maximum allowed index exceeded");d(o,m++,i)}return o.length=m,o}})},function(n,e,t){"use strict";var a=t(1),r=t(3),i=t(121).indexOf,s=t(49),o=r([].indexOf),l=!!o&&1/o([1],1,-0)<0,c=s("indexOf");a({target:"Array",proto:!0,forced:l||!c},{indexOf:function(n){var e=arguments.length>1?arguments[1]:void 0;return l?o(this,n,e)||0:i(this,n,e)}})},function(n,e,t){"use strict";t(19);var a,r,i=t(1),s=t(0),o=t(7),l=t(3),c=t(4),d=t(11),u=(a=!1,(r=/[ac]/).exec=function(){return a=!0,/./.exec.apply(this,arguments)},!0===r.test("abc")&&a),m=s.Error,p=l(/./.test);i({target:"RegExp",proto:!0,forced:!u},{test:function(n){var e=this.exec;if(!c(e))return p(this,n);var t=o(e,this,n);if(null!==t&&!d(t))throw new m("RegExp exec method returned something other than an Object or null");return!!t}})},function(n,e,t){var a=t(0),r=t(127),i=t(4),s=t(28),o=t(6)("toStringTag"),l=a.Object,c="Arguments"==s(function(){return arguments}());n.exports=r?s:function(n){var e,t,a;return void 0===n?"Undefined":null===n?"Null":"string"==typeof(t=function(n,e){try{return n[e]}catch(n){}}(e=l(n),o))?t:c?s(e):"Object"==(a=s(e))&&i(e.callee)?"Arguments":a}},function(n,e,t){var a=t(8),r=t(73).EXISTS,i=t(3),s=t(13).f,o=Function.prototype,l=i(o.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,d=i(c.exec);a&&!r&&s(o,"name",{configurable:!0,get:function(){try{return d(c,l(this))[1]}catch(n){return""}}})},function(n,e,t){t(1)({target:"Array",stat:!0},{isArray:t(52)})},function(n,e,t){var a=t(3),r=0,i=Math.random(),s=a(1..toString);n.exports=function(n){return"Symbol("+(void 0===n?"":n)+")_"+s(++r+i,36)}},function(n,e,t){var a=t(0),r=t(11),i=a.document,s=r(i)&&r(i.createElement);n.exports=function(n){return s?i.createElement(n):{}}},function(n,e,t){var a=t(165),r=t(69);n.exports=function(n){var e=a(n,"string");return r(e)?e:e+""}},function(n,e,t){var a=t(166),r=t(122);n.exports=Object.keys||function(n){return a(n,r)}},function(n,e,t){var a=t(48),r=Math.max,i=Math.min;n.exports=function(n,e){var t=a(n);return t<0?r(t+e,0):i(t,e)}},function(n,e,t){var a=t(54),r=t(89),i=a("keys");n.exports=function(n){return i[n]||(i[n]=r(n))}},function(n,e,t){var a=t(3),r=t(4),i=t(119),s=a(Function.toString);r(i.inspectSource)||(i.inspectSource=function(n){return s(n)}),n.exports=i.inspectSource},function(n,e){e.f=Object.getOwnPropertySymbols},function(n,e,t){var a=t(28),r=t(0);n.exports="process"==a(r.process)},function(n,e,t){var a=t(3),r=t(2),i=t(4),s=t(86),o=t(14),l=t(95),c=function(){},d=[],u=o("Reflect","construct"),m=/^\s*(?:class|function)\b/,p=a(m.exec),h=!m.exec(c),g=function(n){if(!i(n))return!1;try{return u(c,d,n),!0}catch(n){return!1}},f=function(n){if(!i(n))return!1;switch(s(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!p(m,l(n))}catch(n){return!0}};f.sham=!0,n.exports=!u||r((function(){var n;return g(g.call)||!g(Object)||!g((function(){n=!0}))||n}))?f:g},function(n,e,t){var a=t(266),r=t(9),i=t(183),s=t(13).f;n.exports=function(n){var e=a.Symbol||(a.Symbol={});r(e,n)||s(e,n,{value:i.f(n)})}},function(n,e,t){t(99)("iterator")},function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));t(5);function a(n,e,t,a,r,i,s){try{var o=n[i](s),l=o.value}catch(n){return void t(n)}o.done?e(l):Promise.resolve(l).then(a,r)}function r(n){return function(){var e=this,t=arguments;return new Promise((function(r,i){var s=n.apply(e,t);function o(n){a(s,r,i,o,l,"next",n)}function l(n){a(s,r,i,o,l,"throw",n)}o(void 0)}))}}},function(n,e,t){"use strict";var a,r,i=t(7),s=t(3),o=t(12),l=t(194),c=t(115),d=t(54),u=t(35),m=t(39).get,p=t(229),h=t(235),g=d("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,b=f,y=s("".charAt),v=s("".indexOf),_=s("".replace),x=s("".slice),E=(r=/b*/g,i(f,a=/a/,"a"),i(f,r,"a"),0!==a.lastIndex||0!==r.lastIndex),T=c.BROKEN_CARET,I=void 0!==/()??/.exec("")[1];(E||I||T||p||h)&&(b=function(n){var e,t,a,r,s,c,d,p=this,h=m(p),k=o(n),S=h.raw;if(S)return S.lastIndex=p.lastIndex,e=i(b,S,k),p.lastIndex=S.lastIndex,e;var q=h.groups,w=T&&p.sticky,R=i(l,p),A=p.source,z=0,L=k;if(w&&(R=_(R,"y",""),-1===v(R,"g")&&(R+="g"),L=x(k,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==y(k,p.lastIndex-1))&&(A="(?: "+A+")",L=" "+L,z++),t=new RegExp("^(?:"+A+")",R)),I&&(t=new RegExp("^"+A+"$(?!\\s)",R)),E&&(a=p.lastIndex),r=i(f,w?t:p,L),w?r?(r.input=x(r.input,z),r[0]=x(r[0],z),r.index=p.lastIndex,p.lastIndex+=r[0].length):p.lastIndex=0:E&&r&&(p.lastIndex=p.global?r.index+r[0].length:a),I&&r&&r.length>1&&i(g,r[0],t,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(r[s]=void 0)})),r&&q)for(r.groups=c=u(null),s=0;s<q.length;s++)c[(d=q[s])[0]]=r[d[1]];return r}),n.exports=b},function(n,e,t){var a=t(301),r=t(302),i=t(303),s=t(304),o=t(305);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}l.prototype.clear=a,l.prototype.delete=r,l.prototype.get=i,l.prototype.has=s,l.prototype.set=o,n.exports=l},function(n,e,t){var a=t(198);n.exports=function(n,e){for(var t=n.length;t--;)if(a(n[t][0],e))return t;return-1}},function(n,e,t){var a=t(42)(Object,"create");n.exports=a},function(n,e,t){var a=t(323);n.exports=function(n,e){var t=n.__data__;return a(e)?t["string"==typeof e?"string":"hash"]:t.map}},function(n,e,t){var a=t(142);n.exports=function(n){if("string"==typeof n||a(n))return n;var e=n+"";return"0"==e&&1/n==-1/0?"-0":e}},function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));t(43),t(5),t(87),t(193),t(22),t(19),t(85);var a=t(82);function r(n,e){if(n){if("string"==typeof n)return Object(a.a)(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Object(a.a)(n,e):void 0}}},function(n,e,t){var a,r;
/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */void 0===(r="function"==typeof(a=function(){var n,e,t={version:"0.2.0"},a=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};function r(n,e,t){return n<e?e:n>t?t:n}function i(n){return 100*(-1+n)}t.configure=function(n){var e,t;for(e in n)void 0!==(t=n[e])&&n.hasOwnProperty(e)&&(a[e]=t);return this},t.status=null,t.set=function(n){var e=t.isStarted();n=r(n,a.minimum,1),t.status=1===n?null:n;var l=t.render(!e),c=l.querySelector(a.barSelector),d=a.speed,u=a.easing;return l.offsetWidth,s((function(e){""===a.positionUsing&&(a.positionUsing=t.getPositioningCSS()),o(c,function(n,e,t){var r;return(r="translate3d"===a.positionUsing?{transform:"translate3d("+i(n)+"%,0,0)"}:"translate"===a.positionUsing?{transform:"translate("+i(n)+"%,0)"}:{"margin-left":i(n)+"%"}).transition="all "+e+"ms "+t,r}(n,d,u)),1===n?(o(l,{transition:"none",opacity:1}),l.offsetWidth,setTimeout((function(){o(l,{transition:"all "+d+"ms linear",opacity:0}),setTimeout((function(){t.remove(),e()}),d)}),d)):setTimeout(e,d)})),this},t.isStarted=function(){return"number"==typeof t.status},t.start=function(){t.status||t.set(0);var n=function(){setTimeout((function(){t.status&&(t.trickle(),n())}),a.trickleSpeed)};return a.trickle&&n(),this},t.done=function(n){return n||t.status?t.inc(.3+.5*Math.random()).set(1):this},t.inc=function(n){var e=t.status;return e?("number"!=typeof n&&(n=(1-e)*r(Math.random()*e,.1,.95)),e=r(e+n,0,.994),t.set(e)):t.start()},t.trickle=function(){return t.inc(Math.random()*a.trickleRate)},n=0,e=0,t.promise=function(a){return a&&"resolved"!==a.state()?(0===e&&t.start(),n++,e++,a.always((function(){0==--e?(n=0,t.done()):t.set((n-e)/n)})),this):this},t.render=function(n){if(t.isRendered())return document.getElementById("nprogress");c(document.documentElement,"nprogress-busy");var e=document.createElement("div");e.id="nprogress",e.innerHTML=a.template;var r,s=e.querySelector(a.barSelector),l=n?"-100":i(t.status||0),d=document.querySelector(a.parent);return o(s,{transition:"all 0 linear",transform:"translate3d("+l+"%,0,0)"}),a.showSpinner||(r=e.querySelector(a.spinnerSelector))&&m(r),d!=document.body&&c(d,"nprogress-custom-parent"),d.appendChild(e),e},t.remove=function(){d(document.documentElement,"nprogress-busy"),d(document.querySelector(a.parent),"nprogress-custom-parent");var n=document.getElementById("nprogress");n&&m(n)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var n=document.body.style,e="WebkitTransform"in n?"Webkit":"MozTransform"in n?"Moz":"msTransform"in n?"ms":"OTransform"in n?"O":"";return e+"Perspective"in n?"translate3d":e+"Transform"in n?"translate":"margin"};var s=function(){var n=[];function e(){var t=n.shift();t&&t(e)}return function(t){n.push(t),1==n.length&&e()}}(),o=function(){var n=["Webkit","O","Moz","ms"],e={};function t(t){return t=t.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(n,e){return e.toUpperCase()})),e[t]||(e[t]=function(e){var t=document.body.style;if(e in t)return e;for(var a,r=n.length,i=e.charAt(0).toUpperCase()+e.slice(1);r--;)if((a=n[r]+i)in t)return a;return e}(t))}function a(n,e,a){e=t(e),n.style[e]=a}return function(n,e){var t,r,i=arguments;if(2==i.length)for(t in e)void 0!==(r=e[t])&&e.hasOwnProperty(t)&&a(n,t,r);else a(n,i[1],i[2])}}();function l(n,e){return("string"==typeof n?n:u(n)).indexOf(" "+e+" ")>=0}function c(n,e){var t=u(n),a=t+e;l(t,e)||(n.className=a.substring(1))}function d(n,e){var t,a=u(n);l(n,e)&&(t=a.replace(" "+e+" "," "),n.className=t.substring(1,t.length-1))}function u(n){return(" "+(n.className||"")+" ").replace(/\s+/gi," ")}function m(n){n&&n.parentNode&&n.parentNode.removeChild(n)}return t})?a.call(e,t,e,n):a)||(n.exports=r)},function(n,e,t){var a=t(1),r=t(16),i=t(92);a({target:"Object",stat:!0,forced:t(2)((function(){i(1)}))},{keys:function(n){return i(r(n))}})},function(n,e,t){var a=t(1),r=t(8),i=t(13).f;a({target:"Object",stat:!0,forced:Object.defineProperty!==i,sham:!r},{defineProperty:i})},function(n,e,t){var a=t(2),r=t(4),i=/#|\.prototype\./,s=function(n,e){var t=l[o(n)];return t==d||t!=c&&(r(e)?a(e):!!e)},o=s.normalize=function(n){return String(n).replace(i,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",d=s.POLYFILL="P";n.exports=s},function(n,e,t){var a=t(86),r=t(50),i=t(72),s=t(6)("iterator");n.exports=function(n){if(null!=n)return r(n,s)||r(n,"@@iterator")||i[a(n)]}},function(n,e,t){var a=t(268);n.exports=function(n,e){return new(a(n))(0===e?0:e)}},function(n,e,t){var a=t(2),r=t(0).RegExp,i=a((function(){var n=r("a","y");return n.lastIndex=2,null!=n.exec("abcd")})),s=i||a((function(){return!r("a","y").sticky})),o=i||a((function(){var n=r("^r","gy");return n.lastIndex=2,null!=n.exec("str")}));n.exports={BROKEN_CARET:o,MISSED_STICKY:s,UNSUPPORTED_Y:i}},function(n,e,t){"use strict";t(19);var a=t(3),r=t(15),i=t(102),s=t(2),o=t(6),l=t(29),c=o("species"),d=RegExp.prototype;n.exports=function(n,e,t,u){var m=o(n),p=!s((function(){var e={};return e[m]=function(){return 7},7!=""[n](e)})),h=p&&!s((function(){var e=!1,t=/a/;return"split"===n&&((t={}).constructor={},t.constructor[c]=function(){return t},t.flags="",t[m]=/./[m]),t.exec=function(){return e=!0,null},t[m](""),!e}));if(!p||!h||t){var g=a(/./[m]),f=e(m,""[n],(function(n,e,t,r,s){var o=a(n),l=e.exec;return l===i||l===d.exec?p&&!s?{done:!0,value:g(e,t,r)}:{done:!0,value:o(t,e,r)}:{done:!1}}));r(String.prototype,n,f[0]),r(d,m,f[1])}u&&l(d[m],"sham",!0)}},function(n,e,t){var a=t(0),r=t(7),i=t(10),s=t(4),o=t(28),l=t(102),c=a.TypeError;n.exports=function(n,e){var t=n.exec;if(s(t)){var a=r(t,n,e);return null!==a&&i(a),a}if("RegExp"===o(n))return r(l,n,e);throw c("RegExp#exec called on incompatible receiver")}},function(n,e,t){"use strict";var a=t(1),r=t(3),i=t(67),s=t(21),o=t(49),l=r([].join),c=i!=Object,d=o("join",",");a({target:"Array",proto:!0,forced:c||!d},{join:function(n){return l(s(this),void 0===n?",":n)}})},function(n,e,t){var a=t(0),r=t(120),i=a["__core-js_shared__"]||r("__core-js_shared__",{});n.exports=i},function(n,e,t){var a=t(0),r=Object.defineProperty;n.exports=function(n,e){try{r(a,n,{value:e,configurable:!0,writable:!0})}catch(t){a[n]=e}return e}},function(n,e,t){var a=t(21),r=t(93),i=t(20),s=function(n){return function(e,t,s){var o,l=a(e),c=i(l),d=r(s,c);if(n&&t!=t){for(;c>d;)if((o=l[d++])!=o)return!0}else for(;c>d;d++)if((n||d in l)&&l[d]===t)return n||d||0;return!n&&-1}};n.exports={includes:s(!0),indexOf:s(!1)}},function(n,e){n.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(n,e,t){"use strict";var a={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!a.call({1:2},1);e.f=i?function(n){var e=r(this,n);return!!e&&e.enumerable}:a},function(n,e,t){var a=t(9),r=t(170),i=t(40),s=t(13);n.exports=function(n,e,t){for(var o=r(e),l=s.f,c=i.f,d=0;d<o.length;d++){var u=o[d];a(n,u)||t&&a(t,u)||l(n,u,c(e,u))}}},function(n,e,t){var a=t(0),r=t(9),i=t(4),s=t(16),o=t(94),l=t(172),c=o("IE_PROTO"),d=a.Object,u=d.prototype;n.exports=l?d.getPrototypeOf:function(n){var e=s(n);if(r(e,c))return e[c];var t=e.constructor;return i(t)&&e instanceof t?t.prototype:e instanceof d?u:null}},function(n,e,t){var a=t(10),r=t(173),i=t(6)("species");n.exports=function(n,e){var t,s=a(n).constructor;return void 0===s||null==(t=a(s)[i])?e:r(t)}},function(n,e,t){var a={};a[t(6)("toStringTag")]="z",n.exports="[object z]"===String(a)},function(n,e){n.exports=function(n){try{return{error:!1,value:n()}}catch(n){return{error:!0,value:n}}}},function(n,e,t){var a=t(0),r=t(93),i=t(20),s=t(59),o=a.Array,l=Math.max;n.exports=function(n,e,t){for(var a=i(n),c=r(e,a),d=r(void 0===t?a:t,a),u=o(l(d-c,0)),m=0;c<d;c++,m++)s(u,m,n[c]);return u.length=m,u}},function(n,e,t){var a=t(1),r=t(14),i=t(41),s=t(7),o=t(3),l=t(2),c=t(52),d=t(4),u=t(11),m=t(69),p=t(75),h=t(55),g=r("JSON","stringify"),f=o(/./.exec),b=o("".charAt),y=o("".charCodeAt),v=o("".replace),_=o(1..toString),x=/[\uD800-\uDFFF]/g,E=/^[\uD800-\uDBFF]$/,T=/^[\uDC00-\uDFFF]$/,I=!h||l((function(){var n=r("Symbol")();return"[null]"!=g([n])||"{}"!=g({a:n})||"{}"!=g(Object(n))})),k=l((function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")})),S=function(n,e){var t=p(arguments),a=e;if((u(e)||void 0!==n)&&!m(n))return c(e)||(e=function(n,e){if(d(a)&&(e=s(a,this,n,e)),!m(e))return e}),t[1]=e,i(g,null,t)},q=function(n,e,t){var a=b(t,e-1),r=b(t,e+1);return f(E,n)&&!f(T,r)||f(T,n)&&!f(E,a)?"\\u"+_(y(n,0),16):n};g&&a({target:"JSON",stat:!0,arity:3,forced:I||k},{stringify:function(n,e,t){var a=p(arguments),r=i(I?S:g,null,a);return k&&"string"==typeof r?v(r,x,q):r}})},function(n,e,t){t(1)({target:"Object",stat:!0,sham:!t(8)},{create:t(35)})},function(n,e,t){var a=t(1),r=t(2),i=t(16),s=t(125),o=t(172);a({target:"Object",stat:!0,forced:r((function(){s(1)})),sham:!o},{getPrototypeOf:function(n){return s(i(n))}})},function(n,e,t){t(1)({target:"Object",stat:!0},{setPrototypeOf:t(74)})},function(n,e,t){"use strict";var a=t(185).charAt;n.exports=function(n,e,t){return e+(t?a(n,e).length:1)}},function(n,e,t){var a=t(295),r=t(53),i=Object.prototype,s=i.hasOwnProperty,o=i.propertyIsEnumerable,l=a(function(){return arguments}())?a:function(n){return r(n)&&s.call(n,"callee")&&!o.call(n,"callee")};n.exports=l},function(n,e,t){var a=t(42)(t(32),"Map");n.exports=a},function(n,e){n.exports=function(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)}},function(n,e,t){var a=t(315),r=t(322),i=t(324),s=t(325),o=t(326);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}l.prototype.clear=a,l.prototype.delete=r,l.prototype.get=i,l.prototype.has=s,l.prototype.set=o,n.exports=l},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n){t[++e]=n})),t}},function(n,e){n.exports=function(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991}},function(n,e,t){var a=t(30),r=t(142),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;n.exports=function(n,e){if(a(n))return!1;var t=typeof n;return!("number"!=t&&"symbol"!=t&&"boolean"!=t&&null!=n&&!r(n))||(s.test(n)||!i.test(n)||null!=e&&n in Object(e))}},function(n,e,t){var a=t(66),r=t(53);n.exports=function(n){return"symbol"==typeof n||r(n)&&"[object Symbol]"==a(n)}},function(n,e){n.exports=function(n){return n}},function(n,e,t){var a=t(1),r=t(216);a({target:"Function",proto:!0,forced:Function.bind!==r},{bind:r})},function(n,e,t){"use strict";t.d(e,"a",(function(){return r}));t(88);t(65),t(78),t(5),t(100),t(22),t(25);var a=t(108);t(38),t(23);function r(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var a,r,i=[],s=!0,o=!1;try{for(t=t.call(n);!(s=(a=t.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(n){o=!0,r=n}finally{try{s||null==t.return||t.return()}finally{if(o)throw r}}return i}}(n,e)||Object(a.a)(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(n,e,t){"use strict";var a=t(41),r=t(7),i=t(3),s=t(116),o=t(156),l=t(10),c=t(18),d=t(126),u=t(134),m=t(57),p=t(12),h=t(50),g=t(129),f=t(117),b=t(102),y=t(115),v=t(2),_=y.UNSUPPORTED_Y,x=Math.min,E=[].push,T=i(/./.exec),I=i(E),k=i("".slice);s("split",(function(n,e,t){var i;return i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(n,t){var i=p(c(this)),s=void 0===t?4294967295:t>>>0;if(0===s)return[];if(void 0===n)return[i];if(!o(n))return r(e,i,n,s);for(var l,d,u,m=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),f=0,y=new RegExp(n.source,h+"g");(l=r(b,y,i))&&!((d=y.lastIndex)>f&&(I(m,k(i,f,l.index)),l.length>1&&l.index<i.length&&a(E,m,g(l,1)),u=l[0].length,f=d,m.length>=s));)y.lastIndex===l.index&&y.lastIndex++;return f===i.length?!u&&T(y,"")||I(m,""):I(m,k(i,f)),m.length>s?g(m,0,s):m}:"0".split(void 0,0).length?function(n,t){return void 0===n&&0===t?[]:r(e,this,n,t)}:e,[function(e,t){var a=c(this),s=null==e?void 0:h(e,n);return s?r(s,e,a,t):r(i,p(a),e,t)},function(n,a){var r=l(this),s=p(n),o=t(i,r,s,a,i!==e);if(o.done)return o.value;var c=d(r,RegExp),h=r.unicode,g=(r.ignoreCase?"i":"")+(r.multiline?"m":"")+(r.unicode?"u":"")+(_?"g":"y"),b=new c(_?"^(?:"+r.source+")":r,g),y=void 0===a?4294967295:a>>>0;if(0===y)return[];if(0===s.length)return null===f(b,s)?[s]:[];for(var v=0,E=0,T=[];E<s.length;){b.lastIndex=_?0:E;var S,q=f(b,_?k(s,E):s);if(null===q||(S=x(m(b.lastIndex+(_?E:0)),s.length))===v)E=u(s,E,h);else{if(I(T,k(s,v,E)),T.length===y)return T;for(var w=1;w<=q.length-1;w++)if(I(T,q[w]),T.length===y)return T;E=v=S}}return I(T,k(s,v)),T}]}),!!v((function(){var n=/(?:)/,e=n.exec;n.exec=function(){return e.apply(this,arguments)};var t="ab".split(n);return 2!==t.length||"a"!==t[0]||"b"!==t[1]})),_)},function(n,e,t){"use strict";var a=t(1),r=t(63).some;a({target:"Array",proto:!0,forced:!t(49)("some")},{some:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){"use strict";var a=t(7),r=t(116),i=t(10),s=t(57),o=t(12),l=t(18),c=t(50),d=t(134),u=t(117);r("match",(function(n,e,t){return[function(e){var t=l(this),r=null==e?void 0:c(e,n);return r?a(r,e,t):new RegExp(e)[n](o(t))},function(n){var a=i(this),r=o(n),l=t(e,a,r);if(l.done)return l.value;if(!a.global)return u(a,r);var c=a.unicode;a.lastIndex=0;for(var m,p=[],h=0;null!==(m=u(a,r));){var g=o(m[0]);p[h]=g,""===g&&(a.lastIndex=d(r,s(a.lastIndex),c)),h++}return 0===h?null:p}]}))},function(n,e,t){var a=t(6),r=t(35),i=t(13).f,s=a("unscopables"),o=Array.prototype;null==o[s]&&i(o,s,{configurable:!0,value:r(null)}),n.exports=function(n){o[s][n]=!0}},function(n,e,t){"use strict";var a=t(73).PROPER,r=t(15),i=t(10),s=t(12),o=t(2),l=t(240),c=RegExp.prototype.toString,d=o((function(){return"/a/b"!=c.call({source:"a",flags:"b"})})),u=a&&"toString"!=c.name;(d||u)&&r(RegExp.prototype,"toString",(function(){var n=i(this);return"/"+s(n.source)+"/"+s(l(n))}),{unsafe:!0})},function(n,e,t){"use strict";var a=t(21),r=t(149),i=t(72),s=t(39),o=t(13).f,l=t(168),c=t(17),d=t(8),u=s.set,m=s.getterFor("Array Iterator");n.exports=l(Array,"Array",(function(n,e){u(this,{type:"Array Iterator",target:a(n),index:0,kind:e})}),(function(){var n=m(this),e=n.target,t=n.kind,a=n.index++;return!e||a>=e.length?(n.target=void 0,{value:void 0,done:!0}):"keys"==t?{value:a,done:!1}:"values"==t?{value:e[a],done:!1}:{value:[a,e[a]],done:!1}}),"values");var p=i.Arguments=i.Array;if(r("keys"),r("values"),r("entries"),!c&&d&&"values"!==p.name)try{o(p,"name",{value:"values"})}catch(n){}},function(n,e,t){var a=t(8),r=t(163),i=t(13),s=t(10),o=t(21),l=t(92);e.f=a&&!r?Object.defineProperties:function(n,e){s(n);for(var t,a=o(e),r=l(e),c=r.length,d=0;c>d;)i.f(n,t=r[d++],a[t]);return n}},function(n,e,t){var a=t(0).TypeError;n.exports=function(n,e){if(n<e)throw a("Not enough arguments");return n}},function(n,e,t){var a=t(0),r=t(7),i=t(24),s=t(10),o=t(70),l=t(113),c=a.TypeError;n.exports=function(n,e){var t=arguments.length<2?l(n):e;if(i(t))return s(r(t,n));throw c(o(n)+" is not iterable")}},function(n,e,t){var a=t(4),r=t(11),i=t(74);n.exports=function(n,e,t){var s,o;return i&&a(s=e.constructor)&&s!==t&&r(o=s.prototype)&&o!==t.prototype&&i(n,o),n}},function(n,e,t){var a=t(11),r=t(28),i=t(6)("match");n.exports=function(n){var e;return a(n)&&(void 0!==(e=n[i])?!!e:"RegExp"==r(n))}},function(n,e){n.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children||(n.children=[]),Object.defineProperty(n,"loaded",{enumerable:!0,get:function(){return n.l}}),Object.defineProperty(n,"id",{enumerable:!0,get:function(){return n.i}}),n.webpackPolyfill=1),n}},function(n,e){var t=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,i=/^0o[0-7]+$/i,s=parseInt,o="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,c=o||l||Function("return this")(),d=Object.prototype.toString,u=Math.max,m=Math.min,p=function(){return c.Date.now()};function h(n){var e=typeof n;return!!n&&("object"==e||"function"==e)}function g(n){if("number"==typeof n)return n;if(function(n){return"symbol"==typeof n||function(n){return!!n&&"object"==typeof n}(n)&&"[object Symbol]"==d.call(n)}(n))return NaN;if(h(n)){var e="function"==typeof n.valueOf?n.valueOf():n;n=h(e)?e+"":e}if("string"!=typeof n)return 0===n?n:+n;n=n.replace(t,"");var o=r.test(n);return o||i.test(n)?s(n.slice(2),o?2:8):a.test(n)?NaN:+n}n.exports=function(n,e,t){var a,r,i,s,o,l,c=0,d=!1,f=!1,b=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function y(e){var t=a,i=r;return a=r=void 0,c=e,s=n.apply(i,t)}function v(n){return c=n,o=setTimeout(x,e),d?y(n):s}function _(n){var t=n-l;return void 0===l||t>=e||t<0||f&&n-c>=i}function x(){var n=p();if(_(n))return E(n);o=setTimeout(x,function(n){var t=e-(n-l);return f?m(t,i-(n-c)):t}(n))}function E(n){return o=void 0,b&&a?y(n):(a=r=void 0,s)}function T(){var n=p(),t=_(n);if(a=arguments,r=this,l=n,t){if(void 0===o)return v(l);if(f)return o=setTimeout(x,e),y(l)}return void 0===o&&(o=setTimeout(x,e)),s}return e=g(e)||0,h(t)&&(d=!!t.leading,i=(f="maxWait"in t)?u(g(t.maxWait)||0,e):i,b="trailing"in t?!!t.trailing:b),T.cancel=function(){void 0!==o&&clearTimeout(o),c=0,a=l=r=o=void 0},T.flush=function(){return void 0===o?s:E(p())},T}},function(n,e,t){var a=t(3),r=t(18),i=t(12),s=t(160),o=a("".replace),l="["+s+"]",c=RegExp("^"+l+l+"*"),d=RegExp(l+l+"*$"),u=function(n){return function(e){var t=i(r(e));return 1&n&&(t=o(t,c,"")),2&n&&(t=o(t,d,"")),t}};n.exports={start:u(1),end:u(2),trim:u(3)}},function(n,e){n.exports="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff"},function(n,e,t){var a=t(3),r=t(15),i=Date.prototype,s=a(i.toString),o=a(i.getTime);"Invalid Date"!=String(new Date(NaN))&&r(i,"toString",(function(){var n=o(this);return n==n?s(this):"Invalid Date"}))},function(n,e,t){var a=t(55);n.exports=a&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(n,e,t){var a=t(8),r=t(2);n.exports=a&&r((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(n,e,t){var a=t(8),r=t(2),i=t(90);n.exports=!a&&!r((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},function(n,e,t){var a=t(0),r=t(7),i=t(11),s=t(69),o=t(50),l=t(245),c=t(6),d=a.TypeError,u=c("toPrimitive");n.exports=function(n,e){if(!i(n)||s(n))return n;var t,a=o(n,u);if(a){if(void 0===e&&(e="default"),t=r(a,n,e),!i(t)||s(t))return t;throw d("Can't convert object to primitive value")}return void 0===e&&(e="number"),l(n,e)}},function(n,e,t){var a=t(3),r=t(9),i=t(21),s=t(121).indexOf,o=t(71),l=a([].push);n.exports=function(n,e){var t,a=i(n),c=0,d=[];for(t in a)!r(o,t)&&r(a,t)&&l(d,t);for(;e.length>c;)r(a,t=e[c++])&&(~s(d,t)||l(d,t));return d}},function(n,e,t){var a=t(14);n.exports=a("document","documentElement")},function(n,e,t){"use strict";var a=t(1),r=t(7),i=t(17),s=t(73),o=t(4),l=t(230),c=t(125),d=t(74),u=t(37),m=t(29),p=t(15),h=t(6),g=t(72),f=t(171),b=s.PROPER,y=s.CONFIGURABLE,v=f.IteratorPrototype,_=f.BUGGY_SAFARI_ITERATORS,x=h("iterator"),E=function(){return this};n.exports=function(n,e,t,s,h,f,T){l(t,e,s);var I,k,S,q=function(n){if(n===h&&L)return L;if(!_&&n in A)return A[n];switch(n){case"keys":case"values":case"entries":return function(){return new t(this,n)}}return function(){return new t(this)}},w=e+" Iterator",R=!1,A=n.prototype,z=A[x]||A["@@iterator"]||h&&A[h],L=!_&&z||q(h),M="Array"==e&&A.entries||z;if(M&&(I=c(M.call(new n)))!==Object.prototype&&I.next&&(i||c(I)===v||(d?d(I,v):o(I[x])||p(I,x,E)),u(I,w,!0,!0),i&&(g[w]=E)),b&&"values"==h&&z&&"values"!==z.name&&(!i&&y?m(A,"name","values"):(R=!0,L=function(){return r(z,this)})),h)if(k={values:q("values"),keys:f?L:q("keys"),entries:q("entries")},T)for(S in k)(_||R||!(S in A))&&p(A,S,k[S]);else a({target:e,proto:!0,forced:_||R},k);return i&&!T||A[x]===L||p(A,x,L,{name:h}),g[e]=L,k}},function(n,e,t){var a=t(2),r=t(4),i=t(9),s=t(8),o=t(73).CONFIGURABLE,l=t(95),c=t(39),d=c.enforce,u=c.get,m=Object.defineProperty,p=s&&!a((function(){return 8!==m((function(){}),"length",{value:8}).length})),h=String(String).split("String"),g=n.exports=function(n,e,t){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!i(n,"name")||o&&n.name!==e)&&m(n,"name",{value:e,configurable:!0}),p&&t&&i(t,"arity")&&n.length!==t.arity&&m(n,"length",{value:t.arity});try{t&&i(t,"constructor")&&t.constructor?s&&m(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch(n){}var a=d(n);return i(a,"source")||(a.source=h.join("string"==typeof e?e:"")),n};Function.prototype.toString=g((function(){return r(this)&&u(this).source||l(this)}),"toString")},function(n,e,t){var a=t(14),r=t(3),i=t(64),s=t(96),o=t(10),l=r([].concat);n.exports=a("Reflect","ownKeys")||function(n){var e=i.f(o(n)),t=s.f;return t?l(e,t(n)):e}},function(n,e,t){"use strict";var a,r,i,s=t(2),o=t(4),l=t(35),c=t(125),d=t(15),u=t(6),m=t(17),p=u("iterator"),h=!1;[].keys&&("next"in(i=[].keys())?(r=c(c(i)))!==Object.prototype&&(a=r):h=!0),null==a||s((function(){var n={};return a[p].call(n)!==n}))?a={}:m&&(a=l(a)),o(a[p])||d(a,p,(function(){return this})),n.exports={IteratorPrototype:a,BUGGY_SAFARI_ITERATORS:h}},function(n,e,t){var a=t(2);n.exports=!a((function(){function n(){}return n.prototype.constructor=null,Object.getPrototypeOf(new n)!==n.prototype}))},function(n,e,t){var a=t(0),r=t(98),i=t(70),s=a.TypeError;n.exports=function(n){if(r(n))return n;throw s(i(n)+" is not a constructor")}},function(n,e,t){var a,r,i,s,o=t(0),l=t(41),c=t(62),d=t(4),u=t(9),m=t(2),p=t(167),h=t(75),g=t(90),f=t(153),b=t(175),y=t(97),v=o.setImmediate,_=o.clearImmediate,x=o.process,E=o.Dispatch,T=o.Function,I=o.MessageChannel,k=o.String,S=0,q={};try{a=o.location}catch(n){}var w=function(n){if(u(q,n)){var e=q[n];delete q[n],e()}},R=function(n){return function(){w(n)}},A=function(n){w(n.data)},z=function(n){o.postMessage(k(n),a.protocol+"//"+a.host)};v&&_||(v=function(n){f(arguments.length,1);var e=d(n)?n:T(n),t=h(arguments,1);return q[++S]=function(){l(e,void 0,t)},r(S),S},_=function(n){delete q[n]},y?r=function(n){x.nextTick(R(n))}:E&&E.now?r=function(n){E.now(R(n))}:I&&!b?(s=(i=new I).port2,i.port1.onmessage=A,r=c(s.postMessage,s)):o.addEventListener&&d(o.postMessage)&&!o.importScripts&&a&&"file:"!==a.protocol&&!m(z)?(r=z,o.addEventListener("message",A,!1)):r="onreadystatechange"in g("script")?function(n){p.appendChild(g("script")).onreadystatechange=function(){p.removeChild(this),w(n)}}:function(n){setTimeout(R(n),0)}),n.exports={set:v,clear:_}},function(n,e,t){var a=t(31);n.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(a)},function(n,e,t){var a=t(0),r=t(62),i=t(7),s=t(10),o=t(70),l=t(177),c=t(20),d=t(36),u=t(154),m=t(113),p=t(178),h=a.TypeError,g=function(n,e){this.stopped=n,this.result=e},f=g.prototype;n.exports=function(n,e,t){var a,b,y,v,_,x,E,T=t&&t.that,I=!(!t||!t.AS_ENTRIES),k=!(!t||!t.IS_ITERATOR),S=!(!t||!t.INTERRUPTED),q=r(e,T),w=function(n){return a&&p(a,"normal",n),new g(!0,n)},R=function(n){return I?(s(n),S?q(n[0],n[1],w):q(n[0],n[1])):S?q(n,w):q(n)};if(k)a=n;else{if(!(b=m(n)))throw h(o(n)+" is not iterable");if(l(b)){for(y=0,v=c(n);v>y;y++)if((_=R(n[y]))&&d(f,_))return _;return new g(!1)}a=u(n,b)}for(x=a.next;!(E=i(x,a)).done;){try{_=R(E.value)}catch(n){p(a,"throw",n)}if("object"==typeof _&&_&&d(f,_))return _}return new g(!1)}},function(n,e,t){var a=t(6),r=t(72),i=a("iterator"),s=Array.prototype;n.exports=function(n){return void 0!==n&&(r.Array===n||s[i]===n)}},function(n,e,t){var a=t(7),r=t(10),i=t(50);n.exports=function(n,e,t){var s,o;r(n);try{if(!(s=i(n,"return"))){if("throw"===e)throw t;return t}s=a(s,n)}catch(n){o=!0,s=n}if("throw"===e)throw t;if(o)throw s;return r(s),t}},function(n,e,t){var a=t(58),r=t(180),i=t(76).CONSTRUCTOR;n.exports=i||!r((function(n){a.all(n).then(void 0,(function(){}))}))},function(n,e,t){var a=t(6)("iterator"),r=!1;try{var i=0,s={next:function(){return{done:!!i++}},return:function(){r=!0}};s[a]=function(){return this},Array.from(s,(function(){throw 2}))}catch(n){}n.exports=function(n,e){if(!e&&!r)return!1;var t=!1;try{var i={};i[a]=function(){return{next:function(){return{done:t=!0}}}},n(i)}catch(n){}return t}},function(n,e,t){var a=t(10),r=t(11),i=t(77);n.exports=function(n,e){if(a(n),r(e)&&e.constructor===n)return e;var t=i.f(n);return(0,t.resolve)(e),t.promise}},function(n,e,t){var a=t(28),r=t(21),i=t(64).f,s=t(129),o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];n.exports.f=function(n){return o&&"Window"==a(n)?function(n){try{return i(n)}catch(n){return s(o)}}(n):i(r(n))}},function(n,e,t){var a=t(6);e.f=a},function(n,e,t){var a=t(55);n.exports=a&&!!Symbol.for&&!!Symbol.keyFor},function(n,e,t){var a=t(3),r=t(48),i=t(12),s=t(18),o=a("".charAt),l=a("".charCodeAt),c=a("".slice),d=function(n){return function(e,t){var a,d,u=i(s(e)),m=r(t),p=u.length;return m<0||m>=p?n?"":void 0:(a=l(u,m))<55296||a>56319||m+1===p||(d=l(u,m+1))<56320||d>57343?n?o(u,m):a:n?c(u,m,m+2):d-56320+(a-55296<<10)+65536}};n.exports={codeAt:d(!1),charAt:d(!0)}},function(n,e){n.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(n,e,t){var a=t(90)("span").classList,r=a&&a.constructor&&a.constructor.prototype;n.exports=r===Object.prototype?void 0:r},function(n,e,t){var a=t(12);n.exports=function(n,e){return void 0===n?arguments.length<2?"":e:a(n)}},function(n,e,t){"use strict";var a=t(63).forEach,r=t(49)("forEach");n.exports=r?[].forEach:function(n){return a(this,n,arguments.length>1?arguments[1]:void 0)}},function(n,e,t){var a=t(0),r=t(156),i=a.TypeError;n.exports=function(n){if(r(n))throw i("The method doesn't accept regular expressions");return n}},function(n,e,t){var a=t(6)("match");n.exports=function(n){var e=/./;try{"/./"[n](e)}catch(t){try{return e[a]=!1,"/./"[n](e)}catch(n){}}return!1}},function(n,e,t){var a=t(2);n.exports=!a((function(){return Object.isExtensible(Object.preventExtensions({}))}))},function(n,e,t){var a=t(1),r=t(290);a({target:"Array",stat:!0,forced:!t(180)((function(n){Array.from(n)}))},{from:r})},function(n,e,t){"use strict";var a=t(10);n.exports=function(){var n=a(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.sticky&&(e+="y"),e}},function(n,e){n.exports=function(n,e){for(var t=-1,a=e.length,r=n.length;++t<a;)n[r+t]=e[t];return n}},function(n,e){var t="object"==typeof global&&global&&global.Object===Object&&global;n.exports=t},function(n,e,t){var a=t(103),r=t(306),i=t(307),s=t(308),o=t(309),l=t(310);function c(n){var e=this.__data__=new a(n);this.size=e.size}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=s,c.prototype.has=o,c.prototype.set=l,n.exports=c},function(n,e){n.exports=function(n,e){return n===e||n!=n&&e!=e}},function(n,e,t){var a=t(66),r=t(137);n.exports=function(n){if(!r(n))return!1;var e=a(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(n,e){var t=Function.prototype.toString;n.exports=function(n){if(null!=n){try{return t.call(n)}catch(n){}try{return n+""}catch(n){}}return""}},function(n,e,t){var a=t(327),r=t(53);n.exports=function n(e,t,i,s,o){return e===t||(null==e||null==t||!r(e)&&!r(t)?e!=e&&t!=t:a(e,t,i,s,n,o))}},function(n,e,t){var a=t(203),r=t(330),i=t(204);n.exports=function(n,e,t,s,o,l){var c=1&t,d=n.length,u=e.length;if(d!=u&&!(c&&u>d))return!1;var m=l.get(n),p=l.get(e);if(m&&p)return m==e&&p==n;var h=-1,g=!0,f=2&t?new a:void 0;for(l.set(n,e),l.set(e,n);++h<d;){var b=n[h],y=e[h];if(s)var v=c?s(y,b,h,e,n,l):s(b,y,h,n,e,l);if(void 0!==v){if(v)continue;g=!1;break}if(f){if(!r(e,(function(n,e){if(!i(f,e)&&(b===n||o(b,n,t,s,l)))return f.push(e)}))){g=!1;break}}else if(b!==y&&!o(b,y,t,s,l)){g=!1;break}}return l.delete(n),l.delete(e),g}},function(n,e,t){var a=t(138),r=t(328),i=t(329);function s(n){var e=-1,t=null==n?0:n.length;for(this.__data__=new a;++e<t;)this.add(n[e])}s.prototype.add=s.prototype.push=r,s.prototype.has=i,n.exports=s},function(n,e){n.exports=function(n,e){return n.has(e)}},function(n,e,t){var a=t(340),r=t(346),i=t(209);n.exports=function(n){return i(n)?a(n):r(n)}},function(n,e,t){(function(n){var a=t(32),r=t(342),i=e&&!e.nodeType&&e,s=i&&"object"==typeof n&&n&&!n.nodeType&&n,o=s&&s.exports===i?a.Buffer:void 0,l=(o?o.isBuffer:void 0)||r;n.exports=l}).call(this,t(157)(n))},function(n,e){var t=/^(?:0|[1-9]\d*)$/;n.exports=function(n,e){var a=typeof n;return!!(e=null==e?9007199254740991:e)&&("number"==a||"symbol"!=a&&t.test(n))&&n>-1&&n%1==0&&n<e}},function(n,e,t){var a=t(343),r=t(344),i=t(345),s=i&&i.isTypedArray,o=s?r(s):a;n.exports=o},function(n,e,t){var a=t(199),r=t(140);n.exports=function(n){return null!=n&&r(n.length)&&!a(n)}},function(n,e,t){var a=t(42)(t(32),"Set");n.exports=a},function(n,e,t){var a=t(137);n.exports=function(n){return n==n&&!a(n)}},function(n,e){n.exports=function(n,e){return function(t){return null!=t&&(t[n]===e&&(void 0!==e||n in Object(t)))}}},function(n,e,t){var a=t(214),r=t(107);n.exports=function(n,e){for(var t=0,i=(e=a(e,n)).length;null!=n&&t<i;)n=n[r(e[t++])];return t&&t==i?n:void 0}},function(n,e,t){var a=t(30),r=t(141),i=t(357),s=t(360);n.exports=function(n,e){return a(n)?n:r(n,e)?[n]:i(s(n))}},function(n,e,t){var a=t(0),r=t(41),i=t(4),s=t(31),o=t(75),l=t(153),c=/MSIE .\./.test(s),d=a.Function,u=function(n){return c?function(e,t){var a=l(arguments.length,1)>2,s=i(e)?e:d(e),c=a?o(arguments,2):void 0;return n(a?function(){r(s,this,c)}:s,t)}:n};n.exports={setTimeout:u(a.setTimeout),setInterval:u(a.setInterval)}},function(n,e,t){"use strict";var a=t(0),r=t(3),i=t(24),s=t(11),o=t(9),l=t(75),c=t(68),d=a.Function,u=r([].concat),m=r([].join),p={},h=function(n,e,t){if(!o(p,e)){for(var a=[],r=0;r<e;r++)a[r]="a["+r+"]";p[e]=d("C,a","return new C("+m(a,",")+")")}return p[e](n,t)};n.exports=c?d.bind:function(n){var e=i(this),t=e.prototype,a=l(arguments,1),r=function(){var t=u(a,l(arguments));return this instanceof r?h(e,t.length,t):e.apply(n,t)};return s(t)&&(r.prototype=t),r}},function(n,e,t){"use strict";var a=t(1),r=t(393).start;a({target:"String",proto:!0,forced:t(395)},{padStart:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}})},function(n,e,t){},function(n,e,t){},function(n,e,t){var a=t(1),r=t(14),i=t(41),s=t(216),o=t(173),l=t(10),c=t(11),d=t(35),u=t(2),m=r("Reflect","construct"),p=Object.prototype,h=[].push,g=u((function(){function n(){}return!(m((function(){}),[],n)instanceof n)})),f=!u((function(){m((function(){}))})),b=g||f;a({target:"Reflect",stat:!0,forced:b,sham:b},{construct:function(n,e){o(n),l(e);var t=arguments.length<3?n:o(arguments[2]);if(f&&!g)return m(n,e,t);if(n==t){switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3])}var a=[null];return i(h,a,e),new(i(s,n,a))}var r=t.prototype,u=d(c(r)?r:p),b=i(n,u,e);return c(b)?b:u}})},function(n,e,t){var a=t(1),r=t(0),i=t(37);a({global:!0},{Reflect:{}}),i(r.Reflect,"Reflect",!0)},function(n,e,t){},function(n,e,t){},function(n,e,t){var a=t(293),r=t(298),i=t(369),s=t(377),o=t(386),l=t(238),c=i((function(n){var e=l(n);return o(e)&&(e=void 0),s(a(n,1,o,!0),r(e,2))}));n.exports=c},function(n,e,t){"use strict";
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var a=/["'&<>]/;n.exports=function(n){var e,t=""+n,r=a.exec(t);if(!r)return t;var i="",s=0,o=0;for(s=r.index;s<t.length;s++){switch(t.charCodeAt(s)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}o!==s&&(i+=t.substring(o,s)),o=s+1,i+=e}return o!==s?i+t.substring(o,s):i}},function(n,e,t){"use strict";t.r(e);var a={name:"CodeBlock",props:{title:{type:String,required:!0},active:{type:Boolean,default:!1}}},r=(t(396),t(33)),i=Object(r.a)(a,(function(){var n=this.$createElement;return(this._self._c||n)("div",{staticClass:"theme-code-block",class:{"theme-code-block__active":this.active}},[this._t("default")],2)}),[],!1,null,"4f1e9d0c",null);e.default=i.exports},function(n,e,t){"use strict";t.r(e);t(26),t(5),t(27),t(46),t(34);var a={name:"CodeGroup",data:function(){return{codeTabs:[],activeCodeTabIndex:-1}},watch:{activeCodeTabIndex:function(n){this.codeTabs.forEach((function(n){n.elm.classList.remove("theme-code-block__active")})),this.codeTabs[n].elm.classList.add("theme-code-block__active")}},mounted:function(){var n=this;this.codeTabs=(this.$slots.default||[]).filter((function(n){return Boolean(n.componentOptions)})).map((function(e,t){return""===e.componentOptions.propsData.active&&(n.activeCodeTabIndex=t),{title:e.componentOptions.propsData.title,elm:e.elm}})),-1===this.activeCodeTabIndex&&this.codeTabs.length>0&&(this.activeCodeTabIndex=0)},methods:{changeCodeTab:function(n){this.activeCodeTabIndex=n}}},r=(t(397),t(33)),i=Object(r.a)(a,(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("div",{staticClass:"theme-code-group"},[t("div",{staticClass:"theme-code-group__nav"},[t("ul",{staticClass:"theme-code-group__ul"},n._l(n.codeTabs,(function(e,a){return t("li",{key:e.title,staticClass:"theme-code-group__li"},[t("button",{staticClass:"theme-code-group__nav-tab",class:{"theme-code-group__nav-tab-active":a===n.activeCodeTabIndex},on:{click:function(e){return n.changeCodeTab(a)}}},[n._v("\n            "+n._s(e.title)+"\n          ")])])})),0)]),n._v(" "),n._t("default"),n._v(" "),n.codeTabs.length<1?t("pre",{staticClass:"pre-blank"},[n._v("// Make sure to add code blocks to your code group")]):n._e()],2)}),[],!1,null,"2f5f1757",null);e.default=i.exports},function(n,e,t){"use strict";var a=t(8),r=t(0),i=t(3),s=t(112),o=t(15),l=t(9),c=t(155),d=t(36),u=t(69),m=t(165),p=t(2),h=t(64).f,g=t(40).f,f=t(13).f,b=t(392),y=t(159).trim,v=r.Number,_=v.prototype,x=r.TypeError,E=i("".slice),T=i("".charCodeAt),I=function(n){var e=m(n,"number");return"bigint"==typeof e?e:k(e)},k=function(n){var e,t,a,r,i,s,o,l,c=m(n,"number");if(u(c))throw x("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=y(c),43===(e=T(c,0))||45===e){if(88===(t=T(c,2))||120===t)return NaN}else if(48===e){switch(T(c,1)){case 66:case 98:a=2,r=49;break;case 79:case 111:a=8,r=55;break;default:return+c}for(s=(i=E(c,2)).length,o=0;o<s;o++)if((l=T(i,o))<48||l>r)return NaN;return parseInt(i,a)}return+c};if(s("Number",!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var S,q=function(n){var e=arguments.length<1?0:v(I(n)),t=this;return d(_,t)&&p((function(){b(t)}))?c(Object(e),t,q):e},w=a?h(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),R=0;w.length>R;R++)l(v,S=w[R])&&!l(q,S)&&f(q,S,g(v,S));q.prototype=_,_.constructor=q,o(r,"Number",q,{constructor:!0})}},function(n,e,t){var a=t(2),r=t(0).RegExp;n.exports=a((function(){var n=r(".","s");return!(n.dotAll&&n.exec("\n")&&"s"===n.flags)}))},function(n,e,t){"use strict";var a=t(171).IteratorPrototype,r=t(35),i=t(51),s=t(37),o=t(72),l=function(){return this};n.exports=function(n,e,t,c){var d=e+" Iterator";return n.prototype=r(a,{next:i(+!c,t)}),s(n,d,!1,!0),o[d]=l,n}},function(n,e,t){"use strict";var a=t(14),r=t(13),i=t(6),s=t(8),o=i("species");n.exports=function(n){var e=a(n),t=r.f;s&&e&&!e[o]&&t(e,o,{configurable:!0,get:function(){return this}})}},function(n,e,t){var a=t(0),r=t(36),i=a.TypeError;n.exports=function(n,e){if(r(e,n))return n;throw i("Incorrect invocation")}},function(n,e,t){var a=t(13).f;n.exports=function(n,e,t){t in n||a(n,t,{configurable:!0,get:function(){return e[t]},set:function(n){e[t]=n}})}},function(n,e,t){var a=t(1),r=t(8),i=t(170),s=t(21),o=t(40),l=t(59);a({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(n){for(var e,t,a=s(n),r=o.f,c=i(a),d={},u=0;c.length>u;)void 0!==(t=r(a,e=c[u++]))&&l(d,e,t);return d}})},function(n,e,t){var a=t(2),r=t(0).RegExp;n.exports=a((function(){var n=r("(?<a>b)","g");return"b"!==n.exec("b").groups.a||"bc"!=="b".replace(n,"$<a>c")}))},function(n,e,t){"use strict";var a=t(1),r=t(121).includes,i=t(2),s=t(149);a({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(n){return r(this,n,arguments.length>1?arguments[1]:void 0)}}),s("includes")},function(n,e,t){"use strict";var a=t(1),r=t(3),i=t(190),s=t(18),o=t(12),l=t(191),c=r("".indexOf);a({target:"String",proto:!0,forced:!l("includes")},{includes:function(n){return!!~c(o(s(this)),o(i(n)),arguments.length>1?arguments[1]:void 0)}})},function(n,e){n.exports=function(n){var e=null==n?0:n.length;return e?n[e-1]:void 0}},function(n,e,t){"use strict";var a=t(1),r=t(159).trim;a({target:"String",proto:!0,forced:t(391)("trim")},{trim:function(){return r(this)}})},function(n,e,t){var a=t(7),r=t(9),i=t(36),s=t(194),o=RegExp.prototype;n.exports=function(n){var e=n.flags;return void 0!==e||"flags"in o||r(n,"flags")||!i(o,n)?e:a(s,n)}},function(n,e,t){var a=t(129),r=Math.floor,i=function(n,e){var t=n.length,l=r(t/2);return t<8?s(n,e):o(n,i(a(n,0,l),e),i(a(n,l),e),e)},s=function(n,e){for(var t,a,r=n.length,i=1;i<r;){for(a=i,t=n[i];a&&e(n[a-1],t)>0;)n[a]=n[--a];a!==i++&&(n[a]=t)}return n},o=function(n,e,t,a){for(var r=e.length,i=t.length,s=0,o=0;s<r||o<i;)n[s+o]=s<r&&o<i?a(e[s],t[o])<=0?e[s++]:t[o++]:s<r?e[s++]:t[o++];return n};n.exports=i},function(n,e,t){var a=t(0),r=t(8),i=t(115).MISSED_STICKY,s=t(28),o=t(243),l=t(39).get,c=RegExp.prototype,d=a.TypeError;r&&i&&o(c,"sticky",{configurable:!0,get:function(){if(this!==c){if("RegExp"===s(this))return!!l(this).sticky;throw d("Incompatible receiver, RegExp required")}}})},function(n,e,t){var a=t(169),r=t(13);n.exports=function(n,e,t){return t.get&&a(t.get,e,{getter:!0}),t.set&&a(t.set,e,{setter:!0}),r.f(n,e,t)}},function(n,e,t){n.exports=t(407)},function(n,e,t){var a=t(0),r=t(7),i=t(4),s=t(11),o=a.TypeError;n.exports=function(n,e){var t,a;if("string"===e&&i(t=n.toString)&&!s(a=r(t,n)))return a;if(i(t=n.valueOf)&&!s(a=r(t,n)))return a;if("string"!==e&&i(t=n.toString)&&!s(a=r(t,n)))return a;throw o("Can't convert object to primitive value")}},function(n,e){var t=Math.ceil,a=Math.floor;n.exports=Math.trunc||function(n){var e=+n;return(e>0?a:t)(e)}},function(n,e,t){var a=t(0),r=t(4),i=t(95),s=a.WeakMap;n.exports=r(s)&&/native code/.test(i(s))},function(n,e,t){var a=t(0),r=t(4),i=a.String,s=a.TypeError;n.exports=function(n){if("object"==typeof n||r(n))return n;throw s("Can't set "+i(n)+" as a prototype")}},function(n,e,t){t(250),t(257),t(258),t(259),t(260),t(261)},function(n,e,t){"use strict";var a,r,i,s=t(1),o=t(17),l=t(97),c=t(0),d=t(7),u=t(15),m=t(74),p=t(37),h=t(231),g=t(24),f=t(4),b=t(11),y=t(232),v=t(126),_=t(174).set,x=t(251),E=t(254),T=t(128),I=t(255),k=t(39),S=t(58),q=t(76),w=t(77),R=q.CONSTRUCTOR,A=q.REJECTION_EVENT,z=q.SUBCLASSING,L=k.getterFor("Promise"),M=k.set,D=S&&S.prototype,B=S,O=D,C=c.TypeError,N=c.document,j=c.process,P=w.f,U=P,F=!!(N&&N.createEvent&&c.dispatchEvent),$=function(n){var e;return!(!b(n)||!f(e=n.then))&&e},G=function(n,e){var t,a,r,i=e.value,s=1==e.state,o=s?n.ok:n.fail,l=n.resolve,c=n.reject,u=n.domain;try{o?(s||(2===e.rejection&&W(e),e.rejection=1),!0===o?t=i:(u&&u.enter(),t=o(i),u&&(u.exit(),r=!0)),t===n.promise?c(C("Promise-chain cycle")):(a=$(t))?d(a,t,l,c):l(t)):c(i)}catch(n){u&&!r&&u.exit(),c(n)}},H=function(n,e){n.notified||(n.notified=!0,x((function(){for(var t,a=n.reactions;t=a.get();)G(t,n);n.notified=!1,e&&!n.rejection&&V(n)})))},Q=function(n,e,t){var a,r;F?((a=N.createEvent("Event")).promise=e,a.reason=t,a.initEvent(n,!1,!0),c.dispatchEvent(a)):a={promise:e,reason:t},!A&&(r=c["on"+n])?r(a):"unhandledrejection"===n&&E("Unhandled promise rejection",t)},V=function(n){d(_,c,(function(){var e,t=n.facade,a=n.value;if(K(n)&&(e=T((function(){l?j.emit("unhandledRejection",a,t):Q("unhandledrejection",t,a)})),n.rejection=l||K(n)?2:1,e.error))throw e.value}))},K=function(n){return 1!==n.rejection&&!n.parent},W=function(n){d(_,c,(function(){var e=n.facade;l?j.emit("rejectionHandled",e):Q("rejectionhandled",e,n.value)}))},J=function(n,e,t){return function(a){n(e,a,t)}},X=function(n,e,t){n.done||(n.done=!0,t&&(n=t),n.value=e,n.state=2,H(n,!0))},Y=function(n,e,t){if(!n.done){n.done=!0,t&&(n=t);try{if(n.facade===e)throw C("Promise can't be resolved itself");var a=$(e);a?x((function(){var t={done:!1};try{d(a,e,J(Y,t,n),J(X,t,n))}catch(e){X(t,e,n)}})):(n.value=e,n.state=1,H(n,!1))}catch(e){X({done:!1},e,n)}}};if(R&&(O=(B=function(n){y(this,O),g(n),d(a,this);var e=L(this);try{n(J(Y,e),J(X,e))}catch(n){X(e,n)}}).prototype,(a=function(n){M(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new I,rejection:!1,state:0,value:void 0})}).prototype=u(O,"then",(function(n,e){var t=L(this),a=P(v(this,B));return t.parent=!0,a.ok=!f(n)||n,a.fail=f(e)&&e,a.domain=l?j.domain:void 0,0==t.state?t.reactions.add(a):x((function(){G(a,t)})),a.promise})),r=function(){var n=new a,e=L(n);this.promise=n,this.resolve=J(Y,e),this.reject=J(X,e)},w.f=P=function(n){return n===B||void 0===n?new r(n):U(n)},!o&&f(S)&&D!==Object.prototype)){i=D.then,z||u(D,"then",(function(n,e){var t=this;return new B((function(n,e){d(i,t,n,e)})).then(n,e)}),{unsafe:!0});try{delete D.constructor}catch(n){}m&&m(D,O)}s({global:!0,constructor:!0,wrap:!0,forced:R},{Promise:B}),p(B,"Promise",!1,!0),h("Promise")},function(n,e,t){var a,r,i,s,o,l,c,d,u=t(0),m=t(62),p=t(40).f,h=t(174).set,g=t(175),f=t(252),b=t(253),y=t(97),v=u.MutationObserver||u.WebKitMutationObserver,_=u.document,x=u.process,E=u.Promise,T=p(u,"queueMicrotask"),I=T&&T.value;I||(a=function(){var n,e;for(y&&(n=x.domain)&&n.exit();r;){e=r.fn,r=r.next;try{e()}catch(n){throw r?s():i=void 0,n}}i=void 0,n&&n.enter()},g||y||b||!v||!_?!f&&E&&E.resolve?((c=E.resolve(void 0)).constructor=E,d=m(c.then,c),s=function(){d(a)}):y?s=function(){x.nextTick(a)}:(h=m(h,u),s=function(){h(a)}):(o=!0,l=_.createTextNode(""),new v(a).observe(l,{characterData:!0}),s=function(){l.data=o=!o})),n.exports=I||function(n){var e={fn:n,next:void 0};i&&(i.next=e),r||(r=e,s()),i=e}},function(n,e,t){var a=t(31),r=t(0);n.exports=/ipad|iphone|ipod/i.test(a)&&void 0!==r.Pebble},function(n,e,t){var a=t(31);n.exports=/web0s(?!.*chrome)/i.test(a)},function(n,e,t){var a=t(0);n.exports=function(n,e){var t=a.console;t&&t.error&&(1==arguments.length?t.error(n):t.error(n,e))}},function(n,e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(n){var e={item:n,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var n=this.head;if(n)return this.head=n.next,this.tail===n&&(this.tail=null),n.item}},n.exports=t},function(n,e){n.exports="object"==typeof window&&"object"!=typeof Deno},function(n,e,t){"use strict";var a=t(1),r=t(7),i=t(24),s=t(77),o=t(128),l=t(176);a({target:"Promise",stat:!0,forced:t(179)},{all:function(n){var e=this,t=s.f(e),a=t.resolve,c=t.reject,d=o((function(){var t=i(e.resolve),s=[],o=0,d=1;l(n,(function(n){var i=o++,l=!1;d++,r(t,e,n).then((function(n){l||(l=!0,s[i]=n,--d||a(s))}),c)})),--d||a(s)}));return d.error&&c(d.value),t.promise}})},function(n,e,t){"use strict";var a=t(1),r=t(17),i=t(76).CONSTRUCTOR,s=t(58),o=t(14),l=t(4),c=t(15),d=s&&s.prototype;if(a({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(n){return this.then(void 0,n)}}),!r&&l(s)){var u=o("Promise").prototype.catch;d.catch!==u&&c(d,"catch",u,{unsafe:!0})}},function(n,e,t){"use strict";var a=t(1),r=t(7),i=t(24),s=t(77),o=t(128),l=t(176);a({target:"Promise",stat:!0,forced:t(179)},{race:function(n){var e=this,t=s.f(e),a=t.reject,c=o((function(){var s=i(e.resolve);l(n,(function(n){r(s,e,n).then(t.resolve,a)}))}));return c.error&&a(c.value),t.promise}})},function(n,e,t){"use strict";var a=t(1),r=t(7),i=t(77);a({target:"Promise",stat:!0,forced:t(76).CONSTRUCTOR},{reject:function(n){var e=i.f(this);return r(e.reject,void 0,n),e.promise}})},function(n,e,t){"use strict";var a=t(1),r=t(14),i=t(17),s=t(58),o=t(76).CONSTRUCTOR,l=t(181),c=r("Promise"),d=i&&!o;a({target:"Promise",stat:!0,forced:i||o},{resolve:function(n){return l(d&&this===c?s:this,n)}})},function(n,e,t){var a=t(1),r=t(263);a({target:"Object",stat:!0,arity:2,forced:Object.assign!==r},{assign:r})},function(n,e,t){"use strict";var a=t(8),r=t(3),i=t(7),s=t(2),o=t(92),l=t(96),c=t(123),d=t(16),u=t(67),m=Object.assign,p=Object.defineProperty,h=r([].concat);n.exports=!m||s((function(){if(a&&1!==m({b:1},m(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var n={},e={},t=Symbol();return n[t]=7,"abcdefghijklmnopqrst".split("").forEach((function(n){e[n]=n})),7!=m({},n)[t]||"abcdefghijklmnopqrst"!=o(m({},e)).join("")}))?function(n,e){for(var t=d(n),r=arguments.length,s=1,m=l.f,p=c.f;r>s;)for(var g,f=u(arguments[s++]),b=m?h(o(f),m(f)):o(f),y=b.length,v=0;y>v;)g=b[v++],a&&!i(p,f,g)||(t[g]=f[g]);return t}:m},function(n,e,t){"use strict";var a=t(1),r=t(17),i=t(58),s=t(2),o=t(14),l=t(4),c=t(126),d=t(181),u=t(15),m=i&&i.prototype;if(a({target:"Promise",proto:!0,real:!0,forced:!!i&&s((function(){m.finally.call({then:function(){}},(function(){}))}))},{finally:function(n){var e=c(this,o("Promise")),t=l(n);return this.then(t?function(t){return d(e,n()).then((function(){return t}))}:n,t?function(t){return d(e,n()).then((function(){throw t}))}:n)}}),!r&&l(i)){var p=o("Promise").prototype.finally;m.finally!==p&&u(m,"finally",p,{unsafe:!0})}},function(n,e,t){"use strict";var a=t(1),r=t(0),i=t(7),s=t(3),o=t(17),l=t(8),c=t(55),d=t(2),u=t(9),m=t(36),p=t(10),h=t(21),g=t(91),f=t(12),b=t(51),y=t(35),v=t(92),_=t(64),x=t(182),E=t(96),T=t(40),I=t(13),k=t(152),S=t(123),q=t(15),w=t(54),R=t(94),A=t(71),z=t(89),L=t(6),M=t(183),D=t(99),B=t(267),O=t(37),C=t(39),N=t(63).forEach,j=R("hidden"),P=C.set,U=C.getterFor("Symbol"),F=Object.prototype,$=r.Symbol,G=$&&$.prototype,H=r.TypeError,Q=r.QObject,V=T.f,K=I.f,W=x.f,J=S.f,X=s([].push),Y=w("symbols"),Z=w("op-symbols"),nn=w("wks"),en=!Q||!Q.prototype||!Q.prototype.findChild,tn=l&&d((function(){return 7!=y(K({},"a",{get:function(){return K(this,"a",{value:7}).a}})).a}))?function(n,e,t){var a=V(F,e);a&&delete F[e],K(n,e,t),a&&n!==F&&K(F,e,a)}:K,an=function(n,e){var t=Y[n]=y(G);return P(t,{type:"Symbol",tag:n,description:e}),l||(t.description=e),t},rn=function(n,e,t){n===F&&rn(Z,e,t),p(n);var a=g(e);return p(t),u(Y,a)?(t.enumerable?(u(n,j)&&n[j][a]&&(n[j][a]=!1),t=y(t,{enumerable:b(0,!1)})):(u(n,j)||K(n,j,b(1,{})),n[j][a]=!0),tn(n,a,t)):K(n,a,t)},sn=function(n,e){p(n);var t=h(e),a=v(t).concat(dn(t));return N(a,(function(e){l&&!i(on,t,e)||rn(n,e,t[e])})),n},on=function(n){var e=g(n),t=i(J,this,e);return!(this===F&&u(Y,e)&&!u(Z,e))&&(!(t||!u(this,e)||!u(Y,e)||u(this,j)&&this[j][e])||t)},ln=function(n,e){var t=h(n),a=g(e);if(t!==F||!u(Y,a)||u(Z,a)){var r=V(t,a);return!r||!u(Y,a)||u(t,j)&&t[j][a]||(r.enumerable=!0),r}},cn=function(n){var e=W(h(n)),t=[];return N(e,(function(n){u(Y,n)||u(A,n)||X(t,n)})),t},dn=function(n){var e=n===F,t=W(e?Z:h(n)),a=[];return N(t,(function(n){!u(Y,n)||e&&!u(F,n)||X(a,Y[n])})),a};c||(q(G=($=function(){if(m(G,this))throw H("Symbol is not a constructor");var n=arguments.length&&void 0!==arguments[0]?f(arguments[0]):void 0,e=z(n),t=function(n){this===F&&i(t,Z,n),u(this,j)&&u(this[j],e)&&(this[j][e]=!1),tn(this,e,b(1,n))};return l&&en&&tn(F,e,{configurable:!0,set:t}),an(e,n)}).prototype,"toString",(function(){return U(this).tag})),q($,"withoutSetter",(function(n){return an(z(n),n)})),S.f=on,I.f=rn,k.f=sn,T.f=ln,_.f=x.f=cn,E.f=dn,M.f=function(n){return an(L(n),n)},l&&(K(G,"description",{configurable:!0,get:function(){return U(this).description}}),o||q(F,"propertyIsEnumerable",on,{unsafe:!0}))),a({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:$}),N(v(nn),(function(n){D(n)})),a({target:"Symbol",stat:!0,forced:!c},{useSetter:function(){en=!0},useSimple:function(){en=!1}}),a({target:"Object",stat:!0,forced:!c,sham:!l},{create:function(n,e){return void 0===e?y(n):sn(y(n),e)},defineProperty:rn,defineProperties:sn,getOwnPropertyDescriptor:ln}),a({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:cn}),B(),O($,"Symbol"),A[j]=!0},function(n,e,t){var a=t(0);n.exports=a},function(n,e,t){var a=t(7),r=t(14),i=t(6),s=t(15);n.exports=function(){var n=r("Symbol"),e=n&&n.prototype,t=e&&e.valueOf,o=i("toPrimitive");e&&!e[o]&&s(e,o,(function(n){return a(t,this)}),{arity:1})}},function(n,e,t){var a=t(0),r=t(52),i=t(98),s=t(11),o=t(6)("species"),l=a.Array;n.exports=function(n){var e;return r(n)&&(e=n.constructor,(i(e)&&(e===l||r(e.prototype))||s(e)&&null===(e=e[o]))&&(e=void 0)),void 0===e?l:e}},function(n,e,t){var a=t(1),r=t(14),i=t(9),s=t(12),o=t(54),l=t(184),c=o("string-to-symbol-registry"),d=o("symbol-to-string-registry");a({target:"Symbol",stat:!0,forced:!l},{for:function(n){var e=s(n);if(i(c,e))return c[e];var t=r("Symbol")(e);return c[e]=t,d[t]=e,t}})},function(n,e,t){var a=t(1),r=t(9),i=t(69),s=t(70),o=t(54),l=t(184),c=o("symbol-to-string-registry");a({target:"Symbol",stat:!0,forced:!l},{keyFor:function(n){if(!i(n))throw TypeError(s(n)+" is not a symbol");if(r(c,n))return c[n]}})},function(n,e,t){var a=t(1),r=t(55),i=t(2),s=t(96),o=t(16);a({target:"Object",stat:!0,forced:!r||i((function(){s.f(1)}))},{getOwnPropertySymbols:function(n){var e=s.f;return e?e(o(n)):[]}})},function(n,e,t){"use strict";var a=t(127),r=t(86);n.exports=a?{}.toString:function(){return"[object "+r(this)+"]"}},function(n,e,t){t(99)("asyncIterator")},function(n,e,t){var a=t(14),r=t(99),i=t(37);r("toStringTag"),i(a("Symbol"),"Symbol")},function(n,e,t){var a=t(0);t(37)(a.JSON,"JSON",!0)},function(n,e,t){t(37)(Math,"Math",!0)},function(n,e,t){"use strict";var a=t(14),r=t(9),i=t(29),s=t(36),o=t(74),l=t(124),c=t(233),d=t(155),u=t(188),m=t(278),p=t(279),h=t(280),g=t(8),f=t(17);n.exports=function(n,e,t,b){var y=b?2:1,v=n.split("."),_=v[v.length-1],x=a.apply(null,v);if(x){var E=x.prototype;if(!f&&r(E,"cause")&&delete E.cause,!t)return x;var T=a("Error"),I=e((function(n,e){var t=u(b?e:n,void 0),a=b?new x(n):new x;return void 0!==t&&i(a,"message",t),h&&i(a,"stack",p(a.stack,2)),this&&s(E,this)&&d(a,this,I),arguments.length>y&&m(a,arguments[y]),a}));if(I.prototype=E,"Error"!==_?o?o(I,T):l(I,T,{name:!0}):g&&"stackTraceLimit"in x&&(c(I,x,"stackTraceLimit"),c(I,x,"prepareStackTrace")),l(I,x),!f)try{E.name!==_&&i(E,"name",_),E.constructor=I}catch(n){}return I}}},function(n,e,t){var a=t(11),r=t(29);n.exports=function(n,e){a(e)&&"cause"in e&&r(n,"cause",e.cause)}},function(n,e,t){var a=t(3),r=Error,i=a("".replace),s=String(r("zxcasd").stack),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(s);n.exports=function(n,e){if(l&&"string"==typeof n&&!r.prepareStackTrace)for(;e--;)n=i(n,o,"");return n}},function(n,e,t){var a=t(2),r=t(51);n.exports=!a((function(){var n=Error("a");return!("stack"in n)||(Object.defineProperty(n,"stack",r(1,7)),7!==n.stack)}))},function(n,e,t){"use strict";var a=t(8),r=t(2),i=t(10),s=t(35),o=t(188),l=Error.prototype.toString,c=r((function(){if(a){var n=s(Object.defineProperty({},"name",{get:function(){return this===n}}));if("true"!==l.call(n))return!0}return"2: 1"!==l.call({message:1,name:2})||"Error"!==l.call({})}));n.exports=c?function(){var n=i(this),e=o(n.name,"Error"),t=o(n.message);return e?t?e+": "+t:e:t}:l},function(n,e,t){"use strict";var a=t(1),r=t(3),i=t(52),s=r([].reverse),o=[1,2];a({target:"Array",proto:!0,forced:String(o)===String(o.reverse())},{reverse:function(){return i(this)&&(this.length=this.length),s(this)}})},function(n,e,t){"use strict";var a=t(1),r=t(284).left,i=t(49),s=t(56),o=t(97);a({target:"Array",proto:!0,forced:!i("reduce")||!o&&s>79&&s<83},{reduce:function(n){var e=arguments.length;return r(this,n,e,e>1?arguments[1]:void 0)}})},function(n,e,t){var a=t(0),r=t(24),i=t(16),s=t(67),o=t(20),l=a.TypeError,c=function(n){return function(e,t,a,c){r(t);var d=i(e),u=s(d),m=o(d),p=n?m-1:0,h=n?-1:1;if(a<2)for(;;){if(p in u){c=u[p],p+=h;break}if(p+=h,n?p<0:m<=p)throw l("Reduce of empty array with no initial value")}for(;n?p>=0:m>p;p+=h)p in u&&(c=t(c,u[p],p,d));return c}};n.exports={left:c(!1),right:c(!0)}},function(n,e,t){"use strict";var a,r=t(1),i=t(3),s=t(40).f,o=t(57),l=t(12),c=t(190),d=t(18),u=t(191),m=t(17),p=i("".startsWith),h=i("".slice),g=Math.min,f=u("startsWith");r({target:"String",proto:!0,forced:!!(m||f||(a=s(String.prototype,"startsWith"),!a||a.writable))&&!f},{startsWith:function(n){var e=l(d(this));c(n);var t=o(g(arguments.length>1?arguments[1]:void 0,e.length)),a=l(n);return p?p(e,a,t):h(e,t,t+a.length)===a}})},function(n,e,t){var a=t(1),r=t(192),i=t(2),s=t(11),o=t(287).onFreeze,l=Object.freeze;a({target:"Object",stat:!0,forced:i((function(){l(1)})),sham:!r},{freeze:function(n){return l&&s(n)?l(o(n)):n}})},function(n,e,t){var a=t(1),r=t(3),i=t(71),s=t(11),o=t(9),l=t(13).f,c=t(64),d=t(182),u=t(288),m=t(89),p=t(192),h=!1,g=m("meta"),f=0,b=function(n){l(n,g,{value:{objectID:"O"+f++,weakData:{}}})},y=n.exports={enable:function(){y.enable=function(){},h=!0;var n=c.f,e=r([].splice),t={};t[g]=1,n(t).length&&(c.f=function(t){for(var a=n(t),r=0,i=a.length;r<i;r++)if(a[r]===g){e(a,r,1);break}return a},a({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:d.f}))},fastKey:function(n,e){if(!s(n))return"symbol"==typeof n?n:("string"==typeof n?"S":"P")+n;if(!o(n,g)){if(!u(n))return"F";if(!e)return"E";b(n)}return n[g].objectID},getWeakData:function(n,e){if(!o(n,g)){if(!u(n))return!0;if(!e)return!1;b(n)}return n[g].weakData},onFreeze:function(n){return p&&h&&u(n)&&!o(n,g)&&b(n),n}};i[g]=!0},function(n,e,t){var a=t(2),r=t(11),i=t(28),s=t(289),o=Object.isExtensible,l=a((function(){o(1)}));n.exports=l||s?function(n){return!!r(n)&&((!s||"ArrayBuffer"!=i(n))&&(!o||o(n)))}:o},function(n,e,t){var a=t(2);n.exports=a((function(){if("function"==typeof ArrayBuffer){var n=new ArrayBuffer(8);Object.isExtensible(n)&&Object.defineProperty(n,"a",{value:8})}}))},function(n,e,t){"use strict";var a=t(0),r=t(62),i=t(7),s=t(16),o=t(291),l=t(177),c=t(98),d=t(20),u=t(59),m=t(154),p=t(113),h=a.Array;n.exports=function(n){var e=s(n),t=c(this),a=arguments.length,g=a>1?arguments[1]:void 0,f=void 0!==g;f&&(g=r(g,a>2?arguments[2]:void 0));var b,y,v,_,x,E,T=p(e),I=0;if(!T||this==h&&l(T))for(b=d(e),y=t?new this(b):h(b);b>I;I++)E=f?g(e[I],I):e[I],u(y,I,E);else for(x=(_=m(e,T)).next,y=t?new this:[];!(v=i(x,_)).done;I++)E=f?o(_,g,[v.value,I],!0):v.value,u(y,I,E);return y.length=I,y}},function(n,e,t){var a=t(10),r=t(178);n.exports=function(n,e,t,i){try{return i?e(a(t)[0],t[1]):e(t)}catch(e){r(n,"throw",e)}}},function(n,e,t){var a=t(3),r=t(16),i=Math.floor,s=a("".charAt),o=a("".replace),l=a("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;n.exports=function(n,e,t,a,u,m){var p=t+n.length,h=a.length,g=d;return void 0!==u&&(u=r(u),g=c),o(m,g,(function(r,o){var c;switch(s(o,0)){case"$":return"$";case"&":return n;case"`":return l(e,0,t);case"'":return l(e,p);case"<":c=u[l(o,1,-1)];break;default:var d=+o;if(0===d)return r;if(d>h){var m=i(d/10);return 0===m?r:m<=h?void 0===a[m-1]?s(o,1):a[m-1]+s(o,1):r}c=a[d-1]}return void 0===c?"":c}))}},function(n,e,t){var a=t(195),r=t(294);n.exports=function n(e,t,i,s,o){var l=-1,c=e.length;for(i||(i=r),o||(o=[]);++l<c;){var d=e[l];t>0&&i(d)?t>1?n(d,t-1,i,s,o):a(o,d):s||(o[o.length]=d)}return o}},function(n,e,t){var a=t(80),r=t(135),i=t(30),s=a?a.isConcatSpreadable:void 0;n.exports=function(n){return i(n)||r(n)||!!(s&&n&&n[s])}},function(n,e,t){var a=t(66),r=t(53);n.exports=function(n){return r(n)&&"[object Arguments]"==a(n)}},function(n,e,t){var a=t(80),r=Object.prototype,i=r.hasOwnProperty,s=r.toString,o=a?a.toStringTag:void 0;n.exports=function(n){var e=i.call(n,o),t=n[o];try{n[o]=void 0;var a=!0}catch(n){}var r=s.call(n);return a&&(e?n[o]=t:delete n[o]),r}},function(n,e){var t=Object.prototype.toString;n.exports=function(n){return t.call(n)}},function(n,e,t){var a=t(299),r=t(355),i=t(143),s=t(30),o=t(366);n.exports=function(n){return"function"==typeof n?n:null==n?i:"object"==typeof n?s(n)?r(n[0],n[1]):a(n):o(n)}},function(n,e,t){var a=t(300),r=t(354),i=t(212);n.exports=function(n){var e=r(n);return 1==e.length&&e[0][2]?i(e[0][0],e[0][1]):function(t){return t===n||a(t,n,e)}}},function(n,e,t){var a=t(197),r=t(201);n.exports=function(n,e,t,i){var s=t.length,o=s,l=!i;if(null==n)return!o;for(n=Object(n);s--;){var c=t[s];if(l&&c[2]?c[1]!==n[c[0]]:!(c[0]in n))return!1}for(;++s<o;){var d=(c=t[s])[0],u=n[d],m=c[1];if(l&&c[2]){if(void 0===u&&!(d in n))return!1}else{var p=new a;if(i)var h=i(u,m,d,n,e,p);if(!(void 0===h?r(m,u,3,i,p):h))return!1}}return!0}},function(n,e){n.exports=function(){this.__data__=[],this.size=0}},function(n,e,t){var a=t(104),r=Array.prototype.splice;n.exports=function(n){var e=this.__data__,t=a(e,n);return!(t<0)&&(t==e.length-1?e.pop():r.call(e,t,1),--this.size,!0)}},function(n,e,t){var a=t(104);n.exports=function(n){var e=this.__data__,t=a(e,n);return t<0?void 0:e[t][1]}},function(n,e,t){var a=t(104);n.exports=function(n){return a(this.__data__,n)>-1}},function(n,e,t){var a=t(104);n.exports=function(n,e){var t=this.__data__,r=a(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}},function(n,e,t){var a=t(103);n.exports=function(){this.__data__=new a,this.size=0}},function(n,e){n.exports=function(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}},function(n,e){n.exports=function(n){return this.__data__.get(n)}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e,t){var a=t(103),r=t(136),i=t(138);n.exports=function(n,e){var t=this.__data__;if(t instanceof a){var s=t.__data__;if(!r||s.length<199)return s.push([n,e]),this.size=++t.size,this;t=this.__data__=new i(s)}return t.set(n,e),this.size=t.size,this}},function(n,e,t){var a=t(199),r=t(312),i=t(137),s=t(200),o=/^\[object .+?Constructor\]$/,l=Function.prototype,c=Object.prototype,d=l.toString,u=c.hasOwnProperty,m=RegExp("^"+d.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");n.exports=function(n){return!(!i(n)||r(n))&&(a(n)?m:o).test(s(n))}},function(n,e,t){var a,r=t(313),i=(a=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";n.exports=function(n){return!!i&&i in n}},function(n,e,t){var a=t(32)["__core-js_shared__"];n.exports=a},function(n,e){n.exports=function(n,e){return null==n?void 0:n[e]}},function(n,e,t){var a=t(316),r=t(103),i=t(136);n.exports=function(){this.size=0,this.__data__={hash:new a,map:new(i||r),string:new a}}},function(n,e,t){var a=t(317),r=t(318),i=t(319),s=t(320),o=t(321);function l(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var a=n[e];this.set(a[0],a[1])}}l.prototype.clear=a,l.prototype.delete=r,l.prototype.get=i,l.prototype.has=s,l.prototype.set=o,n.exports=l},function(n,e,t){var a=t(105);n.exports=function(){this.__data__=a?a(null):{},this.size=0}},function(n,e){n.exports=function(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}},function(n,e,t){var a=t(105),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;if(a){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return r.call(e,n)?e[n]:void 0}},function(n,e,t){var a=t(105),r=Object.prototype.hasOwnProperty;n.exports=function(n){var e=this.__data__;return a?void 0!==e[n]:r.call(e,n)}},function(n,e,t){var a=t(105);n.exports=function(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=a&&void 0===e?"__lodash_hash_undefined__":e,this}},function(n,e,t){var a=t(106);n.exports=function(n){var e=a(this,n).delete(n);return this.size-=e?1:0,e}},function(n,e){n.exports=function(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}},function(n,e,t){var a=t(106);n.exports=function(n){return a(this,n).get(n)}},function(n,e,t){var a=t(106);n.exports=function(n){return a(this,n).has(n)}},function(n,e,t){var a=t(106);n.exports=function(n,e){var t=a(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}},function(n,e,t){var a=t(197),r=t(202),i=t(331),s=t(334),o=t(350),l=t(30),c=t(206),d=t(208),u="[object Object]",m=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,p,h,g){var f=l(n),b=l(e),y=f?"[object Array]":o(n),v=b?"[object Array]":o(e),_=(y="[object Arguments]"==y?u:y)==u,x=(v="[object Arguments]"==v?u:v)==u,E=y==v;if(E&&c(n)){if(!c(e))return!1;f=!0,_=!1}if(E&&!_)return g||(g=new a),f||d(n)?r(n,e,t,p,h,g):i(n,e,y,t,p,h,g);if(!(1&t)){var T=_&&m.call(n,"__wrapped__"),I=x&&m.call(e,"__wrapped__");if(T||I){var k=T?n.value():n,S=I?e.value():e;return g||(g=new a),h(k,S,t,p,g)}}return!!E&&(g||(g=new a),s(n,e,t,p,h,g))}},function(n,e){n.exports=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this}},function(n,e){n.exports=function(n){return this.__data__.has(n)}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length;++t<a;)if(e(n[t],t,n))return!0;return!1}},function(n,e,t){var a=t(80),r=t(332),i=t(198),s=t(202),o=t(333),l=t(139),c=a?a.prototype:void 0,d=c?c.valueOf:void 0;n.exports=function(n,e,t,a,c,u,m){switch(t){case"[object DataView]":if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=e.byteLength||!u(new r(n),new r(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return i(+n,+e);case"[object Error]":return n.name==e.name&&n.message==e.message;case"[object RegExp]":case"[object String]":return n==e+"";case"[object Map]":var p=o;case"[object Set]":var h=1&a;if(p||(p=l),n.size!=e.size&&!h)return!1;var g=m.get(n);if(g)return g==e;a|=2,m.set(n,e);var f=s(p(n),p(e),a,c,u,m);return m.delete(n),f;case"[object Symbol]":if(d)return d.call(n)==d.call(e)}return!1}},function(n,e,t){var a=t(32).Uint8Array;n.exports=a},function(n,e){n.exports=function(n){var e=-1,t=Array(n.size);return n.forEach((function(n,a){t[++e]=[a,n]})),t}},function(n,e,t){var a=t(335),r=Object.prototype.hasOwnProperty;n.exports=function(n,e,t,i,s,o){var l=1&t,c=a(n),d=c.length;if(d!=a(e).length&&!l)return!1;for(var u=d;u--;){var m=c[u];if(!(l?m in e:r.call(e,m)))return!1}var p=o.get(n),h=o.get(e);if(p&&h)return p==e&&h==n;var g=!0;o.set(n,e),o.set(e,n);for(var f=l;++u<d;){var b=n[m=c[u]],y=e[m];if(i)var v=l?i(y,b,m,e,n,o):i(b,y,m,n,e,o);if(!(void 0===v?b===y||s(b,y,t,i,o):v)){g=!1;break}f||(f="constructor"==m)}if(g&&!f){var _=n.constructor,x=e.constructor;_==x||!("constructor"in n)||!("constructor"in e)||"function"==typeof _&&_ instanceof _&&"function"==typeof x&&x instanceof x||(g=!1)}return o.delete(n),o.delete(e),g}},function(n,e,t){var a=t(336),r=t(337),i=t(205);n.exports=function(n){return a(n,i,r)}},function(n,e,t){var a=t(195),r=t(30);n.exports=function(n,e,t){var i=e(n);return r(n)?i:a(i,t(n))}},function(n,e,t){var a=t(338),r=t(339),i=Object.prototype.propertyIsEnumerable,s=Object.getOwnPropertySymbols,o=s?function(n){return null==n?[]:(n=Object(n),a(s(n),(function(e){return i.call(n,e)})))}:r;n.exports=o},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,r=0,i=[];++t<a;){var s=n[t];e(s,t,n)&&(i[r++]=s)}return i}},function(n,e){n.exports=function(){return[]}},function(n,e,t){var a=t(341),r=t(135),i=t(30),s=t(206),o=t(207),l=t(208),c=Object.prototype.hasOwnProperty;n.exports=function(n,e){var t=i(n),d=!t&&r(n),u=!t&&!d&&s(n),m=!t&&!d&&!u&&l(n),p=t||d||u||m,h=p?a(n.length,String):[],g=h.length;for(var f in n)!e&&!c.call(n,f)||p&&("length"==f||u&&("offset"==f||"parent"==f)||m&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||o(f,g))||h.push(f);return h}},function(n,e){n.exports=function(n,e){for(var t=-1,a=Array(n);++t<n;)a[t]=e(t);return a}},function(n,e){n.exports=function(){return!1}},function(n,e,t){var a=t(66),r=t(140),i=t(53),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,n.exports=function(n){return i(n)&&r(n.length)&&!!s[a(n)]}},function(n,e){n.exports=function(n){return function(e){return n(e)}}},function(n,e,t){(function(n){var a=t(196),r=e&&!e.nodeType&&e,i=r&&"object"==typeof n&&n&&!n.nodeType&&n,s=i&&i.exports===r&&a.process,o=function(){try{var n=i&&i.require&&i.require("util").types;return n||s&&s.binding&&s.binding("util")}catch(n){}}();n.exports=o}).call(this,t(157)(n))},function(n,e,t){var a=t(347),r=t(348),i=Object.prototype.hasOwnProperty;n.exports=function(n){if(!a(n))return r(n);var e=[];for(var t in Object(n))i.call(n,t)&&"constructor"!=t&&e.push(t);return e}},function(n,e){var t=Object.prototype;n.exports=function(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||t)}},function(n,e,t){var a=t(349)(Object.keys,Object);n.exports=a},function(n,e){n.exports=function(n,e){return function(t){return n(e(t))}}},function(n,e,t){var a=t(351),r=t(136),i=t(352),s=t(210),o=t(353),l=t(66),c=t(200),d=c(a),u=c(r),m=c(i),p=c(s),h=c(o),g=l;(a&&"[object DataView]"!=g(new a(new ArrayBuffer(1)))||r&&"[object Map]"!=g(new r)||i&&"[object Promise]"!=g(i.resolve())||s&&"[object Set]"!=g(new s)||o&&"[object WeakMap]"!=g(new o))&&(g=function(n){var e=l(n),t="[object Object]"==e?n.constructor:void 0,a=t?c(t):"";if(a)switch(a){case d:return"[object DataView]";case u:return"[object Map]";case m:return"[object Promise]";case p:return"[object Set]";case h:return"[object WeakMap]"}return e}),n.exports=g},function(n,e,t){var a=t(42)(t(32),"DataView");n.exports=a},function(n,e,t){var a=t(42)(t(32),"Promise");n.exports=a},function(n,e,t){var a=t(42)(t(32),"WeakMap");n.exports=a},function(n,e,t){var a=t(211),r=t(205);n.exports=function(n){for(var e=r(n),t=e.length;t--;){var i=e[t],s=n[i];e[t]=[i,s,a(s)]}return e}},function(n,e,t){var a=t(201),r=t(356),i=t(363),s=t(141),o=t(211),l=t(212),c=t(107);n.exports=function(n,e){return s(n)&&o(e)?l(c(n),e):function(t){var s=r(t,n);return void 0===s&&s===e?i(t,n):a(e,s,3)}}},function(n,e,t){var a=t(213);n.exports=function(n,e,t){var r=null==n?void 0:a(n,e);return void 0===r?t:r}},function(n,e,t){var a=t(358),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,s=a((function(n){var e=[];return 46===n.charCodeAt(0)&&e.push(""),n.replace(r,(function(n,t,a,r){e.push(a?r.replace(i,"$1"):t||n)})),e}));n.exports=s},function(n,e,t){var a=t(359);n.exports=function(n){var e=a(n,(function(n){return 500===t.size&&t.clear(),n})),t=e.cache;return e}},function(n,e,t){var a=t(138);function r(n,e){if("function"!=typeof n||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var t=function(){var a=arguments,r=e?e.apply(this,a):a[0],i=t.cache;if(i.has(r))return i.get(r);var s=n.apply(this,a);return t.cache=i.set(r,s)||i,s};return t.cache=new(r.Cache||a),t}r.Cache=a,n.exports=r},function(n,e,t){var a=t(361);n.exports=function(n){return null==n?"":a(n)}},function(n,e,t){var a=t(80),r=t(362),i=t(30),s=t(142),o=a?a.prototype:void 0,l=o?o.toString:void 0;n.exports=function n(e){if("string"==typeof e)return e;if(i(e))return r(e,n)+"";if(s(e))return l?l.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(n,e){n.exports=function(n,e){for(var t=-1,a=null==n?0:n.length,r=Array(a);++t<a;)r[t]=e(n[t],t,n);return r}},function(n,e,t){var a=t(364),r=t(365);n.exports=function(n,e){return null!=n&&r(n,e,a)}},function(n,e){n.exports=function(n,e){return null!=n&&e in Object(n)}},function(n,e,t){var a=t(214),r=t(135),i=t(30),s=t(207),o=t(140),l=t(107);n.exports=function(n,e,t){for(var c=-1,d=(e=a(e,n)).length,u=!1;++c<d;){var m=l(e[c]);if(!(u=null!=n&&t(n,m)))break;n=n[m]}return u||++c!=d?u:!!(d=null==n?0:n.length)&&o(d)&&s(m,d)&&(i(n)||r(n))}},function(n,e,t){var a=t(367),r=t(368),i=t(141),s=t(107);n.exports=function(n){return i(n)?a(s(n)):r(n)}},function(n,e){n.exports=function(n){return function(e){return null==e?void 0:e[n]}}},function(n,e,t){var a=t(213);n.exports=function(n){return function(e){return a(e,n)}}},function(n,e,t){var a=t(143),r=t(370),i=t(372);n.exports=function(n,e){return i(r(n,e,a),n+"")}},function(n,e,t){var a=t(371),r=Math.max;n.exports=function(n,e,t){return e=r(void 0===e?n.length-1:e,0),function(){for(var i=arguments,s=-1,o=r(i.length-e,0),l=Array(o);++s<o;)l[s]=i[e+s];s=-1;for(var c=Array(e+1);++s<e;)c[s]=i[s];return c[e]=t(l),a(n,this,c)}}},function(n,e){n.exports=function(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}},function(n,e,t){var a=t(373),r=t(376)(a);n.exports=r},function(n,e,t){var a=t(374),r=t(375),i=t(143),s=r?function(n,e){return r(n,"toString",{configurable:!0,enumerable:!1,value:a(e),writable:!0})}:i;n.exports=s},function(n,e){n.exports=function(n){return function(){return n}}},function(n,e,t){var a=t(42),r=function(){try{var n=a(Object,"defineProperty");return n({},"",{}),n}catch(n){}}();n.exports=r},function(n,e){var t=Date.now;n.exports=function(n){var e=0,a=0;return function(){var r=t(),i=16-(r-a);if(a=r,i>0){if(++e>=800)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}},function(n,e,t){var a=t(203),r=t(378),i=t(383),s=t(204),o=t(384),l=t(139);n.exports=function(n,e,t){var c=-1,d=r,u=n.length,m=!0,p=[],h=p;if(t)m=!1,d=i;else if(u>=200){var g=e?null:o(n);if(g)return l(g);m=!1,d=s,h=new a}else h=e?[]:p;n:for(;++c<u;){var f=n[c],b=e?e(f):f;if(f=t||0!==f?f:0,m&&b==b){for(var y=h.length;y--;)if(h[y]===b)continue n;e&&h.push(b),p.push(f)}else d(h,b,t)||(h!==p&&h.push(b),p.push(f))}return p}},function(n,e,t){var a=t(379);n.exports=function(n,e){return!!(null==n?0:n.length)&&a(n,e,0)>-1}},function(n,e,t){var a=t(380),r=t(381),i=t(382);n.exports=function(n,e,t){return e==e?i(n,e,t):a(n,r,t)}},function(n,e){n.exports=function(n,e,t,a){for(var r=n.length,i=t+(a?1:-1);a?i--:++i<r;)if(e(n[i],i,n))return i;return-1}},function(n,e){n.exports=function(n){return n!=n}},function(n,e){n.exports=function(n,e,t){for(var a=t-1,r=n.length;++a<r;)if(n[a]===e)return a;return-1}},function(n,e){n.exports=function(n,e,t){for(var a=-1,r=null==n?0:n.length;++a<r;)if(t(e,n[a]))return!0;return!1}},function(n,e,t){var a=t(210),r=t(385),i=t(139),s=a&&1/i(new a([,-0]))[1]==1/0?function(n){return new a(n)}:r;n.exports=s},function(n,e){n.exports=function(){}},function(n,e,t){var a=t(209),r=t(53);n.exports=function(n){return r(n)&&a(n)}},function(n,e,t){var a=t(1),r=t(0),i=t(215).setInterval;a({global:!0,bind:!0,forced:r.setInterval!==i},{setInterval:i})},function(n,e,t){var a=t(1),r=t(0),i=t(215).setTimeout;a({global:!0,bind:!0,forced:r.setTimeout!==i},{setTimeout:i})},function(n,e,t){},function(n,e,t){},function(n,e,t){var a=t(73).PROPER,r=t(2),i=t(160);n.exports=function(n){return r((function(){return!!i[n]()||"âÂá "!=="âÂá "[n]()||a&&i[n].name!==n}))}},function(n,e,t){var a=t(3);n.exports=a(1..valueOf)},function(n,e,t){var a=t(3),r=t(57),i=t(12),s=t(394),o=t(18),l=a(s),c=a("".slice),d=Math.ceil,u=function(n){return function(e,t,a){var s,u,m=i(o(e)),p=r(t),h=m.length,g=void 0===a?" ":i(a);return p<=h||""==g?m:((u=l(g,d((s=p-h)/g.length))).length>s&&(u=c(u,0,s)),n?m+u:u+m)}};n.exports={start:u(!1),end:u(!0)}},function(n,e,t){"use strict";var a=t(0),r=t(48),i=t(12),s=t(18),o=a.RangeError;n.exports=function(n){var e=i(s(this)),t="",a=r(n);if(a<0||a==1/0)throw o("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(t+=e);return t}},function(n,e,t){var a=t(31);n.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(a)},function(n,e,t){"use strict";t(218)},function(n,e,t){"use strict";t(219)},function(n,e,t){"use strict";var a=t(1),r=t(3),i=t(24),s=t(16),o=t(20),l=t(12),c=t(2),d=t(241),u=t(49),m=t(399),p=t(400),h=t(56),g=t(401),f=[],b=r(f.sort),y=r(f.push),v=c((function(){f.sort(void 0)})),_=c((function(){f.sort(null)})),x=u("sort"),E=!c((function(){if(h)return h<70;if(!(m&&m>3)){if(p)return!0;if(g)return g<603;var n,e,t,a,r="";for(n=65;n<76;n++){switch(e=String.fromCharCode(n),n){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(a=0;a<47;a++)f.push({k:e+a,v:t})}for(f.sort((function(n,e){return e.v-n.v})),a=0;a<f.length;a++)e=f[a].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return"DGBEFHACIJK"!==r}}));a({target:"Array",proto:!0,forced:v||!_||!x||!E},{sort:function(n){void 0!==n&&i(n);var e=s(this);if(E)return void 0===n?b(e):b(e,n);var t,a,r=[],c=o(e);for(a=0;a<c;a++)a in e&&y(r,e[a]);for(d(r,function(n){return function(e,t){return void 0===t?-1:void 0===e?1:void 0!==n?+n(e,t)||0:l(e)>l(t)?1:-1}}(n)),t=r.length,a=0;a<t;)e[a]=r[a++];for(;a<c;)delete e[a++];return e}})},function(n,e,t){var a=t(31).match(/firefox\/(\d+)/i);n.exports=!!a&&+a[1]},function(n,e,t){var a=t(31);n.exports=/MSIE|Trident/.test(a)},function(n,e,t){var a=t(31).match(/AppleWebKit\/(\d+)\./);n.exports=!!a&&+a[1]},function(n,e,t){},function(n,e,t){},function(n,e,t){"use strict";var a=t(1),r=t(0),i=t(93),s=t(48),o=t(20),l=t(16),c=t(114),d=t(59),u=t(79)("splice"),m=r.TypeError,p=Math.max,h=Math.min;a({target:"Array",proto:!0,forced:!u},{splice:function(n,e){var t,a,r,u,g,f,b=l(this),y=o(b),v=i(n,y),_=arguments.length;if(0===_?t=a=0:1===_?(t=0,a=y-v):(t=_-2,a=h(p(s(e),0),y-v)),y+t-a>9007199254740991)throw m("Maximum allowed length exceeded");for(r=c(b,a),u=0;u<a;u++)(g=v+u)in b&&d(r,u,b[g]);if(r.length=a,t<a){for(u=v;u<y-a;u++)f=u+t,(g=u+a)in b?b[f]=b[g]:delete b[f];for(u=y;u>y-a+t;u--)delete b[u-1]}else if(t>a)for(u=y-a;u>v;u--)f=u+t-1,(g=u+a-1)in b?b[f]=b[g]:delete b[f];for(u=0;u<t;u++)b[u+v]=arguments[u+2];return b.length=y-a+t,r}})},function(n,e,t){"use strict";t(222)},function(n,e,t){"use strict";t(223)},function(n,e,t){"use strict";t.r(e);t(151),t(249),t(262),t(264);var a=t(60),r=t(101),i=(t(43),t(5),t(22),t(25),t(46),t(34),Object.freeze({}));function s(n){return null==n}function o(n){return null!=n}function l(n){return!0===n}function c(n){return"string"==typeof n||"number"==typeof n||"symbol"==typeof n||"boolean"==typeof n}function d(n){return null!==n&&"object"==typeof n}var u=Object.prototype.toString;function m(n){return"[object Object]"===u.call(n)}function p(n){return"[object RegExp]"===u.call(n)}function h(n){var e=parseFloat(String(n));return e>=0&&Math.floor(e)===e&&isFinite(n)}function g(n){return o(n)&&"function"==typeof n.then&&"function"==typeof n.catch}function f(n){return null==n?"":Array.isArray(n)||m(n)&&n.toString===u?JSON.stringify(n,null,2):String(n)}function b(n){var e=parseFloat(n);return isNaN(e)?n:e}function y(n,e){for(var t=Object.create(null),a=n.split(","),r=0;r<a.length;r++)t[a[r]]=!0;return e?function(n){return t[n.toLowerCase()]}:function(n){return t[n]}}y("slot,component",!0);var v=y("key,ref,slot,slot-scope,is");function _(n,e){if(n.length){var t=n.indexOf(e);if(t>-1)return n.splice(t,1)}}var x=Object.prototype.hasOwnProperty;function E(n,e){return x.call(n,e)}function T(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var I=/-(\w)/g,k=T((function(n){return n.replace(I,(function(n,e){return e?e.toUpperCase():""}))})),S=T((function(n){return n.charAt(0).toUpperCase()+n.slice(1)})),q=/\B([A-Z])/g,w=T((function(n){return n.replace(q,"-$1").toLowerCase()}));var R=Function.prototype.bind?function(n,e){return n.bind(e)}:function(n,e){function t(t){var a=arguments.length;return a?a>1?n.apply(e,arguments):n.call(e,t):n.call(e)}return t._length=n.length,t};function A(n,e){e=e||0;for(var t=n.length-e,a=new Array(t);t--;)a[t]=n[t+e];return a}function z(n,e){for(var t in e)n[t]=e[t];return n}function L(n){for(var e={},t=0;t<n.length;t++)n[t]&&z(e,n[t]);return e}function M(n,e,t){}var D=function(n,e,t){return!1},B=function(n){return n};function O(n,e){if(n===e)return!0;var t=d(n),a=d(e);if(!t||!a)return!t&&!a&&String(n)===String(e);try{var r=Array.isArray(n),i=Array.isArray(e);if(r&&i)return n.length===e.length&&n.every((function(n,t){return O(n,e[t])}));if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(r||i)return!1;var s=Object.keys(n),o=Object.keys(e);return s.length===o.length&&s.every((function(t){return O(n[t],e[t])}))}catch(n){return!1}}function C(n,e){for(var t=0;t<n.length;t++)if(O(n[t],e))return t;return-1}function N(n){var e=!1;return function(){e||(e=!0,n.apply(this,arguments))}}var j=["component","directive","filter"],P=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch"],U={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:D,isReservedAttr:D,isUnknownElement:D,getTagNamespace:M,parsePlatformTagName:B,mustUseProp:D,async:!0,_lifecycleHooks:P},F=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function $(n,e,t,a){Object.defineProperty(n,e,{value:t,enumerable:!!a,writable:!0,configurable:!0})}var G=new RegExp("[^"+F.source+".$_\\d]");var H,Q="__proto__"in{},V="undefined"!=typeof window,K="undefined"!=typeof WXEnvironment&&!!WXEnvironment.platform,W=K&&WXEnvironment.platform.toLowerCase(),J=V&&window.navigator.userAgent.toLowerCase(),X=J&&/msie|trident/.test(J),Y=J&&J.indexOf("msie 9.0")>0,Z=J&&J.indexOf("edge/")>0,nn=(J&&J.indexOf("android"),J&&/iphone|ipad|ipod|ios/.test(J)||"ios"===W),en=(J&&/chrome\/\d+/.test(J),J&&/phantomjs/.test(J),J&&J.match(/firefox\/(\d+)/)),tn={}.watch,an=!1;if(V)try{var rn={};Object.defineProperty(rn,"passive",{get:function(){an=!0}}),window.addEventListener("test-passive",null,rn)}catch(n){}var sn=function(){return void 0===H&&(H=!V&&!K&&"undefined"!=typeof global&&(global.process&&"server"===global.process.env.VUE_ENV)),H},on=V&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function ln(n){return"function"==typeof n&&/native code/.test(n.toString())}var cn,dn="undefined"!=typeof Symbol&&ln(Symbol)&&"undefined"!=typeof Reflect&&ln(Reflect.ownKeys);cn="undefined"!=typeof Set&&ln(Set)?Set:function(){function n(){this.set=Object.create(null)}return n.prototype.has=function(n){return!0===this.set[n]},n.prototype.add=function(n){this.set[n]=!0},n.prototype.clear=function(){this.set=Object.create(null)},n}();var un=M,mn=0,pn=function(){this.id=mn++,this.subs=[]};pn.prototype.addSub=function(n){this.subs.push(n)},pn.prototype.removeSub=function(n){_(this.subs,n)},pn.prototype.depend=function(){pn.target&&pn.target.addDep(this)},pn.prototype.notify=function(){var n=this.subs.slice();for(var e=0,t=n.length;e<t;e++)n[e].update()},pn.target=null;var hn=[];function gn(n){hn.push(n),pn.target=n}function fn(){hn.pop(),pn.target=hn[hn.length-1]}var bn=function(n,e,t,a,r,i,s,o){this.tag=n,this.data=e,this.children=t,this.text=a,this.elm=r,this.ns=void 0,this.context=i,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=e&&e.key,this.componentOptions=s,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=o,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1},yn={child:{configurable:!0}};yn.child.get=function(){return this.componentInstance},Object.defineProperties(bn.prototype,yn);var vn=function(n){void 0===n&&(n="");var e=new bn;return e.text=n,e.isComment=!0,e};function _n(n){return new bn(void 0,void 0,void 0,String(n))}function xn(n){var e=new bn(n.tag,n.data,n.children&&n.children.slice(),n.text,n.elm,n.context,n.componentOptions,n.asyncFactory);return e.ns=n.ns,e.isStatic=n.isStatic,e.key=n.key,e.isComment=n.isComment,e.fnContext=n.fnContext,e.fnOptions=n.fnOptions,e.fnScopeId=n.fnScopeId,e.asyncMeta=n.asyncMeta,e.isCloned=!0,e}var En=Array.prototype,Tn=Object.create(En);["push","pop","shift","unshift","splice","sort","reverse"].forEach((function(n){var e=En[n];$(Tn,n,(function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];var r,i=e.apply(this,t),s=this.__ob__;switch(n){case"push":case"unshift":r=t;break;case"splice":r=t.slice(2)}return r&&s.observeArray(r),s.dep.notify(),i}))}));var In=Object.getOwnPropertyNames(Tn),kn=!0;function Sn(n){kn=n}var qn=function(n){this.value=n,this.dep=new pn,this.vmCount=0,$(n,"__ob__",this),Array.isArray(n)?(Q?function(n,e){n.__proto__=e}(n,Tn):function(n,e,t){for(var a=0,r=t.length;a<r;a++){var i=t[a];$(n,i,e[i])}}(n,Tn,In),this.observeArray(n)):this.walk(n)};function wn(n,e){var t;if(d(n)&&!(n instanceof bn))return E(n,"__ob__")&&n.__ob__ instanceof qn?t=n.__ob__:kn&&!sn()&&(Array.isArray(n)||m(n))&&Object.isExtensible(n)&&!n._isVue&&(t=new qn(n)),e&&t&&t.vmCount++,t}function Rn(n,e,t,a,r){var i=new pn,s=Object.getOwnPropertyDescriptor(n,e);if(!s||!1!==s.configurable){var o=s&&s.get,l=s&&s.set;o&&!l||2!==arguments.length||(t=n[e]);var c=!r&&wn(t);Object.defineProperty(n,e,{enumerable:!0,configurable:!0,get:function(){var e=o?o.call(n):t;return pn.target&&(i.depend(),c&&(c.dep.depend(),Array.isArray(e)&&Ln(e))),e},set:function(e){var a=o?o.call(n):t;e===a||e!=e&&a!=a||o&&!l||(l?l.call(n,e):t=e,c=!r&&wn(e),i.notify())}})}}function An(n,e,t){if(Array.isArray(n)&&h(e))return n.length=Math.max(n.length,e),n.splice(e,1,t),t;if(e in n&&!(e in Object.prototype))return n[e]=t,t;var a=n.__ob__;return n._isVue||a&&a.vmCount?t:a?(Rn(a.value,e,t),a.dep.notify(),t):(n[e]=t,t)}function zn(n,e){if(Array.isArray(n)&&h(e))n.splice(e,1);else{var t=n.__ob__;n._isVue||t&&t.vmCount||E(n,e)&&(delete n[e],t&&t.dep.notify())}}function Ln(n){for(var e=void 0,t=0,a=n.length;t<a;t++)(e=n[t])&&e.__ob__&&e.__ob__.dep.depend(),Array.isArray(e)&&Ln(e)}qn.prototype.walk=function(n){for(var e=Object.keys(n),t=0;t<e.length;t++)Rn(n,e[t])},qn.prototype.observeArray=function(n){for(var e=0,t=n.length;e<t;e++)wn(n[e])};var Mn=U.optionMergeStrategies;function Dn(n,e){if(!e)return n;for(var t,a,r,i=dn?Reflect.ownKeys(e):Object.keys(e),s=0;s<i.length;s++)"__ob__"!==(t=i[s])&&(a=n[t],r=e[t],E(n,t)?a!==r&&m(a)&&m(r)&&Dn(a,r):An(n,t,r));return n}function Bn(n,e,t){return t?function(){var a="function"==typeof e?e.call(t,t):e,r="function"==typeof n?n.call(t,t):n;return a?Dn(a,r):r}:e?n?function(){return Dn("function"==typeof e?e.call(this,this):e,"function"==typeof n?n.call(this,this):n)}:e:n}function On(n,e){var t=e?n?n.concat(e):Array.isArray(e)?e:[e]:n;return t?function(n){for(var e=[],t=0;t<n.length;t++)-1===e.indexOf(n[t])&&e.push(n[t]);return e}(t):t}function Cn(n,e,t,a){var r=Object.create(n||null);return e?z(r,e):r}Mn.data=function(n,e,t){return t?Bn(n,e,t):e&&"function"!=typeof e?n:Bn(n,e)},P.forEach((function(n){Mn[n]=On})),j.forEach((function(n){Mn[n+"s"]=Cn})),Mn.watch=function(n,e,t,a){if(n===tn&&(n=void 0),e===tn&&(e=void 0),!e)return Object.create(n||null);if(!n)return e;var r={};for(var i in z(r,n),e){var s=r[i],o=e[i];s&&!Array.isArray(s)&&(s=[s]),r[i]=s?s.concat(o):Array.isArray(o)?o:[o]}return r},Mn.props=Mn.methods=Mn.inject=Mn.computed=function(n,e,t,a){if(!n)return e;var r=Object.create(null);return z(r,n),e&&z(r,e),r},Mn.provide=Bn;var Nn=function(n,e){return void 0===e?n:e};function jn(n,e,t){if("function"==typeof e&&(e=e.options),function(n,e){var t=n.props;if(t){var a,r,i={};if(Array.isArray(t))for(a=t.length;a--;)"string"==typeof(r=t[a])&&(i[k(r)]={type:null});else if(m(t))for(var s in t)r=t[s],i[k(s)]=m(r)?r:{type:r};else 0;n.props=i}}(e),function(n,e){var t=n.inject;if(t){var a=n.inject={};if(Array.isArray(t))for(var r=0;r<t.length;r++)a[t[r]]={from:t[r]};else if(m(t))for(var i in t){var s=t[i];a[i]=m(s)?z({from:i},s):{from:s}}else 0}}(e),function(n){var e=n.directives;if(e)for(var t in e){var a=e[t];"function"==typeof a&&(e[t]={bind:a,update:a})}}(e),!e._base&&(e.extends&&(n=jn(n,e.extends,t)),e.mixins))for(var a=0,r=e.mixins.length;a<r;a++)n=jn(n,e.mixins[a],t);var i,s={};for(i in n)o(i);for(i in e)E(n,i)||o(i);function o(a){var r=Mn[a]||Nn;s[a]=r(n[a],e[a],t,a)}return s}function Pn(n,e,t,a){if("string"==typeof t){var r=n[e];if(E(r,t))return r[t];var i=k(t);if(E(r,i))return r[i];var s=S(i);return E(r,s)?r[s]:r[t]||r[i]||r[s]}}function Un(n,e,t,a){var r=e[n],i=!E(t,n),s=t[n],o=Hn(Boolean,r.type);if(o>-1)if(i&&!E(r,"default"))s=!1;else if(""===s||s===w(n)){var l=Hn(String,r.type);(l<0||o<l)&&(s=!0)}if(void 0===s){s=function(n,e,t){if(!E(e,"default"))return;var a=e.default;0;if(n&&n.$options.propsData&&void 0===n.$options.propsData[t]&&void 0!==n._props[t])return n._props[t];return"function"==typeof a&&"Function"!==$n(e.type)?a.call(n):a}(a,r,n);var c=kn;Sn(!0),wn(s),Sn(c)}return s}var Fn=/^\s*function (\w+)/;function $n(n){var e=n&&n.toString().match(Fn);return e?e[1]:""}function Gn(n,e){return $n(n)===$n(e)}function Hn(n,e){if(!Array.isArray(e))return Gn(e,n)?0:-1;for(var t=0,a=e.length;t<a;t++)if(Gn(e[t],n))return t;return-1}function Qn(n,e,t){gn();try{if(e)for(var a=e;a=a.$parent;){var r=a.$options.errorCaptured;if(r)for(var i=0;i<r.length;i++)try{if(!1===r[i].call(a,n,e,t))return}catch(n){Kn(n,a,"errorCaptured hook")}}Kn(n,e,t)}finally{fn()}}function Vn(n,e,t,a,r){var i;try{(i=t?n.apply(e,t):n.call(e))&&!i._isVue&&g(i)&&!i._handled&&(i.catch((function(n){return Qn(n,a,r+" (Promise/async)")})),i._handled=!0)}catch(n){Qn(n,a,r)}return i}function Kn(n,e,t){if(U.errorHandler)try{return U.errorHandler.call(null,n,e,t)}catch(e){e!==n&&Wn(e,null,"config.errorHandler")}Wn(n,e,t)}function Wn(n,e,t){if(!V&&!K||"undefined"==typeof console)throw n;console.error(n)}var Jn,Xn=!1,Yn=[],Zn=!1;function ne(){Zn=!1;var n=Yn.slice(0);Yn.length=0;for(var e=0;e<n.length;e++)n[e]()}if("undefined"!=typeof Promise&&ln(Promise)){var ee=Promise.resolve();Jn=function(){ee.then(ne),nn&&setTimeout(M)},Xn=!0}else if(X||"undefined"==typeof MutationObserver||!ln(MutationObserver)&&"[object MutationObserverConstructor]"!==MutationObserver.toString())Jn="undefined"!=typeof setImmediate&&ln(setImmediate)?function(){setImmediate(ne)}:function(){setTimeout(ne,0)};else{var te=1,ae=new MutationObserver(ne),re=document.createTextNode(String(te));ae.observe(re,{characterData:!0}),Jn=function(){te=(te+1)%2,re.data=String(te)},Xn=!0}function ie(n,e){var t;if(Yn.push((function(){if(n)try{n.call(e)}catch(n){Qn(n,e,"nextTick")}else t&&t(e)})),Zn||(Zn=!0,Jn()),!n&&"undefined"!=typeof Promise)return new Promise((function(n){t=n}))}var se=new cn;function oe(n){!function n(e,t){var a,r,i=Array.isArray(e);if(!i&&!d(e)||Object.isFrozen(e)||e instanceof bn)return;if(e.__ob__){var s=e.__ob__.dep.id;if(t.has(s))return;t.add(s)}if(i)for(a=e.length;a--;)n(e[a],t);else for(r=Object.keys(e),a=r.length;a--;)n(e[r[a]],t)}(n,se),se.clear()}var le=T((function(n){var e="&"===n.charAt(0),t="~"===(n=e?n.slice(1):n).charAt(0),a="!"===(n=t?n.slice(1):n).charAt(0);return{name:n=a?n.slice(1):n,once:t,capture:a,passive:e}}));function ce(n,e){function t(){var n=arguments,a=t.fns;if(!Array.isArray(a))return Vn(a,null,arguments,e,"v-on handler");for(var r=a.slice(),i=0;i<r.length;i++)Vn(r[i],null,n,e,"v-on handler")}return t.fns=n,t}function de(n,e,t,a,r,i){var o,c,d,u;for(o in n)c=n[o],d=e[o],u=le(o),s(c)||(s(d)?(s(c.fns)&&(c=n[o]=ce(c,i)),l(u.once)&&(c=n[o]=r(u.name,c,u.capture)),t(u.name,c,u.capture,u.passive,u.params)):c!==d&&(d.fns=c,n[o]=d));for(o in e)s(n[o])&&a((u=le(o)).name,e[o],u.capture)}function ue(n,e,t){var a;n instanceof bn&&(n=n.data.hook||(n.data.hook={}));var r=n[e];function i(){t.apply(this,arguments),_(a.fns,i)}s(r)?a=ce([i]):o(r.fns)&&l(r.merged)?(a=r).fns.push(i):a=ce([r,i]),a.merged=!0,n[e]=a}function me(n,e,t,a,r){if(o(e)){if(E(e,t))return n[t]=e[t],r||delete e[t],!0;if(E(e,a))return n[t]=e[a],r||delete e[a],!0}return!1}function pe(n){return c(n)?[_n(n)]:Array.isArray(n)?function n(e,t){var a,r,i,d,u=[];for(a=0;a<e.length;a++)s(r=e[a])||"boolean"==typeof r||(i=u.length-1,d=u[i],Array.isArray(r)?r.length>0&&(he((r=n(r,(t||"")+"_"+a))[0])&&he(d)&&(u[i]=_n(d.text+r[0].text),r.shift()),u.push.apply(u,r)):c(r)?he(d)?u[i]=_n(d.text+r):""!==r&&u.push(_n(r)):he(r)&&he(d)?u[i]=_n(d.text+r.text):(l(e._isVList)&&o(r.tag)&&s(r.key)&&o(t)&&(r.key="__vlist"+t+"_"+a+"__"),u.push(r)));return u}(n):void 0}function he(n){return o(n)&&o(n.text)&&!1===n.isComment}function ge(n,e){if(n){for(var t=Object.create(null),a=dn?Reflect.ownKeys(n):Object.keys(n),r=0;r<a.length;r++){var i=a[r];if("__ob__"!==i){for(var s=n[i].from,o=e;o;){if(o._provided&&E(o._provided,s)){t[i]=o._provided[s];break}o=o.$parent}if(!o)if("default"in n[i]){var l=n[i].default;t[i]="function"==typeof l?l.call(e):l}else 0}}return t}}function fe(n,e){if(!n||!n.length)return{};for(var t={},a=0,r=n.length;a<r;a++){var i=n[a],s=i.data;if(s&&s.attrs&&s.attrs.slot&&delete s.attrs.slot,i.context!==e&&i.fnContext!==e||!s||null==s.slot)(t.default||(t.default=[])).push(i);else{var o=s.slot,l=t[o]||(t[o]=[]);"template"===i.tag?l.push.apply(l,i.children||[]):l.push(i)}}for(var c in t)t[c].every(be)&&delete t[c];return t}function be(n){return n.isComment&&!n.asyncFactory||" "===n.text}function ye(n){return n.isComment&&n.asyncFactory}function ve(n,e,t){var a,r=Object.keys(e).length>0,s=n?!!n.$stable:!r,o=n&&n.$key;if(n){if(n._normalized)return n._normalized;if(s&&t&&t!==i&&o===t.$key&&!r&&!t.$hasNormal)return t;for(var l in a={},n)n[l]&&"$"!==l[0]&&(a[l]=_e(e,l,n[l]))}else a={};for(var c in e)c in a||(a[c]=xe(e,c));return n&&Object.isExtensible(n)&&(n._normalized=a),$(a,"$stable",s),$(a,"$key",o),$(a,"$hasNormal",r),a}function _e(n,e,t){var a=function(){var n=arguments.length?t.apply(null,arguments):t({}),e=(n=n&&"object"==typeof n&&!Array.isArray(n)?[n]:pe(n))&&n[0];return n&&(!e||1===n.length&&e.isComment&&!ye(e))?void 0:n};return t.proxy&&Object.defineProperty(n,e,{get:a,enumerable:!0,configurable:!0}),a}function xe(n,e){return function(){return n[e]}}function Ee(n,e){var t,a,r,i,s;if(Array.isArray(n)||"string"==typeof n)for(t=new Array(n.length),a=0,r=n.length;a<r;a++)t[a]=e(n[a],a);else if("number"==typeof n)for(t=new Array(n),a=0;a<n;a++)t[a]=e(a+1,a);else if(d(n))if(dn&&n[Symbol.iterator]){t=[];for(var l=n[Symbol.iterator](),c=l.next();!c.done;)t.push(e(c.value,t.length)),c=l.next()}else for(i=Object.keys(n),t=new Array(i.length),a=0,r=i.length;a<r;a++)s=i[a],t[a]=e(n[s],s,a);return o(t)||(t=[]),t._isVList=!0,t}function Te(n,e,t,a){var r,i=this.$scopedSlots[n];i?(t=t||{},a&&(t=z(z({},a),t)),r=i(t)||("function"==typeof e?e():e)):r=this.$slots[n]||("function"==typeof e?e():e);var s=t&&t.slot;return s?this.$createElement("template",{slot:s},r):r}function Ie(n){return Pn(this.$options,"filters",n)||B}function ke(n,e){return Array.isArray(n)?-1===n.indexOf(e):n!==e}function Se(n,e,t,a,r){var i=U.keyCodes[e]||t;return r&&a&&!U.keyCodes[e]?ke(r,a):i?ke(i,n):a?w(a)!==e:void 0===n}function qe(n,e,t,a,r){if(t)if(d(t)){var i;Array.isArray(t)&&(t=L(t));var s=function(s){if("class"===s||"style"===s||v(s))i=n;else{var o=n.attrs&&n.attrs.type;i=a||U.mustUseProp(e,o,s)?n.domProps||(n.domProps={}):n.attrs||(n.attrs={})}var l=k(s),c=w(s);l in i||c in i||(i[s]=t[s],r&&((n.on||(n.on={}))["update:"+s]=function(n){t[s]=n}))};for(var o in t)s(o)}else;return n}function we(n,e){var t=this._staticTrees||(this._staticTrees=[]),a=t[n];return a&&!e||Ae(a=t[n]=this.$options.staticRenderFns[n].call(this._renderProxy,null,this),"__static__"+n,!1),a}function Re(n,e,t){return Ae(n,"__once__"+e+(t?"_"+t:""),!0),n}function Ae(n,e,t){if(Array.isArray(n))for(var a=0;a<n.length;a++)n[a]&&"string"!=typeof n[a]&&ze(n[a],e+"_"+a,t);else ze(n,e,t)}function ze(n,e,t){n.isStatic=!0,n.key=e,n.isOnce=t}function Le(n,e){if(e)if(m(e)){var t=n.on=n.on?z({},n.on):{};for(var a in e){var r=t[a],i=e[a];t[a]=r?[].concat(r,i):i}}else;return n}function Me(n,e,t,a){e=e||{$stable:!t};for(var r=0;r<n.length;r++){var i=n[r];Array.isArray(i)?Me(i,e,t):i&&(i.proxy&&(i.fn.proxy=!0),e[i.key]=i.fn)}return a&&(e.$key=a),e}function De(n,e){for(var t=0;t<e.length;t+=2){var a=e[t];"string"==typeof a&&a&&(n[e[t]]=e[t+1])}return n}function Be(n,e){return"string"==typeof n?e+n:n}function Oe(n){n._o=Re,n._n=b,n._s=f,n._l=Ee,n._t=Te,n._q=O,n._i=C,n._m=we,n._f=Ie,n._k=Se,n._b=qe,n._v=_n,n._e=vn,n._u=Me,n._g=Le,n._d=De,n._p=Be}function Ce(n,e,t,a,r){var s,o=this,c=r.options;E(a,"_uid")?(s=Object.create(a))._original=a:(s=a,a=a._original);var d=l(c._compiled),u=!d;this.data=n,this.props=e,this.children=t,this.parent=a,this.listeners=n.on||i,this.injections=ge(c.inject,a),this.slots=function(){return o.$slots||ve(n.scopedSlots,o.$slots=fe(t,a)),o.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return ve(n.scopedSlots,this.slots())}}),d&&(this.$options=c,this.$slots=this.slots(),this.$scopedSlots=ve(n.scopedSlots,this.$slots)),c._scopeId?this._c=function(n,e,t,r){var i=Ge(s,n,e,t,r,u);return i&&!Array.isArray(i)&&(i.fnScopeId=c._scopeId,i.fnContext=a),i}:this._c=function(n,e,t,a){return Ge(s,n,e,t,a,u)}}function Ne(n,e,t,a,r){var i=xn(n);return i.fnContext=t,i.fnOptions=a,e.slot&&((i.data||(i.data={})).slot=e.slot),i}function je(n,e){for(var t in e)n[k(t)]=e[t]}Oe(Ce.prototype);var Pe={init:function(n,e){if(n.componentInstance&&!n.componentInstance._isDestroyed&&n.data.keepAlive){var t=n;Pe.prepatch(t,t)}else{(n.componentInstance=function(n,e){var t={_isComponent:!0,_parentVnode:n,parent:e},a=n.data.inlineTemplate;o(a)&&(t.render=a.render,t.staticRenderFns=a.staticRenderFns);return new n.componentOptions.Ctor(t)}(n,Ze)).$mount(e?n.elm:void 0,e)}},prepatch:function(n,e){var t=e.componentOptions;!function(n,e,t,a,r){0;var s=a.data.scopedSlots,o=n.$scopedSlots,l=!!(s&&!s.$stable||o!==i&&!o.$stable||s&&n.$scopedSlots.$key!==s.$key||!s&&n.$scopedSlots.$key),c=!!(r||n.$options._renderChildren||l);n.$options._parentVnode=a,n.$vnode=a,n._vnode&&(n._vnode.parent=a);if(n.$options._renderChildren=r,n.$attrs=a.data.attrs||i,n.$listeners=t||i,e&&n.$options.props){Sn(!1);for(var d=n._props,u=n.$options._propKeys||[],m=0;m<u.length;m++){var p=u[m],h=n.$options.props;d[p]=Un(p,h,e,n)}Sn(!0),n.$options.propsData=e}t=t||i;var g=n.$options._parentListeners;n.$options._parentListeners=t,Ye(n,t,g),c&&(n.$slots=fe(r,a.context),n.$forceUpdate());0}(e.componentInstance=n.componentInstance,t.propsData,t.listeners,e,t.children)},insert:function(n){var e,t=n.context,a=n.componentInstance;a._isMounted||(a._isMounted=!0,at(a,"mounted")),n.data.keepAlive&&(t._isMounted?((e=a)._inactive=!1,it.push(e)):tt(a,!0))},destroy:function(n){var e=n.componentInstance;e._isDestroyed||(n.data.keepAlive?function n(e,t){if(t&&(e._directInactive=!0,et(e)))return;if(!e._inactive){e._inactive=!0;for(var a=0;a<e.$children.length;a++)n(e.$children[a]);at(e,"deactivated")}}(e,!0):e.$destroy())}},Ue=Object.keys(Pe);function Fe(n,e,t,a,r){if(!s(n)){var c=t.$options._base;if(d(n)&&(n=c.extend(n)),"function"==typeof n){var u;if(s(n.cid)&&void 0===(n=function(n,e){if(l(n.error)&&o(n.errorComp))return n.errorComp;if(o(n.resolved))return n.resolved;var t=Qe;t&&o(n.owners)&&-1===n.owners.indexOf(t)&&n.owners.push(t);if(l(n.loading)&&o(n.loadingComp))return n.loadingComp;if(t&&!o(n.owners)){var a=n.owners=[t],r=!0,i=null,c=null;t.$on("hook:destroyed",(function(){return _(a,t)}));var u=function(n){for(var e=0,t=a.length;e<t;e++)a[e].$forceUpdate();n&&(a.length=0,null!==i&&(clearTimeout(i),i=null),null!==c&&(clearTimeout(c),c=null))},m=N((function(t){n.resolved=Ve(t,e),r?a.length=0:u(!0)})),p=N((function(e){o(n.errorComp)&&(n.error=!0,u(!0))})),h=n(m,p);return d(h)&&(g(h)?s(n.resolved)&&h.then(m,p):g(h.component)&&(h.component.then(m,p),o(h.error)&&(n.errorComp=Ve(h.error,e)),o(h.loading)&&(n.loadingComp=Ve(h.loading,e),0===h.delay?n.loading=!0:i=setTimeout((function(){i=null,s(n.resolved)&&s(n.error)&&(n.loading=!0,u(!1))}),h.delay||200)),o(h.timeout)&&(c=setTimeout((function(){c=null,s(n.resolved)&&p(null)}),h.timeout)))),r=!1,n.loading?n.loadingComp:n.resolved}}(u=n,c)))return function(n,e,t,a,r){var i=vn();return i.asyncFactory=n,i.asyncMeta={data:e,context:t,children:a,tag:r},i}(u,e,t,a,r);e=e||{},kt(n),o(e.model)&&function(n,e){var t=n.model&&n.model.prop||"value",a=n.model&&n.model.event||"input";(e.attrs||(e.attrs={}))[t]=e.model.value;var r=e.on||(e.on={}),i=r[a],s=e.model.callback;o(i)?(Array.isArray(i)?-1===i.indexOf(s):i!==s)&&(r[a]=[s].concat(i)):r[a]=s}(n.options,e);var m=function(n,e,t){var a=e.options.props;if(!s(a)){var r={},i=n.attrs,l=n.props;if(o(i)||o(l))for(var c in a){var d=w(c);me(r,l,c,d,!0)||me(r,i,c,d,!1)}return r}}(e,n);if(l(n.options.functional))return function(n,e,t,a,r){var s=n.options,l={},c=s.props;if(o(c))for(var d in c)l[d]=Un(d,c,e||i);else o(t.attrs)&&je(l,t.attrs),o(t.props)&&je(l,t.props);var u=new Ce(t,l,r,a,n),m=s.render.call(null,u._c,u);if(m instanceof bn)return Ne(m,t,u.parent,s,u);if(Array.isArray(m)){for(var p=pe(m)||[],h=new Array(p.length),g=0;g<p.length;g++)h[g]=Ne(p[g],t,u.parent,s,u);return h}}(n,m,e,t,a);var p=e.on;if(e.on=e.nativeOn,l(n.options.abstract)){var h=e.slot;e={},h&&(e.slot=h)}!function(n){for(var e=n.hook||(n.hook={}),t=0;t<Ue.length;t++){var a=Ue[t],r=e[a],i=Pe[a];r===i||r&&r._merged||(e[a]=r?$e(i,r):i)}}(e);var f=n.options.name||r;return new bn("vue-component-"+n.cid+(f?"-"+f:""),e,void 0,void 0,void 0,t,{Ctor:n,propsData:m,listeners:p,tag:r,children:a},u)}}}function $e(n,e){var t=function(t,a){n(t,a),e(t,a)};return t._merged=!0,t}function Ge(n,e,t,a,r,i){return(Array.isArray(t)||c(t))&&(r=a,a=t,t=void 0),l(i)&&(r=2),function(n,e,t,a,r){if(o(t)&&o(t.__ob__))return vn();o(t)&&o(t.is)&&(e=t.is);if(!e)return vn();0;Array.isArray(a)&&"function"==typeof a[0]&&((t=t||{}).scopedSlots={default:a[0]},a.length=0);2===r?a=pe(a):1===r&&(a=function(n){for(var e=0;e<n.length;e++)if(Array.isArray(n[e]))return Array.prototype.concat.apply([],n);return n}(a));var i,c;if("string"==typeof e){var u;c=n.$vnode&&n.$vnode.ns||U.getTagNamespace(e),i=U.isReservedTag(e)?new bn(U.parsePlatformTagName(e),t,a,void 0,void 0,n):t&&t.pre||!o(u=Pn(n.$options,"components",e))?new bn(e,t,a,void 0,void 0,n):Fe(u,t,n,a,e)}else i=Fe(e,t,n,a);return Array.isArray(i)?i:o(i)?(o(c)&&function n(e,t,a){e.ns=t,"foreignObject"===e.tag&&(t=void 0,a=!0);if(o(e.children))for(var r=0,i=e.children.length;r<i;r++){var c=e.children[r];o(c.tag)&&(s(c.ns)||l(a)&&"svg"!==c.tag)&&n(c,t,a)}}(i,c),o(t)&&function(n){d(n.style)&&oe(n.style);d(n.class)&&oe(n.class)}(t),i):vn()}(n,e,t,a,r)}var He,Qe=null;function Ve(n,e){return(n.__esModule||dn&&"Module"===n[Symbol.toStringTag])&&(n=n.default),d(n)?e.extend(n):n}function Ke(n){if(Array.isArray(n))for(var e=0;e<n.length;e++){var t=n[e];if(o(t)&&(o(t.componentOptions)||ye(t)))return t}}function We(n,e){He.$on(n,e)}function Je(n,e){He.$off(n,e)}function Xe(n,e){var t=He;return function a(){var r=e.apply(null,arguments);null!==r&&t.$off(n,a)}}function Ye(n,e,t){He=n,de(e,t||{},We,Je,Xe,n),He=void 0}var Ze=null;function nt(n){var e=Ze;return Ze=n,function(){Ze=e}}function et(n){for(;n&&(n=n.$parent);)if(n._inactive)return!0;return!1}function tt(n,e){if(e){if(n._directInactive=!1,et(n))return}else if(n._directInactive)return;if(n._inactive||null===n._inactive){n._inactive=!1;for(var t=0;t<n.$children.length;t++)tt(n.$children[t]);at(n,"activated")}}function at(n,e){gn();var t=n.$options[e],a=e+" hook";if(t)for(var r=0,i=t.length;r<i;r++)Vn(t[r],n,null,n,a);n._hasHookEvent&&n.$emit("hook:"+e),fn()}var rt=[],it=[],st={},ot=!1,lt=!1,ct=0;var dt=0,ut=Date.now;if(V&&!X){var mt=window.performance;mt&&"function"==typeof mt.now&&ut()>document.createEvent("Event").timeStamp&&(ut=function(){return mt.now()})}function pt(){var n,e;for(dt=ut(),lt=!0,rt.sort((function(n,e){return n.id-e.id})),ct=0;ct<rt.length;ct++)(n=rt[ct]).before&&n.before(),e=n.id,st[e]=null,n.run();var t=it.slice(),a=rt.slice();ct=rt.length=it.length=0,st={},ot=lt=!1,function(n){for(var e=0;e<n.length;e++)n[e]._inactive=!0,tt(n[e],!0)}(t),function(n){var e=n.length;for(;e--;){var t=n[e],a=t.vm;a._watcher===t&&a._isMounted&&!a._isDestroyed&&at(a,"updated")}}(a),on&&U.devtools&&on.emit("flush")}var ht=0,gt=function(n,e,t,a,r){this.vm=n,r&&(n._watcher=this),n._watchers.push(this),a?(this.deep=!!a.deep,this.user=!!a.user,this.lazy=!!a.lazy,this.sync=!!a.sync,this.before=a.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=t,this.id=++ht,this.active=!0,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new cn,this.newDepIds=new cn,this.expression="","function"==typeof e?this.getter=e:(this.getter=function(n){if(!G.test(n)){var e=n.split(".");return function(n){for(var t=0;t<e.length;t++){if(!n)return;n=n[e[t]]}return n}}}(e),this.getter||(this.getter=M)),this.value=this.lazy?void 0:this.get()};gt.prototype.get=function(){var n;gn(this);var e=this.vm;try{n=this.getter.call(e,e)}catch(n){if(!this.user)throw n;Qn(n,e,'getter for watcher "'+this.expression+'"')}finally{this.deep&&oe(n),fn(),this.cleanupDeps()}return n},gt.prototype.addDep=function(n){var e=n.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(n),this.depIds.has(e)||n.addSub(this))},gt.prototype.cleanupDeps=function(){for(var n=this.deps.length;n--;){var e=this.deps[n];this.newDepIds.has(e.id)||e.removeSub(this)}var t=this.depIds;this.depIds=this.newDepIds,this.newDepIds=t,this.newDepIds.clear(),t=this.deps,this.deps=this.newDeps,this.newDeps=t,this.newDeps.length=0},gt.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():function(n){var e=n.id;if(null==st[e]){if(st[e]=!0,lt){for(var t=rt.length-1;t>ct&&rt[t].id>n.id;)t--;rt.splice(t+1,0,n)}else rt.push(n);ot||(ot=!0,ie(pt))}}(this)},gt.prototype.run=function(){if(this.active){var n=this.get();if(n!==this.value||d(n)||this.deep){var e=this.value;if(this.value=n,this.user){var t='callback for watcher "'+this.expression+'"';Vn(this.cb,this.vm,[n,e],this.vm,t)}else this.cb.call(this.vm,n,e)}}},gt.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},gt.prototype.depend=function(){for(var n=this.deps.length;n--;)this.deps[n].depend()},gt.prototype.teardown=function(){if(this.active){this.vm._isBeingDestroyed||_(this.vm._watchers,this);for(var n=this.deps.length;n--;)this.deps[n].removeSub(this);this.active=!1}};var ft={enumerable:!0,configurable:!0,get:M,set:M};function bt(n,e,t){ft.get=function(){return this[e][t]},ft.set=function(n){this[e][t]=n},Object.defineProperty(n,t,ft)}function yt(n){n._watchers=[];var e=n.$options;e.props&&function(n,e){var t=n.$options.propsData||{},a=n._props={},r=n.$options._propKeys=[];n.$parent&&Sn(!1);var i=function(i){r.push(i);var s=Un(i,e,t,n);Rn(a,i,s),i in n||bt(n,"_props",i)};for(var s in e)i(s);Sn(!0)}(n,e.props),e.methods&&function(n,e){n.$options.props;for(var t in e)n[t]="function"!=typeof e[t]?M:R(e[t],n)}(n,e.methods),e.data?function(n){var e=n.$options.data;m(e=n._data="function"==typeof e?function(n,e){gn();try{return n.call(e,e)}catch(n){return Qn(n,e,"data()"),{}}finally{fn()}}(e,n):e||{})||(e={});var t=Object.keys(e),a=n.$options.props,r=(n.$options.methods,t.length);for(;r--;){var i=t[r];0,a&&E(a,i)||(s=void 0,36!==(s=(i+"").charCodeAt(0))&&95!==s&&bt(n,"_data",i))}var s;wn(e,!0)}(n):wn(n._data={},!0),e.computed&&function(n,e){var t=n._computedWatchers=Object.create(null),a=sn();for(var r in e){var i=e[r],s="function"==typeof i?i:i.get;0,a||(t[r]=new gt(n,s||M,M,vt)),r in n||_t(n,r,i)}}(n,e.computed),e.watch&&e.watch!==tn&&function(n,e){for(var t in e){var a=e[t];if(Array.isArray(a))for(var r=0;r<a.length;r++)Tt(n,t,a[r]);else Tt(n,t,a)}}(n,e.watch)}var vt={lazy:!0};function _t(n,e,t){var a=!sn();"function"==typeof t?(ft.get=a?xt(e):Et(t),ft.set=M):(ft.get=t.get?a&&!1!==t.cache?xt(e):Et(t.get):M,ft.set=t.set||M),Object.defineProperty(n,e,ft)}function xt(n){return function(){var e=this._computedWatchers&&this._computedWatchers[n];if(e)return e.dirty&&e.evaluate(),pn.target&&e.depend(),e.value}}function Et(n){return function(){return n.call(this,this)}}function Tt(n,e,t,a){return m(t)&&(a=t,t=t.handler),"string"==typeof t&&(t=n[t]),n.$watch(e,t,a)}var It=0;function kt(n){var e=n.options;if(n.super){var t=kt(n.super);if(t!==n.superOptions){n.superOptions=t;var a=function(n){var e,t=n.options,a=n.sealedOptions;for(var r in t)t[r]!==a[r]&&(e||(e={}),e[r]=t[r]);return e}(n);a&&z(n.extendOptions,a),(e=n.options=jn(t,n.extendOptions)).name&&(e.components[e.name]=n)}}return e}function St(n){this._init(n)}function qt(n){n.cid=0;var e=1;n.extend=function(n){n=n||{};var t=this,a=t.cid,r=n._Ctor||(n._Ctor={});if(r[a])return r[a];var i=n.name||t.options.name;var s=function(n){this._init(n)};return(s.prototype=Object.create(t.prototype)).constructor=s,s.cid=e++,s.options=jn(t.options,n),s.super=t,s.options.props&&function(n){var e=n.options.props;for(var t in e)bt(n.prototype,"_props",t)}(s),s.options.computed&&function(n){var e=n.options.computed;for(var t in e)_t(n.prototype,t,e[t])}(s),s.extend=t.extend,s.mixin=t.mixin,s.use=t.use,j.forEach((function(n){s[n]=t[n]})),i&&(s.options.components[i]=s),s.superOptions=t.options,s.extendOptions=n,s.sealedOptions=z({},s.options),r[a]=s,s}}function wt(n){return n&&(n.Ctor.options.name||n.tag)}function Rt(n,e){return Array.isArray(n)?n.indexOf(e)>-1:"string"==typeof n?n.split(",").indexOf(e)>-1:!!p(n)&&n.test(e)}function At(n,e){var t=n.cache,a=n.keys,r=n._vnode;for(var i in t){var s=t[i];if(s){var o=s.name;o&&!e(o)&&zt(t,i,a,r)}}}function zt(n,e,t,a){var r=n[e];!r||a&&r.tag===a.tag||r.componentInstance.$destroy(),n[e]=null,_(t,e)}!function(n){n.prototype._init=function(n){var e=this;e._uid=It++,e._isVue=!0,n&&n._isComponent?function(n,e){var t=n.$options=Object.create(n.constructor.options),a=e._parentVnode;t.parent=e.parent,t._parentVnode=a;var r=a.componentOptions;t.propsData=r.propsData,t._parentListeners=r.listeners,t._renderChildren=r.children,t._componentTag=r.tag,e.render&&(t.render=e.render,t.staticRenderFns=e.staticRenderFns)}(e,n):e.$options=jn(kt(e.constructor),n||{},e),e._renderProxy=e,e._self=e,function(n){var e=n.$options,t=e.parent;if(t&&!e.abstract){for(;t.$options.abstract&&t.$parent;)t=t.$parent;t.$children.push(n)}n.$parent=t,n.$root=t?t.$root:n,n.$children=[],n.$refs={},n._watcher=null,n._inactive=null,n._directInactive=!1,n._isMounted=!1,n._isDestroyed=!1,n._isBeingDestroyed=!1}(e),function(n){n._events=Object.create(null),n._hasHookEvent=!1;var e=n.$options._parentListeners;e&&Ye(n,e)}(e),function(n){n._vnode=null,n._staticTrees=null;var e=n.$options,t=n.$vnode=e._parentVnode,a=t&&t.context;n.$slots=fe(e._renderChildren,a),n.$scopedSlots=i,n._c=function(e,t,a,r){return Ge(n,e,t,a,r,!1)},n.$createElement=function(e,t,a,r){return Ge(n,e,t,a,r,!0)};var r=t&&t.data;Rn(n,"$attrs",r&&r.attrs||i,null,!0),Rn(n,"$listeners",e._parentListeners||i,null,!0)}(e),at(e,"beforeCreate"),function(n){var e=ge(n.$options.inject,n);e&&(Sn(!1),Object.keys(e).forEach((function(t){Rn(n,t,e[t])})),Sn(!0))}(e),yt(e),function(n){var e=n.$options.provide;e&&(n._provided="function"==typeof e?e.call(n):e)}(e),at(e,"created"),e.$options.el&&e.$mount(e.$options.el)}}(St),function(n){var e={get:function(){return this._data}},t={get:function(){return this._props}};Object.defineProperty(n.prototype,"$data",e),Object.defineProperty(n.prototype,"$props",t),n.prototype.$set=An,n.prototype.$delete=zn,n.prototype.$watch=function(n,e,t){if(m(e))return Tt(this,n,e,t);(t=t||{}).user=!0;var a=new gt(this,n,e,t);if(t.immediate){var r='callback for immediate watcher "'+a.expression+'"';gn(),Vn(e,this,[a.value],this,r),fn()}return function(){a.teardown()}}}(St),function(n){var e=/^hook:/;n.prototype.$on=function(n,t){var a=this;if(Array.isArray(n))for(var r=0,i=n.length;r<i;r++)a.$on(n[r],t);else(a._events[n]||(a._events[n]=[])).push(t),e.test(n)&&(a._hasHookEvent=!0);return a},n.prototype.$once=function(n,e){var t=this;function a(){t.$off(n,a),e.apply(t,arguments)}return a.fn=e,t.$on(n,a),t},n.prototype.$off=function(n,e){var t=this;if(!arguments.length)return t._events=Object.create(null),t;if(Array.isArray(n)){for(var a=0,r=n.length;a<r;a++)t.$off(n[a],e);return t}var i,s=t._events[n];if(!s)return t;if(!e)return t._events[n]=null,t;for(var o=s.length;o--;)if((i=s[o])===e||i.fn===e){s.splice(o,1);break}return t},n.prototype.$emit=function(n){var e=this,t=e._events[n];if(t){t=t.length>1?A(t):t;for(var a=A(arguments,1),r='event handler for "'+n+'"',i=0,s=t.length;i<s;i++)Vn(t[i],e,a,e,r)}return e}}(St),function(n){n.prototype._update=function(n,e){var t=this,a=t.$el,r=t._vnode,i=nt(t);t._vnode=n,t.$el=r?t.__patch__(r,n):t.__patch__(t.$el,n,e,!1),i(),a&&(a.__vue__=null),t.$el&&(t.$el.__vue__=t),t.$vnode&&t.$parent&&t.$vnode===t.$parent._vnode&&(t.$parent.$el=t.$el)},n.prototype.$forceUpdate=function(){this._watcher&&this._watcher.update()},n.prototype.$destroy=function(){var n=this;if(!n._isBeingDestroyed){at(n,"beforeDestroy"),n._isBeingDestroyed=!0;var e=n.$parent;!e||e._isBeingDestroyed||n.$options.abstract||_(e.$children,n),n._watcher&&n._watcher.teardown();for(var t=n._watchers.length;t--;)n._watchers[t].teardown();n._data.__ob__&&n._data.__ob__.vmCount--,n._isDestroyed=!0,n.__patch__(n._vnode,null),at(n,"destroyed"),n.$off(),n.$el&&(n.$el.__vue__=null),n.$vnode&&(n.$vnode.parent=null)}}}(St),function(n){Oe(n.prototype),n.prototype.$nextTick=function(n){return ie(n,this)},n.prototype._render=function(){var n,e=this,t=e.$options,a=t.render,r=t._parentVnode;r&&(e.$scopedSlots=ve(r.data.scopedSlots,e.$slots,e.$scopedSlots)),e.$vnode=r;try{Qe=e,n=a.call(e._renderProxy,e.$createElement)}catch(t){Qn(t,e,"render"),n=e._vnode}finally{Qe=null}return Array.isArray(n)&&1===n.length&&(n=n[0]),n instanceof bn||(n=vn()),n.parent=r,n}}(St);var Lt=[String,RegExp,Array],Mt={KeepAlive:{name:"keep-alive",abstract:!0,props:{include:Lt,exclude:Lt,max:[String,Number]},methods:{cacheVNode:function(){var n=this.cache,e=this.keys,t=this.vnodeToCache,a=this.keyToCache;if(t){var r=t.tag,i=t.componentInstance,s=t.componentOptions;n[a]={name:wt(s),tag:r,componentInstance:i},e.push(a),this.max&&e.length>parseInt(this.max)&&zt(n,e[0],e,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var n in this.cache)zt(this.cache,n,this.keys)},mounted:function(){var n=this;this.cacheVNode(),this.$watch("include",(function(e){At(n,(function(n){return Rt(e,n)}))})),this.$watch("exclude",(function(e){At(n,(function(n){return!Rt(e,n)}))}))},updated:function(){this.cacheVNode()},render:function(){var n=this.$slots.default,e=Ke(n),t=e&&e.componentOptions;if(t){var a=wt(t),r=this.include,i=this.exclude;if(r&&(!a||!Rt(r,a))||i&&a&&Rt(i,a))return e;var s=this.cache,o=this.keys,l=null==e.key?t.Ctor.cid+(t.tag?"::"+t.tag:""):e.key;s[l]?(e.componentInstance=s[l].componentInstance,_(o,l),o.push(l)):(this.vnodeToCache=e,this.keyToCache=l),e.data.keepAlive=!0}return e||n&&n[0]}}};!function(n){var e={get:function(){return U}};Object.defineProperty(n,"config",e),n.util={warn:un,extend:z,mergeOptions:jn,defineReactive:Rn},n.set=An,n.delete=zn,n.nextTick=ie,n.observable=function(n){return wn(n),n},n.options=Object.create(null),j.forEach((function(e){n.options[e+"s"]=Object.create(null)})),n.options._base=n,z(n.options.components,Mt),function(n){n.use=function(n){var e=this._installedPlugins||(this._installedPlugins=[]);if(e.indexOf(n)>-1)return this;var t=A(arguments,1);return t.unshift(this),"function"==typeof n.install?n.install.apply(n,t):"function"==typeof n&&n.apply(null,t),e.push(n),this}}(n),function(n){n.mixin=function(n){return this.options=jn(this.options,n),this}}(n),qt(n),function(n){j.forEach((function(e){n[e]=function(n,t){return t?("component"===e&&m(t)&&(t.name=t.name||n,t=this.options._base.extend(t)),"directive"===e&&"function"==typeof t&&(t={bind:t,update:t}),this.options[e+"s"][n]=t,t):this.options[e+"s"][n]}}))}(n)}(St),Object.defineProperty(St.prototype,"$isServer",{get:sn}),Object.defineProperty(St.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}}),Object.defineProperty(St,"FunctionalRenderContext",{value:Ce}),St.version="2.6.14";var Dt=y("style,class"),Bt=y("input,textarea,option,select,progress"),Ot=y("contenteditable,draggable,spellcheck"),Ct=y("events,caret,typing,plaintext-only"),Nt=y("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),jt="http://www.w3.org/1999/xlink",Pt=function(n){return":"===n.charAt(5)&&"xlink"===n.slice(0,5)},Ut=function(n){return Pt(n)?n.slice(6,n.length):""},Ft=function(n){return null==n||!1===n};function $t(n){for(var e=n.data,t=n,a=n;o(a.componentInstance);)(a=a.componentInstance._vnode)&&a.data&&(e=Gt(a.data,e));for(;o(t=t.parent);)t&&t.data&&(e=Gt(e,t.data));return function(n,e){if(o(n)||o(e))return Ht(n,Qt(e));return""}(e.staticClass,e.class)}function Gt(n,e){return{staticClass:Ht(n.staticClass,e.staticClass),class:o(n.class)?[n.class,e.class]:e.class}}function Ht(n,e){return n?e?n+" "+e:n:e||""}function Qt(n){return Array.isArray(n)?function(n){for(var e,t="",a=0,r=n.length;a<r;a++)o(e=Qt(n[a]))&&""!==e&&(t&&(t+=" "),t+=e);return t}(n):d(n)?function(n){var e="";for(var t in n)n[t]&&(e&&(e+=" "),e+=t);return e}(n):"string"==typeof n?n:""}var Vt={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Kt=y("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Wt=y("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),Jt=function(n){return Kt(n)||Wt(n)};var Xt=Object.create(null);var Yt=y("text,number,password,search,email,tel,url");var Zt=Object.freeze({createElement:function(n,e){var t=document.createElement(n);return"select"!==n||e.data&&e.data.attrs&&void 0!==e.data.attrs.multiple&&t.setAttribute("multiple","multiple"),t},createElementNS:function(n,e){return document.createElementNS(Vt[n],e)},createTextNode:function(n){return document.createTextNode(n)},createComment:function(n){return document.createComment(n)},insertBefore:function(n,e,t){n.insertBefore(e,t)},removeChild:function(n,e){n.removeChild(e)},appendChild:function(n,e){n.appendChild(e)},parentNode:function(n){return n.parentNode},nextSibling:function(n){return n.nextSibling},tagName:function(n){return n.tagName},setTextContent:function(n,e){n.textContent=e},setStyleScope:function(n,e){n.setAttribute(e,"")}}),na={create:function(n,e){ea(e)},update:function(n,e){n.data.ref!==e.data.ref&&(ea(n,!0),ea(e))},destroy:function(n){ea(n,!0)}};function ea(n,e){var t=n.data.ref;if(o(t)){var a=n.context,r=n.componentInstance||n.elm,i=a.$refs;e?Array.isArray(i[t])?_(i[t],r):i[t]===r&&(i[t]=void 0):n.data.refInFor?Array.isArray(i[t])?i[t].indexOf(r)<0&&i[t].push(r):i[t]=[r]:i[t]=r}}var ta=new bn("",{},[]),aa=["create","activate","update","remove","destroy"];function ra(n,e){return n.key===e.key&&n.asyncFactory===e.asyncFactory&&(n.tag===e.tag&&n.isComment===e.isComment&&o(n.data)===o(e.data)&&function(n,e){if("input"!==n.tag)return!0;var t,a=o(t=n.data)&&o(t=t.attrs)&&t.type,r=o(t=e.data)&&o(t=t.attrs)&&t.type;return a===r||Yt(a)&&Yt(r)}(n,e)||l(n.isAsyncPlaceholder)&&s(e.asyncFactory.error))}function ia(n,e,t){var a,r,i={};for(a=e;a<=t;++a)o(r=n[a].key)&&(i[r]=a);return i}var sa={create:oa,update:oa,destroy:function(n){oa(n,ta)}};function oa(n,e){(n.data.directives||e.data.directives)&&function(n,e){var t,a,r,i=n===ta,s=e===ta,o=ca(n.data.directives,n.context),l=ca(e.data.directives,e.context),c=[],d=[];for(t in l)a=o[t],r=l[t],a?(r.oldValue=a.value,r.oldArg=a.arg,ua(r,"update",e,n),r.def&&r.def.componentUpdated&&d.push(r)):(ua(r,"bind",e,n),r.def&&r.def.inserted&&c.push(r));if(c.length){var u=function(){for(var t=0;t<c.length;t++)ua(c[t],"inserted",e,n)};i?ue(e,"insert",u):u()}d.length&&ue(e,"postpatch",(function(){for(var t=0;t<d.length;t++)ua(d[t],"componentUpdated",e,n)}));if(!i)for(t in o)l[t]||ua(o[t],"unbind",n,n,s)}(n,e)}var la=Object.create(null);function ca(n,e){var t,a,r=Object.create(null);if(!n)return r;for(t=0;t<n.length;t++)(a=n[t]).modifiers||(a.modifiers=la),r[da(a)]=a,a.def=Pn(e.$options,"directives",a.name);return r}function da(n){return n.rawName||n.name+"."+Object.keys(n.modifiers||{}).join(".")}function ua(n,e,t,a,r){var i=n.def&&n.def[e];if(i)try{i(t.elm,n,t,a,r)}catch(a){Qn(a,t.context,"directive "+n.name+" "+e+" hook")}}var ma=[na,sa];function pa(n,e){var t=e.componentOptions;if(!(o(t)&&!1===t.Ctor.options.inheritAttrs||s(n.data.attrs)&&s(e.data.attrs))){var a,r,i=e.elm,l=n.data.attrs||{},c=e.data.attrs||{};for(a in o(c.__ob__)&&(c=e.data.attrs=z({},c)),c)r=c[a],l[a]!==r&&ha(i,a,r,e.data.pre);for(a in(X||Z)&&c.value!==l.value&&ha(i,"value",c.value),l)s(c[a])&&(Pt(a)?i.removeAttributeNS(jt,Ut(a)):Ot(a)||i.removeAttribute(a))}}function ha(n,e,t,a){a||n.tagName.indexOf("-")>-1?ga(n,e,t):Nt(e)?Ft(t)?n.removeAttribute(e):(t="allowfullscreen"===e&&"EMBED"===n.tagName?"true":e,n.setAttribute(e,t)):Ot(e)?n.setAttribute(e,function(n,e){return Ft(e)||"false"===e?"false":"contenteditable"===n&&Ct(e)?e:"true"}(e,t)):Pt(e)?Ft(t)?n.removeAttributeNS(jt,Ut(e)):n.setAttributeNS(jt,e,t):ga(n,e,t)}function ga(n,e,t){if(Ft(t))n.removeAttribute(e);else{if(X&&!Y&&"TEXTAREA"===n.tagName&&"placeholder"===e&&""!==t&&!n.__ieph){var a=function(e){e.stopImmediatePropagation(),n.removeEventListener("input",a)};n.addEventListener("input",a),n.__ieph=!0}n.setAttribute(e,t)}}var fa={create:pa,update:pa};function ba(n,e){var t=e.elm,a=e.data,r=n.data;if(!(s(a.staticClass)&&s(a.class)&&(s(r)||s(r.staticClass)&&s(r.class)))){var i=$t(e),l=t._transitionClasses;o(l)&&(i=Ht(i,Qt(l))),i!==t._prevClass&&(t.setAttribute("class",i),t._prevClass=i)}}var ya,va={create:ba,update:ba};function _a(n,e,t){var a=ya;return function r(){var i=e.apply(null,arguments);null!==i&&Ta(n,r,t,a)}}var xa=Xn&&!(en&&Number(en[1])<=53);function Ea(n,e,t,a){if(xa){var r=dt,i=e;e=i._wrapper=function(n){if(n.target===n.currentTarget||n.timeStamp>=r||n.timeStamp<=0||n.target.ownerDocument!==document)return i.apply(this,arguments)}}ya.addEventListener(n,e,an?{capture:t,passive:a}:t)}function Ta(n,e,t,a){(a||ya).removeEventListener(n,e._wrapper||e,t)}function Ia(n,e){if(!s(n.data.on)||!s(e.data.on)){var t=e.data.on||{},a=n.data.on||{};ya=e.elm,function(n){if(o(n.__r)){var e=X?"change":"input";n[e]=[].concat(n.__r,n[e]||[]),delete n.__r}o(n.__c)&&(n.change=[].concat(n.__c,n.change||[]),delete n.__c)}(t),de(t,a,Ea,Ta,_a,e.context),ya=void 0}}var ka,Sa={create:Ia,update:Ia};function qa(n,e){if(!s(n.data.domProps)||!s(e.data.domProps)){var t,a,r=e.elm,i=n.data.domProps||{},l=e.data.domProps||{};for(t in o(l.__ob__)&&(l=e.data.domProps=z({},l)),i)t in l||(r[t]="");for(t in l){if(a=l[t],"textContent"===t||"innerHTML"===t){if(e.children&&(e.children.length=0),a===i[t])continue;1===r.childNodes.length&&r.removeChild(r.childNodes[0])}if("value"===t&&"PROGRESS"!==r.tagName){r._value=a;var c=s(a)?"":String(a);wa(r,c)&&(r.value=c)}else if("innerHTML"===t&&Wt(r.tagName)&&s(r.innerHTML)){(ka=ka||document.createElement("div")).innerHTML="<svg>"+a+"</svg>";for(var d=ka.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;d.firstChild;)r.appendChild(d.firstChild)}else if(a!==i[t])try{r[t]=a}catch(n){}}}}function wa(n,e){return!n.composing&&("OPTION"===n.tagName||function(n,e){var t=!0;try{t=document.activeElement!==n}catch(n){}return t&&n.value!==e}(n,e)||function(n,e){var t=n.value,a=n._vModifiers;if(o(a)){if(a.number)return b(t)!==b(e);if(a.trim)return t.trim()!==e.trim()}return t!==e}(n,e))}var Ra={create:qa,update:qa},Aa=T((function(n){var e={},t=/:(.+)/;return n.split(/;(?![^(]*\))/g).forEach((function(n){if(n){var a=n.split(t);a.length>1&&(e[a[0].trim()]=a[1].trim())}})),e}));function za(n){var e=La(n.style);return n.staticStyle?z(n.staticStyle,e):e}function La(n){return Array.isArray(n)?L(n):"string"==typeof n?Aa(n):n}var Ma,Da=/^--/,Ba=/\s*!important$/,Oa=function(n,e,t){if(Da.test(e))n.style.setProperty(e,t);else if(Ba.test(t))n.style.setProperty(w(e),t.replace(Ba,""),"important");else{var a=Na(e);if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n.style[a]=t[r];else n.style[a]=t}},Ca=["Webkit","Moz","ms"],Na=T((function(n){if(Ma=Ma||document.createElement("div").style,"filter"!==(n=k(n))&&n in Ma)return n;for(var e=n.charAt(0).toUpperCase()+n.slice(1),t=0;t<Ca.length;t++){var a=Ca[t]+e;if(a in Ma)return a}}));function ja(n,e){var t=e.data,a=n.data;if(!(s(t.staticStyle)&&s(t.style)&&s(a.staticStyle)&&s(a.style))){var r,i,l=e.elm,c=a.staticStyle,d=a.normalizedStyle||a.style||{},u=c||d,m=La(e.data.style)||{};e.data.normalizedStyle=o(m.__ob__)?z({},m):m;var p=function(n,e){var t,a={};if(e)for(var r=n;r.componentInstance;)(r=r.componentInstance._vnode)&&r.data&&(t=za(r.data))&&z(a,t);(t=za(n.data))&&z(a,t);for(var i=n;i=i.parent;)i.data&&(t=za(i.data))&&z(a,t);return a}(e,!0);for(i in u)s(p[i])&&Oa(l,i,"");for(i in p)(r=p[i])!==u[i]&&Oa(l,i,null==r?"":r)}}var Pa={create:ja,update:ja},Ua=/\s+/;function Fa(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(Ua).forEach((function(e){return n.classList.add(e)})):n.classList.add(e);else{var t=" "+(n.getAttribute("class")||"")+" ";t.indexOf(" "+e+" ")<0&&n.setAttribute("class",(t+e).trim())}}function $a(n,e){if(e&&(e=e.trim()))if(n.classList)e.indexOf(" ")>-1?e.split(Ua).forEach((function(e){return n.classList.remove(e)})):n.classList.remove(e),n.classList.length||n.removeAttribute("class");else{for(var t=" "+(n.getAttribute("class")||"")+" ",a=" "+e+" ";t.indexOf(a)>=0;)t=t.replace(a," ");(t=t.trim())?n.setAttribute("class",t):n.removeAttribute("class")}}function Ga(n){if(n){if("object"==typeof n){var e={};return!1!==n.css&&z(e,Ha(n.name||"v")),z(e,n),e}return"string"==typeof n?Ha(n):void 0}}var Ha=T((function(n){return{enterClass:n+"-enter",enterToClass:n+"-enter-to",enterActiveClass:n+"-enter-active",leaveClass:n+"-leave",leaveToClass:n+"-leave-to",leaveActiveClass:n+"-leave-active"}})),Qa=V&&!Y,Va="transition",Ka="transitionend",Wa="animation",Ja="animationend";Qa&&(void 0===window.ontransitionend&&void 0!==window.onwebkittransitionend&&(Va="WebkitTransition",Ka="webkitTransitionEnd"),void 0===window.onanimationend&&void 0!==window.onwebkitanimationend&&(Wa="WebkitAnimation",Ja="webkitAnimationEnd"));var Xa=V?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(n){return n()};function Ya(n){Xa((function(){Xa(n)}))}function Za(n,e){var t=n._transitionClasses||(n._transitionClasses=[]);t.indexOf(e)<0&&(t.push(e),Fa(n,e))}function nr(n,e){n._transitionClasses&&_(n._transitionClasses,e),$a(n,e)}function er(n,e,t){var a=ar(n,e),r=a.type,i=a.timeout,s=a.propCount;if(!r)return t();var o="transition"===r?Ka:Ja,l=0,c=function(){n.removeEventListener(o,d),t()},d=function(e){e.target===n&&++l>=s&&c()};setTimeout((function(){l<s&&c()}),i+1),n.addEventListener(o,d)}var tr=/\b(transform|all)(,|$)/;function ar(n,e){var t,a=window.getComputedStyle(n),r=(a[Va+"Delay"]||"").split(", "),i=(a[Va+"Duration"]||"").split(", "),s=rr(r,i),o=(a[Wa+"Delay"]||"").split(", "),l=(a[Wa+"Duration"]||"").split(", "),c=rr(o,l),d=0,u=0;return"transition"===e?s>0&&(t="transition",d=s,u=i.length):"animation"===e?c>0&&(t="animation",d=c,u=l.length):u=(t=(d=Math.max(s,c))>0?s>c?"transition":"animation":null)?"transition"===t?i.length:l.length:0,{type:t,timeout:d,propCount:u,hasTransform:"transition"===t&&tr.test(a[Va+"Property"])}}function rr(n,e){for(;n.length<e.length;)n=n.concat(n);return Math.max.apply(null,e.map((function(e,t){return ir(e)+ir(n[t])})))}function ir(n){return 1e3*Number(n.slice(0,-1).replace(",","."))}function sr(n,e){var t=n.elm;o(t._leaveCb)&&(t._leaveCb.cancelled=!0,t._leaveCb());var a=Ga(n.data.transition);if(!s(a)&&!o(t._enterCb)&&1===t.nodeType){for(var r=a.css,i=a.type,l=a.enterClass,c=a.enterToClass,u=a.enterActiveClass,m=a.appearClass,p=a.appearToClass,h=a.appearActiveClass,g=a.beforeEnter,f=a.enter,y=a.afterEnter,v=a.enterCancelled,_=a.beforeAppear,x=a.appear,E=a.afterAppear,T=a.appearCancelled,I=a.duration,k=Ze,S=Ze.$vnode;S&&S.parent;)k=S.context,S=S.parent;var q=!k._isMounted||!n.isRootInsert;if(!q||x||""===x){var w=q&&m?m:l,R=q&&h?h:u,A=q&&p?p:c,z=q&&_||g,L=q&&"function"==typeof x?x:f,M=q&&E||y,D=q&&T||v,B=b(d(I)?I.enter:I);0;var O=!1!==r&&!Y,C=cr(L),j=t._enterCb=N((function(){O&&(nr(t,A),nr(t,R)),j.cancelled?(O&&nr(t,w),D&&D(t)):M&&M(t),t._enterCb=null}));n.data.show||ue(n,"insert",(function(){var e=t.parentNode,a=e&&e._pending&&e._pending[n.key];a&&a.tag===n.tag&&a.elm._leaveCb&&a.elm._leaveCb(),L&&L(t,j)})),z&&z(t),O&&(Za(t,w),Za(t,R),Ya((function(){nr(t,w),j.cancelled||(Za(t,A),C||(lr(B)?setTimeout(j,B):er(t,i,j)))}))),n.data.show&&(e&&e(),L&&L(t,j)),O||C||j()}}}function or(n,e){var t=n.elm;o(t._enterCb)&&(t._enterCb.cancelled=!0,t._enterCb());var a=Ga(n.data.transition);if(s(a)||1!==t.nodeType)return e();if(!o(t._leaveCb)){var r=a.css,i=a.type,l=a.leaveClass,c=a.leaveToClass,u=a.leaveActiveClass,m=a.beforeLeave,p=a.leave,h=a.afterLeave,g=a.leaveCancelled,f=a.delayLeave,y=a.duration,v=!1!==r&&!Y,_=cr(p),x=b(d(y)?y.leave:y);0;var E=t._leaveCb=N((function(){t.parentNode&&t.parentNode._pending&&(t.parentNode._pending[n.key]=null),v&&(nr(t,c),nr(t,u)),E.cancelled?(v&&nr(t,l),g&&g(t)):(e(),h&&h(t)),t._leaveCb=null}));f?f(T):T()}function T(){E.cancelled||(!n.data.show&&t.parentNode&&((t.parentNode._pending||(t.parentNode._pending={}))[n.key]=n),m&&m(t),v&&(Za(t,l),Za(t,u),Ya((function(){nr(t,l),E.cancelled||(Za(t,c),_||(lr(x)?setTimeout(E,x):er(t,i,E)))}))),p&&p(t,E),v||_||E())}}function lr(n){return"number"==typeof n&&!isNaN(n)}function cr(n){if(s(n))return!1;var e=n.fns;return o(e)?cr(Array.isArray(e)?e[0]:e):(n._length||n.length)>1}function dr(n,e){!0!==e.data.show&&sr(e)}var ur=function(n){var e,t,a={},r=n.modules,i=n.nodeOps;for(e=0;e<aa.length;++e)for(a[aa[e]]=[],t=0;t<r.length;++t)o(r[t][aa[e]])&&a[aa[e]].push(r[t][aa[e]]);function d(n){var e=i.parentNode(n);o(e)&&i.removeChild(e,n)}function u(n,e,t,r,s,c,d){if(o(n.elm)&&o(c)&&(n=c[d]=xn(n)),n.isRootInsert=!s,!function(n,e,t,r){var i=n.data;if(o(i)){var s=o(n.componentInstance)&&i.keepAlive;if(o(i=i.hook)&&o(i=i.init)&&i(n,!1),o(n.componentInstance))return m(n,e),p(t,n.elm,r),l(s)&&function(n,e,t,r){var i,s=n;for(;s.componentInstance;)if(s=s.componentInstance._vnode,o(i=s.data)&&o(i=i.transition)){for(i=0;i<a.activate.length;++i)a.activate[i](ta,s);e.push(s);break}p(t,n.elm,r)}(n,e,t,r),!0}}(n,e,t,r)){var u=n.data,g=n.children,y=n.tag;o(y)?(n.elm=n.ns?i.createElementNS(n.ns,y):i.createElement(y,n),b(n),h(n,g,e),o(u)&&f(n,e),p(t,n.elm,r)):l(n.isComment)?(n.elm=i.createComment(n.text),p(t,n.elm,r)):(n.elm=i.createTextNode(n.text),p(t,n.elm,r))}}function m(n,e){o(n.data.pendingInsert)&&(e.push.apply(e,n.data.pendingInsert),n.data.pendingInsert=null),n.elm=n.componentInstance.$el,g(n)?(f(n,e),b(n)):(ea(n),e.push(n))}function p(n,e,t){o(n)&&(o(t)?i.parentNode(t)===n&&i.insertBefore(n,e,t):i.appendChild(n,e))}function h(n,e,t){if(Array.isArray(e)){0;for(var a=0;a<e.length;++a)u(e[a],t,n.elm,null,!0,e,a)}else c(n.text)&&i.appendChild(n.elm,i.createTextNode(String(n.text)))}function g(n){for(;n.componentInstance;)n=n.componentInstance._vnode;return o(n.tag)}function f(n,t){for(var r=0;r<a.create.length;++r)a.create[r](ta,n);o(e=n.data.hook)&&(o(e.create)&&e.create(ta,n),o(e.insert)&&t.push(n))}function b(n){var e;if(o(e=n.fnScopeId))i.setStyleScope(n.elm,e);else for(var t=n;t;)o(e=t.context)&&o(e=e.$options._scopeId)&&i.setStyleScope(n.elm,e),t=t.parent;o(e=Ze)&&e!==n.context&&e!==n.fnContext&&o(e=e.$options._scopeId)&&i.setStyleScope(n.elm,e)}function v(n,e,t,a,r,i){for(;a<=r;++a)u(t[a],i,n,e,!1,t,a)}function _(n){var e,t,r=n.data;if(o(r))for(o(e=r.hook)&&o(e=e.destroy)&&e(n),e=0;e<a.destroy.length;++e)a.destroy[e](n);if(o(e=n.children))for(t=0;t<n.children.length;++t)_(n.children[t])}function x(n,e,t){for(;e<=t;++e){var a=n[e];o(a)&&(o(a.tag)?(E(a),_(a)):d(a.elm))}}function E(n,e){if(o(e)||o(n.data)){var t,r=a.remove.length+1;for(o(e)?e.listeners+=r:e=function(n,e){function t(){0==--t.listeners&&d(n)}return t.listeners=e,t}(n.elm,r),o(t=n.componentInstance)&&o(t=t._vnode)&&o(t.data)&&E(t,e),t=0;t<a.remove.length;++t)a.remove[t](n,e);o(t=n.data.hook)&&o(t=t.remove)?t(n,e):e()}else d(n.elm)}function T(n,e,t,a){for(var r=t;r<a;r++){var i=e[r];if(o(i)&&ra(n,i))return r}}function I(n,e,t,r,c,d){if(n!==e){o(e.elm)&&o(r)&&(e=r[c]=xn(e));var m=e.elm=n.elm;if(l(n.isAsyncPlaceholder))o(e.asyncFactory.resolved)?q(n.elm,e,t):e.isAsyncPlaceholder=!0;else if(l(e.isStatic)&&l(n.isStatic)&&e.key===n.key&&(l(e.isCloned)||l(e.isOnce)))e.componentInstance=n.componentInstance;else{var p,h=e.data;o(h)&&o(p=h.hook)&&o(p=p.prepatch)&&p(n,e);var f=n.children,b=e.children;if(o(h)&&g(e)){for(p=0;p<a.update.length;++p)a.update[p](n,e);o(p=h.hook)&&o(p=p.update)&&p(n,e)}s(e.text)?o(f)&&o(b)?f!==b&&function(n,e,t,a,r){var l,c,d,m=0,p=0,h=e.length-1,g=e[0],f=e[h],b=t.length-1,y=t[0],_=t[b],E=!r;for(0;m<=h&&p<=b;)s(g)?g=e[++m]:s(f)?f=e[--h]:ra(g,y)?(I(g,y,a,t,p),g=e[++m],y=t[++p]):ra(f,_)?(I(f,_,a,t,b),f=e[--h],_=t[--b]):ra(g,_)?(I(g,_,a,t,b),E&&i.insertBefore(n,g.elm,i.nextSibling(f.elm)),g=e[++m],_=t[--b]):ra(f,y)?(I(f,y,a,t,p),E&&i.insertBefore(n,f.elm,g.elm),f=e[--h],y=t[++p]):(s(l)&&(l=ia(e,m,h)),s(c=o(y.key)?l[y.key]:T(y,e,m,h))?u(y,a,n,g.elm,!1,t,p):ra(d=e[c],y)?(I(d,y,a,t,p),e[c]=void 0,E&&i.insertBefore(n,d.elm,g.elm)):u(y,a,n,g.elm,!1,t,p),y=t[++p]);m>h?v(n,s(t[b+1])?null:t[b+1].elm,t,p,b,a):p>b&&x(e,m,h)}(m,f,b,t,d):o(b)?(o(n.text)&&i.setTextContent(m,""),v(m,null,b,0,b.length-1,t)):o(f)?x(f,0,f.length-1):o(n.text)&&i.setTextContent(m,""):n.text!==e.text&&i.setTextContent(m,e.text),o(h)&&o(p=h.hook)&&o(p=p.postpatch)&&p(n,e)}}}function k(n,e,t){if(l(t)&&o(n.parent))n.parent.data.pendingInsert=e;else for(var a=0;a<e.length;++a)e[a].data.hook.insert(e[a])}var S=y("attrs,class,staticClass,staticStyle,key");function q(n,e,t,a){var r,i=e.tag,s=e.data,c=e.children;if(a=a||s&&s.pre,e.elm=n,l(e.isComment)&&o(e.asyncFactory))return e.isAsyncPlaceholder=!0,!0;if(o(s)&&(o(r=s.hook)&&o(r=r.init)&&r(e,!0),o(r=e.componentInstance)))return m(e,t),!0;if(o(i)){if(o(c))if(n.hasChildNodes())if(o(r=s)&&o(r=r.domProps)&&o(r=r.innerHTML)){if(r!==n.innerHTML)return!1}else{for(var d=!0,u=n.firstChild,p=0;p<c.length;p++){if(!u||!q(u,c[p],t,a)){d=!1;break}u=u.nextSibling}if(!d||u)return!1}else h(e,c,t);if(o(s)){var g=!1;for(var b in s)if(!S(b)){g=!0,f(e,t);break}!g&&s.class&&oe(s.class)}}else n.data!==e.text&&(n.data=e.text);return!0}return function(n,e,t,r){if(!s(e)){var c,d=!1,m=[];if(s(n))d=!0,u(e,m);else{var p=o(n.nodeType);if(!p&&ra(n,e))I(n,e,m,null,null,r);else{if(p){if(1===n.nodeType&&n.hasAttribute("data-server-rendered")&&(n.removeAttribute("data-server-rendered"),t=!0),l(t)&&q(n,e,m))return k(e,m,!0),n;c=n,n=new bn(i.tagName(c).toLowerCase(),{},[],void 0,c)}var h=n.elm,f=i.parentNode(h);if(u(e,m,h._leaveCb?null:f,i.nextSibling(h)),o(e.parent))for(var b=e.parent,y=g(e);b;){for(var v=0;v<a.destroy.length;++v)a.destroy[v](b);if(b.elm=e.elm,y){for(var E=0;E<a.create.length;++E)a.create[E](ta,b);var T=b.data.hook.insert;if(T.merged)for(var S=1;S<T.fns.length;S++)T.fns[S]()}else ea(b);b=b.parent}o(f)?x([n],0,0):o(n.tag)&&_(n)}}return k(e,m,d),e.elm}o(n)&&_(n)}}({nodeOps:Zt,modules:[fa,va,Sa,Ra,Pa,V?{create:dr,activate:dr,remove:function(n,e){!0!==n.data.show?or(n,e):e()}}:{}].concat(ma)});Y&&document.addEventListener("selectionchange",(function(){var n=document.activeElement;n&&n.vmodel&&vr(n,"input")}));var mr={inserted:function(n,e,t,a){"select"===t.tag?(a.elm&&!a.elm._vOptions?ue(t,"postpatch",(function(){mr.componentUpdated(n,e,t)})):pr(n,e,t.context),n._vOptions=[].map.call(n.options,fr)):("textarea"===t.tag||Yt(n.type))&&(n._vModifiers=e.modifiers,e.modifiers.lazy||(n.addEventListener("compositionstart",br),n.addEventListener("compositionend",yr),n.addEventListener("change",yr),Y&&(n.vmodel=!0)))},componentUpdated:function(n,e,t){if("select"===t.tag){pr(n,e,t.context);var a=n._vOptions,r=n._vOptions=[].map.call(n.options,fr);if(r.some((function(n,e){return!O(n,a[e])})))(n.multiple?e.value.some((function(n){return gr(n,r)})):e.value!==e.oldValue&&gr(e.value,r))&&vr(n,"change")}}};function pr(n,e,t){hr(n,e,t),(X||Z)&&setTimeout((function(){hr(n,e,t)}),0)}function hr(n,e,t){var a=e.value,r=n.multiple;if(!r||Array.isArray(a)){for(var i,s,o=0,l=n.options.length;o<l;o++)if(s=n.options[o],r)i=C(a,fr(s))>-1,s.selected!==i&&(s.selected=i);else if(O(fr(s),a))return void(n.selectedIndex!==o&&(n.selectedIndex=o));r||(n.selectedIndex=-1)}}function gr(n,e){return e.every((function(e){return!O(e,n)}))}function fr(n){return"_value"in n?n._value:n.value}function br(n){n.target.composing=!0}function yr(n){n.target.composing&&(n.target.composing=!1,vr(n.target,"input"))}function vr(n,e){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),n.dispatchEvent(t)}function _r(n){return!n.componentInstance||n.data&&n.data.transition?n:_r(n.componentInstance._vnode)}var xr={model:mr,show:{bind:function(n,e,t){var a=e.value,r=(t=_r(t)).data&&t.data.transition,i=n.__vOriginalDisplay="none"===n.style.display?"":n.style.display;a&&r?(t.data.show=!0,sr(t,(function(){n.style.display=i}))):n.style.display=a?i:"none"},update:function(n,e,t){var a=e.value;!a!=!e.oldValue&&((t=_r(t)).data&&t.data.transition?(t.data.show=!0,a?sr(t,(function(){n.style.display=n.__vOriginalDisplay})):or(t,(function(){n.style.display="none"}))):n.style.display=a?n.__vOriginalDisplay:"none")},unbind:function(n,e,t,a,r){r||(n.style.display=n.__vOriginalDisplay)}}},Er={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function Tr(n){var e=n&&n.componentOptions;return e&&e.Ctor.options.abstract?Tr(Ke(e.children)):n}function Ir(n){var e={},t=n.$options;for(var a in t.propsData)e[a]=n[a];var r=t._parentListeners;for(var i in r)e[k(i)]=r[i];return e}function kr(n,e){if(/\d-keep-alive$/.test(e.tag))return n("keep-alive",{props:e.componentOptions.propsData})}var Sr=function(n){return n.tag||ye(n)},qr=function(n){return"show"===n.name},wr={name:"transition",props:Er,abstract:!0,render:function(n){var e=this,t=this.$slots.default;if(t&&(t=t.filter(Sr)).length){0;var a=this.mode;0;var r=t[0];if(function(n){for(;n=n.parent;)if(n.data.transition)return!0}(this.$vnode))return r;var i=Tr(r);if(!i)return r;if(this._leaving)return kr(n,r);var s="__transition-"+this._uid+"-";i.key=null==i.key?i.isComment?s+"comment":s+i.tag:c(i.key)?0===String(i.key).indexOf(s)?i.key:s+i.key:i.key;var o=(i.data||(i.data={})).transition=Ir(this),l=this._vnode,d=Tr(l);if(i.data.directives&&i.data.directives.some(qr)&&(i.data.show=!0),d&&d.data&&!function(n,e){return e.key===n.key&&e.tag===n.tag}(i,d)&&!ye(d)&&(!d.componentInstance||!d.componentInstance._vnode.isComment)){var u=d.data.transition=z({},o);if("out-in"===a)return this._leaving=!0,ue(u,"afterLeave",(function(){e._leaving=!1,e.$forceUpdate()})),kr(n,r);if("in-out"===a){if(ye(i))return l;var m,p=function(){m()};ue(o,"afterEnter",p),ue(o,"enterCancelled",p),ue(u,"delayLeave",(function(n){m=n}))}}return r}}},Rr=z({tag:String,moveClass:String},Er);function Ar(n){n.elm._moveCb&&n.elm._moveCb(),n.elm._enterCb&&n.elm._enterCb()}function zr(n){n.data.newPos=n.elm.getBoundingClientRect()}function Lr(n){var e=n.data.pos,t=n.data.newPos,a=e.left-t.left,r=e.top-t.top;if(a||r){n.data.moved=!0;var i=n.elm.style;i.transform=i.WebkitTransform="translate("+a+"px,"+r+"px)",i.transitionDuration="0s"}}delete Rr.mode;var Mr={Transition:wr,TransitionGroup:{props:Rr,beforeMount:function(){var n=this,e=this._update;this._update=function(t,a){var r=nt(n);n.__patch__(n._vnode,n.kept,!1,!0),n._vnode=n.kept,r(),e.call(n,t,a)}},render:function(n){for(var e=this.tag||this.$vnode.data.tag||"span",t=Object.create(null),a=this.prevChildren=this.children,r=this.$slots.default||[],i=this.children=[],s=Ir(this),o=0;o<r.length;o++){var l=r[o];if(l.tag)if(null!=l.key&&0!==String(l.key).indexOf("__vlist"))i.push(l),t[l.key]=l,(l.data||(l.data={})).transition=s;else;}if(a){for(var c=[],d=[],u=0;u<a.length;u++){var m=a[u];m.data.transition=s,m.data.pos=m.elm.getBoundingClientRect(),t[m.key]?c.push(m):d.push(m)}this.kept=n(e,null,c),this.removed=d}return n(e,null,i)},updated:function(){var n=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";n.length&&this.hasMove(n[0].elm,e)&&(n.forEach(Ar),n.forEach(zr),n.forEach(Lr),this._reflow=document.body.offsetHeight,n.forEach((function(n){if(n.data.moved){var t=n.elm,a=t.style;Za(t,e),a.transform=a.WebkitTransform=a.transitionDuration="",t.addEventListener(Ka,t._moveCb=function n(a){a&&a.target!==t||a&&!/transform$/.test(a.propertyName)||(t.removeEventListener(Ka,n),t._moveCb=null,nr(t,e))})}})))},methods:{hasMove:function(n,e){if(!Qa)return!1;if(this._hasMove)return this._hasMove;var t=n.cloneNode();n._transitionClasses&&n._transitionClasses.forEach((function(n){$a(t,n)})),Fa(t,e),t.style.display="none",this.$el.appendChild(t);var a=ar(t);return this.$el.removeChild(t),this._hasMove=a.hasTransform}}}};St.config.mustUseProp=function(n,e,t){return"value"===t&&Bt(n)&&"button"!==e||"selected"===t&&"option"===n||"checked"===t&&"input"===n||"muted"===t&&"video"===n},St.config.isReservedTag=Jt,St.config.isReservedAttr=Dt,St.config.getTagNamespace=function(n){return Wt(n)?"svg":"math"===n?"math":void 0},St.config.isUnknownElement=function(n){if(!V)return!0;if(Jt(n))return!1;if(n=n.toLowerCase(),null!=Xt[n])return Xt[n];var e=document.createElement(n);return n.indexOf("-")>-1?Xt[n]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:Xt[n]=/HTMLUnknownElement/.test(e.toString())},z(St.options.directives,xr),z(St.options.components,Mr),St.prototype.__patch__=V?ur:M,St.prototype.$mount=function(n,e){return function(n,e,t){var a;return n.$el=e,n.$options.render||(n.$options.render=vn),at(n,"beforeMount"),a=function(){n._update(n._render(),t)},new gt(n,a,M,{before:function(){n._isMounted&&!n._isDestroyed&&at(n,"beforeUpdate")}},!0),t=!1,null==n.$vnode&&(n._isMounted=!0,at(n,"mounted")),n}(this,n=n&&V?function(n){if("string"==typeof n){var e=document.querySelector(n);return e||document.createElement("div")}return n}(n):void 0,e)},V&&setTimeout((function(){U.devtools&&on&&on.emit("init",St)}),0);var Dr=St;
/*!
  * vue-router v3.5.4
  * (c) 2022 Evan You
  * @license MIT
  */function Br(n,e){for(var t in e)n[t]=e[t];return n}var Or=/[!'()*]/g,Cr=function(n){return"%"+n.charCodeAt(0).toString(16)},Nr=/%2C/g,jr=function(n){return encodeURIComponent(n).replace(Or,Cr).replace(Nr,",")};function Pr(n){try{return decodeURIComponent(n)}catch(n){0}return n}var Ur=function(n){return null==n||"object"==typeof n?n:String(n)};function Fr(n){var e={};return(n=n.trim().replace(/^(\?|#|&)/,""))?(n.split("&").forEach((function(n){var t=n.replace(/\+/g," ").split("="),a=Pr(t.shift()),r=t.length>0?Pr(t.join("=")):null;void 0===e[a]?e[a]=r:Array.isArray(e[a])?e[a].push(r):e[a]=[e[a],r]})),e):e}function $r(n){var e=n?Object.keys(n).map((function(e){var t=n[e];if(void 0===t)return"";if(null===t)return jr(e);if(Array.isArray(t)){var a=[];return t.forEach((function(n){void 0!==n&&(null===n?a.push(jr(e)):a.push(jr(e)+"="+jr(n)))})),a.join("&")}return jr(e)+"="+jr(t)})).filter((function(n){return n.length>0})).join("&"):null;return e?"?"+e:""}var Gr=/\/?$/;function Hr(n,e,t,a){var r=a&&a.options.stringifyQuery,i=e.query||{};try{i=Qr(i)}catch(n){}var s={name:e.name||n&&n.name,meta:n&&n.meta||{},path:e.path||"/",hash:e.hash||"",query:i,params:e.params||{},fullPath:Wr(e,r),matched:n?Kr(n):[]};return t&&(s.redirectedFrom=Wr(t,r)),Object.freeze(s)}function Qr(n){if(Array.isArray(n))return n.map(Qr);if(n&&"object"==typeof n){var e={};for(var t in n)e[t]=Qr(n[t]);return e}return n}var Vr=Hr(null,{path:"/"});function Kr(n){for(var e=[];n;)e.unshift(n),n=n.parent;return e}function Wr(n,e){var t=n.path,a=n.query;void 0===a&&(a={});var r=n.hash;return void 0===r&&(r=""),(t||"/")+(e||$r)(a)+r}function Jr(n,e,t){return e===Vr?n===e:!!e&&(n.path&&e.path?n.path.replace(Gr,"")===e.path.replace(Gr,"")&&(t||n.hash===e.hash&&Xr(n.query,e.query)):!(!n.name||!e.name)&&(n.name===e.name&&(t||n.hash===e.hash&&Xr(n.query,e.query)&&Xr(n.params,e.params))))}function Xr(n,e){if(void 0===n&&(n={}),void 0===e&&(e={}),!n||!e)return n===e;var t=Object.keys(n).sort(),a=Object.keys(e).sort();return t.length===a.length&&t.every((function(t,r){var i=n[t];if(a[r]!==t)return!1;var s=e[t];return null==i||null==s?i===s:"object"==typeof i&&"object"==typeof s?Xr(i,s):String(i)===String(s)}))}function Yr(n){for(var e=0;e<n.matched.length;e++){var t=n.matched[e];for(var a in t.instances){var r=t.instances[a],i=t.enteredCbs[a];if(r&&i){delete t.enteredCbs[a];for(var s=0;s<i.length;s++)r._isBeingDestroyed||i[s](r)}}}}var Zr={name:"RouterView",functional:!0,props:{name:{type:String,default:"default"}},render:function(n,e){var t=e.props,a=e.children,r=e.parent,i=e.data;i.routerView=!0;for(var s=r.$createElement,o=t.name,l=r.$route,c=r._routerViewCache||(r._routerViewCache={}),d=0,u=!1;r&&r._routerRoot!==r;){var m=r.$vnode?r.$vnode.data:{};m.routerView&&d++,m.keepAlive&&r._directInactive&&r._inactive&&(u=!0),r=r.$parent}if(i.routerViewDepth=d,u){var p=c[o],h=p&&p.component;return h?(p.configProps&&ni(h,i,p.route,p.configProps),s(h,i,a)):s()}var g=l.matched[d],f=g&&g.components[o];if(!g||!f)return c[o]=null,s();c[o]={component:f},i.registerRouteInstance=function(n,e){var t=g.instances[o];(e&&t!==n||!e&&t===n)&&(g.instances[o]=e)},(i.hook||(i.hook={})).prepatch=function(n,e){g.instances[o]=e.componentInstance},i.hook.init=function(n){n.data.keepAlive&&n.componentInstance&&n.componentInstance!==g.instances[o]&&(g.instances[o]=n.componentInstance),Yr(l)};var b=g.props&&g.props[o];return b&&(Br(c[o],{route:l,configProps:b}),ni(f,i,l,b)),s(f,i,a)}};function ni(n,e,t,a){var r=e.props=function(n,e){switch(typeof e){case"undefined":return;case"object":return e;case"function":return e(n);case"boolean":return e?n.params:void 0;default:0}}(t,a);if(r){r=e.props=Br({},r);var i=e.attrs=e.attrs||{};for(var s in r)n.props&&s in n.props||(i[s]=r[s],delete r[s])}}function ei(n,e,t){var a=n.charAt(0);if("/"===a)return n;if("?"===a||"#"===a)return e+n;var r=e.split("/");t&&r[r.length-1]||r.pop();for(var i=n.replace(/^\//,"").split("/"),s=0;s<i.length;s++){var o=i[s];".."===o?r.pop():"."!==o&&r.push(o)}return""!==r[0]&&r.unshift(""),r.join("/")}function ti(n){return n.replace(/\/(?:\s*\/)+/g,"/")}var ai=Array.isArray||function(n){return"[object Array]"==Object.prototype.toString.call(n)},ri=yi,ii=di,si=function(n,e){return mi(di(n,e),e)},oi=mi,li=bi,ci=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function di(n,e){for(var t,a=[],r=0,i=0,s="",o=e&&e.delimiter||"/";null!=(t=ci.exec(n));){var l=t[0],c=t[1],d=t.index;if(s+=n.slice(i,d),i=d+l.length,c)s+=c[1];else{var u=n[i],m=t[2],p=t[3],h=t[4],g=t[5],f=t[6],b=t[7];s&&(a.push(s),s="");var y=null!=m&&null!=u&&u!==m,v="+"===f||"*"===f,_="?"===f||"*"===f,x=t[2]||o,E=h||g;a.push({name:p||r++,prefix:m||"",delimiter:x,optional:_,repeat:v,partial:y,asterisk:!!b,pattern:E?hi(E):b?".*":"[^"+pi(x)+"]+?"})}}return i<n.length&&(s+=n.substr(i)),s&&a.push(s),a}function ui(n){return encodeURI(n).replace(/[\/?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()}))}function mi(n,e){for(var t=new Array(n.length),a=0;a<n.length;a++)"object"==typeof n[a]&&(t[a]=new RegExp("^(?:"+n[a].pattern+")$",fi(e)));return function(e,a){for(var r="",i=e||{},s=(a||{}).pretty?ui:encodeURIComponent,o=0;o<n.length;o++){var l=n[o];if("string"!=typeof l){var c,d=i[l.name];if(null==d){if(l.optional){l.partial&&(r+=l.prefix);continue}throw new TypeError('Expected "'+l.name+'" to be defined')}if(ai(d)){if(!l.repeat)throw new TypeError('Expected "'+l.name+'" to not repeat, but received `'+JSON.stringify(d)+"`");if(0===d.length){if(l.optional)continue;throw new TypeError('Expected "'+l.name+'" to not be empty')}for(var u=0;u<d.length;u++){if(c=s(d[u]),!t[o].test(c))throw new TypeError('Expected all "'+l.name+'" to match "'+l.pattern+'", but received `'+JSON.stringify(c)+"`");r+=(0===u?l.prefix:l.delimiter)+c}}else{if(c=l.asterisk?encodeURI(d).replace(/[?#]/g,(function(n){return"%"+n.charCodeAt(0).toString(16).toUpperCase()})):s(d),!t[o].test(c))throw new TypeError('Expected "'+l.name+'" to match "'+l.pattern+'", but received "'+c+'"');r+=l.prefix+c}}else r+=l}return r}}function pi(n){return n.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function hi(n){return n.replace(/([=!:$\/()])/g,"\\$1")}function gi(n,e){return n.keys=e,n}function fi(n){return n&&n.sensitive?"":"i"}function bi(n,e,t){ai(e)||(t=e||t,e=[]);for(var a=(t=t||{}).strict,r=!1!==t.end,i="",s=0;s<n.length;s++){var o=n[s];if("string"==typeof o)i+=pi(o);else{var l=pi(o.prefix),c="(?:"+o.pattern+")";e.push(o),o.repeat&&(c+="(?:"+l+c+")*"),i+=c=o.optional?o.partial?l+"("+c+")?":"(?:"+l+"("+c+"))?":l+"("+c+")"}}var d=pi(t.delimiter||"/"),u=i.slice(-d.length)===d;return a||(i=(u?i.slice(0,-d.length):i)+"(?:"+d+"(?=$))?"),i+=r?"$":a&&u?"":"(?="+d+"|$)",gi(new RegExp("^"+i,fi(t)),e)}function yi(n,e,t){return ai(e)||(t=e||t,e=[]),t=t||{},n instanceof RegExp?function(n,e){var t=n.source.match(/\((?!\?)/g);if(t)for(var a=0;a<t.length;a++)e.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return gi(n,e)}(n,e):ai(n)?function(n,e,t){for(var a=[],r=0;r<n.length;r++)a.push(yi(n[r],e,t).source);return gi(new RegExp("(?:"+a.join("|")+")",fi(t)),e)}(n,e,t):function(n,e,t){return bi(di(n,t),e,t)}(n,e,t)}ri.parse=ii,ri.compile=si,ri.tokensToFunction=oi,ri.tokensToRegExp=li;var vi=Object.create(null);function _i(n,e,t){e=e||{};try{var a=vi[n]||(vi[n]=ri.compile(n));return"string"==typeof e.pathMatch&&(e[0]=e.pathMatch),a(e,{pretty:!0})}catch(n){return""}finally{delete e[0]}}function xi(n,e,t,a){var r="string"==typeof n?{path:n}:n;if(r._normalized)return r;if(r.name){var i=(r=Br({},n)).params;return i&&"object"==typeof i&&(r.params=Br({},i)),r}if(!r.path&&r.params&&e){(r=Br({},r))._normalized=!0;var s=Br(Br({},e.params),r.params);if(e.name)r.name=e.name,r.params=s;else if(e.matched.length){var o=e.matched[e.matched.length-1].path;r.path=_i(o,s,e.path)}else 0;return r}var l=function(n){var e="",t="",a=n.indexOf("#");a>=0&&(e=n.slice(a),n=n.slice(0,a));var r=n.indexOf("?");return r>=0&&(t=n.slice(r+1),n=n.slice(0,r)),{path:n,query:t,hash:e}}(r.path||""),c=e&&e.path||"/",d=l.path?ei(l.path,c,t||r.append):c,u=function(n,e,t){void 0===e&&(e={});var a,r=t||Fr;try{a=r(n||"")}catch(n){a={}}for(var i in e){var s=e[i];a[i]=Array.isArray(s)?s.map(Ur):Ur(s)}return a}(l.query,r.query,a&&a.options.parseQuery),m=r.hash||l.hash;return m&&"#"!==m.charAt(0)&&(m="#"+m),{_normalized:!0,path:d,query:u,hash:m}}var Ei,Ti=function(){},Ii={name:"RouterLink",props:{to:{type:[String,Object],required:!0},tag:{type:String,default:"a"},custom:Boolean,exact:Boolean,exactPath:Boolean,append:Boolean,replace:Boolean,activeClass:String,exactActiveClass:String,ariaCurrentValue:{type:String,default:"page"},event:{type:[String,Array],default:"click"}},render:function(n){var e=this,t=this.$router,a=this.$route,r=t.resolve(this.to,a,this.append),i=r.location,s=r.route,o=r.href,l={},c=t.options.linkActiveClass,d=t.options.linkExactActiveClass,u=null==c?"router-link-active":c,m=null==d?"router-link-exact-active":d,p=null==this.activeClass?u:this.activeClass,h=null==this.exactActiveClass?m:this.exactActiveClass,g=s.redirectedFrom?Hr(null,xi(s.redirectedFrom),null,t):s;l[h]=Jr(a,g,this.exactPath),l[p]=this.exact||this.exactPath?l[h]:function(n,e){return 0===n.path.replace(Gr,"/").indexOf(e.path.replace(Gr,"/"))&&(!e.hash||n.hash===e.hash)&&function(n,e){for(var t in e)if(!(t in n))return!1;return!0}(n.query,e.query)}(a,g);var f=l[h]?this.ariaCurrentValue:null,b=function(n){ki(n)&&(e.replace?t.replace(i,Ti):t.push(i,Ti))},y={click:ki};Array.isArray(this.event)?this.event.forEach((function(n){y[n]=b})):y[this.event]=b;var v={class:l},_=!this.$scopedSlots.$hasNormal&&this.$scopedSlots.default&&this.$scopedSlots.default({href:o,route:s,navigate:b,isActive:l[p],isExactActive:l[h]});if(_){if(1===_.length)return _[0];if(_.length>1||!_.length)return 0===_.length?n():n("span",{},_)}if("a"===this.tag)v.on=y,v.attrs={href:o,"aria-current":f};else{var x=function n(e){var t;if(e)for(var a=0;a<e.length;a++){if("a"===(t=e[a]).tag)return t;if(t.children&&(t=n(t.children)))return t}}(this.$slots.default);if(x){x.isStatic=!1;var E=x.data=Br({},x.data);for(var T in E.on=E.on||{},E.on){var I=E.on[T];T in y&&(E.on[T]=Array.isArray(I)?I:[I])}for(var k in y)k in E.on?E.on[k].push(y[k]):E.on[k]=b;var S=x.data.attrs=Br({},x.data.attrs);S.href=o,S["aria-current"]=f}else v.on=y}return n(this.tag,v,this.$slots.default)}};function ki(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey||n.defaultPrevented||void 0!==n.button&&0!==n.button)){if(n.currentTarget&&n.currentTarget.getAttribute){var e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}var Si="undefined"!=typeof window;function qi(n,e,t,a,r){var i=e||[],s=t||Object.create(null),o=a||Object.create(null);n.forEach((function(n){!function n(e,t,a,r,i,s){var o=r.path,l=r.name;0;var c=r.pathToRegexpOptions||{},d=function(n,e,t){t||(n=n.replace(/\/$/,""));if("/"===n[0])return n;if(null==e)return n;return ti(e.path+"/"+n)}(o,i,c.strict);"boolean"==typeof r.caseSensitive&&(c.sensitive=r.caseSensitive);var u={path:d,regex:wi(d,c),components:r.components||{default:r.component},alias:r.alias?"string"==typeof r.alias?[r.alias]:r.alias:[],instances:{},enteredCbs:{},name:l,parent:i,matchAs:s,redirect:r.redirect,beforeEnter:r.beforeEnter,meta:r.meta||{},props:null==r.props?{}:r.components?r.props:{default:r.props}};r.children&&r.children.forEach((function(r){var i=s?ti(s+"/"+r.path):void 0;n(e,t,a,r,u,i)}));t[u.path]||(e.push(u.path),t[u.path]=u);if(void 0!==r.alias)for(var m=Array.isArray(r.alias)?r.alias:[r.alias],p=0;p<m.length;++p){0;var h={path:m[p],children:r.children};n(e,t,a,h,i,u.path||"/")}l&&(a[l]||(a[l]=u))}(i,s,o,n,r)}));for(var l=0,c=i.length;l<c;l++)"*"===i[l]&&(i.push(i.splice(l,1)[0]),c--,l--);return{pathList:i,pathMap:s,nameMap:o}}function wi(n,e){return ri(n,[],e)}function Ri(n,e){var t=qi(n),a=t.pathList,r=t.pathMap,i=t.nameMap;function s(n,t,s){var o=xi(n,t,!1,e),c=o.name;if(c){var d=i[c];if(!d)return l(null,o);var u=d.regex.keys.filter((function(n){return!n.optional})).map((function(n){return n.name}));if("object"!=typeof o.params&&(o.params={}),t&&"object"==typeof t.params)for(var m in t.params)!(m in o.params)&&u.indexOf(m)>-1&&(o.params[m]=t.params[m]);return o.path=_i(d.path,o.params),l(d,o,s)}if(o.path){o.params={};for(var p=0;p<a.length;p++){var h=a[p],g=r[h];if(Ai(g.regex,o.path,o.params))return l(g,o,s)}}return l(null,o)}function o(n,t){var a=n.redirect,r="function"==typeof a?a(Hr(n,t,null,e)):a;if("string"==typeof r&&(r={path:r}),!r||"object"!=typeof r)return l(null,t);var o=r,c=o.name,d=o.path,u=t.query,m=t.hash,p=t.params;if(u=o.hasOwnProperty("query")?o.query:u,m=o.hasOwnProperty("hash")?o.hash:m,p=o.hasOwnProperty("params")?o.params:p,c){i[c];return s({_normalized:!0,name:c,query:u,hash:m,params:p},void 0,t)}if(d){var h=function(n,e){return ei(n,e.parent?e.parent.path:"/",!0)}(d,n);return s({_normalized:!0,path:_i(h,p),query:u,hash:m},void 0,t)}return l(null,t)}function l(n,t,a){return n&&n.redirect?o(n,a||t):n&&n.matchAs?function(n,e,t){var a=s({_normalized:!0,path:_i(t,e.params)});if(a){var r=a.matched,i=r[r.length-1];return e.params=a.params,l(i,e)}return l(null,e)}(0,t,n.matchAs):Hr(n,t,a,e)}return{match:s,addRoute:function(n,e){var t="object"!=typeof n?i[n]:void 0;qi([e||n],a,r,i,t),t&&t.alias.length&&qi(t.alias.map((function(n){return{path:n,children:[e]}})),a,r,i,t)},getRoutes:function(){return a.map((function(n){return r[n]}))},addRoutes:function(n){qi(n,a,r,i)}}}function Ai(n,e,t){var a=e.match(n);if(!a)return!1;if(!t)return!0;for(var r=1,i=a.length;r<i;++r){var s=n.keys[r-1];s&&(t[s.name||"pathMatch"]="string"==typeof a[r]?Pr(a[r]):a[r])}return!0}var zi=Si&&window.performance&&window.performance.now?window.performance:Date;function Li(){return zi.now().toFixed(3)}var Mi=Li();function Di(){return Mi}function Bi(n){return Mi=n}var Oi=Object.create(null);function Ci(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var n=window.location.protocol+"//"+window.location.host,e=window.location.href.replace(n,""),t=Br({},window.history.state);return t.key=Di(),window.history.replaceState(t,"",e),window.addEventListener("popstate",Pi),function(){window.removeEventListener("popstate",Pi)}}function Ni(n,e,t,a){if(n.app){var r=n.options.scrollBehavior;r&&n.app.$nextTick((function(){var i=function(){var n=Di();if(n)return Oi[n]}(),s=r.call(n,e,t,a?i:null);s&&("function"==typeof s.then?s.then((function(n){Hi(n,i)})).catch((function(n){0})):Hi(s,i))}))}}function ji(){var n=Di();n&&(Oi[n]={x:window.pageXOffset,y:window.pageYOffset})}function Pi(n){ji(),n.state&&n.state.key&&Bi(n.state.key)}function Ui(n){return $i(n.x)||$i(n.y)}function Fi(n){return{x:$i(n.x)?n.x:window.pageXOffset,y:$i(n.y)?n.y:window.pageYOffset}}function $i(n){return"number"==typeof n}var Gi=/^#\d/;function Hi(n,e){var t,a="object"==typeof n;if(a&&"string"==typeof n.selector){var r=Gi.test(n.selector)?document.getElementById(n.selector.slice(1)):document.querySelector(n.selector);if(r){var i=n.offset&&"object"==typeof n.offset?n.offset:{};e=function(n,e){var t=document.documentElement.getBoundingClientRect(),a=n.getBoundingClientRect();return{x:a.left-t.left-e.x,y:a.top-t.top-e.y}}(r,i={x:$i((t=i).x)?t.x:0,y:$i(t.y)?t.y:0})}else Ui(n)&&(e=Fi(n))}else a&&Ui(n)&&(e=Fi(n));e&&("scrollBehavior"in document.documentElement.style?window.scrollTo({left:e.x,top:e.y,behavior:n.behavior}):window.scrollTo(e.x,e.y))}var Qi,Vi=Si&&((-1===(Qi=window.navigator.userAgent).indexOf("Android 2.")&&-1===Qi.indexOf("Android 4.0")||-1===Qi.indexOf("Mobile Safari")||-1!==Qi.indexOf("Chrome")||-1!==Qi.indexOf("Windows Phone"))&&window.history&&"function"==typeof window.history.pushState);function Ki(n,e){ji();var t=window.history;try{if(e){var a=Br({},t.state);a.key=Di(),t.replaceState(a,"",n)}else t.pushState({key:Bi(Li())},"",n)}catch(t){window.location[e?"replace":"assign"](n)}}function Wi(n){Ki(n,!0)}function Ji(n,e,t){var a=function(r){r>=n.length?t():n[r]?e(n[r],(function(){a(r+1)})):a(r+1)};a(0)}var Xi={redirected:2,aborted:4,cancelled:8,duplicated:16};function Yi(n,e){return ns(n,e,Xi.redirected,'Redirected when going from "'+n.fullPath+'" to "'+function(n){if("string"==typeof n)return n;if("path"in n)return n.path;var e={};return es.forEach((function(t){t in n&&(e[t]=n[t])})),JSON.stringify(e,null,2)}(e)+'" via a navigation guard.')}function Zi(n,e){return ns(n,e,Xi.cancelled,'Navigation cancelled from "'+n.fullPath+'" to "'+e.fullPath+'" with a new navigation.')}function ns(n,e,t,a){var r=new Error(a);return r._isRouter=!0,r.from=n,r.to=e,r.type=t,r}var es=["params","query","hash"];function ts(n){return Object.prototype.toString.call(n).indexOf("Error")>-1}function as(n,e){return ts(n)&&n._isRouter&&(null==e||n.type===e)}function rs(n){return function(e,t,a){var r=!1,i=0,s=null;is(n,(function(n,e,t,o){if("function"==typeof n&&void 0===n.cid){r=!0,i++;var l,c=ls((function(e){var r;((r=e).__esModule||os&&"Module"===r[Symbol.toStringTag])&&(e=e.default),n.resolved="function"==typeof e?e:Ei.extend(e),t.components[o]=e,--i<=0&&a()})),d=ls((function(n){var e="Failed to resolve async component "+o+": "+n;s||(s=ts(n)?n:new Error(e),a(s))}));try{l=n(c,d)}catch(n){d(n)}if(l)if("function"==typeof l.then)l.then(c,d);else{var u=l.component;u&&"function"==typeof u.then&&u.then(c,d)}}})),r||a()}}function is(n,e){return ss(n.map((function(n){return Object.keys(n.components).map((function(t){return e(n.components[t],n.instances[t],n,t)}))})))}function ss(n){return Array.prototype.concat.apply([],n)}var os="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;function ls(n){var e=!1;return function(){for(var t=[],a=arguments.length;a--;)t[a]=arguments[a];if(!e)return e=!0,n.apply(this,t)}}var cs=function(n,e){this.router=n,this.base=function(n){if(!n)if(Si){var e=document.querySelector("base");n=(n=e&&e.getAttribute("href")||"/").replace(/^https?:\/\/[^\/]+/,"")}else n="/";"/"!==n.charAt(0)&&(n="/"+n);return n.replace(/\/$/,"")}(e),this.current=Vr,this.pending=null,this.ready=!1,this.readyCbs=[],this.readyErrorCbs=[],this.errorCbs=[],this.listeners=[]};function ds(n,e,t,a){var r=is(n,(function(n,a,r,i){var s=function(n,e){"function"!=typeof n&&(n=Ei.extend(n));return n.options[e]}(n,e);if(s)return Array.isArray(s)?s.map((function(n){return t(n,a,r,i)})):t(s,a,r,i)}));return ss(a?r.reverse():r)}function us(n,e){if(e)return function(){return n.apply(e,arguments)}}cs.prototype.listen=function(n){this.cb=n},cs.prototype.onReady=function(n,e){this.ready?n():(this.readyCbs.push(n),e&&this.readyErrorCbs.push(e))},cs.prototype.onError=function(n){this.errorCbs.push(n)},cs.prototype.transitionTo=function(n,e,t){var a,r=this;try{a=this.router.match(n,this.current)}catch(n){throw this.errorCbs.forEach((function(e){e(n)})),n}var i=this.current;this.confirmTransition(a,(function(){r.updateRoute(a),e&&e(a),r.ensureURL(),r.router.afterHooks.forEach((function(n){n&&n(a,i)})),r.ready||(r.ready=!0,r.readyCbs.forEach((function(n){n(a)})))}),(function(n){t&&t(n),n&&!r.ready&&(as(n,Xi.redirected)&&i===Vr||(r.ready=!0,r.readyErrorCbs.forEach((function(e){e(n)}))))}))},cs.prototype.confirmTransition=function(n,e,t){var a=this,r=this.current;this.pending=n;var i,s,o=function(n){!as(n)&&ts(n)&&(a.errorCbs.length?a.errorCbs.forEach((function(e){e(n)})):console.error(n)),t&&t(n)},l=n.matched.length-1,c=r.matched.length-1;if(Jr(n,r)&&l===c&&n.matched[l]===r.matched[c])return this.ensureURL(),n.hash&&Ni(this.router,r,n,!1),o(((s=ns(i=r,n,Xi.duplicated,'Avoided redundant navigation to current location: "'+i.fullPath+'".')).name="NavigationDuplicated",s));var d=function(n,e){var t,a=Math.max(n.length,e.length);for(t=0;t<a&&n[t]===e[t];t++);return{updated:e.slice(0,t),activated:e.slice(t),deactivated:n.slice(t)}}(this.current.matched,n.matched),u=d.updated,m=d.deactivated,p=d.activated,h=[].concat(function(n){return ds(n,"beforeRouteLeave",us,!0)}(m),this.router.beforeHooks,function(n){return ds(n,"beforeRouteUpdate",us)}(u),p.map((function(n){return n.beforeEnter})),rs(p)),g=function(e,t){if(a.pending!==n)return o(Zi(r,n));try{e(n,r,(function(e){!1===e?(a.ensureURL(!0),o(function(n,e){return ns(n,e,Xi.aborted,'Navigation aborted from "'+n.fullPath+'" to "'+e.fullPath+'" via a navigation guard.')}(r,n))):ts(e)?(a.ensureURL(!0),o(e)):"string"==typeof e||"object"==typeof e&&("string"==typeof e.path||"string"==typeof e.name)?(o(Yi(r,n)),"object"==typeof e&&e.replace?a.replace(e):a.push(e)):t(e)}))}catch(n){o(n)}};Ji(h,g,(function(){Ji(function(n){return ds(n,"beforeRouteEnter",(function(n,e,t,a){return function(n,e,t){return function(a,r,i){return n(a,r,(function(n){"function"==typeof n&&(e.enteredCbs[t]||(e.enteredCbs[t]=[]),e.enteredCbs[t].push(n)),i(n)}))}}(n,t,a)}))}(p).concat(a.router.resolveHooks),g,(function(){if(a.pending!==n)return o(Zi(r,n));a.pending=null,e(n),a.router.app&&a.router.app.$nextTick((function(){Yr(n)}))}))}))},cs.prototype.updateRoute=function(n){this.current=n,this.cb&&this.cb(n)},cs.prototype.setupListeners=function(){},cs.prototype.teardown=function(){this.listeners.forEach((function(n){n()})),this.listeners=[],this.current=Vr,this.pending=null};var ms=function(n){function e(e,t){n.call(this,e,t),this._startLocation=ps(this.base)}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router,t=e.options.scrollBehavior,a=Vi&&t;a&&this.listeners.push(Ci());var r=function(){var t=n.current,r=ps(n.base);n.current===Vr&&r===n._startLocation||n.transitionTo(r,(function(n){a&&Ni(e,n,t,!0)}))};window.addEventListener("popstate",r),this.listeners.push((function(){window.removeEventListener("popstate",r)}))}},e.prototype.go=function(n){window.history.go(n)},e.prototype.push=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){Ki(ti(a.base+n.fullPath)),Ni(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){Wi(ti(a.base+n.fullPath)),Ni(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.ensureURL=function(n){if(ps(this.base)!==this.current.fullPath){var e=ti(this.base+this.current.fullPath);n?Ki(e):Wi(e)}},e.prototype.getCurrentLocation=function(){return ps(this.base)},e}(cs);function ps(n){var e=window.location.pathname,t=e.toLowerCase(),a=n.toLowerCase();return!n||t!==a&&0!==t.indexOf(ti(a+"/"))||(e=e.slice(n.length)),(e||"/")+window.location.search+window.location.hash}var hs=function(n){function e(e,t,a){n.call(this,e,t),a&&function(n){var e=ps(n);if(!/^\/#/.test(e))return window.location.replace(ti(n+"/#"+e)),!0}(this.base)||gs()}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.setupListeners=function(){var n=this;if(!(this.listeners.length>0)){var e=this.router.options.scrollBehavior,t=Vi&&e;t&&this.listeners.push(Ci());var a=function(){var e=n.current;gs()&&n.transitionTo(fs(),(function(a){t&&Ni(n.router,a,e,!0),Vi||vs(a.fullPath)}))},r=Vi?"popstate":"hashchange";window.addEventListener(r,a),this.listeners.push((function(){window.removeEventListener(r,a)}))}},e.prototype.push=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){ys(n.fullPath),Ni(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this,r=this.current;this.transitionTo(n,(function(n){vs(n.fullPath),Ni(a.router,n,r,!1),e&&e(n)}),t)},e.prototype.go=function(n){window.history.go(n)},e.prototype.ensureURL=function(n){var e=this.current.fullPath;fs()!==e&&(n?ys(e):vs(e))},e.prototype.getCurrentLocation=function(){return fs()},e}(cs);function gs(){var n=fs();return"/"===n.charAt(0)||(vs("/"+n),!1)}function fs(){var n=window.location.href,e=n.indexOf("#");return e<0?"":n=n.slice(e+1)}function bs(n){var e=window.location.href,t=e.indexOf("#");return(t>=0?e.slice(0,t):e)+"#"+n}function ys(n){Vi?Ki(bs(n)):window.location.hash=n}function vs(n){Vi?Wi(bs(n)):window.location.replace(bs(n))}var _s=function(n){function e(e,t){n.call(this,e,t),this.stack=[],this.index=-1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.push=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index+1).concat(n),a.index++,e&&e(n)}),t)},e.prototype.replace=function(n,e,t){var a=this;this.transitionTo(n,(function(n){a.stack=a.stack.slice(0,a.index).concat(n),e&&e(n)}),t)},e.prototype.go=function(n){var e=this,t=this.index+n;if(!(t<0||t>=this.stack.length)){var a=this.stack[t];this.confirmTransition(a,(function(){var n=e.current;e.index=t,e.updateRoute(a),e.router.afterHooks.forEach((function(e){e&&e(a,n)}))}),(function(n){as(n,Xi.duplicated)&&(e.index=t)}))}},e.prototype.getCurrentLocation=function(){var n=this.stack[this.stack.length-1];return n?n.fullPath:"/"},e.prototype.ensureURL=function(){},e}(cs),xs=function(n){void 0===n&&(n={}),this.app=null,this.apps=[],this.options=n,this.beforeHooks=[],this.resolveHooks=[],this.afterHooks=[],this.matcher=Ri(n.routes||[],this);var e=n.mode||"hash";switch(this.fallback="history"===e&&!Vi&&!1!==n.fallback,this.fallback&&(e="hash"),Si||(e="abstract"),this.mode=e,e){case"history":this.history=new ms(this,n.base);break;case"hash":this.history=new hs(this,n.base,this.fallback);break;case"abstract":this.history=new _s(this,n.base);break;default:0}},Es={currentRoute:{configurable:!0}};function Ts(n,e){return n.push(e),function(){var t=n.indexOf(e);t>-1&&n.splice(t,1)}}xs.prototype.match=function(n,e,t){return this.matcher.match(n,e,t)},Es.currentRoute.get=function(){return this.history&&this.history.current},xs.prototype.init=function(n){var e=this;if(this.apps.push(n),n.$once("hook:destroyed",(function(){var t=e.apps.indexOf(n);t>-1&&e.apps.splice(t,1),e.app===n&&(e.app=e.apps[0]||null),e.app||e.history.teardown()})),!this.app){this.app=n;var t=this.history;if(t instanceof ms||t instanceof hs){var a=function(n){t.setupListeners(),function(n){var a=t.current,r=e.options.scrollBehavior;Vi&&r&&"fullPath"in n&&Ni(e,n,a,!1)}(n)};t.transitionTo(t.getCurrentLocation(),a,a)}t.listen((function(n){e.apps.forEach((function(e){e._route=n}))}))}},xs.prototype.beforeEach=function(n){return Ts(this.beforeHooks,n)},xs.prototype.beforeResolve=function(n){return Ts(this.resolveHooks,n)},xs.prototype.afterEach=function(n){return Ts(this.afterHooks,n)},xs.prototype.onReady=function(n,e){this.history.onReady(n,e)},xs.prototype.onError=function(n){this.history.onError(n)},xs.prototype.push=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.push(n,e,t)}));this.history.push(n,e,t)},xs.prototype.replace=function(n,e,t){var a=this;if(!e&&!t&&"undefined"!=typeof Promise)return new Promise((function(e,t){a.history.replace(n,e,t)}));this.history.replace(n,e,t)},xs.prototype.go=function(n){this.history.go(n)},xs.prototype.back=function(){this.go(-1)},xs.prototype.forward=function(){this.go(1)},xs.prototype.getMatchedComponents=function(n){var e=n?n.matched?n:this.resolve(n).route:this.currentRoute;return e?[].concat.apply([],e.matched.map((function(n){return Object.keys(n.components).map((function(e){return n.components[e]}))}))):[]},xs.prototype.resolve=function(n,e,t){var a=xi(n,e=e||this.history.current,t,this),r=this.match(a,e),i=r.redirectedFrom||r.fullPath;return{location:a,route:r,href:function(n,e,t){var a="hash"===t?"#"+e:e;return n?ti(n+"/"+a):a}(this.history.base,i,this.mode),normalizedTo:a,resolved:r}},xs.prototype.getRoutes=function(){return this.matcher.getRoutes()},xs.prototype.addRoute=function(n,e){this.matcher.addRoute(n,e),this.history.current!==Vr&&this.history.transitionTo(this.history.getCurrentLocation())},xs.prototype.addRoutes=function(n){this.matcher.addRoutes(n),this.history.current!==Vr&&this.history.transitionTo(this.history.getCurrentLocation())},Object.defineProperties(xs.prototype,Es),xs.install=function n(e){if(!n.installed||Ei!==e){n.installed=!0,Ei=e;var t=function(n){return void 0!==n},a=function(n,e){var a=n.$options._parentVnode;t(a)&&t(a=a.data)&&t(a=a.registerRouteInstance)&&a(n,e)};e.mixin({beforeCreate:function(){t(this.$options.router)?(this._routerRoot=this,this._router=this.$options.router,this._router.init(this),e.util.defineReactive(this,"_route",this._router.history.current)):this._routerRoot=this.$parent&&this.$parent._routerRoot||this,a(this,this)},destroyed:function(){a(this)}}),Object.defineProperty(e.prototype,"$router",{get:function(){return this._routerRoot._router}}),Object.defineProperty(e.prototype,"$route",{get:function(){return this._routerRoot._route}}),e.component("RouterView",Zr),e.component("RouterLink",Ii);var r=e.config.optionMergeStrategies;r.beforeRouteEnter=r.beforeRouteLeave=r.beforeRouteUpdate=r.created}},xs.version="3.5.4",xs.isNavigationFailure=as,xs.NavigationFailureType=Xi,xs.START_LOCATION=Vr,Si&&window.Vue&&window.Vue.use(xs);var Is=xs;t(234),t(132),t(283),t(110),t(285),t(26),t(27),t(286);function ks(n){n.locales&&Object.keys(n.locales).forEach((function(e){n.locales[e].path=e})),Object.freeze(n)}var Ss=t(61),qs=t(81),ws=(t(131),t(19),t(47),t(236),t(237),t(38),t(23),{NotFound:function(){return Promise.all([t.e(0),t.e(4)]).then(t.bind(null,501))},Layout:function(){return Promise.all([t.e(0),t.e(2)]).then(t.bind(null,500))}}),Rs={"v-308e21ec":function(){return t.e(5).then(t.bind(null,502))},"v-700c3ee7":function(){return t.e(6).then(t.bind(null,503))},"v-2c1319b3":function(){return t.e(7).then(t.bind(null,504))},"v-cd9e182e":function(){return t.e(8).then(t.bind(null,505))},"v-722983de":function(){return t.e(9).then(t.bind(null,506))},"v-30339a31":function(){return t.e(10).then(t.bind(null,507))},"v-aeaab6a8":function(){return t.e(11).then(t.bind(null,508))},"v-1a9f322e":function(){return t.e(12).then(t.bind(null,509))},"v-2092ddb6":function(){return t.e(13).then(t.bind(null,510))},"v-5e14aa88":function(){return t.e(14).then(t.bind(null,511))},"v-04da5df4":function(){return t.e(15).then(t.bind(null,512))},"v-6d3cde8c":function(){return t.e(16).then(t.bind(null,513))},"v-a6cffc1a":function(){return t.e(17).then(t.bind(null,514))},"v-398cfa40":function(){return t.e(18).then(t.bind(null,515))},"v-0c3c1ebd":function(){return t.e(19).then(t.bind(null,516))},"v-6b994900":function(){return t.e(20).then(t.bind(null,517))},"v-63d8b17b":function(){return t.e(21).then(t.bind(null,518))},"v-bf86eaa6":function(){return t.e(22).then(t.bind(null,519))},"v-581951d7":function(){return t.e(23).then(t.bind(null,520))},"v-47bbb02c":function(){return t.e(24).then(t.bind(null,521))},"v-075759e4":function(){return t.e(25).then(t.bind(null,522))},"v-5cb554e2":function(){return t.e(26).then(t.bind(null,523))},"v-2b51d042":function(){return t.e(27).then(t.bind(null,524))},"v-00d798bc":function(){return t.e(28).then(t.bind(null,525))},"v-598fed5e":function(){return t.e(29).then(t.bind(null,526))},"v-10ae1758":function(){return t.e(30).then(t.bind(null,527))},"v-533deaa3":function(){return t.e(31).then(t.bind(null,528))},"v-5f0cd72e":function(){return t.e(32).then(t.bind(null,529))},"v-8fff35f6":function(){return t.e(33).then(t.bind(null,530))},"v-0fa53966":function(){return t.e(34).then(t.bind(null,531))},"v-7bb10b88":function(){return t.e(35).then(t.bind(null,532))},"v-1fb153de":function(){return t.e(36).then(t.bind(null,533))},"v-7d04d94d":function(){return t.e(37).then(t.bind(null,534))},"v-681aa558":function(){return t.e(38).then(t.bind(null,535))},"v-5ff0eb5a":function(){return t.e(39).then(t.bind(null,536))},"v-6fc5b52c":function(){return t.e(40).then(t.bind(null,537))},"v-25853052":function(){return t.e(41).then(t.bind(null,538))},"v-3470a0b0":function(){return t.e(42).then(t.bind(null,539))},"v-2755550e":function(){return t.e(43).then(t.bind(null,540))},"v-00448410":function(){return t.e(44).then(t.bind(null,541))},"v-55c42fdf":function(){return t.e(45).then(t.bind(null,542))},"v-0dcd3e72":function(){return t.e(46).then(t.bind(null,543))},"v-d5c8af24":function(){return t.e(47).then(t.bind(null,544))},"v-033ee0db":function(){return t.e(48).then(t.bind(null,545))},"v-4092c244":function(){return t.e(49).then(t.bind(null,546))},"v-d49f587c":function(){return t.e(50).then(t.bind(null,547))},"v-88bb15a6":function(){return t.e(51).then(t.bind(null,548))},"v-db539372":function(){return t.e(52).then(t.bind(null,549))},"v-33028f47":function(){return t.e(53).then(t.bind(null,550))},"v-5718adbb":function(){return t.e(54).then(t.bind(null,551))},"v-3e99c22e":function(){return t.e(55).then(t.bind(null,552))},"v-29937047":function(){return t.e(56).then(t.bind(null,553))},"v-a34eed14":function(){return t.e(57).then(t.bind(null,554))},"v-fe41ffc6":function(){return t.e(58).then(t.bind(null,555))},"v-d28308f2":function(){return t.e(59).then(t.bind(null,556))},"v-0b132004":function(){return t.e(60).then(t.bind(null,557))},"v-272e6736":function(){return t.e(61).then(t.bind(null,558))},"v-3afd3137":function(){return t.e(62).then(t.bind(null,559))},"v-16b255f9":function(){return t.e(63).then(t.bind(null,560))},"v-eca4e092":function(){return t.e(64).then(t.bind(null,561))},"v-cd275a36":function(){return t.e(65).then(t.bind(null,562))},"v-32b9bb54":function(){return t.e(66).then(t.bind(null,563))},"v-4124258d":function(){return t.e(67).then(t.bind(null,564))},"v-31b667fe":function(){return t.e(68).then(t.bind(null,565))},"v-39fdaf1c":function(){return t.e(69).then(t.bind(null,566))},"v-4bfc28c7":function(){return t.e(70).then(t.bind(null,567))},"v-58ce2686":function(){return t.e(71).then(t.bind(null,568))},"v-ed0e4772":function(){return t.e(72).then(t.bind(null,569))},"v-32457afd":function(){return t.e(73).then(t.bind(null,570))},"v-9a9ffafe":function(){return t.e(74).then(t.bind(null,571))},"v-2e4e7fc6":function(){return t.e(75).then(t.bind(null,572))},"v-5f7d314c":function(){return t.e(76).then(t.bind(null,573))},"v-c7c85e2e":function(){return t.e(77).then(t.bind(null,574))},"v-03067a49":function(){return t.e(78).then(t.bind(null,575))},"v-be824b2e":function(){return t.e(79).then(t.bind(null,576))},"v-91a7d35c":function(){return t.e(80).then(t.bind(null,577))}};function As(n){var e=Object.create(null);return function(t){return e[t]||(e[t]=n(t))}}var zs=/-(\w)/g,Ls=As((function(n){return n.replace(zs,(function(n,e){return e?e.toUpperCase():""}))})),Ms=/\B([A-Z])/g,Ds=As((function(n){return n.replace(Ms,"-$1").toLowerCase()})),Bs=As((function(n){return n.charAt(0).toUpperCase()+n.slice(1)}));function Os(n,e){if(e)return n(e)?n(e):e.includes("-")?n(Bs(Ls(e))):n(Bs(e))||n(Ds(e))}var Cs=Object.assign({},ws,Rs),Ns=function(n){return Cs[n]},js=function(n){return Rs[n]},Ps=function(n){return ws[n]},Us=function(n){return Dr.component(n)};function Fs(n){return Os(js,n)}function $s(n){return Os(Ps,n)}function Gs(n){return Os(Ns,n)}function Hs(n){return Os(Us,n)}function Qs(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return Promise.all(e.filter((function(n){return n})).map(function(){var n=Object(r.a)(Object(a.a)().mark((function n(e){var t;return Object(a.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(Hs(e)||!Gs(e)){n.next=5;break}return n.next=3,Gs(e)();case 3:t=n.sent,Dr.component(e,t.default);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()))}function Vs(n,e){"undefined"!=typeof window&&window.__VUEPRESS__&&(window.__VUEPRESS__[n]=e)}var Ks=t(145),Ws=(t(130),t(118),t(83),t(224)),Js=t.n(Ws),Xs=t(225),Ys=t.n(Xs),Zs={created:function(){if(this.siteMeta=this.$site.headTags.filter((function(n){return"meta"===Object(Ks.a)(n,1)[0]})).map((function(n){var e=Object(Ks.a)(n,2);e[0];return e[1]})),this.$ssrContext){var n=this.getMergedMetaTags();this.$ssrContext.title=this.$title,this.$ssrContext.lang=this.$lang,this.$ssrContext.pageMeta=(e=n)?e.map((function(n){var e="<meta";return Object.keys(n).forEach((function(t){e+=" ".concat(t,'="').concat(Ys()(n[t]),'"')})),e+">"})).join("\n    "):"",this.$ssrContext.canonicalLink=eo(this.$canonicalUrl)}var e},mounted:function(){this.currentMetaTags=Object(qs.a)(document.querySelectorAll("meta")),this.updateMeta(),this.updateCanonicalLink()},methods:{updateMeta:function(){document.title=this.$title,document.documentElement.lang=this.$lang;var n=this.getMergedMetaTags();this.currentMetaTags=to(n,this.currentMetaTags)},getMergedMetaTags:function(){var n=this.$page.frontmatter.meta||[];return Js()([{name:"description",content:this.$description}],n,this.siteMeta,ao)},updateCanonicalLink:function(){no(),this.$canonicalUrl&&document.head.insertAdjacentHTML("beforeend",eo(this.$canonicalUrl))}},watch:{$page:function(){this.updateMeta(),this.updateCanonicalLink()}},beforeDestroy:function(){to(null,this.currentMetaTags),no()}};function no(){var n=document.querySelector("link[rel='canonical']");n&&n.remove()}function eo(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return n?'<link href="'.concat(n,'" rel="canonical" />'):""}function to(n,e){if(e&&Object(qs.a)(e).filter((function(n){return n.parentNode===document.head})).forEach((function(n){return document.head.removeChild(n)})),n)return n.map((function(n){var e=document.createElement("meta");return Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),document.head.appendChild(e),e}))}function ao(n){for(var e=0,t=["name","property","itemprop"];e<t.length;e++){var a=t[e];if(n.hasOwnProperty(a))return n[a]+a}return JSON.stringify(n)}t(147);var ro=t(158),io={mounted:function(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll:t.n(ro)()((function(){this.setActiveHash()}),300),setActiveHash:function(){for(var n=this,e=[].slice.call(document.querySelectorAll(".sidebar-link")),t=[].slice.call(document.querySelectorAll(".header-anchor")).filter((function(n){return e.some((function(e){return e.hash===n.hash}))})),a=Math.max(window.pageYOffset,document.documentElement.scrollTop,document.body.scrollTop),r=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),i=window.innerHeight+a,s=0;s<t.length;s++){var o=t[s],l=t[s+1],c=0===s&&0===a||a>=o.parentElement.offsetTop+10&&(!l||a<l.parentElement.offsetTop-10),d=decodeURIComponent(this.$route.hash);if(c&&d!==decodeURIComponent(o.hash)){var u=o;if(i===r)for(var m=s+1;m<t.length;m++)if(d===decodeURIComponent(t[m].hash))return;return this.$vuepress.$set("disableScrollBehavior",!0),void this.$router.replace(decodeURIComponent(u.hash),(function(){n.$nextTick((function(){n.$vuepress.$set("disableScrollBehavior",!1)}))}))}}}},beforeDestroy:function(){window.removeEventListener("scroll",this.onScroll)}},so=(t(87),t(109)),oo=t.n(so),lo={mounted:function(){var n=this;oo.a.configure({showSpinner:!1}),this.$router.beforeEach((function(n,e,t){n.path===e.path||Dr.component(n.name)||oo.a.start(),t()})),this.$router.afterEach((function(){oo.a.done(),n.isSidebarOpen=!1}))}};t(85),t(44),t(88),t(389);function co(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}t(111);function uo(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}function mo(n,e,t){return e&&uo(n.prototype,e),t&&uo(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}t(390);var po=function(){function n(){co(this,n);this.containerEl=document.getElementById("message-container"),this.containerEl||(this.containerEl=document.createElement("div"),this.containerEl.id="message-container",document.body.appendChild(this.containerEl))}return mo(n,[{key:"show",value:function(n){var e=this,t=n.text,a=void 0===t?"":t,r=n.duration,i=void 0===r?3e3:r,s=document.createElement("div");s.className="message move-in",s.innerHTML='\n      <i style="fill: #06a35a;font-size: 14px;display:inline-flex;align-items: center;">\n        <svg style="fill: #06a35a;font-size: 14px;" t="1572421810237" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2323" width="16" height="16"><path d="M822.811993 824.617989c-83.075838 81.99224-188.546032 124.613757-316.049383 127.86455-122.085362-3.250794-223.943563-45.87231-305.935802-127.86455s-124.613757-184.21164-127.86455-305.935802c3.250794-127.503351 45.87231-232.973545 127.86455-316.049383 81.99224-83.075838 184.21164-126.058554 305.935802-129.309347 127.503351 3.250794 232.973545 46.23351 316.049383 129.309347 83.075838 83.075838 126.058554 188.546032 129.309347 316.049383C949.231746 640.406349 905.887831 742.62575 822.811993 824.617989zM432.716755 684.111464c3.973192 3.973192 8.307584 5.779189 13.364374 6.140388 5.05679 0.361199 9.752381-1.444797 13.364374-5.417989l292.571429-287.514638c3.973192-3.973192 5.779189-8.307584 5.779189-13.364374 0-5.05679-1.805996-9.752381-5.779189-13.364374l1.805996 1.805996c-3.973192-3.973192-8.668783-5.779189-14.086772-6.140388-5.417989-0.361199-10.47478 1.444797-14.809171 5.417989l-264.397884 220.33157c-3.973192 3.250794-8.668783 4.695591-14.447972 4.695591-5.779189 0-10.835979-1.444797-15.53157-3.973192l-94.273016-72.962257c-4.334392-3.250794-9.391182-4.334392-14.447972-3.973192s-9.391182 3.250794-12.641975 7.585185l-2.889594 3.973192c-3.250794 4.334392-4.334392 9.391182-3.973192 14.809171 0.722399 5.417989 2.528395 10.11358 5.779189 14.086772L432.716755 684.111464z" p-id="2324"></path></svg>\n      </i>\n      <div class="text">'.concat(a,"</div>\n    "),this.containerEl.appendChild(s),i>0&&setTimeout((function(){e.close(s)}),i)}},{key:"close",value:function(n){n.className=n.className.replace("move-in",""),n.className+="move-out",n.addEventListener("animationend",(function(){n.remove()}))}}]),n}(),ho={mounted:function(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},updated:function(){!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||this.updateCopy()},methods:{updateCopy:function(){var n=this;setTimeout((function(){(['div[class*="language-"] pre','div[class*="aside-code"] aside']instanceof Array||Array.isArray(['div[class*="language-"] pre','div[class*="aside-code"] aside']))&&['div[class*="language-"] pre','div[class*="aside-code"] aside'].forEach((function(e){document.querySelectorAll(e).forEach(n.generateCopyButton)}))}),1e3)},generateCopyButton:function(n){var e=this;if(!n.classList.contains("codecopy-enabled")){var t=document.createElement("i");t.className="code-copy",t.innerHTML='<svg  style="color:#aaa;font-size:14px" t="1572422231464" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3201" width="14" height="14"><path d="M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z" p-id="3202"></path></svg>',t.title="Copy to clipboard",t.addEventListener("click",(function(){e.copyToClipboard(n.innerText)})),n.appendChild(t),n.classList.add("codecopy-enabled")}},copyToClipboard:function(n){var e=document.createElement("textarea");e.value=n,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e);var t=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);e.select(),document.execCommand("copy"),(new po).show({text:"å¤å¶æå",duration:1e3}),document.body.removeChild(e),t&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(t))}}};t(239),t(84),t(146),t(148),t(144);!function(n,e){void 0===e&&(e={});var t=e.insertAt;if(n&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===t&&a.firstChild?a.insertBefore(r,a.firstChild):a.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}("@media (max-width: 1000px) {\n  .vuepress-plugin-demo-block__h_code {\n    display: none;\n  }\n  .vuepress-plugin-demo-block__app {\n    margin-left: auto !important;\n    margin-right: auto !important;\n  }\n}\n.vuepress-plugin-demo-block__wrapper {\n  margin-top: 10px;\n  border: 1px solid #ebebeb;\n  border-radius: 4px;\n  transition: all 0.2s;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display {\n  height: 400px;\n  display: flex;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__app {\n  width: 300px;\n  border: 1px solid #ebebeb;\n  box-shadow: 1px 1px 3px #ebebeb;\n  margin-right: 5px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code {\n  flex: 1;\n  overflow: auto;\n  height: 100%;\n}\n.vuepress-plugin-demo-block__wrapper.vuepress-plugin-demo-block__horizontal .vuepress-plugin-demo-block__display .vuepress-plugin-demo-block__h_code > pre {\n  overflow: visible;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  max-height: 400px;\n  overflow: auto;\n}\n.vuepress-plugin-demo-block__wrapper div {\n  box-sizing: border-box;\n}\n.vuepress-plugin-demo-block__wrapper:hover {\n  box-shadow: 0 0 11px rgba(33, 33, 33, 0.2);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code {\n  overflow: hidden;\n  height: 0;\n  padding: 0 !important;\n  background-color: #282c34;\n  border-radius: 0 !important;\n  transition: height 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__code pre {\n  margin: 0 !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__display {\n  padding: 20px;\n  border-bottom: 1px solid #ebebeb;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer {\n  position: relative;\n  text-align: center;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__codepen {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer.vuepress-plugin-demo-block__show-link .vuepress-plugin-demo-block__expand::before {\n  border-top: none;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #ccc;\n  border-left: 6px solid transparent;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__codepen,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand span,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand {\n  opacity: 1;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover .vuepress-plugin-demo-block__expand::before {\n  border-top-color: #3eaf7c !important;\n  border-bottom-color: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer:hover svg {\n  fill: #3eaf7c !important;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand-text {\n  transition: all 0.5s;\n  opacity: 0;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:nth-last-child(2) {\n  right: 50px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer form:last-child {\n  right: 10px;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button {\n  border-color: transparent;\n  background-color: transparent;\n  font-size: 14px;\n  color: #3eaf7c;\n  cursor: pointer;\n  outline: none;\n  margin: 0;\n  width: 46px;\n  position: relative;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::before {\n  content: attr(data-tip);\n  white-space: nowrap;\n  position: absolute;\n  top: -30px;\n  left: 50%;\n  color: #eee;\n  line-height: 1;\n  z-index: 1000;\n  border-radius: 4px;\n  padding: 6px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  background-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button:hover::after {\n  content: '' !important;\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: -5px;\n  -webkit-transform: translateX(-50%);\n          transform: translateX(-50%);\n  border: 5px solid transparent;\n  border-top-color: rgba(0, 0, 0, 0.8);\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__button svg {\n  width: 34px;\n  height: 20px;\n  fill: #ccc;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__jsfiddle,\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__codepen {\n  position: absolute;\n  top: 10px;\n  transition: all 0.5s;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand {\n  position: relative;\n  width: 100px;\n  height: 40px;\n  margin: 0;\n  color: #3eaf7c;\n  font-size: 14px;\n  background-color: transparent;\n  border-color: transparent;\n  outline: none;\n  transition: all 0.5s;\n  cursor: pointer;\n}\n.vuepress-plugin-demo-block__wrapper .vuepress-plugin-demo-block__footer .vuepress-plugin-demo-block__expand::before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 0;\n  height: 0;\n  border-top: 6px solid #ccc;\n  border-right: 6px solid transparent;\n  border-left: 6px solid transparent;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n");var go={jsLib:[],cssLib:[],jsfiddle:!0,codepen:!0,codepenLayout:"left",codepenJsProcessor:"babel",codepenEditors:"101",horizontal:!1,vue:"https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js",react:"https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js",reactDOM:"https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"},fo={},bo=function(n){return'<div id="app">\n'.concat(n,"\n</div>")},yo=function(n){return window.$VUEPRESS_DEMO_BLOCK&&void 0!==window.$VUEPRESS_DEMO_BLOCK[n]?window.$VUEPRESS_DEMO_BLOCK[n]:go[n]},vo=function n(e,t,a){var r=document.createElement(e);return t&&Object.keys(t).forEach((function(n){if(n.indexOf("data"))r[n]=t[n];else{var e=n.replace("data","");r.dataset[e]=t[n]}})),a&&a.forEach((function(e){var t=e.tag,a=e.attrs,i=e.children;r.appendChild(n(t,a,i))})),r},_o=function(n,e,t){var a,r=(a=n.querySelectorAll(".".concat(e)),Array.prototype.slice.call(a));return 1!==r.length||t?r:r[0]},xo=function(n,e){var t,a,r=n.match(/<style>([\s\S]+)<\/style>/),i=n.match(/<template>([\s\S]+)<\/template>/),s=n.match(/<script>([\s\S]+)<\/script>/),o={css:r&&r[1].replace(/^\n|\n$/g,""),html:i&&i[1].replace(/^\n|\n$/g,""),js:s&&s[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};o.htmlTpl=bo(o.html),o.jsTpl=(t=o.js,a=t.replace(/export\s+default\s*?\{\n*/,"").replace(/\n*\}\s*$/,"").trim(),"new Vue({\n  el: '#app',\n  ".concat(a,"\n})")),o.script=function(n,e){var t=n.split(/export\s+default/),a="(function() {".concat(t[0]," ; return ").concat(t[1],"})()"),r=window.Babel?window.Babel.transform(a,{presets:["es2015"]}).code:a,i=[eval][0](r);return i.template=e,i}(o.js,o.html);var l=yo("vue");return o.jsLib.unshift(l),o},Eo=function(n,e){var t,a=n.match(/<style>([\s\S]+)<\/style>/),r=n.match(/<html>([\s\S]+)<\/html>/),i=n.match(/<script>([\s\S]+)<\/script>/),s={css:a&&a[1].replace(/^\n|\n$/g,""),html:r&&r[1].replace(/^\n|\n$/g,""),js:i&&i[1].replace(/^\n|\n$/g,""),jsLib:e.jsLib||[],cssLib:e.cssLib||[]};return s.htmlTpl=s.html,s.jsTpl=s.js,s.script=(t=s.js,window.Babel?window.Babel.transform(t,{presets:["es2015"]}).code:t),s},To=function(n){return n=n.replace("export default ","").replace(/App\.__style__(\s*)=(\s*)`([\s\S]*)?`/,""),n+='ReactDOM.render(React.createElement(App), document.getElementById("app"))'};function Io(){var n=_o(document,"vuepress-plugin-demo-block__wrapper",!0);n.length?n.forEach((function(n){if("true"!==n.dataset.created){n.style.display="block";var e=_o(n,"vuepress-plugin-demo-block__code"),t=_o(n,"vuepress-plugin-demo-block__display"),a=_o(n,"vuepress-plugin-demo-block__footer"),r=_o(t,"vuepress-plugin-demo-block__app"),i=decodeURIComponent(n.dataset.code),s=decodeURIComponent(n.dataset.config),o=decodeURIComponent(n.dataset.type);s=s?JSON.parse(s):{};var l=e.querySelector("div").clientHeight,c="react"===o?function(n,e){var t=(0,window.Babel.transform)(n,{presets:["es2015","react"]}).code,a="(function(exports){var module={};module.exports=exports;".concat(t,";return module.exports.__esModule?module.exports.default:module.exports;})({})"),r=new Function("return ".concat(a))(),i={js:r,css:r.__style__||"",jsLib:e.jsLib||[],cssLib:e.cssLib||[],jsTpl:To(n),htmlTpl:bo("")},s=yo("react"),o=yo("reactDOM");return i.jsLib.unshift(s,o),i}(i,s):"vanilla"===o?Eo(i,s):xo(i,s),d=vo("button",{className:"".concat("vuepress-plugin-demo-block__expand")});if(a.appendChild(d),d.addEventListener("click",ko.bind(null,d,l,e,a)),yo("jsfiddle")&&a.appendChild(function(n){var e=n.css,t=n.htmlTpl,a=n.jsTpl,r=n.jsLib,i=n.cssLib,s=r.concat(i).concat(yo("cssLib")).concat(yo("jsLib")).join(",");return vo("form",{className:"vuepress-plugin-demo-block__jsfiddle",target:"_blank",action:"https://jsfiddle.net/api/post/library/pure/",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"css",value:e}},{tag:"input",attrs:{type:"hidden",name:"html",value:t}},{tag:"input",attrs:{type:"hidden",name:"js",value:a}},{tag:"input",attrs:{type:"hidden",name:"panel_js",value:3}},{tag:"input",attrs:{type:"hidden",name:"wrap",value:1}},{tag:"input",attrs:{type:"hidden",name:"resources",value:s}},{tag:"button",attrs:{type:"submit",className:"vuepress-plugin-demo-block__button",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088289967" class="icon" style="" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1952" xmlns:xlink="http://www.w3.org/1999/xlink" width="228.515625" height="200"><defs><style type="text/css"></style></defs><path d="M1028.571429 441.142857q63.428571 26.285714 102.571428 83.142857T1170.285714 650.857143q0 93.714286-67.428571 160.285714T940 877.714286q-2.285714 0-6.571429-0.285715t-6-0.285714H232q-97.142857-5.714286-164.571429-71.714286T0 645.142857q0-62.857143 31.428571-116t84-84q-6.857143-22.285714-6.857142-46.857143 0-65.714286 46.857142-112t113.714286-46.285714q54.285714 0 98.285714 33.142857 42.857143-88 127.142858-141.714286t186.571428-53.714285q94.857143 0 174.857143 46T982.571429 248.571429t46.571428 172q0 3.428571-0.285714 10.285714t-0.285714 10.285714zM267.428571 593.142857q0 69.714286 48 110.285714t118.857143 40.571429q78.285714 0 137.142857-56.571429-9.142857-11.428571-27.142857-32.285714T519.428571 626.285714q-38.285714 37.142857-82.285714 37.142857-31.428571 0-53.428571-19.142857T361.714286 594.285714q0-30.285714 22-49.714285t52.285714-19.428572q25.142857 0 48.285714 12t41.714286 31.428572 37.142857 42.857142 39.428572 46.857143 44 42.857143 55.428571 31.428572 69.428571 12q69.142857 0 116.857143-40.857143T936 594.857143q0-69.142857-48-109.714286t-118.285714-40.571428q-81.714286 0-137.714286 55.428571l53.142857 61.714286q37.714286-36.571429 81.142857-36.571429 29.714286 0 52.571429 18.857143t22.857143 48q0 32.571429-21.142857 52.285714t-53.714286 19.714286q-24.571429 0-47.142857-12t-41.142857-31.428571-37.428572-42.857143-39.714286-46.857143-44.285714-42.857143-55.142857-31.428571T434.285714 444.571429q-69.714286 0-118.285714 40.285714T267.428571 593.142857z" p-id="1953"></path></svg>',datatip:"JSFiddle"}}])}(c)),yo("codepen")&&a.appendChild(function(n){var e=n.css,t=n.htmlTpl,a=n.jsTpl,r=n.jsLib,i=n.cssLib,s=JSON.stringify({css:e,html:t,js:a,js_external:r.concat(yo("jsLib")).join(";"),css_external:i.concat(yo("cssLib")).join(";"),layout:yo("codepenLayout"),js_pre_processor:yo("codepenJsProcessor"),editors:yo("codepenEditors")});return vo("form",{className:"vuepress-plugin-demo-block__codepen",target:"_blank",action:"https://codepen.io/pen/define",method:"post"},[{tag:"input",attrs:{type:"hidden",name:"data",value:s}},{tag:"button",attrs:{type:"submit",innerHTML:'<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1547088271207" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1737" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M123.428571 668l344.571429 229.714286v-205.142857L277.142857 565.142857z m-35.428571-82.285714l110.285714-73.714286-110.285714-73.714286v147.428572z m468 312l344.571429-229.714286-153.714286-102.857143-190.857143 127.428572v205.142857z m-44-281.714286l155.428571-104-155.428571-104-155.428571 104zM277.142857 458.857143l190.857143-127.428572V126.285714L123.428571 356z m548.571429 53.142857l110.285714 73.714286V438.285714z m-78.857143-53.142857l153.714286-102.857143-344.571429-229.714286v205.142857z m277.142857-102.857143v312q0 23.428571-19.428571 36.571429l-468 312q-12 7.428571-24.571429 7.428571t-24.571429-7.428571L19.428571 704.571429q-19.428571-13.142857-19.428571-36.571429V356q0-23.428571 19.428571-36.571429L487.428571 7.428571q12-7.428571 24.571429-7.428571t24.571429 7.428571l468 312q19.428571 13.142857 19.428571 36.571429z" p-id="1738"></path></svg>',className:"vuepress-plugin-demo-block__button",datatip:"Codepen"}}])}(c)),void 0!==s.horizontal?s.horizontal:yo("horizontal")){n.classList.add("vuepress-plugin-demo-block__horizontal");var u=e.firstChild.cloneNode(!0);u.classList.add("vuepress-plugin-demo-block__h_code"),t.appendChild(u)}if(c.css&&function(n){if(!fo[n]){var e=vo("style",{innerHTML:n});document.body.appendChild(e),fo[n]=!0}}(c.css),"react"===o)ReactDOM.render(React.createElement(c.js),r);else if("vue"===o){var m=(new(Vue.extend(c.script))).$mount();r.appendChild(m.$el)}else"vanilla"===o&&(r.innerHTML=c.html,new Function("return (function(){".concat(c.script,"})()"))());n.dataset.created="true"}})):setTimeout((function(n){Io()}),300)}function ko(n,e,t,a){var r="1"!==n.dataset.isExpand;t.style.height=r?"".concat(e,"px"):0,r?a.classList.add("vuepress-plugin-demo-block__show-link"):a.classList.remove("vuepress-plugin-demo-block__show-link"),n.dataset.isExpand=r?"1":"0"}var So={mounted:function(){window.$VUEPRESS_DEMO_BLOCK={jsfiddle:!1,codepen:!0,horizontal:!1},Io()},updated:function(){Io()}},qo=(t(228),"auto"),wo="zoom-in",Ro="zoom-out",Ao="grab",zo="move";function Lo(n,e,t){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r={passive:!1};a?n.addEventListener(e,t,r):n.removeEventListener(e,t,r)}function Mo(n,e){if(n){var t=new Image;t.onload=function(){e&&e(t)},t.src=n}}function Do(n){return n.dataset.original?n.dataset.original:"A"===n.parentNode.tagName?n.parentNode.getAttribute("href"):null}function Bo(n,e,t){!function(n){var e=Oo,t=Co;if(n.transition){var a=n.transition;delete n.transition,n[e]=a}if(n.transform){var r=n.transform;delete n.transform,n[t]=r}}(e);var a=n.style,r={};for(var i in e)t&&(r[i]=a[i]||""),a[i]=e[i];return r}var Oo="transition",Co="transform",No="transform",jo="transitionend";var Po=function(){},Uo={enableGrab:!0,preloadImage:!1,closeOnWindowResize:!0,transitionDuration:.4,transitionTimingFunction:"cubic-bezier(0.4, 0, 0, 1)",bgColor:"rgb(255, 255, 255)",bgOpacity:1,scaleBase:1,scaleExtra:.5,scrollThreshold:40,zIndex:998,customSize:null,onOpen:Po,onClose:Po,onGrab:Po,onMove:Po,onRelease:Po,onBeforeOpen:Po,onBeforeClose:Po,onBeforeGrab:Po,onBeforeRelease:Po,onImageLoading:Po,onImageLoaded:Po},Fo={init:function(n){var e,t;e=this,t=n,Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(n){e[n]=e[n].bind(t)}))},click:function(n){if(n.preventDefault(),Go(n))return window.open(this.target.srcOriginal||n.currentTarget.src,"_blank");this.shown?this.released?this.close():this.release():this.open(n.currentTarget)},scroll:function(){var n=document.documentElement||document.body.parentNode||document.body,e=window.pageXOffset||n.scrollLeft,t=window.pageYOffset||n.scrollTop;null===this.lastScrollPosition&&(this.lastScrollPosition={x:e,y:t});var a=this.lastScrollPosition.x-e,r=this.lastScrollPosition.y-t,i=this.options.scrollThreshold;(Math.abs(r)>=i||Math.abs(a)>=i)&&(this.lastScrollPosition=null,this.close())},keydown:function(n){(function(n){return"Escape"===(n.key||n.code)||27===n.keyCode})(n)&&(this.released?this.close():this.release(this.close))},mousedown:function(n){if($o(n)&&!Go(n)){n.preventDefault();var e=n.clientX,t=n.clientY;this.pressTimer=setTimeout(function(){this.grab(e,t)}.bind(this),200)}},mousemove:function(n){this.released||this.move(n.clientX,n.clientY)},mouseup:function(n){$o(n)&&!Go(n)&&(clearTimeout(this.pressTimer),this.released?this.close():this.release())},touchstart:function(n){n.preventDefault();var e=n.touches[0],t=e.clientX,a=e.clientY;this.pressTimer=setTimeout(function(){this.grab(t,a)}.bind(this),200)},touchmove:function(n){if(!this.released){var e=n.touches[0],t=e.clientX,a=e.clientY;this.move(t,a)}},touchend:function(n){(function(n){n.targetTouches.length})(n)||(clearTimeout(this.pressTimer),this.released?this.close():this.release())},clickOverlay:function(){this.close()},resizeWindow:function(){this.close()}};function $o(n){return 0===n.button}function Go(n){return n.metaKey||n.ctrlKey}var Ho={init:function(n){this.el=document.createElement("div"),this.instance=n,this.parent=document.body,Bo(this.el,{position:"fixed",top:0,left:0,right:0,bottom:0,opacity:0}),this.updateStyle(n.options),Lo(this.el,"click",n.handler.clickOverlay.bind(n))},updateStyle:function(n){Bo(this.el,{zIndex:n.zIndex,backgroundColor:n.bgColor,transition:"opacity\n        "+n.transitionDuration+"s\n        "+n.transitionTimingFunction})},insert:function(){this.parent.appendChild(this.el)},remove:function(){this.parent.removeChild(this.el)},fadeIn:function(){this.el.offsetWidth,this.el.style.opacity=this.instance.options.bgOpacity},fadeOut:function(){this.el.style.opacity=0}},Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Vo=function(){function n(n,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,a.key,a)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),Ko=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(n[a]=t[a])}return n},Wo={init:function(n,e){this.el=n,this.instance=e,this.srcThumbnail=this.el.getAttribute("src"),this.srcset=this.el.getAttribute("srcset"),this.srcOriginal=Do(this.el),this.rect=this.el.getBoundingClientRect(),this.translate=null,this.scale=null,this.styleOpen=null,this.styleClose=null},zoomIn:function(){var n=this.instance.options,e=n.zIndex,t=n.enableGrab,a=n.transitionDuration,r=n.transitionTimingFunction;this.translate=this.calculateTranslate(),this.scale=this.calculateScale(),this.styleOpen={position:"relative",zIndex:e+1,cursor:t?Ao:Ro,transition:No+"\n        "+a+"s\n        "+r,transform:"translate3d("+this.translate.x+"px, "+this.translate.y+"px, 0px)\n        scale("+this.scale.x+","+this.scale.y+")",height:this.rect.height+"px",width:this.rect.width+"px"},this.el.offsetWidth,this.styleClose=Bo(this.el,this.styleOpen,!0)},zoomOut:function(){this.el.offsetWidth,Bo(this.el,{transform:"none"})},grab:function(n,e,t){var a=Jo(),r=a.x-n,i=a.y-e;Bo(this.el,{cursor:zo,transform:"translate3d(\n        "+(this.translate.x+r)+"px, "+(this.translate.y+i)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},move:function(n,e,t){var a=Jo(),r=a.x-n,i=a.y-e;Bo(this.el,{transition:No,transform:"translate3d(\n        "+(this.translate.x+r)+"px, "+(this.translate.y+i)+"px, 0px)\n        scale("+(this.scale.x+t)+","+(this.scale.y+t)+")"})},restoreCloseStyle:function(){Bo(this.el,this.styleClose)},restoreOpenStyle:function(){Bo(this.el,this.styleOpen)},upgradeSource:function(){if(this.srcOriginal){var n=this.el.parentNode;this.srcset&&this.el.removeAttribute("srcset");var e=this.el.cloneNode(!1);e.setAttribute("src",this.srcOriginal),e.style.position="fixed",e.style.visibility="hidden",n.appendChild(e),setTimeout(function(){this.el.setAttribute("src",this.srcOriginal),n.removeChild(e)}.bind(this),50)}},downgradeSource:function(){this.srcOriginal&&(this.srcset&&this.el.setAttribute("srcset",this.srcset),this.el.setAttribute("src",this.srcThumbnail))},calculateTranslate:function(){var n=Jo(),e=this.rect.left+this.rect.width/2,t=this.rect.top+this.rect.height/2;return{x:n.x-e,y:n.y-t}},calculateScale:function(){var n=this.el.dataset,e=n.zoomingHeight,t=n.zoomingWidth,a=this.instance.options,r=a.customSize,i=a.scaleBase;if(!r&&e&&t)return{x:t/this.rect.width,y:e/this.rect.height};if(r&&"object"===(void 0===r?"undefined":Qo(r)))return{x:r.width/this.rect.width,y:r.height/this.rect.height};var s=this.rect.width/2,o=this.rect.height/2,l=Jo(),c={x:l.x-s,y:l.y-o},d=c.x/s,u=c.y/o,m=i+Math.min(d,u);if(r&&"string"==typeof r){var p=t||this.el.naturalWidth,h=e||this.el.naturalHeight,g=parseFloat(r)*p/(100*this.rect.width),f=parseFloat(r)*h/(100*this.rect.height);if(m>g||m>f)return{x:g,y:f}}return{x:m,y:m}}};function Jo(){var n=document.documentElement;return{x:Math.min(n.clientWidth,window.innerWidth)/2,y:Math.min(n.clientHeight,window.innerHeight)/2}}function Xo(n,e,t){["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"].forEach((function(a){Lo(n,a,e[a],t)}))}var Yo=function(){function n(e){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.target=Object.create(Wo),this.overlay=Object.create(Ho),this.handler=Object.create(Fo),this.body=document.body,this.shown=!1,this.lock=!1,this.released=!0,this.lastScrollPosition=null,this.pressTimer=null,this.options=Ko({},Uo,e),this.overlay.init(this),this.handler.init(this)}return Vo(n,[{key:"listen",value:function(n){if("string"==typeof n)for(var e=document.querySelectorAll(n),t=e.length;t--;)this.listen(e[t]);else"IMG"===n.tagName&&(n.style.cursor=wo,Lo(n,"click",this.handler.click),this.options.preloadImage&&Mo(Do(n)));return this}},{key:"config",value:function(n){return n?(Ko(this.options,n),this.overlay.updateStyle(this.options),this):this.options}},{key:"open",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.options.onOpen;if(!this.shown&&!this.lock){var a="string"==typeof n?document.querySelector(n):n;if("IMG"===a.tagName){if(this.options.onBeforeOpen(a),this.target.init(a,this),!this.options.preloadImage){var r=this.target.srcOriginal;null!=r&&(this.options.onImageLoading(a),Mo(r,this.options.onImageLoaded))}this.shown=!0,this.lock=!0,this.target.zoomIn(),this.overlay.insert(),this.overlay.fadeIn(),Lo(document,"scroll",this.handler.scroll),Lo(document,"keydown",this.handler.keydown),this.options.closeOnWindowResize&&Lo(window,"resize",this.handler.resizeWindow);var i=function n(){Lo(a,jo,n,!1),e.lock=!1,e.target.upgradeSource(),e.options.enableGrab&&Xo(document,e.handler,!0),t(a)};return Lo(a,jo,i),this}}}},{key:"close",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onClose;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeClose(t),this.lock=!0,this.body.style.cursor=qo,this.overlay.fadeOut(),this.target.zoomOut(),Lo(document,"scroll",this.handler.scroll,!1),Lo(document,"keydown",this.handler.keydown,!1),this.options.closeOnWindowResize&&Lo(window,"resize",this.handler.resizeWindow,!1);var a=function a(){Lo(t,jo,a,!1),n.shown=!1,n.lock=!1,n.target.downgradeSource(),n.options.enableGrab&&Xo(document,n.handler,!1),n.target.restoreCloseStyle(),n.overlay.remove(),e(t)};return Lo(t,jo,a),this}}},{key:"grab",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onGrab;if(this.shown&&!this.lock){var r=this.target.el;this.options.onBeforeGrab(r),this.released=!1,this.target.grab(n,e,t);var i=function n(){Lo(r,jo,n,!1),a(r)};return Lo(r,jo,i),this}}},{key:"move",value:function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.scaleExtra,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.options.onMove;if(this.shown&&!this.lock){this.released=!1,this.body.style.cursor=zo,this.target.move(n,e,t);var r=this.target.el,i=function n(){Lo(r,jo,n,!1),a(r)};return Lo(r,jo,i),this}}},{key:"release",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.options.onRelease;if(this.shown&&!this.lock){var t=this.target.el;this.options.onBeforeRelease(t),this.lock=!0,this.body.style.cursor=qo,this.target.restoreOpenStyle();var a=function a(){Lo(t,jo,a,!1),n.lock=!1,n.released=!0,e(t)};return Lo(t,jo,a),this}}}]),n}(),Zo=".theme-vdoing-content img:not(.no-zoom)",nl=JSON.parse('{"bgColor":"rgba(0,0,0,0.6)"}'),el=Number("500"),tl=function(){function n(){co(this,n),this.instance=new Yo(nl)}return mo(n,[{key:"update",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zo;"undefined"!=typeof window&&this.instance.listen(n)}},{key:"updateDelay",value:function(){var n=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:el;setTimeout((function(){return n.update(e)}),t)}}]),n}(),al=[Zs,io,lo,ho,So,{watch:{"$page.path":function(){void 0!==this.$vuepress.zooming&&this.$vuepress.zooming.updateDelay()}},mounted:function(){this.$vuepress.zooming=new tl,this.$vuepress.zooming.updateDelay()}}],rl={name:"GlobalLayout",computed:{layout:function(){var n=this.getLayout();return Vs("layout",n),Dr.component(n)}},methods:{getLayout:function(){if(this.$page.path){var n=this.$page.frontmatter.layout;return n&&(this.$vuepress.getLayoutAsyncComponent(n)||this.$vuepress.getVueComponent(n))?n:"Layout"}return"NotFound"}}},il=t(33),sl=Object(il.a)(rl,(function(){var n=this.$createElement;return(this._self._c||n)(this.layout,{tag:"component"})}),[],!1,null,null,null).exports;!function(n,e,t){var a;switch(e){case"components":n[e]||(n[e]={}),Object.assign(n[e],t);break;case"mixins":n[e]||(n[e]=[]),(a=n[e]).push.apply(a,Object(qs.a)(t));break;default:throw new Error("Unknown option name.")}}(sl,"mixins",al);var ol=[{name:"v-308e21ec",path:"/pages/4a5e3f/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-308e21ec").then(t)}},{path:"/pages/4a5e3f/index.html",redirect:"/pages/4a5e3f/"},{path:"/01.æ°æ®åºç»¼å/01.Nosqlææ¯éå.html",redirect:"/pages/4a5e3f/"},{name:"v-700c3ee7",path:"/pages/4702da/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-700c3ee7").then(t)}},{path:"/pages/4702da/index.html",redirect:"/pages/4702da/"},{path:"/01.æ°æ®åºç»¼å/02.æ°æ®ç»æä¸æ°æ®åºç´¢å¼.html",redirect:"/pages/4702da/"},{name:"v-2c1319b3",path:"/pages/6ed13e/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-2c1319b3").then(t)}},{path:"/pages/6ed13e/index.html",redirect:"/pages/6ed13e/"},{path:"/01.æ°æ®åºç»¼å/",redirect:"/pages/6ed13e/"},{name:"v-cd9e182e",path:"/pages/560051/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-cd9e182e").then(t)}},{path:"/pages/560051/index.html",redirect:"/pages/560051/"},{path:"/02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/01.ShardingSphereç®ä».html",redirect:"/pages/560051/"},{name:"v-722983de",path:"/pages/a9584d/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-722983de").then(t)}},{path:"/pages/a9584d/index.html",redirect:"/pages/a9584d/"},{path:"/02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/02.ShardingSphereJdbc.html",redirect:"/pages/a9584d/"},{name:"v-30339a31",path:"/pages/9f8daf/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-30339a31").then(t)}},{path:"/pages/9f8daf/index.html",redirect:"/pages/9f8daf/"},{path:"/02.æ°æ®åºä¸­é´ä»¶/02.Flyway.html",redirect:"/pages/9f8daf/"},{name:"v-aeaab6a8",path:"/pages/02d9f1/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-aeaab6a8").then(t)}},{path:"/pages/02d9f1/index.html",redirect:"/pages/02d9f1/"},{path:"/02.æ°æ®åºä¸­é´ä»¶/",redirect:"/pages/02d9f1/"},{name:"v-1a9f322e",path:"/pages/c798e3/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-1a9f322e").then(t)}},{path:"/pages/c798e3/index.html",redirect:"/pages/c798e3/"},{path:"/03.å³ç³»åæ°æ®åº/01.ç»¼å/01.å³ç³»åæ°æ®åºé¢è¯.html",redirect:"/pages/c798e3/"},{name:"v-2092ddb6",path:"/pages/f1c77c/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-2092ddb6").then(t)}},{path:"/pages/f1c77c/index.html",redirect:"/pages/f1c77c/"},{path:"/03.å³ç³»åæ°æ®åº/01.ç»¼å/02.SqlCheatSheet.html",redirect:"/pages/f1c77c/"},{name:"v-5e14aa88",path:"/pages/0f3524/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-5e14aa88").then(t)}},{path:"/pages/0f3524/index.html",redirect:"/pages/0f3524/"},{path:"/03.å³ç³»åæ°æ®åº/01.ç»¼å/03.æ©å±SQL.html",redirect:"/pages/0f3524/"},{name:"v-04da5df4",path:"/pages/1e2ee7/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-04da5df4").then(t)}},{path:"/pages/1e2ee7/index.html",redirect:"/pages/1e2ee7/"},{path:"/03.å³ç³»åæ°æ®åº/01.ç»¼å/",redirect:"/pages/1e2ee7/"},{name:"v-6d3cde8c",path:"/pages/0b2452/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-6d3cde8c").then(t)}},{path:"/pages/0b2452/index.html",redirect:"/pages/0b2452/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/01.Mysqlåºç¨æå.html",redirect:"/pages/0b2452/"},{name:"v-a6cffc1a",path:"/pages/0a031b/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-a6cffc1a").then(t)}},{path:"/pages/0a031b/index.html",redirect:"/pages/0a031b/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/02.MySQLå·¥ä½æµ.html",redirect:"/pages/0a031b/"},{name:"v-398cfa40",path:"/pages/f3295c/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-398cfa40").then(t)}},{path:"/pages/f3295c/index.html",redirect:"/pages/f3295c/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/03.Mysqläºå¡.html",redirect:"/pages/f3295c/"},{name:"v-0c3c1ebd",path:"/pages/86db3b/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-0c3c1ebd").then(t)}},{path:"/pages/86db3b/index.html",redirect:"/pages/86db3b/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/04.Mysqlé.html",redirect:"/pages/86db3b/"},{name:"v-6b994900",path:"/pages/516ac6/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-6b994900").then(t)}},{path:"/pages/516ac6/index.html",redirect:"/pages/516ac6/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/05.Mysqlç´¢å¼.html",redirect:"/pages/516ac6/"},{name:"v-63d8b17b",path:"/pages/8c404f/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-63d8b17b").then(t)}},{path:"/pages/8c404f/index.html",redirect:"/pages/8c404f/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/06.Mysqlæ§è½ä¼å.html",redirect:"/pages/8c404f/"},{name:"v-bf86eaa6",path:"/pages/ada3b2/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-bf86eaa6").then(t)}},{path:"/pages/ada3b2/index.html",redirect:"/pages/ada3b2/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/20.Mysqlè¿ç»´.html",redirect:"/pages/ada3b2/"},{name:"v-581951d7",path:"/pages/6ed8d9/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-581951d7").then(t)}},{path:"/pages/6ed8d9/index.html",redirect:"/pages/6ed8d9/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/21.Mysqléç½®.html",redirect:"/pages/6ed8d9/"},{name:"v-47bbb02c",path:"/pages/5885bb/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-47bbb02c").then(t)}},{path:"/pages/5885bb/index.html",redirect:"/pages/5885bb/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/99.Mysqlå¸¸è§é®é¢.html",redirect:"/pages/5885bb/"},{name:"v-075759e4",path:"/pages/a7b923/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-075759e4").then(t)}},{path:"/pages/a7b923/index.html",redirect:"/pages/a7b923/"},{path:"/03.å³ç³»åæ°æ®åº/02.Mysql/",redirect:"/pages/a7b923/"},{name:"v-5cb554e2",path:"/pages/1d898b/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-5cb554e2").then(t)}},{path:"/pages/1d898b/index.html",redirect:"/pages/1d898b/"},{path:"/03.å³ç³»åæ°æ®åº/99.å¶ä»/01.PostgreSQL.html",redirect:"/pages/1d898b/"},{name:"v-2b51d042",path:"/pages/87d312/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-2b51d042").then(t)}},{path:"/pages/87d312/index.html",redirect:"/pages/87d312/"},{path:"/03.å³ç³»åæ°æ®åº/99.å¶ä»/02.H2.html",redirect:"/pages/87d312/"},{name:"v-00d798bc",path:"/pages/d024ff/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-00d798bc").then(t)}},{path:"/pages/d024ff/index.html",redirect:"/pages/d024ff/"},{path:"/03.å³ç³»åæ°æ®åº/99.å¶ä»/03.Sqlite.html",redirect:"/pages/d024ff/"},{name:"v-598fed5e",path:"/pages/b2560d/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-598fed5e").then(t)}},{path:"/pages/b2560d/index.html",redirect:"/pages/b2560d/"},{path:"/03.å³ç³»åæ°æ®åº/99.å¶ä»/",redirect:"/pages/b2560d/"},{name:"v-10ae1758",path:"/pages/bdd9ad/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-10ae1758").then(t)}},{path:"/pages/bdd9ad/index.html",redirect:"/pages/bdd9ad/"},{path:"/03.å³ç³»åæ°æ®åº/",redirect:"/pages/bdd9ad/"},{name:"v-533deaa3",path:"/pages/56d5b6/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-533deaa3").then(t)}},{path:"/pages/56d5b6/index.html",redirect:"/pages/56d5b6/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/01.MongoDBåºç¨æå.html",redirect:"/pages/56d5b6/"},{name:"v-5f0cd72e",path:"/pages/d69d64/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-5f0cd72e").then(t)}},{path:"/pages/d69d64/index.html",redirect:"/pages/d69d64/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/02.MongoDBçCRUDæä½.html",redirect:"/pages/d69d64/"},{name:"v-8fff35f6",path:"/pages/2698b2/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-8fff35f6").then(t)}},{path:"/pages/2698b2/index.html",redirect:"/pages/2698b2/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/03.MongoDBçèåæä½.html",redirect:"/pages/2698b2/"},{name:"v-0fa53966",path:"/pages/3287fa/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-0fa53966").then(t)}},{path:"/pages/3287fa/index.html",redirect:"/pages/3287fa/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/04.MongoDBäºå¡.html",redirect:"/pages/3287fa/"},{name:"v-7bb10b88",path:"/pages/c154c4/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-7bb10b88").then(t)}},{path:"/pages/c154c4/index.html",redirect:"/pages/c154c4/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/05.MongoDBå»ºæ¨¡.html",redirect:"/pages/c154c4/"},{name:"v-1fb153de",path:"/pages/646187/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-1fb153de").then(t)}},{path:"/pages/646187/index.html",redirect:"/pages/646187/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/06.MongoDBå»ºæ¨¡ç¤ºä¾.html",redirect:"/pages/646187/"},{name:"v-7d04d94d",path:"/pages/1c75d4/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-7d04d94d").then(t)}},{path:"/pages/1c75d4/index.html",redirect:"/pages/1c75d4/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/07.MongoDBç´¢å¼.html",redirect:"/pages/1c75d4/"},{name:"v-681aa558",path:"/pages/e0b65c/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-681aa558").then(t)}},{path:"/pages/e0b65c/index.html",redirect:"/pages/e0b65c/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/08.MongoDBå¤å¶.html",redirect:"/pages/e0b65c/"},{name:"v-5ff0eb5a",path:"/pages/34b182/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-5ff0eb5a").then(t)}},{path:"/pages/34b182/index.html",redirect:"/pages/34b182/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/09.MongoDBåç.html",redirect:"/pages/34b182/"},{name:"v-6fc5b52c",path:"/pages/ce58ab/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-6fc5b52c").then(t)}},{path:"/pages/ce58ab/index.html",redirect:"/pages/ce58ab/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/20.MongoDBè¿ç»´.html",redirect:"/pages/ce58ab/"},{name:"v-25853052",path:"/pages/86cece/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-25853052").then(t)}},{path:"/pages/86cece/index.html",redirect:"/pages/86cece/"},{path:"/04.ææ¡£æ°æ®åº/01.MongoDB/",redirect:"/pages/86cece/"},{name:"v-3470a0b0",path:"/pages/c3ce07/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-3470a0b0").then(t)}},{path:"/pages/c3ce07/index.html",redirect:"/pages/c3ce07/"},{path:"/05.KVæ°æ®åº/01.Redis/01.Redisé¢è¯æ»ç».html",redirect:"/pages/c3ce07/"},{name:"v-2755550e",path:"/pages/5cd883/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-2755550e").then(t)}},{path:"/pages/5cd883/index.html",redirect:"/pages/5cd883/"},{path:"/05.KVæ°æ®åº/01.Redis/02.Redisåºç¨æå.html",redirect:"/pages/5cd883/"},{name:"v-00448410",path:"/pages/5d2de2/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-00448410").then(t)}},{path:"/pages/5d2de2/index.html",redirect:"/pages/5d2de2/"},{path:"/05.KVæ°æ®åº/01.Redis/03.Redisæ°æ®ç±»åååºç¨.html",redirect:"/pages/5d2de2/"},{name:"v-55c42fdf",path:"/pages/d61faa/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-55c42fdf").then(t)}},{path:"/pages/d61faa/index.html",redirect:"/pages/d61faa/"},{path:"/05.KVæ°æ®åº/01.Redis/04.Redisæä¹å.html",redirect:"/pages/d61faa/"},{name:"v-0dcd3e72",path:"/pages/0de16b/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-0dcd3e72").then(t)}},{path:"/pages/0de16b/index.html",redirect:"/pages/0de16b/"},{path:"/05.KVæ°æ®åº/01.Redis/05.Rediså¤å¶.html",redirect:"/pages/0de16b/"},{name:"v-d5c8af24",path:"/pages/5e23fc/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-d5c8af24").then(t)}},{path:"/pages/5e23fc/index.html",redirect:"/pages/5e23fc/"},{path:"/05.KVæ°æ®åº/01.Redis/06.Rediså¨åµ.html",redirect:"/pages/5e23fc/"},{name:"v-033ee0db",path:"/pages/6b0eb1/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-033ee0db").then(t)}},{path:"/pages/6b0eb1/index.html",redirect:"/pages/6b0eb1/"},{path:"/05.KVæ°æ®åº/01.Redis/07.Rediséç¾¤.html",redirect:"/pages/6b0eb1/"},{name:"v-4092c244",path:"/pages/199c5a/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-4092c244").then(t)}},{path:"/pages/199c5a/index.html",redirect:"/pages/199c5a/"},{path:"/05.KVæ°æ®åº/01.Redis/08.Rediså®æ.html",redirect:"/pages/199c5a/"},{name:"v-d49f587c",path:"/pages/8f1824/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-d49f587c").then(t)}},{path:"/pages/8f1824/index.html",redirect:"/pages/8f1824/"},{path:"/05.KVæ°æ®åº/01.Redis/20.Redisè¿ç»´.html",redirect:"/pages/8f1824/"},{name:"v-88bb15a6",path:"/pages/b2487a/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-88bb15a6").then(t)}},{path:"/pages/b2487a/index.html",redirect:"/pages/b2487a/"},{path:"/05.KVæ°æ®åº/01.Redis/",redirect:"/pages/b2487a/"},{name:"v-db539372",path:"/pages/b570af/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-db539372").then(t)}},{path:"/pages/b570af/index.html",redirect:"/pages/b570af/"},{path:"/06.åå¼æ°æ®åº/01.Hbase.html",redirect:"/pages/b570af/"},{name:"v-33028f47",path:"/pages/4c58c2/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-33028f47").then(t)}},{path:"/pages/4c58c2/index.html",redirect:"/pages/4c58c2/"},{path:"/06.åå¼æ°æ®åº/02.Cassandra.html",redirect:"/pages/4c58c2/"},{name:"v-5718adbb",path:"/pages/1f9edc/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-5718adbb").then(t)}},{path:"/pages/1f9edc/index.html",redirect:"/pages/1f9edc/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/01.Elasticsearché¢è¯æ»ç».html",redirect:"/pages/1f9edc/"},{name:"v-3e99c22e",path:"/pages/37b739/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-3e99c22e").then(t)}},{path:"/pages/37b739/index.html",redirect:"/pages/37b739/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/02.Elasticsearchå¿«éå¥é¨.html",redirect:"/pages/37b739/"},{name:"v-29937047",path:"/pages/6f7391/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-29937047").then(t)}},{path:"/pages/6f7391/index.html",redirect:"/pages/6f7391/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/03.Elasticsearchç®ä».html",redirect:"/pages/6f7391/"},{name:"v-a34eed14",path:"/pages/5291b4/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-a34eed14").then(t)}},{path:"/pages/5291b4/index.html",redirect:"/pages/5291b4/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/04.Elasticsearchç´¢å¼.html",redirect:"/pages/5291b4/"},{name:"v-fe41ffc6",path:"/pages/478bb5/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-fe41ffc6").then(t)}},{path:"/pages/478bb5/index.html",redirect:"/pages/478bb5/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ¥è¯¢.html",redirect:"/pages/478bb5/"},{name:"v-d28308f2",path:"/pages/4ae35a/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-d28308f2").then(t)}},{path:"/pages/4ae35a/index.html",redirect:"/pages/4ae35a/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/06.Elasticsearché«äº®.html",redirect:"/pages/4ae35a/"},{name:"v-0b132004",path:"/pages/44ca8e/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-0b132004").then(t)}},{path:"/pages/44ca8e/index.html",redirect:"/pages/44ca8e/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/07.Elasticsearchæåº.html",redirect:"/pages/44ca8e/"},{name:"v-272e6736",path:"/pages/93fa2a/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-272e6736").then(t)}},{path:"/pages/93fa2a/index.html",redirect:"/pages/93fa2a/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/08.Elasticsearchèå.html",redirect:"/pages/93fa2a/"},{name:"v-3afd3137",path:"/pages/c04143/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-3afd3137").then(t)}},{path:"/pages/c04143/index.html",redirect:"/pages/c04143/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/09.Elasticsearchåæå¨.html",redirect:"/pages/c04143/"},{name:"v-16b255f9",path:"/pages/dc6b0f/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-16b255f9").then(t)}},{path:"/pages/dc6b0f/index.html",redirect:"/pages/dc6b0f/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/10.Elasticsearchæ§è½ä¼å.html",redirect:"/pages/dc6b0f/"},{name:"v-eca4e092",path:"/pages/1edd27/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-eca4e092").then(t)}},{path:"/pages/1edd27/index.html",redirect:"/pages/1edd27/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/11.ElasticsearchRestApi.html",redirect:"/pages/1edd27/"},{name:"v-cd275a36",path:"/pages/baf137/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-cd275a36").then(t)}},{path:"/pages/baf137/index.html",redirect:"/pages/baf137/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.html",redirect:"/pages/baf137/"},{name:"v-32b9bb54",path:"/pages/d894ac/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-32b9bb54").then(t)}},{path:"/pages/d894ac/index.html",redirect:"/pages/d894ac/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/13.Elasticsearchéç¾¤ååç.html",redirect:"/pages/d894ac/"},{name:"v-4124258d",path:"/pages/805d11/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-4124258d").then(t)}},{path:"/pages/805d11/index.html",redirect:"/pages/805d11/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/20.Elasticsearchè¿ç»´.html",redirect:"/pages/805d11/"},{name:"v-31b667fe",path:"/pages/7324df/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-31b667fe").then(t)}},{path:"/pages/7324df/index.html",redirect:"/pages/7324df/"},{path:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/",redirect:"/pages/7324df/"},{name:"v-39fdaf1c",path:"/pages/d5bdd0/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-39fdaf1c").then(t)}},{path:"/pages/d5bdd0/index.html",redirect:"/pages/d5bdd0/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/01.Elasticå¿«éå¥é¨.html",redirect:"/pages/d5bdd0/"},{name:"v-4bfc28c7",path:"/pages/3efdd8/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-4bfc28c7").then(t)}},{path:"/pages/3efdd8/index.html",redirect:"/pages/3efdd8/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/02.Elasticææ¯æ ä¹Filebeat.html",redirect:"/pages/3efdd8/"},{name:"v-58ce2686",path:"/pages/43db0b/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-58ce2686").then(t)}},{path:"/pages/43db0b/index.html",redirect:"/pages/43db0b/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/03.Filebeatè¿ç»´.html",redirect:"/pages/43db0b/"},{name:"v-ed0e4772",path:"/pages/507fcc/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-ed0e4772").then(t)}},{path:"/pages/507fcc/index.html",redirect:"/pages/507fcc/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/04.Elasticææ¯æ ä¹Kibana.html",redirect:"/pages/507fcc/"},{name:"v-32457afd",path:"/pages/8d96f6/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-32457afd").then(t)}},{path:"/pages/8d96f6/index.html",redirect:"/pages/8d96f6/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/05.Kibanaè¿ç»´.html",redirect:"/pages/8d96f6/"},{name:"v-9a9ffafe",path:"/pages/0da19c/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-9a9ffafe").then(t)}},{path:"/pages/0da19c/index.html",redirect:"/pages/0da19c/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/06.Elasticææ¯æ ä¹Logstash.html",redirect:"/pages/0da19c/"},{name:"v-2e4e7fc6",path:"/pages/ec3c6f/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-2e4e7fc6").then(t)}},{path:"/pages/ec3c6f/index.html",redirect:"/pages/ec3c6f/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/07.Logstashè¿ç»´.html",redirect:"/pages/ec3c6f/"},{name:"v-5f7d314c",path:"/pages/976ee9/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-5f7d314c").then(t)}},{path:"/pages/976ee9/index.html",redirect:"/pages/976ee9/"},{path:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/",redirect:"/pages/976ee9/"},{name:"v-c7c85e2e",path:"/archives/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-c7c85e2e").then(t)}},{path:"/archives/index.html",redirect:"/archives/"},{path:"/@pages/archivesPage.html",redirect:"/archives/"},{name:"v-03067a49",path:"/categories/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-03067a49").then(t)}},{path:"/categories/index.html",redirect:"/categories/"},{path:"/@pages/categoriesPage.html",redirect:"/categories/"},{name:"v-be824b2e",path:"/tags/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-be824b2e").then(t)}},{path:"/tags/index.html",redirect:"/tags/"},{path:"/@pages/tagsPage.html",redirect:"/tags/"},{name:"v-91a7d35c",path:"/",component:sl,beforeEnter:function(n,e,t){Qs("Layout","v-91a7d35c").then(t)}},{path:"/index.html",redirect:"/"},{path:"*",component:sl}],ll={title:"DB-TUTORIAL",description:"â db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã",base:"/db-tutorial/",headTags:[["link",{rel:"icon",href:"/db-tutorial/img/favicon.ico"}],["meta",{name:"keywords",content:"vuepress,theme,blog,vdoing"}],["meta",{name:"theme-color",content:"#11a8cd"}]],pages:[{title:"Nosqlææ¯éå",frontmatter:{title:"Nosqlææ¯éå",date:"2020-02-09T02:18:58.000Z",categories:["æ°æ®åº","æ°æ®åºç»¼å"],tags:["æ°æ®åº","ç»¼å","Nosql"],permalink:"/pages/4a5e3f/"},regularPath:"/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%BC%E5%90%88/01.Nosql%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B.html",relativePath:"01.æ°æ®åºç»¼å/01.Nosqlææ¯éå.md",key:"v-308e21ec",path:"/pages/4a5e3f/",headers:[{level:2,title:"ä¸ãNosql ç®ä»",slug:"ä¸ãnosql-ç®ä»",normalizedTitle:"ä¸ãnosql ç®ä»",charIndex:19},{level:2,title:"äºãåå¼æ°æ®åº",slug:"äºãåå¼æ°æ®åº",normalizedTitle:"äºãåå¼æ°æ®åº",charIndex:1155},{level:3,title:"åå¼æ°æ®åºåç",slug:"åå¼æ°æ®åºåç",normalizedTitle:"åå¼æ°æ®åºåç",charIndex:1316},{level:3,title:"åå¼æ°æ®åºäº§å",slug:"åå¼æ°æ®åºäº§å",normalizedTitle:"åå¼æ°æ®åºäº§å",charIndex:1485},{level:3,title:"åå¼æ°æ®åºç¹æ§",slug:"åå¼æ°æ®åºç¹æ§",normalizedTitle:"åå¼æ°æ®åºç¹æ§",charIndex:1807},{level:3,title:"åå¼æ°æ®åºä½¿ç¨åºæ¯",slug:"åå¼æ°æ®åºä½¿ç¨åºæ¯",normalizedTitle:"åå¼æ°æ®åºä½¿ç¨åºæ¯",charIndex:2495},{level:2,title:"ä¸ãK-V æ°æ®åº",slug:"ä¸ãk-v-æ°æ®åº",normalizedTitle:"ä¸ãk-v æ°æ®åº",charIndex:2885},{level:3,title:"K-V æ°æ®åºäº§å",slug:"k-v-æ°æ®åºäº§å",normalizedTitle:"k-v æ°æ®åºäº§å",charIndex:3043},{level:3,title:"K-V æ°æ®åºç¹æ§",slug:"k-v-æ°æ®åºç¹æ§",normalizedTitle:"k-v æ°æ®åºç¹æ§",charIndex:3713},{level:3,title:"K-V æ°æ®åºä½¿ç¨åºæ¯",slug:"k-v-æ°æ®åºä½¿ç¨åºæ¯",normalizedTitle:"k-v æ°æ®åºä½¿ç¨åºæ¯",charIndex:4154},{level:2,title:"åãææ¡£æ°æ®åº",slug:"åãææ¡£æ°æ®åº",normalizedTitle:"åãææ¡£æ°æ®åº",charIndex:4383},{level:3,title:"ææ¡£æ°æ®åºäº§å",slug:"ææ¡£æ°æ®åºäº§å",normalizedTitle:"ææ¡£æ°æ®åºäº§å",charIndex:4598},{level:3,title:"ææ¡£æ°æ®åºç¹æ§",slug:"ææ¡£æ°æ®åºç¹æ§",normalizedTitle:"ææ¡£æ°æ®åºç¹æ§",charIndex:4957},{level:3,title:"ææ¡£æ°æ®åºä½¿ç¨åºæ¯",slug:"ææ¡£æ°æ®åºä½¿ç¨åºæ¯",normalizedTitle:"ææ¡£æ°æ®åºä½¿ç¨åºæ¯",charIndex:5447},{level:2,title:"äºãå¨ææç´¢å¼æ",slug:"äºãå¨ææç´¢å¼æ",normalizedTitle:"äºãå¨ææç´¢å¼æ",charIndex:5620},{level:3,title:"æç´¢å¼æåç",slug:"æç´¢å¼æåç",normalizedTitle:"æç´¢å¼æåç",charIndex:5814},{level:3,title:"æç´¢å¼æäº§å",slug:"æç´¢å¼æäº§å",normalizedTitle:"æç´¢å¼æäº§å",charIndex:6029},{level:3,title:"æç´¢å¼æç¹æ§",slug:"æç´¢å¼æç¹æ§",normalizedTitle:"æç´¢å¼æç¹æ§",charIndex:6422},{level:3,title:"æç´¢å¼æåºæ¯",slug:"æç´¢å¼æåºæ¯",normalizedTitle:"æç´¢å¼æåºæ¯",charIndex:6848},{level:2,title:"å­ãå¾æ°æ®åº",slug:"å­ãå¾æ°æ®åº",normalizedTitle:"å­ãå¾æ°æ®åº",charIndex:6979},{level:3,title:"å¾æ°æ®åºäº§å",slug:"å¾æ°æ®åºäº§å",normalizedTitle:"å¾æ°æ®åºäº§å",charIndex:7123},{level:3,title:"å¾æ°æ®åºç¹æ§",slug:"å¾æ°æ®åºç¹æ§",normalizedTitle:"å¾æ°æ®åºç¹æ§",charIndex:7592},{level:3,title:"å¾æ°æ®åºåºæ¯",slug:"å¾æ°æ®åºåºæ¯",normalizedTitle:"å¾æ°æ®åºåºæ¯",charIndex:8339},{level:2,title:"ä¸ãæ»ç»",slug:"ä¸ãæ»ç»",normalizedTitle:"ä¸ãæ»ç»",charIndex:8504},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8990}],headersStr:"ä¸ãNosql ç®ä» äºãåå¼æ°æ®åº åå¼æ°æ®åºåç åå¼æ°æ®åºäº§å åå¼æ°æ®åºç¹æ§ åå¼æ°æ®åºä½¿ç¨åºæ¯ ä¸ãK-V æ°æ®åº K-V æ°æ®åºäº§å K-V æ°æ®åºç¹æ§ K-V æ°æ®åºä½¿ç¨åºæ¯ åãææ¡£æ°æ®åº ææ¡£æ°æ®åºäº§å ææ¡£æ°æ®åºç¹æ§ ææ¡£æ°æ®åºä½¿ç¨åºæ¯ äºãå¨ææç´¢å¼æ æç´¢å¼æåç æç´¢å¼æäº§å æç´¢å¼æç¹æ§ æç´¢å¼æåºæ¯ å­ãå¾æ°æ®åº å¾æ°æ®åºäº§å å¾æ°æ®åºç¹æ§ å¾æ°æ®åºåºæ¯ ä¸ãæ»ç» åèèµæ",content:'# Nosql ææ¯éå\n\n\n\n\n# ä¸ãNosql ç®ä»\n\nä¼ ç»çå³ç³»åæ°æ®åºå­å¨ä»¥ä¸ç¼ºç¹ï¼\n\n * å¤§æ°æ®åºæ¯ä¸ I/O è¾é« - å ä¸ºæ°æ®æ¯æè¡å­å¨ï¼å³ä½¿åªéå¯¹å¶ä¸­æä¸åè¿è¡è¿ç®ï¼å³ç³»åæ°æ®åºä¹ä¼å°æ´è¡æ°æ®ä»å­å¨è®¾å¤ä¸­è¯»å¥åå­ï¼å¯¼è´ I/O è¾é«ã\n * å­å¨çæ¯è¡è®°å½ï¼æ æ³å­å¨æ°æ®ç»æã\n * è¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿ - å¦è¦éè¦ä¿®æ¹è¡¨ç»æï¼éè¦æ§è¡æ§è¡ DDL(data definition language)ï¼è¯­å¥ä¿®æ¹ï¼ä¿®æ¹æé´ä¼å¯¼è´éè¡¨ï¼é¨åæå¡ä¸å¯ç¨ã\n * å¨ææç´¢åè½è¾å¼± - å³ç³»åæ°æ®åºä¸åªè½å¤è¿è¡å­å­ç¬¦ä¸²çå¹éæ¥è¯¢ï¼å½è¡¨çæ°æ®éæ¸åå¤§çæ¶åï¼LIKE æ¥è¯¢çå¹éä¼éå¸¸æ¢ï¼å³ä½¿å¨æç´¢å¼çæåµä¸ãåµä¸å³ç³»åæ°æ®åºä¹ä¸åºè¯¥å¯¹ææ¬å­æ®µè¿è¡ç´¢å¼ã\n * å­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼± - è®¸å¤åºç¨ç¨åºéè¦äºè§£åå¯¼èªé«åº¦è¿æ¥æ°æ®ä¹é´çå³ç³»ï¼æè½å¯ç¨ç¤¾äº¤åºç¨ç¨åºãæ¨èå¼æãæ¬ºè¯æ£æµãç¥è¯å¾è°±ãçå½ç§å­¦å IT/ç½ç»ç­ç¨ä¾ãç¶èä¼ ç»çå³ç³»æ°æ®åºå¹¶ä¸åäºå¤çæ°æ®ç¹ä¹é´çå³ç³»ãå®ä»¬çè¡¨æ ¼æ°æ®æ¨¡ååä¸¥æ ¼çæ¨¡å¼ä½¿å®ä»¬å¾é¾æ·»å æ°çæä¸åç§ç±»çå³èä¿¡æ¯ã\n\néçå¤§æ°æ®æ¶ä»£çå°æ¥ï¼è¶æ¥è¶å¤çç½ç«ãåºç¨ç³»ç»éè¦æ¯ææµ·éæ°æ®å­å¨ï¼é«å¹¶åè¯·æ±ãé«å¯ç¨ãé«å¯æ©å±æ§ç­ç¹æ§è¦æ±ãä¼ ç»çå³ç³»åæ°æ®åºå¨åºä»è¿äºè°æ´å·²ç»æ¾å¾åä¸ä»å¿ï¼æ´é²äºè®¸å¤è½ä»¥åæçé®é¢ãç±æ­¤ï¼åç§åæ ·ç NoSQLï¼Not Only SQLï¼æ°æ®åºä½ä¸ºä¼ ç»å³ç³»åæ°æ®çä¸ä¸ªæåè¡¥åå¾å°è¿çåå±ã\n\n\n\nNoSQLï¼æ³æéå³ç³»åçæ°æ®åºï¼å¯ä»¥çè§£ä¸º SQL çä¸ä¸ªæåè¡¥åã\n\nå¨ NoSQL è®¸å¤æ¹é¢æ§è½å¤§å¤§ä¼äºéå³ç³»åæ°æ®åºçåæ¶ï¼å¾å¾ä¹ä¼´éä¸äºç¹æ§çç¼ºå¤±ï¼æ¯è¾å¸¸è§çï¼æ¯äºå¡åºäºå¡åè½çç¼ºå¤±ã æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼ACID å¦ä¸ï¼\n\n    åç§°                æè¿°\nA   Atomicity (åå­æ§)   ä¸ä¸ªäºå¡ä¸­çæææä½ï¼è¦ä¹å¨é¨å®æï¼è¦ä¹å¨é¨ä¸å®æï¼ä¸ä¼å¨ä¸­é´æä¸ªç¯èç»æã\n                      äºå¡å¨æ§è¡è¿ç¨ä¸­åçéè¯¯ï¼ä¼è¢«åæ»å°äºå¡å¼å§åçç¶æï¼å°±åè¿ä¸ªäºå¡ä»æ¥æ²¡ææ§è¡è¿ä¸æ ·ã\nC   Consistency ä¸è´æ§   å¨äºå¡å¼å§ä¹ååäºå¡ç»æä»¥åï¼æ°æ®çæ°æ®çä¸è´æ§çº¦ææ²¡æè¢«ç ´åã\nI   Isolation éç¦»æ§     æ°æ®åºåè®¸å¤ä¸ªå¹¶åäºå¡åæ¶å¯¹æ°æ®è¿è¡è¯»ååä¿®æ¹çè½åãéç¦»æ§å¯ä»¥é²æ­¢å¤ä¸ªäºå¡å¹¶åæ§è¡æ¶ç±äºäº¤åæ§è¡èå¯¼è´æ°æ®çä¸ä¸è´ã\nD   Durability æä¹æ§    äºå¡å¤çç»æåï¼å¯¹æ°æ®çä¿®æ¹å°±æ¯æ°¸ä¹çï¼å³ä¾¿ç³»ç»æéä¹ä¸ä¼ä¸¢å¤±ã\n\nä¸é¢ä»ç» 5 å¤§ç±» NoSQL æ°æ®éå¯¹ä¼ ç»å³ç³»åæ°æ®åºçç¼ºç¹æä¾çè§£å³æ¹æ¡ï¼\n\n\n# äºãåå¼æ°æ®åº\n\nåå¼æ°æ®åºæ¯ä»¥åç¸å³å­å¨æ¶æè¿è¡æ°æ®å­å¨çæ°æ®åºï¼ä¸»è¦éåäºæ¹éæ°æ®å¤çåå³æ¶æ¥è¯¢ã\n\nç¸å¯¹åºçæ¯è¡å¼æ°æ®åºï¼æ°æ®ä»¥è¡ç¸å³çå­å¨ä½ç³»æ¶æè¿è¡ç©ºé´åéï¼ä¸»è¦éåäºå°æ¹éçæ°æ®å¤çï¼å¸¸ç¨äºèæºäºå¡åæ°æ®å¤çã\n\nåºäºåå¼æ°æ®åºçååå­å¨ç¹æ§ï¼å¯ä»¥è§£å³æäºç¹å®åºæ¯ä¸å³ç³»åæ°æ®åº I/O è¾é«çé®é¢ã\n\n\n# åå¼æ°æ®åºåç\n\nä¼ ç»å³ç³»åæ°æ®åºæ¯æç§è¡æ¥å­å¨æ°æ®åºï¼ç§°ä¸ºâè¡å¼æ°æ®åºâï¼èåå¼æ°æ®åºæ¯æç§åæ¥å­å¨æ°æ®ã\n\nå°è¡¨æ¾å¥å­å¨ç³»ç»ä¸­æä¸¤ç§æ¹æ³ï¼èæä»¬ç»å¤§é¨åæ¯éç¨è¡å­å¨çã è¡å­å¨æ³æ¯å°åè¡æ¾å¥è¿ç»­çç©çä½ç½®ï¼è¿å¾åä¼ ç»çè®°å½åæä»¶ç³»ç»ã åå­å¨æ³æ¯å°æ°æ®æç§åå­å¨å°æ°æ®åºä¸­ï¼ä¸è¡å­å¨ç±»ä¼¼ï¼ä¸å¾æ¯ä¸¤ç§å­å¨æ¹æ³çå¾å½¢åè§£éï¼\n\n\n\n\n# åå¼æ°æ®åºäº§å\n\n * HBase\n   \n   \n   \n   HBase æ¯ä¸ä¸ªå¼æºçéå³ç³»ååå¸å¼æ°æ®åºï¼NoSQLï¼ï¼å®åèäºè°·æ­ç BigTable å»ºæ¨¡ï¼å®ç°çç¼ç¨è¯­è¨ä¸º Javaãå®æ¯ Apache è½¯ä»¶åºéä¼ç Hadoop é¡¹ç®çä¸é¨åï¼è¿è¡äº HDFS æä»¶ç³»ç»ä¹ä¸ï¼ä¸º Hadoop æä¾ç±»ä¼¼äº BigTable è§æ¨¡çæå¡ãå æ­¤ï¼å®å¯ä»¥å®¹éå°å­å¨æµ·éç¨ççæ°æ®ã\n\n * BigTable\n   \n   \n   \n   BigTable æ¯ä¸ç§åç¼©çãé«æ§è½çãé«å¯æ©å±æ§çï¼åºäº Google æä»¶ç³»ç»ï¼Google File Systemï¼GFSï¼çæ°æ®å­å¨ç³»ç»ï¼ç¨äºå­å¨å¤§è§æ¨¡ç»æåæ°æ®ï¼éç¨äºäºç«¯è®¡ç®ã\n\n\n# åå¼æ°æ®åºç¹æ§\n\nä¼ç¹å¦ä¸ï¼\n\n * é«æçå¨å­ç©ºé´å©ç¨ç\n\nåå¼æ°æ®åºç±äºå¶éå¯¹ä¸ååçæ°æ®ç¹å¾èåæçä¸åç®æ³ï¼ä½¿å¶å¾å¾ææ¯è¡å¼æ°æ®åºé«çå¤çåç¼©çï¼æ®éçè¡å¼æ°æ®åºä¸è¬åç¼©çå¨ 3ï¼1 å° 5ï¼1 å·¦å³ï¼èåå¼æ°æ®åºçåç¼©çä¸è¬å¨ 8ï¼1 å° 30ï¼1 å·¦å³ã æ¯è¾å¸¸è§çï¼éè¿å­å¸è¡¨åç¼©æ°æ®ï¼ ä¸é¢ä¸­ææ¯é£å¼ è¡¨æ¬æ¥çæ ·å­ãç»è¿å­å¸è¡¨è¿è¡æ°æ®åç¼©åï¼è¡¨ä¸­çå­ç¬¦ä¸²æé½åææ°å­äºãæ­£å ä¸ºæ¯ä¸ªå­ç¬¦ä¸²å¨å­å¸è¡¨éåªåºç°ä¸æ¬¡äºï¼æä»¥è¾¾å°äºåç¼©çç®ç(æç¹åè§èååéè§èå Normalize å Denomalize)\n\n\n\n * æ¥è¯¢æçé«\n\nè¯»åå¤æ¡æ°æ®çåä¸åæçé«ï¼å ä¸ºè¿äºåé½æ¯å­å¨å¨ä¸èµ·çï¼ä¸æ¬¡ç£çæä½å¯ä»¥æ°æ®çæå®åå¨é¨è¯»åå°åå­ä¸­ã ä¸å¾éè¿ä¸æ¡æ¥è¯¢çæ§è¡è¿ç¨è¯´æåå¼å­å¨(ä»¥åæ°æ®åç¼©)çä¼ç¹\n\n\n\næ§è¡æ­¥éª¤å¦ä¸ï¼\ni. å»å­å¸è¡¨éæ¾å°å­ç¬¦ä¸²å¯¹åºæ°å­(åªè¿è¡ä¸æ¬¡å­ç¬¦ä¸²æ¯è¾)ã\nii. ç¨æ°å­å»åè¡¨éå¹éï¼å¹éä¸çä½ç½®è®¾ä¸º1ã\niii. æä¸ååçå¹éç»æè¿è¡ä½è¿ç®å¾å°ç¬¦åæææ¡ä»¶çè®°å½ä¸æ ã\niv. ä½¿ç¨è¿ä¸ªä¸æ ç»è£åºæç»çç»æéã\nå¤å¶ä»£ç \n\n\n * éååèåæä½\n * éåå¤§éçæ°æ®èä¸æ¯å°æ°æ®\n\nç¼ºç¹å¦ä¸ï¼\n\n * ä¸éåæ«æå°éæ°æ®\n * ä¸éåéæºçæ´æ°\n * ä¸éååå«æå é¤åæ´æ°çå®æ¶æä½\n * åè¡çæ°æ®æ¯ ACID çï¼å¤è¡çäºå¡æ¶ï¼ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ I(Isolation)éç¦»æ§(äºå¡ä¸²è¡æäº¤)ï¼D(Durability)æä¹æ§ï¼ä¸è½ä¿è¯ A(Atomicity)åå­æ§ï¼ C(Consistency)ä¸è´æ§\n\n\n# åå¼æ°æ®åºä½¿ç¨åºæ¯\n\nä»¥ HBase ä¸ºä¾è¯´æï¼\n\n * å¤§æ°æ®é ï¼100s TB çº§æ°æ®ï¼ ä¸æå¿«ééæºè®¿é®çéæ±ãå¢é¿éæ æ³é¢ä¼°çåºç¨ï¼éè¦è¿è¡ä¼éçæ°æ®æ©å±ç HBase æ¯æå¨çº¿æ©å±ï¼å³ä½¿å¨ä¸æ®µæ¶é´åæ°æ®éåäºå·å¼å¢é¿ï¼ä¹å¯ä»¥éè¿ HBase æ¨ªåæ©å±æ¥æ»¡è¶³åè½ã\n * åå¯éååºç¨ï¼æ¯å¤©åå¥éå·¨å¤§ï¼èç¸å¯¹è¯»æ°éè¾å°çåºç¨ æ¯å¦ IM çåå²æ¶æ¯ï¼æ¸¸æçæ¥å¿ç­ç­\n * ä¸éè¦å¤ææ¥è¯¢æ¡ä»¶æ¥æ¥è¯¢æ°æ®çåºç¨ HBase åªæ¯æåºäº rowkey çæ¥è¯¢ï¼å¯¹äº HBase æ¥è¯´ï¼åæ¡è®°å½æèå°èå´çæ¥è¯¢æ¯å¯ä»¥æ¥åçï¼å¤§èå´çæ¥è¯¢ç±äºåå¸å¼çåå ï¼å¯è½å¨æ§è½ä¸æç¹å½±åï¼HBase ä¸éç¨äºæ joinï¼å¤çº§ç´¢å¼ï¼è¡¨å³ç³»å¤æçæ°æ®æ¨¡åã\n * å¯¹æ§è½åå¯é æ§è¦æ±éå¸¸é«çåºç¨ï¼ç±äº HBase æ¬èº«æ²¡æåç¹æéï¼å¯ç¨æ§éå¸¸é«ã\n * å­å¨ç»æåååç»æåçæ°æ®ã\n\n\n# ä¸ãK-V æ°æ®åº\n\nK-V æ°æ®åºæçæ¯ä½¿ç¨é®å¼(key-value)å­å¨çæ°æ®åºï¼å¶æ°æ®æç§é®å¼å¯¹çå½¢å¼è¿è¡ç»ç»ãç´¢å¼åå­å¨ã\n\nKV å­å¨éå¸¸éåå­å¨ä¸æ¶åè¿å¤æ°æ®å³ç³»ä¸å¡å³ç³»çæ°æ®ï¼åæ¶è½ææåå°è¯»åç£ççæ¬¡æ°ï¼æ¯ SQL æ°æ®åºå­å¨æ¥ææ´å¥½çè¯»åæ§è½ï¼è½å¤è§£å³å³ç³»åæ°æ®åºæ æ³å­å¨æ°æ®ç»æçé®é¢ã\n\n\n# K-V æ°æ®åºäº§å\n\n * Redis\n   \n   \n   \n   Redis æ¯ä¸ä¸ªä½¿ç¨ ANSI C ç¼åçå¼æºãæ¯æç½ç»ãåºäºåå­ãå¯éæä¹æ§çé®å¼å¯¹å­å¨æ°æ®åºãä» 2015 å¹´ 6 æå¼å§ï¼Redis çå¼åç± Redis Labs èµå©ï¼è 2013 å¹´ 5 æè³ 2015 å¹´ 6 ææé´ï¼å¶å¼åç± Pivotal èµå©ãå¨ 2013 å¹´ 5 æä¹åï¼å¶å¼åç± VMware èµå©ãæ ¹æ®æåº¦æè¡ç½ç« DB-Engines.com çæ°æ®æ¾ç¤ºï¼Redis æ¯ææµè¡çé®å¼å¯¹å­å¨æ°æ®åºã\n\n * Cassandra\n   \n   \n   \n   Apache Cassandraï¼ç¤¾åºåä¸è¬ç®ç§°ä¸º C*ï¼æ¯ä¸å¥å¼æºåå¸å¼ NoSQL æ°æ®åºç³»ç»ãå®æåç± Facebook å¼åï¼ç¨äºå¨å­æ¶ä»¶ç®±ç­ç®åæ ¼å¼æ°æ®ï¼é Google BigTable çæ°æ®æ¨¡åä¸ Amazon Dynamo çå®å¨åå¸å¼æ¶æäºä¸èº«ãFacebook äº 2008 å° Cassandra å¼æºï¼æ­¤åï¼ç±äº Cassandra è¯å¥½çå¯æ©å±æ§åæ§è½ï¼è¢« Apple, Comcast,Instagram, Spotify, eBay, Rackspace, Netflix ç­ç¥åç½ç«æéç¨ï¼æä¸ºäºä¸ç§æµè¡çåå¸å¼ç»æåæ°æ®å­å¨æ¹æ¡ã\n\n * LevelDB\n   \n   \n   \n   LevelDB æ¯ä¸ä¸ªç± Google å¬å¸æç åçé®ï¼å¼å¯¹ï¼Key/Value Pairï¼åµå¥å¼æ°æ®åºç®¡çç³»ç»ç¼ç¨åºï¼ ä»¥å¼æºç BSD è®¸å¯è¯åå¸ã\n\n\n# K-V æ°æ®åºç¹æ§\n\nä»¥ Redis ä¸ºä¾ï¼\n\nä¼ç¹å¦ä¸ï¼\n\n * æ§è½æé« - Redis è½æ¯æè¶è¿ 10W ç TPSã\n * ä¸°å¯çæ°æ®ç±»å - Redis æ¯æåæ¬ Stringï¼Hashï¼Listï¼Setï¼Sorted Setï¼Bitmap å hyperloglogã\n * ä¸°å¯çç¹æ§ - Redis è¿æ¯æ publish/subscribeãéç¥ãkey è¿æç­ç­ç¹æ§ã\n\nç¼ºç¹å¦ä¸ï¼ éå¯¹ ACIDï¼Redis äºå¡ä¸è½æ¯æåå­æ§åæä¹æ§(A å D)ï¼åªæ¯æéç¦»æ§åä¸è´æ§(I å C) ç¹å«è¯´æä¸ä¸ï¼è¿éæè¯´çæ æ³ä¿è¯åå­æ§ï¼æ¯éå¯¹ Redis çäºå¡æä½ï¼å ä¸ºäºå¡æ¯ä¸æ¯æåæ»ï¼roll backï¼ï¼èå ä¸º Redis çåçº¿ç¨æ¨¡åï¼Redis çæ®éæä½æ¯åå­æ§çã\n\nå¤§é¨åä¸å¡ä¸éè¦ä¸¥æ ¼éµå¾ª ACID ååï¼ä¾å¦æ¸¸æå®æ¶æè¡æ¦ï¼ç²ä¸å³æ³¨ç­åºæ¯ï¼å³ä½¿é¨åæ°æ®æä¹åå¤±è´¥ï¼å¶å®ä¸å¡å½±åä¹éå¸¸å°ãå æ­¤å¨è®¾è®¡æ¹æ¡æ¶ï¼éè¦æ ¹æ®ä¸å¡ç¹å¾åè¦æ±æ¥åéæ©\n\n\n# K-V æ°æ®åºä½¿ç¨åºæ¯\n\n * éç¨åºæ¯ - å¨å­ç¨æ·ä¿¡æ¯(æ¯å¦ä¼è¯)ãéç½®æä»¶ãåæ°ãè´­ç©è½¦ç­ç­ãè¿äºä¿¡æ¯ä¸è¬é½å IDï¼é®ï¼æé©ã\n\n * ä¸éç¨åºæ¯\n   \n   * éè¦éè¿å¼æ¥æ¥è¯¢ï¼èä¸æ¯é®æ¥æ¥è¯¢ãKey-Value æ°æ®åºä¸­æ ¹æ¬æ²¡æéè¿å¼æ¥è¯¢çéå¾ã\n   * éè¦å¨å­æ°æ®ä¹é´çå³ç³»ãå¨ Key-Value æ°æ®åºä¸­ä¸è½éè¿ä¸¤ä¸ªæä»¥ä¸çé®æ¥å³èæ°æ®\n   * éè¦äºå¡çæ¯æãå¨ Key-Value æ°æ®åºä¸­æéäº§çæ¶ä¸å¯ä»¥è¿è¡åæ»ã\n\n\n# åãææ¡£æ°æ®åº\n\nææ¡£æ°æ®åºï¼ä¹ç§°ä¸ºææ¡£åæ°æ®åºï¼æ¯æ¨å¨å°åç»æåæ°æ®å­å¨ä¸ºææ¡£çä¸ç§æ°æ®åºï¼å®å¯ä»¥è§£å³å³ç³»åæ°æ®åºè¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿çé®é¢ãææ¡£æ°æ®åºéå¸¸ä»¥ JSON æ XML æ ¼å¼å­å¨æ°æ®ã\n\nç±äºææ¡£æ°æ®åºç no-schema ç¹æ§ï¼å¯ä»¥å­å¨åè¯»åä»»ææ°æ®ãç±äºä½¿ç¨çæ°æ®æ ¼å¼æ¯ JSON æè XMLï¼æ éå¨ä½¿ç¨åå®ä¹å­æ®µï¼è¯»åä¸ä¸ª JSON ä¸­ä¸å­å¨çå­æ®µä¹ä¸ä¼å¯¼è´ SQL é£æ ·çè¯­æ³éè¯¯ã\n\n\n# ææ¡£æ°æ®åºäº§å\n\n * MongoDB\n   \n   \n   \n   MongoDBæ¯ä¸ç§é¢åææ¡£çæ°æ®åºç®¡çç³»ç»ï¼ç± C++ æ°åèæï¼ä»¥æ­¤æ¥è§£å³åºç¨ç¨åºå¼åç¤¾åºä¸­çå¤§éç°å®é®é¢ã2007 å¹´ 10 æï¼MongoDB ç± 10gen å¢éæåå±ã2009 å¹´ 2 æé¦åº¦æ¨åºã\n\n * CouchDB\n   \n   \n   \n   Apache CouchDB æ¯ä¸ä¸ªå¼æºæ°æ®åºï¼ä¸æ³¨äºæç¨æ§åæä¸º"å®å¨æ¥æ± web çæ°æ®åº"ãå®æ¯ä¸ä¸ªä½¿ç¨ JSON ä½ä¸ºå­å¨æ ¼å¼ï¼JavaScript ä½ä¸ºæ¥è¯¢è¯­è¨ï¼MapReduce å HTTP ä½ä¸º API ç NoSQL æ°æ®åºãå¶ä¸­ä¸ä¸ªæ¾èçåè½å°±æ¯å¤ä¸»å¤å¶ãCouchDB çç¬¬ä¸ä¸ªçæ¬åå¸å¨ 2005 å¹´ï¼å¨ 2008 å¹´æä¸ºäº Apache çé¡¹ç®ã\n\n\n# ææ¡£æ°æ®åºç¹æ§\n\nä»¥ MongoDB ä¸ºä¾è¿è¡è¯´æ\n\nä¼ç¹å¦ä¸ï¼\n\n * å®¹æå­å¨å¤ææ°æ®ç»æ - JSON æ¯ä¸ç§å¼ºå¤§çæè¿°è¯­è¨ï¼è½å¤æè¿°å¤æçæ°æ®ç»æã\n * å®¹æåæ´æ°æ®ç»æ - æ éåå³ç³»åæ°æ®åºä¸æ ·åæ§è¡ DDL è¯­å¥ä¿®æ¹è¡¨ç»æï¼ç¨åºä»£ç ç´æ¥è¯»åå³å¯ã\n * å®¹æå¼å®¹åå²æ°æ® - å¯¹äºåå²æ°æ®ï¼å³ä½¿æ²¡ææ°å¢çå­æ®µï¼ä¹ä¸ä¼å¯¼è´éè¯¯ï¼åªä¼è¿åç©ºå¼ï¼æ­¤æ¶ä»£ç å¼å®¹å¤çå³å¯ã\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡\n   * Atomicity(åå­æ§) ä»æ¯æåè¡/ææ¡£çº§åå­æ§ï¼ä¸æ¯æå¤è¡ãå¤ææ¡£ãå¤è¯­å¥åå­æ§ã\n   * Isolation(éç¦»æ§) éç¦»çº§å«ä»æ¯æå·²æäº¤è¯»ï¼Read committedï¼çº§å«ï¼å¯è½å¯¼è´ä¸å¯éå¤è¯»ï¼å¹»è¯»çé®é¢ã\n * ä¸æ¯æå¤ææ¥è¯¢ - ä¾å¦ join æ¥è¯¢ï¼å¦æéè¦ join æ¥è¯¢ï¼éè¦å¤æ¬¡æä½æ°æ®åºã\n\nMongonDB è¿æ¯æ¯æå¤ææ¡£äºå¡ç Consistency(ä¸è´æ§)å Durability(æä¹æ§)\n\nè½ç¶å®æ¹å®£å¸ MongoDB å°å¨ 4.0 çæ¬ä¸­æ­£å¼æ¨åºå¤ææ¡£ ACID äºå¡æ¯æï¼æåè½å°æåµè¿æå¾è§è¯ã\n\n\n# ææ¡£æ°æ®åºä½¿ç¨åºæ¯\n\néç¨åºæ¯ï¼\n\n * å¤§æ°æ®éï¼ä¸æªæ¥æ°æ®å¢é¿å¾å¿«\n * è¡¨ç»æä¸æç¡®ï¼ä¸å­æ®µå¨ä¸æ­å¢å ï¼ä¾å¦åå®¹ç®¡çç³»ç»ï¼ä¿¡æ¯ç®¡çç³»ç»\n\nä¸éç¨åºæ¯ï¼\n\n * æ¯æäºå¡ - å¨ä¸åçææ¡£ä¸éè¦æ·»å äºå¡ãDocument-Oriented æ°æ®åºå¹¶ä¸æ¯æææ¡£é´çäºå¡\n * æ¯æå¤ææ¥è¯¢ - å¤ä¸ªææ¡£ç´æ¥éè¦å¤ææ¥è¯¢ï¼ä¾å¦ join\n\n\n# äºãå¨ææç´¢å¼æ\n\nä¼ ç»å³ç³»åæ°æ®åºä¸»è¦éè¿ç´¢å¼æ¥è¾¾å°å¿«éæ¥è¯¢çç®çï¼å¨å¨ææç´¢çä¸å¡ä¸ï¼ç´¢å¼ä¹æ è½ä¸ºåï¼ä¸»è¦ä½ç°å¨ï¼\n\n * å¨ææç´¢çæ¡ä»¶å¯ä»¥éææåç»åï¼å¦æéè¿ç´¢å¼æ¥æ»¡è¶³ï¼åç´¢å¼çæ°ééå¸¸å¤\n * å¨ææç´¢çæ¨¡ç³å¹éæ¹å¼ï¼ç´¢å¼æ æ³æ»¡è¶³ï¼åªè½ç¨ LIKE æ¥è¯¢ï¼è LIKE æ¥è¯¢æ¯æ´è¡¨æ«æï¼æçéå¸¸ä½\n\nèå¨ææç´¢å¼æçåºç°ï¼æ­£æ¯è§£å³å³ç³»åæ°æ®åºå¨ææç´¢åè½è¾å¼±çé®é¢ã\n\n\n# æç´¢å¼æåç\n\nå¨ææç´¢å¼æçææ¯åçç§°ä¸º åæç´¢å¼ï¼inverted indexï¼ï¼æ¯ä¸ç§ç´¢å¼æ¹æ³ï¼å¶åºæ¬åçæ¯å»ºç«åè¯å°ææ¡£çç´¢å¼ãä¸ä¹ç¸å¯¹æ¯ï¼æ¯âæ­£æç´¢å¼âï¼å¶åºæ¬åçæ¯å»ºç«ææ¡£å°åè¯çç´¢å¼ã\n\nç°å¨æå¦ä¸ææ¡£éåï¼\n\n\n\næ­£æç´¢å¼å¾å°ç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼æ­£æç´¢å¼éç¨äºæ ¹æ®ææ¡£åç§°æ¥è¯¢ææ¡£åå®¹\n\nç®åçåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¸¦æåè¯é¢çä¿¡æ¯çåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼åæç´¢å¼éç¨äºæ ¹æ®å³é®è¯æ¥æ¥è¯¢ææ¡£åå®¹\n\n\n# æç´¢å¼æäº§å\n\n * Elasticsearch\n   \n   \n   \n   Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢å¼æãå®æä¾äºä¸ä¸ªåå¸å¼ï¼å¤ç§æ· -è½å¤å¨ææç´¢ä¸åå¨æº HTTP Web çé¢åæ æ¶æ JSON æä»¶ãElasticsearch æ¯ç¨ Java å¼åçï¼å¹¶æ ¹æ® Apache License çæ¡æ¬¾ä½ä¸ºå¼æºåå¸ãæ ¹æ® DB-Engines æåï¼Elasticsearch æ¯æåæ¬¢è¿çä¼ä¸æç´¢å¼æï¼åé¢æ¯åºäº Lucene ç Apache Solrã\n\n * Solr\n   \n   \n   \n   Solr æ¯ Apache Lucene é¡¹ç®çå¼æºä¼ä¸æç´¢å¹³å°ãå¶ä¸»è¦åè½åæ¬å¨ææ£ç´¢ãå½ä¸­æ ç¤ºãåé¢æç´¢ãå¨æèç±»ãæ°æ®åºéæï¼ä»¥åå¯ææ¬ï¼å¦ WordãPDFï¼çå¤çãSolr æ¯é«åº¦å¯æ©å±çï¼å¹¶æä¾äºåå¸å¼æç´¢åç´¢å¼å¤å¶\n\n\n# æç´¢å¼æç¹æ§\n\nä»¥ Elasticsearch ä¸ºä¾ï¼ ä¼ç¹å¦ä¸ï¼\n\n * æ¥è¯¢æçé« - å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç\n * å¯æ©å±æ§ - åºäºéç¾¤ç¯å¢å¯ä»¥æ¹ä¾¿æ¨ªåæ©å±ï¼å¯ä»¥æ¿è½½ PB çº§æ°æ®\n * é«å¯ç¨ - Elasticsearch éç¾¤å¼¹æ§-ä»ä»¬å°åç°æ°çæå¤±è´¥çèç¹ï¼éç»åéæ°å¹³è¡¡æ°æ®ï¼ç¡®ä¿æ°æ®æ¯å®å¨çåå¯è®¿é®ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡ - åä¸ææ¡£çæ°æ®æ¯ ACID çï¼åå«å¤ä¸ªææ¡£çäºå¡æ¶ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ I(Isolation)éç¦»æ§ï¼åºäºä¹è§éæºå¶çï¼ï¼D(Durability)æä¹æ§ï¼ä¸æ¯æ A(Atomicity)åå­æ§ï¼C(Consistency)ä¸è´æ§\n * å¯¹ç±»ä¼¼æ°æ®åºä¸­éè¿å¤é®çå¤æçå¤è¡¨å³èæä½æ¯æè¾å¼±ã\n * è¯»åæä¸å®å»¶æ¶ï¼åå¥çæ°æ®ï¼æå¿« 1s ä¸­è½è¢«æ£ç´¢å°\n * æ´æ°æ§è½è¾ä½ï¼åºå±å®ç°æ¯åå æ°æ®ï¼åæå¥æ°æ°æ®\n * åå­å ç¨å¤§ï¼å ä¸º Lucene å°ç´¢å¼é¨åå è½½å°åå­ä¸­\n\n\n# æç´¢å¼æåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * æç´¢å¼æåæ°æ®åæå¼æ - å¨ææ£ç´¢ï¼ç»æåæ£ç´¢ï¼æ°æ®åæ\n * å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç - å¯ä»¥å°æµ·éæ°æ®åæ£å°å¤å°æå¡å¨ä¸å»å­å¨åæ£ç´¢\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * æ°æ®éè¦é¢ç¹æ´æ°\n * éè¦å¤æå³èæ¥è¯¢\n\n\n# å­ãå¾æ°æ®åº\n\n\n\nå¾å½¢æ°æ®åºåºç¨å¾è®ºå­å¨å®ä½ä¹é´çå³ç³»ä¿¡æ¯ãæå¸¸è§ä¾å­å°±æ¯ç¤¾ä¼ç½ç»ä¸­äººä¸äººä¹é´çå³ç³»ãå³ç³»åæ°æ®åºç¨äºå­å¨âå³ç³»åâæ°æ®çææå¹¶ä¸å¥½ï¼å¶æ¥è¯¢å¤æãç¼æ¢ãè¶åºé¢æï¼èå¾å½¢æ°æ®åºçç¬ç¹è®¾è®¡æ°æ°å¼¥è¡¥äºè¿ä¸ªç¼ºé·ï¼è§£å³å³ç³»åæ°æ®åºå­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼±çé®é¢ã\n\n\n# å¾æ°æ®åºäº§å\n\n * Neo4j\n   \n   \n   \n   Neo4j æ¯ç± Neo4jï¼Incãå¼åçå¾å½¢æ°æ®åºç®¡çç³»ç»ãç±å¶å¼åäººåæè¿°ä¸ºå·æåçå¾å­å¨åå¤ççç¬¦å ACID çäºå¡æ°æ®åºï¼æ ¹æ® DB-Engines æåï¼ Neo4j æ¯ææµè¡çå¾å½¢æ°æ®åºã\n\n * ArangoDB\n   \n   \n   \n   ArangoDB æ¯ç± triAGENS GmbH å¼åçåçå¤æ¨¡åæ°æ®åºç³»ç»ãæ°æ®åºç³»ç»æ¯æä¸ä¸ªéè¦çæ°æ®æ¨¡åï¼é®/å¼ï¼ææ¡£ï¼å¾å½¢ï¼ï¼å¶ä¸­åå«ä¸ä¸ªæ°æ®åºæ ¸å¿åç»ä¸æ¥è¯¢è¯­è¨ AQLï¼ArangoDB æ¥è¯¢è¯­è¨ï¼ãæ¥è¯¢è¯­è¨æ¯å£°ææ§çï¼åè®¸å¨åä¸ªæ¥è¯¢ä¸­ç»åä¸åçæ°æ®è®¿é®æ¨¡å¼ãArangoDB æ¯ä¸ä¸ª NoSQL æ°æ®åºç³»ç»ï¼ä½ AQL å¨å¾å¤æ¹é¢ä¸ SQL ç±»ä¼¼ã\n\n * Titan\n   \n   \n   \n   Titan æ¯ä¸ä¸ªå¯æ©å±çå¾å½¢æ°æ®åºï¼éå¯¹å­å¨åæ¥è¯¢åå«åå¸å¨å¤æºç¾¤éä¸­çæ°ç¾äº¿ä¸ªé¡¶ç¹åè¾¹ç¼çå¾å½¢è¿è¡äºä¼åãTitan æ¯ä¸ä¸ªäºå¡æ§æ°æ®åºï¼å¯ä»¥æ¯ææ°åä¸ªå¹¶åç¨æ·å®æ¶æ§è¡å¤æçå¾å½¢éåã\n\n\n# å¾æ°æ®åºç¹æ§\n\nä»¥ Neo4j ä¸ºä¾ï¼\n\nNeo4j ä½¿ç¨æ°æ®ç»æä¸­å¾ï¼graphï¼çæ¦å¿µæ¥è¿è¡å»ºæ¨¡ã Neo4j ä¸­ä¸¤ä¸ªæåºæ¬çæ¦å¿µæ¯èç¹åè¾¹ãèç¹è¡¨ç¤ºå®ä½ï¼è¾¹åè¡¨ç¤ºå®ä½ä¹é´çå³ç³»ãèç¹åè¾¹é½å¯ä»¥æèªå·±çå±æ§ãä¸åå®ä½éè¿åç§ä¸åçå³ç³»å³èèµ·æ¥ï¼å½¢æå¤æçå¯¹è±¡å¾ã\n\néå¯¹å³ç³»æ°æ®ï¼2 ç§ 2 æ°æ®åºçå­å¨ç»æä¸åï¼\n\n\n\nNeo4j ä¸­ï¼å­å¨èç¹æ¶ä½¿ç¨äºâindex-free adjacencyâï¼å³æ¯ä¸ªèç¹é½ææåå¶é»å±èç¹çæéï¼å¯ä»¥è®©æä»¬å¨ O(1)çæ¶é´åæ¾å°é»å±èç¹ãå¦å¤ï¼æç§å®æ¹çè¯´æ³ï¼å¨ Neo4j ä¸­è¾¹æ¯æéè¦ç,æ¯âfirst-class entitiesâï¼æä»¥åç¬å­å¨ï¼è¿æå©äºå¨å¾éåçæ¶åæé«éåº¦ï¼ä¹å¯ä»¥å¾æ¹ä¾¿å°ä»¥ä»»ä½æ¹åè¿è¡éå\n\n\n\nå¦ä¸ä¼ç¹ï¼\n\n * é«æ§è½ - å¾çéåæ¯å¾æ°æ®ç»ææå·æçç¬ç¹ç®æ³ï¼å³ä»ä¸ä¸ªèç¹å¼å§ï¼æ ¹æ®å¶è¿æ¥çå³ç³»ï¼å¯ä»¥å¿«éåæ¹ä¾¿å°æ¾åºå®çé»è¿èç¹ãè¿ç§æ¥æ¾æ°æ®çæ¹æ³å¹¶ä¸åæ°æ®éçå¤§å°æå½±åï¼å ä¸ºé»è¿æ¥è¯¢å§ç»æ¥æ¾çæ¯æéçå±é¨æ°æ®ï¼ä¸ä¼å¯¹æ´ä¸ªæ°æ®åºè¿è¡æç´¢\n * è®¾è®¡ççµæ´»æ§ - æ°æ®ç»æçèªç¶ä¼¸å±ç¹æ§åå¶éç»æåçæ°æ®æ ¼å¼ï¼è®©å¾æ°æ®åºè®¾è®¡å¯ä»¥å·æå¾å¤§çä¼¸ç¼©æ§åçµæ´»æ§ãå ä¸ºéçéæ±çååèå¢å çèç¹ãå³ç³»åå¶å±æ§å¹¶ä¸ä¼å½±åå°åæ¥æ°æ®çæ­£å¸¸ä½¿ç¨\n * å¼åçææ·æ§ - ç´è§æäºçæ°æ®æ¨¡åï¼ä»éæ±çè®¨è®ºå¼å§ï¼å°ç¨åºå¼ååå®ç°ï¼ä»¥åæç»ä¿å­å¨æ°æ®åºä¸­çæ ·å­ï¼å®çæ¨¡æ ·ä¼¼ä¹æ²¡æä»ä¹ååï¼çè³å¯ä»¥è¯´æ¬æ¥å°±æ¯ä¸æ¨¡ä¸æ ·ç\n * å®å¨æ¯æ ACID - ä¸åå«ç NoSQL æ°æ®åº Neo4j è¿å·æå®å¨äºå¡ç®¡çç¹æ§ï¼å®å¨æ¯æ ACID äºå¡ç®¡ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * å­å¨æ¯æèç¹ï¼å³ç³»åå±æ§çæ°éçéå¶ã\n * ä¸æ¯ææåã\n\n\n# å¾æ°æ®åºåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * å³ç³»æ§å¼ºçæ°æ®ä¸­ï¼å¦ç¤¾äº¤ç½ç»\n * æ¨èå¼æãå¦ææä»¬å°æ°æ®ä»¥å¾çå½¢å¼è¡¨ç°ï¼é£ä¹å°ä¼éå¸¸æçäºæ¨èçå¶å®\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * è®°å½å¤§éåºäºäºä»¶çæ°æ®ï¼ä¾å¦æ¥å¿æ¡ç®æä¼ æå¨æ°æ®ï¼\n * å¯¹å¤§è§æ¨¡åå¸å¼æ°æ®è¿è¡å¤ç\n * ä¿å­å¨å³ç³»åæ°æ®åºä¸­çç»æåæ°æ®\n * äºè¿å¶æ°æ®å­å¨\n\n\n# ä¸ãæ»ç»\n\nå³ç³»åæ°æ®åºå NoSQL æ°æ®åºçéåï¼å¾å¾éè¦èèå ä¸ªææ ï¼\n\n * æ°æ®é\n * å¹¶åé\n * å®æ¶æ§\n * ä¸è´æ§è¦æ±\n * è¯»ååå¸åç±»å\n * å®å¨æ§\n * è¿ç»´ææ¬\n\nå¸¸è§è½¯ä»¶ç³»ç»æ°æ®åºéååèå¦ä¸ï¼\n\n * ä¸­åå°ç®¡çåç³»ç» - å¦è¿è¥ç³»ç»ï¼æ°æ®éå°ï¼å¹¶åéå°ï¼é¦éå³ç³»åæ°æ®åºã\n * å¤§æµéç³»ç» - å¦çµåååé¡µï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéåå­åæ°æ®åºã\n * æ¥å¿åç³»ç» - åå§æ°æ®èèéåå¼æ°æ®åºï¼æ¥å¿æç´¢èèéæç´¢å¼æã\n * æç´¢åç³»ç» - ä¾å¦ç«åæç´¢ï¼ééç¨æç´¢ï¼å¦ååæç´¢ï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéæç´¢å¼æã\n * äºå¡åç³»ç» - å¦åºå­ï¼äº¤æï¼è®°è´¦ï¼èèéå³ç³»åæ°æ®åº+K-V æ°æ®åºï¼ä½ä¸ºç¼å­ï¼+åå¸å¼äºå¡ã\n * ç¦»çº¿è®¡ç® - å¦å¤§éæ°æ®åæï¼èèéåå¼æ°æ®åºæå³ç³»åæ°æ®ã\n * å®æ¶è®¡ç® - å¦å®æ¶çæ§ï¼å¯ä»¥èèéåå­åæ°æ®åºæèåå¼æ°æ®åºã\n\nè®¾è®¡å®è·µä¸­ï¼è¦åºäºéæ±ãä¸å¡é©±å¨æ¶æï¼æ è®ºéç¨ RDB/NoSQL/DRDB,ä¸å®æ¯ä»¥éæ±ä¸ºå¯¼åï¼æç»æ°æ®å­å¨æ¹æ¡å¿ç¶æ¯åç§æè¡¡çç»¼åæ§è®¾è®¡\n\n\n# åèèµæ\n\n * NoSQL è¿æ¯ SQL ï¼è¿ä¸ç¯è®²æ¸æ¥',normalizedContent:'# nosql ææ¯éå\n\n\n\n\n# ä¸ãnosql ç®ä»\n\nä¼ ç»çå³ç³»åæ°æ®åºå­å¨ä»¥ä¸ç¼ºç¹ï¼\n\n * å¤§æ°æ®åºæ¯ä¸ i/o è¾é« - å ä¸ºæ°æ®æ¯æè¡å­å¨ï¼å³ä½¿åªéå¯¹å¶ä¸­æä¸åè¿è¡è¿ç®ï¼å³ç³»åæ°æ®åºä¹ä¼å°æ´è¡æ°æ®ä»å­å¨è®¾å¤ä¸­è¯»å¥åå­ï¼å¯¼è´ i/o è¾é«ã\n * å­å¨çæ¯è¡è®°å½ï¼æ æ³å­å¨æ°æ®ç»æã\n * è¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿ - å¦è¦éè¦ä¿®æ¹è¡¨ç»æï¼éè¦æ§è¡æ§è¡ ddl(data definition language)ï¼è¯­å¥ä¿®æ¹ï¼ä¿®æ¹æé´ä¼å¯¼è´éè¡¨ï¼é¨åæå¡ä¸å¯ç¨ã\n * å¨ææç´¢åè½è¾å¼± - å³ç³»åæ°æ®åºä¸åªè½å¤è¿è¡å­å­ç¬¦ä¸²çå¹éæ¥è¯¢ï¼å½è¡¨çæ°æ®éæ¸åå¤§çæ¶åï¼like æ¥è¯¢çå¹éä¼éå¸¸æ¢ï¼å³ä½¿å¨æç´¢å¼çæåµä¸ãåµä¸å³ç³»åæ°æ®åºä¹ä¸åºè¯¥å¯¹ææ¬å­æ®µè¿è¡ç´¢å¼ã\n * å­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼± - è®¸å¤åºç¨ç¨åºéè¦äºè§£åå¯¼èªé«åº¦è¿æ¥æ°æ®ä¹é´çå³ç³»ï¼æè½å¯ç¨ç¤¾äº¤åºç¨ç¨åºãæ¨èå¼æãæ¬ºè¯æ£æµãç¥è¯å¾è°±ãçå½ç§å­¦å it/ç½ç»ç­ç¨ä¾ãç¶èä¼ ç»çå³ç³»æ°æ®åºå¹¶ä¸åäºå¤çæ°æ®ç¹ä¹é´çå³ç³»ãå®ä»¬çè¡¨æ ¼æ°æ®æ¨¡ååä¸¥æ ¼çæ¨¡å¼ä½¿å®ä»¬å¾é¾æ·»å æ°çæä¸åç§ç±»çå³èä¿¡æ¯ã\n\néçå¤§æ°æ®æ¶ä»£çå°æ¥ï¼è¶æ¥è¶å¤çç½ç«ãåºç¨ç³»ç»éè¦æ¯ææµ·éæ°æ®å­å¨ï¼é«å¹¶åè¯·æ±ãé«å¯ç¨ãé«å¯æ©å±æ§ç­ç¹æ§è¦æ±ãä¼ ç»çå³ç³»åæ°æ®åºå¨åºä»è¿äºè°æ´å·²ç»æ¾å¾åä¸ä»å¿ï¼æ´é²äºè®¸å¤è½ä»¥åæçé®é¢ãç±æ­¤ï¼åç§åæ ·ç nosqlï¼not only sqlï¼æ°æ®åºä½ä¸ºä¼ ç»å³ç³»åæ°æ®çä¸ä¸ªæåè¡¥åå¾å°è¿çåå±ã\n\n\n\nnosqlï¼æ³æéå³ç³»åçæ°æ®åºï¼å¯ä»¥çè§£ä¸º sql çä¸ä¸ªæåè¡¥åã\n\nå¨ nosql è®¸å¤æ¹é¢æ§è½å¤§å¤§ä¼äºéå³ç³»åæ°æ®åºçåæ¶ï¼å¾å¾ä¹ä¼´éä¸äºç¹æ§çç¼ºå¤±ï¼æ¯è¾å¸¸è§çï¼æ¯äºå¡åºäºå¡åè½çç¼ºå¤±ã æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼acid å¦ä¸ï¼\n\n    åç§°                æè¿°\na   atomicity (åå­æ§)   ä¸ä¸ªäºå¡ä¸­çæææä½ï¼è¦ä¹å¨é¨å®æï¼è¦ä¹å¨é¨ä¸å®æï¼ä¸ä¼å¨ä¸­é´æä¸ªç¯èç»æã\n                      äºå¡å¨æ§è¡è¿ç¨ä¸­åçéè¯¯ï¼ä¼è¢«åæ»å°äºå¡å¼å§åçç¶æï¼å°±åè¿ä¸ªäºå¡ä»æ¥æ²¡ææ§è¡è¿ä¸æ ·ã\nc   consistency ä¸è´æ§   å¨äºå¡å¼å§ä¹ååäºå¡ç»æä»¥åï¼æ°æ®çæ°æ®çä¸è´æ§çº¦ææ²¡æè¢«ç ´åã\ni   isolation éç¦»æ§     æ°æ®åºåè®¸å¤ä¸ªå¹¶åäºå¡åæ¶å¯¹æ°æ®è¿è¡è¯»ååä¿®æ¹çè½åãéç¦»æ§å¯ä»¥é²æ­¢å¤ä¸ªäºå¡å¹¶åæ§è¡æ¶ç±äºäº¤åæ§è¡èå¯¼è´æ°æ®çä¸ä¸è´ã\nd   durability æä¹æ§    äºå¡å¤çç»æåï¼å¯¹æ°æ®çä¿®æ¹å°±æ¯æ°¸ä¹çï¼å³ä¾¿ç³»ç»æéä¹ä¸ä¼ä¸¢å¤±ã\n\nä¸é¢ä»ç» 5 å¤§ç±» nosql æ°æ®éå¯¹ä¼ ç»å³ç³»åæ°æ®åºçç¼ºç¹æä¾çè§£å³æ¹æ¡ï¼\n\n\n# äºãåå¼æ°æ®åº\n\nåå¼æ°æ®åºæ¯ä»¥åç¸å³å­å¨æ¶æè¿è¡æ°æ®å­å¨çæ°æ®åºï¼ä¸»è¦éåäºæ¹éæ°æ®å¤çåå³æ¶æ¥è¯¢ã\n\nç¸å¯¹åºçæ¯è¡å¼æ°æ®åºï¼æ°æ®ä»¥è¡ç¸å³çå­å¨ä½ç³»æ¶æè¿è¡ç©ºé´åéï¼ä¸»è¦éåäºå°æ¹éçæ°æ®å¤çï¼å¸¸ç¨äºèæºäºå¡åæ°æ®å¤çã\n\nåºäºåå¼æ°æ®åºçååå­å¨ç¹æ§ï¼å¯ä»¥è§£å³æäºç¹å®åºæ¯ä¸å³ç³»åæ°æ®åº i/o è¾é«çé®é¢ã\n\n\n# åå¼æ°æ®åºåç\n\nä¼ ç»å³ç³»åæ°æ®åºæ¯æç§è¡æ¥å­å¨æ°æ®åºï¼ç§°ä¸ºâè¡å¼æ°æ®åºâï¼èåå¼æ°æ®åºæ¯æç§åæ¥å­å¨æ°æ®ã\n\nå°è¡¨æ¾å¥å­å¨ç³»ç»ä¸­æä¸¤ç§æ¹æ³ï¼èæä»¬ç»å¤§é¨åæ¯éç¨è¡å­å¨çã è¡å­å¨æ³æ¯å°åè¡æ¾å¥è¿ç»­çç©çä½ç½®ï¼è¿å¾åä¼ ç»çè®°å½åæä»¶ç³»ç»ã åå­å¨æ³æ¯å°æ°æ®æç§åå­å¨å°æ°æ®åºä¸­ï¼ä¸è¡å­å¨ç±»ä¼¼ï¼ä¸å¾æ¯ä¸¤ç§å­å¨æ¹æ³çå¾å½¢åè§£éï¼\n\n\n\n\n# åå¼æ°æ®åºäº§å\n\n * hbase\n   \n   \n   \n   hbase æ¯ä¸ä¸ªå¼æºçéå³ç³»ååå¸å¼æ°æ®åºï¼nosqlï¼ï¼å®åèäºè°·æ­ç bigtable å»ºæ¨¡ï¼å®ç°çç¼ç¨è¯­è¨ä¸º javaãå®æ¯ apache è½¯ä»¶åºéä¼ç hadoop é¡¹ç®çä¸é¨åï¼è¿è¡äº hdfs æä»¶ç³»ç»ä¹ä¸ï¼ä¸º hadoop æä¾ç±»ä¼¼äº bigtable è§æ¨¡çæå¡ãå æ­¤ï¼å®å¯ä»¥å®¹éå°å­å¨æµ·éç¨ççæ°æ®ã\n\n * bigtable\n   \n   \n   \n   bigtable æ¯ä¸ç§åç¼©çãé«æ§è½çãé«å¯æ©å±æ§çï¼åºäº google æä»¶ç³»ç»ï¼google file systemï¼gfsï¼çæ°æ®å­å¨ç³»ç»ï¼ç¨äºå­å¨å¤§è§æ¨¡ç»æåæ°æ®ï¼éç¨äºäºç«¯è®¡ç®ã\n\n\n# åå¼æ°æ®åºç¹æ§\n\nä¼ç¹å¦ä¸ï¼\n\n * é«æçå¨å­ç©ºé´å©ç¨ç\n\nåå¼æ°æ®åºç±äºå¶éå¯¹ä¸ååçæ°æ®ç¹å¾èåæçä¸åç®æ³ï¼ä½¿å¶å¾å¾ææ¯è¡å¼æ°æ®åºé«çå¤çåç¼©çï¼æ®éçè¡å¼æ°æ®åºä¸è¬åç¼©çå¨ 3ï¼1 å° 5ï¼1 å·¦å³ï¼èåå¼æ°æ®åºçåç¼©çä¸è¬å¨ 8ï¼1 å° 30ï¼1 å·¦å³ã æ¯è¾å¸¸è§çï¼éè¿å­å¸è¡¨åç¼©æ°æ®ï¼ ä¸é¢ä¸­ææ¯é£å¼ è¡¨æ¬æ¥çæ ·å­ãç»è¿å­å¸è¡¨è¿è¡æ°æ®åç¼©åï¼è¡¨ä¸­çå­ç¬¦ä¸²æé½åææ°å­äºãæ­£å ä¸ºæ¯ä¸ªå­ç¬¦ä¸²å¨å­å¸è¡¨éåªåºç°ä¸æ¬¡äºï¼æä»¥è¾¾å°äºåç¼©çç®ç(æç¹åè§èååéè§èå normalize å denomalize)\n\n\n\n * æ¥è¯¢æçé«\n\nè¯»åå¤æ¡æ°æ®çåä¸åæçé«ï¼å ä¸ºè¿äºåé½æ¯å­å¨å¨ä¸èµ·çï¼ä¸æ¬¡ç£çæä½å¯ä»¥æ°æ®çæå®åå¨é¨è¯»åå°åå­ä¸­ã ä¸å¾éè¿ä¸æ¡æ¥è¯¢çæ§è¡è¿ç¨è¯´æåå¼å­å¨(ä»¥åæ°æ®åç¼©)çä¼ç¹\n\n\n\næ§è¡æ­¥éª¤å¦ä¸ï¼\ni. å»å­å¸è¡¨éæ¾å°å­ç¬¦ä¸²å¯¹åºæ°å­(åªè¿è¡ä¸æ¬¡å­ç¬¦ä¸²æ¯è¾)ã\nii. ç¨æ°å­å»åè¡¨éå¹éï¼å¹éä¸çä½ç½®è®¾ä¸º1ã\niii. æä¸ååçå¹éç»æè¿è¡ä½è¿ç®å¾å°ç¬¦åæææ¡ä»¶çè®°å½ä¸æ ã\niv. ä½¿ç¨è¿ä¸ªä¸æ ç»è£åºæç»çç»æéã\nå¤å¶ä»£ç \n\n\n * éååèåæä½\n * éåå¤§éçæ°æ®èä¸æ¯å°æ°æ®\n\nç¼ºç¹å¦ä¸ï¼\n\n * ä¸éåæ«æå°éæ°æ®\n * ä¸éåéæºçæ´æ°\n * ä¸éååå«æå é¤åæ´æ°çå®æ¶æä½\n * åè¡çæ°æ®æ¯ acid çï¼å¤è¡çäºå¡æ¶ï¼ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ i(isolation)éç¦»æ§(äºå¡ä¸²è¡æäº¤)ï¼d(durability)æä¹æ§ï¼ä¸è½ä¿è¯ a(atomicity)åå­æ§ï¼ c(consistency)ä¸è´æ§\n\n\n# åå¼æ°æ®åºä½¿ç¨åºæ¯\n\nä»¥ hbase ä¸ºä¾è¯´æï¼\n\n * å¤§æ°æ®é ï¼100s tb çº§æ°æ®ï¼ ä¸æå¿«ééæºè®¿é®çéæ±ãå¢é¿éæ æ³é¢ä¼°çåºç¨ï¼éè¦è¿è¡ä¼éçæ°æ®æ©å±ç hbase æ¯æå¨çº¿æ©å±ï¼å³ä½¿å¨ä¸æ®µæ¶é´åæ°æ®éåäºå·å¼å¢é¿ï¼ä¹å¯ä»¥éè¿ hbase æ¨ªåæ©å±æ¥æ»¡è¶³åè½ã\n * åå¯éååºç¨ï¼æ¯å¤©åå¥éå·¨å¤§ï¼èç¸å¯¹è¯»æ°éè¾å°çåºç¨ æ¯å¦ im çåå²æ¶æ¯ï¼æ¸¸æçæ¥å¿ç­ç­\n * ä¸éè¦å¤ææ¥è¯¢æ¡ä»¶æ¥æ¥è¯¢æ°æ®çåºç¨ hbase åªæ¯æåºäº rowkey çæ¥è¯¢ï¼å¯¹äº hbase æ¥è¯´ï¼åæ¡è®°å½æèå°èå´çæ¥è¯¢æ¯å¯ä»¥æ¥åçï¼å¤§èå´çæ¥è¯¢ç±äºåå¸å¼çåå ï¼å¯è½å¨æ§è½ä¸æç¹å½±åï¼hbase ä¸éç¨äºæ joinï¼å¤çº§ç´¢å¼ï¼è¡¨å³ç³»å¤æçæ°æ®æ¨¡åã\n * å¯¹æ§è½åå¯é æ§è¦æ±éå¸¸é«çåºç¨ï¼ç±äº hbase æ¬èº«æ²¡æåç¹æéï¼å¯ç¨æ§éå¸¸é«ã\n * å­å¨ç»æåååç»æåçæ°æ®ã\n\n\n# ä¸ãk-v æ°æ®åº\n\nk-v æ°æ®åºæçæ¯ä½¿ç¨é®å¼(key-value)å­å¨çæ°æ®åºï¼å¶æ°æ®æç§é®å¼å¯¹çå½¢å¼è¿è¡ç»ç»ãç´¢å¼åå­å¨ã\n\nkv å­å¨éå¸¸éåå­å¨ä¸æ¶åè¿å¤æ°æ®å³ç³»ä¸å¡å³ç³»çæ°æ®ï¼åæ¶è½ææåå°è¯»åç£ççæ¬¡æ°ï¼æ¯ sql æ°æ®åºå­å¨æ¥ææ´å¥½çè¯»åæ§è½ï¼è½å¤è§£å³å³ç³»åæ°æ®åºæ æ³å­å¨æ°æ®ç»æçé®é¢ã\n\n\n# k-v æ°æ®åºäº§å\n\n * redis\n   \n   \n   \n   redis æ¯ä¸ä¸ªä½¿ç¨ ansi c ç¼åçå¼æºãæ¯æç½ç»ãåºäºåå­ãå¯éæä¹æ§çé®å¼å¯¹å­å¨æ°æ®åºãä» 2015 å¹´ 6 æå¼å§ï¼redis çå¼åç± redis labs èµå©ï¼è 2013 å¹´ 5 æè³ 2015 å¹´ 6 ææé´ï¼å¶å¼åç± pivotal èµå©ãå¨ 2013 å¹´ 5 æä¹åï¼å¶å¼åç± vmware èµå©ãæ ¹æ®æåº¦æè¡ç½ç« db-engines.com çæ°æ®æ¾ç¤ºï¼redis æ¯ææµè¡çé®å¼å¯¹å­å¨æ°æ®åºã\n\n * cassandra\n   \n   \n   \n   apache cassandraï¼ç¤¾åºåä¸è¬ç®ç§°ä¸º c*ï¼æ¯ä¸å¥å¼æºåå¸å¼ nosql æ°æ®åºç³»ç»ãå®æåç± facebook å¼åï¼ç¨äºå¨å­æ¶ä»¶ç®±ç­ç®åæ ¼å¼æ°æ®ï¼é google bigtable çæ°æ®æ¨¡åä¸ amazon dynamo çå®å¨åå¸å¼æ¶æäºä¸èº«ãfacebook äº 2008 å° cassandra å¼æºï¼æ­¤åï¼ç±äº cassandra è¯å¥½çå¯æ©å±æ§åæ§è½ï¼è¢« apple, comcast,instagram, spotify, ebay, rackspace, netflix ç­ç¥åç½ç«æéç¨ï¼æä¸ºäºä¸ç§æµè¡çåå¸å¼ç»æåæ°æ®å­å¨æ¹æ¡ã\n\n * leveldb\n   \n   \n   \n   leveldb æ¯ä¸ä¸ªç± google å¬å¸æç åçé®ï¼å¼å¯¹ï¼key/value pairï¼åµå¥å¼æ°æ®åºç®¡çç³»ç»ç¼ç¨åºï¼ ä»¥å¼æºç bsd è®¸å¯è¯åå¸ã\n\n\n# k-v æ°æ®åºç¹æ§\n\nä»¥ redis ä¸ºä¾ï¼\n\nä¼ç¹å¦ä¸ï¼\n\n * æ§è½æé« - redis è½æ¯æè¶è¿ 10w ç tpsã\n * ä¸°å¯çæ°æ®ç±»å - redis æ¯æåæ¬ stringï¼hashï¼listï¼setï¼sorted setï¼bitmap å hyperloglogã\n * ä¸°å¯çç¹æ§ - redis è¿æ¯æ publish/subscribeãéç¥ãkey è¿æç­ç­ç¹æ§ã\n\nç¼ºç¹å¦ä¸ï¼ éå¯¹ acidï¼redis äºå¡ä¸è½æ¯æåå­æ§åæä¹æ§(a å d)ï¼åªæ¯æéç¦»æ§åä¸è´æ§(i å c) ç¹å«è¯´æä¸ä¸ï¼è¿éæè¯´çæ æ³ä¿è¯åå­æ§ï¼æ¯éå¯¹ redis çäºå¡æä½ï¼å ä¸ºäºå¡æ¯ä¸æ¯æåæ»ï¼roll backï¼ï¼èå ä¸º redis çåçº¿ç¨æ¨¡åï¼redis çæ®éæä½æ¯åå­æ§çã\n\nå¤§é¨åä¸å¡ä¸éè¦ä¸¥æ ¼éµå¾ª acid ååï¼ä¾å¦æ¸¸æå®æ¶æè¡æ¦ï¼ç²ä¸å³æ³¨ç­åºæ¯ï¼å³ä½¿é¨åæ°æ®æä¹åå¤±è´¥ï¼å¶å®ä¸å¡å½±åä¹éå¸¸å°ãå æ­¤å¨è®¾è®¡æ¹æ¡æ¶ï¼éè¦æ ¹æ®ä¸å¡ç¹å¾åè¦æ±æ¥åéæ©\n\n\n# k-v æ°æ®åºä½¿ç¨åºæ¯\n\n * éç¨åºæ¯ - å¨å­ç¨æ·ä¿¡æ¯(æ¯å¦ä¼è¯)ãéç½®æä»¶ãåæ°ãè´­ç©è½¦ç­ç­ãè¿äºä¿¡æ¯ä¸è¬é½å idï¼é®ï¼æé©ã\n\n * ä¸éç¨åºæ¯\n   \n   * éè¦éè¿å¼æ¥æ¥è¯¢ï¼èä¸æ¯é®æ¥æ¥è¯¢ãkey-value æ°æ®åºä¸­æ ¹æ¬æ²¡æéè¿å¼æ¥è¯¢çéå¾ã\n   * éè¦å¨å­æ°æ®ä¹é´çå³ç³»ãå¨ key-value æ°æ®åºä¸­ä¸è½éè¿ä¸¤ä¸ªæä»¥ä¸çé®æ¥å³èæ°æ®\n   * éè¦äºå¡çæ¯æãå¨ key-value æ°æ®åºä¸­æéäº§çæ¶ä¸å¯ä»¥è¿è¡åæ»ã\n\n\n# åãææ¡£æ°æ®åº\n\nææ¡£æ°æ®åºï¼ä¹ç§°ä¸ºææ¡£åæ°æ®åºï¼æ¯æ¨å¨å°åç»æåæ°æ®å­å¨ä¸ºææ¡£çä¸ç§æ°æ®åºï¼å®å¯ä»¥è§£å³å³ç³»åæ°æ®åºè¡¨ç»æ schema æ©å±ä¸æ¹ä¾¿çé®é¢ãææ¡£æ°æ®åºéå¸¸ä»¥ json æ xml æ ¼å¼å­å¨æ°æ®ã\n\nç±äºææ¡£æ°æ®åºç no-schema ç¹æ§ï¼å¯ä»¥å­å¨åè¯»åä»»ææ°æ®ãç±äºä½¿ç¨çæ°æ®æ ¼å¼æ¯ json æè xmlï¼æ éå¨ä½¿ç¨åå®ä¹å­æ®µï¼è¯»åä¸ä¸ª json ä¸­ä¸å­å¨çå­æ®µä¹ä¸ä¼å¯¼è´ sql é£æ ·çè¯­æ³éè¯¯ã\n\n\n# ææ¡£æ°æ®åºäº§å\n\n * mongodb\n   \n   \n   \n   mongodbæ¯ä¸ç§é¢åææ¡£çæ°æ®åºç®¡çç³»ç»ï¼ç± c++ æ°åèæï¼ä»¥æ­¤æ¥è§£å³åºç¨ç¨åºå¼åç¤¾åºä¸­çå¤§éç°å®é®é¢ã2007 å¹´ 10 æï¼mongodb ç± 10gen å¢éæåå±ã2009 å¹´ 2 æé¦åº¦æ¨åºã\n\n * couchdb\n   \n   \n   \n   apache couchdb æ¯ä¸ä¸ªå¼æºæ°æ®åºï¼ä¸æ³¨äºæç¨æ§åæä¸º"å®å¨æ¥æ± web çæ°æ®åº"ãå®æ¯ä¸ä¸ªä½¿ç¨ json ä½ä¸ºå­å¨æ ¼å¼ï¼javascript ä½ä¸ºæ¥è¯¢è¯­è¨ï¼mapreduce å http ä½ä¸º api ç nosql æ°æ®åºãå¶ä¸­ä¸ä¸ªæ¾èçåè½å°±æ¯å¤ä¸»å¤å¶ãcouchdb çç¬¬ä¸ä¸ªçæ¬åå¸å¨ 2005 å¹´ï¼å¨ 2008 å¹´æä¸ºäº apache çé¡¹ç®ã\n\n\n# ææ¡£æ°æ®åºç¹æ§\n\nä»¥ mongodb ä¸ºä¾è¿è¡è¯´æ\n\nä¼ç¹å¦ä¸ï¼\n\n * å®¹æå­å¨å¤ææ°æ®ç»æ - json æ¯ä¸ç§å¼ºå¤§çæè¿°è¯­è¨ï¼è½å¤æè¿°å¤æçæ°æ®ç»æã\n * å®¹æåæ´æ°æ®ç»æ - æ éåå³ç³»åæ°æ®åºä¸æ ·åæ§è¡ ddl è¯­å¥ä¿®æ¹è¡¨ç»æï¼ç¨åºä»£ç ç´æ¥è¯»åå³å¯ã\n * å®¹æå¼å®¹åå²æ°æ® - å¯¹äºåå²æ°æ®ï¼å³ä½¿æ²¡ææ°å¢çå­æ®µï¼ä¹ä¸ä¼å¯¼è´éè¯¯ï¼åªä¼è¿åç©ºå¼ï¼æ­¤æ¶ä»£ç å¼å®¹å¤çå³å¯ã\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡\n   * atomicity(åå­æ§) ä»æ¯æåè¡/ææ¡£çº§åå­æ§ï¼ä¸æ¯æå¤è¡ãå¤ææ¡£ãå¤è¯­å¥åå­æ§ã\n   * isolation(éç¦»æ§) éç¦»çº§å«ä»æ¯æå·²æäº¤è¯»ï¼read committedï¼çº§å«ï¼å¯è½å¯¼è´ä¸å¯éå¤è¯»ï¼å¹»è¯»çé®é¢ã\n * ä¸æ¯æå¤ææ¥è¯¢ - ä¾å¦ join æ¥è¯¢ï¼å¦æéè¦ join æ¥è¯¢ï¼éè¦å¤æ¬¡æä½æ°æ®åºã\n\nmongondb è¿æ¯æ¯æå¤ææ¡£äºå¡ç consistency(ä¸è´æ§)å durability(æä¹æ§)\n\nè½ç¶å®æ¹å®£å¸ mongodb å°å¨ 4.0 çæ¬ä¸­æ­£å¼æ¨åºå¤ææ¡£ acid äºå¡æ¯æï¼æåè½å°æåµè¿æå¾è§è¯ã\n\n\n# ææ¡£æ°æ®åºä½¿ç¨åºæ¯\n\néç¨åºæ¯ï¼\n\n * å¤§æ°æ®éï¼ä¸æªæ¥æ°æ®å¢é¿å¾å¿«\n * è¡¨ç»æä¸æç¡®ï¼ä¸å­æ®µå¨ä¸æ­å¢å ï¼ä¾å¦åå®¹ç®¡çç³»ç»ï¼ä¿¡æ¯ç®¡çç³»ç»\n\nä¸éç¨åºæ¯ï¼\n\n * æ¯æäºå¡ - å¨ä¸åçææ¡£ä¸éè¦æ·»å äºå¡ãdocument-oriented æ°æ®åºå¹¶ä¸æ¯æææ¡£é´çäºå¡\n * æ¯æå¤ææ¥è¯¢ - å¤ä¸ªææ¡£ç´æ¥éè¦å¤ææ¥è¯¢ï¼ä¾å¦ join\n\n\n# äºãå¨ææç´¢å¼æ\n\nä¼ ç»å³ç³»åæ°æ®åºä¸»è¦éè¿ç´¢å¼æ¥è¾¾å°å¿«éæ¥è¯¢çç®çï¼å¨å¨ææç´¢çä¸å¡ä¸ï¼ç´¢å¼ä¹æ è½ä¸ºåï¼ä¸»è¦ä½ç°å¨ï¼\n\n * å¨ææç´¢çæ¡ä»¶å¯ä»¥éææåç»åï¼å¦æéè¿ç´¢å¼æ¥æ»¡è¶³ï¼åç´¢å¼çæ°ééå¸¸å¤\n * å¨ææç´¢çæ¨¡ç³å¹éæ¹å¼ï¼ç´¢å¼æ æ³æ»¡è¶³ï¼åªè½ç¨ like æ¥è¯¢ï¼è like æ¥è¯¢æ¯æ´è¡¨æ«æï¼æçéå¸¸ä½\n\nèå¨ææç´¢å¼æçåºç°ï¼æ­£æ¯è§£å³å³ç³»åæ°æ®åºå¨ææç´¢åè½è¾å¼±çé®é¢ã\n\n\n# æç´¢å¼æåç\n\nå¨ææç´¢å¼æçææ¯åçç§°ä¸º åæç´¢å¼ï¼inverted indexï¼ï¼æ¯ä¸ç§ç´¢å¼æ¹æ³ï¼å¶åºæ¬åçæ¯å»ºç«åè¯å°ææ¡£çç´¢å¼ãä¸ä¹ç¸å¯¹æ¯ï¼æ¯âæ­£æç´¢å¼âï¼å¶åºæ¬åçæ¯å»ºç«ææ¡£å°åè¯çç´¢å¼ã\n\nç°å¨æå¦ä¸ææ¡£éåï¼\n\n\n\næ­£æç´¢å¼å¾å°ç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼æ­£æç´¢å¼éç¨äºæ ¹æ®ææ¡£åç§°æ¥è¯¢ææ¡£åå®¹\n\nç®åçåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¸¦æåè¯é¢çä¿¡æ¯çåæç´¢å¼å¦ä¸ï¼\n\n\n\nå¯è§ï¼åæç´¢å¼éç¨äºæ ¹æ®å³é®è¯æ¥æ¥è¯¢ææ¡£åå®¹\n\n\n# æç´¢å¼æäº§å\n\n * elasticsearch\n   \n   \n   \n   elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢å¼æãå®æä¾äºä¸ä¸ªåå¸å¼ï¼å¤ç§æ· -è½å¤å¨ææç´¢ä¸åå¨æº http web çé¢åæ æ¶æ json æä»¶ãelasticsearch æ¯ç¨ java å¼åçï¼å¹¶æ ¹æ® apache license çæ¡æ¬¾ä½ä¸ºå¼æºåå¸ãæ ¹æ® db-engines æåï¼elasticsearch æ¯æåæ¬¢è¿çä¼ä¸æç´¢å¼æï¼åé¢æ¯åºäº lucene ç apache solrã\n\n * solr\n   \n   \n   \n   solr æ¯ apache lucene é¡¹ç®çå¼æºä¼ä¸æç´¢å¹³å°ãå¶ä¸»è¦åè½åæ¬å¨ææ£ç´¢ãå½ä¸­æ ç¤ºãåé¢æç´¢ãå¨æèç±»ãæ°æ®åºéæï¼ä»¥åå¯ææ¬ï¼å¦ wordãpdfï¼çå¤çãsolr æ¯é«åº¦å¯æ©å±çï¼å¹¶æä¾äºåå¸å¼æç´¢åç´¢å¼å¤å¶\n\n\n# æç´¢å¼æç¹æ§\n\nä»¥ elasticsearch ä¸ºä¾ï¼ ä¼ç¹å¦ä¸ï¼\n\n * æ¥è¯¢æçé« - å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç\n * å¯æ©å±æ§ - åºäºéç¾¤ç¯å¢å¯ä»¥æ¹ä¾¿æ¨ªåæ©å±ï¼å¯ä»¥æ¿è½½ pb çº§æ°æ®\n * é«å¯ç¨ - elasticsearch éç¾¤å¼¹æ§-ä»ä»¬å°åç°æ°çæå¤±è´¥çèç¹ï¼éç»åéæ°å¹³è¡¡æ°æ®ï¼ç¡®ä¿æ°æ®æ¯å®å¨çåå¯è®¿é®ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * é¨åæ¯æäºå¡ - åä¸ææ¡£çæ°æ®æ¯ acid çï¼åå«å¤ä¸ªææ¡£çäºå¡æ¶ä¸æ¯æäºå¡çæ­£å¸¸åæ»ï¼æ¯æ i(isolation)éç¦»æ§ï¼åºäºä¹è§éæºå¶çï¼ï¼d(durability)æä¹æ§ï¼ä¸æ¯æ a(atomicity)åå­æ§ï¼c(consistency)ä¸è´æ§\n * å¯¹ç±»ä¼¼æ°æ®åºä¸­éè¿å¤é®çå¤æçå¤è¡¨å³èæä½æ¯æè¾å¼±ã\n * è¯»åæä¸å®å»¶æ¶ï¼åå¥çæ°æ®ï¼æå¿« 1s ä¸­è½è¢«æ£ç´¢å°\n * æ´æ°æ§è½è¾ä½ï¼åºå±å®ç°æ¯åå æ°æ®ï¼åæå¥æ°æ°æ®\n * åå­å ç¨å¤§ï¼å ä¸º lucene å°ç´¢å¼é¨åå è½½å°åå­ä¸­\n\n\n# æç´¢å¼æåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * æç´¢å¼æåæ°æ®åæå¼æ - å¨ææ£ç´¢ï¼ç»æåæ£ç´¢ï¼æ°æ®åæ\n * å¯¹æµ·éæ°æ®è¿è¡è¿å®æ¶çå¤ç - å¯ä»¥å°æµ·éæ°æ®åæ£å°å¤å°æå¡å¨ä¸å»å­å¨åæ£ç´¢\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * æ°æ®éè¦é¢ç¹æ´æ°\n * éè¦å¤æå³èæ¥è¯¢\n\n\n# å­ãå¾æ°æ®åº\n\n\n\nå¾å½¢æ°æ®åºåºç¨å¾è®ºå­å¨å®ä½ä¹é´çå³ç³»ä¿¡æ¯ãæå¸¸è§ä¾å­å°±æ¯ç¤¾ä¼ç½ç»ä¸­äººä¸äººä¹é´çå³ç³»ãå³ç³»åæ°æ®åºç¨äºå­å¨âå³ç³»åâæ°æ®çææå¹¶ä¸å¥½ï¼å¶æ¥è¯¢å¤æãç¼æ¢ãè¶åºé¢æï¼èå¾å½¢æ°æ®åºçç¬ç¹è®¾è®¡æ°æ°å¼¥è¡¥äºè¿ä¸ªç¼ºé·ï¼è§£å³å³ç³»åæ°æ®åºå­å¨åå¤çå¤æå³ç³»åæ°æ®åè½è¾å¼±çé®é¢ã\n\n\n# å¾æ°æ®åºäº§å\n\n * neo4j\n   \n   \n   \n   neo4j æ¯ç± neo4jï¼incãå¼åçå¾å½¢æ°æ®åºç®¡çç³»ç»ãç±å¶å¼åäººåæè¿°ä¸ºå·æåçå¾å­å¨åå¤ççç¬¦å acid çäºå¡æ°æ®åºï¼æ ¹æ® db-engines æåï¼ neo4j æ¯ææµè¡çå¾å½¢æ°æ®åºã\n\n * arangodb\n   \n   \n   \n   arangodb æ¯ç± triagens gmbh å¼åçåçå¤æ¨¡åæ°æ®åºç³»ç»ãæ°æ®åºç³»ç»æ¯æä¸ä¸ªéè¦çæ°æ®æ¨¡åï¼é®/å¼ï¼ææ¡£ï¼å¾å½¢ï¼ï¼å¶ä¸­åå«ä¸ä¸ªæ°æ®åºæ ¸å¿åç»ä¸æ¥è¯¢è¯­è¨ aqlï¼arangodb æ¥è¯¢è¯­è¨ï¼ãæ¥è¯¢è¯­è¨æ¯å£°ææ§çï¼åè®¸å¨åä¸ªæ¥è¯¢ä¸­ç»åä¸åçæ°æ®è®¿é®æ¨¡å¼ãarangodb æ¯ä¸ä¸ª nosql æ°æ®åºç³»ç»ï¼ä½ aql å¨å¾å¤æ¹é¢ä¸ sql ç±»ä¼¼ã\n\n * titan\n   \n   \n   \n   titan æ¯ä¸ä¸ªå¯æ©å±çå¾å½¢æ°æ®åºï¼éå¯¹å­å¨åæ¥è¯¢åå«åå¸å¨å¤æºç¾¤éä¸­çæ°ç¾äº¿ä¸ªé¡¶ç¹åè¾¹ç¼çå¾å½¢è¿è¡äºä¼åãtitan æ¯ä¸ä¸ªäºå¡æ§æ°æ®åºï¼å¯ä»¥æ¯ææ°åä¸ªå¹¶åç¨æ·å®æ¶æ§è¡å¤æçå¾å½¢éåã\n\n\n# å¾æ°æ®åºç¹æ§\n\nä»¥ neo4j ä¸ºä¾ï¼\n\nneo4j ä½¿ç¨æ°æ®ç»æä¸­å¾ï¼graphï¼çæ¦å¿µæ¥è¿è¡å»ºæ¨¡ã neo4j ä¸­ä¸¤ä¸ªæåºæ¬çæ¦å¿µæ¯èç¹åè¾¹ãèç¹è¡¨ç¤ºå®ä½ï¼è¾¹åè¡¨ç¤ºå®ä½ä¹é´çå³ç³»ãèç¹åè¾¹é½å¯ä»¥æèªå·±çå±æ§ãä¸åå®ä½éè¿åç§ä¸åçå³ç³»å³èèµ·æ¥ï¼å½¢æå¤æçå¯¹è±¡å¾ã\n\néå¯¹å³ç³»æ°æ®ï¼2 ç§ 2 æ°æ®åºçå­å¨ç»æä¸åï¼\n\n\n\nneo4j ä¸­ï¼å­å¨èç¹æ¶ä½¿ç¨äºâindex-free adjacencyâï¼å³æ¯ä¸ªèç¹é½ææåå¶é»å±èç¹çæéï¼å¯ä»¥è®©æä»¬å¨ o(1)çæ¶é´åæ¾å°é»å±èç¹ãå¦å¤ï¼æç§å®æ¹çè¯´æ³ï¼å¨ neo4j ä¸­è¾¹æ¯æéè¦ç,æ¯âfirst-class entitiesâï¼æä»¥åç¬å­å¨ï¼è¿æå©äºå¨å¾éåçæ¶åæé«éåº¦ï¼ä¹å¯ä»¥å¾æ¹ä¾¿å°ä»¥ä»»ä½æ¹åè¿è¡éå\n\n\n\nå¦ä¸ä¼ç¹ï¼\n\n * é«æ§è½ - å¾çéåæ¯å¾æ°æ®ç»ææå·æçç¬ç¹ç®æ³ï¼å³ä»ä¸ä¸ªèç¹å¼å§ï¼æ ¹æ®å¶è¿æ¥çå³ç³»ï¼å¯ä»¥å¿«éåæ¹ä¾¿å°æ¾åºå®çé»è¿èç¹ãè¿ç§æ¥æ¾æ°æ®çæ¹æ³å¹¶ä¸åæ°æ®éçå¤§å°æå½±åï¼å ä¸ºé»è¿æ¥è¯¢å§ç»æ¥æ¾çæ¯æéçå±é¨æ°æ®ï¼ä¸ä¼å¯¹æ´ä¸ªæ°æ®åºè¿è¡æç´¢\n * è®¾è®¡ççµæ´»æ§ - æ°æ®ç»æçèªç¶ä¼¸å±ç¹æ§åå¶éç»æåçæ°æ®æ ¼å¼ï¼è®©å¾æ°æ®åºè®¾è®¡å¯ä»¥å·æå¾å¤§çä¼¸ç¼©æ§åçµæ´»æ§ãå ä¸ºéçéæ±çååèå¢å çèç¹ãå³ç³»åå¶å±æ§å¹¶ä¸ä¼å½±åå°åæ¥æ°æ®çæ­£å¸¸ä½¿ç¨\n * å¼åçææ·æ§ - ç´è§æäºçæ°æ®æ¨¡åï¼ä»éæ±çè®¨è®ºå¼å§ï¼å°ç¨åºå¼ååå®ç°ï¼ä»¥åæç»ä¿å­å¨æ°æ®åºä¸­çæ ·å­ï¼å®çæ¨¡æ ·ä¼¼ä¹æ²¡æä»ä¹ååï¼çè³å¯ä»¥è¯´æ¬æ¥å°±æ¯ä¸æ¨¡ä¸æ ·ç\n * å®å¨æ¯æ acid - ä¸åå«ç nosql æ°æ®åº neo4j è¿å·æå®å¨äºå¡ç®¡çç¹æ§ï¼å®å¨æ¯æ acid äºå¡ç®¡ç\n\nç¼ºç¹å¦ä¸ï¼\n\n * å­å¨æ¯æèç¹ï¼å³ç³»åå±æ§çæ°éçéå¶ã\n * ä¸æ¯ææåã\n\n\n# å¾æ°æ®åºåºæ¯\n\néç¨åºæ¯å¦ä¸ï¼\n\n * å³ç³»æ§å¼ºçæ°æ®ä¸­ï¼å¦ç¤¾äº¤ç½ç»\n * æ¨èå¼æãå¦ææä»¬å°æ°æ®ä»¥å¾çå½¢å¼è¡¨ç°ï¼é£ä¹å°ä¼éå¸¸æçäºæ¨èçå¶å®\n\nä¸éç¨åºæ¯å¦ä¸ï¼\n\n * è®°å½å¤§éåºäºäºä»¶çæ°æ®ï¼ä¾å¦æ¥å¿æ¡ç®æä¼ æå¨æ°æ®ï¼\n * å¯¹å¤§è§æ¨¡åå¸å¼æ°æ®è¿è¡å¤ç\n * ä¿å­å¨å³ç³»åæ°æ®åºä¸­çç»æåæ°æ®\n * äºè¿å¶æ°æ®å­å¨\n\n\n# ä¸ãæ»ç»\n\nå³ç³»åæ°æ®åºå nosql æ°æ®åºçéåï¼å¾å¾éè¦èèå ä¸ªææ ï¼\n\n * æ°æ®é\n * å¹¶åé\n * å®æ¶æ§\n * ä¸è´æ§è¦æ±\n * è¯»ååå¸åç±»å\n * å®å¨æ§\n * è¿ç»´ææ¬\n\nå¸¸è§è½¯ä»¶ç³»ç»æ°æ®åºéååèå¦ä¸ï¼\n\n * ä¸­åå°ç®¡çåç³»ç» - å¦è¿è¥ç³»ç»ï¼æ°æ®éå°ï¼å¹¶åéå°ï¼é¦éå³ç³»åæ°æ®åºã\n * å¤§æµéç³»ç» - å¦çµåååé¡µï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéåå­åæ°æ®åºã\n * æ¥å¿åç³»ç» - åå§æ°æ®èèéåå¼æ°æ®åºï¼æ¥å¿æç´¢èèéæç´¢å¼æã\n * æç´¢åç³»ç» - ä¾å¦ç«åæç´¢ï¼ééç¨æç´¢ï¼å¦ååæç´¢ï¼åå°èèéå³ç³»åæ°æ®åºï¼åå°èèéæç´¢å¼æã\n * äºå¡åç³»ç» - å¦åºå­ï¼äº¤æï¼è®°è´¦ï¼èèéå³ç³»åæ°æ®åº+k-v æ°æ®åºï¼ä½ä¸ºç¼å­ï¼+åå¸å¼äºå¡ã\n * ç¦»çº¿è®¡ç® - å¦å¤§éæ°æ®åæï¼èèéåå¼æ°æ®åºæå³ç³»åæ°æ®ã\n * å®æ¶è®¡ç® - å¦å®æ¶çæ§ï¼å¯ä»¥èèéåå­åæ°æ®åºæèåå¼æ°æ®åºã\n\nè®¾è®¡å®è·µä¸­ï¼è¦åºäºéæ±ãä¸å¡é©±å¨æ¶æï¼æ è®ºéç¨ rdb/nosql/drdb,ä¸å®æ¯ä»¥éæ±ä¸ºå¯¼åï¼æç»æ°æ®å­å¨æ¹æ¡å¿ç¶æ¯åç§æè¡¡çç»¼åæ§è®¾è®¡\n\n\n# åèèµæ\n\n * nosql è¿æ¯ sql ï¼è¿ä¸ç¯è®²æ¸æ¥',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"æ°æ®ç»æä¸æ°æ®åºç´¢å¼",frontmatter:{title:"æ°æ®ç»æä¸æ°æ®åºç´¢å¼",date:"2022-03-27T23:39:10.000Z",categories:["æ°æ®åº","æ°æ®åºç»¼å"],tags:["æ°æ®åº","ç»¼å","æ°æ®ç»æ","ç´¢å¼"],permalink:"/pages/4702da/"},regularPath:"/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%BC%E5%90%88/02.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B4%A2%E5%BC%95.html",relativePath:"01.æ°æ®åºç»¼å/02.æ°æ®ç»æä¸æ°æ®åºç´¢å¼.md",key:"v-700c3ee7",path:"/pages/4702da/",headers:[{level:2,title:"å¼è¨",slug:"å¼è¨",normalizedTitle:"å¼è¨",charIndex:52},{level:2,title:"æ°ç»åé¾è¡¨",slug:"æ°ç»åé¾è¡¨",normalizedTitle:"æ°ç»åé¾è¡¨",charIndex:660},{level:2,title:"åå¸ç´¢å¼",slug:"åå¸ç´¢å¼",normalizedTitle:"åå¸ç´¢å¼",charIndex:1314},{level:2,title:"B-Tree ç´¢å¼",slug:"b-tree-ç´¢å¼",normalizedTitle:"b-tree ç´¢å¼",charIndex:2193},{level:3,title:"äºåæç´¢æ ",slug:"äºåæç´¢æ ",normalizedTitle:"äºåæç´¢æ ",charIndex:2517},{level:3,title:"B+Tree ç´¢å¼",slug:"b-tree-ç´¢å¼-2",normalizedTitle:"b+tree ç´¢å¼",charIndex:2921},{level:2,title:"LSM æ ",slug:"lsm-æ ",normalizedTitle:"lsm æ ",charIndex:39},{level:2,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:6740},{level:2,title:"ç´¢å¼çç»´æ¤",slug:"ç´¢å¼çç»´æ¤",normalizedTitle:"ç´¢å¼çç»´æ¤",charIndex:6936},{level:3,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:6946},{level:3,title:"æ´æ°ç´¢å¼",slug:"æ´æ°ç´¢å¼",normalizedTitle:"æ´æ°ç´¢å¼",charIndex:582},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7478}],headersStr:"å¼è¨ æ°ç»åé¾è¡¨ åå¸ç´¢å¼ B-Tree ç´¢å¼ äºåæç´¢æ  B+Tree ç´¢å¼ LSM æ  åæç´¢å¼ ç´¢å¼çç»´æ¤ åå»ºç´¢å¼ æ´æ°ç´¢å¼ åèèµæ",content:"# æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n> å³é®è¯ï¼é¾è¡¨ãæ°ç»ãæ£åè¡¨ãçº¢é»æ ãB+ æ ãLSM æ ãè·³è¡¨\n\n\n# å¼è¨\n\næ°æ®åºæ¯âæç§ æ°æ®ç»æ æ¥ç»ç»ãå­å¨åç®¡çæ°æ®çä»åºâãæ¯ä¸ä¸ªé¿æå­å¨å¨è®¡ç®æºåçãæç»ç»çãå¯å±äº«çãç»ä¸ç®¡ççå¤§éæ°æ®çéåã\n\nââä¸é¢è¿å¥å®ä¹å¯¹æ°æ®åºçå®ä¹æ¥èªç¾åº¦ç¾ç§ãéè¿è¿ä¸ªå®ä¹ï¼æä»¬ä¹è½ææ¾çåºæ°æ®ç»ææ¯å®ç°æ°æ®åºçåºç³ã\n\nä»æ¬è´¨æ¥çï¼æ°æ®åºåªè´è´£ä¸¤ä»¶äºï¼è¯»æ°æ®ãåæ°æ®ï¼èæ°æ®ç»æç ç©¶çæ¯å¦ä½åçç»ç»æ°æ®ï¼å°½å¯è½æåè¯»ãåæ°æ®çæçï¼è¿æ°å¥½æ¯æ°æ®åºçæ ¸å¿é®é¢ãå æ­¤ï¼æ°æ®ç»æä¸æ°æ®åºè¿ä¸¤ä¸ªé¢åæéå¸¸å¤çäº¤éãå¶ä¸­ï¼æ°æ®åºç´¢å¼æè½ä½ç°äºèçç´§å¯å³èã\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æãç´¢å¼åºäºåå§æ°æ®è¡çèæ¥ï¼å®çä¸»è¦ä½ç¨æ¯ç¼©å°æ£ç´¢çæ°æ®èå´ï¼æåæ¥è¯¢æ§è½ãéä¿æ¥è¯´ï¼ç´¢å¼å¨æ°æ®åºä¸­çä½ç¨å°±åæ¯ä¸æ¬ä¹¦çç®å½ç´¢å¼ãç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\nå¾å¤æ°æ®åºåè®¸åç¬æ·»å åå é¤ç´¢å¼ï¼èä¸å½±åæ°æ®åºçåå®¹ï¼å®åªä¼å½±åæ¥è¯¢æ§è½ãç»´æ¤é¢å¤çç»æå¿å¿ä¼å¼å¥å¼éï¼ç¹å«æ¯å¨æ°æ°æ®åå¥æ¶ãå¯¹äºåå¥ï¼å®å¾é¾è¶è¿ç®åå°è¿½å æä»¶æ¹å¼çæ§è½ï¼å ä¸ºé£å·²ç»æ¯æç®åçåæä½äºãç±äºæ¯æ¬¡åæ°æ®æ¶ï¼éè¦æ´æ°ç´¢å¼ï¼å æ­¤ä»»ä½ç±»åçç´¢å¼éå¸¸é½ä¼éä½åçéåº¦ã\n\næ¬æä»¥ä¸äºå¸¸è§çæ°æ®åºä¸ºä¾ï¼åæå®ä»¬çç´¢å¼éç¨äºä»ä¹æ ·çæ°æ®ç»æï¼æä»ä¹å©å¼ï¼ä¸ºä½å¦æ­¤è®¾è®¡ã\n\n\n# æ°ç»åé¾è¡¨\n\næ°ç»åé¾è¡¨åå«ä»£è¡¨äºè¿ç»­ç©ºé´åä¸è¿ç»­ç©ºé´çå­å¨æ¹å¼ï¼å®ä»¬æ¯çº¿æ§è¡¨ï¼Linear Listï¼çå¸åä»£è¡¨ãå¶ä»ææçæ°æ®ç»æï¼æ¯å¦æ ãéåãäºåæ ãB+ æ ç­ï¼å®éä¸é½æ¯è¿ä¸¤èçç»ååååã\n\næ°ç»ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ãæ°ç»æ¯æéæºè®¿é®ï¼æ ¹æ®ä¸æ éæºè®¿é®çæ¶é´å¤æåº¦ä¸º O(1)ãä½è¿å¹¶ä¸ä»£è¡¨æ°ç»çæ¥æ¾æ¶é´å¤æåº¦ä¹æ¯ O(1)ã\n\n * å¯¹äºæ åºæ°ç»ï¼åªè½é¡ºåºæ¥æ¾ï¼å¶æ¶é´å¤æåº¦ä¸º O(n)ã\n * å¯¹äºæåºæ°ç»ï¼å¯ä»¥åºç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º O(log n)ã\n\nå¨æåºæ°ç»ä¸åºç¨äºåæ¥æ¾æ³å¦æ­¤é«æï¼ä¸ºä»ä¹å ä¹æ²¡ææ°æ®åºç´æ¥ä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼è¿æ¯å ä¸ºå®çéå¶æ¡ä»¶ï¼æ°æ®æåºââä¸ºäºä¿è¯æ°æ®æåºï¼æ¯æ¬¡æ·»å ãå é¤æ°ç»æ°æ®æ¶ï¼é½å¿é¡»è¦è¿è¡æ°æ®è°æ´ï¼æ¥ä¿è¯å¶æåºï¼è æ°ç»çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º O(n)ãæ­¤å¤ï¼ç±äºæ°ç»ç©ºé´å¤§å°åºå®ï¼æ¯æ¬¡æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ãæ°ç»çè¿äºç¹æ§ï¼å³å®äºå®ä¸éåç¨äºæ°æ®é¢ç¹ååçåºç¨åºæ¯ã\n\n\n\né¾è¡¨ç¨ä¸è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶éè¿ä¸ä¸ªæéæé¡ºåºå°è¿äºç©ºé´ä¸²èµ·æ¥ï¼å½¢æä¸æ¡é¾ã\n\nåºå«äºæ°ç»ï¼é¾è¡¨ä¸­çåç´ ä¸æ¯å­å¨å¨åå­ä¸­è¿ç»­çä¸çåºåï¼é¾è¡¨ä¸­çæ°æ®å­å¨å¨æ¯ä¸ä¸ªç§°ä¹ä¸ºãç»ç¹ãå¤ååºåéï¼å¨æ¯ä¸ä¸ªç»ç¹é¤äºå­å¨æ°æ®ä»¥å¤ï¼è¿ä¿å­äºå°ä¸ä¸ä¸ªèç¹çæéï¼Pointerï¼ãç±äºä¸å¿æé¡ºåºå­å¨ï¼é¾è¡¨çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º O(1)ï¼ä½æ¯ï¼é¾è¡¨åªæ¯æé¡ºåºè®¿é®ï¼å¶ æ¥æ¾æ¶é´å¤æåº¦ä¸º O(n)ãå¶ä½æçæ¥æ¾æ¹å¼ï¼å³å®äºé¾è¡¨ä¸éåä½ä¸ºç´¢å¼ã\n\n\n\n\n# åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ Valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ Hash å½æ°å° Key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ O(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (A,B) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å Aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãIN()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ WHERE price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èãä¾å¦ï¼Mysql ä¸­ç Memory å­å¨å¼æå°±æ¾ç¤ºçæ¯æåå¸ç´¢å¼ã\n\n\n# B-Tree ç´¢å¼\n\néå¸¸æä»¬æè¯´ç B æ ç´¢å¼æ¯æ B-Tree ç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨ B-Tree è¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º MySQL å¨ CREATE TABLE æå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ InnoDB ä½¿ç¨çæ¯ B+Treeç´¢å¼ï¼è MyISAM ä½¿ç¨çæ¯ B-Treeç´¢å¼ã\n\nB-Tree ç´¢å¼ä¸­ç B æ¯æ balanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼B-Tree ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ O(log n)ã\n\nå½ç¶ä¸ºäºç»´æ O(log n) çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ O(log n)ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç I/O æ¶èï¼ç¸å¯¹äºåå­å­åï¼I/O å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç I/O è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç I/O å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º N åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è B+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n\n# B+Tree ç´¢å¼\n\nB+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£ B+Treeï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçB+Treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãInnoDB çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº B æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ InnoDB éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from T where ID=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ ID è¿æ£µ B+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from T where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° ID çå¼ä¸º 500ï¼åå° ID ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ NOT NULL PRIMARY KEY AUTO_INCREMENTãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ãè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n----------------------------------------\n\nåå­æ¯åå¯¼ä½åä»¶ãå¯¹äºåå­èè¨ï¼åªè¦ç»åºäºåå­å°åï¼æä»¬å°±å¯ä»¥ç´æ¥è®¿é®è¯¥å°åååºæ°æ®ãè¿ä¸ªè¿ç¨å·æé«æçéæºè®¿é®ç¹æ§ï¼å æ­¤åå­ä¹å«éæºè®¿é®å­å¨å¨ï¼Random Access Memoryï¼å³ RAMï¼ãåå­çè®¿é®éåº¦å¾å¿«ï¼ä½æ¯ä»·æ ¼ç¸å¯¹è¾æè´µï¼å æ­¤ä¸è¬çè®¡ç®æºåå­ç©ºé´é½ç¸å¯¹è¾å°ã\n\nèç£çæ¯æºæ¢°å¨ä»¶ãç£çè®¿é®æ°æ®æ¶ï¼éè¦ç­ç£çççæè½¬å°ç£å¤´ä¸ï¼æè½è¯»åç¸åºçæ°æ®ãå°½ç®¡ç£ççæè½¬éåº¦å¾å¿«ï¼ä½æ¯ååå­çéæºè®¿é®ç¸æ¯ï¼æ§è½å·®è·éå¸¸å¤§ãä¸è¬æ¥è¯´ï¼å¦ææ¯éæºè¯»åï¼ä¼æ 10 ä¸å° 100 ä¸åå·¦å³çå·®è·ãä½å¦ææ¯é¡ºåºè®¿é®å¤§æ¹éæ°æ®çè¯ï¼ç£ççæ§è½ååå­å°±æ¯ä¸ä¸ªæ°éçº§çã\n\nç£ççæå°è¯»ååä½æ¯æåºï¼è¾æ©æçç£çä¸ä¸ªæåºæ¯ 512 å­èãéçç£çææ¯çåå±ï¼ç®åå¸¸è§çç£çæåºæ¯ 4K ä¸ªå­èãæä½ç³»ç»ä¸æ¬¡ä¼è¯»åå¤ä¸ªæåºï¼æä»¥æä½ç³»ç»çæå°è¯»ååä½æ¯åï¼Blockï¼ï¼ä¹å«ä½ç°ï¼Clusterï¼ãå½æä»¬è¦ä»ç£çä¸­è¯»åä¸ä¸ªæ°æ®æ¶ï¼æä½ç³»ç»ä¼ä¸æ¬¡æ§å°æ´ä¸ªåé½è¯»åºæ¥ãå æ­¤ï¼å¯¹äºå¤§æ¹éçé¡ºåºè¯»åæ¥è¯´ï¼ç£ççæçä¼æ¯éæºè¯»åé«è®¸å¤ã\n\nåè®¾æä¸ä¸ªæåºæ°ç»å­å¨å¨ç¡¬çä¸­ï¼å¦æå®è¶³å¤å¤§ï¼é£ä¹å®ä¼å­å¨å¨å¤ä¸ªåä¸­ãå½æä»¬è¦å¯¹è¿ä¸ªæ°ç»ä½¿ç¨äºåæ¥æ¾æ¶ï¼éè¦åæ¾å°ä¸­é´åç´ æå¨çåï¼å°è¿ä¸ªåä»ç£çä¸­è¯»å°åå­éï¼ç¶åå¨åå­ä¸­è¿è¡äºåæ¥æ¾ãå¦æä¸ä¸æ­¥è¦è¯»çåç´ å¨å¶ä»åä¸­ï¼åéè¦åå°ç¸åºåä»ç£çä¸­è¯»å¥åå­ãç´å°æ¥è¯¢ç»æï¼è¿ä¸ªè¿ç¨å¯è½ä¼å¤æ¬¡è®¿é®ç£çãæä»¬å¯ä»¥çå°ï¼è¿æ ·çæ£ç´¢æ§è½éå¸¸ä½ã\n\nç±äºç£çç¸å¯¹äºåå­èè¨è®¿é®éåº¦å®å¨å¤ªæ¢ï¼å æ­¤ï¼å¯¹äºç£çä¸æ°æ®çé«ææ£ç´¢ï¼æä»¬æä¸ä¸ªæå¶éè¦çååï¼å¯¹ç£ççè®¿é®æ¬¡æ°è¦å°½å¯è½çå°ï¼\n\nå°ç´¢å¼åæ°æ®åç¦»å°±æ¯ä¸ç§å¸¸è§çè®¾è®¡æè·¯ãå¨æ°æ®é¢ç¹ååçåºæ¯ä¸­ï¼æåºæ°ç»å¹¶ä¸æ¯ä¸ä¸ªæå¥½çéæ©ï¼äºåæ£ç´¢æ æèåå¸è¡¨å¾å¾æ´ææ®éæ§ãä½æ¯ï¼åå¸è¡¨ç±äºç¼ºä¹èå´æ£ç´¢çè½åï¼å¨ä¸äºåºåä¹ä¸éç¨ãå æ­¤ï¼äºåæ£ç´¢æ è¿ç§æ å½¢ç»ææ¯è®¸å¤å¸¸è§æ£ç´¢ç³»ç»çå®æ½æ¹æ¡ã\n\néçç´¢å¼æ°æ®è¶æ¥è¶å¤§ï¼ç´å°æ æ³å®å¨å è½½å°åå­ä¸­ï¼è¿æ¯éè¦å°ç´¢å¼æ°æ®ä¹å­å¥ç£çä¸­ãB+ æ ç»åºäºå°æ å½¢ç´¢å¼çææèç¹é½å­å¨ç£çä¸çé«ææ£ç´¢æ¹æ¡ãæä½ç³»ç»å¯¹ç£çæ°æ®çè®¿é®æ¯ä»¥åä¸ºåä½çãå æ­¤ï¼å¦ææä»¬æ³å°æ åç´¢å¼çä¸ä¸ªèç¹ä»ç£çä¸­è¯»åºï¼å³ä½¿è¯¥èç¹çæ°æ®éå¾å°ï¼æ¯å¦è¯´åªæå ä¸ªå­èï¼ï¼ä½ç£çä¾ç¶ä¼å°æ´ä¸ªåçæ°æ®å¨é¨è¯»åºæ¥ï¼èä¸æ¯åªè¯»è¿ä¸å°é¨åæ°æ®ï¼è¿ä¼è®©ææè¯»åæçå¾ä½ãB+ æ çä¸ä¸ªå³é®è®¾è®¡ï¼å°±æ¯è®©ä¸ä¸ªèç¹çå¤§å°ç­äºä¸ä¸ªåçå¤§å°ãèç¹åå­å¨çæ°æ®ï¼ä¸æ¯ä¸ä¸ªåç´ ï¼èæ¯ä¸ä¸ªå¯ä»¥è£ m ä¸ªåç´ çæåºæ°ç»ãè¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥å°ç£çä¸æ¬¡è¯»åçæ°æ®å¨é¨å©ç¨èµ·æ¥ï¼ä½¿å¾è¯»åæçæå¤§åã\n\nB+ æ è¿æå¦ä¸ä¸ªè®¾è®¡ï¼å°±æ¯å°ææçèç¹åä¸ºåé¨èç¹åå¶å­èç¹ãåé¨èç¹ä»å­å¨ key åç»´ææ å½¢ç»æçæéï¼å¹¶ä¸å­å¨ key å¯¹åºçæ°æ®ï¼æ è®ºæ¯å·ä½æ°æ®è¿æ¯æä»¶ä½ç½®ä¿¡æ¯ï¼ãè¿æ ·åé¨èç¹å°±è½å­å¨æ´å¤çç´¢å¼æ°æ®ï¼æä»¬ä¹å°±å¯ä»¥ä½¿ç¨æå°çåé¨èç¹ï¼å°æææ°æ®ç»ç»èµ·æ¥äºãèå¶å­èç¹ä»å­å¨ key åå¯¹åºæ°æ®ï¼ä¸å­å¨ç»´ææ å½¢ç»æçæéãéè¿è¿æ ·çè®¾è®¡ï¼B+ æ å°±è½åå°èç¹çç©ºé´å©ç¨çæå¤§åãæ­¤å¤ï¼B+ æ è¿å°åä¸å±çææèç¹ä¸²æäºæåºçååé¾è¡¨ï¼è¿æ ·ä¸æ¥ï¼B+ æ å°±åæ¶å·å¤äºè¯å¥½çèå´æ¥è¯¢è½ååçµæ´»è°æ´çè½åäºã\n\nå æ­¤ï¼B+ æ æ¯ä¸æ£µå®å¨å¹³è¡¡ç m é¶å¤åæ ãæè°ç m é¶ï¼æçæ¯æ¯ä¸ªèç¹æå¤æ m ä¸ªå­èç¹ï¼å¹¶ä¸æ¯ä¸ªèç¹éé½å­äºä¸ä¸ªç´§åçå¯åå« m ä¸ªåç´ çæ°ç»ã\n\nå³ä½¿æ¯å¤æç B+ æ ï¼æä»¬å°å®æè§£å¼æ¥ï¼å¶å®ä¹æ¯ç±ç®åçæ°ç»ãé¾è¡¨åæ ç»æçï¼èä¸ B+ æ çæ£ç´¢è¿ç¨å¶å®ä¹æ¯äºåæ¥æ¾ãå æ­¤ï¼å¦æ B+ æ å®å¨å è½½å¨åå­ä¸­çè¯ï¼å®çæ£ç´¢æçå¶å®å¹¶ä¸ä¼æ¯æåºæ°ç»æèäºåæ£ç´¢æ æ´ é«ï¼ä¹è¿æ¯äºåæ¥æ¾ç log(n) çæçãå¹¶ä¸ï¼å®è¿æ¯æ°ç»åäºåæ£ç´¢æ æ´å å¤æï¼è¿ä¼å¸¦æ¥é¢å¤çå¼éã\n\nå¦å¤ï¼è¿ä¸èè¿æä¸ä¸ªå¾éè¦çè®¾è®¡ææ³éè¦ä½ ææ¡ï¼é£å°±æ¯å°ç´¢å¼åæ°æ®åç¦»ãéè¿è¿æ ·çæ¹å¼ï¼æä»¬è½å°ç´¢å¼çæ°ç»å¤§å°ä¿æå¨ä¸ä¸ªè¾å°çèå´åï¼è®©å®è½å è½½å¨åå­ä¸­ãå¨è®¸å¤å¤§è§æ¨¡ç³»ç»ä¸­ï¼é½æ¯ä½¿ç¨è¿ä¸ªè®¾è®¡ææ³æ¥ç²¾ç®ç´¢å¼çãèä¸ï¼B+ æ çåé¨èç¹åå¶å­èç¹çåºåï¼å¶å®ä¹æ¯ç´¢å¼åæ°æ®åç¦»çä¸æ¬¡å®è·µã\n\nMySQL ä¸­ç B+ æ å®ç°å¶å®æä¸¤ç§ï¼ä¸ç§æ¯ MyISAM å¼æï¼å¦ä¸ç§æ¯ InnoDB å¼æãå®ä»¬çæ ¸å¿åºå«å°±å¨äºï¼æ°æ®åç´¢å¼æ¯å¦æ¯åç¦»çã\n\nå¨ MyISAM å¼æä¸­ï¼B+ æ çå¶å­èç¹ä»å­å¨äºæ°æ®çä½ç½®æéï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®åç¦»çè®¾è®¡æ¹æ¡ï¼å«ä½éèéç´¢å¼ãå¦æè¦ä¿è¯ MyISAM çæ°æ®ä¸è´æ§ï¼é£æä»¬éè¦å¨è¡¨çº§å«ä¸è¿è¡å éå¤çã\n\nå¨ InnoDB ä¸­ï¼B+ æ çå¶å­èç¹ç´æ¥å­å¨äºå·ä½æ°æ®ï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®ä¸ä½çæ¹æ¡ãå«ä½èéç´¢å¼ãç±äºæ°æ®ç´æ¥å°±å­å¨ç´¢å¼çå¶å­èç¹ä¸­ï¼å æ­¤ InnoDB ä¸éè¦ç»å¨è¡¨å éæ¥ä¿è¯ä¸è´æ§ï¼å®åªéè¦æ¯æè¡çº§çéå°±å¯ä»¥äºã\n\n\n# LSM æ \n\nB+ æ çæ°æ®é½å­å¨å¨å¶å­èç¹ä¸­ï¼èå¶å­èç¹ä¸è¬é½å­å¨å¨ç£çä¸­ãå æ­¤ï¼æ¯æ¬¡æå¥çæ°æ°æ®é½éè¦éæºåå¥ç£çï¼èéæºåå¥çæ§è½éå¸¸æ¢ãå¦ææ¯ä¸ä¸ªæ¥å¿ç³»ç»ï¼æ¯ç§éè¦åå¥ä¸åæ¡çè³ä¸ä¸æ¡æ°æ®ï¼è¿æ ·çç£çæä½ä»£ä»·ä¼ä½¿å¾ç³»ç»æ§è½æ¥å§ä¸éï¼çè³æ æ³ä½¿ç¨ã\n\næä½ç³»ç»å¯¹ç£ççè¯»åæ¯ä»¥åä¸ºåä½çï¼æä»¬è½å¦ä»¥åä¸ºåä½åå¥ï¼èä¸æ¯æ¯æ¬¡æå¥ä¸ä¸ªæ°æ®é½è¦éæºåå¥ç£çå¢ï¼è¿æ ·æ¯ä¸æ¯å°±å¯ä»¥å¤§å¹åº¦åå°åå¥æä½äºå¢ï¼è§£å³æ¹æ¡å°±æ¯ï¼LSM æ ï¼Log Structured Merge Treesï¼ã\n\nLSM æ å°±æ¯æ ¹æ®è¿ä¸ªæè·¯è®¾è®¡äºè¿æ ·ä¸ä¸ªæºå¶ï¼å½æ°æ®åå¥æ¶ï¼å»¶è¿åç£çï¼å°æ°æ®åå­æ¾å¨åå­ä¸­çæ éï¼è¿è¡å¸¸è§çå­å¨åæ¥è¯¢ãå½åå­ä¸­çæ æç»­åå¤§è¾¾å°éå¼æ¶ï¼åæ¹éå°ä»¥åä¸ºåä½åå¥ç£ççæ ä¸­ãå æ­¤ï¼LSM æ è³å°éè¦ç±ä¸¤æ£µæ ç»æï¼ä¸æ£µæ¯å­å¨å¨åå­ä¸­è¾å°ç C0 æ ï¼å¦ä¸æ£µæ¯å­å¨å¨ç£çä¸­è¾å¤§ç C1 æ ã\n\nLSM æ å·æä»¥ä¸ 3 ä¸ªç¹ç¹ï¼\n\n 1. å°ç´¢å¼åä¸ºåå­åç£çä¸¤é¨åï¼å¹¶å¨åå­è¾¾å°éå¼æ¶å¯å¨æ åå¹¶ï¼Merge Treesï¼ï¼\n 2. ç¨æ¹éåå¥ä»£æ¿éæºåå¥ï¼å¹¶ä¸ç¨é¢åæ¥å¿ WAL ææ¯ï¼Write AheadLogï¼é¢åæ¥å¿ææ¯ï¼ä¿è¯åå­æ°æ®ï¼å¨ç³»ç»å´©æºåå¯ä»¥è¢«æ¢å¤ï¼\n 3. æ°æ®éåç±»ä¼¼æ¥å¿è¿½å åçæ¹å¼åå¥ï¼Log Structuredï¼ç£çï¼ä»¥é¡ºåºåçæ¹å¼æé«å å¥æçã\n\nLSM æ çè¿äºç¹ç¹ï¼ä½¿å¾å®ç¸å¯¹äº B+ æ ï¼å¨åå¥æ§è½ä¸æå¤§å¹æåãæä»¥ï¼è®¸å¤ NoSQL ç³»ç»é½ä½¿ç¨ LSM æ ä½ä¸ºæ£ç´¢å¼æï¼èä¸è¿å¯¹ LSM æ è¿è¡äºä¼åä»¥æåæ£ç´¢æ§è½ã\n\n\n# åæç´¢å¼\n\nåæç´¢å¼çæ ¸å¿å¶å®å¹¶ä¸å¤æï¼å®çå·ä½å®ç°å¶å®æ¯åå¸è¡¨ï¼åªæ¯å®ä¸æ¯å°ææ¡£ ID æèé¢ç®ä½ä¸º keyï¼èæ¯åè¿æ¥ï¼éè¿å°åå®¹æèå±æ§ä½ä¸º key æ¥å­å¨å¯¹åºçææ¡£åè¡¨ï¼ä½¿å¾æä»¬è½å¨ O(1) çæ¶é´ä»£ä»·åå®ææ¥è¯¢ã\n\nå°½ç®¡åçå¹¶ä¸å¤æï¼ä½æ¯åæç´¢å¼æ¯è®¸å¤æ£ç´¢å¼æçæ ¸å¿ãæ¯å¦è¯´ï¼æ°æ®åºçå¨æç´¢å¼åè½ãæç´¢å¼æçç´¢å¼ãå¹¿åå¼æåæ¨èå¼æï¼é½ä½¿ç¨äºåæç´¢å¼ææ¯æ¥å®ç°æ£ç´¢åè½ã\n\n\n# ç´¢å¼çç»´æ¤\n\n\n# åå»ºç´¢å¼\n\n * æ°æ®åç¼©ï¼ä¸ä¸ªæ¯å°½å¯è½å°å°æ°æ®å è½½å°åå­ä¸­ï¼å ä¸ºåå­çæ£ç´¢æçå¤§å¤§é«äºç£çãé£ä¸ºäºå°æ°æ®æ´å¤å°å è½½å°åå­ä¸­ï¼ç´¢å¼åç¼©æ¯ä¸ä¸ªéè¦çç ç©¶æ¹åã\n * åæ¯å¤çï¼å¦ä¸ä¸ªæ¯å°å¤§æ°æ®éåææå¤ä¸ªå°æ°æ®éåæ¥å¤çãè¿å¶å®å°±æ¯åå¸å¼ç³»ç»çæ ¸å¿ææ³ã\n\n\n# æ´æ°ç´¢å¼\n\nï¼1ï¼Double Bufferï¼åç¼å²ï¼æºå¶\n\nå°±æ¯å¨åå­ä¸­åæ¶ä¿å­ä¸¤ä»½ä¸æ ·çç´¢å¼ï¼ä¸ä¸ªæ¯ç´¢å¼ Aï¼ä¸ä¸ªæ¯ç´¢å¼ Bãä¸¤ä¸ªç´¢å¼ä¿æä¸ä¸ªè¯»ãä¸ä¸ªåï¼å¹¶ä¸æ¥ååæ¢ï¼æç»å®æé«æ§è½çç´¢å¼æ´æ°ã\n\nä¼ç¹ï¼ç®åé«æ\n\nç¼ºç¹ï¼è¾¾å°ä¸å®æ°æ®éçº§åï¼ä¼å¸¦æ¥ç¿»åçåå­å¼éï¼çè³æäºç´¢å¼å­å¨å¨ç£çä¸çæåµä¸ï¼æ´æ¯æ æ³ä½¿ç¨æ­¤æºå¶ã\n\nï¼2ï¼å¨éç´¢å¼åå¢éç´¢å¼\n\nå°æ°æ¥æ¶å°çæ°æ®åç¬å»ºç«ä¸ä¸ªå¯ä»¥å­å¨åå­ä¸­çåæç´¢å¼ï¼ä¹å°±æ¯å¢éç´¢å¼ãå½æ¥è¯¢åççæ¶åï¼æä»¬ä¼åæ¶æ¥è¯¢å¨éç´¢å¼åå¢éç´¢å¼ï¼å°åå¹¶çç»æä½ä¸ºæ»çç»æè¾åºã\n\nå ä¸ºå¢éç´¢å¼ç¸å¯¹å¨éç´¢å¼èè¨ä¼å°å¾å¤ï¼åå­èµæºæ¶èå¨å¯æ¿åèå´ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨ Double Buffer æºå¶ å¯¹å¢éç´¢å¼è¿è¡ç´¢å¼æ´æ°ãè¿æ ·ä¸æ¥ï¼å¢éç´¢å¼å°±å¯ä»¥åå°æ éè®¿é®ãèå¨éç´¢å¼æ¬èº«å°±æ¯åªè¯»çï¼ä¹ä¸éè¦å éãå æ­¤ï¼æ´ä¸ªæ£ç´¢è¿ç¨é½å¯ä»¥åå°æ éè®¿é®ï¼ä¹å°±æé«äºç³»ç»çæ£ç´¢æçã\n\n\n# åèèµæ\n\n * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã\n * æ°æ®ç»æä¸ç®æ³ä¹ç¾\n * æ£ç´¢ææ¯æ ¸å¿ 20 è®²\n * Data Structures for Databases\n * Data Structures and Algorithms for Big Databases",normalizedContent:"# æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n> å³é®è¯ï¼é¾è¡¨ãæ°ç»ãæ£åè¡¨ãçº¢é»æ ãb+ æ ãlsm æ ãè·³è¡¨\n\n\n# å¼è¨\n\næ°æ®åºæ¯âæç§ æ°æ®ç»æ æ¥ç»ç»ãå­å¨åç®¡çæ°æ®çä»åºâãæ¯ä¸ä¸ªé¿æå­å¨å¨è®¡ç®æºåçãæç»ç»çãå¯å±äº«çãç»ä¸ç®¡ççå¤§éæ°æ®çéåã\n\nââä¸é¢è¿å¥å®ä¹å¯¹æ°æ®åºçå®ä¹æ¥èªç¾åº¦ç¾ç§ãéè¿è¿ä¸ªå®ä¹ï¼æä»¬ä¹è½ææ¾çåºæ°æ®ç»ææ¯å®ç°æ°æ®åºçåºç³ã\n\nä»æ¬è´¨æ¥çï¼æ°æ®åºåªè´è´£ä¸¤ä»¶äºï¼è¯»æ°æ®ãåæ°æ®ï¼èæ°æ®ç»æç ç©¶çæ¯å¦ä½åçç»ç»æ°æ®ï¼å°½å¯è½æåè¯»ãåæ°æ®çæçï¼è¿æ°å¥½æ¯æ°æ®åºçæ ¸å¿é®é¢ãå æ­¤ï¼æ°æ®ç»æä¸æ°æ®åºè¿ä¸¤ä¸ªé¢åæéå¸¸å¤çäº¤éãå¶ä¸­ï¼æ°æ®åºç´¢å¼æè½ä½ç°äºèçç´§å¯å³èã\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æãç´¢å¼åºäºåå§æ°æ®è¡çèæ¥ï¼å®çä¸»è¦ä½ç¨æ¯ç¼©å°æ£ç´¢çæ°æ®èå´ï¼æåæ¥è¯¢æ§è½ãéä¿æ¥è¯´ï¼ç´¢å¼å¨æ°æ®åºä¸­çä½ç¨å°±åæ¯ä¸æ¬ä¹¦çç®å½ç´¢å¼ãç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\nå¾å¤æ°æ®åºåè®¸åç¬æ·»å åå é¤ç´¢å¼ï¼èä¸å½±åæ°æ®åºçåå®¹ï¼å®åªä¼å½±åæ¥è¯¢æ§è½ãç»´æ¤é¢å¤çç»æå¿å¿ä¼å¼å¥å¼éï¼ç¹å«æ¯å¨æ°æ°æ®åå¥æ¶ãå¯¹äºåå¥ï¼å®å¾é¾è¶è¿ç®åå°è¿½å æä»¶æ¹å¼çæ§è½ï¼å ä¸ºé£å·²ç»æ¯æç®åçåæä½äºãç±äºæ¯æ¬¡åæ°æ®æ¶ï¼éè¦æ´æ°ç´¢å¼ï¼å æ­¤ä»»ä½ç±»åçç´¢å¼éå¸¸é½ä¼éä½åçéåº¦ã\n\næ¬æä»¥ä¸äºå¸¸è§çæ°æ®åºä¸ºä¾ï¼åæå®ä»¬çç´¢å¼éç¨äºä»ä¹æ ·çæ°æ®ç»æï¼æä»ä¹å©å¼ï¼ä¸ºä½å¦æ­¤è®¾è®¡ã\n\n\n# æ°ç»åé¾è¡¨\n\næ°ç»åé¾è¡¨åå«ä»£è¡¨äºè¿ç»­ç©ºé´åä¸è¿ç»­ç©ºé´çå­å¨æ¹å¼ï¼å®ä»¬æ¯çº¿æ§è¡¨ï¼linear listï¼çå¸åä»£è¡¨ãå¶ä»ææçæ°æ®ç»æï¼æ¯å¦æ ãéåãäºåæ ãb+ æ ç­ï¼å®éä¸é½æ¯è¿ä¸¤èçç»ååååã\n\næ°ç»ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ãæ°ç»æ¯æéæºè®¿é®ï¼æ ¹æ®ä¸æ éæºè®¿é®çæ¶é´å¤æåº¦ä¸º o(1)ãä½è¿å¹¶ä¸ä»£è¡¨æ°ç»çæ¥æ¾æ¶é´å¤æåº¦ä¹æ¯ o(1)ã\n\n * å¯¹äºæ åºæ°ç»ï¼åªè½é¡ºåºæ¥æ¾ï¼å¶æ¶é´å¤æåº¦ä¸º o(n)ã\n * å¯¹äºæåºæ°ç»ï¼å¯ä»¥åºç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º o(log n)ã\n\nå¨æåºæ°ç»ä¸åºç¨äºåæ¥æ¾æ³å¦æ­¤é«æï¼ä¸ºä»ä¹å ä¹æ²¡ææ°æ®åºç´æ¥ä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼è¿æ¯å ä¸ºå®çéå¶æ¡ä»¶ï¼æ°æ®æåºââä¸ºäºä¿è¯æ°æ®æåºï¼æ¯æ¬¡æ·»å ãå é¤æ°ç»æ°æ®æ¶ï¼é½å¿é¡»è¦è¿è¡æ°æ®è°æ´ï¼æ¥ä¿è¯å¶æåºï¼è æ°ç»çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º o(n)ãæ­¤å¤ï¼ç±äºæ°ç»ç©ºé´å¤§å°åºå®ï¼æ¯æ¬¡æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ãæ°ç»çè¿äºç¹æ§ï¼å³å®äºå®ä¸éåç¨äºæ°æ®é¢ç¹ååçåºç¨åºæ¯ã\n\n\n\né¾è¡¨ç¨ä¸è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶éè¿ä¸ä¸ªæéæé¡ºåºå°è¿äºç©ºé´ä¸²èµ·æ¥ï¼å½¢æä¸æ¡é¾ã\n\nåºå«äºæ°ç»ï¼é¾è¡¨ä¸­çåç´ ä¸æ¯å­å¨å¨åå­ä¸­è¿ç»­çä¸çåºåï¼é¾è¡¨ä¸­çæ°æ®å­å¨å¨æ¯ä¸ä¸ªç§°ä¹ä¸ºãç»ç¹ãå¤ååºåéï¼å¨æ¯ä¸ä¸ªç»ç¹é¤äºå­å¨æ°æ®ä»¥å¤ï¼è¿ä¿å­äºå°ä¸ä¸ä¸ªèç¹çæéï¼pointerï¼ãç±äºä¸å¿æé¡ºåºå­å¨ï¼é¾è¡¨çæå¥/å é¤æä½ï¼æ¶é´å¤æåº¦ä¸º o(1)ï¼ä½æ¯ï¼é¾è¡¨åªæ¯æé¡ºåºè®¿é®ï¼å¶ æ¥æ¾æ¶é´å¤æåº¦ä¸º o(n)ãå¶ä½æçæ¥æ¾æ¹å¼ï¼å³å®äºé¾è¡¨ä¸éåä½ä¸ºç´¢å¼ã\n\n\n\n\n# åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ hash å½æ°å° key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ o(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (a,b) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãin()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ where price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èãä¾å¦ï¼mysql ä¸­ç memory å­å¨å¼æå°±æ¾ç¤ºçæ¯æåå¸ç´¢å¼ã\n\n\n# b-tree ç´¢å¼\n\néå¸¸æä»¬æè¯´ç b æ ç´¢å¼æ¯æ b-tree ç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨ b-tree è¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º mysql å¨ create table æå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ innodb ä½¿ç¨çæ¯ b+treeç´¢å¼ï¼è myisam ä½¿ç¨çæ¯ b-treeç´¢å¼ã\n\nb-tree ç´¢å¼ä¸­ç b æ¯æ balanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼b-tree ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ o(log n)ã\n\nå½ç¶ä¸ºäºç»´æ o(log n) çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ o(log n)ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç i/o æ¶èï¼ç¸å¯¹äºåå­å­åï¼i/o å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç i/o è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç i/o å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º n åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è b+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n\n# b+tree ç´¢å¼\n\nb+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£ b+treeï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçb+treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãinnodb çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº b æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ innodb éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from t where id=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ id è¿æ£µ b+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from t where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° id çå¼ä¸º 500ï¼åå° id ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ not null primary key auto_incrementãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ãè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n----------------------------------------\n\nåå­æ¯åå¯¼ä½åä»¶ãå¯¹äºåå­èè¨ï¼åªè¦ç»åºäºåå­å°åï¼æä»¬å°±å¯ä»¥ç´æ¥è®¿é®è¯¥å°åååºæ°æ®ãè¿ä¸ªè¿ç¨å·æé«æçéæºè®¿é®ç¹æ§ï¼å æ­¤åå­ä¹å«éæºè®¿é®å­å¨å¨ï¼random access memoryï¼å³ ramï¼ãåå­çè®¿é®éåº¦å¾å¿«ï¼ä½æ¯ä»·æ ¼ç¸å¯¹è¾æè´µï¼å æ­¤ä¸è¬çè®¡ç®æºåå­ç©ºé´é½ç¸å¯¹è¾å°ã\n\nèç£çæ¯æºæ¢°å¨ä»¶ãç£çè®¿é®æ°æ®æ¶ï¼éè¦ç­ç£çççæè½¬å°ç£å¤´ä¸ï¼æè½è¯»åç¸åºçæ°æ®ãå°½ç®¡ç£ççæè½¬éåº¦å¾å¿«ï¼ä½æ¯ååå­çéæºè®¿é®ç¸æ¯ï¼æ§è½å·®è·éå¸¸å¤§ãä¸è¬æ¥è¯´ï¼å¦ææ¯éæºè¯»åï¼ä¼æ 10 ä¸å° 100 ä¸åå·¦å³çå·®è·ãä½å¦ææ¯é¡ºåºè®¿é®å¤§æ¹éæ°æ®çè¯ï¼ç£ççæ§è½ååå­å°±æ¯ä¸ä¸ªæ°éçº§çã\n\nç£ççæå°è¯»ååä½æ¯æåºï¼è¾æ©æçç£çä¸ä¸ªæåºæ¯ 512 å­èãéçç£çææ¯çåå±ï¼ç®åå¸¸è§çç£çæåºæ¯ 4k ä¸ªå­èãæä½ç³»ç»ä¸æ¬¡ä¼è¯»åå¤ä¸ªæåºï¼æä»¥æä½ç³»ç»çæå°è¯»ååä½æ¯åï¼blockï¼ï¼ä¹å«ä½ç°ï¼clusterï¼ãå½æä»¬è¦ä»ç£çä¸­è¯»åä¸ä¸ªæ°æ®æ¶ï¼æä½ç³»ç»ä¼ä¸æ¬¡æ§å°æ´ä¸ªåé½è¯»åºæ¥ãå æ­¤ï¼å¯¹äºå¤§æ¹éçé¡ºåºè¯»åæ¥è¯´ï¼ç£ççæçä¼æ¯éæºè¯»åé«è®¸å¤ã\n\nåè®¾æä¸ä¸ªæåºæ°ç»å­å¨å¨ç¡¬çä¸­ï¼å¦æå®è¶³å¤å¤§ï¼é£ä¹å®ä¼å­å¨å¨å¤ä¸ªåä¸­ãå½æä»¬è¦å¯¹è¿ä¸ªæ°ç»ä½¿ç¨äºåæ¥æ¾æ¶ï¼éè¦åæ¾å°ä¸­é´åç´ æå¨çåï¼å°è¿ä¸ªåä»ç£çä¸­è¯»å°åå­éï¼ç¶åå¨åå­ä¸­è¿è¡äºåæ¥æ¾ãå¦æä¸ä¸æ­¥è¦è¯»çåç´ å¨å¶ä»åä¸­ï¼åéè¦åå°ç¸åºåä»ç£çä¸­è¯»å¥åå­ãç´å°æ¥è¯¢ç»æï¼è¿ä¸ªè¿ç¨å¯è½ä¼å¤æ¬¡è®¿é®ç£çãæä»¬å¯ä»¥çå°ï¼è¿æ ·çæ£ç´¢æ§è½éå¸¸ä½ã\n\nç±äºç£çç¸å¯¹äºåå­èè¨è®¿é®éåº¦å®å¨å¤ªæ¢ï¼å æ­¤ï¼å¯¹äºç£çä¸æ°æ®çé«ææ£ç´¢ï¼æä»¬æä¸ä¸ªæå¶éè¦çååï¼å¯¹ç£ççè®¿é®æ¬¡æ°è¦å°½å¯è½çå°ï¼\n\nå°ç´¢å¼åæ°æ®åç¦»å°±æ¯ä¸ç§å¸¸è§çè®¾è®¡æè·¯ãå¨æ°æ®é¢ç¹ååçåºæ¯ä¸­ï¼æåºæ°ç»å¹¶ä¸æ¯ä¸ä¸ªæå¥½çéæ©ï¼äºåæ£ç´¢æ æèåå¸è¡¨å¾å¾æ´ææ®éæ§ãä½æ¯ï¼åå¸è¡¨ç±äºç¼ºä¹èå´æ£ç´¢çè½åï¼å¨ä¸äºåºåä¹ä¸éç¨ãå æ­¤ï¼äºåæ£ç´¢æ è¿ç§æ å½¢ç»ææ¯è®¸å¤å¸¸è§æ£ç´¢ç³»ç»çå®æ½æ¹æ¡ã\n\néçç´¢å¼æ°æ®è¶æ¥è¶å¤§ï¼ç´å°æ æ³å®å¨å è½½å°åå­ä¸­ï¼è¿æ¯éè¦å°ç´¢å¼æ°æ®ä¹å­å¥ç£çä¸­ãb+ æ ç»åºäºå°æ å½¢ç´¢å¼çææèç¹é½å­å¨ç£çä¸çé«ææ£ç´¢æ¹æ¡ãæä½ç³»ç»å¯¹ç£çæ°æ®çè®¿é®æ¯ä»¥åä¸ºåä½çãå æ­¤ï¼å¦ææä»¬æ³å°æ åç´¢å¼çä¸ä¸ªèç¹ä»ç£çä¸­è¯»åºï¼å³ä½¿è¯¥èç¹çæ°æ®éå¾å°ï¼æ¯å¦è¯´åªæå ä¸ªå­èï¼ï¼ä½ç£çä¾ç¶ä¼å°æ´ä¸ªåçæ°æ®å¨é¨è¯»åºæ¥ï¼èä¸æ¯åªè¯»è¿ä¸å°é¨åæ°æ®ï¼è¿ä¼è®©ææè¯»åæçå¾ä½ãb+ æ çä¸ä¸ªå³é®è®¾è®¡ï¼å°±æ¯è®©ä¸ä¸ªèç¹çå¤§å°ç­äºä¸ä¸ªåçå¤§å°ãèç¹åå­å¨çæ°æ®ï¼ä¸æ¯ä¸ä¸ªåç´ ï¼èæ¯ä¸ä¸ªå¯ä»¥è£ m ä¸ªåç´ çæåºæ°ç»ãè¿æ ·ä¸æ¥ï¼æä»¬å°±å¯ä»¥å°ç£çä¸æ¬¡è¯»åçæ°æ®å¨é¨å©ç¨èµ·æ¥ï¼ä½¿å¾è¯»åæçæå¤§åã\n\nb+ æ è¿æå¦ä¸ä¸ªè®¾è®¡ï¼å°±æ¯å°ææçèç¹åä¸ºåé¨èç¹åå¶å­èç¹ãåé¨èç¹ä»å­å¨ key åç»´ææ å½¢ç»æçæéï¼å¹¶ä¸å­å¨ key å¯¹åºçæ°æ®ï¼æ è®ºæ¯å·ä½æ°æ®è¿æ¯æä»¶ä½ç½®ä¿¡æ¯ï¼ãè¿æ ·åé¨èç¹å°±è½å­å¨æ´å¤çç´¢å¼æ°æ®ï¼æä»¬ä¹å°±å¯ä»¥ä½¿ç¨æå°çåé¨èç¹ï¼å°æææ°æ®ç»ç»èµ·æ¥äºãèå¶å­èç¹ä»å­å¨ key åå¯¹åºæ°æ®ï¼ä¸å­å¨ç»´ææ å½¢ç»æçæéãéè¿è¿æ ·çè®¾è®¡ï¼b+ æ å°±è½åå°èç¹çç©ºé´å©ç¨çæå¤§åãæ­¤å¤ï¼b+ æ è¿å°åä¸å±çææèç¹ä¸²æäºæåºçååé¾è¡¨ï¼è¿æ ·ä¸æ¥ï¼b+ æ å°±åæ¶å·å¤äºè¯å¥½çèå´æ¥è¯¢è½ååçµæ´»è°æ´çè½åäºã\n\nå æ­¤ï¼b+ æ æ¯ä¸æ£µå®å¨å¹³è¡¡ç m é¶å¤åæ ãæè°ç m é¶ï¼æçæ¯æ¯ä¸ªèç¹æå¤æ m ä¸ªå­èç¹ï¼å¹¶ä¸æ¯ä¸ªèç¹éé½å­äºä¸ä¸ªç´§åçå¯åå« m ä¸ªåç´ çæ°ç»ã\n\nå³ä½¿æ¯å¤æç b+ æ ï¼æä»¬å°å®æè§£å¼æ¥ï¼å¶å®ä¹æ¯ç±ç®åçæ°ç»ãé¾è¡¨åæ ç»æçï¼èä¸ b+ æ çæ£ç´¢è¿ç¨å¶å®ä¹æ¯äºåæ¥æ¾ãå æ­¤ï¼å¦æ b+ æ å®å¨å è½½å¨åå­ä¸­çè¯ï¼å®çæ£ç´¢æçå¶å®å¹¶ä¸ä¼æ¯æåºæ°ç»æèäºåæ£ç´¢æ æ´ é«ï¼ä¹è¿æ¯äºåæ¥æ¾ç log(n) çæçãå¹¶ä¸ï¼å®è¿æ¯æ°ç»åäºåæ£ç´¢æ æ´å å¤æï¼è¿ä¼å¸¦æ¥é¢å¤çå¼éã\n\nå¦å¤ï¼è¿ä¸èè¿æä¸ä¸ªå¾éè¦çè®¾è®¡ææ³éè¦ä½ ææ¡ï¼é£å°±æ¯å°ç´¢å¼åæ°æ®åç¦»ãéè¿è¿æ ·çæ¹å¼ï¼æä»¬è½å°ç´¢å¼çæ°ç»å¤§å°ä¿æå¨ä¸ä¸ªè¾å°çèå´åï¼è®©å®è½å è½½å¨åå­ä¸­ãå¨è®¸å¤å¤§è§æ¨¡ç³»ç»ä¸­ï¼é½æ¯ä½¿ç¨è¿ä¸ªè®¾è®¡ææ³æ¥ç²¾ç®ç´¢å¼çãèä¸ï¼b+ æ çåé¨èç¹åå¶å­èç¹çåºåï¼å¶å®ä¹æ¯ç´¢å¼åæ°æ®åç¦»çä¸æ¬¡å®è·µã\n\nmysql ä¸­ç b+ æ å®ç°å¶å®æä¸¤ç§ï¼ä¸ç§æ¯ myisam å¼æï¼å¦ä¸ç§æ¯ innodb å¼æãå®ä»¬çæ ¸å¿åºå«å°±å¨äºï¼æ°æ®åç´¢å¼æ¯å¦æ¯åç¦»çã\n\nå¨ myisam å¼æä¸­ï¼b+ æ çå¶å­èç¹ä»å­å¨äºæ°æ®çä½ç½®æéï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®åç¦»çè®¾è®¡æ¹æ¡ï¼å«ä½éèéç´¢å¼ãå¦æè¦ä¿è¯ myisam çæ°æ®ä¸è´æ§ï¼é£æä»¬éè¦å¨è¡¨çº§å«ä¸è¿è¡å éå¤çã\n\nå¨ innodb ä¸­ï¼b+ æ çå¶å­èç¹ç´æ¥å­å¨äºå·ä½æ°æ®ï¼è¿æ¯ä¸ç§ç´¢å¼åæ°æ®ä¸ä½çæ¹æ¡ãå«ä½èéç´¢å¼ãç±äºæ°æ®ç´æ¥å°±å­å¨ç´¢å¼çå¶å­èç¹ä¸­ï¼å æ­¤ innodb ä¸éè¦ç»å¨è¡¨å éæ¥ä¿è¯ä¸è´æ§ï¼å®åªéè¦æ¯æè¡çº§çéå°±å¯ä»¥äºã\n\n\n# lsm æ \n\nb+ æ çæ°æ®é½å­å¨å¨å¶å­èç¹ä¸­ï¼èå¶å­èç¹ä¸è¬é½å­å¨å¨ç£çä¸­ãå æ­¤ï¼æ¯æ¬¡æå¥çæ°æ°æ®é½éè¦éæºåå¥ç£çï¼èéæºåå¥çæ§è½éå¸¸æ¢ãå¦ææ¯ä¸ä¸ªæ¥å¿ç³»ç»ï¼æ¯ç§éè¦åå¥ä¸åæ¡çè³ä¸ä¸æ¡æ°æ®ï¼è¿æ ·çç£çæä½ä»£ä»·ä¼ä½¿å¾ç³»ç»æ§è½æ¥å§ä¸éï¼çè³æ æ³ä½¿ç¨ã\n\næä½ç³»ç»å¯¹ç£ççè¯»åæ¯ä»¥åä¸ºåä½çï¼æä»¬è½å¦ä»¥åä¸ºåä½åå¥ï¼èä¸æ¯æ¯æ¬¡æå¥ä¸ä¸ªæ°æ®é½è¦éæºåå¥ç£çå¢ï¼è¿æ ·æ¯ä¸æ¯å°±å¯ä»¥å¤§å¹åº¦åå°åå¥æä½äºå¢ï¼è§£å³æ¹æ¡å°±æ¯ï¼lsm æ ï¼log structured merge treesï¼ã\n\nlsm æ å°±æ¯æ ¹æ®è¿ä¸ªæè·¯è®¾è®¡äºè¿æ ·ä¸ä¸ªæºå¶ï¼å½æ°æ®åå¥æ¶ï¼å»¶è¿åç£çï¼å°æ°æ®åå­æ¾å¨åå­ä¸­çæ éï¼è¿è¡å¸¸è§çå­å¨åæ¥è¯¢ãå½åå­ä¸­çæ æç»­åå¤§è¾¾å°éå¼æ¶ï¼åæ¹éå°ä»¥åä¸ºåä½åå¥ç£ççæ ä¸­ãå æ­¤ï¼lsm æ è³å°éè¦ç±ä¸¤æ£µæ ç»æï¼ä¸æ£µæ¯å­å¨å¨åå­ä¸­è¾å°ç c0 æ ï¼å¦ä¸æ£µæ¯å­å¨å¨ç£çä¸­è¾å¤§ç c1 æ ã\n\nlsm æ å·æä»¥ä¸ 3 ä¸ªç¹ç¹ï¼\n\n 1. å°ç´¢å¼åä¸ºåå­åç£çä¸¤é¨åï¼å¹¶å¨åå­è¾¾å°éå¼æ¶å¯å¨æ åå¹¶ï¼merge treesï¼ï¼\n 2. ç¨æ¹éåå¥ä»£æ¿éæºåå¥ï¼å¹¶ä¸ç¨é¢åæ¥å¿ wal ææ¯ï¼write aheadlogï¼é¢åæ¥å¿ææ¯ï¼ä¿è¯åå­æ°æ®ï¼å¨ç³»ç»å´©æºåå¯ä»¥è¢«æ¢å¤ï¼\n 3. æ°æ®éåç±»ä¼¼æ¥å¿è¿½å åçæ¹å¼åå¥ï¼log structuredï¼ç£çï¼ä»¥é¡ºåºåçæ¹å¼æé«å å¥æçã\n\nlsm æ çè¿äºç¹ç¹ï¼ä½¿å¾å®ç¸å¯¹äº b+ æ ï¼å¨åå¥æ§è½ä¸æå¤§å¹æåãæä»¥ï¼è®¸å¤ nosql ç³»ç»é½ä½¿ç¨ lsm æ ä½ä¸ºæ£ç´¢å¼æï¼èä¸è¿å¯¹ lsm æ è¿è¡äºä¼åä»¥æåæ£ç´¢æ§è½ã\n\n\n# åæç´¢å¼\n\nåæç´¢å¼çæ ¸å¿å¶å®å¹¶ä¸å¤æï¼å®çå·ä½å®ç°å¶å®æ¯åå¸è¡¨ï¼åªæ¯å®ä¸æ¯å°ææ¡£ id æèé¢ç®ä½ä¸º keyï¼èæ¯åè¿æ¥ï¼éè¿å°åå®¹æèå±æ§ä½ä¸º key æ¥å­å¨å¯¹åºçææ¡£åè¡¨ï¼ä½¿å¾æä»¬è½å¨ o(1) çæ¶é´ä»£ä»·åå®ææ¥è¯¢ã\n\nå°½ç®¡åçå¹¶ä¸å¤æï¼ä½æ¯åæç´¢å¼æ¯è®¸å¤æ£ç´¢å¼æçæ ¸å¿ãæ¯å¦è¯´ï¼æ°æ®åºçå¨æç´¢å¼åè½ãæç´¢å¼æçç´¢å¼ãå¹¿åå¼æåæ¨èå¼æï¼é½ä½¿ç¨äºåæç´¢å¼ææ¯æ¥å®ç°æ£ç´¢åè½ã\n\n\n# ç´¢å¼çç»´æ¤\n\n\n# åå»ºç´¢å¼\n\n * æ°æ®åç¼©ï¼ä¸ä¸ªæ¯å°½å¯è½å°å°æ°æ®å è½½å°åå­ä¸­ï¼å ä¸ºåå­çæ£ç´¢æçå¤§å¤§é«äºç£çãé£ä¸ºäºå°æ°æ®æ´å¤å°å è½½å°åå­ä¸­ï¼ç´¢å¼åç¼©æ¯ä¸ä¸ªéè¦çç ç©¶æ¹åã\n * åæ¯å¤çï¼å¦ä¸ä¸ªæ¯å°å¤§æ°æ®éåææå¤ä¸ªå°æ°æ®éåæ¥å¤çãè¿å¶å®å°±æ¯åå¸å¼ç³»ç»çæ ¸å¿ææ³ã\n\n\n# æ´æ°ç´¢å¼\n\nï¼1ï¼double bufferï¼åç¼å²ï¼æºå¶\n\nå°±æ¯å¨åå­ä¸­åæ¶ä¿å­ä¸¤ä»½ä¸æ ·çç´¢å¼ï¼ä¸ä¸ªæ¯ç´¢å¼ aï¼ä¸ä¸ªæ¯ç´¢å¼ bãä¸¤ä¸ªç´¢å¼ä¿æä¸ä¸ªè¯»ãä¸ä¸ªåï¼å¹¶ä¸æ¥ååæ¢ï¼æç»å®æé«æ§è½çç´¢å¼æ´æ°ã\n\nä¼ç¹ï¼ç®åé«æ\n\nç¼ºç¹ï¼è¾¾å°ä¸å®æ°æ®éçº§åï¼ä¼å¸¦æ¥ç¿»åçåå­å¼éï¼çè³æäºç´¢å¼å­å¨å¨ç£çä¸çæåµä¸ï¼æ´æ¯æ æ³ä½¿ç¨æ­¤æºå¶ã\n\nï¼2ï¼å¨éç´¢å¼åå¢éç´¢å¼\n\nå°æ°æ¥æ¶å°çæ°æ®åç¬å»ºç«ä¸ä¸ªå¯ä»¥å­å¨åå­ä¸­çåæç´¢å¼ï¼ä¹å°±æ¯å¢éç´¢å¼ãå½æ¥è¯¢åççæ¶åï¼æä»¬ä¼åæ¶æ¥è¯¢å¨éç´¢å¼åå¢éç´¢å¼ï¼å°åå¹¶çç»æä½ä¸ºæ»çç»æè¾åºã\n\nå ä¸ºå¢éç´¢å¼ç¸å¯¹å¨éç´¢å¼èè¨ä¼å°å¾å¤ï¼åå­èµæºæ¶èå¨å¯æ¿åèå´ï¼æä»¥æä»¬å¯ä»¥ä½¿ç¨ double buffer æºå¶ å¯¹å¢éç´¢å¼è¿è¡ç´¢å¼æ´æ°ãè¿æ ·ä¸æ¥ï¼å¢éç´¢å¼å°±å¯ä»¥åå°æ éè®¿é®ãèå¨éç´¢å¼æ¬èº«å°±æ¯åªè¯»çï¼ä¹ä¸éè¦å éãå æ­¤ï¼æ´ä¸ªæ£ç´¢è¿ç¨é½å¯ä»¥åå°æ éè®¿é®ï¼ä¹å°±æé«äºç³»ç»çæ£ç´¢æçã\n\n\n# åèèµæ\n\n * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã\n * æ°æ®ç»æä¸ç®æ³ä¹ç¾\n * æ£ç´¢ææ¯æ ¸å¿ 20 è®²\n * data structures for databases\n * data structures and algorithms for big databases",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"æ°æ®åºç»¼å",frontmatter:{title:"æ°æ®åºç»¼å",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æ°æ®åºç»¼å"],tags:["æ°æ®åº","ç»¼å"],permalink:"/pages/6ed13e/"},regularPath:"/01.%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%BC%E5%90%88/",relativePath:"01.æ°æ®åºç»¼å/README.md",key:"v-2c1319b3",path:"/pages/6ed13e/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:12},{level:3,title:"åå¸å¼å­å¨åç",slug:"åå¸å¼å­å¨åç",normalizedTitle:"åå¸å¼å­å¨åç",charIndex:22},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:521},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:557},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:567}],headersStr:"ð åå®¹ åå¸å¼å­å¨åç å¶ä» ð èµæ ðª ä¼ é",content:"# æ°æ®åºç»¼å\n\n\n# ð åå®¹\n\n\n# åå¸å¼å­å¨åç\n\n * åå¸å¼ç®ä»\n * åå¸å¼åºç¡çè®º - å³é®è¯ï¼æå åº­å°åãCAPãBASE\n * åå¸å¼ç®æ³ Paxos - å³é®è¯ï¼å±è¯æ§ç®æ³\n * åå¸å¼ç®æ³ Raft - å³é®è¯ï¼å±è¯æ§ç®æ³\n * è´è½½åè¡¡ - å³é®è¯ï¼è½®è¯¢ãéæºãæå°è¿æ¥ãæºå°ååå¸ãä¸è´æ§åå¸ãèæ hash æ§½\n * æ¶æ¯éå - å³é®è¯ï¼éå¤æ¶è´¹ãæ¶æ¯ä¸¢å¤±ãæ¶æ¯é¡ºåºæ§ãæ¶æ¯ç§¯å\n * åå¸å¼å­å¨ - å³é®è¯ï¼è¯»ååç¦»ãååºåè¡¨ãè¿ç§»ãæ©å®¹\n * åå¸å¼ç¼å­ - å³é®è¯ï¼è¿ç¨åç¼å­ãåå¸å¼ç¼å­ãç¼å­éªå´©ãç¼å­ç©¿éãç¼å­å»ç©¿ãç¼å­æ´æ°ãç¼å­é¢ç­ãç¼å­éçº§\n * åå¸å¼é - å³é®è¯ï¼æ°æ®åºãRedisãZooKeeperãäºæ¥ãå¯éå¥ãæ­»éãå®¹éãèªæå°è¯\n * åå¸å¼ ID - å³é®è¯ï¼UUIDãèªå¢åºåãéªè±ç®æ³ãLeaf\n * åå¸å¼äºå¡ - å³é®è¯ï¼2PCã3PCãTCCãæ¬å°æ¶æ¯è¡¨ãMQ æ¶æ¯ãSAGA\n * åå¸å¼ä¼è¯ - å³é®è¯ï¼ç²æ§ SessionãSession å¤å¶å±äº«ãåºäºç¼å­ç session å±äº«\n * æµéæ§å¶ - å³é®è¯ï¼è®¡æ°å¨æ³ãæ¶é´çªå£æ³ãä»¤çæ¡¶æ³ãæ¼æ¡¶æ³\n\n\n# å¶ä»\n\n * Nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# æ°æ®åºç»¼å\n\n\n# ð åå®¹\n\n\n# åå¸å¼å­å¨åç\n\n * åå¸å¼ç®ä»\n * åå¸å¼åºç¡çè®º - å³é®è¯ï¼æå åº­å°åãcapãbase\n * åå¸å¼ç®æ³ paxos - å³é®è¯ï¼å±è¯æ§ç®æ³\n * åå¸å¼ç®æ³ raft - å³é®è¯ï¼å±è¯æ§ç®æ³\n * è´è½½åè¡¡ - å³é®è¯ï¼è½®è¯¢ãéæºãæå°è¿æ¥ãæºå°ååå¸ãä¸è´æ§åå¸ãèæ hash æ§½\n * æ¶æ¯éå - å³é®è¯ï¼éå¤æ¶è´¹ãæ¶æ¯ä¸¢å¤±ãæ¶æ¯é¡ºåºæ§ãæ¶æ¯ç§¯å\n * åå¸å¼å­å¨ - å³é®è¯ï¼è¯»ååç¦»ãååºåè¡¨ãè¿ç§»ãæ©å®¹\n * åå¸å¼ç¼å­ - å³é®è¯ï¼è¿ç¨åç¼å­ãåå¸å¼ç¼å­ãç¼å­éªå´©ãç¼å­ç©¿éãç¼å­å»ç©¿ãç¼å­æ´æ°ãç¼å­é¢ç­ãç¼å­éçº§\n * åå¸å¼é - å³é®è¯ï¼æ°æ®åºãredisãzookeeperãäºæ¥ãå¯éå¥ãæ­»éãå®¹éãèªæå°è¯\n * åå¸å¼ id - å³é®è¯ï¼uuidãèªå¢åºåãéªè±ç®æ³ãleaf\n * åå¸å¼äºå¡ - å³é®è¯ï¼2pcã3pcãtccãæ¬å°æ¶æ¯è¡¨ãmq æ¶æ¯ãsaga\n * åå¸å¼ä¼è¯ - å³é®è¯ï¼ç²æ§ sessionãsession å¤å¶å±äº«ãåºäºç¼å­ç session å±äº«\n * æµéæ§å¶ - å³é®è¯ï¼è®¡æ°å¨æ³ãæ¶é´çªå£æ³ãä»¤çæ¡¶æ³ãæ¼æ¡¶æ³\n\n\n# å¶ä»\n\n * nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"ShardingSphere ç®ä»",frontmatter:{title:"ShardingSphere ç®ä»",date:"2020-10-08T20:30:30.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶"],tags:["æ°æ®åº","ä¸­é´ä»¶","ååºåè¡¨"],permalink:"/pages/560051/"},regularPath:"/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/01.Shardingsphere/01.ShardingSphere%E7%AE%80%E4%BB%8B.html",relativePath:"02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/01.ShardingSphereç®ä».md",key:"v-cd9e182e",path:"/pages/560051/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:17},{level:3,title:"ShardingSphere ç»ä»¶",slug:"shardingsphere-ç»ä»¶",normalizedTitle:"shardingsphere ç»ä»¶",charIndex:31},{level:4,title:"ShardingSphere-JDBC",slug:"shardingsphere-jdbc",normalizedTitle:"shardingsphere-jdbc",charIndex:230},{level:4,title:"Sharding-Proxy",slug:"sharding-proxy",normalizedTitle:"sharding-proxy",charIndex:108},{level:4,title:"Sharding-Sidecarï¼TODOï¼",slug:"sharding-sidecar-todo",normalizedTitle:"sharding-sidecarï¼todoï¼",charIndex:875},{level:4,title:"æ··åæ¶æ",slug:"æ··åæ¶æ",normalizedTitle:"æ··åæ¶æ",charIndex:1555},{level:3,title:"åè½åè¡¨",slug:"åè½åè¡¨",normalizedTitle:"åè½åè¡¨",charIndex:1846},{level:4,title:"æ°æ®åç",slug:"æ°æ®åç",normalizedTitle:"æ°æ®åç",charIndex:171},{level:4,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡",normalizedTitle:"åå¸å¼äºå¡",charIndex:176},{level:4,title:"æ°æ®åºæ²»ç",slug:"æ°æ®åºæ²»ç",normalizedTitle:"æ°æ®åºæ²»ç",charIndex:182},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1994}],headersStr:"ç®ä» ShardingSphere ç»ä»¶ ShardingSphere-JDBC Sharding-Proxy Sharding-Sidecarï¼TODOï¼ æ··åæ¶æ åè½åè¡¨ æ°æ®åç åå¸å¼äºå¡ æ°æ®åºæ²»ç åèèµæ",content:"# ShardingSphere ç®ä»\n\n\n# ç®ä»\n\n\n# ShardingSphere ç»ä»¶\n\nShardingSphere æ¯ä¸å¥å¼æºçåå¸å¼æ°æ®åºä¸­é´ä»¶è§£å³æ¹æ¡ç»æççæåï¼å®ç± Sharding-JDBCãSharding-Proxy å Sharding-Sidecarï¼è®¡åä¸­ï¼è¿ 3 æ¬¾ç¸äºç¬ç«çäº§åç»æã ä»ä»¬åæä¾æ ååçæ°æ®åçãåå¸å¼äºå¡åæ°æ®åºæ²»çåè½ï¼å¯éç¨äºå¦ Java åæãå¼æè¯­è¨ãäºåçç­åç§å¤æ ·åçåºç¨åºæ¯ã\n\n\n\n# ShardingSphere-JDBC\n\nå®ä½ä¸ºè½»éçº§ Java æ¡æ¶ï¼å¨ Java ç JDBC å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç JDBC é©±å¨ï¼å®å¨å¼å®¹ JDBC ååç§ ORM æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº JDBC ç ORM æ¡æ¶ï¼å¦ï¼JPA, Hibernate, Mybatis, Spring JDBC Template æç´æ¥ä½¿ç¨ JDBCã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼DBCP, C3P0, BoneCP, Druid, HikariCP ç­ã\n * æ¯æä»»æå®ç° JDBC è§èçæ°æ®åºï¼ç®åæ¯æ MySQLï¼Oracleï¼SQLServerï¼PostgreSQL ä»¥åä»»ä½éµå¾ª SQL92 æ åçæ°æ®åºã\n\n\n\n# Sharding-Proxy\n\nå®ä½ä¸ºéæåçæ°æ®åºä»£çç«¯ï¼æä¾å°è£äºæ°æ®åºäºè¿å¶åè®®çæå¡ç«¯çæ¬ï¼ç¨äºå®æå¯¹å¼æè¯­è¨çæ¯æã ç®åæä¾ MySQL å PostgreSQL çæ¬ï¼å®å¯ä»¥ä½¿ç¨ä»»ä½å¼å®¹ MySQL/PostgreSQL åè®®çè®¿é®å®¢æ·ç«¯(å¦ï¼MySQL Command Client, MySQL Workbench, Navicat ç­)æä½æ°æ®ï¼å¯¹ DBA æ´å åå¥½ã\n\n * ååºç¨ç¨åºå®å¨éæï¼å¯ç´æ¥å½å MySQL/PostgreSQL ä½¿ç¨ã\n * éç¨äºä»»ä½å¼å®¹ MySQL/PostgreSQL åè®®ççå®¢æ·ç«¯ã\n\n\n\n# Sharding-Sidecarï¼TODOï¼\n\nå®ä½ä¸º Kubernetes çäºåçæ°æ®åºä»£çï¼ä»¥ Sidecar çå½¢å¼ä»£çææå¯¹æ°æ®åºçè®¿é®ã éè¿æ ä¸­å¿ãé¶ä¾µå¥çæ¹æ¡æä¾ä¸æ°æ®åºäº¤äºççå®åå±ï¼å³ Database Meshï¼åå¯ç§°æ°æ®åºç½æ ¼ã\n\nDatabase Mesh çå³æ³¨éç¹å¨äºå¦ä½å°åå¸å¼çæ°æ®è®¿é®åºç¨ä¸æ°æ®åºææºä¸²èèµ·æ¥ï¼å®æ´å å³æ³¨çæ¯äº¤äºï¼æ¯å°æä¹±æ ç« çåºç¨ä¸æ°æ®åºä¹é´çäº¤äºè¿è¡ææå°æ¢³çã ä½¿ç¨ Database Meshï¼è®¿é®æ°æ®åºçåºç¨åæ°æ®åºç»å°å½¢æä¸ä¸ªå·¨å¤§çç½æ ¼ä½ç³»ï¼åºç¨åæ°æ®åºåªéå¨ç½æ ¼ä½ç³»ä¸­å¯¹å·å¥åº§å³å¯ï¼å®ä»¬é½æ¯è¢«å®åå±ææ²»ççå¯¹è±¡ã\n\n\n\nSHARDING-JDBC   SHARDING-PROXY   SHARDING-SIDECAR   \næ°æ®åº             ä»»æ               MySQL              MySQL\nè¿æ¥æ¶èæ°           é«                ä½                  é«\nå¼æè¯­è¨            ä» Java           ä»»æ                 ä»»æ\næ§è½              æèä½              æèç¥é«               æèä½\næ ä¸­å¿å            æ¯                å¦                  æ¯\néæå¥å£            æ                 æ                  æ \n\n# æ··åæ¶æ\n\nShardingSphere-JDBC éç¨æ ä¸­å¿åæ¶æï¼éç¨äº Java å¼åçé«æ§è½çè½»éçº§ OLTP åºç¨ï¼ShardingSphere-Proxy æä¾éæå¥å£ä»¥åå¼æè¯­è¨çæ¯æï¼éç¨äº OLAP åºç¨ä»¥åå¯¹åçæ°æ®åºè¿è¡ç®¡çåè¿ç»´çåºæ¯ã\n\nApache ShardingSphere æ¯å¤æ¥å¥ç«¯å±åç»æççæåã éè¿æ··åä½¿ç¨ ShardingSphere-JDBC å ShardingSphere-Proxyï¼å¹¶éç¨åä¸æ³¨åä¸­å¿ç»ä¸éç½®åçç­ç¥ï¼è½å¤çµæ´»çæ­å»ºéç¨äºåç§åºæ¯çåºç¨ç³»ç»ï¼ä½¿å¾æ¶æå¸æ´å èªç±å°è°æ´éåä¸å½åä¸å¡çæä½³ç³»ç»æ¶æã\n\n\n\n\n# åè½åè¡¨\n\n# æ°æ®åç\n\n * ååº & åè¡¨\n * è¯»ååç¦»\n * åçç­ç¥å®å¶å\n * æ ä¸­å¿ååå¸å¼ä¸»é®\n\n# åå¸å¼äºå¡\n\n * æ ååäºå¡æ¥å£\n * XA å¼ºä¸è´äºå¡\n * ææ§äºå¡\n\n# æ°æ®åºæ²»ç\n\n * åå¸å¼æ²»ç\n * å¼¹æ§ä¼¸ç¼©\n * å¯è§åé¾è·¯è¿½è¸ª\n * æ°æ®å å¯\n\n\n# åèèµæ\n\n * shardingsphere Github\n * shardingsphere å®æ¹ææ¡£",normalizedContent:"# shardingsphere ç®ä»\n\n\n# ç®ä»\n\n\n# shardingsphere ç»ä»¶\n\nshardingsphere æ¯ä¸å¥å¼æºçåå¸å¼æ°æ®åºä¸­é´ä»¶è§£å³æ¹æ¡ç»æççæåï¼å®ç± sharding-jdbcãsharding-proxy å sharding-sidecarï¼è®¡åä¸­ï¼è¿ 3 æ¬¾ç¸äºç¬ç«çäº§åç»æã ä»ä»¬åæä¾æ ååçæ°æ®åçãåå¸å¼äºå¡åæ°æ®åºæ²»çåè½ï¼å¯éç¨äºå¦ java åæãå¼æè¯­è¨ãäºåçç­åç§å¤æ ·åçåºç¨åºæ¯ã\n\n\n\n# shardingsphere-jdbc\n\nå®ä½ä¸ºè½»éçº§ java æ¡æ¶ï¼å¨ java ç jdbc å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç jdbc é©±å¨ï¼å®å¨å¼å®¹ jdbc ååç§ orm æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº jdbc ç orm æ¡æ¶ï¼å¦ï¼jpa, hibernate, mybatis, spring jdbc template æç´æ¥ä½¿ç¨ jdbcã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼dbcp, c3p0, bonecp, druid, hikaricp ç­ã\n * æ¯æä»»æå®ç° jdbc è§èçæ°æ®åºï¼ç®åæ¯æ mysqlï¼oracleï¼sqlserverï¼postgresql ä»¥åä»»ä½éµå¾ª sql92 æ åçæ°æ®åºã\n\n\n\n# sharding-proxy\n\nå®ä½ä¸ºéæåçæ°æ®åºä»£çç«¯ï¼æä¾å°è£äºæ°æ®åºäºè¿å¶åè®®çæå¡ç«¯çæ¬ï¼ç¨äºå®æå¯¹å¼æè¯­è¨çæ¯æã ç®åæä¾ mysql å postgresql çæ¬ï¼å®å¯ä»¥ä½¿ç¨ä»»ä½å¼å®¹ mysql/postgresql åè®®çè®¿é®å®¢æ·ç«¯(å¦ï¼mysql command client, mysql workbench, navicat ç­)æä½æ°æ®ï¼å¯¹ dba æ´å åå¥½ã\n\n * ååºç¨ç¨åºå®å¨éæï¼å¯ç´æ¥å½å mysql/postgresql ä½¿ç¨ã\n * éç¨äºä»»ä½å¼å®¹ mysql/postgresql åè®®ççå®¢æ·ç«¯ã\n\n\n\n# sharding-sidecarï¼todoï¼\n\nå®ä½ä¸º kubernetes çäºåçæ°æ®åºä»£çï¼ä»¥ sidecar çå½¢å¼ä»£çææå¯¹æ°æ®åºçè®¿é®ã éè¿æ ä¸­å¿ãé¶ä¾µå¥çæ¹æ¡æä¾ä¸æ°æ®åºäº¤äºççå®åå±ï¼å³ database meshï¼åå¯ç§°æ°æ®åºç½æ ¼ã\n\ndatabase mesh çå³æ³¨éç¹å¨äºå¦ä½å°åå¸å¼çæ°æ®è®¿é®åºç¨ä¸æ°æ®åºææºä¸²èèµ·æ¥ï¼å®æ´å å³æ³¨çæ¯äº¤äºï¼æ¯å°æä¹±æ ç« çåºç¨ä¸æ°æ®åºä¹é´çäº¤äºè¿è¡ææå°æ¢³çã ä½¿ç¨ database meshï¼è®¿é®æ°æ®åºçåºç¨åæ°æ®åºç»å°å½¢æä¸ä¸ªå·¨å¤§çç½æ ¼ä½ç³»ï¼åºç¨åæ°æ®åºåªéå¨ç½æ ¼ä½ç³»ä¸­å¯¹å·å¥åº§å³å¯ï¼å®ä»¬é½æ¯è¢«å®åå±ææ²»ççå¯¹è±¡ã\n\n\n\nsharding-jdbc   sharding-proxy   sharding-sidecar   \næ°æ®åº             ä»»æ               mysql              mysql\nè¿æ¥æ¶èæ°           é«                ä½                  é«\nå¼æè¯­è¨            ä» java           ä»»æ                 ä»»æ\næ§è½              æèä½              æèç¥é«               æèä½\næ ä¸­å¿å            æ¯                å¦                  æ¯\néæå¥å£            æ                 æ                  æ \n\n# æ··åæ¶æ\n\nshardingsphere-jdbc éç¨æ ä¸­å¿åæ¶æï¼éç¨äº java å¼åçé«æ§è½çè½»éçº§ oltp åºç¨ï¼shardingsphere-proxy æä¾éæå¥å£ä»¥åå¼æè¯­è¨çæ¯æï¼éç¨äº olap åºç¨ä»¥åå¯¹åçæ°æ®åºè¿è¡ç®¡çåè¿ç»´çåºæ¯ã\n\napache shardingsphere æ¯å¤æ¥å¥ç«¯å±åç»æççæåã éè¿æ··åä½¿ç¨ shardingsphere-jdbc å shardingsphere-proxyï¼å¹¶éç¨åä¸æ³¨åä¸­å¿ç»ä¸éç½®åçç­ç¥ï¼è½å¤çµæ´»çæ­å»ºéç¨äºåç§åºæ¯çåºç¨ç³»ç»ï¼ä½¿å¾æ¶æå¸æ´å èªç±å°è°æ´éåä¸å½åä¸å¡çæä½³ç³»ç»æ¶æã\n\n\n\n\n# åè½åè¡¨\n\n# æ°æ®åç\n\n * ååº & åè¡¨\n * è¯»ååç¦»\n * åçç­ç¥å®å¶å\n * æ ä¸­å¿ååå¸å¼ä¸»é®\n\n# åå¸å¼äºå¡\n\n * æ ååäºå¡æ¥å£\n * xa å¼ºä¸è´äºå¡\n * ææ§äºå¡\n\n# æ°æ®åºæ²»ç\n\n * åå¸å¼æ²»ç\n * å¼¹æ§ä¼¸ç¼©\n * å¯è§åé¾è·¯è¿½è¸ª\n * æ°æ®å å¯\n\n\n# åèèµæ\n\n * shardingsphere github\n * shardingsphere å®æ¹ææ¡£",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"ShardingSphere Jdbc",frontmatter:{title:"ShardingSphere Jdbc",date:"2020-12-28T00:01:28.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶"],tags:["æ°æ®åº","ä¸­é´ä»¶","ååºåè¡¨"],permalink:"/pages/a9584d/"},regularPath:"/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/01.Shardingsphere/02.ShardingSphereJdbc.html",relativePath:"02.æ°æ®åºä¸­é´ä»¶/01.Shardingsphere/02.ShardingSphereJdbc.md",key:"v-722983de",path:"/pages/a9584d/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:26},{level:2,title:"å¿«éå¥é¨",slug:"å¿«éå¥é¨",normalizedTitle:"å¿«éå¥é¨",charIndex:397},{level:3,title:"å¼å¥ maven ä¾èµ",slug:"å¼å¥-maven-ä¾èµ",normalizedTitle:"å¼å¥ maven ä¾èµ",charIndex:406},{level:3,title:"è§åéç½®",slug:"è§åéç½®",normalizedTitle:"è§åéç½®",charIndex:647},{level:3,title:"åå»ºæ°æ®æº",slug:"åå»ºæ°æ®æº",normalizedTitle:"åå»ºæ°æ®æº",charIndex:767},{level:2,title:"æ¦å¿µååè½",slug:"æ¦å¿µååè½",normalizedTitle:"æ¦å¿µååè½",charIndex:1041},{level:3,title:"åç´åç",slug:"åç´åç",normalizedTitle:"åç´åç",charIndex:1646},{level:3,title:"æ°´å¹³åç",slug:"æ°´å¹³åç",normalizedTitle:"æ°´å¹³åç",charIndex:1651},{level:3,title:"æ°æ®åçå¸¦æ¥çé®é¢",slug:"æ°æ®åçå¸¦æ¥çé®é¢",normalizedTitle:"æ°æ®åçå¸¦æ¥çé®é¢",charIndex:2157},{level:2,title:"ShardingSphere åæ ¸åæ",slug:"shardingsphere-åæ ¸åæ",normalizedTitle:"shardingsphere åæ ¸åæ",charIndex:2419},{level:3,title:"è§£æå¼æ",slug:"è§£æå¼æ",normalizedTitle:"è§£æå¼æ",charIndex:2914},{level:4,title:"æ½è±¡è¯­æ³æ ",slug:"æ½è±¡è¯­æ³æ ",normalizedTitle:"æ½è±¡è¯­æ³æ ",charIndex:2922},{level:4,title:"SQL è§£æå¼æ",slug:"sql-è§£æå¼æ",normalizedTitle:"sql è§£æå¼æ",charIndex:3502},{level:3,title:"è·¯ç±å¼æ",slug:"è·¯ç±å¼æ",normalizedTitle:"è·¯ç±å¼æ",charIndex:4289},{level:3,title:"æ¹åå¼æ",slug:"æ¹åå¼æ",normalizedTitle:"æ¹åå¼æ",charIndex:4298},{level:3,title:"æ§è¡å¼æ",slug:"æ§è¡å¼æ",normalizedTitle:"æ§è¡å¼æ",charIndex:4307},{level:3,title:"å½å¹¶å¼æ",slug:"å½å¹¶å¼æ",normalizedTitle:"å½å¹¶å¼æ",charIndex:4316}],headersStr:"ç®ä» å¿«éå¥é¨ å¼å¥ maven ä¾èµ è§åéç½® åå»ºæ°æ®æº æ¦å¿µååè½ åç´åç æ°´å¹³åç æ°æ®åçå¸¦æ¥çé®é¢ ShardingSphere åæ ¸åæ è§£æå¼æ æ½è±¡è¯­æ³æ  SQL è§£æå¼æ è·¯ç±å¼æ æ¹åå¼æ æ§è¡å¼æ å½å¹¶å¼æ",content:"# ShardingSphere Jdbc\n\n\n# ç®ä»\n\nshardingsphere-jdbc å®ä½ä¸ºè½»éçº§ Java æ¡æ¶ï¼å¨ Java ç JDBC å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç JDBC é©±å¨ï¼å®å¨å¼å®¹ JDBC ååç§ ORM æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº JDBC ç ORM æ¡æ¶ï¼å¦ï¼JPA, Hibernate, Mybatis, Spring JDBC Template æç´æ¥ä½¿ç¨ JDBCã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼DBCP, C3P0, BoneCP, Druid, HikariCP ç­ã\n * æ¯æä»»æå®ç° JDBC è§èçæ°æ®åºï¼ç®åæ¯æ MySQLï¼Oracleï¼SQLServerï¼PostgreSQL ä»¥åä»»ä½éµå¾ª SQL92 æ åçæ°æ®åºã\n\n\n\n\n# å¿«éå¥é¨\n\n\n# å¼å¥ maven ä¾èµ\n\n<dependency>\n    <groupId>org.apache.shardingsphere</groupId>\n    <artifactId>shardingsphere-jdbc-core</artifactId>\n    <version>${latest.release.version}</version>\n</dependency>\n\n\næ³¨æï¼è¯·å° ${latest.release.version} æ´æ¹ä¸ºå®éççæ¬å·ã\n\n\n# è§åéç½®\n\nShardingSphere-JDBC å¯ä»¥éè¿ Javaï¼YAMLï¼Spring å½åç©ºé´å Spring Boot Starter è¿ 4 ç§æ¹å¼è¿è¡éç½®ï¼å¼åèå¯æ ¹æ®åºæ¯éæ©éåçéç½®æ¹å¼ã è¯¦æè¯·åè§éç½®æåã\n\n\n# åå»ºæ°æ®æº\n\néè¿ ShardingSphereDataSourceFactory å·¥ååè§åéç½®å¯¹è±¡è·å ShardingSphereDataSourceã è¯¥å¯¹è±¡å®ç°èª JDBC çæ å DataSource æ¥å£ï¼å¯ç¨äºåç JDBC å¼åï¼æä½¿ç¨ JPA, MyBatis ç­ ORM ç±»åºã\n\nDataSource dataSource = ShardingSphereDataSourceFactory.createDataSource(dataSourceMap, configurations, properties);\n\n\n\n# æ¦å¿µååè½\n\nåä¸æ°æ®èç¹é¾äºæ»¡è¶³äºèç½çæµ·éæ°æ®åºæ¯ã\n\nä»æ§è½æ¹é¢æ¥è¯´ï¼ç±äºå³ç³»åæ°æ®åºå¤§å¤éç¨ B+ æ ç±»åçç´¢å¼ï¼å¨æ°æ®éè¶è¿éå¼çæåµä¸ï¼ç´¢å¼æ·±åº¦çå¢å ä¹å°ä½¿å¾ç£çè®¿é®ç IO æ¬¡æ°å¢å ï¼è¿èå¯¼è´æ¥è¯¢æ§è½çä¸éï¼åæ¶ï¼é«å¹¶åè®¿é®è¯·æ±ä¹ä½¿å¾éä¸­å¼æ°æ®åºæä¸ºç³»ç»çæå¤§ç¶é¢ã\n\nå¨ä¼ ç»çå³ç³»åæ°æ®åºæ æ³æ»¡è¶³äºèç½åºæ¯éè¦çæåµä¸ï¼å°æ°æ®å­å¨è³åçæ¯æåå¸å¼ç NoSQL çå°è¯è¶æ¥è¶å¤ã ä½ NoSQL å¯¹ SQL çä¸å¼å®¹æ§ä»¥åçæåçä¸å®åï¼ä½¿å¾å®ä»¬å¨ä¸å³ç³»åæ°æ®åºçåå¼ä¸­å§ç»æ æ³å®æè´å½ä¸å»ï¼èå³ç³»åæ°æ®åºçå°ä½å´ä¾ç¶ä¸å¯æ¼å¨ã\n\næ°æ®åçææç§æä¸ªç»´åº¦å°å­æ¾å¨åä¸æ°æ®åºä¸­çæ°æ®åæ£å°å­æ¾è³å¤ä¸ªæ°æ®åºæè¡¨ä¸­ä»¥è¾¾å°æåæ§è½ç¶é¢ä»¥åå¯ç¨æ§çææãæ°æ®åççææææ®µæ¯å¯¹å³ç³»åæ°æ®åºè¿è¡ååºååè¡¨ãååºååè¡¨åå¯ä»¥ææçé¿åç±æ°æ®éè¶è¿å¯æ¿åéå¼èäº§ççæ¥è¯¢ç¶é¢ã é¤æ­¤ä¹å¤ï¼ååºè¿è½å¤ç¨äºææçåæ£å¯¹æ°æ®åºåç¹çè®¿é®éï¼åè¡¨è½ç¶æ æ³ç¼è§£æ°æ®åºååï¼ä½å´è½å¤æä¾å°½éå°åå¸å¼äºå¡è½¬åä¸ºæ¬å°äºå¡çå¯è½ï¼ä¸æ¦æ¶åå°è·¨åºçæ´æ°æä½ï¼åå¸å¼äºå¡å¾å¾ä¼ä½¿é®é¢åå¾å¤æã ä½¿ç¨å¤ä¸»å¤ä»çåçæ¹å¼ï¼å¯ä»¥ææçé¿åæ°æ®åç¹ï¼ä»èæåæ°æ®æ¶æçå¯ç¨æ§ã\n\néè¿ååºååè¡¨è¿è¡æ°æ®çæåæ¥ä½¿å¾åä¸ªè¡¨çæ°æ®éä¿æå¨éå¼ä»¥ä¸ï¼ä»¥åå¯¹æµéè¿è¡çå¯¼åºå¯¹é«è®¿é®éï¼æ¯åºå¯¹é«å¹¶ååæµ·éæ°æ®ç³»ç»çææææ®µã æ°æ®åççæåæ¹å¼ååä¸ºåç´åçåæ°´å¹³åçã\n\n\n# åç´åç\n\næç§ä¸å¡æåçæ¹å¼ç§°ä¸ºåç´åçï¼åç§°ä¸ºçºµåæåï¼å®çæ ¸å¿çå¿µæ¯ä¸åºä¸ç¨ã å¨æåä¹åï¼ä¸ä¸ªæ°æ®åºç±å¤ä¸ªæ°æ®è¡¨ææï¼æ¯ä¸ªè¡¨å¯¹åºçä¸åçä¸å¡ãèæåä¹åï¼åæ¯æç§ä¸å¡å°è¡¨è¿è¡å½ç±»ï¼åå¸å°ä¸åçæ°æ®åºä¸­ï¼ä»èå°åååæ£è³ä¸åçæ°æ®åºã ä¸å¾å±ç¤ºäºæ ¹æ®ä¸å¡éè¦ï¼å°ç¨æ·è¡¨åè®¢åè¡¨åç´åçå°ä¸åçæ°æ®åºçæ¹æ¡ã\n\n\n\nåç´åçå¾å¾éè¦å¯¹æ¶æåè®¾è®¡è¿è¡è°æ´ãéå¸¸æ¥è®²ï¼æ¯æ¥ä¸ååºå¯¹äºèç½ä¸å¡éæ±å¿«éååçï¼èä¸ï¼å®ä¹å¹¶æ æ³çæ­£çè§£å³åç¹ç¶é¢ã åç´æåå¯ä»¥ç¼è§£æ°æ®éåè®¿é®éå¸¦æ¥çé®é¢ï¼ä½æ æ³æ ¹æ²»ãå¦æåç´æåä¹åï¼è¡¨ä¸­çæ°æ®éä¾ç¶è¶è¿åèç¹æè½æ¿è½½çéå¼ï¼åéè¦æ°´å¹³åçæ¥è¿ä¸æ­¥å¤çã\n\n\n# æ°´å¹³åç\n\næ°´å¹³åçåç§°ä¸ºæ¨ªåæåã ç¸å¯¹äºåç´åçï¼å®ä¸åå°æ°æ®æ ¹æ®ä¸å¡é»è¾åç±»ï¼èæ¯éè¿æä¸ªå­æ®µï¼ææå ä¸ªå­æ®µï¼ï¼æ ¹æ®æç§è§åå°æ°æ®åæ£è³å¤ä¸ªåºæè¡¨ä¸­ï¼æ¯ä¸ªåçä»åå«æ°æ®çä¸é¨åã ä¾å¦ï¼æ ¹æ®ä¸»é®åçï¼å¶æ°ä¸»é®çè®°å½æ¾å¥ 0 åºï¼æè¡¨ï¼ï¼å¥æ°ä¸»é®çè®°å½æ¾å¥ 1 åºï¼æè¡¨ï¼ï¼å¦ä¸å¾æç¤ºã\n\n\n\næ°´å¹³åçä»çè®ºä¸çªç ´äºåæºæ°æ®éå¤ççç¶é¢ï¼å¹¶ä¸æ©å±ç¸å¯¹èªç±ï¼æ¯ååºåè¡¨çæ åè§£å³æ¹æ¡ã\n\n\n# æ°æ®åçå¸¦æ¥çé®é¢\n\n * æ°æ®è·¯ç±ï¼éè¦ç¥éæ°æ®éè¦ä»åªä¸ªå·ä½çæ°æ®åºçåè¡¨ä¸­è·åã\n * SQL ä¸å¼å®¹ï¼åè¡¨å¯¼è´è¡¨åç§°çä¿®æ¹ï¼æèåé¡µãæåºãèåãåç»ç­æä½çä¸æ­£ç¡®å¤çã\n * è·¨åºäºå¡ï¼åçéç¨åè¡¨ï¼å¯ä»¥å¨éä½åè¡¨æ°æ®éçæåµä¸ï¼å°½éä½¿ç¨æ¬å°äºå¡ï¼åäºä½¿ç¨ååºä¸åè¡¨å¯ææé¿ååå¸å¼äºå¡å¸¦æ¥çéº»ç¦ã å¨ä¸è½é¿åè·¨åºäºå¡çåºæ¯ï¼æäºä¸å¡ä»ç¶éè¦ä¿æäºå¡çä¸è´æ§ã èåºäº XA çåå¸å¼äºå¡ç±äºå¨å¹¶ååº¦é«çåºæ¯ä¸­æ§è½æ æ³æ»¡è¶³éè¦ï¼å¹¶æªè¢«äºèç½å·¨å¤´å¤§è§æ¨¡ä½¿ç¨ï¼ä»ä»¬å¤§å¤éç¨æç»ä¸è´æ§çææ§äºå¡ä»£æ¿å¼ºä¸è´äºå¡ã\n\n\n# ShardingSphere åæ ¸åæ\n\nShardingSphere ç 3 ä¸ªäº§åçæ°æ®åçä¸»è¦æµç¨æ¯å®å¨ä¸è´çã æ ¸å¿ç± SQL è§£æ => æ§è¡å¨ä¼å => SQL è·¯ç± => SQL æ¹å => SQL æ§è¡ => ç»æå½å¹¶çæµç¨ç»æã\n\n\n\n * QL è§£æï¼åä¸ºè¯æ³è§£æåè¯­æ³è§£æã åéè¿è¯æ³è§£æå¨å° SQL æåä¸ºä¸ä¸ªä¸ªä¸å¯ååçåè¯ãåä½¿ç¨è¯­æ³è§£æå¨å¯¹ SQL è¿è¡çè§£ï¼å¹¶æç»æç¼åºè§£æä¸ä¸æã è§£æä¸ä¸æåæ¬è¡¨ãéæ©é¡¹ãæåºé¡¹ãåç»é¡¹ãèåå½æ°ãåé¡µä¿¡æ¯ãæ¥è¯¢æ¡ä»¶ä»¥åå¯è½éè¦ä¿®æ¹çå ä½ç¬¦çæ è®°ã\n * æ§è¡å¨ä¼åï¼åå¹¶åä¼ååçæ¡ä»¶ï¼å¦ OR ç­ã\n * SQL è·¯ç±ï¼æ ¹æ®è§£æä¸ä¸æå¹éç¨æ·éç½®çåçç­ç¥ï¼å¹¶çæè·¯ç±è·¯å¾ãç®åæ¯æåçè·¯ç±åå¹¿æ­è·¯ç±ã\n * SQL æ¹åï¼å° SQL æ¹åä¸ºå¨çå®æ°æ®åºä¸­å¯ä»¥æ­£ç¡®æ§è¡çè¯­å¥ãSQL æ¹ååä¸ºæ­£ç¡®æ§æ¹ååä¼åæ¹åã\n * SQL æ§è¡ï¼éè¿å¤çº¿ç¨æ§è¡å¨å¼æ­¥æ§è¡ã\n * ç»æå½å¹¶ï¼å°å¤ä¸ªæ§è¡ç»æéå½å¹¶ä»¥ä¾¿äºéè¿ç»ä¸ç JDBC æ¥å£è¾åºãç»æå½å¹¶åæ¬æµå¼å½å¹¶ãåå­å½å¹¶åä½¿ç¨è£é¥°æ¨¡å¼çè¿½å å½å¹¶è¿å ç§æ¹å¼ã\n\n\n# è§£æå¼æ\n\n# æ½è±¡è¯­æ³æ \n\nè§£æè¿ç¨åä¸ºè¯æ³è§£æåè¯­æ³è§£æã è¯æ³è§£æå¨ç¨äºå° SQL æè§£ä¸ºä¸å¯ååçåå­ç¬¦å·ï¼ç§°ä¸º Tokenãå¹¶æ ¹æ®ä¸åæ°æ®åºæ¹è¨ææä¾çå­å¸ï¼å°å¶å½ç±»ä¸ºå³é®å­ï¼è¡¨è¾¾å¼ï¼å­é¢éåæä½ç¬¦ã åä½¿ç¨è¯­æ³è§£æå¨å° SQL è½¬æ¢ä¸ºæ½è±¡è¯­æ³æ ã\n\nä¾å¦ï¼ä»¥ä¸ SQLï¼\n\nSELECT id, name FROM t_user WHERE status = 'ACTIVE' AND age > 18\n\n\nè§£æä¹åçä¸ºæ½è±¡è¯­æ³æ è§ä¸å¾ã\n\n\n\nä¸ºäºä¾¿äºçè§£ï¼æ½è±¡è¯­æ³æ ä¸­çå³é®å­ç Token ç¨ç»¿è²è¡¨ç¤ºï¼åéç Token ç¨çº¢è²è¡¨ç¤ºï¼ç°è²è¡¨ç¤ºéè¦è¿ä¸æ­¥æåã\n\næåï¼éè¿å¯¹æ½è±¡è¯­æ³æ çéåå»æç¼åçæéçä¸ä¸æï¼å¹¶æ è®°æå¯è½éè¦æ¹åçä½ç½®ã ä¾åçä½¿ç¨çè§£æä¸ä¸æåå«æ¥è¯¢éæ©é¡¹ï¼Select Itemsï¼ãè¡¨ä¿¡æ¯ï¼Tableï¼ãåçæ¡ä»¶ï¼Sharding Conditionï¼ãèªå¢ä¸»é®ä¿¡æ¯ï¼Auto increment Primary Keyï¼ãæåºä¿¡æ¯ï¼Order Byï¼ãåç»ä¿¡æ¯ï¼Group Byï¼ä»¥ååé¡µä¿¡æ¯ï¼LimitãRownumãTopï¼ã SQL çä¸æ¬¡è§£æè¿ç¨æ¯ä¸å¯éçï¼ä¸ä¸ªä¸ª Token æ SQL åæ¬çé¡ºåºä¾æ¬¡è¿è¡è§£æï¼æ§è½å¾é«ã èèå°åç§æ°æ®åº SQL æ¹è¨çå¼åï¼å¨è§£ææ¨¡åæä¾äºåç±»æ°æ®åºç SQL æ¹è¨å­å¸ã\n\n# SQL è§£æå¼æ\n\nSQL è§£æä½ä¸ºååºåè¡¨ç±»äº§åçæ ¸å¿ï¼å¶æ§è½åå¼å®¹æ§æ¯æéè¦çè¡¡éææ ã ShardingSphere ç SQL è§£æå¨ç»åäº 3 ä»£äº§åçæ´æ°è¿­ä»£ã\n\nç¬¬ä¸ä»£ SQL è§£æå¨ä¸ºäºè¿½æ±æ§è½ä¸å¿«éå®ç°ï¼å¨ 1.4.x ä¹åççæ¬ä½¿ç¨ Druid ä½ä¸º SQL è§£æå¨ãç»å®éæµè¯ï¼å®çæ§è½è¿è¶å¶å®è§£æå¨ã\n\nç¬¬äºä»£ SQL è§£æå¨ä» 1.5.x çæ¬å¼å§ï¼ShardingSphere éç¨å®å¨èªç ç SQL è§£æå¼æã ç±äºç®çä¸åï¼ShardingSphere å¹¶ä¸éè¦å° SQL è½¬ä¸ºä¸é¢å®å¨çæ½è±¡è¯­æ³æ ï¼ä¹æ ééè¿è®¿é®å¨æ¨¡å¼è¿è¡äºæ¬¡éåãå®éç¨å¯¹ SQL åçè§£çæ¹å¼ï¼ä»æç¼æ°æ®åçéè¦å³æ³¨çä¸ä¸æï¼å æ­¤ SQL è§£æçæ§è½åå¼å®¹æ§å¾å°äºè¿ä¸æ­¥çæé«ã\n\nç¬¬ä¸ä»£ SQL è§£æå¨åä» 3.0.x çæ¬å¼å§ï¼ShardingSphere å°è¯ä½¿ç¨ ANTLR ä½ä¸º SQL è§£æçå¼æï¼å¹¶è®¡åæ ¹æ® DDL -> TCL -> DAL â> DCL -> DML â>DQL è¿ä¸ªé¡ºåºï¼ä¾æ¬¡æ¿æ¢åæçè§£æå¼æï¼ç®åä»å¤äºæ¿æ¢è¿­ä»£ä¸­ã ä½¿ç¨ ANTLR çåå æ¯å¸æ ShardingSphere çè§£æå¼æè½å¤æ´å¥½çå¯¹ SQL è¿è¡å¼å®¹ãå¯¹äºå¤æçè¡¨è¾¾å¼ãéå½ãå­æ¥è¯¢ç­è¯­å¥ï¼è½ç¶ ShardingSphere çåçæ ¸å¿å¹¶ä¸å³æ³¨ï¼ä½æ¯ä¼å½±åå¯¹äº SQL çè§£çåå¥½åº¦ã ç»è¿å®ä¾æµè¯ï¼ANTLR è§£æ SQL çæ§è½æ¯èªç ç SQL è§£æå¼ææ¢ 3-10 åå·¦å³ãä¸ºäºå¼¥è¡¥è¿ä¸å·®è·ï¼ShardingSphere å°ä½¿ç¨ PreparedStatement ç SQL è§£æçè¯­æ³æ æ¾å¥ç¼å­ã å æ­¤å»ºè®®éç¨ PreparedStatement è¿ç§ SQL é¢ç¼è¯çæ¹å¼æåæ§è½ã\n\nç¬¬ä¸ä»£ SQL è§£æå¼æçæ´ä½ç»æååå¦ä¸å¾æç¤ºã\n\n\n\n\n# è·¯ç±å¼æ\n\n\n# æ¹åå¼æ\n\n\n# æ§è¡å¼æ\n\n\n# å½å¹¶å¼æ",normalizedContent:"# shardingsphere jdbc\n\n\n# ç®ä»\n\nshardingsphere-jdbc å®ä½ä¸ºè½»éçº§ java æ¡æ¶ï¼å¨ java ç jdbc å±æä¾çé¢å¤æå¡ã å®ä½¿ç¨å®¢æ·ç«¯ç´è¿æ°æ®åºï¼ä»¥ jar åå½¢å¼æä¾æå¡ï¼æ éé¢å¤é¨ç½²åä¾èµï¼å¯çè§£ä¸ºå¢å¼ºçç jdbc é©±å¨ï¼å®å¨å¼å®¹ jdbc ååç§ orm æ¡æ¶ã\n\n * éç¨äºä»»ä½åºäº jdbc ç orm æ¡æ¶ï¼å¦ï¼jpa, hibernate, mybatis, spring jdbc template æç´æ¥ä½¿ç¨ jdbcã\n * æ¯æä»»ä½ç¬¬ä¸æ¹çæ°æ®åºè¿æ¥æ± ï¼å¦ï¼dbcp, c3p0, bonecp, druid, hikaricp ç­ã\n * æ¯æä»»æå®ç° jdbc è§èçæ°æ®åºï¼ç®åæ¯æ mysqlï¼oracleï¼sqlserverï¼postgresql ä»¥åä»»ä½éµå¾ª sql92 æ åçæ°æ®åºã\n\n\n\n\n# å¿«éå¥é¨\n\n\n# å¼å¥ maven ä¾èµ\n\n<dependency>\n    <groupid>org.apache.shardingsphere</groupid>\n    <artifactid>shardingsphere-jdbc-core</artifactid>\n    <version>${latest.release.version}</version>\n</dependency>\n\n\næ³¨æï¼è¯·å° ${latest.release.version} æ´æ¹ä¸ºå®éççæ¬å·ã\n\n\n# è§åéç½®\n\nshardingsphere-jdbc å¯ä»¥éè¿ javaï¼yamlï¼spring å½åç©ºé´å spring boot starter è¿ 4 ç§æ¹å¼è¿è¡éç½®ï¼å¼åèå¯æ ¹æ®åºæ¯éæ©éåçéç½®æ¹å¼ã è¯¦æè¯·åè§éç½®æåã\n\n\n# åå»ºæ°æ®æº\n\néè¿ shardingspheredatasourcefactory å·¥ååè§åéç½®å¯¹è±¡è·å shardingspheredatasourceã è¯¥å¯¹è±¡å®ç°èª jdbc çæ å datasource æ¥å£ï¼å¯ç¨äºåç jdbc å¼åï¼æä½¿ç¨ jpa, mybatis ç­ orm ç±»åºã\n\ndatasource datasource = shardingspheredatasourcefactory.createdatasource(datasourcemap, configurations, properties);\n\n\n\n# æ¦å¿µååè½\n\nåä¸æ°æ®èç¹é¾äºæ»¡è¶³äºèç½çæµ·éæ°æ®åºæ¯ã\n\nä»æ§è½æ¹é¢æ¥è¯´ï¼ç±äºå³ç³»åæ°æ®åºå¤§å¤éç¨ b+ æ ç±»åçç´¢å¼ï¼å¨æ°æ®éè¶è¿éå¼çæåµä¸ï¼ç´¢å¼æ·±åº¦çå¢å ä¹å°ä½¿å¾ç£çè®¿é®ç io æ¬¡æ°å¢å ï¼è¿èå¯¼è´æ¥è¯¢æ§è½çä¸éï¼åæ¶ï¼é«å¹¶åè®¿é®è¯·æ±ä¹ä½¿å¾éä¸­å¼æ°æ®åºæä¸ºç³»ç»çæå¤§ç¶é¢ã\n\nå¨ä¼ ç»çå³ç³»åæ°æ®åºæ æ³æ»¡è¶³äºèç½åºæ¯éè¦çæåµä¸ï¼å°æ°æ®å­å¨è³åçæ¯æåå¸å¼ç nosql çå°è¯è¶æ¥è¶å¤ã ä½ nosql å¯¹ sql çä¸å¼å®¹æ§ä»¥åçæåçä¸å®åï¼ä½¿å¾å®ä»¬å¨ä¸å³ç³»åæ°æ®åºçåå¼ä¸­å§ç»æ æ³å®æè´å½ä¸å»ï¼èå³ç³»åæ°æ®åºçå°ä½å´ä¾ç¶ä¸å¯æ¼å¨ã\n\næ°æ®åçææç§æä¸ªç»´åº¦å°å­æ¾å¨åä¸æ°æ®åºä¸­çæ°æ®åæ£å°å­æ¾è³å¤ä¸ªæ°æ®åºæè¡¨ä¸­ä»¥è¾¾å°æåæ§è½ç¶é¢ä»¥åå¯ç¨æ§çææãæ°æ®åççææææ®µæ¯å¯¹å³ç³»åæ°æ®åºè¿è¡ååºååè¡¨ãååºååè¡¨åå¯ä»¥ææçé¿åç±æ°æ®éè¶è¿å¯æ¿åéå¼èäº§ççæ¥è¯¢ç¶é¢ã é¤æ­¤ä¹å¤ï¼ååºè¿è½å¤ç¨äºææçåæ£å¯¹æ°æ®åºåç¹çè®¿é®éï¼åè¡¨è½ç¶æ æ³ç¼è§£æ°æ®åºååï¼ä½å´è½å¤æä¾å°½éå°åå¸å¼äºå¡è½¬åä¸ºæ¬å°äºå¡çå¯è½ï¼ä¸æ¦æ¶åå°è·¨åºçæ´æ°æä½ï¼åå¸å¼äºå¡å¾å¾ä¼ä½¿é®é¢åå¾å¤æã ä½¿ç¨å¤ä¸»å¤ä»çåçæ¹å¼ï¼å¯ä»¥ææçé¿åæ°æ®åç¹ï¼ä»èæåæ°æ®æ¶æçå¯ç¨æ§ã\n\néè¿ååºååè¡¨è¿è¡æ°æ®çæåæ¥ä½¿å¾åä¸ªè¡¨çæ°æ®éä¿æå¨éå¼ä»¥ä¸ï¼ä»¥åå¯¹æµéè¿è¡çå¯¼åºå¯¹é«è®¿é®éï¼æ¯åºå¯¹é«å¹¶ååæµ·éæ°æ®ç³»ç»çææææ®µã æ°æ®åççæåæ¹å¼ååä¸ºåç´åçåæ°´å¹³åçã\n\n\n# åç´åç\n\næç§ä¸å¡æåçæ¹å¼ç§°ä¸ºåç´åçï¼åç§°ä¸ºçºµåæåï¼å®çæ ¸å¿çå¿µæ¯ä¸åºä¸ç¨ã å¨æåä¹åï¼ä¸ä¸ªæ°æ®åºç±å¤ä¸ªæ°æ®è¡¨ææï¼æ¯ä¸ªè¡¨å¯¹åºçä¸åçä¸å¡ãèæåä¹åï¼åæ¯æç§ä¸å¡å°è¡¨è¿è¡å½ç±»ï¼åå¸å°ä¸åçæ°æ®åºä¸­ï¼ä»èå°åååæ£è³ä¸åçæ°æ®åºã ä¸å¾å±ç¤ºäºæ ¹æ®ä¸å¡éè¦ï¼å°ç¨æ·è¡¨åè®¢åè¡¨åç´åçå°ä¸åçæ°æ®åºçæ¹æ¡ã\n\n\n\nåç´åçå¾å¾éè¦å¯¹æ¶æåè®¾è®¡è¿è¡è°æ´ãéå¸¸æ¥è®²ï¼æ¯æ¥ä¸ååºå¯¹äºèç½ä¸å¡éæ±å¿«éååçï¼èä¸ï¼å®ä¹å¹¶æ æ³çæ­£çè§£å³åç¹ç¶é¢ã åç´æåå¯ä»¥ç¼è§£æ°æ®éåè®¿é®éå¸¦æ¥çé®é¢ï¼ä½æ æ³æ ¹æ²»ãå¦æåç´æåä¹åï¼è¡¨ä¸­çæ°æ®éä¾ç¶è¶è¿åèç¹æè½æ¿è½½çéå¼ï¼åéè¦æ°´å¹³åçæ¥è¿ä¸æ­¥å¤çã\n\n\n# æ°´å¹³åç\n\næ°´å¹³åçåç§°ä¸ºæ¨ªåæåã ç¸å¯¹äºåç´åçï¼å®ä¸åå°æ°æ®æ ¹æ®ä¸å¡é»è¾åç±»ï¼èæ¯éè¿æä¸ªå­æ®µï¼ææå ä¸ªå­æ®µï¼ï¼æ ¹æ®æç§è§åå°æ°æ®åæ£è³å¤ä¸ªåºæè¡¨ä¸­ï¼æ¯ä¸ªåçä»åå«æ°æ®çä¸é¨åã ä¾å¦ï¼æ ¹æ®ä¸»é®åçï¼å¶æ°ä¸»é®çè®°å½æ¾å¥ 0 åºï¼æè¡¨ï¼ï¼å¥æ°ä¸»é®çè®°å½æ¾å¥ 1 åºï¼æè¡¨ï¼ï¼å¦ä¸å¾æç¤ºã\n\n\n\næ°´å¹³åçä»çè®ºä¸çªç ´äºåæºæ°æ®éå¤ççç¶é¢ï¼å¹¶ä¸æ©å±ç¸å¯¹èªç±ï¼æ¯ååºåè¡¨çæ åè§£å³æ¹æ¡ã\n\n\n# æ°æ®åçå¸¦æ¥çé®é¢\n\n * æ°æ®è·¯ç±ï¼éè¦ç¥éæ°æ®éè¦ä»åªä¸ªå·ä½çæ°æ®åºçåè¡¨ä¸­è·åã\n * sql ä¸å¼å®¹ï¼åè¡¨å¯¼è´è¡¨åç§°çä¿®æ¹ï¼æèåé¡µãæåºãèåãåç»ç­æä½çä¸æ­£ç¡®å¤çã\n * è·¨åºäºå¡ï¼åçéç¨åè¡¨ï¼å¯ä»¥å¨éä½åè¡¨æ°æ®éçæåµä¸ï¼å°½éä½¿ç¨æ¬å°äºå¡ï¼åäºä½¿ç¨ååºä¸åè¡¨å¯ææé¿ååå¸å¼äºå¡å¸¦æ¥çéº»ç¦ã å¨ä¸è½é¿åè·¨åºäºå¡çåºæ¯ï¼æäºä¸å¡ä»ç¶éè¦ä¿æäºå¡çä¸è´æ§ã èåºäº xa çåå¸å¼äºå¡ç±äºå¨å¹¶ååº¦é«çåºæ¯ä¸­æ§è½æ æ³æ»¡è¶³éè¦ï¼å¹¶æªè¢«äºèç½å·¨å¤´å¤§è§æ¨¡ä½¿ç¨ï¼ä»ä»¬å¤§å¤éç¨æç»ä¸è´æ§çææ§äºå¡ä»£æ¿å¼ºä¸è´äºå¡ã\n\n\n# shardingsphere åæ ¸åæ\n\nshardingsphere ç 3 ä¸ªäº§åçæ°æ®åçä¸»è¦æµç¨æ¯å®å¨ä¸è´çã æ ¸å¿ç± sql è§£æ => æ§è¡å¨ä¼å => sql è·¯ç± => sql æ¹å => sql æ§è¡ => ç»æå½å¹¶çæµç¨ç»æã\n\n\n\n * ql è§£æï¼åä¸ºè¯æ³è§£æåè¯­æ³è§£æã åéè¿è¯æ³è§£æå¨å° sql æåä¸ºä¸ä¸ªä¸ªä¸å¯ååçåè¯ãåä½¿ç¨è¯­æ³è§£æå¨å¯¹ sql è¿è¡çè§£ï¼å¹¶æç»æç¼åºè§£æä¸ä¸æã è§£æä¸ä¸æåæ¬è¡¨ãéæ©é¡¹ãæåºé¡¹ãåç»é¡¹ãèåå½æ°ãåé¡µä¿¡æ¯ãæ¥è¯¢æ¡ä»¶ä»¥åå¯è½éè¦ä¿®æ¹çå ä½ç¬¦çæ è®°ã\n * æ§è¡å¨ä¼åï¼åå¹¶åä¼ååçæ¡ä»¶ï¼å¦ or ç­ã\n * sql è·¯ç±ï¼æ ¹æ®è§£æä¸ä¸æå¹éç¨æ·éç½®çåçç­ç¥ï¼å¹¶çæè·¯ç±è·¯å¾ãç®åæ¯æåçè·¯ç±åå¹¿æ­è·¯ç±ã\n * sql æ¹åï¼å° sql æ¹åä¸ºå¨çå®æ°æ®åºä¸­å¯ä»¥æ­£ç¡®æ§è¡çè¯­å¥ãsql æ¹ååä¸ºæ­£ç¡®æ§æ¹ååä¼åæ¹åã\n * sql æ§è¡ï¼éè¿å¤çº¿ç¨æ§è¡å¨å¼æ­¥æ§è¡ã\n * ç»æå½å¹¶ï¼å°å¤ä¸ªæ§è¡ç»æéå½å¹¶ä»¥ä¾¿äºéè¿ç»ä¸ç jdbc æ¥å£è¾åºãç»æå½å¹¶åæ¬æµå¼å½å¹¶ãåå­å½å¹¶åä½¿ç¨è£é¥°æ¨¡å¼çè¿½å å½å¹¶è¿å ç§æ¹å¼ã\n\n\n# è§£æå¼æ\n\n# æ½è±¡è¯­æ³æ \n\nè§£æè¿ç¨åä¸ºè¯æ³è§£æåè¯­æ³è§£æã è¯æ³è§£æå¨ç¨äºå° sql æè§£ä¸ºä¸å¯ååçåå­ç¬¦å·ï¼ç§°ä¸º tokenãå¹¶æ ¹æ®ä¸åæ°æ®åºæ¹è¨ææä¾çå­å¸ï¼å°å¶å½ç±»ä¸ºå³é®å­ï¼è¡¨è¾¾å¼ï¼å­é¢éåæä½ç¬¦ã åä½¿ç¨è¯­æ³è§£æå¨å° sql è½¬æ¢ä¸ºæ½è±¡è¯­æ³æ ã\n\nä¾å¦ï¼ä»¥ä¸ sqlï¼\n\nselect id, name from t_user where status = 'active' and age > 18\n\n\nè§£æä¹åçä¸ºæ½è±¡è¯­æ³æ è§ä¸å¾ã\n\n\n\nä¸ºäºä¾¿äºçè§£ï¼æ½è±¡è¯­æ³æ ä¸­çå³é®å­ç token ç¨ç»¿è²è¡¨ç¤ºï¼åéç token ç¨çº¢è²è¡¨ç¤ºï¼ç°è²è¡¨ç¤ºéè¦è¿ä¸æ­¥æåã\n\næåï¼éè¿å¯¹æ½è±¡è¯­æ³æ çéåå»æç¼åçæéçä¸ä¸æï¼å¹¶æ è®°æå¯è½éè¦æ¹åçä½ç½®ã ä¾åçä½¿ç¨çè§£æä¸ä¸æåå«æ¥è¯¢éæ©é¡¹ï¼select itemsï¼ãè¡¨ä¿¡æ¯ï¼tableï¼ãåçæ¡ä»¶ï¼sharding conditionï¼ãèªå¢ä¸»é®ä¿¡æ¯ï¼auto increment primary keyï¼ãæåºä¿¡æ¯ï¼order byï¼ãåç»ä¿¡æ¯ï¼group byï¼ä»¥ååé¡µä¿¡æ¯ï¼limitãrownumãtopï¼ã sql çä¸æ¬¡è§£æè¿ç¨æ¯ä¸å¯éçï¼ä¸ä¸ªä¸ª token æ sql åæ¬çé¡ºåºä¾æ¬¡è¿è¡è§£æï¼æ§è½å¾é«ã èèå°åç§æ°æ®åº sql æ¹è¨çå¼åï¼å¨è§£ææ¨¡åæä¾äºåç±»æ°æ®åºç sql æ¹è¨å­å¸ã\n\n# sql è§£æå¼æ\n\nsql è§£æä½ä¸ºååºåè¡¨ç±»äº§åçæ ¸å¿ï¼å¶æ§è½åå¼å®¹æ§æ¯æéè¦çè¡¡éææ ã shardingsphere ç sql è§£æå¨ç»åäº 3 ä»£äº§åçæ´æ°è¿­ä»£ã\n\nç¬¬ä¸ä»£ sql è§£æå¨ä¸ºäºè¿½æ±æ§è½ä¸å¿«éå®ç°ï¼å¨ 1.4.x ä¹åççæ¬ä½¿ç¨ druid ä½ä¸º sql è§£æå¨ãç»å®éæµè¯ï¼å®çæ§è½è¿è¶å¶å®è§£æå¨ã\n\nç¬¬äºä»£ sql è§£æå¨ä» 1.5.x çæ¬å¼å§ï¼shardingsphere éç¨å®å¨èªç ç sql è§£æå¼æã ç±äºç®çä¸åï¼shardingsphere å¹¶ä¸éè¦å° sql è½¬ä¸ºä¸é¢å®å¨çæ½è±¡è¯­æ³æ ï¼ä¹æ ééè¿è®¿é®å¨æ¨¡å¼è¿è¡äºæ¬¡éåãå®éç¨å¯¹ sql åçè§£çæ¹å¼ï¼ä»æç¼æ°æ®åçéè¦å³æ³¨çä¸ä¸æï¼å æ­¤ sql è§£æçæ§è½åå¼å®¹æ§å¾å°äºè¿ä¸æ­¥çæé«ã\n\nç¬¬ä¸ä»£ sql è§£æå¨åä» 3.0.x çæ¬å¼å§ï¼shardingsphere å°è¯ä½¿ç¨ antlr ä½ä¸º sql è§£æçå¼æï¼å¹¶è®¡åæ ¹æ® ddl -> tcl -> dal â> dcl -> dml â>dql è¿ä¸ªé¡ºåºï¼ä¾æ¬¡æ¿æ¢åæçè§£æå¼æï¼ç®åä»å¤äºæ¿æ¢è¿­ä»£ä¸­ã ä½¿ç¨ antlr çåå æ¯å¸æ shardingsphere çè§£æå¼æè½å¤æ´å¥½çå¯¹ sql è¿è¡å¼å®¹ãå¯¹äºå¤æçè¡¨è¾¾å¼ãéå½ãå­æ¥è¯¢ç­è¯­å¥ï¼è½ç¶ shardingsphere çåçæ ¸å¿å¹¶ä¸å³æ³¨ï¼ä½æ¯ä¼å½±åå¯¹äº sql çè§£çåå¥½åº¦ã ç»è¿å®ä¾æµè¯ï¼antlr è§£æ sql çæ§è½æ¯èªç ç sql è§£æå¼ææ¢ 3-10 åå·¦å³ãä¸ºäºå¼¥è¡¥è¿ä¸å·®è·ï¼shardingsphere å°ä½¿ç¨ preparedstatement ç sql è§£æçè¯­æ³æ æ¾å¥ç¼å­ã å æ­¤å»ºè®®éç¨ preparedstatement è¿ç§ sql é¢ç¼è¯çæ¹å¼æåæ§è½ã\n\nç¬¬ä¸ä»£ sql è§£æå¼æçæ´ä½ç»æååå¦ä¸å¾æç¤ºã\n\n\n\n\n# è·¯ç±å¼æ\n\n\n# æ¹åå¼æ\n\n\n# æ§è¡å¼æ\n\n\n# å½å¹¶å¼æ",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"çæ¬ç®¡çä¸­é´ä»¶ Flyway",frontmatter:{title:"çæ¬ç®¡çä¸­é´ä»¶ Flyway",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶"],tags:["æ°æ®åº","ä¸­é´ä»¶","çæ¬ç®¡ç"],permalink:"/pages/9f8daf/"},regularPath:"/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/02.Flyway.html",relativePath:"02.æ°æ®åºä¸­é´ä»¶/02.Flyway.md",key:"v-30339a31",path:"/pages/9f8daf/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:42},{level:3,title:"ä»ä¹æ¯ Flyway",slug:"ä»ä¹æ¯-flyway",normalizedTitle:"ä»ä¹æ¯ flyway",charIndex:49},{level:3,title:"ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»",slug:"ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»",normalizedTitle:"ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»",charIndex:87},{level:3,title:"Flyway å¦ä½å·¥ä½ï¼",slug:"flyway-å¦ä½å·¥ä½",normalizedTitle:"flyway å¦ä½å·¥ä½ï¼",charIndex:599},{level:2,title:"å¿«éä¸æ",slug:"å¿«éä¸æ",normalizedTitle:"å¿«éä¸æ",charIndex:1123},{level:3,title:"å½ä»¤è¡",slug:"å½ä»¤è¡",normalizedTitle:"å½ä»¤è¡",charIndex:1151},{level:3,title:"JAVA API",slug:"java-api",normalizedTitle:"java api",charIndex:1158},{level:3,title:"Maven",slug:"maven",normalizedTitle:"maven",charIndex:1170},{level:3,title:"Gradle",slug:"gradle",normalizedTitle:"gradle",charIndex:1179},{level:2,title:"å¥é¨ç¯",slug:"å¥é¨ç¯",normalizedTitle:"å¥é¨ç¯",charIndex:5358},{level:3,title:"æ¦å¿µ",slug:"æ¦å¿µ",normalizedTitle:"æ¦å¿µ",charIndex:5366},{level:4,title:"Migrations",slug:"migrations",normalizedTitle:"migrations",charIndex:5372},{level:5,title:"Versioned migrations",slug:"versioned-migrations",normalizedTitle:"versioned migrations",charIndex:5439},{level:5,title:"Undo migrations",slug:"undo-migrations",normalizedTitle:"undo migrations",charIndex:6025},{level:5,title:"Repeatable migrations",slug:"repeatable-migrations",normalizedTitle:"repeatable migrations",charIndex:5462},{level:5,title:"åºäº SQL ç migrations",slug:"åºäº-sql-ç-migrations",normalizedTitle:"åºäº sql ç migrations",charIndex:6563},{level:5,title:"åºäº JAVA ç migrations",slug:"åºäº-java-ç-migrations",normalizedTitle:"åºäº java ç migrations",charIndex:7073},{level:4,title:"Callbacks",slug:"callbacks",normalizedTitle:"callbacks",charIndex:7529},{level:5,title:"SQL Callbacks",slug:"sql-callbacks",normalizedTitle:"sql callbacks",charIndex:7736},{level:5,title:"JAVA Callbacks",slug:"java-callbacks",normalizedTitle:"java callbacks",charIndex:8083},{level:4,title:"Error Handlers",slug:"error-handlers",normalizedTitle:"error handlers",charIndex:8571},{level:4,title:"Dry Runs",slug:"dry-runs",normalizedTitle:"dry runs",charIndex:8607},{level:3,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:1151},{level:3,title:"æ¯æçæ°æ®åº",slug:"æ¯æçæ°æ®åº",normalizedTitle:"æ¯æçæ°æ®åº",charIndex:8744},{level:2,title:"èµæ",slug:"èµæ",normalizedTitle:"èµæ",charIndex:8921},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:8947}],headersStr:"ç®ä» ä»ä¹æ¯ Flyway ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§» Flyway å¦ä½å·¥ä½ï¼ å¿«éä¸æ å½ä»¤è¡ JAVA API Maven Gradle å¥é¨ç¯ æ¦å¿µ Migrations Versioned migrations Undo migrations Repeatable migrations åºäº SQL ç migrations åºäº JAVA ç migrations Callbacks SQL Callbacks JAVA Callbacks Error Handlers Dry Runs å½ä»¤ æ¯æçæ°æ®åº èµæ ðª ä¼ éé¨",content:'# çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n> Flyway æ¯ä¸ä¸ªæ°æ®è¿ç§»å·¥å·ã\n\n\n# ç®ä»\n\n\n# ä»ä¹æ¯ Flyway\n\nFlyway æ¯ä¸ä¸ªå¼æºçæ°æ®åºè¿ç§»å·¥å·ã\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»\n\nä¸ºäºè¯´ææ°æ®è¿ç§»çä½ç¨ï¼æä»¬æ¥ä¸¾ä¸ä¸ªç¤ºä¾ï¼\n\nï¼1ï¼åè®¾ï¼æä¸ä¸ªå«å Shiny çé¡¹ç®ï¼å®çæ¶ææ¯ä¸ä¸ªå«å Shiny Soft ç App è¿æ¥å«å Shiny DB çæ°æ®åºã\n\nï¼2ï¼å¯¹äºå¤§å¤æ°é¡¹ç®èè¨ï¼æç®åçæç»­éæåºæ¯å¦ä¸æç¤ºï¼\n\n\n\nè¿æå³çï¼æä»¬ä¸ä»ä»è¦å¤çä¸ä»½ç¯å¢ä¸­çä¿®æ¹ï¼ç±æ­¤ä¼å¼å¥ä¸äºçæ¬å²çªé®é¢ï¼\n\nå¨ä»£ç ä¾§ï¼å³åºç¨è½¯ä»¶ï¼ççæ¬é®é¢æ¯è¾å®¹æè§£å³ï¼\n\n * ææ¹ä¾¿ççæ¬æ§å¶å·¥å·\n * æå¯å¤ç¨çæå»ºåæç»­éæ\n * è§èçåå¸åé¨ç½²è¿ç¨\n\né£ä¹ï¼æ°æ®åºå±é¢ççæ¬é®é¢å¦ä½è§£å³å¢ï¼\n\nç®åä»ç¶æ²¡ææ¹ä¾¿çæ°æ®åºçæ¬å·¥å·ãè®¸å¤é¡¹ç®ä»ä½¿ç¨ sql èæ¬æ¥è§£å³çæ¬å²çªï¼çè³æ¯éå°å²çªé®é¢æ¶ææ³èµ·ç¨ sql è¯­å¥å»è§£å³ã\n\nç±æ­¤ï¼å¼åä¸äºé®é¢ï¼\n\n * æºå¨ä¸çæ°æ®åºæ¯ä»ä¹ç¶æï¼\n * èæ¬å°åºçææ²¡æï¼\n * çäº§ç¯å¢ä¿®å¤çé®é¢æ¯å¦ä¹å¨æµè¯ç¯å¢ä¿®å¤äºï¼\n * å¦ä½å»ºç«ä¸ä¸ªæ°çæ°æ®åºå®ä¾ï¼\n\næ°æ®è¿ç§»å°±æ¯ç¨æ¥æå®è¿äºæ··ä¹±çé®é¢ï¼\n\n * éè¿èç¨¿éå»ºä¸ä¸ªæ°æ®åºã\n * å¨ä»»ä½æ¶åé½å¯ä»¥æ¸æ¥çäºè§£æ°æ®åºçç¶æã\n * ä»¥ä¸ç§æç¡®çæ¹å¼å°æ°æ®åºä»å½åçæ¬è¿ç§»å°ä¸ä¸ªæ°çæ¬ã\n\n\n# Flyway å¦ä½å·¥ä½ï¼\n\næç®åçåºæ¯æ¯æå® Flyway è¿ç§»å°ä¸ä¸ªç©ºçæ°æ®åºã\n\n\n\nFlyway ä¼å°è¯æ¥æ¾å®ç schema åå²è¡¨ï¼å¦ææ°æ®åºæ¯ç©ºçï¼Flyway å°±ä¸åæ¥æ¾ï¼èæ¯ç´æ¥åå»ºæ°æ®åºã\n\nç°åä½ å°±æäºä¸ä¸ªä»åå«ä¸å¼ ç©ºè¡¨çæ°æ®åºï¼é»è®¤æåµä¸ï¼è¿å¼ è¡¨å« flyway_schema_historyã\n\n\n\nè¿å¼ è¡¨å°è¢«ç¨äºè¿½è¸ªæ°æ®åºçç¶æã\n\nç¶åï¼Flyway å°å¼å§æ«ææä»¶ç³»ç»æåºç¨ classpath ä¸­ç migrationsãè¿äº migrations å¯ä»¥æ¯ sql æ javaã\n\nè¿äº migrations å°æ ¹æ®ä»ä»¬ççæ¬å·è¿è¡æåºã\n\n\n\nä»»æ migration åºç¨åï¼schema åå²è¡¨å°æ´æ°ãå½åæ°æ®ååå§ç¶ææ¿æ¢åï¼å¯ä»¥ç§°ä¹ä¸ºï¼è¿ç§»å°æ°çæ¬ã\n\nFlyway ä¸æ¦æ«æäºæä»¶ç³»ç»æåºç¨ classpath ä¸ç migrationsï¼è¿äº migrations ä¼æ£æ¥ schema åå²è¡¨ãå¦æå®ä»¬ççæ¬å·ä½äºæç­äºå½åççæ¬ï¼å°è¢«å¿½ç¥ãä¿çä¸æ¥ç migrations æ¯ç­å¾ç migrationsï¼ææä½æ²¡æåºç¨ã\n\n\n\nmigrations å°æ ¹æ®çæ¬å·æåºå¹¶æåºæ§è¡ã\n\n\n\n\n# å¿«éä¸æ\n\nFlyway æ 4 ç§ä½¿ç¨æ¹å¼ï¼\n\n * å½ä»¤è¡\n * JAVA API\n * Maven\n * Gradle\n\n\n# å½ä»¤è¡\n\néç¨äºé Java ç¨æ·ï¼æ éæå»ºã\n\n> flyway migrate -url=... -user=... -password=...\n\n\nï¼1ï¼ä¸è½½è§£å\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼éç½® flyway\n\nç¼è¾ /conf/flyway.confï¼\n\nflyway.url=jdbc:h2:file:./foobardb\nflyway.user=SA\nflyway.password=\n\n\nï¼3ï¼åå»ºç¬¬ä¸ä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º V1__Create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table PERSON (\n    ID int not null,\n    NAME varchar(100) not null\n);\n\n\nï¼4ï¼è¿ç§»æ°æ®åº\n\nè¿è¡ Flyway æ¥è¿ç§»æ°æ®åºï¼\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nDatabase: jdbc:h2:file:./foobardb (H2 1.4)\nSuccessfully validated 1 migration (execution time 00:00.008s)\nCreating Schema History table: "PUBLIC"."flyway_schema_history"\nCurrent version of schema "PUBLIC": << Empty Schema >>\nMigrating schema "PUBLIC" to version 1 - Create person table\nSuccessfully applied 1 migration to schema "PUBLIC" (execution time 00:00.033s)\n\n\nï¼5ï¼æ·»å ç¬¬äºä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º V2__Add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into PERSON (ID, NAME) values (1, \'Axel\');\ninsert into PERSON (ID, NAME) values (2, \'Mr. Foo\');\ninsert into PERSON (ID, NAME) values (3, \'Ms. Bar\');\n\n\nè¿è¡ Flyway\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nDatabase: jdbc:h2:file:./foobardb (H2 1.4)\nSuccessfully validated 2 migrations (execution time 00:00.018s)\nCurrent version of schema "PUBLIC": 1\nMigrating schema "PUBLIC" to version 2 - Add people\nSuccessfully applied 1 migration to schema "PUBLIC" (execution time 00:00.016s)\n\n\n\n# JAVA API\n\nï¼1ï¼åå¤\n\n * Java8+\n * Maven 3.x\n\nï¼2ï¼æ·»å ä¾èµ\n\nå¨ pom.xml ä¸­æ·»å ä¾èµï¼\n\n<project ...>\n    ...\n    <dependencies>\n        <dependency>\n            <groupId>org.flywaydb</groupId>\n            <artifactId>flyway-core</artifactId>\n            <version>5.1.4</version>\n        </dependency>\n        <dependency>\n            <groupId>com.h2database</groupId>\n            <artifactId>h2</artifactId>\n            <version>1.3.170</version>\n        </dependency>\n        ...\n    </dependencies>\n    ...\n</project>\n\n\nï¼3ï¼éæ Flyway\n\næ·»å  App.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\nimport org.flywaydb.core.Flyway;\n\npublic class App {\n    public static void main(String[] args) {\n        // Create the Flyway instance\n        Flyway flyway = new Flyway();\n\n        // Point it to the database\n        flyway.setDataSource("jdbc:h2:file:./target/foobar", "sa", null);\n\n        // Start the migration\n        flyway.migrate();\n    }\n}\n\n\nï¼4ï¼åå»ºç¬¬ä¸ä¸ª migration\n\næ·»å  src/main/resources/db/migration/V1__Create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table PERSON (\n    ID int not null,\n    NAME varchar(100) not null\n);\n\n\nï¼5ï¼æ§è¡ç¨åº\n\næ§è¡ App#mainï¼\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nINFO: Creating schema history table: "PUBLIC"."flyway_schema_history"\nINFO: Current version of schema "PUBLIC": << Empty Schema >>\nINFO: Migrating schema "PUBLIC" to version 1 - Create person table\nINFO: Successfully applied 1 migration to schema "PUBLIC" (execution time 00:00.062s).\n\n\nï¼6ï¼æ·»å ç¬¬äºä¸ª migration\n\næ·»å  src/main/resources/db/migration/V2__Add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into PERSON (ID, NAME) values (1, \'Axel\');\ninsert into PERSON (ID, NAME) values (2, \'Mr. Foo\');\ninsert into PERSON (ID, NAME) values (3, \'Ms. Bar\');\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\nINFO: Current version of schema "PUBLIC": 1\nINFO: Migrating schema "PUBLIC" to version 2 - Add people\nINFO: Successfully applied 1 migration to schema "PUBLIC" (execution time 00:00.090s).\n\n\n\n# Maven\n\nä¸ Java API æ¹å¼å¤§ä½ç¸åï¼åºå«å¨ éæ Flyway æ­¥éª¤ï¼\n\nMaven æ¹å¼ä½¿ç¨æä»¶æ¥éæ Flywayï¼\n\n<project xmlns="...">\n    ...\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.flywaydb</groupId>\n                <artifactId>flyway-maven-plugin</artifactId>\n                <version>5.1.4</version>\n                <configuration>\n                    <url>jdbc:h2:file:./target/foobar</url>\n                    <user>sa</user>\n                </configuration>\n                <dependencies>\n                    <dependency>\n                        <groupId>com.h2database</groupId>\n                        <artifactId>h2</artifactId>\n                        <version>1.4.191</version>\n                    </dependency>\n                </dependencies>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\nå ä¸ºç¨çæ¯æä»¶ï¼æä»¥æ§è¡æ¹å¼ä¸åæ¯è¿è¡ Java ç±»ï¼èæ¯æ§è¡ maven æä»¶ï¼\n\n> mvn flyway:migrate\n\n\n> ð åèï¼ç¤ºä¾æºç \n\n\n# Gradle\n\næ¬äººä¸ç¨ Gradleï¼ç¥ã\n\n\n# å¥é¨ç¯\n\n\n# æ¦å¿µ\n\n# Migrations\n\nå¨ Flyway ä¸­ï¼å¯¹äºæ°æ®åºçä»»ä½æ¹åé½ç§°ä¹ä¸º Migrationsã\n\nMigrations å¯ä»¥åä¸º Versioned migrations å Repeatable migrationsã\n\nVersioned migrations æ 2 ç§å½¢å¼ï¼regular å undoã\n\nVersioned migrations å Repeatable migrations é½å¯ä»¥ä½¿ç¨ SQL æ JAVA æ¥ç¼åã\n\n# Versioned migrations\n\nç±ä¸ä¸ªçæ¬å·ï¼versionï¼ãä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãçæ¬å·å¿é¡»æ¯æä¸çãVersioned migrations åªè½æé¡ºåºæ§è¡ä¸æ¬¡ã\n\nä¸è¬ç¨äºï¼\n\n * å¢å æ¹ tables/indexes/foreign keys/enums/UDTsã\n * å¼ç¨æ°æ®æ´æ°\n * ç¨æ·æ°æ®æ ¡æ­£\n\nRegular ç¤ºä¾ï¼\n\nCREATE TABLE car (\n    id INT NOT NULL PRIMARY KEY,\n    license_plate VARCHAR NOT NULL,\n    color VARCHAR NOT NULL\n);\n\nALTER TABLE owner ADD driver_license_id VARCHAR;\n\nINSERT INTO brand (name) VALUES (\'DeLorean\');\n\n\n# Undo migrations\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æ\n\nUndo Versioned Migrations è´è´£æ¤é Regular Versioned migrations çå½±åã\n\nUndo ç¤ºä¾ï¼\n\nDELETE FROM brand WHERE name=\'DeLorean\';\n\nALTER TABLE owner DROP driver_license_id;\n\nDROP TABLE car;\n\n\n# Repeatable migrations\n\nç±ä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãVersioned migrations æ¯æ¬¡æ§è¡åï¼æ ¡éªï¼checksumï¼ä¼æ´æ°ã\n\nRepeatable migrations ç¨äºç®¡çå¯ä»¥éè¿ä¸ä¸ªæä»¶æ¥ç»´æ¤çæ¬æ§å¶çæ°æ®åºå¯¹è±¡ã\n\nä¸è¬ç¨äºï¼\n\n * åå»ºï¼éå»ºï¼views/procedures/functions/packages ç­ã\n * å¤§éå¼ç¨æ°æ®éæ°æå¥\n\nç¤ºä¾ï¼\n\nCREATE OR REPLACE VIEW blue_cars AS\n    SELECT id, license_plate FROM cars WHERE color=\'blue\';\n\n\n# åºäº SQL ç migrations\n\nmigrations æå¸¸ç¨çç¼åå½¢å¼å°±æ¯ SQLã\n\nåºäº SQL ç migrations ä¸è¬ç¨äºï¼\n\n * DDL åæ´ï¼éå¯¹ TABLES,VIEWS,TRIGGERS,SEQUENCES ç­ç CREATE/ALTER/DROP æä½ï¼\n * ç®åçå¼ç¨æ°æ®åæ´ï¼å¼ç¨æ°æ®è¡¨ä¸­ç CRUDï¼\n * ç®åçå¤§éæ°æ®åæ´ï¼å¸¸è§æ°æ®è¡¨ä¸­ç CRUDï¼\n\nå½åè§å\n\nä¸ºäºè¢« Flyway èªå¨è¯å«ï¼SQL migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * Prefix - V ä»£è¡¨ versioned migrations (å¯éç½®), U ä»£è¡¨ undo migrations (å¯éç½®)ã R ä»£è¡¨ repeatable migrations (å¯éç½®)\n * Version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * Separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * Description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n * Suffix - .sql (å¯éç½®)\n\n# åºäº JAVA ç migrations\n\nåºäº JAVA ç migrations éç¨äºä½¿ç¨ SQL ä¸å®¹æè¡¨è¾¾çåºæ¯ï¼\n\n * BLOB å CLOB åæ´\n * å¤§éæ°æ®çé«çº§åæ´ï¼éæ°è®¡ç®ãé«çº§æ ¼å¼åæ´ï¼\n\nå½åè§å\n\nä¸ºäºè¢« Flyway èªå¨è¯å«ï¼JAVA migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * Prefix - V ä»£è¡¨ versioned migrations (å¯éç½®), U ä»£è¡¨ undo migrations (å¯éç½®)ã R ä»£è¡¨ repeatable migrations (å¯éç½®)\n * Version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * Separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * Description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/migrations\n\n# Callbacks\n\n> æ³¨ï¼é¨å events ä»ä¸ä¸çæ¯æã\n\nå°½ç®¡ Migrations å¯è½å·²ç»æ»¡è¶³ç»å¤§é¨ååºæ¯çéè¦ï¼ä½æ¯æäºæåµä¸éè¦ä½ ä¸éåä¸éçæ§è¡ç¸åçè¡ä¸ºãè¿å¯è½ä¼éæ°ç¼è¯å­å¨è¿ç¨ï¼æ´æ°è§å¾ä»¥åè®¸å¤å¶ä»ç±»åçå¼éã\n\nå ä¸ºä»¥ä¸åå ï¼Flyway æä¾äº Callbacksï¼ç¨äºå¨ Migrations çå½å¨æä¸­æ·»å é©å­ã\n\nCallbacks å¯ä»¥ç¨ SQL æ JAVA æ¥å®ç°ã\n\n# SQL Callbacks\n\nSQL Callbacks çå½åè§åä¸ºï¼event å + SQL migrationã\n\nå¦ï¼ beforeMigrate.sql, beforeEachMigrate.sql, afterEachMigrate.sql ç­ã\n\nSQL Callbacks ä¹å¯ä»¥åå«æè¿°ï¼descriptionï¼ãè¿ç§æåµä¸ï¼SQL Callbacks æä»¶å = event å + åéç¬¦ + æè¿° + åç¼ãä¾ï¼beforeRepair__vacuum.sql\n\nå½åä¸ä¸ª event æå¤ä¸ª SQL callbacksï¼å°æç§å®ä»¬æè¿°ï¼descriptionï¼çé¡ºåºæ§è¡ã\n\n> æ³¨ï¼ Flyway ä¹æ¯æä½ éç½®ç sqlMigrationSuffixesã\n\n# JAVA Callbacks\n\n> å½ SQL Callbacks ä¸å¤æ¹ä¾¿æ¶ï¼æåºèè JAVA Callbacksã\n\nJAVA Callbacks æ 3 ç§å½¢å¼ï¼\n\n 1. åºäº Java ç Migrations - å®ç° JdbcMigrationãSpringJdbcMigrationãMigrationInfoProviderãMigrationChecksumProviderãConfigurationAwareãFlywayConfiguration\n 2. åºäº Java ç Callbacks - å®ç° org.flywaydb.core.api.callback æ¥å£ã\n 3. èªå®ä¹ Migration resolvers å executors - å®ç° MigrationResolverãMigrationExecutorãConfigurationAwareãFlywayConfiguration æ¥å£ã\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/callbacks\n\n# Error Handlers\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n# Dry Runs\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n\n# å½ä»¤\n\nFlyway çåè½ä¸»è¦å´ç»ç 7 ä¸ªåºæ¬å½ä»¤ï¼MigrateãCleanãInfoãValidateãUndoãBaseline å Repairã\n\næ³¨ï¼åå½ä»¤çä½¿ç¨æ¹æ³ç»èè¯·æ¥éå®æ¹ææ¡£ã\n\n\n# æ¯æçæ°æ®åº\n\n * Oracle\n * SQL Server\n * DB2\n * MySQL\n * MariaDB\n * PostgreSQL\n * Redshift\n * CockroachDB\n * SAP HANA\n * Sybase ASE\n * Informix\n * H2\n * HSQLDB\n * Derby\n * SQLite\n\n\n# èµæ\n\n| Github | å®æ¹ææ¡£ |\n\n\n# ðª ä¼ éé¨\n\n| æç Github åå®¢ | db-tutorial é¦é¡µ |',normalizedContent:'# çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n> flyway æ¯ä¸ä¸ªæ°æ®è¿ç§»å·¥å·ã\n\n\n# ç®ä»\n\n\n# ä»ä¹æ¯ flyway\n\nflyway æ¯ä¸ä¸ªå¼æºçæ°æ®åºè¿ç§»å·¥å·ã\n\n\n# ä¸ºä»ä¹è¦ä½¿ç¨æ°æ®è¿ç§»\n\nä¸ºäºè¯´ææ°æ®è¿ç§»çä½ç¨ï¼æä»¬æ¥ä¸¾ä¸ä¸ªç¤ºä¾ï¼\n\nï¼1ï¼åè®¾ï¼æä¸ä¸ªå«å shiny çé¡¹ç®ï¼å®çæ¶ææ¯ä¸ä¸ªå«å shiny soft ç app è¿æ¥å«å shiny db çæ°æ®åºã\n\nï¼2ï¼å¯¹äºå¤§å¤æ°é¡¹ç®èè¨ï¼æç®åçæç»­éæåºæ¯å¦ä¸æç¤ºï¼\n\n\n\nè¿æå³çï¼æä»¬ä¸ä»ä»è¦å¤çä¸ä»½ç¯å¢ä¸­çä¿®æ¹ï¼ç±æ­¤ä¼å¼å¥ä¸äºçæ¬å²çªé®é¢ï¼\n\nå¨ä»£ç ä¾§ï¼å³åºç¨è½¯ä»¶ï¼ççæ¬é®é¢æ¯è¾å®¹æè§£å³ï¼\n\n * ææ¹ä¾¿ççæ¬æ§å¶å·¥å·\n * æå¯å¤ç¨çæå»ºåæç»­éæ\n * è§èçåå¸åé¨ç½²è¿ç¨\n\né£ä¹ï¼æ°æ®åºå±é¢ççæ¬é®é¢å¦ä½è§£å³å¢ï¼\n\nç®åä»ç¶æ²¡ææ¹ä¾¿çæ°æ®åºçæ¬å·¥å·ãè®¸å¤é¡¹ç®ä»ä½¿ç¨ sql èæ¬æ¥è§£å³çæ¬å²çªï¼çè³æ¯éå°å²çªé®é¢æ¶ææ³èµ·ç¨ sql è¯­å¥å»è§£å³ã\n\nç±æ­¤ï¼å¼åä¸äºé®é¢ï¼\n\n * æºå¨ä¸çæ°æ®åºæ¯ä»ä¹ç¶æï¼\n * èæ¬å°åºçææ²¡æï¼\n * çäº§ç¯å¢ä¿®å¤çé®é¢æ¯å¦ä¹å¨æµè¯ç¯å¢ä¿®å¤äºï¼\n * å¦ä½å»ºç«ä¸ä¸ªæ°çæ°æ®åºå®ä¾ï¼\n\næ°æ®è¿ç§»å°±æ¯ç¨æ¥æå®è¿äºæ··ä¹±çé®é¢ï¼\n\n * éè¿èç¨¿éå»ºä¸ä¸ªæ°æ®åºã\n * å¨ä»»ä½æ¶åé½å¯ä»¥æ¸æ¥çäºè§£æ°æ®åºçç¶æã\n * ä»¥ä¸ç§æç¡®çæ¹å¼å°æ°æ®åºä»å½åçæ¬è¿ç§»å°ä¸ä¸ªæ°çæ¬ã\n\n\n# flyway å¦ä½å·¥ä½ï¼\n\næç®åçåºæ¯æ¯æå® flyway è¿ç§»å°ä¸ä¸ªç©ºçæ°æ®åºã\n\n\n\nflyway ä¼å°è¯æ¥æ¾å®ç schema åå²è¡¨ï¼å¦ææ°æ®åºæ¯ç©ºçï¼flyway å°±ä¸åæ¥æ¾ï¼èæ¯ç´æ¥åå»ºæ°æ®åºã\n\nç°åä½ å°±æäºä¸ä¸ªä»åå«ä¸å¼ ç©ºè¡¨çæ°æ®åºï¼é»è®¤æåµä¸ï¼è¿å¼ è¡¨å« flyway_schema_historyã\n\n\n\nè¿å¼ è¡¨å°è¢«ç¨äºè¿½è¸ªæ°æ®åºçç¶æã\n\nç¶åï¼flyway å°å¼å§æ«ææä»¶ç³»ç»æåºç¨ classpath ä¸­ç migrationsãè¿äº migrations å¯ä»¥æ¯ sql æ javaã\n\nè¿äº migrations å°æ ¹æ®ä»ä»¬ççæ¬å·è¿è¡æåºã\n\n\n\nä»»æ migration åºç¨åï¼schema åå²è¡¨å°æ´æ°ãå½åæ°æ®ååå§ç¶ææ¿æ¢åï¼å¯ä»¥ç§°ä¹ä¸ºï¼è¿ç§»å°æ°çæ¬ã\n\nflyway ä¸æ¦æ«æäºæä»¶ç³»ç»æåºç¨ classpath ä¸ç migrationsï¼è¿äº migrations ä¼æ£æ¥ schema åå²è¡¨ãå¦æå®ä»¬ççæ¬å·ä½äºæç­äºå½åççæ¬ï¼å°è¢«å¿½ç¥ãä¿çä¸æ¥ç migrations æ¯ç­å¾ç migrationsï¼ææä½æ²¡æåºç¨ã\n\n\n\nmigrations å°æ ¹æ®çæ¬å·æåºå¹¶æåºæ§è¡ã\n\n\n\n\n# å¿«éä¸æ\n\nflyway æ 4 ç§ä½¿ç¨æ¹å¼ï¼\n\n * å½ä»¤è¡\n * java api\n * maven\n * gradle\n\n\n# å½ä»¤è¡\n\néç¨äºé java ç¨æ·ï¼æ éæå»ºã\n\n> flyway migrate -url=... -user=... -password=...\n\n\nï¼1ï¼ä¸è½½è§£å\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼éç½® flyway\n\nç¼è¾ /conf/flyway.confï¼\n\nflyway.url=jdbc:h2:file:./foobardb\nflyway.user=sa\nflyway.password=\n\n\nï¼3ï¼åå»ºç¬¬ä¸ä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º v1__create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table person (\n    id int not null,\n    name varchar(100) not null\n);\n\n\nï¼4ï¼è¿ç§»æ°æ®åº\n\nè¿è¡ flyway æ¥è¿ç§»æ°æ®åºï¼\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ndatabase: jdbc:h2:file:./foobardb (h2 1.4)\nsuccessfully validated 1 migration (execution time 00:00.008s)\ncreating schema history table: "public"."flyway_schema_history"\ncurrent version of schema "public": << empty schema >>\nmigrating schema "public" to version 1 - create person table\nsuccessfully applied 1 migration to schema "public" (execution time 00:00.033s)\n\n\nï¼5ï¼æ·»å ç¬¬äºä¸ª migration\n\nå¨ /sql ç®å½ä¸åå»º v2__add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into person (id, name) values (1, \'axel\');\ninsert into person (id, name) values (2, \'mr. foo\');\ninsert into person (id, name) values (3, \'ms. bar\');\n\n\nè¿è¡ flyway\n\nflyway-5.1.4> flyway migrate\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ndatabase: jdbc:h2:file:./foobardb (h2 1.4)\nsuccessfully validated 2 migrations (execution time 00:00.018s)\ncurrent version of schema "public": 1\nmigrating schema "public" to version 2 - add people\nsuccessfully applied 1 migration to schema "public" (execution time 00:00.016s)\n\n\n\n# java api\n\nï¼1ï¼åå¤\n\n * java8+\n * maven 3.x\n\nï¼2ï¼æ·»å ä¾èµ\n\nå¨ pom.xml ä¸­æ·»å ä¾èµï¼\n\n<project ...>\n    ...\n    <dependencies>\n        <dependency>\n            <groupid>org.flywaydb</groupid>\n            <artifactid>flyway-core</artifactid>\n            <version>5.1.4</version>\n        </dependency>\n        <dependency>\n            <groupid>com.h2database</groupid>\n            <artifactid>h2</artifactid>\n            <version>1.3.170</version>\n        </dependency>\n        ...\n    </dependencies>\n    ...\n</project>\n\n\nï¼3ï¼éæ flyway\n\næ·»å  app.java æä»¶ï¼åå®¹å¦ä¸ï¼\n\nimport org.flywaydb.core.flyway;\n\npublic class app {\n    public static void main(string[] args) {\n        // create the flyway instance\n        flyway flyway = new flyway();\n\n        // point it to the database\n        flyway.setdatasource("jdbc:h2:file:./target/foobar", "sa", null);\n\n        // start the migration\n        flyway.migrate();\n    }\n}\n\n\nï¼4ï¼åå»ºç¬¬ä¸ä¸ª migration\n\næ·»å  src/main/resources/db/migration/v1__create_person_table.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ncreate table person (\n    id int not null,\n    name varchar(100) not null\n);\n\n\nï¼5ï¼æ§è¡ç¨åº\n\næ§è¡ app#mainï¼\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ninfo: creating schema history table: "public"."flyway_schema_history"\ninfo: current version of schema "public": << empty schema >>\ninfo: migrating schema "public" to version 1 - create person table\ninfo: successfully applied 1 migration to schema "public" (execution time 00:00.062s).\n\n\nï¼6ï¼æ·»å ç¬¬äºä¸ª migration\n\næ·»å  src/main/resources/db/migration/v2__add_people.sql æä»¶ï¼åå®¹å¦ä¸ï¼\n\ninsert into person (id, name) values (1, \'axel\');\ninsert into person (id, name) values (2, \'mr. foo\');\ninsert into person (id, name) values (3, \'ms. bar\');\n\n\nè¿è¡æ­£å¸¸çæåµä¸ï¼åºè¯¥å¯ä»¥çå°å¦ä¸ç»æï¼\n\ninfo: current version of schema "public": 1\ninfo: migrating schema "public" to version 2 - add people\ninfo: successfully applied 1 migration to schema "public" (execution time 00:00.090s).\n\n\n\n# maven\n\nä¸ java api æ¹å¼å¤§ä½ç¸åï¼åºå«å¨ éæ flyway æ­¥éª¤ï¼\n\nmaven æ¹å¼ä½¿ç¨æä»¶æ¥éæ flywayï¼\n\n<project xmlns="...">\n    ...\n    <build>\n        <plugins>\n            <plugin>\n                <groupid>org.flywaydb</groupid>\n                <artifactid>flyway-maven-plugin</artifactid>\n                <version>5.1.4</version>\n                <configuration>\n                    <url>jdbc:h2:file:./target/foobar</url>\n                    <user>sa</user>\n                </configuration>\n                <dependencies>\n                    <dependency>\n                        <groupid>com.h2database</groupid>\n                        <artifactid>h2</artifactid>\n                        <version>1.4.191</version>\n                    </dependency>\n                </dependencies>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n\n\nå ä¸ºç¨çæ¯æä»¶ï¼æä»¥æ§è¡æ¹å¼ä¸åæ¯è¿è¡ java ç±»ï¼èæ¯æ§è¡ maven æä»¶ï¼\n\n> mvn flyway:migrate\n\n\n> ð åèï¼ç¤ºä¾æºç \n\n\n# gradle\n\næ¬äººä¸ç¨ gradleï¼ç¥ã\n\n\n# å¥é¨ç¯\n\n\n# æ¦å¿µ\n\n# migrations\n\nå¨ flyway ä¸­ï¼å¯¹äºæ°æ®åºçä»»ä½æ¹åé½ç§°ä¹ä¸º migrationsã\n\nmigrations å¯ä»¥åä¸º versioned migrations å repeatable migrationsã\n\nversioned migrations æ 2 ç§å½¢å¼ï¼regular å undoã\n\nversioned migrations å repeatable migrations é½å¯ä»¥ä½¿ç¨ sql æ java æ¥ç¼åã\n\n# versioned migrations\n\nç±ä¸ä¸ªçæ¬å·ï¼versionï¼ãä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãçæ¬å·å¿é¡»æ¯æä¸çãversioned migrations åªè½æé¡ºåºæ§è¡ä¸æ¬¡ã\n\nä¸è¬ç¨äºï¼\n\n * å¢å æ¹ tables/indexes/foreign keys/enums/udtsã\n * å¼ç¨æ°æ®æ´æ°\n * ç¨æ·æ°æ®æ ¡æ­£\n\nregular ç¤ºä¾ï¼\n\ncreate table car (\n    id int not null primary key,\n    license_plate varchar not null,\n    color varchar not null\n);\n\nalter table owner add driver_license_id varchar;\n\ninsert into brand (name) values (\'delorean\');\n\n\n# undo migrations\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æ\n\nundo versioned migrations è´è´£æ¤é regular versioned migrations çå½±åã\n\nundo ç¤ºä¾ï¼\n\ndelete from brand where name=\'delorean\';\n\nalter table owner drop driver_license_id;\n\ndrop table car;\n\n\n# repeatable migrations\n\nç±ä¸æ®µæè¿°ï¼descriptionï¼ãä¸ä¸ªæ ¡éªï¼checksumï¼ç»æãversioned migrations æ¯æ¬¡æ§è¡åï¼æ ¡éªï¼checksumï¼ä¼æ´æ°ã\n\nrepeatable migrations ç¨äºç®¡çå¯ä»¥éè¿ä¸ä¸ªæä»¶æ¥ç»´æ¤çæ¬æ§å¶çæ°æ®åºå¯¹è±¡ã\n\nä¸è¬ç¨äºï¼\n\n * åå»ºï¼éå»ºï¼views/procedures/functions/packages ç­ã\n * å¤§éå¼ç¨æ°æ®éæ°æå¥\n\nç¤ºä¾ï¼\n\ncreate or replace view blue_cars as\n    select id, license_plate from cars where color=\'blue\';\n\n\n# åºäº sql ç migrations\n\nmigrations æå¸¸ç¨çç¼åå½¢å¼å°±æ¯ sqlã\n\nåºäº sql ç migrations ä¸è¬ç¨äºï¼\n\n * ddl åæ´ï¼éå¯¹ tables,views,triggers,sequences ç­ç create/alter/drop æä½ï¼\n * ç®åçå¼ç¨æ°æ®åæ´ï¼å¼ç¨æ°æ®è¡¨ä¸­ç crudï¼\n * ç®åçå¤§éæ°æ®åæ´ï¼å¸¸è§æ°æ®è¡¨ä¸­ç crudï¼\n\nå½åè§å\n\nä¸ºäºè¢« flyway èªå¨è¯å«ï¼sql migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * prefix - v ä»£è¡¨ versioned migrations (å¯éç½®), u ä»£è¡¨ undo migrations (å¯éç½®)ã r ä»£è¡¨ repeatable migrations (å¯éç½®)\n * version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n * suffix - .sql (å¯éç½®)\n\n# åºäº java ç migrations\n\nåºäº java ç migrations éç¨äºä½¿ç¨ sql ä¸å®¹æè¡¨è¾¾çåºæ¯ï¼\n\n * blob å clob åæ´\n * å¤§éæ°æ®çé«çº§åæ´ï¼éæ°è®¡ç®ãé«çº§æ ¼å¼åæ´ï¼\n\nå½åè§å\n\nä¸ºäºè¢« flyway èªå¨è¯å«ï¼java migrations çæä»¶å½åå¿é¡»éµå¾ªè§å®çæ¨¡å¼ï¼\n\n\n\n * prefix - v ä»£è¡¨ versioned migrations (å¯éç½®), u ä»£è¡¨ undo migrations (å¯éç½®)ã r ä»£è¡¨ repeatable migrations (å¯éç½®)\n * version - çæ¬å·éè¿.(ç¹)æ_(ä¸åçº¿)åé (repeatable migrations ä¸éè¦)\n * separator - __ (ä¸¤ä¸ªä¸åçº¿) (å¯éç½®)\n * description - ä¸åçº¿æç©ºæ ¼åéçåè¯\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/migrations\n\n# callbacks\n\n> æ³¨ï¼é¨å events ä»ä¸ä¸çæ¯æã\n\nå°½ç®¡ migrations å¯è½å·²ç»æ»¡è¶³ç»å¤§é¨ååºæ¯çéè¦ï¼ä½æ¯æäºæåµä¸éè¦ä½ ä¸éåä¸éçæ§è¡ç¸åçè¡ä¸ºãè¿å¯è½ä¼éæ°ç¼è¯å­å¨è¿ç¨ï¼æ´æ°è§å¾ä»¥åè®¸å¤å¶ä»ç±»åçå¼éã\n\nå ä¸ºä»¥ä¸åå ï¼flyway æä¾äº callbacksï¼ç¨äºå¨ migrations çå½å¨æä¸­æ·»å é©å­ã\n\ncallbacks å¯ä»¥ç¨ sql æ java æ¥å®ç°ã\n\n# sql callbacks\n\nsql callbacks çå½åè§åä¸ºï¼event å + sql migrationã\n\nå¦ï¼ beforemigrate.sql, beforeeachmigrate.sql, aftereachmigrate.sql ç­ã\n\nsql callbacks ä¹å¯ä»¥åå«æè¿°ï¼descriptionï¼ãè¿ç§æåµä¸ï¼sql callbacks æä»¶å = event å + åéç¬¦ + æè¿° + åç¼ãä¾ï¼beforerepair__vacuum.sql\n\nå½åä¸ä¸ª event æå¤ä¸ª sql callbacksï¼å°æç§å®ä»¬æè¿°ï¼descriptionï¼çé¡ºåºæ§è¡ã\n\n> æ³¨ï¼ flyway ä¹æ¯æä½ éç½®ç sqlmigrationsuffixesã\n\n# java callbacks\n\n> å½ sql callbacks ä¸å¤æ¹ä¾¿æ¶ï¼æåºèè java callbacksã\n\njava callbacks æ 3 ç§å½¢å¼ï¼\n\n 1. åºäº java ç migrations - å®ç° jdbcmigrationãspringjdbcmigrationãmigrationinfoproviderãmigrationchecksumproviderãconfigurationawareãflywayconfiguration\n 2. åºäº java ç callbacks - å®ç° org.flywaydb.core.api.callback æ¥å£ã\n 3. èªå®ä¹ migration resolvers å executors - å®ç° migrationresolverãmigrationexecutorãconfigurationawareãflywayconfiguration æ¥å£ã\n\n> ð æ´å¤ç»èè¯·åèï¼https://flywaydb.org/documentation/callbacks\n\n# error handlers\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n# dry runs\n\n> æ³¨ï¼ä»ä¸ä¸çæ¯æã\n\nï¼ç¥ï¼\n\n\n# å½ä»¤\n\nflyway çåè½ä¸»è¦å´ç»ç 7 ä¸ªåºæ¬å½ä»¤ï¼migrateãcleanãinfoãvalidateãundoãbaseline å repairã\n\næ³¨ï¼åå½ä»¤çä½¿ç¨æ¹æ³ç»èè¯·æ¥éå®æ¹ææ¡£ã\n\n\n# æ¯æçæ°æ®åº\n\n * oracle\n * sql server\n * db2\n * mysql\n * mariadb\n * postgresql\n * redshift\n * cockroachdb\n * sap hana\n * sybase ase\n * informix\n * h2\n * hsqldb\n * derby\n * sqlite\n\n\n# èµæ\n\n| github | å®æ¹ææ¡£ |\n\n\n# ðª ä¼ éé¨\n\n| æç github åå®¢ | db-tutorial é¦é¡µ |',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"æ°æ®åºä¸­é´ä»¶åä»£ç",frontmatter:{title:"æ°æ®åºä¸­é´ä»¶åä»£ç",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æ°æ®åºä¸­é´ä»¶"],tags:["æ°æ®åº","ä¸­é´ä»¶"],permalink:"/pages/02d9f1/"},regularPath:"/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6/",relativePath:"02.æ°æ®åºä¸­é´ä»¶/README.md",key:"v-aeaab6a8",path:"/pages/02d9f1/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:16},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:89},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:311}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# æ°æ®åºä¸­é´ä»¶åä»£ç\n\n\n# ð åå®¹\n\n * ShardingSphere ç®ä»\n * ShardingSphere Jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n\n# ð èµæ\n\n * Seata - åå¸å¼äºå¡ä¸­é´ä»¶ã\n * ShardingSphere - å³ç³»åæ°æ®åºè¯»ååç¦»ãååºåè¡¨ä¸­é´ä»¶ã\n * Flyway - å³ç³»åæ°æ®åºçæ¬ç®¡çä¸­é´ä»¶ã\n * Canal - åºäº MySQL ç binlogï¼æä¾å¢éæ°æ®è®¢éåæ¶è´¹ã\n * Twemproxy - Twitter å¼æºçä¸ä¸ª Redis å Memcache çä¸­é´ä»£çæå¡ã\n * Codis - Redis åå¸å¼éç¾¤æ¹æ¡ã\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# æ°æ®åºä¸­é´ä»¶åä»£ç\n\n\n# ð åå®¹\n\n * shardingsphere ç®ä»\n * shardingsphere jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n\n# ð èµæ\n\n * seata - åå¸å¼äºå¡ä¸­é´ä»¶ã\n * shardingsphere - å³ç³»åæ°æ®åºè¯»ååç¦»ãååºåè¡¨ä¸­é´ä»¶ã\n * flyway - å³ç³»åæ°æ®åºçæ¬ç®¡çä¸­é´ä»¶ã\n * canal - åºäº mysql ç binlogï¼æä¾å¢éæ°æ®è®¢éåæ¶è´¹ã\n * twemproxy - twitter å¼æºçä¸ä¸ª redis å memcache çä¸­é´ä»£çæå¡ã\n * codis - redis åå¸å¼éç¾¤æ¹æ¡ã\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"å³ç³»åæ°æ®åºé¢è¯",frontmatter:{title:"å³ç³»åæ°æ®åºé¢è¯",date:"2020-01-15T23:21:02.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/c798e3/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/01.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9D%A2%E8%AF%95.html",relativePath:"03.å³ç³»åæ°æ®åº/01.ç»¼å/01.å³ç³»åæ°æ®åºé¢è¯.md",key:"v-1a9f322e",path:"/pages/c798e3/",headers:[{level:2,title:"ä¸ãç´¢å¼åçº¦æ",slug:"ä¸ãç´¢å¼åçº¦æ",normalizedTitle:"ä¸ãç´¢å¼åçº¦æ",charIndex:15},{level:3,title:"ä»ä¹æ¯ç´¢å¼",slug:"ä»ä¹æ¯ç´¢å¼",normalizedTitle:"ä»ä¹æ¯ç´¢å¼",charIndex:27},{level:3,title:"ç´¢å¼çä¼ç¼ºç¹",slug:"ç´¢å¼çä¼ç¼ºç¹",normalizedTitle:"ç´¢å¼çä¼ç¼ºç¹",charIndex:81},{level:3,title:"ä½æ¶ä½¿ç¨ç´¢å¼",slug:"ä½æ¶ä½¿ç¨ç´¢å¼",normalizedTitle:"ä½æ¶ä½¿ç¨ç´¢å¼",charIndex:462},{level:3,title:"ç´¢å¼çç±»å",slug:"ç´¢å¼çç±»å",normalizedTitle:"ç´¢å¼çç±»å",charIndex:769},{level:3,title:"ç´¢å¼çæ°æ®ç»æ",slug:"ç´¢å¼çæ°æ®ç»æ",normalizedTitle:"ç´¢å¼çæ°æ®ç»æ",charIndex:1211},{level:4,title:"B æ ",slug:"b-æ ",normalizedTitle:"b æ ",charIndex:1239},{level:4,title:"B+ æ ",slug:"b-æ -2",normalizedTitle:"b+ æ ",charIndex:1243},{level:4,title:"B æ  vs. B+ æ ",slug:"b-æ -vs-b-æ ",normalizedTitle:"b æ  vs. b+ æ ",charIndex:2198},{level:4,title:"Hash",slug:"hash",normalizedTitle:"hash",charIndex:2456},{level:3,title:"ç´¢å¼ç­ç¥",slug:"ç´¢å¼ç­ç¥",normalizedTitle:"ç´¢å¼ç­ç¥",charIndex:2822},{level:4,title:"ç´¢å¼åºæ¬åå",slug:"ç´¢å¼åºæ¬åå",normalizedTitle:"ç´¢å¼åºæ¬åå",charIndex:2830},{level:4,title:"ç¬ç«çå",slug:"ç¬ç«çå",normalizedTitle:"ç¬ç«çå",charIndex:2947},{level:4,title:"åç¼ç´¢å¼åç´¢å¼éæ©æ§",slug:"åç¼ç´¢å¼åç´¢å¼éæ©æ§",normalizedTitle:"åç¼ç´¢å¼åç´¢å¼éæ©æ§",charIndex:3145},{level:4,title:"å¤åç´¢å¼",slug:"å¤åç´¢å¼",normalizedTitle:"å¤åç´¢å¼",charIndex:3633},{level:4,title:"èç°ç´¢å¼",slug:"èç°ç´¢å¼",normalizedTitle:"èç°ç´¢å¼",charIndex:3830},{level:4,title:"è¦çç´¢å¼",slug:"è¦çç´¢å¼",normalizedTitle:"è¦çç´¢å¼",charIndex:4025},{level:4,title:"ä½¿ç¨ç´¢å¼æ«ææ¥åæåº",slug:"ä½¿ç¨ç´¢å¼æ«ææ¥åæåº",normalizedTitle:"ä½¿ç¨ç´¢å¼æ«ææ¥åæåº",charIndex:4212},{level:4,title:"æå·¦åç¼å¹éåå",slug:"æå·¦åç¼å¹éåå",normalizedTitle:"æå·¦åç¼å¹éåå",charIndex:4301},{level:4,title:"= å in å¯ä»¥ä¹±åº",slug:"å-in-å¯ä»¥ä¹±åº",normalizedTitle:"= å in å¯ä»¥ä¹±åº",charIndex:4654},{level:3,title:"çº¦æ",slug:"çº¦æ",normalizedTitle:"çº¦æ",charIndex:20},{level:2,title:"äºãå¹¶åæ§å¶",slug:"äºãå¹¶åæ§å¶",normalizedTitle:"äºãå¹¶åæ§å¶",charIndex:5187},{level:3,title:"ä¹è§éåæ²è§é",slug:"ä¹è§éåæ²è§é",normalizedTitle:"ä¹è§éåæ²è§é",charIndex:5198},{level:3,title:"è¡çº§éåè¡¨çº§é",slug:"è¡çº§éåè¡¨çº§é",normalizedTitle:"è¡çº§éåè¡¨çº§é",charIndex:5525},{level:3,title:"è¯»åé",slug:"è¯»åé",normalizedTitle:"è¯»åé",charIndex:5902},{level:3,title:"æåé",slug:"æåé",normalizedTitle:"æåé",charIndex:6118},{level:3,title:"MVCC",slug:"mvcc",normalizedTitle:"mvcc",charIndex:6271},{level:3,title:"Next-key é",slug:"next-key-é",normalizedTitle:"next-key é",charIndex:6714},{level:2,title:"ä¸ãäºå¡",slug:"ä¸ãäºå¡",normalizedTitle:"ä¸ãäºå¡",charIndex:7447},{level:3,title:"ACID",slug:"acid",normalizedTitle:"acid",charIndex:7510},{level:3,title:"å¹¶åä¸è´æ§é®é¢",slug:"å¹¶åä¸è´æ§é®é¢",normalizedTitle:"å¹¶åä¸è´æ§é®é¢",charIndex:7779},{level:3,title:"äºå¡éç¦»",slug:"äºå¡éç¦»",normalizedTitle:"äºå¡éç¦»",charIndex:8235},{level:3,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡",normalizedTitle:"åå¸å¼äºå¡",charIndex:8599},{level:4,title:"ä¸¤é¶æ®µæäº¤",slug:"ä¸¤é¶æ®µæäº¤",normalizedTitle:"ä¸¤é¶æ®µæäº¤",charIndex:8734},{level:4,title:"ææ§äºå¡",slug:"ææ§äºå¡",normalizedTitle:"ææ§äºå¡",charIndex:8979},{level:4,title:"äºå¡æ¹æ¡å¯¹æ¯",slug:"äºå¡æ¹æ¡å¯¹æ¯",normalizedTitle:"äºå¡æ¹æ¡å¯¹æ¯",charIndex:9415},{level:2,title:"åãååºåè¡¨",slug:"åãååºåè¡¨",normalizedTitle:"åãååºåè¡¨",charIndex:9645},{level:3,title:"ä»ä¹æ¯ååºåè¡¨",slug:"ä»ä¹æ¯ååºåè¡¨",normalizedTitle:"ä»ä¹æ¯ååºåè¡¨",charIndex:9656},{level:4,title:"åç´åå",slug:"åç´åå",normalizedTitle:"åç´åå",charIndex:9830},{level:4,title:"æ°´å¹³æå",slug:"æ°´å¹³æå",normalizedTitle:"æ°´å¹³æå",charIndex:9686},{level:4,title:"ååºåè¡¨çä¼ç¹",slug:"ååºåè¡¨çä¼ç¹",normalizedTitle:"ååºåè¡¨çä¼ç¹",charIndex:10408},{level:4,title:"ååºåè¡¨ç­ç¥",slug:"ååºåè¡¨ç­ç¥",normalizedTitle:"ååºåè¡¨ç­ç¥",charIndex:10609},{level:3,title:"ååºåè¡¨ä¸­é´ä»¶",slug:"ååºåè¡¨ä¸­é´ä»¶",normalizedTitle:"ååºåè¡¨ä¸­é´ä»¶",charIndex:10881},{level:4,title:"å¸¸è§çååºåè¡¨ä¸­é´ä»¶",slug:"å¸¸è§çååºåè¡¨ä¸­é´ä»¶",normalizedTitle:"å¸¸è§çååºåè¡¨ä¸­é´ä»¶",charIndex:10989},{level:4,title:"ååºåè¡¨ä¸­é´ä»¶ææ¯éå",slug:"ååºåè¡¨ä¸­é´ä»¶ææ¯éå",normalizedTitle:"ååºåè¡¨ä¸­é´ä»¶ææ¯éå",charIndex:11778},{level:3,title:"ååºåè¡¨çé®é¢",slug:"ååºåè¡¨çé®é¢",normalizedTitle:"ååºåè¡¨çé®é¢",charIndex:12285},{level:4,title:"åå¸å¼äºå¡",slug:"åå¸å¼äºå¡-2",normalizedTitle:"åå¸å¼äºå¡",charIndex:8599},{level:4,title:"è·¨èç¹ Join",slug:"è·¨èç¹-join",normalizedTitle:"è·¨èç¹ join",charIndex:12585},{level:4,title:"è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°",slug:"è·¨èç¹ç-count-order-by-group-by-ä»¥åèåå½æ°",normalizedTitle:"è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°",charIndex:12713},{level:4,title:"åå¸å¼ ID",slug:"åå¸å¼-id",normalizedTitle:"åå¸å¼ id",charIndex:10866},{level:4,title:"æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢",slug:"æ°æ®è¿ç§»-å®¹éè§å-æ©å®¹ç­é®é¢",normalizedTitle:"æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢",charIndex:13360},{level:2,title:"äºãéç¾¤",slug:"äºãéç¾¤",normalizedTitle:"äºãéç¾¤",charIndex:13548},{level:3,title:"å¤å¶æºå¶",slug:"å¤å¶æºå¶",normalizedTitle:"å¤å¶æºå¶",charIndex:13653},{level:3,title:"è¯»ååç¦»",slug:"è¯»ååç¦»",normalizedTitle:"è¯»ååç¦»",charIndex:11185},{level:2,title:"å­ãæ°æ®åºä¼å",slug:"å­ãæ°æ®åºä¼å",normalizedTitle:"å­ãæ°æ®åºä¼å",charIndex:14147},{level:3,title:"SQL ä¼å",slug:"sql-ä¼å",normalizedTitle:"sql ä¼å",charIndex:14168},{level:4,title:"æ§è¡è®¡å",slug:"æ§è¡è®¡å",normalizedTitle:"æ§è¡è®¡å",charIndex:14317},{level:4,title:"è®¿é®æ°æ®ä¼å",slug:"è®¿é®æ°æ®ä¼å",normalizedTitle:"è®¿é®æ°æ®ä¼å",charIndex:14549},{level:4,title:"éææ¥è¯¢æ¹å¼",slug:"éææ¥è¯¢æ¹å¼",normalizedTitle:"éææ¥è¯¢æ¹å¼",charIndex:14805},{level:5,title:"ååæ¥è¯¢",slug:"ååæ¥è¯¢",normalizedTitle:"ååæ¥è¯¢",charIndex:14815},{level:5,title:"åè§£å³èæ¥è¯¢",slug:"åè§£å³èæ¥è¯¢",normalizedTitle:"åè§£å³èæ¥è¯¢",charIndex:15124},{level:4,title:"SQL è¯­å¥ç»è",slug:"sql-è¯­å¥ç»è",normalizedTitle:"sql è¯­å¥ç»è",charIndex:15715},{level:5,title:"éæ©æææççè¡¨åé¡ºåº",slug:"éæ©æææççè¡¨åé¡ºåº",normalizedTitle:"éæ©æææççè¡¨åé¡ºåº",charIndex:15727},{level:5,title:"WHERE å­å¥ä¸­çè¿æ¥é¡ºåº",slug:"where-å­å¥ä¸­çè¿æ¥é¡ºåº",normalizedTitle:"where å­å¥ä¸­çè¿æ¥é¡ºåº",charIndex:16190},{level:5,title:"SELECT å­å¥ä¸­é¿åä½¿ç¨ * å·",slug:"select-å­å¥ä¸­é¿åä½¿ç¨-å·",normalizedTitle:"select å­å¥ä¸­é¿åä½¿ç¨ * å·",charIndex:16447},{level:5,title:"ç¨ TRUNCATE æ¿ä»£ DELETE",slug:"ç¨-truncate-æ¿ä»£-delete",normalizedTitle:"ç¨ truncate æ¿ä»£ delete",charIndex:16602},{level:5,title:"ä½¿ç¨åé¨å½æ°æé« SQL æç",slug:"ä½¿ç¨åé¨å½æ°æé«-sql-æç",normalizedTitle:"ä½¿ç¨åé¨å½æ°æé« sql æç",charIndex:16712},{level:5,title:"ä½¿ç¨è¡¨æåçå«å",slug:"ä½¿ç¨è¡¨æåçå«å",normalizedTitle:"ä½¿ç¨è¡¨æåçå«å",charIndex:16800},{level:5,title:"SQL å³é®å­å¤§å",slug:"sql-å³é®å­å¤§å",normalizedTitle:"sql å³é®å­å¤§å",charIndex:16867},{level:5,title:"ç¨ >= æ¿ä»£ >",slug:"ç¨-æ¿ä»£",normalizedTitle:"ç¨ &gt;= æ¿ä»£ &gt;",charIndex:null},{level:5,title:"ç¨ IN æ¿ä»£ OR",slug:"ç¨-in-æ¿ä»£-or",normalizedTitle:"ç¨ in æ¿ä»£ or",charIndex:17107},{level:5,title:"æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå",slug:"æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå",normalizedTitle:"æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå",charIndex:17254},{level:5,title:"SQL å³é®å­å°½éå¤§å",slug:"sql-å³é®å­å°½éå¤§å",normalizedTitle:"sql å³é®å­å°½éå¤§å",charIndex:17486},{level:3,title:"ç»æä¼å",slug:"ç»æä¼å",normalizedTitle:"ç»æä¼å",charIndex:14175},{level:4,title:"æ°æ®ç±»åä¼ååå",slug:"æ°æ®ç±»åä¼ååå",normalizedTitle:"æ°æ®ç±»åä¼ååå",charIndex:17643},{level:4,title:"èå¼ååèå¼",slug:"èå¼ååèå¼",normalizedTitle:"èå¼ååèå¼",charIndex:17588},{level:3,title:"éç½®ä¼å",slug:"éç½®ä¼å",normalizedTitle:"éç½®ä¼å",charIndex:14180},{level:3,title:"ç¡¬ä»¶ä¼å",slug:"ç¡¬ä»¶ä¼å",normalizedTitle:"ç¡¬ä»¶ä¼å",charIndex:14185},{level:2,title:"ä¸ãæ°æ®åºçè®º",slug:"ä¸ãæ°æ®åºçè®º",normalizedTitle:"ä¸ãæ°æ®åºçè®º",charIndex:18211},{level:3,title:"å½æ°ä¾èµ",slug:"å½æ°ä¾èµ",normalizedTitle:"å½æ°ä¾èµ",charIndex:18223},{level:3,title:"å¼å¸¸",slug:"å¼å¸¸",normalizedTitle:"å¼å¸¸",charIndex:18433},{level:3,title:"èå¼",slug:"èå¼",normalizedTitle:"èå¼",charIndex:17588},{level:4,title:"ç¬¬ä¸èå¼ (1NF)",slug:"ç¬¬ä¸èå¼-1nf",normalizedTitle:"ç¬¬ä¸èå¼ (1nf)",charIndex:19013},{level:4,title:"ç¬¬äºèå¼ (2NF)",slug:"ç¬¬äºèå¼-2nf",normalizedTitle:"ç¬¬äºèå¼ (2nf)",charIndex:19035},{level:4,title:"ç¬¬ä¸èå¼ (3NF)",slug:"ç¬¬ä¸èå¼-3nf",normalizedTitle:"ç¬¬ä¸èå¼ (3nf)",charIndex:19820},{level:2,title:"å«ãMysql å­å¨å¼æ",slug:"å«ãmysql-å­å¨å¼æ",normalizedTitle:"å«ãmysql å­å¨å¼æ",charIndex:20038},{level:3,title:"InnoDB vs. MyISAM",slug:"innodb-vs-myisam",normalizedTitle:"innodb vs. myisam",charIndex:20340},{level:2,title:"ä¹ãæ°æ®åºæ¯è¾",slug:"ä¹ãæ°æ®åºæ¯è¾",normalizedTitle:"ä¹ãæ°æ®åºæ¯è¾",charIndex:20709},{level:3,title:"å¸¸è§æ°æ®åºæ¯è¾",slug:"å¸¸è§æ°æ®åºæ¯è¾",normalizedTitle:"å¸¸è§æ°æ®åºæ¯è¾",charIndex:20721},{level:3,title:"Oracle vs. Mysql",slug:"oracle-vs-mysql",normalizedTitle:"oracle vs. mysql",charIndex:21127},{level:4,title:"æ°æ®åºå¯¹è±¡å·®å¼",slug:"æ°æ®åºå¯¹è±¡å·®å¼",normalizedTitle:"æ°æ®åºå¯¹è±¡å·®å¼",charIndex:21203},{level:4,title:"SQL å·®å¼",slug:"sql-å·®å¼",normalizedTitle:"sql å·®å¼",charIndex:21370},{level:4,title:"äºå¡å·®å¼",slug:"äºå¡å·®å¼",normalizedTitle:"äºå¡å·®å¼",charIndex:21764},{level:3,title:"æ°æ®ç±»åæ¯è¾",slug:"æ°æ®ç±»åæ¯è¾",normalizedTitle:"æ°æ®ç±»åæ¯è¾",charIndex:21999},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:22664}],headersStr:"ä¸ãç´¢å¼åçº¦æ ä»ä¹æ¯ç´¢å¼ ç´¢å¼çä¼ç¼ºç¹ ä½æ¶ä½¿ç¨ç´¢å¼ ç´¢å¼çç±»å ç´¢å¼çæ°æ®ç»æ B æ  B+ æ  B æ  vs. B+ æ  Hash ç´¢å¼ç­ç¥ ç´¢å¼åºæ¬åå ç¬ç«çå åç¼ç´¢å¼åç´¢å¼éæ©æ§ å¤åç´¢å¼ èç°ç´¢å¼ è¦çç´¢å¼ ä½¿ç¨ç´¢å¼æ«ææ¥åæåº æå·¦åç¼å¹éåå = å in å¯ä»¥ä¹±åº çº¦æ äºãå¹¶åæ§å¶ ä¹è§éåæ²è§é è¡çº§éåè¡¨çº§é è¯»åé æåé MVCC Next-key é ä¸ãäºå¡ ACID å¹¶åä¸è´æ§é®é¢ äºå¡éç¦» åå¸å¼äºå¡ ä¸¤é¶æ®µæäº¤ ææ§äºå¡ äºå¡æ¹æ¡å¯¹æ¯ åãååºåè¡¨ ä»ä¹æ¯ååºåè¡¨ åç´åå æ°´å¹³æå ååºåè¡¨çä¼ç¹ ååºåè¡¨ç­ç¥ ååºåè¡¨ä¸­é´ä»¶ å¸¸è§çååºåè¡¨ä¸­é´ä»¶ ååºåè¡¨ä¸­é´ä»¶ææ¯éå ååºåè¡¨çé®é¢ åå¸å¼äºå¡ è·¨èç¹ Join è·¨èç¹ç count,order by,group by ä»¥åèåå½æ° åå¸å¼ ID æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢ äºãéç¾¤ å¤å¶æºå¶ è¯»ååç¦» å­ãæ°æ®åºä¼å SQL ä¼å æ§è¡è®¡å è®¿é®æ°æ®ä¼å éææ¥è¯¢æ¹å¼ ååæ¥è¯¢ åè§£å³èæ¥è¯¢ SQL è¯­å¥ç»è éæ©æææççè¡¨åé¡ºåº WHERE å­å¥ä¸­çè¿æ¥é¡ºåº SELECT å­å¥ä¸­é¿åä½¿ç¨ * å· ç¨ TRUNCATE æ¿ä»£ DELETE ä½¿ç¨åé¨å½æ°æé« SQL æç ä½¿ç¨è¡¨æåçå«å SQL å³é®å­å¤§å ç¨ >= æ¿ä»£ > ç¨ IN æ¿ä»£ OR æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå SQL å³é®å­å°½éå¤§å ç»æä¼å æ°æ®ç±»åä¼ååå èå¼ååèå¼ éç½®ä¼å ç¡¬ä»¶ä¼å ä¸ãæ°æ®åºçè®º å½æ°ä¾èµ å¼å¸¸ èå¼ ç¬¬ä¸èå¼ (1NF) ç¬¬äºèå¼ (2NF) ç¬¬ä¸èå¼ (3NF) å«ãMysql å­å¨å¼æ InnoDB vs. MyISAM ä¹ãæ°æ®åºæ¯è¾ å¸¸è§æ°æ®åºæ¯è¾ Oracle vs. Mysql æ°æ®åºå¯¹è±¡å·®å¼ SQL å·®å¼ äºå¡å·®å¼ æ°æ®ç±»åæ¯è¾ åèèµæ",content:"# å³ç³»åæ°æ®åºé¢è¯\n\n\n# ä¸ãç´¢å¼åçº¦æ\n\n\n# ä»ä¹æ¯ç´¢å¼\n\nç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸æå¤ä¸ªåçå¼è¿è¡æåºçç»æï¼æ¯å¸®å©æ°æ®åºé«ææ¥è¯¢æ°æ®çæ°æ®ç»æã\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ InnoDB ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº I/O åä¸ºé¡ºåº I/Oã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼INSERT/UPDATE/DELETEï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\nç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * è¡¨ç»å¸¸è¿è¡ SELECT æä½ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ï¼\n * ååç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ INSERT/UPDATE/DELETE ï¼- éè¦æ´æ°ç´¢å¼ç©ºé´ï¼\n * éå¸¸å°çè¡¨ - å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ååä¸ç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­ - ç´¢å¼å°±ä¼ç»å¸¸ä¸å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ Nosqlã\n\n\n# ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\nä»é»è¾ç±»åä¸ååï¼å³ä¸è¬åå»ºè¡¨æ¶è®¾ç½®çç´¢å¼ç±»åï¼ï¼\n\n * å¯ä¸ç´¢å¼ï¼UNIQUEï¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n * ä¸»é®ç´¢å¼ï¼PRIMARYï¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼ä¸åè®¸æç©ºå¼ãä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n * æ®éç´¢å¼ï¼INDEXï¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n * ç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\nä»ç©çå­å¨ä¸ååï¼\n\n * èéç´¢å¼(Clustered)ï¼è¡¨ä¸­åè¡çç©çé¡ºåºä¸é®å¼çé»è¾ï¼ç´¢å¼ï¼é¡ºåºç¸åï¼æ¯ä¸ªè¡¨åªè½æä¸ä¸ªã\n * éèéç´¢å¼(Non-clustered)ï¼éèéç´¢å¼æå®è¡¨çé»è¾é¡ºåºï¼ä¹å¯ä»¥è§ä¸ºäºçº§ç´¢å¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\n\n# ç´¢å¼çæ°æ®ç»æ\n\nä¸»æµæ°æ®åºçç´¢å¼ä¸è¬ä½¿ç¨çæ°æ®ç»æä¸ºï¼B æ ãB+ æ ã\n\n# B æ \n\nä¸æ£µ M é¶ç B-Tree æ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * æ¯ä¸ªç»ç¹è³å¤æ M ä¸ªå­©å­ï¼\n * é¤æ ¹ç»ç¹åå¶ç»ç¹å¤ï¼å¶å®æ¯ä¸ªç»ç¹è³å°æ M/2 ä¸ªå­©å­ï¼\n * æ ¹ç»ç¹è³å°æä¸¤ä¸ªå­©å­ï¼é¤éè¯¥æ ä»åå«ä¸ä¸ªç»ç¹ï¼ï¼\n * ææå¶ç»ç¹å¨åä¸å±ï¼å¶ç»ç¹ä¸åå«ä»»ä½å³é®å­ä¿¡æ¯ï¼\n * æ K ä¸ªå³é®å­çéå¶ç»ç¹æ°å¥½åå« K+1 ä¸ªå­©å­ï¼\n\nå¯¹äºä»»æç»ç¹ï¼å¶åé¨çå³é®å­ Key æ¯ååºæåçãæ¯ä¸ªèç¹ä¸­é½åå«äº dataã\n\n\n\nå¯¹äºæ¯ä¸ªç»ç¹ï¼ä¸»è¦åå«ä¸ä¸ªå³é®å­æ°ç» Key[]ï¼ä¸ä¸ªæéæ°ç»ï¼æåå¿å­ï¼Son[]ã\n\nå¨ B-Tree åï¼æ¥æ¾çæµç¨æ¯ï¼\n\n 1. ä½¿ç¨é¡ºåºæ¥æ¾ï¼æ°ç»é¿åº¦è¾ç­æ¶ï¼ææåæ¥æ¾æ¹æ³æ¥æ¾ Key[] æ°ç»ï¼è¥æ¾å°å³é®å­ Kï¼åè¿åè¯¥ç»ç¹çå°åå K å¨ Key[] ä¸­çä½ç½®ï¼\n 2. å¦åï¼å¯ç¡®å® K å¨æä¸ª Key[i] å Key[i+1] ä¹é´ï¼åä» Son[i] ææçå­ç»ç¹ç»§ç»­æ¥æ¾ï¼ç´å°å¨æç»ç¹ä¸­æ¥æ¾æåï¼\n 3. æç´è³æ¾å°å¶ç»ç¹ä¸å¶ç»ç¹ä¸­çæ¥æ¾ä»ä¸æåæ¶ï¼æ¥æ¾è¿ç¨å¤±è´¥ã\n\n# B+ æ \n\nB+Tree æ¯ B-Tree çåç§ï¼\n\n * æ¯ä¸ªèç¹çæéä¸éä¸º 2d èä¸æ¯ 2d+1ï¼d ä¸ºèç¹çåºåº¦ï¼ã\n * éå¶å­èç¹ä¸å­å¨ dataï¼åªå­å¨ keyï¼å¶å­èç¹ä¸å­å¨æéã\n\n\n\nç±äºå¹¶ä¸æ¯ææèç¹é½å·æç¸åçåï¼å æ­¤ B+Tree ä¸­å¶èç¹ååèç¹ä¸è¬å¤§å°ä¸åãè¿ç¹ä¸ B-Tree ä¸åï¼è½ç¶ B-Tree ä¸­ä¸åèç¹å­æ¾ç key åæéå¯è½æ°éä¸ä¸è´ï¼ä½æ¯æ¯ä¸ªèç¹çååä¸éæ¯ä¸è´çï¼æä»¥å¨å®ç°ä¸­ B-Tree å¾å¾å¯¹æ¯ä¸ªèç¹ç³è¯·åç­å¤§å°çç©ºé´ã\n\nå¸¦æé¡ºåºè®¿é®æéç B+Tree\n\nä¸è¬å¨æ°æ®åºç³»ç»ææä»¶ç³»ç»ä¸­ä½¿ç¨ç B+Tree ç»æé½å¨ç»å¸ B+Tree çåºç¡ä¸è¿è¡äºä¼åï¼å¢å äºé¡ºåºè®¿é®æéã\n\n\n\nå¨ B+Tree çæ¯ä¸ªå¶å­èç¹å¢å ä¸ä¸ªæåç¸é»å¶å­èç¹çæéï¼å°±å½¢æäºå¸¦æé¡ºåºè®¿é®æéç B+Treeã\n\nè¿ä¸ªä¼åçç®çæ¯ä¸ºäºæé«åºé´è®¿é®çæ§è½ï¼ä¾å¦ä¸å¾ä¸­å¦æè¦æ¥è¯¢ key ä¸ºä» 18 å° 49 çæææ°æ®è®°å½ï¼å½æ¾å° 18 åï¼åªéé¡ºçèç¹åæéé¡ºåºéåå°±å¯ä»¥ä¸æ¬¡æ§è®¿é®å°æææ°æ®èç¹ï¼æå¤§æå°äºåºé´æ¥è¯¢æçã\n\n# B æ  vs. B+ æ \n\n * B+ æ æ´éåå¤é¨å­å¨(ä¸è¬æç£çå­å¨)ï¼ç±äºåèç¹(éå¶å­èç¹)ä¸å­å¨ dataï¼æä»¥ä¸ä¸ªèç¹å¯ä»¥å­å¨æ´å¤çåèç¹ï¼æ¯ä¸ªèç¹è½ç´¢å¼çèå´æ´å¤§æ´ç²¾ç¡®ãä¹å°±æ¯è¯´ä½¿ç¨ B+ æ åæ¬¡ç£ç IO çä¿¡æ¯éç¸æ¯è¾ B æ æ´å¤§ï¼IO æçæ´é«ã\n * Mysql æ¯å³ç³»åæ°æ®åºï¼ç»å¸¸ä¼æç§åºé´æ¥è®¿é®æä¸ªç´¢å¼åï¼B+ æ çå¶å­èç¹é´æé¡ºåºå»ºç«äºé¾æéï¼å å¼ºäºåºé´è®¿é®æ§ï¼æä»¥ B+ æ å¯¹ç´¢å¼åä¸çåºé´èå´æ¥è¯¢å¾åå¥½ãè B æ æ¯ä¸ªèç¹ç key å data å¨ä¸èµ·ï¼æ æ³è¿è¡åºé´æ¥æ¾ã\n\n# Hash\n\n> Hash ç´¢å¼åªæç²¾ç¡®å¹éç´¢å¼ææåçæ¥è¯¢æææã\n\nå¯¹äºæ¯ä¸è¡æ°æ®ï¼å¯¹ææçç´¢å¼åè®¡ç®ä¸ä¸ª hashcodeãåå¸ç´¢å¼å°ææç hashcode å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨ Hash è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nåå¸ç»æç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nåå¸ç»æç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ãå¦ï¼å¨æ°æ®å (A,B) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å Aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ WHERE price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çªï¼åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n\n\n# ç´¢å¼ç­ç¥\n\n# ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ï¼\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ï¼\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ï¼\n * é¢ç¹ä½ä¸º WHERE è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼\n\n# ç¬ç«çå\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nSELECT actor_id FROM actor WHERE actor_id + 1 = 5;\nSELECT ... WHERE TO_DAYS(current_date) - TO_DAYS(date_col) <= 10;\n\n\n# åç¼ç´¢å¼åç´¢å¼éæ©æ§\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè§£å³æ¹æ³æ¯ï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nå¯¹äº BLOB/TEXT/VARCHAR è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nè¦éæ©è¶³å¤é¿çåç¼ä»¥ä¿è¯è¾é«çéæ©æ§ï¼åæ¶åä¸è½å¤ªé¿ï¼èçº¦ç©ºé´ï¼ã\n\nâ ä½æç¤ºä¾ï¼\n\nSELECT COUNT(*) AS cnt, city FROM sakila.city_demo\nGROUP BY city ORDER BY cnt DESC LIMIT 10;\n\n\nâ é«æç¤ºä¾ï¼\n\nSELECT COUNT(*) AS cnt, LEFT(city, 3) AS pref FROM sakila.city_demo\nGROUP BY city ORDER BY cnt DESC LIMIT 10;\n\n\n# å¤åç´¢å¼\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè WHERE å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¸¾ä¾æ¥è¯´ï¼æä¸å¼  user è¡¨ï¼å¶ä¸­å« name, sex, age ä¸ä¸ªåï¼å¦æå°è¿ä¸èç»åä¸ºå¤åç´¢å¼ï¼åºè¯¥ç¨ä»ä¹æ ·çé¡ºåºå¢ï¼ä»éæ©æ§é«çè§åº¦æ¥çï¼name > age > sexã\n\n# èç°ç´¢å¼\n\nèç°ç´¢å¼ä¸æ¯ä¸ç§åç¬çç´¢å¼ç±»åï¼èæ¯ä¸ç§æ°æ®å­å¨æ¹å¼ãå·ä½ç»èä¾èµäºå®ç°æ¹å¼ãå¦ InnoDB çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº B æ çç´¢å¼åæ°æ®è¡ã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nè¥æ²¡æå®ä¹ä¸»é®ï¼InnoDB ä¼éå¼å®ä¹ä¸ä¸ªä¸»é®æ¥ä½ä¸ºèç°ç´¢å¼ã\n\n# è¦çç´¢å¼\n\nç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ã\n\nå·æä»¥ä¸ä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ¡ç®éå¸¸è¿å°äºæ°æ®è¡çå¤§å°ï¼æä»¥è¥åªè¯»åç´¢å¼ï¼è½å¤§å¤§åå°æ°æ®è®¿é®éã\n * ä¸äºå­å¨å¼æï¼ä¾å¦ MyISAMï¼å¨åå­ä¸­åªç¼å­ç´¢å¼ï¼èæ°æ®ä¾èµäºæä½ç³»ç»æ¥ç¼å­ãå æ­¤ï¼åªè®¿é®ç´¢å¼å¯ä»¥ä¸ä½¿ç¨ç³»ç»è°ç¨ï¼éå¸¸æ¯è¾è´¹æ¶ï¼ã\n * å¯¹äº InnoDB å¼æï¼è¥è¾å©ç´¢å¼è½å¤è¦çæ¥è¯¢ï¼åæ éè®¿é®ä¸»ç´¢å¼ã\n\n# ä½¿ç¨ç´¢å¼æ«ææ¥åæåº\n\nMysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n\n# æå·¦åç¼å¹éåå\n\nMySQL ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,BETWEEN,LIKE) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¾å­ï¼\n\n * å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ a = 1 and b = 2 and c > 3 and d = 4ï¼åä¼å¨æ¯ä¸ªèç¹ä¾æ¬¡å½ä¸­ aãbãcï¼æ æ³å½ä¸­ dã(å¾ç®åï¼ç´¢å¼å½ä¸­åªè½æ¯ç¸ç­çæåµï¼ä¸è½æ¯èå´å¹é)\n\n# = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè=ãin ç­çé¡ºåºï¼Mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nä¾å­ï¼å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼MySQL ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcã\n\n\n# çº¦æ\n\næ°æ®åºçº¦æï¼CONSTRAINTï¼æåªäºï¼\n\n * NOT NULL - ç¨äºæ§å¶å­æ®µçåå®¹ä¸å®ä¸è½ä¸ºç©ºï¼NULLï¼ã\n * UNIQUE - å­æ®µåå®¹ä¸è½éå¤ï¼ä¸ä¸ªè¡¨åè®¸æå¤ä¸ª Unique çº¦æã\n * PRIMARY KEY - æ°æ®è¡¨ä¸­å¯¹å¨å­æ°æ®å¯¹è±¡äºä»¥å¯ä¸åå®æ´æ è¯çæ°æ®åæå±æ§çç»åï¼å®å¨ä¸ä¸ªè¡¨ä¸­åªåè®¸æä¸ä¸ªãä¸»é®çåå¼ä¸è½ä¸ºç©ºå¼ï¼Nullï¼ã\n * FOREIGN KEY - å¨ä¸ä¸ªè¡¨ä¸­å­å¨çå¦ä¸ä¸ªè¡¨çä¸»é®ç§°æ­¤è¡¨çå¤é®ãç¨äºé¢é²ç ´åè¡¨ä¹é´è¿æ¥çå¨ä½ï¼ä¹è½é²æ­¢éæ³æ°æ®æå¥å¤é®åï¼å ä¸ºå®å¿é¡»æ¯å®æåçé£ä¸ªè¡¨ä¸­çå¼ä¹ä¸ã\n * CHECK - ç¨äºæ§å¶å­æ®µçå¼èå´ã\n\n\n# äºãå¹¶åæ§å¶\n\n\n# ä¹è§éåæ²è§é\n\n>  * æ°æ®åºçä¹è§éåæ²è§éæ¯ä»ä¹ï¼\n>  * æ°æ®åºçä¹è§éåæ²è§éå¦ä½å®ç°ï¼\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼COMMITï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³\n\n\n# è¡çº§éåè¡¨çº§é\n\n>  * ä»ä¹æ¯è¡çº§éåè¡¨çº§éï¼\n>  * ä»ä¹æ¶åç¨è¡çº§éï¼ä»ä¹æ¶åç¨è¡¨çº§éï¼\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼MySQL ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - ä»å¯¹æå®çè¡è®°å½è¿è¡å éï¼è¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\näºèéè¦æè¡¡ï¼\n\n * éå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ã\n * éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨ InnoDB ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼InnoDB å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# è¯»åé\n\n>  * ä»ä¹æ¯è¯»åéï¼\n\n * ç¬äº«éï¼Exclusiveï¼ï¼ç®åä¸º X éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼SELECT ... FOR UPDATE;\n * å±äº«éï¼Sharedï¼ï¼ç®åä¸º S éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼SELECT ... LOCK IN SHARE MODE;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\nInnoDB ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# æåé\n\n>  * ä»ä¹æ¯æåéï¼\n>  * æåéæä»ä¹ç¨ï¼\n\næåéçä½ç¨æ¯ï¼å½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼Intention Locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ InnoDB èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\n\n# MVCC\n\n> ä»ä¹æ¯ MVCCï¼\n> \n> MVCC æä»ä¹ç¨ï¼è§£å³äºä»ä¹é®é¢ï¼\n> \n> MVCC çåçæ¯ä»ä¹ï¼\n\nå¤çæ¬å¹¶åæ§å¶ï¼Multi-Version Concurrency Control, MVCCï¼æ¯ InnoDB å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ MVCCãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ MVCC æ æ³å®ç°ã\n\nMVCC çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ãåæä½ï¼DELETEãINSERTãUPDATEï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ï¼è¿ä¸ç¹å CopyOnWrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼MVCC è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# Next-key é\n\nNext-Key éæ¯ MySQL ç InnoDB å­å¨å¼æçä¸ç§éå®ç°ã\n\nMVCC ä¸è½è§£å³å¹»è¯»é®é¢ï¼Next-Key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼REPEATABLE READï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ MVCC + Next-Key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nå¦å¤ï¼æ ¹æ®éå¯¹ SQL è¯­å¥æ£ç´¢æ¡ä»¶çä¸åï¼å éåæä»¥ä¸ä¸ç§æå½¢éè¦æä»¬ææ¡ã\n\n * Record Lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * Gap Lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ãSELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;\n * Next-key lock -å®æ¯ Record Lock å Gap Lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ SQL è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼MySQL å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼MySQL ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ UPDATEãDELETE æä½æ¶ï¼MySQL ä¸ä»éå® WHERE æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼InnoDB ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# ä¸ãäºå¡\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª Session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ ACID ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ Commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ Rollback è¿è¡åæ»ã\n\n\n\n\n# ACID\n\nACID â æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼\n\n * åå­æ§ï¼Atomicityï¼\n * ä¸è´æ§ï¼Consistencyï¼\n * éç¦»æ§ï¼Isolationï¼\n * æä¹æ§ï¼Durabilityï¼\n\nä¸ä¸ªæ¯æäºå¡ï¼Transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼Transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n\n\n\n# å¹¶åä¸è´æ§é®é¢\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ã\n\n * ä¸¢å¤±ä¿®æ¹\n\nT1 å T2 ä¸¤ä¸ªäºå¡é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼T1 åä¿®æ¹ï¼T2 éåä¿®æ¹ï¼T2 çä¿®æ¹è¦çäº T1 çä¿®æ¹ã\n\n\n\n * èè¯»\n\nT1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼T2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ T1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ T2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n * ä¸å¯éå¤è¯»\n\nT2 è¯»åä¸ä¸ªæ°æ®ï¼T1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ T2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n * å¹»è¯»\n\nT1 è¯»åæä¸ªèå´çæ°æ®ï¼T2 å¨è¿ä¸ªèå´åæå¥æ°çæ°æ®ï¼T1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\nå¹¶åä¸è´æ§è§£å³æ¹æ¡ï¼\n\näº§çå¹¶åä¸ä¸è´æ§é®é¢ä¸»è¦åå æ¯ç ´åäºäºå¡çéç¦»æ§ï¼è§£å³æ¹æ³æ¯éè¿å¹¶åæ§å¶æ¥ä¿è¯éç¦»æ§ã\n\nå¹¶åæ§å¶å¯ä»¥éè¿å°éæ¥å®ç°ï¼ä½æ¯å°éæä½éè¦ç¨æ·èªå·±æ§å¶ï¼ç¸å½å¤æãæ°æ®åºç®¡çç³»ç»æä¾äºäºå¡çéç¦»çº§å«ï¼è®©ç¨æ·ä»¥ä¸ç§æ´è½»æ¾çæ¹å¼å¤çå¹¶åä¸è´æ§é®é¢ã\n\n\n# äºå¡éç¦»\n\næ°æ®åºéç¦»çº§å«ï¼\n\n * æªæäº¤è¯»ï¼READ UNCOMMITTEDï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * æäº¤è¯»ï¼READ COMMITTEDï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼REPEATABLE READï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼SERIALIXABLEï¼ - å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\næªæäº¤è¯»   â    â       â\næäº¤è¯»    âï¸   â       â\nå¯éå¤è¯»   âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸   âï¸      âï¸\n\n\n# åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡ æ¯æäºå¡çåä¸èãæ¯æäºå¡çæå¡å¨ãèµæºæå¡å¨ä»¥åäºå¡ç®¡çå¨åå«ä½äºä¸åçåå¸å¼ç³»ç»çä¸åèç¹ä¹ä¸ã\n\n# ä¸¤é¶æ®µæäº¤\n\nä¸¤é¶æ®µæäº¤ï¼XAï¼å¯¹ä¸å¡ä¾µå¥å¾å°ã å®æå¤§çä¼å¿å°±æ¯å¯¹ä½¿ç¨æ¹éæï¼ç¨æ·å¯ä»¥åä½¿ç¨æ¬å°äºå¡ä¸æ ·ä½¿ç¨åºäº XA åè®®çåå¸å¼äºå¡ã XA åè®®è½å¤ä¸¥æ ¼ä¿éäºå¡ ACID ç¹æ§ã\n\nä¸¥æ ¼ä¿éäºå¡ ACID ç¹æ§æ¯ä¸æåååã äºå¡æ§è¡å¨è¿ç¨ä¸­éè¦å°æéèµæºå¨é¨éå®ï¼å®æ´å éç¨äºæ§è¡æ¶é´ç¡®å®çç­äºå¡ã å¯¹äºé¿äºå¡æ¥è¯´ï¼æ´ä¸ªäºå¡è¿è¡æé´å¯¹æ°æ®çç¬å ï¼å°å¯¼è´å¯¹ç­ç¹æ°æ®ä¾èµçä¸å¡ç³»ç»å¹¶åæ§è½è¡°éææ¾ã å æ­¤ï¼å¨é«å¹¶åçæ§è½è³ä¸åºæ¯ä¸­ï¼åºäº XA åè®®çåå¸å¼äºå¡å¹¶ä¸æ¯æä½³éæ©ã\n\n# ææ§äºå¡\n\nå¦æå°å®ç°äºACID çäºå¡è¦ç´ çäºå¡ç§°ä¸ºåæ§äºå¡çè¯ï¼é£ä¹åºäºBASEäºå¡è¦ç´ çäºå¡åç§°ä¸ºææ§äºå¡ã BASEæ¯åºæ¬å¯ç¨ãææ§ç¶æåæç»ä¸è´æ§è¿ä¸ä¸ªè¦ç´ çç¼©åã\n\n * åºæ¬å¯ç¨ï¼Basically Availableï¼ä¿è¯åå¸å¼äºå¡åä¸æ¹ä¸ä¸å®åæ¶å¨çº¿ã\n * ææ§ç¶æï¼Soft stateï¼ååè®¸ç³»ç»ç¶ææ´æ°æä¸å®çå»¶æ¶ï¼è¿ä¸ªå»¶æ¶å¯¹å®¢æ·æ¥è¯´ä¸ä¸å®è½å¤å¯è§ã\n * èæç»ä¸è´æ§ï¼Eventually consistentï¼éå¸¸æ¯éè¿æ¶æ¯ä¼ éçæ¹å¼ä¿è¯ç³»ç»çæç»ä¸è´æ§ã\n\nå¨ACIDäºå¡ä¸­å¯¹éç¦»æ§çè¦æ±å¾é«ï¼å¨äºå¡æ§è¡è¿ç¨ä¸­ï¼å¿é¡»å°ææçèµæºéå®ã ææ§äºå¡ççå¿µåæ¯éè¿ä¸å¡é»è¾å°äºæ¥éæä½ä»èµæºå±é¢ä¸ç§»è³ä¸å¡å±é¢ãéè¿æ¾å®½å¯¹å¼ºä¸è´æ§è¦æ±ï¼æ¥æ¢åç³»ç»ååéçæåã\n\nåºäºACIDçå¼ºä¸è´æ§äºå¡ååºäºBASEçæç»ä¸è´æ§äºå¡é½ä¸æ¯é¶å¼¹ï¼åªæå¨æéåçåºæ¯ä¸­æè½åæ¥å®ä»¬çæå¤§é¿å¤ã å¯éè¿ä¸è¡¨è¯¦ç»å¯¹æ¯å®ä»¬ä¹é´çåºå«ï¼ä»¥å¸®å©å¼åèè¿è¡ææ¯éåã\n\n# äºå¡æ¹æ¡å¯¹æ¯\n\n       æ¬å°äºå¡       ä¸¤ï¼ä¸ï¼é¶æ®µäºå¡    ææ§äºå¡\nä¸å¡æ¹é    æ           æ            å®ç°ç¸å³æ¥å£\nä¸è´æ§    ä¸æ¯æ        æ¯æ          æç»ä¸è´\néç¦»æ§    ä¸æ¯æ        æ¯æ          ä¸å¡æ¹ä¿è¯\nå¹¶åæ§è½   æ å½±å        ä¸¥éè¡°é        ç¥å¾®è¡°é\néååºæ¯   ä¸å¡æ¹å¤çä¸ä¸è´   ç­äºå¡ & ä½å¹¶å   é¿äºå¡ & é«å¹¶å\n\n\n# åãååºåè¡¨\n\n\n# ä»ä¹æ¯ååºåè¡¨\n\n> ä»ä¹æ¯ååºåè¡¨ï¼ä»ä¹æ¯åç´æåï¼ä»ä¹æ¯æ°´å¹³æåï¼ä»ä¹æ¯ Shardingï¼\n> \n> ååºåè¡¨æ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼\n> \n> ååºåè¡¨æä»ä¹ä¼ç¹ï¼\n> \n> ååºåè¡¨æä»ä¹ç­ç¥ï¼\n\nååºåè¡¨çåºæ¬ææ³å°±æ¯ï¼æåæ¬å®æ´çæ°æ®ååæå¤ä¸ªé¨åï¼æ¾å°ä¸åçæ°æ®åºæè¡¨ä¸ã\n\nååºåè¡¨ä¸å®æ¯ä¸ºäºæ¯æ é«å¹¶åãæ°æ®éå¤§ä¸¤ä¸ªé®é¢çã\n\n# åç´åå\n\n> åç´ååï¼æ¯ æä¸ä¸ªæå¾å¤å­æ®µçè¡¨ç»æåæå¤ä¸ªè¡¨ï¼æèæ¯å¤ä¸ªåºä¸å»ãä¸è¬æ¥è¯´ï¼ä¼ å°è¾å°çãè®¿é®é¢çè¾é«çå­æ®µæ¾å°ä¸ä¸ªè¡¨éå»ï¼ç¶å å°è¾å¤çãè®¿é®é¢çè¾ä½çå­æ®µæ¾å°å¦å¤ä¸ä¸ªè¡¨éå»ãå ä¸ºæ°æ®åºæ¯æç¼å­çï¼è®¿é®é¢çé«çè¡å­æ®µè¶å°ï¼å°±å¯ä»¥å¨ç¼å­éç¼å­æ´å¤çè¡ï¼æ§è½å°±è¶å¥½ãè¿ä¸ªä¸è¬å¨è¡¨å±é¢åçè¾å¤ä¸äºã\n\n\n\nä¸è¬æ¥è¯´ï¼æ»¡è¶³ä¸é¢çæ¡ä»¶å°±å¯ä»¥èèæ©å®¹äºï¼\n\n * Mysql ååºè¶è¿ 5000 ä¸æ¡è®°å½ï¼Oracle ååºè¶è¿ 1 äº¿æ¡è®°å½ï¼DB ååå°±å¾å¤§ã\n * ååºè¶è¿æ¯ç§ 2000 ä¸ªå¹¶åæ¶ï¼èä¸ä¸ªå¥åº·çååºæå¥½ä¿æå¨æ¯ç§ 1000 ä¸ªå¹¶åå·¦å³ï¼ä¸è¦å¤ªå¤§ã\n\nå¨æ°æ®åºçå±é¢ä½¿ç¨åç´ååå°ææ°æ®åºä¸­è¡¨çå¯éç¨åº¦é¨ç½²å°ä¸åçåºä¸­ï¼ä¾å¦å°åæ¥ççµåæ°æ®åºåç´ååæååæ°æ®åºãç¨æ·æ°æ®åºç­ã\n\n# æ°´å¹³æå\n\n> æ°´å¹³æå åç§°ä¸º Shardingï¼å®æ¯å°åä¸ä¸ªè¡¨ä¸­çè®°å½æåå°å¤ä¸ªç»æç¸åçè¡¨ä¸­ãå½ åè¡¨æ°æ®éå¤ªå¤§ æ¶ï¼ä¼æå¤§å½±å SQL æ§è¡çæ§è½ ãåè¡¨æ¯å°åæ¥ä¸å¼ è¡¨çæ°æ®åå¸å°æ°æ®åºéç¾¤çä¸åèç¹ä¸ï¼ä»èç¼è§£åç¹çååã\n\n\n\nä¸è¬æ¥è¯´ï¼åè¡¨æ 200 ä¸æ¡æ°æ® çæ¶åï¼æ§è½å°±ä¼ç¸å¯¹å·®ä¸äºäºï¼éè¦èèåè¡¨äºãä½æ¯ï¼è¿ä¹è¦è§å·ä½æåµèå®ï¼å¯è½æ¯ 100 ä¸æ¡ï¼ä¹å¯è½æ¯ 500 ä¸æ¡ï¼SQL è¶å¤æï¼å°±æå¥½è®©åè¡¨è¡æ°è¶å°ã\n\n# ååºåè¡¨çä¼ç¹\n\n#          ååºåè¡¨å              ååºåè¡¨å\nå¹¶åæ¯ææåµ     åæºé¨ç½²ï¼æä¸ä½é«å¹¶å        ä»åæºå°å¤æºï¼è½æ¿åçå¹¶åå¢å äºå¤å\nç£çä½¿ç¨æåµ     åæºç£çå®¹éå ä¹ææ»¡         æåä¸ºå¤ä¸ªåºï¼æ°æ®åºæå¡å¨ç£çä½¿ç¨çå¤§å¤§éä½\nSQL æ§è¡æ§è½   åè¡¨æ°æ®éå¤ªå¤§ï¼SQL è¶è·è¶æ¢   åè¡¨æ°æ®éåå°ï¼SQL æ§è¡æçææ¾æå\n\n# ååºåè¡¨ç­ç¥\n\n * åå¸åæ¨¡ï¼hash(key) % N æ id % N\n   * ä¼ç¹ï¼å¯ä»¥å¹³ååéæ¯ä¸ªåºçæ°æ®éåè¯·æ±ååï¼è´è½½åè¡¡ï¼ã\n   * ç¼ºç¹ï¼æ©å®¹éº»ç¦ï¼éè¦æ°æ®è¿ç§»ã\n * èå´ï¼å¯ä»¥æç§ ID ææ¶é´ååèå´ã\n   * ä¼ç¹ï¼æ©å®¹ç®åã\n   * ç¼ºç¹ï¼è¿ç§ç­ç¥å®¹æäº§çç­ç¹é®é¢ã\n * æ å°è¡¨ï¼ä½¿ç¨åç¬çä¸ä¸ªæ°æ®åºæ¥å­å¨æ å°å³ç³»ã\n   * ç¼ºç¹ï¼å­å¨æ å°å³ç³»çæ°æ®åºä¹å¯è½æä¸ºæ§è½ç¶é¢ï¼ä¸ä¸æ¦å®æºï¼ååºåè¡¨çæ°æ®åºå°±æ æ³å·¥ä½ãæä»¥ä¸å»ºè®®ä½¿ç¨è¿ç§ç­ç¥ã\n   * ä¼ç¹ï¼æ©å®¹ç®åï¼å¯ä»¥è§£å³åå¸å¼ ID é®é¢ã\n\n\n# ååºåè¡¨ä¸­é´ä»¶\n\n> â å¸¸è§é®é¢ï¼\n> \n>  * ä½ ç¨è¿åªäºååºåè¡¨ä¸­é´ä»¶ï¼ç®åä»ç»ä¸ä¸ï¼\n> \n>  * ä¸åçååºåè¡¨ä¸­é´ä»¶åèªæä»ä¹ç¹æ§ï¼æä»ä¹ä¼ç¼ºç¹ï¼\n> \n>  * ååºåè¡¨ä¸­é´ä»¶ææ¯å¦ä½éåï¼\n\n# å¸¸è§çååºåè¡¨ä¸­é´ä»¶\n\n * Cobar - é¿é b2b å¢éå¼ååå¼æºçï¼å±äº proxy å±æ¹æ¡ï¼å°±æ¯ä»äºåºç¨æå¡å¨åæ°æ®åºæå¡å¨ä¹é´ãåºç¨ç¨åºéè¿ JDBC é©±å¨è®¿é® cobar éç¾¤ï¼cobar æ ¹æ® SQL åååºè§åå¯¹ SQL ååè§£ï¼ç¶åååå° MySQL éç¾¤ä¸åçæ°æ®åºå®ä¾ä¸æ§è¡ãæ©äºå¹´è¿å¯ä»¥ç¨ï¼ä½æ¯æè¿å å¹´é½æ²¡æ´æ°äºï¼åºæ¬æ²¡å¥äººç¨ï¼å·®ä¸å¤ç®æ¯è¢«æå¼çç¶æå§ãèä¸ä¸æ¯æè¯»ååç¦»ãå­å¨è¿ç¨ãè·¨åº join ååé¡µç­æä½ã\n * TDDL - æ·å®å¢éå¼åçï¼å±äº client å±æ¹æ¡ãæ¯æåºæ¬ç crud è¯­æ³åè¯»ååç¦»ï¼ä½ä¸æ¯æ joinãå¤è¡¨æ¥è¯¢ç­è¯­æ³ãç®åä½¿ç¨çä¹ä¸å¤ï¼å ä¸ºè¿ä¾èµæ·å®ç diamond éç½®ç®¡çç³»ç»ã\n * Atlas - 360 å¼æºçï¼å±äº proxy å±æ¹æ¡ï¼ä»¥åæ¯æä¸äºå¬å¸å¨ç¨çï¼ä½æ¯ç¡®å®æä¸ä¸ªå¾å¤§çé®é¢å°±æ¯ç¤¾åºææ°çç»´æ¤é½å¨ 5 å¹´åäºãæä»¥ï¼ç°å¨ç¨çå¬å¸åºæ¬ä¹å¾å°äºã\n * sharding-jdbc - å½å½å¼æºçï¼å±äº client å±æ¹æ¡ãç¡®å®ä¹åç¨çè¿æ¯è¾å¤ä¸äºï¼å ä¸º SQL è¯­æ³æ¯æä¹æ¯è¾å¤ï¼æ²¡æå¤ªå¤éå¶ï¼èä¸ç®åæ¨åºå°äº 2.0 çæ¬ï¼æ¯æååºåè¡¨ãè¯»ååç¦»ãåå¸å¼ id çæãææ§äºå¡ï¼æå¤§åªåéè¾¾åäºå¡ãTCC äºå¡ï¼ãèä¸ç¡®å®ä¹åä½¿ç¨çå¬å¸ä¼æ¯è¾å¤ä¸äºï¼è¿ä¸ªå¨å®ç½æç»è®°ä½¿ç¨çå¬å¸ï¼å¯ä»¥çå°ä» 2017 å¹´ä¸ç´å°ç°å¨ï¼æ¯æä¸å°å¬å¸å¨ç¨çï¼ï¼ç®åç¤¾åºä¹è¿ä¸ç´å¨å¼ååç»´æ¤ï¼è¿ç®æ¯æ¯è¾æ´»è·ï¼ä¸ªäººè®¤ä¸ºç®æ¯ä¸ä¸ªç°å¨ä¹å¯ä»¥éæ©çæ¹æ¡ã\n * Mycat - åºäº cobar æ¹é çï¼å±äº proxy å±æ¹æ¡ï¼æ¯æçåè½éå¸¸å®åï¼èä¸ç®ååºè¯¥æ¯éå¸¸ç«çèä¸ä¸æ­æµè¡çæ°æ®åºä¸­é´ä»¶ï¼ç¤¾åºå¾æ´»è·ï¼ä¹æä¸äºå¬å¸å¼å§å¨ç¨äºãä½æ¯ç¡®å®ç¸æ¯äº sharding jdbc æ¥è¯´ï¼å¹´è½»ä¸äºï¼ç»åçé¤ç¼å°ä¸äºã\n\n# ååºåè¡¨ä¸­é´ä»¶ææ¯éå\n\nå»ºè®®ä½¿ç¨çæ¯ sharding-jdbc å mycatã\n\n * sharding-jdbc è¿ç§ client å±æ¹æ¡çä¼ç¹å¨äºä¸ç¨é¨ç½²ï¼è¿ç»´ææ¬ä½ï¼ä¸éè¦ä»£çå±çäºæ¬¡è½¬åè¯·æ±ï¼æ§è½å¾é«ï¼ä½æ¯å¦æéå°åçº§å¥çéè¦åä¸ªç³»ç»é½éæ°åçº§çæ¬ååå¸ï¼åä¸ªç³»ç»é½éè¦è¦å sharding-jdbc çä¾èµãå¶æ¬è´¨ä¸éè¿éç½®å¤æ°æ®æºï¼ç¶åæ ¹æ®è®¾å®çååºåè¡¨ç­ç¥ï¼è®¡ç®è·¯ç±ï¼å°è¯·æ±åéå°è®¡ç®å¾å°çèç¹ä¸ã\n\n * Mycat è¿ç§ proxy å±æ¹æ¡çç¼ºç¹å¨äºéè¦é¨ç½²ï¼èªå·±è¿ç»´ä¸å¥ä¸­é´ä»¶ï¼è¿ç»´ææ¬é«ï¼ä½æ¯å¥½å¤å¨äºå¯¹äºåä¸ªé¡¹ç®æ¯éæçï¼å¦æéå°åçº§ä¹ç±»çé½æ¯èªå·±ä¸­é´ä»¶é£éæå°±è¡äºã\n\néå¸¸æ¥è¯´ï¼è¿ä¸¤ä¸ªæ¹æ¡å¶å®é½å¯ä»¥éç¨ï¼ä½æ¯æä¸ªäººå»ºè®®ä¸­å°åå¬å¸éç¨ sharding-jdbcï¼client å±æ¹æ¡è½»ä¾¿ï¼èä¸ç»´æ¤ææ¬ä½ï¼ä¸éè¦é¢å¤å¢æ´¾äººæï¼èä¸ä¸­å°åå¬å¸ç³»ç»å¤æåº¦ä¼ä½ä¸äºï¼é¡¹ç®ä¹æ²¡é£ä¹å¤ï¼ä½æ¯ä¸­å¤§åå¬å¸æå¥½è¿æ¯éç¨ mycat è¿ç±» proxy å±æ¹æ¡ï¼å ä¸ºå¯è½å¤§å¬å¸ç³»ç»åé¡¹ç®éå¸¸å¤ï¼å¢éå¾å¤§ï¼äººååè¶³ï¼é£ä¹æå¥½æ¯ä¸é¨å¼ä¸ªäººæ¥ç ç©¶åç»´æ¤ mycatï¼ç¶åå¤§éé¡¹ç®ç´æ¥éæä½¿ç¨å³å¯ã\n\n\n# ååºåè¡¨çé®é¢\n\n>  * ååºåè¡¨çå¸¸è§é®é¢æåªäºï¼\n> \n>  * ä½ æ¯å¦ä½è§£å³ååºåè¡¨çé®é¢çï¼\n> \n> ä¸æä¸ä¸è®²è§£å¸¸è§ååºåè¡¨çé®é¢åè§£å³æ¹æ¡ã\n\n# åå¸å¼äºå¡\n\næ¹æ¡ä¸ï¼ä½¿ç¨æ°æ®åºäºå¡\n\n * ä¼ç¹ï¼äº¤ç±æ°æ®åºç®¡çï¼ç®åææ\n * ç¼ºç¹ï¼æ§è½ä»£ä»·é«ï¼ç¹å«æ¯ shard è¶æ¥è¶å¤æ¶\n\næ¹æ¡äºï¼ç±åºç¨ç¨åºåæ°æ®åºå±åæ§å¶\n\n * åçï¼å°ä¸ä¸ªè·¨å¤ä¸ªæ°æ®åºçåå¸å¼äºå¡åææå¤ä¸ªä»å¤äºåä¸ªæ°æ®åºä¸é¢çå°äºå¡ï¼å¹¶éè¿åºç¨ç¨åºæ¥æ»æ§åä¸ªå°äºå¡ã\n * ä¼ç¹ï¼æ§è½ä¸æä¼å¿\n * ç¼ºç¹ï¼éè¦åºç¨ç¨åºå¨äºå¡æ§å¶ä¸åçµæ´»è®¾è®¡ãå¦æä½¿ç¨äº spring çäºå¡ç®¡çï¼æ¹å¨èµ·æ¥ä¼é¢ä¸´ä¸å®çå°é¾ã\n\n# è·¨èç¹ Join\n\nåªè¦æ¯è¿è¡ååï¼è·¨èç¹ Join çé®é¢æ¯ä¸å¯é¿åçãä½æ¯è¯å¥½çè®¾è®¡åååå´å¯ä»¥åå°æ­¤ç±»æåµçåçãè§£å³è¿ä¸é®é¢çæ®éåæ³æ¯åä¸¤æ¬¡æ¥è¯¢å®ç°ãå¨ç¬¬ä¸æ¬¡æ¥è¯¢çç»æéä¸­æ¾åºå³èæ°æ®ç idï¼æ ¹æ®è¿äº id åèµ·ç¬¬äºæ¬¡è¯·æ±å¾å°å³èæ°æ®ã\n\n# è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°\n\nè¿äºæ¯ä¸ç±»é®é¢ï¼å ä¸ºå®ä»¬é½éè¦åºäºå¨é¨æ°æ®éåè¿è¡è®¡ç®ãå¤æ°çä»£çé½ä¸ä¼èªå¨å¤çåå¹¶å·¥ä½ã\n\nè§£å³æ¹æ¡ï¼ä¸è§£å³è·¨èç¹ join é®é¢çç±»ä¼¼ï¼åå«å¨åä¸ªèç¹ä¸å¾å°ç»æåå¨åºç¨ç¨åºç«¯è¿è¡åå¹¶ãå join ä¸åçæ¯æ¯ä¸ªèç¹çæ¥è¯¢å¯ä»¥å¹¶è¡æ§è¡ï¼å æ­¤å¾å¤æ¶åå®çéåº¦è¦æ¯åä¸å¤§è¡¨å¿«å¾å¤ãä½å¦æç»æéå¾å¤§ï¼å¯¹åºç¨ç¨åºåå­çæ¶èæ¯ä¸ä¸ªé®é¢ã\n\nä¸å¡è§åº¦ä¸çè§£å³æ¹æ¡ï¼\n\n * å¦ææ¯å¨åå°åºç¨æä¾åé¡µï¼åéå®ç¨æ·åªè½çåé¢ n é¡µï¼è¿ä¸ªéå¶å¨ä¸å¡ä¸ä¹æ¯åççï¼ä¸è¬çåé¢çåé¡µæä¹ä¸å¤§ï¼å¦æä¸å®è¦çï¼å¯ä»¥è¦æ±ç¨æ·ç¼©å°èå´éæ°æ¥è¯¢ï¼ã\n * å¦ææ¯åå°æ¹å¤çä»»å¡è¦æ±åæ¹è·åæ°æ®ï¼åå¯ä»¥å å¤§ page sizeï¼æ¯å¦æ¯æ¬¡è·å 5000 æ¡è®°å½ï¼ææåå°åé¡µæ°ï¼å½ç¶ç¦»çº¿è®¿é®ä¸è¬èµ°å¤åºï¼é¿åå²å»ä¸»åºï¼ã\n * ååºè®¾è®¡æ¶ï¼ä¸è¬è¿æéå¥å¤§æ°æ®å¹³å°æ±æ»ææååºçè®°å½ï¼æäºåé¡µæ¥è¯¢å¯ä»¥èèèµ°å¤§æ°æ®å¹³å°ã\n\n# åå¸å¼ ID\n\nä¸æ¦æ°æ®åºè¢«ååå°å¤ä¸ªç©çèç¹ä¸ï¼æä»¬å°ä¸è½åä¾èµæ°æ®åºèªèº«çä¸»é®çææºå¶ãä¸æ¹é¢ï¼æä¸ªååºæ°æ®åºèªçæç ID æ æ³ä¿è¯å¨å¨å±ä¸æ¯å¯ä¸çï¼å¦ä¸æ¹é¢ï¼åºç¨ç¨åºå¨æå¥æ°æ®ä¹åéè¦åè·å¾ IDï¼ä»¥ä¾¿è¿è¡ SQL è·¯ç±ã\n\nä¸äºå¸¸è§çä¸»é®çæç­ç¥ï¼\n\n * ä½¿ç¨å¨å±å¯ä¸ IDï¼GUIDã\n * ä¸ºæ¯ä¸ªåçæå®ä¸ä¸ª ID èå´ã\n * åå¸å¼ ID çæå¨ (å¦ Twitter ç Snowflake ç®æ³)ã\n\n# æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢\n\næ¥èªæ·å®ç»¼åä¸å¡å¹³å°å¢éï¼å®å©ç¨å¯¹ 2 çåæ°åä½å·æååå¼å®¹çç¹æ§ï¼å¦å¯¹ 4 åä½å¾ 1 çæ°å¯¹ 2 åä½ä¹æ¯ 1ï¼æ¥åéæ°æ®ï¼é¿åäºè¡çº§å«çæ°æ®è¿ç§»ï¼ä½æ¯ä¾ç¶éè¦è¿è¡è¡¨çº§å«çè¿ç§»ï¼åæ¶å¯¹æ©å®¹è§æ¨¡ååè¡¨æ°éé½æéå¶ãæ»å¾æ¥è¯´ï¼è¿äºæ¹æ¡é½ä¸æ¯ååççæ³ï¼å¤å¤å°å°é½å­å¨ä¸äºç¼ºç¹ï¼è¿ä¹ä»ä¸ä¸ªä¾§é¢åæ åºäº Sharding æ©å®¹çé¾åº¦ã\n\n\n# äºãéç¾¤\n\n> è¿ä¸ªä¸é¢éè¦æ ¹æ®çæåªä¸ªæ°æ®åºèå®ï¼ä½æ¯ä¸»æµãæççæ°æ®åºé½ä¼å®ç°ä¸äºåºæ¬åè½ï¼åªæ¯å®ç°æ¹å¼ãç­ç¥ä¸ææå·®å¼ãç±äºæ¬äººè¾ä¸ºçæ Mysqlï¼æä»¥ä¸é¢ä¸»è¦ä»ç» Mysql ç³»ç»æ¶æé®é¢ã\n\n\n# å¤å¶æºå¶\n\nMysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼binlogï¼ï¼ç¶åå¨ä»åºä¸ä»¥å¼æ­¥æ¹å¼æ´æ°ä¸»åºä¸çæ¥å¿è®°å½ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ï¼å³æç»ä¸è´æ§ï¼ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãI/O çº¿ç¨å SQL çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * I/O çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çæ¥å¿ä¸­ã\n * SQL çº¿ç¨ ï¼è´è´£è¯»åæ¥å¿å¹¶æ§è¡ SQL è¯­å¥ä»¥æ´æ°æ°æ®ã\n\n\n\n\n# è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nMySQL è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® MyISAM å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n\n\n# å­ãæ°æ®åºä¼å\n\næ°æ®åºä¼åçè·¯çº¿ä¸è¬ä¸ºï¼SQL ä¼åãç»æä¼åãéç½®ä¼åãç¡¬ä»¶ä¼åãåä¸¤ä¸ªæ¹åä¸è¬æ¯æ®éå¼åçèéç¹ï¼èåä¸¤ä¸ªæ¹åä¸è¬æ¯ DBA çèéç¹ã\n\n\n# SQL ä¼å\n\n> SQL ä¼åæ¯æ°æ®åºä¼åçæå¸¸è§ãæåçº§ææ®µã\n> \n> å¨æ§è¡ SQL è¯­å¥ï¼è¯­å¥ä¸­å­æ®µçé¡ºåºãæ¥è¯¢ç­ç¥ç­é½å¯è½ä¼å½±åå° SQL çæ§è¡æ§è½ã\n\n# æ§è¡è®¡å\n\nå¦ä½æ£éªä¿®æ¹åç SQL ç¡®å®æä¼åææï¼è¿å°±éè¦ç¨å°æ§è¡è®¡åï¼EXPLAINï¼ã\n\nä½¿ç¨æ§è¡è®¡å EXPLAIN ç¨æ¥åæ SELECT æ¥è¯¢æçï¼å¼åäººåå¯ä»¥éè¿åæ EXPLAIN ç»ææ¥ä¼åæ¥è¯¢è¯­å¥ã\n\næ¯è¾éè¦çå­æ®µæï¼\n\n * select_type - æ¥è¯¢ç±»åï¼æç®åæ¥è¯¢ãèåæ¥è¯¢ãå­æ¥è¯¢ç­\n * key - ä½¿ç¨çç´¢å¼\n * rows - æ«æçè¡æ°\n\n> æ´å¤åå®¹è¯·åèï¼MySQL æ§è½ä¼åç¥å¨ Explain ä½¿ç¨åæ\n\n# è®¿é®æ°æ®ä¼å\n\nåå°è¯·æ±çæ°æ®éï¼\n\n * åªè¿åå¿è¦çå - ä¸è¦æ¥è¯¢ä¸éè¦çåï¼å°½éé¿åä½¿ç¨ SELECT * è¯­å¥ã\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ WHERE è¯­å¥è¿è¡æ¥è¯¢è¿æ»¤ï¼ææ¶åä¹éè¦ä½¿ç¨ LIMIT è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - ä½¿ç¨ç¼å­å¯ä»¥é¿åå¨æ°æ®åºä¸­è¿è¡æ¥è¯¢ï¼ç¹å«è¦æ¥è¯¢çæ°æ®ç»å¸¸è¢«éå¤æ¥è¯¢ï¼ç¼å­å¯ä»¥å¸¦æ¥çæ¥è¯¢æ§è½æåå°ä¼æ¯éå¸¸ææ¾çã\n\nåå°æå¡å¨ç«¯æ«æçè¡æ°ï¼\n\n * æææçæ¹å¼æ¯ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢ï¼å³ WHERE åçè¿æ»¤æ¥è¯¢å­æ®µæå¥½æ¯ç´¢å¼å­æ®µï¼ã\n\n# éææ¥è¯¢æ¹å¼\n\n# ååæ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\nDELEFT FROM messages WHERE create < DATE_SUB(NOW(), INTERVAL 3 MONTH);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"DELETE FROM messages WHERE create  < DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000\")\n} while rows_affected > 0\n\n\n# åè§£å³èæ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼JOINï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ IN() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© MySQL æç§ ID é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nSELECT * FROM tag\nJOIN tag_post ON tag_post.tag_id=tag.id\nJOIN post ON tag_post.post_id=post.id\nWHERE tag.tag='mysql';\nSELECT * FROM tag WHERE tag='mysql';\nSELECT * FROM tag_post WHERE tag_id=1234;\nSELECT * FROM post WHERE post.id IN (123,456,567,9098,8904);\n\n\n# SQL è¯­å¥ç»è\n\n# éæ©æææççè¡¨åé¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºå¤ç FROM å­å¥ä¸­çè¡¨åï¼FROM å­å¥ä¸­åå¨æåçè¡¨å°è¢«æåå¤çã\n\nå¨ FROM å­å¥ä¸­åå«å¤ä¸ªè¡¨çæåµä¸ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯å®å¨æ å³ç³»çè¯ï¼å°è®°å½åååæå°çè¡¨ï¼åå¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼éæ©è®°å½æ¡æ°æå°çè¡¨æ¾å¨æåã\n\nå¦ææ 3 ä¸ªä»¥ä¸çè¡¨è¿æ¥æ¥è¯¢ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯æå³ç³»çè¯ï¼å°å¼ç¨æå¤çè¡¨ï¼æ¾å¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼è¢«å¶ä»è¡¨æå¼ç¨çè¡¨æ¾å¨æåã\n\nä¾å¦ï¼æ¥è¯¢åå·¥çç¼å·ï¼å§åï¼å·¥èµï¼å·¥èµç­çº§ï¼é¨é¨å\n\nemp è¡¨è¢«å¼ç¨å¾æå¤ï¼è®°å½æ°ä¹æ¯æå¤ï¼å æ­¤æ¾å¨ form å­å¥çæåé¢\n\nselect emp.empno,emp.ename,emp.sal,salgrade.grade,dept.dname\nfrom salgrade,dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal between salgrade.losal and salgrade.hisal)\n\n\n# WHERE å­å¥ä¸­çè¿æ¥é¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºè§£æ WHERE å­å¥ã\n\nå æ­¤ï¼è¡¨ä¹é´çè¿æ¥å¿é¡»åå¨å¶ä» WHERE æ¡ä»¶çå·¦è¾¹ï¼é£äºå¯ä»¥è¿æ»¤ææå¤§æ°éè®°å½çæ¡ä»¶å¿é¡»åå¨ WHERE å­å¥çä¹å³ã\n\nemp.sal å¯ä»¥è¿æ»¤å¤æ¡è®°å½ï¼åå¨ WHERE å­å¥çæå³è¾¹\n\nselect emp.empno,emp.ename,emp.sal,dept.dname\nfrom dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal > 1500)\n\n\n# SELECT å­å¥ä¸­é¿åä½¿ç¨ * å·\n\næä»¬å½æ¶å­¦ä¹ çæ¶åï¼â*â å·æ¯å¯ä»¥è·åè¡¨ä¸­å¨é¨çå­æ®µæ°æ®çã\n\n * ä½æ¯å®è¦éè¿æ¥è¯¢æ°æ®å­å¸å®æçï¼è¿æå³çå°èè´¹æ´å¤çæ¶é´\n * ä½¿ç¨*å·ååºæ¥ç SQL è¯­å¥ä¹ä¸å¤ç´è§ã\n\n----------------------------------------\n\n# ç¨ TRUNCATE æ¿ä»£ DELETE\n\nå¦æéè¦æ¸ç©ºææè¡¨è®°å½ï¼ä½¿ç¨ TRUNCATE æ¯ DELETE æ§è¡æçé«ï¼\n\nDELETE æ¯ä¸æ¡ä¸æ¡è®°å½çå é¤ï¼è Truncate æ¯å°æ´ä¸ªè¡¨å é¤ï¼ä»ä¿çè¡¨ç»æ\n\n# ä½¿ç¨åé¨å½æ°æé« SQL æç\n\nä¾å¦ä½¿ç¨ mysql ç concat() å½æ°ä¼æ¯ä½¿ç¨ || æ¼æ¥éåº¦å¿«ï¼å ä¸º concat() å½æ°å·²ç»è¢« mysql ä¼åè¿äºã\n\n# ä½¿ç¨è¡¨æåçå«å\n\nå¦æè¡¨æåçåç§°å¤ªé¿äºï¼ä½¿ç¨ä¸äºç®ç­çå«åä¹è½ç¨å¾®æé«ä¸äº SQL çæ§è½ãæ¯ç«è¦æ«æçå­ç¬¦é¿åº¦å°±åå°äºã\n\n# SQL å³é®å­å¤§å\n\næä»¬å¨ç¼å SQL çæ¶åï¼å®æ¹æ¨èçæ¯ä½¿ç¨å¤§åæ¥åå³é®å­ï¼å ä¸º Oracle æå¡å¨æ»æ¯åå°å°åå­æ¯è½¬æå¤§ååï¼ææ§è¡\n\n# ç¨ >= æ¿ä»£ >\n\nâ ä½ææ¹å¼ï¼\n\n-- é¦åå®ä½å°DEPTNO=3çè®°å½å¹¶ä¸æ«æå°ç¬¬ä¸ä¸ªDEPTå¤§äº3çè®°å½\nSELECT * FROM EMP WHERE DEPTNO > 3\n\n\nâ é«ææ¹å¼ï¼\n\n-- ç´æ¥è·³å°ç¬¬ä¸ä¸ªDEPTç­äº4çè®°å½\nSELECT * FROM EMP WHERE DEPTNO >= 4\n\n\n# ç¨ IN æ¿ä»£ OR\n\nâ ä½ææ¹å¼ï¼\n\nselect * from emp where sal = 1500 or sal = 3000 or sal = 800;\n\n\nâ é«ææ¹å¼ï¼\n\nselect * from emp where sal in (1500,3000,800);\n\n\n# æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå\n\nå¦æç´¢å¼æ¯å»ºç«å¨å¤ä¸ªåä¸ï¼åªæå¨å®çç¬¬ä¸ä¸ªåè¢« WHERE å­å¥å¼ç¨æ¶ï¼ä¼åå¨æä¼éæ©ä½¿ç¨è¯¥ç´¢å¼ã å½åªå¼ç¨ç´¢å¼çç¬¬äºä¸ªåæ¶ï¼ä¸å¼ç¨ç´¢å¼çç¬¬ä¸ä¸ªåæ¶ï¼ä¼åå¨ä½¿ç¨äºå¨è¡¨æ«æèå¿½ç¥äºç´¢å¼\n\ncreate index emp_sal_job_idex\non emp(sal,job);\n----------------------------------\nselect *\nfrom emp\nwhere job != 'SALES';\n\n\n# SQL å³é®å­å°½éå¤§å\n\nSQL å³é®å­å°½éå¤§åï¼å¦ï¼Oracle é»è®¤ä¼å° SQL è¯­å¥ä¸­çå³é®å­è½¬ä¸ºå¤§ååå¨æ§è¡ã\n\n\n# ç»æä¼å\n\næ°æ®åºç»æä¼åå¯ä»¥ä»ä»¥ä¸æ¹åçæï¼\n\n * æ°æ®ç±»åä¼å\n * èå¼ååèå¼ä¼å\n * ç´¢å¼ä¼å - ç»èè¯·çç´¢å¼åçº¦æç« è\n * ååºåè¡¨ - ç»èè¯·çååºåè¡¨ç« è\n\n# æ°æ®ç±»åä¼ååå\n\n * æ´å°çéå¸¸æ´å¥½\n * ç®åå°±å¥½ï¼å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½\n * å°½éé¿å NULL\n\n# èå¼ååèå¼\n\nèå¼ååèå¼åæå©å¼ï¼éè¦æ ¹æ®å®éæåµæè¡¡ã\n\nèå¼åçç®æ æ¯å°½ååå°åä½åï¼èçç©ºé´ã\n\n * èå¼åçä¼ç¹æ¯ï¼\n   \n   * åå°åä½åï¼è¦åçæ°æ®å°±å°ï¼åæä½çæ§è½æé«ï¼\n   * æ£ç´¢åæ°æ®æ¶ï¼DISTINCT æ GROUP BY æä½åå°ã\n\n * èå¼åçç¼ºç¹æ¯ï¼å¢å å³èæ¥è¯¢ã\n\nåèå¼åçç®æ æ¯éå½å¢å åä½åï¼ä»¥é¿åå³èæ¥è¯¢ã\n\nåèå¼åçç¼ºç¹æ¯ï¼\n\n * åä½åå¢å¤ï¼ç©ºé´åå¤§ï¼åæä½æ§è½ä¸éï¼\n * æ£ç´¢åæ°æ®æ¶ï¼DISTINCT æ GROUP BY æä½åå¤ï¼\n\n\n# éç½®ä¼å\n\n> éç½®ä¼åä¸»è¦æ¯éå¯¹ Mysql æå¡å¨ï¼ä¾å¦ï¼max_connectionsãmax_heap_table_sizeãopen_files_limitãmax_allowed_packet ç­ç­ã\n> \n> å¨ä¸åç¯å¢ï¼ä¸ååºæ¯ä¸ï¼åºè¯¥éæä½¿ç¨åççéç½®ãè¿ç§ä¼åæ¯è¾èéª Mysql è¿ç»´ç»éªï¼ä¸è¬æ¯ DBA çèéï¼æ®éå¼åæ¥è§¦çè¾å°ã\n> \n> Mysql éç½®è¯´æè¯·åèï¼Mysql æå¡å¨éç½®è¯´æ\n\n\n# ç¡¬ä»¶ä¼å\n\næ°æ®åºæ©å®¹ãä½¿ç¨é«éè®¾å¤ç­ç­ãæ ¸å¿å°±æ¯ä¸ä¸ªå­ï¼é±ã\n\n\n# ä¸ãæ°æ®åºçè®º\n\n\n# å½æ°ä¾èµ\n\nè®° A->B è¡¨ç¤º A å½æ°å³å® Bï¼ä¹å¯ä»¥è¯´ B å½æ°ä¾èµäº Aã\n\nå¦æ {A1ï¼A2ï¼... ï¼An} æ¯å³ç³»çä¸ä¸ªæå¤ä¸ªå±æ§çéåï¼è¯¥éåå½æ°å³å®äºå³ç³»çå¶å®ææå±æ§å¹¶ä¸æ¯æå°çï¼é£ä¹è¯¥éåå°±ç§°ä¸ºé®ç ã\n\nå¯¹äº A->Bï¼å¦æè½æ¾å° A ççå­é A'ï¼ä½¿å¾ A'-> Bï¼é£ä¹ A->B å°±æ¯é¨åå½æ°ä¾èµï¼å¦åå°±æ¯å®å¨å½æ°ä¾èµï¼\n\nå¯¹äº A->Bï¼B->Cï¼å A->C æ¯ä¸ä¸ªä¼ éä¾èµã\n\n\n# å¼å¸¸\n\nä»¥ä¸çå­¦çè¯¾ç¨å³ç³»çå½æ°ä¾èµä¸º Sno, Cname -> Sname, Sdept, Mname, Gradeï¼é®ç ä¸º {Sno, Cname}ãä¹å°±æ¯è¯´ï¼ç¡®å®å­¦çåè¯¾ç¨ä¹åï¼å°±è½ç¡®å®å¶å®ä¿¡æ¯ã\n\nSNO   SNAME   SDEPT   MNAME   CNAME   GRADE\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä¸ç¬¦åèå¼çå³ç³»ï¼ä¼äº§çå¾å¤å¼å¸¸ï¼ä¸»è¦æä»¥ä¸åç§å¼å¸¸ï¼\n\n * åä½æ°æ®ï¼ä¾å¦ å­¦ç-2 åºç°äºä¸¤æ¬¡ã\n * ä¿®æ¹å¼å¸¸ï¼ä¿®æ¹äºä¸ä¸ªè®°å½ä¸­çä¿¡æ¯ï¼ä½æ¯å¦ä¸ä¸ªè®°å½ä¸­ç¸åçä¿¡æ¯å´æ²¡æè¢«ä¿®æ¹ã\n * å é¤å¼å¸¸ï¼å é¤ä¸ä¸ªä¿¡æ¯ï¼é£ä¹ä¹ä¼ä¸¢å¤±å¶å®ä¿¡æ¯ãä¾å¦å¦æå é¤äº è¯¾ç¨-1ï¼éè¦å é¤ç¬¬ä¸è¡åç¬¬ä¸è¡ï¼é£ä¹ å­¦ç-1 çä¿¡æ¯å°±ä¼ä¸¢å¤±ã\n * æå¥å¼å¸¸ï¼ä¾å¦æ³è¦æå¥ä¸ä¸ªå­¦ççä¿¡æ¯ï¼å¦æè¿ä¸ªå­¦çè¿æ²¡éè¯¾ï¼é£ä¹å°±æ æ³æå¥ã\n\n\n# èå¼\n\nèå¼çè®ºæ¯ä¸ºäºè§£å³ä»¥ä¸æå°åç§å¼å¸¸ã\n\né«çº§å«èå¼çä¾èµäºä½çº§å«çèå¼ï¼1NF æ¯æä½çº§å«çèå¼ã\n\n\n\n# ç¬¬ä¸èå¼ (1NF)\n\nå±æ§ä¸å¯åã\n\n# ç¬¬äºèå¼ (2NF)\n\n * æ¯ä¸ªéä¸»å±æ§å®å¨å½æ°ä¾èµäºé®ç ã\n\n * å¯ä»¥éè¿åè§£æ¥æ»¡è¶³ã\n\nåè§£å\n\nSNO   SNAME   SDEPT   MNAME   CNAME   GRADE\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä»¥ä¸å­¦çè¯¾ç¨å³ç³»ä¸­ï¼{Sno, Cname} ä¸ºé®ç ï¼æå¦ä¸å½æ°ä¾èµï¼\n\n * Sno -> Sname, Sdept\n * Sdept -> Mname\n * Sno, Cname-> Grade\n\nGrade å®å¨å½æ°ä¾èµäºé®ç ï¼å®æ²¡æä»»ä½åä½æ°æ®ï¼æ¯ä¸ªå­¦ççæ¯é¨è¯¾é½æç¹å®çæç»©ã\n\nSname, Sdept å Mname é½é¨åä¾èµäºé®ç ï¼å½ä¸ä¸ªå­¦çéä¿®äºå¤é¨è¯¾æ¶ï¼è¿äºæ°æ®å°±ä¼åºç°å¤æ¬¡ï¼é æå¤§éåä½æ°æ®ã\n\nåè§£å\n\nå³ç³»-1\n\nSNO   SNAME   SDEPT   MNAME\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * Sno -> Sname, Sdept, Mname\n * Sdept -> Mname\n\nå³ç³»-2\n\nSNO   CNAME   GRADE\n1     è¯¾ç¨-1    90\n2     è¯¾ç¨-2    80\n2     è¯¾ç¨-1    100\n3     è¯¾ç¨-2    95\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * Sno, Cname -> Grade\n\n# ç¬¬ä¸èå¼ (3NF)\n\n * éä¸»å±æ§ä¸ä¼ éä¾èµäºé®ç ã\n\nä¸é¢ç å³ç³»-1 ä¸­å­å¨ä»¥ä¸ä¼ éä¾èµï¼Sno -> Sdept -> Mnameï¼å¯ä»¥è¿è¡ä»¥ä¸åè§£ï¼\n\nå³ç³»-11\n\nSNO   SNAME   SDEPT\n1     å­¦ç-1    å­¦é¢-1\n2     å­¦ç-2    å­¦é¢-2\n3     å­¦ç-3    å­¦é¢-2\n\nå³ç³»-12\n\nSDEPT   MNAME\nå­¦é¢-1    é¢é¿-1\nå­¦é¢-2    é¢é¿-2\n\n\n# å«ãMysql å­å¨å¼æ\n\nMysql æå¤ç§å­å¨å¼æï¼ä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ Mysql æå¡å±ç»ä¸å¤ççã\n\nç®ååä¸¾å ä¸ªå­å¨å¼æï¼\n\n * InnoDB - Mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨æéæ¢å¤ã\n * MyISAM - Mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡ææéæ¢å¤åè½ã\n * CSV - å¯ä»¥å° CSV æä»¶ä½ä¸º Mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * MEMORY ãææçæ°æ®é½å¨åå­ä¸­ï¼æ°æ®çå¤çéåº¦å¿«ï¼ä½æ¯å®å¨æ§ä¸é«ã\n\n\n# InnoDB vs. MyISAM\n\nInnoDB å MyISAM æ¯ç®åä½¿ç¨çæå¤çä¸¤ç§ Mysql å­å¨å¼æã\n\n * æ°æ®ç»ææ¯è¾ï¼\n   * InnoDB å MyISAM çç´¢å¼æ°æ®ç»æé½æ¯ B+ æ ã\n   * MyIASM ç B+ æ ä¸­å­å¨çåå®¹å®éä¸æ¯å®éæ°æ®çå°åå¼ãä¹å°±æ¯è¯´å®çç´¢å¼åå®éæ°æ®æ¯åå¼çï¼åªä¸è¿ä½¿ç¨ç´¢å¼æåäºå®éæ°æ®ãè¿ç§ç´¢å¼çæ¨¡å¼è¢«ç§°ä¸ºéèéç´¢å¼ã\n   * InnoDB ç B+ æ ä¸­å­å¨çåå®¹æ¯å®éçæ°æ®ï¼è¿ç§ç´¢å¼æè¢«ç§°ä¸ºèéç´¢å¼ã\n * äºå¡æ¯ææ¯è¾ï¼\n   * InnoDB æ¯æäºå¡ï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æã\n   * MyIASM ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ã\n * æéæ¢å¤æ¯è¾ï¼\n   * InnoDB æ¯ææéæ¢å¤ã\n   * MyISAM ä¸æ¯ææéæ¢å¤ã\n\n\n# ä¹ãæ°æ®åºæ¯è¾\n\n\n# å¸¸è§æ°æ®åºæ¯è¾\n\n * Oracle - ä¹è´çåçåä¸æ°æ®åºãåè½å¼ºå¤§ãç¨³å®ãæå¤§çç¼ºç¹å°±æ¯è´¹é±ã\n * Mysql - æ¾ç»æ¯äºèç½å¬å¸çæç±ï¼ä½èªå¨ Mysql è¢« Oracle å¬å¸æ¶è´­åï¼å¥½æ¥å­å¯è½ä¸å»ä¸å¤è¿ãå¾å¤å¬å¸æå¼æºé¡¹ç®å·²ç»éæ¸å¯»æ¾å¶ä»çå¼æºäº§åæ¥æ¿ä»£ Mysqlã\n * MariaDB - å¼æºå³ç³»åæ°æ®åºã MySQL ççæ­£å¼æºçåè¡çæ¬ï¼ç± Mysql é¨åæ ¸å¿äººååå»ºãå¯ä½ä¸º Mysql çæ¿ä»£äº§åã\n * PostgreSQL - å¼æºå³ç³»åæ°æ®åºãå MySQL çå·¥ä½æ¹å¼éå¸¸ç¸ä¼¼ï¼ç¤¾åºæ¯æåå¾å¾å¥½ãå¯ä½ä¸º Mysql çæ¿ä»£äº§åã\n * SQLite - å¼æºçè½»éçº§æ°æ®åºï¼ç§»å¨ç«¯å¸¸å¸¸ä½¿ç¨ã\n * H2 - åå­æ°æ®åºï¼ä¸è¬ç¨ä½å¼åãæµè¯ç¯å¢æ°æ®åºã\n * SQL Server - å¾®è½¯ Windows çæç³»ç»çæ°æ®åºãææ³ï¼Java ç¨åºååºè¯¥æ²¡äººç¨å§ã\n\n\n# Oracle vs. Mysql\n\nç®åä¸ºæ­¢ï¼Java é¢åç¨çæå¤çå³ç³»åæ°æ®åºï¼åºè¯¥è¿æ¯ Oracle å Mysqlï¼æä»¥è¿éåä¸ä¸æ¯è¾ã\n\n# æ°æ®åºå¯¹è±¡å·®å¼\n\nå¨ Mysql ä¸­ï¼ä¸ä¸ªç¨æ·å¯ä»¥åå»ºå¤ä¸ªåºã\n\nèå¨ Oracle ä¸­ï¼Oracle æå¡å¨æ¯ç±ä¸¤é¨åç»æ\n\n * æ°æ®åºå®ä¾ãçè§£ä¸ºå¯¹è±¡ï¼çä¸è§çã\n * æ°æ®åºãçè§£ä¸ºç±»ï¼çå¾è§çã\n\nä¸ä¸ªæ°æ®åºå®ä¾å¯æ¥æå¤ä¸ªç¨æ·ï¼ä¸ä¸ªç¨æ·é»è®¤æ¥æä¸ä¸ªè¡¨ç©ºé´ã\n\nè¡¨ç©ºé´æ¯å­å¨æä»¬æ°æ®åºè¡¨çå°æ¹ï¼è¡¨ç©ºé´åå¯ä»¥æå¤ä¸ªæä»¶ã\n\n# SQL å·®å¼\n\nï¼1ï¼ä¸»é®éå¢\n\nMysql å¯ä»¥è®¾ç½® AUTO_INCREMENT çº¦ææ¥æå®ä¸»é®ä¸ºèªå¢åºåã\n\nOracle éè¦éè¿ CREATE SEQUENCE åå»ºåºåã\n\nï¼2ï¼åé¡µæ¥è¯¢\n\nMysql åé¡µåºäº SELECT ... FROM ... LIMIT ... å®æï¼è¾ç®åã\n\nselect * from help_category order by parent_category_id limit 10,5;\n\n\nOracle åé¡µåºäº SELECT ... FROM (SELECT ROWNUM ...) WHERE ... å®æï¼è¾å¤æã\n\nselect * from\n(select rownum rr,a.* from (select * from emp order by sal) a )\nwhere rr>5 and rr<=10;\n\n\n# äºå¡å·®å¼\n\n * auto commit\n   * Mysql äºå¡æ¯ autocommit æ¨¡å¼ï¼å³èªå¨æäº¤äºå¡ï¼\n   * Oracle äºå¡éè¦æå¨ COMMITã\n * äºå¡éç¦»çº§å«\n   * Mysql é»è®¤çäºå¡éç¦»çº§å«æ¯å¯éå¤è¯»ï¼REPEATABLE READï¼\n   * Oracle æ¯æè¯»å·²æäº¤ï¼READ COMMITTEDï¼åä¸²è¡åï¼SERIALIZABLEï¼ ä¸¤ç§äºå¡éç¦»çº§å«ï¼é»è®¤äºå¡éç¦»çº§å«æ¯è¯»å·²æäº¤ï¼READ COMMITTEDï¼\n\n\n# æ°æ®ç±»åæ¯è¾\n\n> ä¸åæ°æ®åºä¸­ï¼å¯¹æ°æ®ç±»åçæ¯ææ¯ä¸ä¸æ ·çã\n> \n> å³ä½¿å­å¨åä¸ç§æ°æ®ç±»åï¼ä¹å¯è½å­å¨åç§°ä¸åãæå¤§å°ä¸åç­é®é¢ã\n> \n> å æ­¤ï¼å¯¹äºæ°æ®ç±»åçæ¯æè¯¦æå¿é¡»åèåæ°æ®åºçå®æ¹ææ¡£ã\n\nä¸é¢åä¸¾ä¸äºå¸¸è§æ°æ®ç±»åå¯¹æ¯ï¼\n\næ°æ®ç±»å                ORACLE             MYSQL         POSTGRESQL\nboolean             Byte               N/A           Boolean\ninteger             Number             Int Integer   Int Integer\nfloat               Number             Float         Numeric\ncurrency            N/A                N/A           Money\nstring (fixed)      Char               Char          Char\nstring (variable)   Varchar Varchar2   Varchar       Varchar\nbinary object       Long Raw           Blob Text     Binary Varbinary\n\n> æ°æ®ç±»åå¯¹æ¯è¡¨æèª SQL éç¨æ°æ®ç±»åãSQL ç¨äºåç§æ°æ®åºçæ°æ®ç±»å\n\n\n# åèèµæ\n\n * æ°æ®åºé¢è¯é¢(å¼åèå¿ç)\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ååºåè¡¨éè¦èèçé®é¢åæ¹æ¡\n * æ°æ®åºååºåè¡¨(sharding)ç³»å(äº) å¨å±ä¸»é®çæç­ç¥\n * ä¸ç§æ¯æèªç±è§åæ é¡»æ°æ®è¿ç§»åä¿®æ¹è·¯ç±ä»£ç ç Sharding æ©å®¹æ¹æ¡\n * ShardingSphere åå¸å¼äºå¡\n * mysql å oracle çåºå«\n * RUNOOB SQL æç¨\n * å¦ææäººé®ä½ æ°æ®åºçåçï¼å«ä»çè¿ç¯æç« ",normalizedContent:"# å³ç³»åæ°æ®åºé¢è¯\n\n\n# ä¸ãç´¢å¼åçº¦æ\n\n\n# ä»ä¹æ¯ç´¢å¼\n\nç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸æå¤ä¸ªåçå¼è¿è¡æåºçç»æï¼æ¯å¸®å©æ°æ®åºé«ææ¥è¯¢æ°æ®çæ°æ®ç»æã\n\n\n# ç´¢å¼çä¼ç¼ºç¹\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ innodb ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº i/o åä¸ºé¡ºåº i/oã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼insert/update/deleteï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\nç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * è¡¨ç»å¸¸è¿è¡ select æä½ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ï¼\n * ååç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ insert/update/delete ï¼- éè¦æ´æ°ç´¢å¼ç©ºé´ï¼\n * éå¸¸å°çè¡¨ - å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ååä¸ç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­ - ç´¢å¼å°±ä¼ç»å¸¸ä¸å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ nosqlã\n\n\n# ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\nä»é»è¾ç±»åä¸ååï¼å³ä¸è¬åå»ºè¡¨æ¶è®¾ç½®çç´¢å¼ç±»åï¼ï¼\n\n * å¯ä¸ç´¢å¼ï¼uniqueï¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n * ä¸»é®ç´¢å¼ï¼primaryï¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼ä¸åè®¸æç©ºå¼ãä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n * æ®éç´¢å¼ï¼indexï¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n * ç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\nä»ç©çå­å¨ä¸ååï¼\n\n * èéç´¢å¼(clustered)ï¼è¡¨ä¸­åè¡çç©çé¡ºåºä¸é®å¼çé»è¾ï¼ç´¢å¼ï¼é¡ºåºç¸åï¼æ¯ä¸ªè¡¨åªè½æä¸ä¸ªã\n * éèéç´¢å¼(non-clustered)ï¼éèéç´¢å¼æå®è¡¨çé»è¾é¡ºåºï¼ä¹å¯ä»¥è§ä¸ºäºçº§ç´¢å¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\n\n# ç´¢å¼çæ°æ®ç»æ\n\nä¸»æµæ°æ®åºçç´¢å¼ä¸è¬ä½¿ç¨çæ°æ®ç»æä¸ºï¼b æ ãb+ æ ã\n\n# b æ \n\nä¸æ£µ m é¶ç b-tree æ»¡è¶³ä»¥ä¸æ¡ä»¶ï¼\n\n * æ¯ä¸ªç»ç¹è³å¤æ m ä¸ªå­©å­ï¼\n * é¤æ ¹ç»ç¹åå¶ç»ç¹å¤ï¼å¶å®æ¯ä¸ªç»ç¹è³å°æ m/2 ä¸ªå­©å­ï¼\n * æ ¹ç»ç¹è³å°æä¸¤ä¸ªå­©å­ï¼é¤éè¯¥æ ä»åå«ä¸ä¸ªç»ç¹ï¼ï¼\n * ææå¶ç»ç¹å¨åä¸å±ï¼å¶ç»ç¹ä¸åå«ä»»ä½å³é®å­ä¿¡æ¯ï¼\n * æ k ä¸ªå³é®å­çéå¶ç»ç¹æ°å¥½åå« k+1 ä¸ªå­©å­ï¼\n\nå¯¹äºä»»æç»ç¹ï¼å¶åé¨çå³é®å­ key æ¯ååºæåçãæ¯ä¸ªèç¹ä¸­é½åå«äº dataã\n\n\n\nå¯¹äºæ¯ä¸ªç»ç¹ï¼ä¸»è¦åå«ä¸ä¸ªå³é®å­æ°ç» key[]ï¼ä¸ä¸ªæéæ°ç»ï¼æåå¿å­ï¼son[]ã\n\nå¨ b-tree åï¼æ¥æ¾çæµç¨æ¯ï¼\n\n 1. ä½¿ç¨é¡ºåºæ¥æ¾ï¼æ°ç»é¿åº¦è¾ç­æ¶ï¼ææåæ¥æ¾æ¹æ³æ¥æ¾ key[] æ°ç»ï¼è¥æ¾å°å³é®å­ kï¼åè¿åè¯¥ç»ç¹çå°åå k å¨ key[] ä¸­çä½ç½®ï¼\n 2. å¦åï¼å¯ç¡®å® k å¨æä¸ª key[i] å key[i+1] ä¹é´ï¼åä» son[i] ææçå­ç»ç¹ç»§ç»­æ¥æ¾ï¼ç´å°å¨æç»ç¹ä¸­æ¥æ¾æåï¼\n 3. æç´è³æ¾å°å¶ç»ç¹ä¸å¶ç»ç¹ä¸­çæ¥æ¾ä»ä¸æåæ¶ï¼æ¥æ¾è¿ç¨å¤±è´¥ã\n\n# b+ æ \n\nb+tree æ¯ b-tree çåç§ï¼\n\n * æ¯ä¸ªèç¹çæéä¸éä¸º 2d èä¸æ¯ 2d+1ï¼d ä¸ºèç¹çåºåº¦ï¼ã\n * éå¶å­èç¹ä¸å­å¨ dataï¼åªå­å¨ keyï¼å¶å­èç¹ä¸å­å¨æéã\n\n\n\nç±äºå¹¶ä¸æ¯ææèç¹é½å·æç¸åçåï¼å æ­¤ b+tree ä¸­å¶èç¹ååèç¹ä¸è¬å¤§å°ä¸åãè¿ç¹ä¸ b-tree ä¸åï¼è½ç¶ b-tree ä¸­ä¸åèç¹å­æ¾ç key åæéå¯è½æ°éä¸ä¸è´ï¼ä½æ¯æ¯ä¸ªèç¹çååä¸éæ¯ä¸è´çï¼æä»¥å¨å®ç°ä¸­ b-tree å¾å¾å¯¹æ¯ä¸ªèç¹ç³è¯·åç­å¤§å°çç©ºé´ã\n\nå¸¦æé¡ºåºè®¿é®æéç b+tree\n\nä¸è¬å¨æ°æ®åºç³»ç»ææä»¶ç³»ç»ä¸­ä½¿ç¨ç b+tree ç»æé½å¨ç»å¸ b+tree çåºç¡ä¸è¿è¡äºä¼åï¼å¢å äºé¡ºåºè®¿é®æéã\n\n\n\nå¨ b+tree çæ¯ä¸ªå¶å­èç¹å¢å ä¸ä¸ªæåç¸é»å¶å­èç¹çæéï¼å°±å½¢æäºå¸¦æé¡ºåºè®¿é®æéç b+treeã\n\nè¿ä¸ªä¼åçç®çæ¯ä¸ºäºæé«åºé´è®¿é®çæ§è½ï¼ä¾å¦ä¸å¾ä¸­å¦æè¦æ¥è¯¢ key ä¸ºä» 18 å° 49 çæææ°æ®è®°å½ï¼å½æ¾å° 18 åï¼åªéé¡ºçèç¹åæéé¡ºåºéåå°±å¯ä»¥ä¸æ¬¡æ§è®¿é®å°æææ°æ®èç¹ï¼æå¤§æå°äºåºé´æ¥è¯¢æçã\n\n# b æ  vs. b+ æ \n\n * b+ æ æ´éåå¤é¨å­å¨(ä¸è¬æç£çå­å¨)ï¼ç±äºåèç¹(éå¶å­èç¹)ä¸å­å¨ dataï¼æä»¥ä¸ä¸ªèç¹å¯ä»¥å­å¨æ´å¤çåèç¹ï¼æ¯ä¸ªèç¹è½ç´¢å¼çèå´æ´å¤§æ´ç²¾ç¡®ãä¹å°±æ¯è¯´ä½¿ç¨ b+ æ åæ¬¡ç£ç io çä¿¡æ¯éç¸æ¯è¾ b æ æ´å¤§ï¼io æçæ´é«ã\n * mysql æ¯å³ç³»åæ°æ®åºï¼ç»å¸¸ä¼æç§åºé´æ¥è®¿é®æä¸ªç´¢å¼åï¼b+ æ çå¶å­èç¹é´æé¡ºåºå»ºç«äºé¾æéï¼å å¼ºäºåºé´è®¿é®æ§ï¼æä»¥ b+ æ å¯¹ç´¢å¼åä¸çåºé´èå´æ¥è¯¢å¾åå¥½ãè b æ æ¯ä¸ªèç¹ç key å data å¨ä¸èµ·ï¼æ æ³è¿è¡åºé´æ¥æ¾ã\n\n# hash\n\n> hash ç´¢å¼åªæç²¾ç¡®å¹éç´¢å¼ææåçæ¥è¯¢æææã\n\nå¯¹äºæ¯ä¸è¡æ°æ®ï¼å¯¹ææçç´¢å¼åè®¡ç®ä¸ä¸ª hashcodeãåå¸ç´¢å¼å°ææç hashcode å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨ hash è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nåå¸ç»æç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nåå¸ç»æç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ãå¦ï¼å¨æ°æ®å (a,b) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ where price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çªï¼åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n\n\n# ç´¢å¼ç­ç¥\n\n# ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ï¼\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ï¼\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ï¼\n * é¢ç¹ä½ä¸º where è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼\n\n# ç¬ç«çå\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nselect actor_id from actor where actor_id + 1 = 5;\nselect ... where to_days(current_date) - to_days(date_col) <= 10;\n\n\n# åç¼ç´¢å¼åç´¢å¼éæ©æ§\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè§£å³æ¹æ³æ¯ï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nå¯¹äº blob/text/varchar è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nè¦éæ©è¶³å¤é¿çåç¼ä»¥ä¿è¯è¾é«çéæ©æ§ï¼åæ¶åä¸è½å¤ªé¿ï¼èçº¦ç©ºé´ï¼ã\n\nâ ä½æç¤ºä¾ï¼\n\nselect count(*) as cnt, city from sakila.city_demo\ngroup by city order by cnt desc limit 10;\n\n\nâ é«æç¤ºä¾ï¼\n\nselect count(*) as cnt, left(city, 3) as pref from sakila.city_demo\ngroup by city order by cnt desc limit 10;\n\n\n# å¤åç´¢å¼\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè where å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¸¾ä¾æ¥è¯´ï¼æä¸å¼  user è¡¨ï¼å¶ä¸­å« name, sex, age ä¸ä¸ªåï¼å¦æå°è¿ä¸èç»åä¸ºå¤åç´¢å¼ï¼åºè¯¥ç¨ä»ä¹æ ·çé¡ºåºå¢ï¼ä»éæ©æ§é«çè§åº¦æ¥çï¼name > age > sexã\n\n# èç°ç´¢å¼\n\nèç°ç´¢å¼ä¸æ¯ä¸ç§åç¬çç´¢å¼ç±»åï¼èæ¯ä¸ç§æ°æ®å­å¨æ¹å¼ãå·ä½ç»èä¾èµäºå®ç°æ¹å¼ãå¦ innodb çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº b æ çç´¢å¼åæ°æ®è¡ã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nè¥æ²¡æå®ä¹ä¸»é®ï¼innodb ä¼éå¼å®ä¹ä¸ä¸ªä¸»é®æ¥ä½ä¸ºèç°ç´¢å¼ã\n\n# è¦çç´¢å¼\n\nç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ã\n\nå·æä»¥ä¸ä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ¡ç®éå¸¸è¿å°äºæ°æ®è¡çå¤§å°ï¼æä»¥è¥åªè¯»åç´¢å¼ï¼è½å¤§å¤§åå°æ°æ®è®¿é®éã\n * ä¸äºå­å¨å¼æï¼ä¾å¦ myisamï¼å¨åå­ä¸­åªç¼å­ç´¢å¼ï¼èæ°æ®ä¾èµäºæä½ç³»ç»æ¥ç¼å­ãå æ­¤ï¼åªè®¿é®ç´¢å¼å¯ä»¥ä¸ä½¿ç¨ç³»ç»è°ç¨ï¼éå¸¸æ¯è¾è´¹æ¶ï¼ã\n * å¯¹äº innodb å¼æï¼è¥è¾å©ç´¢å¼è½å¤è¦çæ¥è¯¢ï¼åæ éè®¿é®ä¸»ç´¢å¼ã\n\n# ä½¿ç¨ç´¢å¼æ«ææ¥åæåº\n\nmysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n\n# æå·¦åç¼å¹éåå\n\nmysql ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,between,like) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¾å­ï¼\n\n * å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ a = 1 and b = 2 and c > 3 and d = 4ï¼åä¼å¨æ¯ä¸ªèç¹ä¾æ¬¡å½ä¸­ aãbãcï¼æ æ³å½ä¸­ dã(å¾ç®åï¼ç´¢å¼å½ä¸­åªè½æ¯ç¸ç­çæåµï¼ä¸è½æ¯èå´å¹é)\n\n# = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè=ãin ç­çé¡ºåºï¼mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nä¾å­ï¼å¦æç´¢å¼(a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼mysql ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcã\n\n\n# çº¦æ\n\næ°æ®åºçº¦æï¼constraintï¼æåªäºï¼\n\n * not null - ç¨äºæ§å¶å­æ®µçåå®¹ä¸å®ä¸è½ä¸ºç©ºï¼nullï¼ã\n * unique - å­æ®µåå®¹ä¸è½éå¤ï¼ä¸ä¸ªè¡¨åè®¸æå¤ä¸ª unique çº¦æã\n * primary key - æ°æ®è¡¨ä¸­å¯¹å¨å­æ°æ®å¯¹è±¡äºä»¥å¯ä¸åå®æ´æ è¯çæ°æ®åæå±æ§çç»åï¼å®å¨ä¸ä¸ªè¡¨ä¸­åªåè®¸æä¸ä¸ªãä¸»é®çåå¼ä¸è½ä¸ºç©ºå¼ï¼nullï¼ã\n * foreign key - å¨ä¸ä¸ªè¡¨ä¸­å­å¨çå¦ä¸ä¸ªè¡¨çä¸»é®ç§°æ­¤è¡¨çå¤é®ãç¨äºé¢é²ç ´åè¡¨ä¹é´è¿æ¥çå¨ä½ï¼ä¹è½é²æ­¢éæ³æ°æ®æå¥å¤é®åï¼å ä¸ºå®å¿é¡»æ¯å®æåçé£ä¸ªè¡¨ä¸­çå¼ä¹ä¸ã\n * check - ç¨äºæ§å¶å­æ®µçå¼èå´ã\n\n\n# äºãå¹¶åæ§å¶\n\n\n# ä¹è§éåæ²è§é\n\n>  * æ°æ®åºçä¹è§éåæ²è§éæ¯ä»ä¹ï¼\n>  * æ°æ®åºçä¹è§éåæ²è§éå¦ä½å®ç°ï¼\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼commitï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³\n\n\n# è¡çº§éåè¡¨çº§é\n\n>  * ä»ä¹æ¯è¡çº§éåè¡¨çº§éï¼\n>  * ä»ä¹æ¶åç¨è¡çº§éï¼ä»ä¹æ¶åç¨è¡¨çº§éï¼\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼mysql ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - ä»å¯¹æå®çè¡è®°å½è¿è¡å éï¼è¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\näºèéè¦æè¡¡ï¼\n\n * éå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ã\n * éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨ innodb ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼innodb å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# è¯»åé\n\n>  * ä»ä¹æ¯è¯»åéï¼\n\n * ç¬äº«éï¼exclusiveï¼ï¼ç®åä¸º x éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼select ... for update;\n * å±äº«éï¼sharedï¼ï¼ç®åä¸º s éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼select ... lock in share mode;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\ninnodb ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# æåé\n\n>  * ä»ä¹æ¯æåéï¼\n>  * æåéæä»ä¹ç¨ï¼\n\næåéçä½ç¨æ¯ï¼å½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼intention locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ innodb èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\n\n# mvcc\n\n> ä»ä¹æ¯ mvccï¼\n> \n> mvcc æä»ä¹ç¨ï¼è§£å³äºä»ä¹é®é¢ï¼\n> \n> mvcc çåçæ¯ä»ä¹ï¼\n\nå¤çæ¬å¹¶åæ§å¶ï¼multi-version concurrency control, mvccï¼æ¯ innodb å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ mvccãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ mvcc æ æ³å®ç°ã\n\nmvcc çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ãåæä½ï¼deleteãinsertãupdateï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ï¼è¿ä¸ç¹å copyonwrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼mvcc è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# next-key é\n\nnext-key éæ¯ mysql ç innodb å­å¨å¼æçä¸ç§éå®ç°ã\n\nmvcc ä¸è½è§£å³å¹»è¯»é®é¢ï¼next-key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼repeatable readï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ mvcc + next-key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nå¦å¤ï¼æ ¹æ®éå¯¹ sql è¯­å¥æ£ç´¢æ¡ä»¶çä¸åï¼å éåæä»¥ä¸ä¸ç§æå½¢éè¦æä»¬ææ¡ã\n\n * record lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * gap lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ãselect c from t where c between 10 and 20 for update;\n * next-key lock -å®æ¯ record lock å gap lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ sql è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼mysql å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼mysql ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ updateãdelete æä½æ¶ï¼mysql ä¸ä»éå® where æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼innodb ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# ä¸ãäºå¡\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ acid ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ rollback è¿è¡åæ»ã\n\n\n\n\n# acid\n\nacid â æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ï¼\n\n * åå­æ§ï¼atomicityï¼\n * ä¸è´æ§ï¼consistencyï¼\n * éç¦»æ§ï¼isolationï¼\n * æä¹æ§ï¼durabilityï¼\n\nä¸ä¸ªæ¯æäºå¡ï¼transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n\n\n\n# å¹¶åä¸è´æ§é®é¢\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ã\n\n * ä¸¢å¤±ä¿®æ¹\n\nt1 å t2 ä¸¤ä¸ªäºå¡é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼t1 åä¿®æ¹ï¼t2 éåä¿®æ¹ï¼t2 çä¿®æ¹è¦çäº t1 çä¿®æ¹ã\n\n\n\n * èè¯»\n\nt1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼t2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ t1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ t2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n * ä¸å¯éå¤è¯»\n\nt2 è¯»åä¸ä¸ªæ°æ®ï¼t1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ t2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n * å¹»è¯»\n\nt1 è¯»åæä¸ªèå´çæ°æ®ï¼t2 å¨è¿ä¸ªèå´åæå¥æ°çæ°æ®ï¼t1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\nå¹¶åä¸è´æ§è§£å³æ¹æ¡ï¼\n\näº§çå¹¶åä¸ä¸è´æ§é®é¢ä¸»è¦åå æ¯ç ´åäºäºå¡çéç¦»æ§ï¼è§£å³æ¹æ³æ¯éè¿å¹¶åæ§å¶æ¥ä¿è¯éç¦»æ§ã\n\nå¹¶åæ§å¶å¯ä»¥éè¿å°éæ¥å®ç°ï¼ä½æ¯å°éæä½éè¦ç¨æ·èªå·±æ§å¶ï¼ç¸å½å¤æãæ°æ®åºç®¡çç³»ç»æä¾äºäºå¡çéç¦»çº§å«ï¼è®©ç¨æ·ä»¥ä¸ç§æ´è½»æ¾çæ¹å¼å¤çå¹¶åä¸è´æ§é®é¢ã\n\n\n# äºå¡éç¦»\n\næ°æ®åºéç¦»çº§å«ï¼\n\n * æªæäº¤è¯»ï¼read uncommittedï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * æäº¤è¯»ï¼read committedï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼repeatable readï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼serialixableï¼ - å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\næªæäº¤è¯»   â    â       â\næäº¤è¯»    âï¸   â       â\nå¯éå¤è¯»   âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸   âï¸      âï¸\n\n\n# åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡ æ¯æäºå¡çåä¸èãæ¯æäºå¡çæå¡å¨ãèµæºæå¡å¨ä»¥åäºå¡ç®¡çå¨åå«ä½äºä¸åçåå¸å¼ç³»ç»çä¸åèç¹ä¹ä¸ã\n\n# ä¸¤é¶æ®µæäº¤\n\nä¸¤é¶æ®µæäº¤ï¼xaï¼å¯¹ä¸å¡ä¾µå¥å¾å°ã å®æå¤§çä¼å¿å°±æ¯å¯¹ä½¿ç¨æ¹éæï¼ç¨æ·å¯ä»¥åä½¿ç¨æ¬å°äºå¡ä¸æ ·ä½¿ç¨åºäº xa åè®®çåå¸å¼äºå¡ã xa åè®®è½å¤ä¸¥æ ¼ä¿éäºå¡ acid ç¹æ§ã\n\nä¸¥æ ¼ä¿éäºå¡ acid ç¹æ§æ¯ä¸æåååã äºå¡æ§è¡å¨è¿ç¨ä¸­éè¦å°æéèµæºå¨é¨éå®ï¼å®æ´å éç¨äºæ§è¡æ¶é´ç¡®å®çç­äºå¡ã å¯¹äºé¿äºå¡æ¥è¯´ï¼æ´ä¸ªäºå¡è¿è¡æé´å¯¹æ°æ®çç¬å ï¼å°å¯¼è´å¯¹ç­ç¹æ°æ®ä¾èµçä¸å¡ç³»ç»å¹¶åæ§è½è¡°éææ¾ã å æ­¤ï¼å¨é«å¹¶åçæ§è½è³ä¸åºæ¯ä¸­ï¼åºäº xa åè®®çåå¸å¼äºå¡å¹¶ä¸æ¯æä½³éæ©ã\n\n# ææ§äºå¡\n\nå¦æå°å®ç°äºacid çäºå¡è¦ç´ çäºå¡ç§°ä¸ºåæ§äºå¡çè¯ï¼é£ä¹åºäºbaseäºå¡è¦ç´ çäºå¡åç§°ä¸ºææ§äºå¡ã baseæ¯åºæ¬å¯ç¨ãææ§ç¶æåæç»ä¸è´æ§è¿ä¸ä¸ªè¦ç´ çç¼©åã\n\n * åºæ¬å¯ç¨ï¼basically availableï¼ä¿è¯åå¸å¼äºå¡åä¸æ¹ä¸ä¸å®åæ¶å¨çº¿ã\n * ææ§ç¶æï¼soft stateï¼ååè®¸ç³»ç»ç¶ææ´æ°æä¸å®çå»¶æ¶ï¼è¿ä¸ªå»¶æ¶å¯¹å®¢æ·æ¥è¯´ä¸ä¸å®è½å¤å¯è§ã\n * èæç»ä¸è´æ§ï¼eventually consistentï¼éå¸¸æ¯éè¿æ¶æ¯ä¼ éçæ¹å¼ä¿è¯ç³»ç»çæç»ä¸è´æ§ã\n\nå¨acidäºå¡ä¸­å¯¹éç¦»æ§çè¦æ±å¾é«ï¼å¨äºå¡æ§è¡è¿ç¨ä¸­ï¼å¿é¡»å°ææçèµæºéå®ã ææ§äºå¡ççå¿µåæ¯éè¿ä¸å¡é»è¾å°äºæ¥éæä½ä»èµæºå±é¢ä¸ç§»è³ä¸å¡å±é¢ãéè¿æ¾å®½å¯¹å¼ºä¸è´æ§è¦æ±ï¼æ¥æ¢åç³»ç»ååéçæåã\n\nåºäºacidçå¼ºä¸è´æ§äºå¡ååºäºbaseçæç»ä¸è´æ§äºå¡é½ä¸æ¯é¶å¼¹ï¼åªæå¨æéåçåºæ¯ä¸­æè½åæ¥å®ä»¬çæå¤§é¿å¤ã å¯éè¿ä¸è¡¨è¯¦ç»å¯¹æ¯å®ä»¬ä¹é´çåºå«ï¼ä»¥å¸®å©å¼åèè¿è¡ææ¯éåã\n\n# äºå¡æ¹æ¡å¯¹æ¯\n\n       æ¬å°äºå¡       ä¸¤ï¼ä¸ï¼é¶æ®µäºå¡    ææ§äºå¡\nä¸å¡æ¹é    æ           æ            å®ç°ç¸å³æ¥å£\nä¸è´æ§    ä¸æ¯æ        æ¯æ          æç»ä¸è´\néç¦»æ§    ä¸æ¯æ        æ¯æ          ä¸å¡æ¹ä¿è¯\nå¹¶åæ§è½   æ å½±å        ä¸¥éè¡°é        ç¥å¾®è¡°é\néååºæ¯   ä¸å¡æ¹å¤çä¸ä¸è´   ç­äºå¡ & ä½å¹¶å   é¿äºå¡ & é«å¹¶å\n\n\n# åãååºåè¡¨\n\n\n# ä»ä¹æ¯ååºåè¡¨\n\n> ä»ä¹æ¯ååºåè¡¨ï¼ä»ä¹æ¯åç´æåï¼ä»ä¹æ¯æ°´å¹³æåï¼ä»ä¹æ¯ shardingï¼\n> \n> ååºåè¡¨æ¯ä¸ºäºè§£å³ä»ä¹é®é¢ï¼\n> \n> ååºåè¡¨æä»ä¹ä¼ç¹ï¼\n> \n> ååºåè¡¨æä»ä¹ç­ç¥ï¼\n\nååºåè¡¨çåºæ¬ææ³å°±æ¯ï¼æåæ¬å®æ´çæ°æ®ååæå¤ä¸ªé¨åï¼æ¾å°ä¸åçæ°æ®åºæè¡¨ä¸ã\n\nååºåè¡¨ä¸å®æ¯ä¸ºäºæ¯æ é«å¹¶åãæ°æ®éå¤§ä¸¤ä¸ªé®é¢çã\n\n# åç´åå\n\n> åç´ååï¼æ¯ æä¸ä¸ªæå¾å¤å­æ®µçè¡¨ç»æåæå¤ä¸ªè¡¨ï¼æèæ¯å¤ä¸ªåºä¸å»ãä¸è¬æ¥è¯´ï¼ä¼ å°è¾å°çãè®¿é®é¢çè¾é«çå­æ®µæ¾å°ä¸ä¸ªè¡¨éå»ï¼ç¶å å°è¾å¤çãè®¿é®é¢çè¾ä½çå­æ®µæ¾å°å¦å¤ä¸ä¸ªè¡¨éå»ãå ä¸ºæ°æ®åºæ¯æç¼å­çï¼è®¿é®é¢çé«çè¡å­æ®µè¶å°ï¼å°±å¯ä»¥å¨ç¼å­éç¼å­æ´å¤çè¡ï¼æ§è½å°±è¶å¥½ãè¿ä¸ªä¸è¬å¨è¡¨å±é¢åçè¾å¤ä¸äºã\n\n\n\nä¸è¬æ¥è¯´ï¼æ»¡è¶³ä¸é¢çæ¡ä»¶å°±å¯ä»¥èèæ©å®¹äºï¼\n\n * mysql ååºè¶è¿ 5000 ä¸æ¡è®°å½ï¼oracle ååºè¶è¿ 1 äº¿æ¡è®°å½ï¼db ååå°±å¾å¤§ã\n * ååºè¶è¿æ¯ç§ 2000 ä¸ªå¹¶åæ¶ï¼èä¸ä¸ªå¥åº·çååºæå¥½ä¿æå¨æ¯ç§ 1000 ä¸ªå¹¶åå·¦å³ï¼ä¸è¦å¤ªå¤§ã\n\nå¨æ°æ®åºçå±é¢ä½¿ç¨åç´ååå°ææ°æ®åºä¸­è¡¨çå¯éç¨åº¦é¨ç½²å°ä¸åçåºä¸­ï¼ä¾å¦å°åæ¥ççµåæ°æ®åºåç´ååæååæ°æ®åºãç¨æ·æ°æ®åºç­ã\n\n# æ°´å¹³æå\n\n> æ°´å¹³æå åç§°ä¸º shardingï¼å®æ¯å°åä¸ä¸ªè¡¨ä¸­çè®°å½æåå°å¤ä¸ªç»æç¸åçè¡¨ä¸­ãå½ åè¡¨æ°æ®éå¤ªå¤§ æ¶ï¼ä¼æå¤§å½±å sql æ§è¡çæ§è½ ãåè¡¨æ¯å°åæ¥ä¸å¼ è¡¨çæ°æ®åå¸å°æ°æ®åºéç¾¤çä¸åèç¹ä¸ï¼ä»èç¼è§£åç¹çååã\n\n\n\nä¸è¬æ¥è¯´ï¼åè¡¨æ 200 ä¸æ¡æ°æ® çæ¶åï¼æ§è½å°±ä¼ç¸å¯¹å·®ä¸äºäºï¼éè¦èèåè¡¨äºãä½æ¯ï¼è¿ä¹è¦è§å·ä½æåµèå®ï¼å¯è½æ¯ 100 ä¸æ¡ï¼ä¹å¯è½æ¯ 500 ä¸æ¡ï¼sql è¶å¤æï¼å°±æå¥½è®©åè¡¨è¡æ°è¶å°ã\n\n# ååºåè¡¨çä¼ç¹\n\n#          ååºåè¡¨å              ååºåè¡¨å\nå¹¶åæ¯ææåµ     åæºé¨ç½²ï¼æä¸ä½é«å¹¶å        ä»åæºå°å¤æºï¼è½æ¿åçå¹¶åå¢å äºå¤å\nç£çä½¿ç¨æåµ     åæºç£çå®¹éå ä¹ææ»¡         æåä¸ºå¤ä¸ªåºï¼æ°æ®åºæå¡å¨ç£çä½¿ç¨çå¤§å¤§éä½\nsql æ§è¡æ§è½   åè¡¨æ°æ®éå¤ªå¤§ï¼sql è¶è·è¶æ¢   åè¡¨æ°æ®éåå°ï¼sql æ§è¡æçææ¾æå\n\n# ååºåè¡¨ç­ç¥\n\n * åå¸åæ¨¡ï¼hash(key) % n æ id % n\n   * ä¼ç¹ï¼å¯ä»¥å¹³ååéæ¯ä¸ªåºçæ°æ®éåè¯·æ±ååï¼è´è½½åè¡¡ï¼ã\n   * ç¼ºç¹ï¼æ©å®¹éº»ç¦ï¼éè¦æ°æ®è¿ç§»ã\n * èå´ï¼å¯ä»¥æç§ id ææ¶é´ååèå´ã\n   * ä¼ç¹ï¼æ©å®¹ç®åã\n   * ç¼ºç¹ï¼è¿ç§ç­ç¥å®¹æäº§çç­ç¹é®é¢ã\n * æ å°è¡¨ï¼ä½¿ç¨åç¬çä¸ä¸ªæ°æ®åºæ¥å­å¨æ å°å³ç³»ã\n   * ç¼ºç¹ï¼å­å¨æ å°å³ç³»çæ°æ®åºä¹å¯è½æä¸ºæ§è½ç¶é¢ï¼ä¸ä¸æ¦å®æºï¼ååºåè¡¨çæ°æ®åºå°±æ æ³å·¥ä½ãæä»¥ä¸å»ºè®®ä½¿ç¨è¿ç§ç­ç¥ã\n   * ä¼ç¹ï¼æ©å®¹ç®åï¼å¯ä»¥è§£å³åå¸å¼ id é®é¢ã\n\n\n# ååºåè¡¨ä¸­é´ä»¶\n\n> â å¸¸è§é®é¢ï¼\n> \n>  * ä½ ç¨è¿åªäºååºåè¡¨ä¸­é´ä»¶ï¼ç®åä»ç»ä¸ä¸ï¼\n> \n>  * ä¸åçååºåè¡¨ä¸­é´ä»¶åèªæä»ä¹ç¹æ§ï¼æä»ä¹ä¼ç¼ºç¹ï¼\n> \n>  * ååºåè¡¨ä¸­é´ä»¶ææ¯å¦ä½éåï¼\n\n# å¸¸è§çååºåè¡¨ä¸­é´ä»¶\n\n * cobar - é¿é b2b å¢éå¼ååå¼æºçï¼å±äº proxy å±æ¹æ¡ï¼å°±æ¯ä»äºåºç¨æå¡å¨åæ°æ®åºæå¡å¨ä¹é´ãåºç¨ç¨åºéè¿ jdbc é©±å¨è®¿é® cobar éç¾¤ï¼cobar æ ¹æ® sql åååºè§åå¯¹ sql ååè§£ï¼ç¶åååå° mysql éç¾¤ä¸åçæ°æ®åºå®ä¾ä¸æ§è¡ãæ©äºå¹´è¿å¯ä»¥ç¨ï¼ä½æ¯æè¿å å¹´é½æ²¡æ´æ°äºï¼åºæ¬æ²¡å¥äººç¨ï¼å·®ä¸å¤ç®æ¯è¢«æå¼çç¶æå§ãèä¸ä¸æ¯æè¯»ååç¦»ãå­å¨è¿ç¨ãè·¨åº join ååé¡µç­æä½ã\n * tddl - æ·å®å¢éå¼åçï¼å±äº client å±æ¹æ¡ãæ¯æåºæ¬ç crud è¯­æ³åè¯»ååç¦»ï¼ä½ä¸æ¯æ joinãå¤è¡¨æ¥è¯¢ç­è¯­æ³ãç®åä½¿ç¨çä¹ä¸å¤ï¼å ä¸ºè¿ä¾èµæ·å®ç diamond éç½®ç®¡çç³»ç»ã\n * atlas - 360 å¼æºçï¼å±äº proxy å±æ¹æ¡ï¼ä»¥åæ¯æä¸äºå¬å¸å¨ç¨çï¼ä½æ¯ç¡®å®æä¸ä¸ªå¾å¤§çé®é¢å°±æ¯ç¤¾åºææ°çç»´æ¤é½å¨ 5 å¹´åäºãæä»¥ï¼ç°å¨ç¨çå¬å¸åºæ¬ä¹å¾å°äºã\n * sharding-jdbc - å½å½å¼æºçï¼å±äº client å±æ¹æ¡ãç¡®å®ä¹åç¨çè¿æ¯è¾å¤ä¸äºï¼å ä¸º sql è¯­æ³æ¯æä¹æ¯è¾å¤ï¼æ²¡æå¤ªå¤éå¶ï¼èä¸ç®åæ¨åºå°äº 2.0 çæ¬ï¼æ¯æååºåè¡¨ãè¯»ååç¦»ãåå¸å¼ id çæãææ§äºå¡ï¼æå¤§åªåéè¾¾åäºå¡ãtcc äºå¡ï¼ãèä¸ç¡®å®ä¹åä½¿ç¨çå¬å¸ä¼æ¯è¾å¤ä¸äºï¼è¿ä¸ªå¨å®ç½æç»è®°ä½¿ç¨çå¬å¸ï¼å¯ä»¥çå°ä» 2017 å¹´ä¸ç´å°ç°å¨ï¼æ¯æä¸å°å¬å¸å¨ç¨çï¼ï¼ç®åç¤¾åºä¹è¿ä¸ç´å¨å¼ååç»´æ¤ï¼è¿ç®æ¯æ¯è¾æ´»è·ï¼ä¸ªäººè®¤ä¸ºç®æ¯ä¸ä¸ªç°å¨ä¹å¯ä»¥éæ©çæ¹æ¡ã\n * mycat - åºäº cobar æ¹é çï¼å±äº proxy å±æ¹æ¡ï¼æ¯æçåè½éå¸¸å®åï¼èä¸ç®ååºè¯¥æ¯éå¸¸ç«çèä¸ä¸æ­æµè¡çæ°æ®åºä¸­é´ä»¶ï¼ç¤¾åºå¾æ´»è·ï¼ä¹æä¸äºå¬å¸å¼å§å¨ç¨äºãä½æ¯ç¡®å®ç¸æ¯äº sharding jdbc æ¥è¯´ï¼å¹´è½»ä¸äºï¼ç»åçé¤ç¼å°ä¸äºã\n\n# ååºåè¡¨ä¸­é´ä»¶ææ¯éå\n\nå»ºè®®ä½¿ç¨çæ¯ sharding-jdbc å mycatã\n\n * sharding-jdbc è¿ç§ client å±æ¹æ¡çä¼ç¹å¨äºä¸ç¨é¨ç½²ï¼è¿ç»´ææ¬ä½ï¼ä¸éè¦ä»£çå±çäºæ¬¡è½¬åè¯·æ±ï¼æ§è½å¾é«ï¼ä½æ¯å¦æéå°åçº§å¥çéè¦åä¸ªç³»ç»é½éæ°åçº§çæ¬ååå¸ï¼åä¸ªç³»ç»é½éè¦è¦å sharding-jdbc çä¾èµãå¶æ¬è´¨ä¸éè¿éç½®å¤æ°æ®æºï¼ç¶åæ ¹æ®è®¾å®çååºåè¡¨ç­ç¥ï¼è®¡ç®è·¯ç±ï¼å°è¯·æ±åéå°è®¡ç®å¾å°çèç¹ä¸ã\n\n * mycat è¿ç§ proxy å±æ¹æ¡çç¼ºç¹å¨äºéè¦é¨ç½²ï¼èªå·±è¿ç»´ä¸å¥ä¸­é´ä»¶ï¼è¿ç»´ææ¬é«ï¼ä½æ¯å¥½å¤å¨äºå¯¹äºåä¸ªé¡¹ç®æ¯éæçï¼å¦æéå°åçº§ä¹ç±»çé½æ¯èªå·±ä¸­é´ä»¶é£éæå°±è¡äºã\n\néå¸¸æ¥è¯´ï¼è¿ä¸¤ä¸ªæ¹æ¡å¶å®é½å¯ä»¥éç¨ï¼ä½æ¯æä¸ªäººå»ºè®®ä¸­å°åå¬å¸éç¨ sharding-jdbcï¼client å±æ¹æ¡è½»ä¾¿ï¼èä¸ç»´æ¤ææ¬ä½ï¼ä¸éè¦é¢å¤å¢æ´¾äººæï¼èä¸ä¸­å°åå¬å¸ç³»ç»å¤æåº¦ä¼ä½ä¸äºï¼é¡¹ç®ä¹æ²¡é£ä¹å¤ï¼ä½æ¯ä¸­å¤§åå¬å¸æå¥½è¿æ¯éç¨ mycat è¿ç±» proxy å±æ¹æ¡ï¼å ä¸ºå¯è½å¤§å¬å¸ç³»ç»åé¡¹ç®éå¸¸å¤ï¼å¢éå¾å¤§ï¼äººååè¶³ï¼é£ä¹æå¥½æ¯ä¸é¨å¼ä¸ªäººæ¥ç ç©¶åç»´æ¤ mycatï¼ç¶åå¤§éé¡¹ç®ç´æ¥éæä½¿ç¨å³å¯ã\n\n\n# ååºåè¡¨çé®é¢\n\n>  * ååºåè¡¨çå¸¸è§é®é¢æåªäºï¼\n> \n>  * ä½ æ¯å¦ä½è§£å³ååºåè¡¨çé®é¢çï¼\n> \n> ä¸æä¸ä¸è®²è§£å¸¸è§ååºåè¡¨çé®é¢åè§£å³æ¹æ¡ã\n\n# åå¸å¼äºå¡\n\næ¹æ¡ä¸ï¼ä½¿ç¨æ°æ®åºäºå¡\n\n * ä¼ç¹ï¼äº¤ç±æ°æ®åºç®¡çï¼ç®åææ\n * ç¼ºç¹ï¼æ§è½ä»£ä»·é«ï¼ç¹å«æ¯ shard è¶æ¥è¶å¤æ¶\n\næ¹æ¡äºï¼ç±åºç¨ç¨åºåæ°æ®åºå±åæ§å¶\n\n * åçï¼å°ä¸ä¸ªè·¨å¤ä¸ªæ°æ®åºçåå¸å¼äºå¡åææå¤ä¸ªä»å¤äºåä¸ªæ°æ®åºä¸é¢çå°äºå¡ï¼å¹¶éè¿åºç¨ç¨åºæ¥æ»æ§åä¸ªå°äºå¡ã\n * ä¼ç¹ï¼æ§è½ä¸æä¼å¿\n * ç¼ºç¹ï¼éè¦åºç¨ç¨åºå¨äºå¡æ§å¶ä¸åçµæ´»è®¾è®¡ãå¦æä½¿ç¨äº spring çäºå¡ç®¡çï¼æ¹å¨èµ·æ¥ä¼é¢ä¸´ä¸å®çå°é¾ã\n\n# è·¨èç¹ join\n\nåªè¦æ¯è¿è¡ååï¼è·¨èç¹ join çé®é¢æ¯ä¸å¯é¿åçãä½æ¯è¯å¥½çè®¾è®¡åååå´å¯ä»¥åå°æ­¤ç±»æåµçåçãè§£å³è¿ä¸é®é¢çæ®éåæ³æ¯åä¸¤æ¬¡æ¥è¯¢å®ç°ãå¨ç¬¬ä¸æ¬¡æ¥è¯¢çç»æéä¸­æ¾åºå³èæ°æ®ç idï¼æ ¹æ®è¿äº id åèµ·ç¬¬äºæ¬¡è¯·æ±å¾å°å³èæ°æ®ã\n\n# è·¨èç¹ç count,order by,group by ä»¥åèåå½æ°\n\nè¿äºæ¯ä¸ç±»é®é¢ï¼å ä¸ºå®ä»¬é½éè¦åºäºå¨é¨æ°æ®éåè¿è¡è®¡ç®ãå¤æ°çä»£çé½ä¸ä¼èªå¨å¤çåå¹¶å·¥ä½ã\n\nè§£å³æ¹æ¡ï¼ä¸è§£å³è·¨èç¹ join é®é¢çç±»ä¼¼ï¼åå«å¨åä¸ªèç¹ä¸å¾å°ç»æåå¨åºç¨ç¨åºç«¯è¿è¡åå¹¶ãå join ä¸åçæ¯æ¯ä¸ªèç¹çæ¥è¯¢å¯ä»¥å¹¶è¡æ§è¡ï¼å æ­¤å¾å¤æ¶åå®çéåº¦è¦æ¯åä¸å¤§è¡¨å¿«å¾å¤ãä½å¦æç»æéå¾å¤§ï¼å¯¹åºç¨ç¨åºåå­çæ¶èæ¯ä¸ä¸ªé®é¢ã\n\nä¸å¡è§åº¦ä¸çè§£å³æ¹æ¡ï¼\n\n * å¦ææ¯å¨åå°åºç¨æä¾åé¡µï¼åéå®ç¨æ·åªè½çåé¢ n é¡µï¼è¿ä¸ªéå¶å¨ä¸å¡ä¸ä¹æ¯åççï¼ä¸è¬çåé¢çåé¡µæä¹ä¸å¤§ï¼å¦æä¸å®è¦çï¼å¯ä»¥è¦æ±ç¨æ·ç¼©å°èå´éæ°æ¥è¯¢ï¼ã\n * å¦ææ¯åå°æ¹å¤çä»»å¡è¦æ±åæ¹è·åæ°æ®ï¼åå¯ä»¥å å¤§ page sizeï¼æ¯å¦æ¯æ¬¡è·å 5000 æ¡è®°å½ï¼ææåå°åé¡µæ°ï¼å½ç¶ç¦»çº¿è®¿é®ä¸è¬èµ°å¤åºï¼é¿åå²å»ä¸»åºï¼ã\n * ååºè®¾è®¡æ¶ï¼ä¸è¬è¿æéå¥å¤§æ°æ®å¹³å°æ±æ»ææååºçè®°å½ï¼æäºåé¡µæ¥è¯¢å¯ä»¥èèèµ°å¤§æ°æ®å¹³å°ã\n\n# åå¸å¼ id\n\nä¸æ¦æ°æ®åºè¢«ååå°å¤ä¸ªç©çèç¹ä¸ï¼æä»¬å°ä¸è½åä¾èµæ°æ®åºèªèº«çä¸»é®çææºå¶ãä¸æ¹é¢ï¼æä¸ªååºæ°æ®åºèªçæç id æ æ³ä¿è¯å¨å¨å±ä¸æ¯å¯ä¸çï¼å¦ä¸æ¹é¢ï¼åºç¨ç¨åºå¨æå¥æ°æ®ä¹åéè¦åè·å¾ idï¼ä»¥ä¾¿è¿è¡ sql è·¯ç±ã\n\nä¸äºå¸¸è§çä¸»é®çæç­ç¥ï¼\n\n * ä½¿ç¨å¨å±å¯ä¸ idï¼guidã\n * ä¸ºæ¯ä¸ªåçæå®ä¸ä¸ª id èå´ã\n * åå¸å¼ id çæå¨ (å¦ twitter ç snowflake ç®æ³)ã\n\n# æ°æ®è¿ç§»ï¼å®¹éè§åï¼æ©å®¹ç­é®é¢\n\næ¥èªæ·å®ç»¼åä¸å¡å¹³å°å¢éï¼å®å©ç¨å¯¹ 2 çåæ°åä½å·æååå¼å®¹çç¹æ§ï¼å¦å¯¹ 4 åä½å¾ 1 çæ°å¯¹ 2 åä½ä¹æ¯ 1ï¼æ¥åéæ°æ®ï¼é¿åäºè¡çº§å«çæ°æ®è¿ç§»ï¼ä½æ¯ä¾ç¶éè¦è¿è¡è¡¨çº§å«çè¿ç§»ï¼åæ¶å¯¹æ©å®¹è§æ¨¡ååè¡¨æ°éé½æéå¶ãæ»å¾æ¥è¯´ï¼è¿äºæ¹æ¡é½ä¸æ¯ååççæ³ï¼å¤å¤å°å°é½å­å¨ä¸äºç¼ºç¹ï¼è¿ä¹ä»ä¸ä¸ªä¾§é¢åæ åºäº sharding æ©å®¹çé¾åº¦ã\n\n\n# äºãéç¾¤\n\n> è¿ä¸ªä¸é¢éè¦æ ¹æ®çæåªä¸ªæ°æ®åºèå®ï¼ä½æ¯ä¸»æµãæççæ°æ®åºé½ä¼å®ç°ä¸äºåºæ¬åè½ï¼åªæ¯å®ç°æ¹å¼ãç­ç¥ä¸ææå·®å¼ãç±äºæ¬äººè¾ä¸ºçæ mysqlï¼æä»¥ä¸é¢ä¸»è¦ä»ç» mysql ç³»ç»æ¶æé®é¢ã\n\n\n# å¤å¶æºå¶\n\nmysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼binlogï¼ï¼ç¶åå¨ä»åºä¸ä»¥å¼æ­¥æ¹å¼æ´æ°ä¸»åºä¸çæ¥å¿è®°å½ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ï¼å³æç»ä¸è´æ§ï¼ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãi/o çº¿ç¨å sql çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * i/o çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çæ¥å¿ä¸­ã\n * sql çº¿ç¨ ï¼è´è´£è¯»åæ¥å¿å¹¶æ§è¡ sql è¯­å¥ä»¥æ´æ°æ°æ®ã\n\n\n\n\n# è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nmysql è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® myisam å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n\n\n# å­ãæ°æ®åºä¼å\n\næ°æ®åºä¼åçè·¯çº¿ä¸è¬ä¸ºï¼sql ä¼åãç»æä¼åãéç½®ä¼åãç¡¬ä»¶ä¼åãåä¸¤ä¸ªæ¹åä¸è¬æ¯æ®éå¼åçèéç¹ï¼èåä¸¤ä¸ªæ¹åä¸è¬æ¯ dba çèéç¹ã\n\n\n# sql ä¼å\n\n> sql ä¼åæ¯æ°æ®åºä¼åçæå¸¸è§ãæåçº§ææ®µã\n> \n> å¨æ§è¡ sql è¯­å¥ï¼è¯­å¥ä¸­å­æ®µçé¡ºåºãæ¥è¯¢ç­ç¥ç­é½å¯è½ä¼å½±åå° sql çæ§è¡æ§è½ã\n\n# æ§è¡è®¡å\n\nå¦ä½æ£éªä¿®æ¹åç sql ç¡®å®æä¼åææï¼è¿å°±éè¦ç¨å°æ§è¡è®¡åï¼explainï¼ã\n\nä½¿ç¨æ§è¡è®¡å explain ç¨æ¥åæ select æ¥è¯¢æçï¼å¼åäººåå¯ä»¥éè¿åæ explain ç»ææ¥ä¼åæ¥è¯¢è¯­å¥ã\n\næ¯è¾éè¦çå­æ®µæï¼\n\n * select_type - æ¥è¯¢ç±»åï¼æç®åæ¥è¯¢ãèåæ¥è¯¢ãå­æ¥è¯¢ç­\n * key - ä½¿ç¨çç´¢å¼\n * rows - æ«æçè¡æ°\n\n> æ´å¤åå®¹è¯·åèï¼mysql æ§è½ä¼åç¥å¨ explain ä½¿ç¨åæ\n\n# è®¿é®æ°æ®ä¼å\n\nåå°è¯·æ±çæ°æ®éï¼\n\n * åªè¿åå¿è¦çå - ä¸è¦æ¥è¯¢ä¸éè¦çåï¼å°½éé¿åä½¿ç¨ select * è¯­å¥ã\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ where è¯­å¥è¿è¡æ¥è¯¢è¿æ»¤ï¼ææ¶åä¹éè¦ä½¿ç¨ limit è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - ä½¿ç¨ç¼å­å¯ä»¥é¿åå¨æ°æ®åºä¸­è¿è¡æ¥è¯¢ï¼ç¹å«è¦æ¥è¯¢çæ°æ®ç»å¸¸è¢«éå¤æ¥è¯¢ï¼ç¼å­å¯ä»¥å¸¦æ¥çæ¥è¯¢æ§è½æåå°ä¼æ¯éå¸¸ææ¾çã\n\nåå°æå¡å¨ç«¯æ«æçè¡æ°ï¼\n\n * æææçæ¹å¼æ¯ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢ï¼å³ where åçè¿æ»¤æ¥è¯¢å­æ®µæå¥½æ¯ç´¢å¼å­æ®µï¼ã\n\n# éææ¥è¯¢æ¹å¼\n\n# ååæ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\ndeleft from messages where create < date_sub(now(), interval 3 month);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"delete from messages where create  < date_sub(now(), interval 3 month) limit 10000\")\n} while rows_affected > 0\n\n\n# åè§£å³èæ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼joinï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ in() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© mysql æç§ id é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nselect * from tag\njoin tag_post on tag_post.tag_id=tag.id\njoin post on tag_post.post_id=post.id\nwhere tag.tag='mysql';\nselect * from tag where tag='mysql';\nselect * from tag_post where tag_id=1234;\nselect * from post where post.id in (123,456,567,9098,8904);\n\n\n# sql è¯­å¥ç»è\n\n# éæ©æææççè¡¨åé¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºå¤ç from å­å¥ä¸­çè¡¨åï¼from å­å¥ä¸­åå¨æåçè¡¨å°è¢«æåå¤çã\n\nå¨ from å­å¥ä¸­åå«å¤ä¸ªè¡¨çæåµä¸ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯å®å¨æ å³ç³»çè¯ï¼å°è®°å½åååæå°çè¡¨ï¼åå¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼éæ©è®°å½æ¡æ°æå°çè¡¨æ¾å¨æåã\n\nå¦ææ 3 ä¸ªä»¥ä¸çè¡¨è¿æ¥æ¥è¯¢ï¼\n\n * å¦æå¤ä¸ªè¡¨æ¯æå³ç³»çè¯ï¼å°å¼ç¨æå¤çè¡¨ï¼æ¾å¨æåï¼ç¶åä¾æ¬¡ç±»æ¨ãä¹å°±æ¯è¯´ï¼è¢«å¶ä»è¡¨æå¼ç¨çè¡¨æ¾å¨æåã\n\nä¾å¦ï¼æ¥è¯¢åå·¥çç¼å·ï¼å§åï¼å·¥èµï¼å·¥èµç­çº§ï¼é¨é¨å\n\nemp è¡¨è¢«å¼ç¨å¾æå¤ï¼è®°å½æ°ä¹æ¯æå¤ï¼å æ­¤æ¾å¨ form å­å¥çæåé¢\n\nselect emp.empno,emp.ename,emp.sal,salgrade.grade,dept.dname\nfrom salgrade,dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal between salgrade.losal and salgrade.hisal)\n\n\n# where å­å¥ä¸­çè¿æ¥é¡ºåº\n\næ°æ®åºæç§ä»å³å°å·¦çé¡ºåºè§£æ where å­å¥ã\n\nå æ­¤ï¼è¡¨ä¹é´çè¿æ¥å¿é¡»åå¨å¶ä» where æ¡ä»¶çå·¦è¾¹ï¼é£äºå¯ä»¥è¿æ»¤ææå¤§æ°éè®°å½çæ¡ä»¶å¿é¡»åå¨ where å­å¥çä¹å³ã\n\nemp.sal å¯ä»¥è¿æ»¤å¤æ¡è®°å½ï¼åå¨ where å­å¥çæå³è¾¹\n\nselect emp.empno,emp.ename,emp.sal,dept.dname\nfrom dept,emp\nwhere (emp.deptno = dept.deptno) and (emp.sal > 1500)\n\n\n# select å­å¥ä¸­é¿åä½¿ç¨ * å·\n\næä»¬å½æ¶å­¦ä¹ çæ¶åï¼â*â å·æ¯å¯ä»¥è·åè¡¨ä¸­å¨é¨çå­æ®µæ°æ®çã\n\n * ä½æ¯å®è¦éè¿æ¥è¯¢æ°æ®å­å¸å®æçï¼è¿æå³çå°èè´¹æ´å¤çæ¶é´\n * ä½¿ç¨*å·ååºæ¥ç sql è¯­å¥ä¹ä¸å¤ç´è§ã\n\n----------------------------------------\n\n# ç¨ truncate æ¿ä»£ delete\n\nå¦æéè¦æ¸ç©ºææè¡¨è®°å½ï¼ä½¿ç¨ truncate æ¯ delete æ§è¡æçé«ï¼\n\ndelete æ¯ä¸æ¡ä¸æ¡è®°å½çå é¤ï¼è truncate æ¯å°æ´ä¸ªè¡¨å é¤ï¼ä»ä¿çè¡¨ç»æ\n\n# ä½¿ç¨åé¨å½æ°æé« sql æç\n\nä¾å¦ä½¿ç¨ mysql ç concat() å½æ°ä¼æ¯ä½¿ç¨ || æ¼æ¥éåº¦å¿«ï¼å ä¸º concat() å½æ°å·²ç»è¢« mysql ä¼åè¿äºã\n\n# ä½¿ç¨è¡¨æåçå«å\n\nå¦æè¡¨æåçåç§°å¤ªé¿äºï¼ä½¿ç¨ä¸äºç®ç­çå«åä¹è½ç¨å¾®æé«ä¸äº sql çæ§è½ãæ¯ç«è¦æ«æçå­ç¬¦é¿åº¦å°±åå°äºã\n\n# sql å³é®å­å¤§å\n\næä»¬å¨ç¼å sql çæ¶åï¼å®æ¹æ¨èçæ¯ä½¿ç¨å¤§åæ¥åå³é®å­ï¼å ä¸º oracle æå¡å¨æ»æ¯åå°å°åå­æ¯è½¬æå¤§ååï¼ææ§è¡\n\n# ç¨ >= æ¿ä»£ >\n\nâ ä½ææ¹å¼ï¼\n\n-- é¦åå®ä½å°deptno=3çè®°å½å¹¶ä¸æ«æå°ç¬¬ä¸ä¸ªdeptå¤§äº3çè®°å½\nselect * from emp where deptno > 3\n\n\nâ é«ææ¹å¼ï¼\n\n-- ç´æ¥è·³å°ç¬¬ä¸ä¸ªdeptç­äº4çè®°å½\nselect * from emp where deptno >= 4\n\n\n# ç¨ in æ¿ä»£ or\n\nâ ä½ææ¹å¼ï¼\n\nselect * from emp where sal = 1500 or sal = 3000 or sal = 800;\n\n\nâ é«ææ¹å¼ï¼\n\nselect * from emp where sal in (1500,3000,800);\n\n\n# æ»æ¯ä½¿ç¨ç´¢å¼çç¬¬ä¸ä¸ªå\n\nå¦æç´¢å¼æ¯å»ºç«å¨å¤ä¸ªåä¸ï¼åªæå¨å®çç¬¬ä¸ä¸ªåè¢« where å­å¥å¼ç¨æ¶ï¼ä¼åå¨æä¼éæ©ä½¿ç¨è¯¥ç´¢å¼ã å½åªå¼ç¨ç´¢å¼çç¬¬äºä¸ªåæ¶ï¼ä¸å¼ç¨ç´¢å¼çç¬¬ä¸ä¸ªåæ¶ï¼ä¼åå¨ä½¿ç¨äºå¨è¡¨æ«æèå¿½ç¥äºç´¢å¼\n\ncreate index emp_sal_job_idex\non emp(sal,job);\n----------------------------------\nselect *\nfrom emp\nwhere job != 'sales';\n\n\n# sql å³é®å­å°½éå¤§å\n\nsql å³é®å­å°½éå¤§åï¼å¦ï¼oracle é»è®¤ä¼å° sql è¯­å¥ä¸­çå³é®å­è½¬ä¸ºå¤§ååå¨æ§è¡ã\n\n\n# ç»æä¼å\n\næ°æ®åºç»æä¼åå¯ä»¥ä»ä»¥ä¸æ¹åçæï¼\n\n * æ°æ®ç±»åä¼å\n * èå¼ååèå¼ä¼å\n * ç´¢å¼ä¼å - ç»èè¯·çç´¢å¼åçº¦æç« è\n * ååºåè¡¨ - ç»èè¯·çååºåè¡¨ç« è\n\n# æ°æ®ç±»åä¼ååå\n\n * æ´å°çéå¸¸æ´å¥½\n * ç®åå°±å¥½ï¼å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½\n * å°½éé¿å null\n\n# èå¼ååèå¼\n\nèå¼ååèå¼åæå©å¼ï¼éè¦æ ¹æ®å®éæåµæè¡¡ã\n\nèå¼åçç®æ æ¯å°½ååå°åä½åï¼èçç©ºé´ã\n\n * èå¼åçä¼ç¹æ¯ï¼\n   \n   * åå°åä½åï¼è¦åçæ°æ®å°±å°ï¼åæä½çæ§è½æé«ï¼\n   * æ£ç´¢åæ°æ®æ¶ï¼distinct æ group by æä½åå°ã\n\n * èå¼åçç¼ºç¹æ¯ï¼å¢å å³èæ¥è¯¢ã\n\nåèå¼åçç®æ æ¯éå½å¢å åä½åï¼ä»¥é¿åå³èæ¥è¯¢ã\n\nåèå¼åçç¼ºç¹æ¯ï¼\n\n * åä½åå¢å¤ï¼ç©ºé´åå¤§ï¼åæä½æ§è½ä¸éï¼\n * æ£ç´¢åæ°æ®æ¶ï¼distinct æ group by æä½åå¤ï¼\n\n\n# éç½®ä¼å\n\n> éç½®ä¼åä¸»è¦æ¯éå¯¹ mysql æå¡å¨ï¼ä¾å¦ï¼max_connectionsãmax_heap_table_sizeãopen_files_limitãmax_allowed_packet ç­ç­ã\n> \n> å¨ä¸åç¯å¢ï¼ä¸ååºæ¯ä¸ï¼åºè¯¥éæä½¿ç¨åççéç½®ãè¿ç§ä¼åæ¯è¾èéª mysql è¿ç»´ç»éªï¼ä¸è¬æ¯ dba çèéï¼æ®éå¼åæ¥è§¦çè¾å°ã\n> \n> mysql éç½®è¯´æè¯·åèï¼mysql æå¡å¨éç½®è¯´æ\n\n\n# ç¡¬ä»¶ä¼å\n\næ°æ®åºæ©å®¹ãä½¿ç¨é«éè®¾å¤ç­ç­ãæ ¸å¿å°±æ¯ä¸ä¸ªå­ï¼é±ã\n\n\n# ä¸ãæ°æ®åºçè®º\n\n\n# å½æ°ä¾èµ\n\nè®° a->b è¡¨ç¤º a å½æ°å³å® bï¼ä¹å¯ä»¥è¯´ b å½æ°ä¾èµäº aã\n\nå¦æ {a1ï¼a2ï¼... ï¼an} æ¯å³ç³»çä¸ä¸ªæå¤ä¸ªå±æ§çéåï¼è¯¥éåå½æ°å³å®äºå³ç³»çå¶å®ææå±æ§å¹¶ä¸æ¯æå°çï¼é£ä¹è¯¥éåå°±ç§°ä¸ºé®ç ã\n\nå¯¹äº a->bï¼å¦æè½æ¾å° a ççå­é a'ï¼ä½¿å¾ a'-> bï¼é£ä¹ a->b å°±æ¯é¨åå½æ°ä¾èµï¼å¦åå°±æ¯å®å¨å½æ°ä¾èµï¼\n\nå¯¹äº a->bï¼b->cï¼å a->c æ¯ä¸ä¸ªä¼ éä¾èµã\n\n\n# å¼å¸¸\n\nä»¥ä¸çå­¦çè¯¾ç¨å³ç³»çå½æ°ä¾èµä¸º sno, cname -> sname, sdept, mname, gradeï¼é®ç ä¸º {sno, cname}ãä¹å°±æ¯è¯´ï¼ç¡®å®å­¦çåè¯¾ç¨ä¹åï¼å°±è½ç¡®å®å¶å®ä¿¡æ¯ã\n\nsno   sname   sdept   mname   cname   grade\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä¸ç¬¦åèå¼çå³ç³»ï¼ä¼äº§çå¾å¤å¼å¸¸ï¼ä¸»è¦æä»¥ä¸åç§å¼å¸¸ï¼\n\n * åä½æ°æ®ï¼ä¾å¦ å­¦ç-2 åºç°äºä¸¤æ¬¡ã\n * ä¿®æ¹å¼å¸¸ï¼ä¿®æ¹äºä¸ä¸ªè®°å½ä¸­çä¿¡æ¯ï¼ä½æ¯å¦ä¸ä¸ªè®°å½ä¸­ç¸åçä¿¡æ¯å´æ²¡æè¢«ä¿®æ¹ã\n * å é¤å¼å¸¸ï¼å é¤ä¸ä¸ªä¿¡æ¯ï¼é£ä¹ä¹ä¼ä¸¢å¤±å¶å®ä¿¡æ¯ãä¾å¦å¦æå é¤äº è¯¾ç¨-1ï¼éè¦å é¤ç¬¬ä¸è¡åç¬¬ä¸è¡ï¼é£ä¹ å­¦ç-1 çä¿¡æ¯å°±ä¼ä¸¢å¤±ã\n * æå¥å¼å¸¸ï¼ä¾å¦æ³è¦æå¥ä¸ä¸ªå­¦ççä¿¡æ¯ï¼å¦æè¿ä¸ªå­¦çè¿æ²¡éè¯¾ï¼é£ä¹å°±æ æ³æå¥ã\n\n\n# èå¼\n\nèå¼çè®ºæ¯ä¸ºäºè§£å³ä»¥ä¸æå°åç§å¼å¸¸ã\n\né«çº§å«èå¼çä¾èµäºä½çº§å«çèå¼ï¼1nf æ¯æä½çº§å«çèå¼ã\n\n\n\n# ç¬¬ä¸èå¼ (1nf)\n\nå±æ§ä¸å¯åã\n\n# ç¬¬äºèå¼ (2nf)\n\n * æ¯ä¸ªéä¸»å±æ§å®å¨å½æ°ä¾èµäºé®ç ã\n\n * å¯ä»¥éè¿åè§£æ¥æ»¡è¶³ã\n\nåè§£å\n\nsno   sname   sdept   mname   cname   grade\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1    è¯¾ç¨-1    90\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    80\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-1    100\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2    è¯¾ç¨-2    95\n\nä»¥ä¸å­¦çè¯¾ç¨å³ç³»ä¸­ï¼{sno, cname} ä¸ºé®ç ï¼æå¦ä¸å½æ°ä¾èµï¼\n\n * sno -> sname, sdept\n * sdept -> mname\n * sno, cname-> grade\n\ngrade å®å¨å½æ°ä¾èµäºé®ç ï¼å®æ²¡æä»»ä½åä½æ°æ®ï¼æ¯ä¸ªå­¦ççæ¯é¨è¯¾é½æç¹å®çæç»©ã\n\nsname, sdept å mname é½é¨åä¾èµäºé®ç ï¼å½ä¸ä¸ªå­¦çéä¿®äºå¤é¨è¯¾æ¶ï¼è¿äºæ°æ®å°±ä¼åºç°å¤æ¬¡ï¼é æå¤§éåä½æ°æ®ã\n\nåè§£å\n\nå³ç³»-1\n\nsno   sname   sdept   mname\n1     å­¦ç-1    å­¦é¢-1    é¢é¿-1\n2     å­¦ç-2    å­¦é¢-2    é¢é¿-2\n3     å­¦ç-3    å­¦é¢-2    é¢é¿-2\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * sno -> sname, sdept, mname\n * sdept -> mname\n\nå³ç³»-2\n\nsno   cname   grade\n1     è¯¾ç¨-1    90\n2     è¯¾ç¨-2    80\n2     è¯¾ç¨-1    100\n3     è¯¾ç¨-2    95\n\næä»¥ä¸å½æ°ä¾èµï¼\n\n * sno, cname -> grade\n\n# ç¬¬ä¸èå¼ (3nf)\n\n * éä¸»å±æ§ä¸ä¼ éä¾èµäºé®ç ã\n\nä¸é¢ç å³ç³»-1 ä¸­å­å¨ä»¥ä¸ä¼ éä¾èµï¼sno -> sdept -> mnameï¼å¯ä»¥è¿è¡ä»¥ä¸åè§£ï¼\n\nå³ç³»-11\n\nsno   sname   sdept\n1     å­¦ç-1    å­¦é¢-1\n2     å­¦ç-2    å­¦é¢-2\n3     å­¦ç-3    å­¦é¢-2\n\nå³ç³»-12\n\nsdept   mname\nå­¦é¢-1    é¢é¿-1\nå­¦é¢-2    é¢é¿-2\n\n\n# å«ãmysql å­å¨å¼æ\n\nmysql æå¤ç§å­å¨å¼æï¼ä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ mysql æå¡å±ç»ä¸å¤ççã\n\nç®ååä¸¾å ä¸ªå­å¨å¼æï¼\n\n * innodb - mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨æéæ¢å¤ã\n * myisam - mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡ææéæ¢å¤åè½ã\n * csv - å¯ä»¥å° csv æä»¶ä½ä¸º mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * memory ãææçæ°æ®é½å¨åå­ä¸­ï¼æ°æ®çå¤çéåº¦å¿«ï¼ä½æ¯å®å¨æ§ä¸é«ã\n\n\n# innodb vs. myisam\n\ninnodb å myisam æ¯ç®åä½¿ç¨çæå¤çä¸¤ç§ mysql å­å¨å¼æã\n\n * æ°æ®ç»ææ¯è¾ï¼\n   * innodb å myisam çç´¢å¼æ°æ®ç»æé½æ¯ b+ æ ã\n   * myiasm ç b+ æ ä¸­å­å¨çåå®¹å®éä¸æ¯å®éæ°æ®çå°åå¼ãä¹å°±æ¯è¯´å®çç´¢å¼åå®éæ°æ®æ¯åå¼çï¼åªä¸è¿ä½¿ç¨ç´¢å¼æåäºå®éæ°æ®ãè¿ç§ç´¢å¼çæ¨¡å¼è¢«ç§°ä¸ºéèéç´¢å¼ã\n   * innodb ç b+ æ ä¸­å­å¨çåå®¹æ¯å®éçæ°æ®ï¼è¿ç§ç´¢å¼æè¢«ç§°ä¸ºèéç´¢å¼ã\n * äºå¡æ¯ææ¯è¾ï¼\n   * innodb æ¯æäºå¡ï¼å¹¶æä¾äºè¡çº§éåå¤é®ççº¦æã\n   * myiasm ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ã\n * æéæ¢å¤æ¯è¾ï¼\n   * innodb æ¯ææéæ¢å¤ã\n   * myisam ä¸æ¯ææéæ¢å¤ã\n\n\n# ä¹ãæ°æ®åºæ¯è¾\n\n\n# å¸¸è§æ°æ®åºæ¯è¾\n\n * oracle - ä¹è´çåçåä¸æ°æ®åºãåè½å¼ºå¤§ãç¨³å®ãæå¤§çç¼ºç¹å°±æ¯è´¹é±ã\n * mysql - æ¾ç»æ¯äºèç½å¬å¸çæç±ï¼ä½èªå¨ mysql è¢« oracle å¬å¸æ¶è´­åï¼å¥½æ¥å­å¯è½ä¸å»ä¸å¤è¿ãå¾å¤å¬å¸æå¼æºé¡¹ç®å·²ç»éæ¸å¯»æ¾å¶ä»çå¼æºäº§åæ¥æ¿ä»£ mysqlã\n * mariadb - å¼æºå³ç³»åæ°æ®åºã mysql ççæ­£å¼æºçåè¡çæ¬ï¼ç± mysql é¨åæ ¸å¿äººååå»ºãå¯ä½ä¸º mysql çæ¿ä»£äº§åã\n * postgresql - å¼æºå³ç³»åæ°æ®åºãå mysql çå·¥ä½æ¹å¼éå¸¸ç¸ä¼¼ï¼ç¤¾åºæ¯æåå¾å¾å¥½ãå¯ä½ä¸º mysql çæ¿ä»£äº§åã\n * sqlite - å¼æºçè½»éçº§æ°æ®åºï¼ç§»å¨ç«¯å¸¸å¸¸ä½¿ç¨ã\n * h2 - åå­æ°æ®åºï¼ä¸è¬ç¨ä½å¼åãæµè¯ç¯å¢æ°æ®åºã\n * sql server - å¾®è½¯ windows çæç³»ç»çæ°æ®åºãææ³ï¼java ç¨åºååºè¯¥æ²¡äººç¨å§ã\n\n\n# oracle vs. mysql\n\nç®åä¸ºæ­¢ï¼java é¢åç¨çæå¤çå³ç³»åæ°æ®åºï¼åºè¯¥è¿æ¯ oracle å mysqlï¼æä»¥è¿éåä¸ä¸æ¯è¾ã\n\n# æ°æ®åºå¯¹è±¡å·®å¼\n\nå¨ mysql ä¸­ï¼ä¸ä¸ªç¨æ·å¯ä»¥åå»ºå¤ä¸ªåºã\n\nèå¨ oracle ä¸­ï¼oracle æå¡å¨æ¯ç±ä¸¤é¨åç»æ\n\n * æ°æ®åºå®ä¾ãçè§£ä¸ºå¯¹è±¡ï¼çä¸è§çã\n * æ°æ®åºãçè§£ä¸ºç±»ï¼çå¾è§çã\n\nä¸ä¸ªæ°æ®åºå®ä¾å¯æ¥æå¤ä¸ªç¨æ·ï¼ä¸ä¸ªç¨æ·é»è®¤æ¥æä¸ä¸ªè¡¨ç©ºé´ã\n\nè¡¨ç©ºé´æ¯å­å¨æä»¬æ°æ®åºè¡¨çå°æ¹ï¼è¡¨ç©ºé´åå¯ä»¥æå¤ä¸ªæä»¶ã\n\n# sql å·®å¼\n\nï¼1ï¼ä¸»é®éå¢\n\nmysql å¯ä»¥è®¾ç½® auto_increment çº¦ææ¥æå®ä¸»é®ä¸ºèªå¢åºåã\n\noracle éè¦éè¿ create sequence åå»ºåºåã\n\nï¼2ï¼åé¡µæ¥è¯¢\n\nmysql åé¡µåºäº select ... from ... limit ... å®æï¼è¾ç®åã\n\nselect * from help_category order by parent_category_id limit 10,5;\n\n\noracle åé¡µåºäº select ... from (select rownum ...) where ... å®æï¼è¾å¤æã\n\nselect * from\n(select rownum rr,a.* from (select * from emp order by sal) a )\nwhere rr>5 and rr<=10;\n\n\n# äºå¡å·®å¼\n\n * auto commit\n   * mysql äºå¡æ¯ autocommit æ¨¡å¼ï¼å³èªå¨æäº¤äºå¡ï¼\n   * oracle äºå¡éè¦æå¨ commitã\n * äºå¡éç¦»çº§å«\n   * mysql é»è®¤çäºå¡éç¦»çº§å«æ¯å¯éå¤è¯»ï¼repeatable readï¼\n   * oracle æ¯æè¯»å·²æäº¤ï¼read committedï¼åä¸²è¡åï¼serializableï¼ ä¸¤ç§äºå¡éç¦»çº§å«ï¼é»è®¤äºå¡éç¦»çº§å«æ¯è¯»å·²æäº¤ï¼read committedï¼\n\n\n# æ°æ®ç±»åæ¯è¾\n\n> ä¸åæ°æ®åºä¸­ï¼å¯¹æ°æ®ç±»åçæ¯ææ¯ä¸ä¸æ ·çã\n> \n> å³ä½¿å­å¨åä¸ç§æ°æ®ç±»åï¼ä¹å¯è½å­å¨åç§°ä¸åãæå¤§å°ä¸åç­é®é¢ã\n> \n> å æ­¤ï¼å¯¹äºæ°æ®ç±»åçæ¯æè¯¦æå¿é¡»åèåæ°æ®åºçå®æ¹ææ¡£ã\n\nä¸é¢åä¸¾ä¸äºå¸¸è§æ°æ®ç±»åå¯¹æ¯ï¼\n\næ°æ®ç±»å                oracle             mysql         postgresql\nboolean             byte               n/a           boolean\ninteger             number             int integer   int integer\nfloat               number             float         numeric\ncurrency            n/a                n/a           money\nstring (fixed)      char               char          char\nstring (variable)   varchar varchar2   varchar       varchar\nbinary object       long raw           blob text     binary varbinary\n\n> æ°æ®ç±»åå¯¹æ¯è¡¨æèª sql éç¨æ°æ®ç±»åãsql ç¨äºåç§æ°æ®åºçæ°æ®ç±»å\n\n\n# åèèµæ\n\n * æ°æ®åºé¢è¯é¢(å¼åèå¿ç)\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ååºåè¡¨éè¦èèçé®é¢åæ¹æ¡\n * æ°æ®åºååºåè¡¨(sharding)ç³»å(äº) å¨å±ä¸»é®çæç­ç¥\n * ä¸ç§æ¯æèªç±è§åæ é¡»æ°æ®è¿ç§»åä¿®æ¹è·¯ç±ä»£ç ç sharding æ©å®¹æ¹æ¡\n * shardingsphere åå¸å¼äºå¡\n * mysql å oracle çåºå«\n * runoob sql æç¨\n * å¦ææäººé®ä½ æ°æ®åºçåçï¼å«ä»çè¿ç¯æç« ",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"sql-cheat-sheet",frontmatter:{title:"sql-cheat-sheet",date:"2018-06-15T16:07:17.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQL"],permalink:"/pages/f1c77c/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/02.SqlCheatSheet.html",relativePath:"03.å³ç³»åæ°æ®åº/01.ç»¼å/02.SqlCheatSheet.md",key:"v-2092ddb6",path:"/pages/f1c77c/",headers:[{level:2,title:"ä¸ãåºæ¬æ¦å¿µ",slug:"ä¸ãåºæ¬æ¦å¿µ",normalizedTitle:"ä¸ãåºæ¬æ¦å¿µ",charIndex:111},{level:3,title:"æ°æ®åºæ¯è¯­",slug:"æ°æ®åºæ¯è¯­",normalizedTitle:"æ°æ®åºæ¯è¯­",charIndex:122},{level:3,title:"SQL è¯­æ³",slug:"sql-è¯­æ³",normalizedTitle:"sql è¯­æ³",charIndex:407},{level:4,title:"SQL è¯­æ³ç»æ",slug:"sql-è¯­æ³ç»æ",normalizedTitle:"sql è¯­æ³ç»æ",charIndex:528},{level:4,title:"SQL è¯­æ³è¦ç¹",slug:"sql-è¯­æ³è¦ç¹",normalizedTitle:"sql è¯­æ³è¦ç¹",charIndex:787},{level:4,title:"SQL åç±»",slug:"sql-åç±»",normalizedTitle:"sql åç±»",charIndex:1179},{level:4,title:"æ°æ®å®ä¹è¯­è¨ï¼DDLï¼",slug:"æ°æ®å®ä¹è¯­è¨-ddl",normalizedTitle:"æ°æ®å®ä¹è¯­è¨ï¼ddlï¼",charIndex:1189},{level:4,title:"æ°æ®æçºµè¯­è¨ï¼DMLï¼",slug:"æ°æ®æçºµè¯­è¨-dml",normalizedTitle:"æ°æ®æçºµè¯­è¨ï¼dmlï¼",charIndex:1323},{level:4,title:"äºå¡æ§å¶è¯­è¨ï¼TCLï¼",slug:"äºå¡æ§å¶è¯­è¨-tcl",normalizedTitle:"äºå¡æ§å¶è¯­è¨ï¼tclï¼",charIndex:1536},{level:4,title:"æ°æ®æ§å¶è¯­è¨ï¼DCLï¼",slug:"æ°æ®æ§å¶è¯­è¨-dcl",normalizedTitle:"æ°æ®æ§å¶è¯­è¨ï¼dclï¼",charIndex:1672},{level:2,title:"äºãå¢å æ¹æ¥",slug:"äºãå¢å æ¹æ¥",normalizedTitle:"äºãå¢å æ¹æ¥",charIndex:2016},{level:3,title:"æå¥æ°æ®",slug:"æå¥æ°æ®",normalizedTitle:"æå¥æ°æ®",charIndex:2059},{level:3,title:"æ´æ°æ°æ®",slug:"æ´æ°æ°æ®",normalizedTitle:"æ´æ°æ°æ®",charIndex:2336},{level:3,title:"å é¤æ°æ®",slug:"å é¤æ°æ®",normalizedTitle:"å é¤æ°æ®",charIndex:2449},{level:3,title:"æ¥è¯¢æ°æ®",slug:"æ¥è¯¢æ°æ®",normalizedTitle:"æ¥è¯¢æ°æ®",charIndex:2608},{level:2,title:"ä¸ãå­æ¥è¯¢",slug:"ä¸ãå­æ¥è¯¢",normalizedTitle:"ä¸ãå­æ¥è¯¢",charIndex:3106},{level:3,title:"WHERE",slug:"where",normalizedTitle:"where",charIndex:1019},{level:3,title:"IN å BETWEEN",slug:"in-å-between",normalizedTitle:"in å between",charIndex:4286},{level:3,title:"ANDãORãNOT",slug:"andãorãnot",normalizedTitle:"andãorãnot",charIndex:4532},{level:3,title:"LIKE",slug:"like",normalizedTitle:"like",charIndex:3981},{level:2,title:"åãè¿æ¥åç»å",slug:"åãè¿æ¥åç»å",normalizedTitle:"åãè¿æ¥åç»å",charIndex:5335},{level:3,title:"è¿æ¥ï¼JOINï¼",slug:"è¿æ¥-join",normalizedTitle:"è¿æ¥ï¼joinï¼",charIndex:5347},{level:4,title:"åè¿æ¥ï¼INNER JOINï¼",slug:"åè¿æ¥-inner-join",normalizedTitle:"åè¿æ¥ï¼inner joinï¼",charIndex:5531},{level:5,title:"èªè¿æ¥ï¼=ï¼",slug:"èªè¿æ¥",normalizedTitle:"èªè¿æ¥ï¼=ï¼",charIndex:5712},{level:5,title:"èªç¶è¿æ¥ï¼NATURAL JOINï¼",slug:"èªç¶è¿æ¥-natural-join",normalizedTitle:"èªç¶è¿æ¥ï¼natural joinï¼",charIndex:5931},{level:4,title:"å¤è¿æ¥ï¼OUTER JOINï¼",slug:"å¤è¿æ¥-outer-join",normalizedTitle:"å¤è¿æ¥ï¼outer joinï¼",charIndex:6053},{level:5,title:"å·¦è¿æ¥ï¼LEFT JOINï¼",slug:"å·¦è¿æ¥-left-join",normalizedTitle:"å·¦è¿æ¥ï¼left joinï¼",charIndex:6152},{level:5,title:"å³è¿æ¥ï¼RIGHT JOINï¼",slug:"å³è¿æ¥-right-join",normalizedTitle:"å³è¿æ¥ï¼right joinï¼",charIndex:6305},{level:3,title:"ç»åï¼UNIONï¼",slug:"ç»å-union",normalizedTitle:"ç»åï¼unionï¼",charIndex:6461},{level:3,title:"JOIN vs UNION",slug:"join-vs-union",normalizedTitle:"join vs union",charIndex:6939},{level:2,title:"äºãå½æ°",slug:"äºãå½æ°",normalizedTitle:"äºãå½æ°",charIndex:7069},{level:3,title:"ææ¬å¤ç",slug:"ææ¬å¤ç",normalizedTitle:"ææ¬å¤ç",charIndex:7128},{level:3,title:"æ¥æåæ¶é´å¤ç",slug:"æ¥æåæ¶é´å¤ç",normalizedTitle:"æ¥æåæ¶é´å¤ç",charIndex:7396},{level:3,title:"æ°å¼å¤ç",slug:"æ°å¼å¤ç",normalizedTitle:"æ°å¼å¤ç",charIndex:7981},{level:3,title:"æ±æ»",slug:"æ±æ»",normalizedTitle:"æ±æ»",charIndex:8115},{level:2,title:"å­ãæåºååç»",slug:"å­ãæåºååç»",normalizedTitle:"å­ãæåºååç»",charIndex:8330},{level:3,title:"ORDER BY",slug:"order-by",normalizedTitle:"order by",charIndex:6654},{level:3,title:"GROUP BY",slug:"group-by",normalizedTitle:"group by",charIndex:8534},{level:3,title:"HAVING",slug:"having",normalizedTitle:"having",charIndex:8917},{level:2,title:"ä¸ãæ°æ®å®ä¹",slug:"ä¸ãæ°æ®å®ä¹",normalizedTitle:"ä¸ãæ°æ®å®ä¹",charIndex:9303},{level:3,title:"æ°æ®åºï¼DATABASEï¼",slug:"æ°æ®åº-database",normalizedTitle:"æ°æ®åºï¼databaseï¼",charIndex:9354},{level:4,title:"åå»ºæ°æ®åº",slug:"åå»ºæ°æ®åº",normalizedTitle:"åå»ºæ°æ®åº",charIndex:9371},{level:4,title:"å é¤æ°æ®åº",slug:"å é¤æ°æ®åº",normalizedTitle:"å é¤æ°æ®åº",charIndex:9404},{level:4,title:"éæ©æ°æ®åº",slug:"éæ©æ°æ®åº",normalizedTitle:"éæ©æ°æ®åº",charIndex:9435},{level:3,title:"æ°æ®è¡¨ï¼TABLEï¼",slug:"æ°æ®è¡¨-table",normalizedTitle:"æ°æ®è¡¨ï¼tableï¼",charIndex:9457},{level:4,title:"åå»ºæ°æ®è¡¨",slug:"åå»ºæ°æ®è¡¨",normalizedTitle:"åå»ºæ°æ®è¡¨",charIndex:9471},{level:4,title:"å é¤æ°æ®è¡¨",slug:"å é¤æ°æ®è¡¨",normalizedTitle:"å é¤æ°æ®è¡¨",charIndex:9818},{level:4,title:"ä¿®æ¹æ°æ®è¡¨",slug:"ä¿®æ¹æ°æ®è¡¨",normalizedTitle:"ä¿®æ¹æ°æ®è¡¨",charIndex:9846},{level:3,title:"è§å¾ï¼VIEWï¼",slug:"è§å¾-view",normalizedTitle:"è§å¾ï¼viewï¼",charIndex:10080},{level:4,title:"åå»ºè§å¾",slug:"åå»ºè§å¾",normalizedTitle:"åå»ºè§å¾",charIndex:10257},{level:4,title:"å é¤è§å¾",slug:"å é¤è§å¾",normalizedTitle:"å é¤è§å¾",charIndex:10344},{level:3,title:"ç´¢å¼ï¼INDEXï¼",slug:"ç´¢å¼-index",normalizedTitle:"ç´¢å¼ï¼indexï¼",charIndex:10383},{level:4,title:"åå»ºç´¢å¼",slug:"åå»ºç´¢å¼",normalizedTitle:"åå»ºç´¢å¼",charIndex:10508},{level:4,title:"åå»ºå¯ä¸ç´¢å¼",slug:"åå»ºå¯ä¸ç´¢å¼",normalizedTitle:"åå»ºå¯ä¸ç´¢å¼",charIndex:10599},{level:4,title:"å é¤ç´¢å¼",slug:"å é¤ç´¢å¼",normalizedTitle:"å é¤ç´¢å¼",charIndex:10656},{level:3,title:"çº¦æ",slug:"çº¦æ",normalizedTitle:"çº¦æ",charIndex:10707},{level:2,title:"å«ãäºå¡å¤ç",slug:"å«ãäºå¡å¤ç",normalizedTitle:"å«ãäºå¡å¤ç",charIndex:11587},{level:2,title:"ä¹ãæéæ§å¶",slug:"ä¹ãæéæ§å¶",normalizedTitle:"ä¹ãæéæ§å¶",charIndex:12387},{level:3,title:"åå»ºè´¦æ·",slug:"åå»ºè´¦æ·",normalizedTitle:"åå»ºè´¦æ·",charIndex:12672},{level:3,title:"ä¿®æ¹è´¦æ·å",slug:"ä¿®æ¹è´¦æ·å",normalizedTitle:"ä¿®æ¹è´¦æ·å",charIndex:12730},{level:3,title:"å é¤è´¦æ·",slug:"å é¤è´¦æ·",normalizedTitle:"å é¤è´¦æ·",charIndex:12812},{level:3,title:"æ¥çæé",slug:"æ¥çæé",normalizedTitle:"æ¥çæé",charIndex:12841},{level:3,title:"æäºæé",slug:"æäºæé",normalizedTitle:"æäºæé",charIndex:12876},{level:3,title:"å é¤æé",slug:"å é¤æé",normalizedTitle:"å é¤æé",charIndex:12926},{level:3,title:"æ´æ¹å¯ç ",slug:"æ´æ¹å¯ç ",normalizedTitle:"æ´æ¹å¯ç ",charIndex:12979},{level:2,title:"åãå­å¨è¿ç¨åæ¸¸æ ",slug:"åãå­å¨è¿ç¨åæ¸¸æ ",normalizedTitle:"åãå­å¨è¿ç¨åæ¸¸æ ",charIndex:13026},{level:3,title:"å­å¨è¿ç¨ä¼ç¼ºç¹",slug:"å­å¨è¿ç¨ä¼ç¼ºç¹",normalizedTitle:"å­å¨è¿ç¨ä¼ç¼ºç¹",charIndex:13115},{level:3,title:"ä½¿ç¨å­å¨è¿ç¨",slug:"ä½¿ç¨å­å¨è¿ç¨",normalizedTitle:"ä½¿ç¨å­å¨è¿ç¨",charIndex:13310},{level:3,title:"æ¸¸æ ",slug:"æ¸¸æ ",normalizedTitle:"æ¸¸æ ",charIndex:13033},{level:3,title:"è§¦åå¨",slug:"è§¦åå¨",normalizedTitle:"è§¦åå¨",charIndex:14749},{level:4,title:"è§¦åå¨ç¹æ§",slug:"è§¦åå¨ç¹æ§",normalizedTitle:"è§¦åå¨ç¹æ§",charIndex:14844},{level:4,title:"è§¦åå¨æä»¤",slug:"è§¦åå¨æä»¤",normalizedTitle:"è§¦åå¨æä»¤",charIndex:15600},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:16389}],headersStr:"ä¸ãåºæ¬æ¦å¿µ æ°æ®åºæ¯è¯­ SQL è¯­æ³ SQL è¯­æ³ç»æ SQL è¯­æ³è¦ç¹ SQL åç±» æ°æ®å®ä¹è¯­è¨ï¼DDLï¼ æ°æ®æçºµè¯­è¨ï¼DMLï¼ äºå¡æ§å¶è¯­è¨ï¼TCLï¼ æ°æ®æ§å¶è¯­è¨ï¼DCLï¼ äºãå¢å æ¹æ¥ æå¥æ°æ® æ´æ°æ°æ® å é¤æ°æ® æ¥è¯¢æ°æ® ä¸ãå­æ¥è¯¢ WHERE IN å BETWEEN ANDãORãNOT LIKE åãè¿æ¥åç»å è¿æ¥ï¼JOINï¼ åè¿æ¥ï¼INNER JOINï¼ èªè¿æ¥ï¼=ï¼ èªç¶è¿æ¥ï¼NATURAL JOINï¼ å¤è¿æ¥ï¼OUTER JOINï¼ å·¦è¿æ¥ï¼LEFT JOINï¼ å³è¿æ¥ï¼RIGHT JOINï¼ ç»åï¼UNIONï¼ JOIN vs UNION äºãå½æ° ææ¬å¤ç æ¥æåæ¶é´å¤ç æ°å¼å¤ç æ±æ» å­ãæåºååç» ORDER BY GROUP BY HAVING ä¸ãæ°æ®å®ä¹ æ°æ®åºï¼DATABASEï¼ åå»ºæ°æ®åº å é¤æ°æ®åº éæ©æ°æ®åº æ°æ®è¡¨ï¼TABLEï¼ åå»ºæ°æ®è¡¨ å é¤æ°æ®è¡¨ ä¿®æ¹æ°æ®è¡¨ è§å¾ï¼VIEWï¼ åå»ºè§å¾ å é¤è§å¾ ç´¢å¼ï¼INDEXï¼ åå»ºç´¢å¼ åå»ºå¯ä¸ç´¢å¼ å é¤ç´¢å¼ çº¦æ å«ãäºå¡å¤ç ä¹ãæéæ§å¶ åå»ºè´¦æ· ä¿®æ¹è´¦æ·å å é¤è´¦æ· æ¥çæé æäºæé å é¤æé æ´æ¹å¯ç  åãå­å¨è¿ç¨åæ¸¸æ  å­å¨è¿ç¨ä¼ç¼ºç¹ ä½¿ç¨å­å¨è¿ç¨ æ¸¸æ  è§¦åå¨ è§¦åå¨ç¹æ§ è§¦åå¨æä»¤ åèèµæ",content:"# SQL Cheat Sheet\n\n> æ¬æéå¯¹å³ç³»åæ°æ®åºçåºæ¬è¯­æ³ãéäºç¯å¹ï¼æ¬æä¾§éè¯´æç¨æ³ï¼ä¸ä¼å±å¼è®²è§£ç¹æ§ãåçã\n> \n> æ¬æè¯­æ³ä¸»è¦éå¯¹ Mysqlï¼ä½å¤§é¨åçè¯­æ³å¯¹å¶ä»å³ç³»åæ°æ®åºä¹éç¨ã\n\n\n\n\n# ä¸ãåºæ¬æ¦å¿µ\n\n\n# æ°æ®åºæ¯è¯­\n\n * æ°æ®åºï¼databaseï¼ - ä¿å­æç»ç»çæ°æ®çå®¹å¨ï¼éå¸¸æ¯ä¸ä¸ªæä»¶æä¸ç»æä»¶ï¼ã\n * æ°æ®è¡¨ï¼tableï¼ - æç§ç¹å®ç±»åæ°æ®çç»æåæ¸åã\n * æ¨¡å¼ï¼schemaï¼ - å³äºæ°æ®åºåè¡¨çå¸å±åç¹æ§çä¿¡æ¯ãæ¨¡å¼å®ä¹äºæ°æ®å¨è¡¨ä¸­å¦ä½å­å¨ï¼åå«å­å¨ä»ä¹æ ·çæ°æ®ï¼æ°æ®å¦ä½åè§£ï¼åé¨åä¿¡æ¯å¦ä½å½åç­ä¿¡æ¯ãæ°æ®åºåè¡¨é½ææ¨¡å¼ã\n * åï¼columnï¼ - è¡¨ä¸­çä¸ä¸ªå­æ®µãææè¡¨é½æ¯ç±ä¸ä¸ªæå¤ä¸ªåç»æçã\n * è¡ï¼rowï¼ - è¡¨ä¸­çä¸ä¸ªè®°å½ã\n * ä¸»é®ï¼primary keyï¼ - ä¸åï¼æä¸ç»åï¼ï¼å¶å¼è½å¤å¯ä¸æ è¯è¡¨ä¸­æ¯ä¸è¡ã\n\n\n# SQL è¯­æ³\n\n> SQLï¼Structured Query Language)ï¼æ å SQL ç± ANSI æ åå§åä¼ç®¡çï¼ä»èç§°ä¸º ANSI SQLãåä¸ª DBMS é½æèªå·±çå®ç°ï¼å¦ PL/SQLãTransact-SQL ç­ã\n\n# SQL è¯­æ³ç»æ\n\n\n\nSQL è¯­æ³ç»æåæ¬ï¼\n\n * å­å¥ - æ¯è¯­å¥åæ¥è¯¢çç»ææåãï¼å¨æäºæåµä¸ï¼è¿äºé½æ¯å¯éçãï¼\n * è¡¨è¾¾å¼ - å¯ä»¥äº§çä»»ä½æ éå¼ï¼æç±ååè¡çæ°æ®åºè¡¨\n * è°è¯ - ç»éè¦è¯ä¼°ç SQL ä¸å¼é»è¾ï¼3VLï¼ï¼true/false/unknownï¼æå¸å°çå¼æå®æ¡ä»¶ï¼å¹¶éå¶è¯­å¥åæ¥è¯¢çææï¼ææ¹åç¨åºæµç¨ã\n * æ¥è¯¢ - åºäºç¹å®æ¡ä»¶æ£ç´¢æ°æ®ãè¿æ¯ SQL çä¸ä¸ªéè¦ç»æé¨åã\n * è¯­å¥ - å¯ä»¥æä¹å°å½±åçº²è¦åæ°æ®ï¼ä¹å¯ä»¥æ§å¶æ°æ®åºäºå¡ãç¨åºæµç¨ãè¿æ¥ãä¼è¯æè¯æ­ã\n\n# SQL è¯­æ³è¦ç¹\n\n * SQL è¯­å¥ä¸åºåå¤§å°åï¼ä½æ¯æ°æ®åºè¡¨åãåååå¼æ¯å¦åºåï¼ä¾èµäºå·ä½ç DBMS ä»¥åéç½®ã\n\nä¾å¦ï¼SELECT ä¸ select ãSelect æ¯ç¸åçã\n\n * å¤æ¡ SQL è¯­å¥å¿é¡»ä»¥åå·ï¼;ï¼åéã\n\n * å¤ç SQL è¯­å¥æ¶ï¼ææç©ºæ ¼é½è¢«å¿½ç¥ãSQL è¯­å¥å¯ä»¥åæä¸è¡ï¼ä¹å¯ä»¥ååä¸ºå¤è¡ã\n\n-- ä¸è¡ SQL è¯­å¥\nUPDATE user SET username='robot', password='robot' WHERE username = 'root';\n\n-- å¤è¡ SQL è¯­å¥\nUPDATE user\nSET username='robot', password='robot'\nWHERE username = 'root';\n\n\n * SQL æ¯æä¸ç§æ³¨é\n\n## æ³¨é1\n-- æ³¨é2\n/* æ³¨é3 */\n\n\n# SQL åç±»\n\n# æ°æ®å®ä¹è¯­è¨ï¼DDLï¼\n\næ°æ®å®ä¹è¯­è¨ï¼Data Definition Languageï¼DDLï¼æ¯ SQL è¯­è¨éä¸­è´è´£æ°æ®ç»æå®ä¹ä¸æ°æ®åºå¯¹è±¡å®ä¹çè¯­è¨ã\n\nDDL çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ã\n\nDDL çæ ¸å¿æä»¤æ¯ CREATEãALTERãDROPã\n\n# æ°æ®æçºµè¯­è¨ï¼DMLï¼\n\næ°æ®æçºµè¯­è¨ï¼Data Manipulation Language, DMLï¼æ¯ç¨äºæ°æ®åºæä½ï¼å¯¹æ°æ®åºå¶ä¸­çå¯¹è±¡åæ°æ®è¿è¡è®¿é®å·¥ä½çç¼ç¨è¯­å¥ã\n\nDML çä¸»è¦åè½æ¯ è®¿é®æ°æ®ï¼å æ­¤å¶è¯­æ³é½æ¯ä»¥è¯»åæ°æ®åºä¸ºä¸»ã\n\nDML çæ ¸å¿æä»¤æ¯ INSERTãUPDATEãDELETEãSELECTãè¿åä¸ªæä»¤åç§° CRUD(Create, Read, Update, Delete)ï¼å³å¢å æ¹æ¥ã\n\n# äºå¡æ§å¶è¯­è¨ï¼TCLï¼\n\näºå¡æ§å¶è¯­è¨ (Transaction Control Language, TCL) ç¨äºç®¡çæ°æ®åºä¸­çäºå¡ãè¿äºç¨äºç®¡çç± DML è¯­å¥æåçæ´æ¹ãå®è¿åè®¸å°è¯­å¥åç»ä¸ºé»è¾äºå¡ã\n\nTCL çæ ¸å¿æä»¤æ¯ COMMITãROLLBACKã\n\n# æ°æ®æ§å¶è¯­è¨ï¼DCLï¼\n\næ°æ®æ§å¶è¯­è¨ (Data Control Language, DCL) æ¯ä¸ç§å¯å¯¹æ°æ®è®¿é®æè¿è¡æ§å¶çæä»¤ï¼å®å¯ä»¥æ§å¶ç¹å®ç¨æ·è´¦æ·å¯¹æ°æ®è¡¨ãæ¥çè¡¨ãé¢å­ç¨åºãç¨æ·èªå®ä¹å½æ°ç­æ°æ®åºå¯¹è±¡çæ§å¶æã\n\nDCL çæ ¸å¿æä»¤æ¯ GRANTãREVOKEã\n\nDCL ä»¥æ§å¶ç¨æ·çè®¿é®æéä¸ºä¸»ï¼å æ­¤å¶æä»¤ä½æ³å¹¶ä¸å¤æï¼å¯å©ç¨ DCL æ§å¶çæéæï¼CONNECTãSELECTãINSERTãUPDATEãDELETEãEXECUTEãUSAGEãREFERENCESã\n\næ ¹æ®ä¸åç DBMS ä»¥åä¸åçå®å¨æ§å®ä½ï¼å¶æ¯æçæéæ§å¶ä¹ææä¸åã\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º DML è¯­å¥ç¨æ³ï¼\n\n\n# äºãå¢å æ¹æ¥\n\n> å¢å æ¹æ¥ï¼åç§°ä¸º CRUDï¼æ°æ®åºåºæ¬æä½ä¸­çåºæ¬æä½ã\n\n\n# æå¥æ°æ®\n\n>  * INSERT INTO è¯­å¥ç¨äºåè¡¨ä¸­æå¥æ°è®°å½ã\n\næå¥å®æ´çè¡\n\nINSERT INTO user\nVALUES (10, 'root', 'root', 'xxxx@163.com');\n\n\næå¥è¡çä¸é¨å\n\nINSERT INTO user(username, password, email)\nVALUES ('admin', 'admin', 'xxxx@163.com');\n\n\næå¥æ¥è¯¢åºæ¥çæ°æ®\n\nINSERT INTO user(username)\nSELECT name\nFROM account;\n\n\n\n# æ´æ°æ°æ®\n\n>  * UPDATE è¯­å¥ç¨äºæ´æ°è¡¨ä¸­çè®°å½ã\n\nUPDATE user\nSET username='robot', password='robot'\nWHERE username = 'root';\n\n\n\n# å é¤æ°æ®\n\n>  * DELETE è¯­å¥ç¨äºå é¤è¡¨ä¸­çè®°å½ã\n>  * TRUNCATE TABLE å¯ä»¥æ¸ç©ºè¡¨ï¼ä¹å°±æ¯å é¤ææè¡ã\n\nå é¤è¡¨ä¸­çæå®æ°æ®\n\nDELETE FROM user\nWHERE username = 'robot';\n\n\næ¸ç©ºè¡¨ä¸­çæ°æ®\n\nTRUNCATE TABLE user;\n\n\n\n# æ¥è¯¢æ°æ®\n\n>  * SELECT è¯­å¥ç¨äºä»æ°æ®åºä¸­æ¥è¯¢æ°æ®ã\n>  * DISTINCT ç¨äºè¿åå¯ä¸ä¸åçå¼ãå®ä½ç¨äºææåï¼ä¹å°±æ¯è¯´ææåçå¼é½ç¸åæç®ç¸åã\n>  * LIMIT éå¶è¿åçè¡æ°ãå¯ä»¥æä¸¤ä¸ªåæ°ï¼ç¬¬ä¸ä¸ªåæ°ä¸ºèµ·å§è¡ï¼ä» 0 å¼å§ï¼ç¬¬äºä¸ªåæ°ä¸ºè¿åçæ»è¡æ°ã\n>    * ASC ï¼ååºï¼é»è®¤ï¼\n>    * DESC ï¼éåº\n\næ¥è¯¢åå\n\nSELECT prod_name\nFROM products;\n\n\næ¥è¯¢å¤å\n\nSELECT prod_id, prod_name, prod_price\nFROM products;\n\n\næ¥è¯¢ææå\n\nELECT *\nFROM products;\n\n\næ¥è¯¢ä¸åçå¼\n\nSELECT DISTINCT\nvend_id FROM products;\n\n\néå¶æ¥è¯¢ç»æ\n\n-- è¿åå 5 è¡\nSELECT * FROM mytable LIMIT 5;\nSELECT * FROM mytable LIMIT 0, 5;\n-- è¿åç¬¬ 3 ~ 5 è¡\nSELECT * FROM mytable LIMIT 2, 3;\n\n\n\n# ä¸ãå­æ¥è¯¢\n\n> å­æ¥è¯¢æ¯åµå¥å¨è¾å¤§æ¥è¯¢ä¸­ç SQL æ¥è¯¢ãå­æ¥è¯¢ä¹ç§°ä¸ºåé¨æ¥è¯¢æåé¨éæ©ï¼èåå«å­æ¥è¯¢çè¯­å¥ä¹ç§°ä¸ºå¤é¨æ¥è¯¢æå¤é¨éæ©ã\n\n * å­æ¥è¯¢å¯ä»¥åµå¥å¨ SELECTï¼INSERTï¼UPDATE æ DELETE è¯­å¥åæå¦ä¸ä¸ªå­æ¥è¯¢ä¸­ã\n\n * å­æ¥è¯¢éå¸¸ä¼å¨å¦ä¸ä¸ª SELECT è¯­å¥ç WHERE å­å¥ä¸­æ·»å ã\n\n * æ¨å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦ >ï¼<ï¼æ =ãæ¯è¾è¿ç®ç¬¦ä¹å¯ä»¥æ¯å¤è¡è¿ç®ç¬¦ï¼å¦ INï¼ANY æ ALLã\n\n * å­æ¥è¯¢å¿é¡»è¢«åæ¬å· () æ¬èµ·æ¥ã\n\n * åé¨æ¥è¯¢é¦åå¨å¶ç¶æ¥è¯¢ä¹åæ§è¡ï¼ä»¥ä¾¿å¯ä»¥å°åé¨æ¥è¯¢çç»æä¼ éç»å¤é¨æ¥è¯¢ãæ§è¡è¿ç¨å¯ä»¥åèä¸å¾ï¼\n   \n   \n\nå­æ¥è¯¢çå­æ¥è¯¢\n\nSELECT cust_name, cust_contact\nFROM customers\nWHERE cust_id IN (SELECT cust_id\n                  FROM orders\n                  WHERE order_num IN (SELECT order_num\n                                      FROM orderitems\n                                      WHERE prod_id = 'RGAN01'));\n\n\n\n# WHERE\n\n> WHERE å­å¥ç¨äºè¿æ»¤è®°å½ï¼å³ç¼©å°è®¿é®æ°æ®çèå´ãWHERE åè·ä¸ä¸ªè¿å true æ false çæ¡ä»¶ã\n> \n> WHERE å¯ä»¥ä¸ SELECTï¼UPDATE å DELETE ä¸èµ·ä½¿ç¨ã\n\nå¯ä»¥å¨ WHERE å­å¥ä¸­ä½¿ç¨çæä½ç¬¦ï¼\n\nè¿ç®ç¬¦       æè¿°\n=         ç­äº\n<>        ä¸ç­äºãæ³¨éï¼å¨ SQL çä¸äºçæ¬ä¸­ï¼è¯¥æä½ç¬¦å¯è¢«åæ !=\n>         å¤§äº\n<         å°äº\n>=        å¤§äºç­äº\n<=        å°äºç­äº\nBETWEEN   å¨æä¸ªèå´å\nLIKE      æç´¢æç§æ¨¡å¼\nIN        æå®éå¯¹æä¸ªåçå¤ä¸ªå¯è½å¼\n\nSELECT è¯­å¥ä¸­ç WHERE å­å¥\n\nSELECT * FROM Customers\nWHERE cust_name = 'Kids Place';\n\n\nUPDATE è¯­å¥ä¸­ç WHERE å­å¥\n\nUPDATE Customers\nSET cust_name = 'Jack Jones'\nWHERE cust_name = 'Kids Place';\n\n\nDELETE è¯­å¥ä¸­ç WHERE å­å¥\n\nDELETE FROM Customers\nWHERE cust_name = 'Kids Place';\n\n\n\n# IN å BETWEEN\n\n> IN æä½ç¬¦å¨ WHERE å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯å¨æå®çå ä¸ªç¹å®å¼ä¸­ä»»éä¸ä¸ªå¼ã\n> \n> BETWEEN æä½ç¬¦å¨ WHERE å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯éåä»äºæä¸ªèå´åçå¼ã\n\nIN ç¤ºä¾\n\nSELECT *\nFROM products\nWHERE vend_id IN ('DLL01', 'BRS01');\n\n\nBETWEEN ç¤ºä¾\n\nSELECT *\nFROM products\nWHERE prod_price BETWEEN 3 AND 5;\n\n\n\n# ANDãORãNOT\n\n> ANDãORãNOT æ¯ç¨äºå¯¹è¿æ»¤æ¡ä»¶çé»è¾å¤çæä»¤ã\n> \n> AND ä¼åçº§é«äº ORï¼ä¸ºäºæç¡®å¤çé¡ºåºï¼å¯ä»¥ä½¿ç¨ ()ãAND æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶é½è¦æ»¡è¶³ã\n> \n> OR æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶æ»¡è¶³ä»»æä¸ä¸ªå³å¯ã\n> \n> NOT æä½ç¬¦ç¨äºå¦å®ä¸ä¸ªæ¡ä»¶ã\n\nAND ç¤ºä¾\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE vend_id = 'DLL01' AND prod_price <= 4;\n\n\nOR ç¤ºä¾\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE vend_id = 'DLL01' OR vend_id = 'BRS01';\n\n\nNOT ç¤ºä¾\n\nSELECT *\nFROM products\nWHERE prod_price NOT BETWEEN 3 AND 5;\n\n\n\n# LIKE\n\n> LIKE æä½ç¬¦å¨ WHERE å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯ç¡®å®å­ç¬¦ä¸²æ¯å¦å¹éæ¨¡å¼ãåªæå­æ®µæ¯ææ¬å¼æ¶æä½¿ç¨ LIKEã\n> \n> LIKE æ¯æä¸¤ä¸ªééç¬¦å¹ééé¡¹ï¼% å _ã\n> \n>  * % è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä»»ææ¬¡æ°ã\n>  * _ è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä¸æ¬¡ã\n> \n> ä¸è¦æ»¥ç¨ééç¬¦ï¼ééç¬¦ä½äºå¼å¤´å¤å¹éä¼éå¸¸æ¢ã\n\n% ç¤ºä¾ï¼\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE prod_name LIKE '%bean bag%';\n\n\n_ ç¤ºä¾ï¼\n\nSELECT prod_id, prod_name, prod_price\nFROM products\nWHERE prod_name LIKE '__ inch teddy bear';\n\n\n\n# åãè¿æ¥åç»å\n\n\n# è¿æ¥ï¼JOINï¼\n\n> è¿æ¥ç¨äºè¿æ¥å¤ä¸ªè¡¨ï¼ä½¿ç¨ JOIN å³é®å­ï¼å¹¶ä¸æ¡ä»¶è¯­å¥ä½¿ç¨ ON èä¸æ¯ WHEREã\n\nå¦æä¸ä¸ª JOIN è³å°æä¸ä¸ªå¬å±å­æ®µå¹¶ä¸å®ä»¬ä¹é´å­å¨å³ç³»ï¼åè¯¥ JOIN å¯ä»¥å¨ä¸¤ä¸ªæå¤ä¸ªè¡¨ä¸å·¥ä½ã\n\nJOIN ä¿æåºè¡¨ï¼ç»æåæ°æ®ï¼ä¸åãè¿æ¥å¯ä»¥æ¿æ¢å­æ¥è¯¢ï¼å¹¶ä¸æ¯å­æ¥è¯¢çæçä¸è¬ä¼æ´å¿«ã\n\nJOIN æä¸¤ç§è¿æ¥ç±»åï¼åè¿æ¥åå¤è¿æ¥ã\n\n\n\n# åè¿æ¥ï¼INNER JOINï¼\n\nåè¿æ¥åç§°ç­å¼è¿æ¥ï¼ä½¿ç¨ INNER JOIN å³é®å­ãå¨æ²¡ææ¡ä»¶è¯­å¥çæåµä¸è¿åç¬å¡å°ç§¯ã\n\nSELECT vend_name, prod_name, prod_price\nFROM vendors INNER JOIN products\nON vendors.vend_id = products.vend_id;\n\n\n# èªè¿æ¥ï¼=ï¼\n\nèªè¿æ¥å¯ä»¥çæåè¿æ¥çä¸ç§ï¼åªæ¯è¿æ¥çè¡¨æ¯èªèº«èå·²ãèªç¶è¿æ¥æ¯æåååéè¿ = è¿æ¥èµ·æ¥çï¼åååå¯ä»¥æå¤ä¸ªã\n\nSELECT c1.cust_id, c1.cust_name, c1.cust_contact\nFROM customers c1, customers c2\nWHERE c1.cust_name = c2.cust_name\nAND c2.cust_contact = 'Jim Jones';\n\n\n# èªç¶è¿æ¥ï¼NATURAL JOINï¼\n\nåè¿æ¥æä¾è¿æ¥çåï¼èèªç¶è¿æ¥èªå¨è¿æ¥ææåååãèªç¶è¿æ¥ä½¿ç¨ NATURAL JOIN å³é®å­ã\n\nSELECT *\nFROM Products\nNATURAL JOIN Customers;\n\n\n# å¤è¿æ¥ï¼OUTER JOINï¼\n\nå¤è¿æ¥è¿åä¸ä¸ªè¡¨ä¸­çææè¡ï¼å¹¶ä¸ä»è¿åæ¥èªæ­¤è¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çé£äºè¡ï¼å³ä¸¤ä¸ªè¡¨ä¸­çåæ¯ç¸ç­çãå¤è¿æ¥åä¸ºå·¦å¤è¿æ¥ãå³å¤è¿æ¥ãå¨å¤è¿æ¥ï¼Mysql ä¸æ¯æï¼ã\n\n# å·¦è¿æ¥ï¼LEFT JOINï¼\n\nå·¦å¤è¿æ¥å°±æ¯ä¿çå·¦è¡¨æ²¡æå³èçè¡ã\n\nSELECT customers.cust_id, orders.order_num\nFROM customers LEFT JOIN orders\nON customers.cust_id = orders.cust_id;\n\n\n# å³è¿æ¥ï¼RIGHT JOINï¼\n\nå³å¤è¿æ¥å°±æ¯ä¿çå³è¡¨æ²¡æå³èçè¡ã\n\nSELECT customers.cust_id, orders.order_num\nFROM customers RIGHT JOIN orders\nON customers.cust_id = orders.cust_id;\n\n\n\n# ç»åï¼UNIONï¼\n\n> UNION è¿ç®ç¬¦å°ä¸¤ä¸ªææ´å¤æ¥è¯¢çç»æç»åèµ·æ¥ï¼å¹¶çæä¸ä¸ªç»æéï¼å¶ä¸­åå«æ¥èª UNION ä¸­åä¸æ¥è¯¢çæåè¡ã\n\nUNION åºæ¬è§åï¼\n\n * æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * æ¯ä¸ªæ¥è¯¢ä¸­æ¶åè¡¨çåçæ°æ®ç±»åå¿é¡»ç¸åæå¼å®¹ã\n * éå¸¸è¿åçåååèªç¬¬ä¸ä¸ªæ¥è¯¢ã\n\né»è®¤ä¼å»é¤ç¸åè¡ï¼å¦æéè¦ä¿çç¸åè¡ï¼ä½¿ç¨ UNION ALLã\n\nåªè½åå«ä¸ä¸ª ORDER BY å­å¥ï¼å¹¶ä¸å¿é¡»ä½äºè¯­å¥çæåã\n\nåºç¨åºæ¯ï¼\n\n * å¨ä¸ä¸ªæ¥è¯¢ä¸­ä»ä¸åçè¡¨è¿åç»ææ°æ®ã\n * å¯¹ä¸ä¸ªè¡¨æ§è¡å¤ä¸ªæ¥è¯¢ï¼æä¸ä¸ªæ¥è¯¢è¿åæ°æ®ã\n\nç»åæ¥è¯¢ç¤ºä¾ï¼\n\nSELECT cust_name, cust_contact, cust_email\nFROM customers\nWHERE cust_state IN ('IL', 'IN', 'MI')\nUNION\nSELECT cust_name, cust_contact, cust_email\nFROM customers\nWHERE cust_name = 'Fun4All';\n\n\n\n# JOIN vs UNION\n\n * JOIN ä¸­è¿æ¥è¡¨çåå¯è½ä¸åï¼ä½å¨ UNION ä¸­ï¼æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * UNION å°æ¥è¯¢ä¹åçè¡æ¾å¨ä¸èµ·ï¼åç´æ¾ç½®ï¼ï¼ä½ JOIN å°æ¥è¯¢ä¹åçåæ¾å¨ä¸èµ·ï¼æ°´å¹³æ¾ç½®ï¼ï¼å³å®ææä¸ä¸ªç¬å¡å°ç§¯ã\n\n\n# äºãå½æ°\n\n> ð æ³¨æï¼ä¸åæ°æ®åºçå½æ°å¾å¾åä¸ç¸åï¼å æ­¤ä¸å¯ç§»æ¤ãæ¬èä¸»è¦ä»¥ Mysql çå½æ°ä¸ºä¾ã\n\n\n# ææ¬å¤ç\n\nå½æ°                è¯´æ\nLEFT()ãRIGHT()    å·¦è¾¹æèå³è¾¹çå­ç¬¦\nLOWER()ãUPPER()   è½¬æ¢ä¸ºå°åæèå¤§å\nLTRIM()ãRTIM()    å»é¤å·¦è¾¹æèå³è¾¹çç©ºæ ¼\nLENGTH()          é¿åº¦\nSOUNDEX()         è½¬æ¢ä¸ºè¯­é³å¼\n\nå¶ä¸­ï¼ SOUNDEX() å¯ä»¥å°ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å¶è¯­é³è¡¨ç¤ºçå­æ¯æ°å­æ¨¡å¼ã\n\nSELECT *\nFROM mytable\nWHERE SOUNDEX(col1) = SOUNDEX('apple')\n\n\n\n# æ¥æåæ¶é´å¤ç\n\n * æ¥ææ ¼å¼ï¼YYYY-MM-DD\n * æ¶é´æ ¼å¼ï¼HH:MM:SS\n\nå½ æ°             è¯´ æ\nAddDate()       å¢å ä¸ä¸ªæ¥æï¼å¤©ãå¨ç­ï¼\nAddTime()       å¢å ä¸ä¸ªæ¶é´ï¼æ¶ãåç­ï¼\nCurDate()       è¿åå½åæ¥æ\nCurTime()       è¿åå½åæ¶é´\nDate()          è¿åæ¥ææ¶é´çæ¥æé¨å\nDateDiff()      è®¡ç®ä¸¤ä¸ªæ¥æä¹å·®\nDate_Add()      é«åº¦çµæ´»çæ¥æè¿ç®å½æ°\nDate_Format()   è¿åä¸ä¸ªæ ¼å¼åçæ¥æææ¶é´ä¸²\nDay()           è¿åä¸ä¸ªæ¥æçå¤©æ°é¨å\nDayOfWeek()     å¯¹äºä¸ä¸ªæ¥æï¼è¿åå¯¹åºçææå \nHour()          è¿åä¸ä¸ªæ¶é´çå°æ¶é¨å\nMinute()        è¿åä¸ä¸ªæ¶é´çåéé¨å\nMonth()         è¿åä¸ä¸ªæ¥æçæä»½é¨å\nNow()           è¿åå½åæ¥æåæ¶é´\nSecond()        è¿åä¸ä¸ªæ¶é´çç§é¨å\nTime()          è¿åä¸ä¸ªæ¥ææ¶é´çæ¶é´é¨å\nYear()          è¿åä¸ä¸ªæ¥æçå¹´ä»½é¨å\n\nmysql> SELECT NOW();\n\n\n2018-4-14 20:25:11\n\n\n\n# æ°å¼å¤ç\n\nå½æ°       è¯´æ\nSIN()    æ­£å¼¦\nCOS()    ä½å¼¦\nTAN()    æ­£å\nABS()    ç»å¯¹å¼\nSQRT()   å¹³æ¹æ ¹\nMOD()    ä½æ°\nEXP()    ææ°\nPI()     åå¨ç\nRAND()   éæºæ°\n\n\n# æ±æ»\n\nå½ æ°       è¯´ æ\nAVG()     è¿åæåçå¹³åå¼\nCOUNT()   è¿åæåçè¡æ°\nMAX()     è¿åæåçæå¤§å¼\nMIN()     è¿åæåçæå°å¼\nSUM()     è¿åæåå¼ä¹å\n\nAVG() ä¼å¿½ç¥ NULL è¡ã\n\nä½¿ç¨ DISTINCT å¯ä»¥è®©æ±æ»å½æ°å¼æ±æ»ä¸åçå¼ã\n\nSELECT AVG(DISTINCT col1) AS avg_col\nFROM mytable\n\n\n\n# å­ãæåºååç»\n\n\n# ORDER BY\n\n> ORDER BY ç¨äºå¯¹ç»æéè¿è¡æåºã\n\nORDER BY æä¸¤ç§æåºæ¨¡å¼ï¼\n\n * ASC ï¼ååºï¼é»è®¤ï¼\n * DESC ï¼éåº\n\nå¯ä»¥æå¤ä¸ªåè¿è¡æåºï¼å¹¶ä¸ä¸ºæ¯ä¸ªåæå®ä¸åçæåºæ¹å¼ã\n\næå®å¤ä¸ªåçæåºç¤ºä¾ï¼\n\nSELECT * FROM products\nORDER BY prod_price DESC, prod_name ASC;\n\n\n\n# GROUP BY\n\n> GROUP BY å­å¥å°è®°å½åç»å°æ±æ»è¡ä¸­ï¼GROUP BY ä¸ºæ¯ä¸ªç»è¿åä¸ä¸ªè®°å½ã\n\nGROUP BY å¯ä»¥æä¸åæå¤åè¿è¡åç»ã\n\nGROUP BY éå¸¸è¿æ¶åèåå½æ°ï¼COUNTï¼MAXï¼SUMï¼AVG ç­ã\n\nGROUP BY æåç»å­æ®µè¿è¡æåºåï¼ORDER BY å¯ä»¥ä»¥æ±æ»å­æ®µæ¥è¿è¡æåºã\n\nåç»ç¤ºä¾ï¼\n\nSELECT cust_name, COUNT(cust_address) AS addr_num\nFROM Customers GROUP BY cust_name;\n\n\nåç»åæåºç¤ºä¾ï¼\n\nSELECT cust_name, COUNT(cust_address) AS addr_num\nFROM Customers GROUP BY cust_name\nORDER BY cust_name DESC;\n\n\n\n# HAVING\n\n> HAVING ç¨äºå¯¹æ±æ»ç GROUP BY ç»æè¿è¡è¿æ»¤ãHAVING è¦æ±å­å¨ä¸ä¸ª GROUP BY å­å¥ã\n\nWHERE å HAVING å¯ä»¥å¨ç¸åçæ¥è¯¢ä¸­ã\n\nHAVING vs WHEREï¼\n\n * WHERE å HAVING é½æ¯ç¨äºè¿æ»¤ã\n * HAVING éç¨äºæ±æ»çç»è®°å½ï¼è WHERE éç¨äºåä¸ªè®°å½ã\n\nä½¿ç¨ WHERE å HAVING è¿æ»¤æ°æ®ç¤ºä¾ï¼\n\nSELECT cust_name, COUNT(*) AS num\nFROM Customers\nWHERE cust_email IS NOT NULL\nGROUP BY cust_name\nHAVING COUNT(*) >= 1;\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º DDL è¯­å¥ç¨æ³ï¼\n\n\n# ä¸ãæ°æ®å®ä¹\n\n> DDL çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ï¼å¦ï¼æ°æ®åºãæ°æ®è¡¨ãè§å¾ãç´¢å¼ç­ï¼ã\n\n\n# æ°æ®åºï¼DATABASEï¼\n\n# åå»ºæ°æ®åº\n\nCREATE DATABASE test;\n\n\n# å é¤æ°æ®åº\n\nDROP DATABASE test;\n\n\n# éæ©æ°æ®åº\n\nUSE test;\n\n\n\n# æ°æ®è¡¨ï¼TABLEï¼\n\n# åå»ºæ°æ®è¡¨\n\næ®éåå»º\n\nCREATE TABLE user (\n  id int(10) unsigned NOT NULL COMMENT 'Id',\n  username varchar(64) NOT NULL DEFAULT 'default' COMMENT 'ç¨æ·å',\n  password varchar(64) NOT NULL DEFAULT 'default' COMMENT 'å¯ç ',\n  email varchar(64) NOT NULL DEFAULT 'default' COMMENT 'é®ç®±'\n) COMMENT='ç¨æ·è¡¨';\n\n\næ ¹æ®å·²æçè¡¨åå»ºæ°è¡¨\n\nCREATE TABLE vip_user AS\nSELECT * FROM user;\n\n\n# å é¤æ°æ®è¡¨\n\nDROP TABLE user;\n\n\n# ä¿®æ¹æ°æ®è¡¨\n\næ·»å å\n\nALTER TABLE user\nADD age int(3);\n\n\nå é¤å\n\nALTER TABLE user\nDROP COLUMN age;\n\n\nä¿®æ¹å\n\nALTER TABLE `user`\nMODIFY COLUMN age tinyint;\n\n\næ·»å ä¸»é®\n\nALTER TABLE user\nADD PRIMARY KEY (id);\n\n\nå é¤ä¸»é®\n\nALTER TABLE user\nDROP PRIMARY KEY;\n\n\n\n# è§å¾ï¼VIEWï¼\n\n> è§å¾æ¯åºäº SQL è¯­å¥çç»æéçå¯è§åçè¡¨ãè§å¾æ¯èæçè¡¨ï¼æ¬èº«ä¸å­å¨æ°æ®ï¼ä¹å°±ä¸è½å¯¹å¶è¿è¡ç´¢å¼æä½ãå¯¹è§å¾çæä½åå¯¹æ®éè¡¨çæä½ä¸æ ·ã\n\nè§å¾çä½ç¨ï¼\n\n * ç®åå¤æç SQL æä½ï¼æ¯å¦å¤æçè¿æ¥ã\n * åªä½¿ç¨å®éè¡¨çä¸é¨åæ°æ®ã\n * éè¿åªç»ç¨æ·è®¿é®è§å¾çæéï¼ä¿è¯æ°æ®çå®å¨æ§ã\n * æ´æ¹æ°æ®æ ¼å¼åè¡¨ç¤ºã\n\n# åå»ºè§å¾\n\nCREATE VIEW top_10_user_view AS\nSELECT id, username\nFROM user\nWHERE id < 10;\n\n\n# å é¤è§å¾\n\nDROP VIEW top_10_user_view;\n\n\n\n# ç´¢å¼ï¼INDEXï¼\n\n> éè¿ç´¢å¼å¯ä»¥æ´å å¿«éé«æå°æ¥è¯¢æ°æ®ãç¨æ·æ æ³çå°ç´¢å¼ï¼å®ä»¬åªè½è¢«ç¨æ¥å éæ¥è¯¢ã\n\næ´æ°ä¸ä¸ªåå«ç´¢å¼çè¡¨éè¦æ¯æ´æ°ä¸ä¸ªæ²¡æç´¢å¼çè¡¨è±è´¹æ´å¤çæ¶é´ï¼è¿æ¯ç±äºç´¢å¼æ¬èº«ä¹éè¦æ´æ°ãå æ­¤ï¼çæ³çåæ³æ¯ä»ä»å¨å¸¸å¸¸è¢«æç´¢çåï¼ä»¥åè¡¨ï¼ä¸é¢åå»ºç´¢å¼ã\n\nå¯ä¸ç´¢å¼ï¼å¯ä¸ç´¢å¼è¡¨ææ­¤ç´¢å¼çæ¯ä¸ä¸ªç´¢å¼å¼åªå¯¹åºå¯ä¸çæ°æ®è®°å½ã\n\n# åå»ºç´¢å¼\n\nCREATE INDEX user_index\nON user (id);\n\n\n# åå»ºå¯ä¸ç´¢å¼\n\nCREATE UNIQUE INDEX user_index\nON user (id);\n\n\n# å é¤ç´¢å¼\n\nALTER TABLE user\nDROP INDEX user_index;\n\n\n\n# çº¦æ\n\n> SQL çº¦æç¨äºè§å®è¡¨ä¸­çæ°æ®è§åã\n\n * å¦æå­å¨è¿åçº¦æçæ°æ®è¡ä¸ºï¼è¡ä¸ºä¼è¢«çº¦æç»æ­¢ã\n * çº¦æå¯ä»¥å¨åå»ºè¡¨æ¶è§å®ï¼éè¿ CREATE TABLE è¯­å¥ï¼ï¼æèå¨è¡¨åå»ºä¹åè§å®ï¼éè¿ ALTER TABLE è¯­å¥ï¼ã\n * çº¦æç±»å\n   * NOT NULL - æç¤ºæåä¸è½å­å¨ NULL å¼ã\n   * UNIQUE - ä¿è¯æåçæ¯è¡å¿é¡»æå¯ä¸çå¼ã\n   * PRIMARY KEY - NOT NULL å UNIQUE çç»åãç¡®ä¿æåï¼æä¸¤ä¸ªåå¤ä¸ªåçç»åï¼æå¯ä¸æ è¯ï¼æå©äºæ´å®¹ææ´å¿«éå°æ¾å°è¡¨ä¸­çä¸ä¸ªç¹å®çè®°å½ã\n   * FOREIGN KEY - ä¿è¯ä¸ä¸ªè¡¨ä¸­çæ°æ®å¹éå¦ä¸ä¸ªè¡¨ä¸­çå¼çåç§å®æ´æ§ã\n   * CHECK - ä¿è¯åä¸­çå¼ç¬¦åæå®çæ¡ä»¶ã\n   * DEFAULT - è§å®æ²¡æç»åèµå¼æ¶çé»è®¤å¼ã\n\nåå»ºè¡¨æ¶ä½¿ç¨çº¦ææ¡ä»¶ï¼\n\nCREATE TABLE Users (\n  Id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'èªå¢Id',\n  Username VARCHAR(64) NOT NULL UNIQUE DEFAULT 'default' COMMENT 'ç¨æ·å',\n  Password VARCHAR(64) NOT NULL DEFAULT 'default' COMMENT 'å¯ç ',\n  Email VARCHAR(64) NOT NULL DEFAULT 'default' COMMENT 'é®ç®±å°å',\n  Enabled TINYINT(4) DEFAULT NULL COMMENT 'æ¯å¦ææ',\n  PRIMARY KEY (Id)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='ç¨æ·è¡¨';\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º TCL è¯­å¥ç¨æ³ï¼\n\n\n# å«ãäºå¡å¤ç\n\nä¸è½åé SELECT è¯­å¥ï¼åé SELECT è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé CREATE å DROP è¯­å¥ã\n\nMySQL é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ï¼æ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° START TRANSACTION è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ COMMIT æ ROLLBACK è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\näºå¡å¤çæä»¤ï¼\n\n * START TRANSACTION - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * SAVEPOINT - æä»¤ç¨äºåå»ºä¿çç¹ã\n * ROLLBACK TO - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° START TRANSACTION è¯­å¥å¤ã\n * COMMIT - æäº¤äºå¡ã\n\näºå¡å¤çç¤ºä¾ï¼\n\n-- å¼å§äºå¡\nSTART TRANSACTION;\n\n-- æå¥æä½ A\nINSERT INTO `user`\nVALUES (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updateA\nSAVEPOINT updateA;\n\n-- æå¥æä½ B\nINSERT INTO `user`\nVALUES (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updateA\nROLLBACK TO updateA;\n\n-- æäº¤äºå¡ï¼åªææä½ A çæ\nCOMMIT;\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º DCL è¯­å¥ç¨æ³ï¼\n\n\n# ä¹ãæéæ§å¶\n\nGRANT å REVOKE å¯å¨å ä¸ªå±æ¬¡ä¸æ§å¶è®¿é®æéï¼\n\n * æ´ä¸ªæå¡å¨ï¼ä½¿ç¨ GRANT ALL å REVOKE ALLï¼\n * æ´ä¸ªæ°æ®åºï¼ä½¿ç¨ ON database.*ï¼\n * ç¹å®çè¡¨ï¼ä½¿ç¨ ON database.tableï¼\n * ç¹å®çåï¼\n * ç¹å®çå­å¨è¿ç¨ã\n\næ°åå»ºçè´¦æ·æ²¡æä»»ä½æéã\n\nè´¦æ·ç¨ username@host çå½¢å¼å®ä¹ï¼username@% ä½¿ç¨çæ¯é»è®¤ä¸»æºåã\n\nMySQL çè´¦æ·ä¿¡æ¯ä¿å­å¨ mysql è¿ä¸ªæ°æ®åºä¸­ã\n\nUSE mysql;\nSELECT user FROM user;\n\n\n\n# åå»ºè´¦æ·\n\nCREATE USER myuser IDENTIFIED BY 'mypassword';\n\n\n\n# ä¿®æ¹è´¦æ·å\n\nUPDATE user SET user='newuser' WHERE user='myuser';\nFLUSH PRIVILEGES;\n\n\n\n# å é¤è´¦æ·\n\nDROP USER myuser;\n\n\n\n# æ¥çæé\n\nSHOW GRANTS FOR myuser;\n\n\n\n# æäºæé\n\nGRANT SELECT, INSERT ON *.* TO myuser;\n\n\n\n# å é¤æé\n\nREVOKE SELECT, INSERT ON *.* FROM myuser;\n\n\n\n# æ´æ¹å¯ç \n\nSET PASSWORD FOR myuser = 'mypass';\n\n\n\n# åãå­å¨è¿ç¨åæ¸¸æ \n\n> å­å¨è¿ç¨å¯ä»¥çææ¯å¯¹ä¸ç³»å SQL æä½çæ¹å¤çï¼ä¿å­å¨æ°æ®åºä¸­ãå®å°±åæä»¬ç¼ç¨è¯­è¨ä¸­çå½æ°ä¸æ ·ï¼å°è£äºæä»¬çä»£ç (PLSQLãT-SQL)ã\n\n\n# å­å¨è¿ç¨ä¼ç¼ºç¹\n\nå­å¨è¿ç¨çä¼ç¹ï¼\n\n * ä»£ç å°è£ï¼ä¿è¯äºä¸å®çå®å¨æ§ã\n * è®©ç¼ç¨è¯­è¨è¿è¡è°ç¨ï¼æé«ä»£ç å¤ç¨ã\n * ç±äºæ¯é¢åç¼è¯ï¼å æ­¤å·æå¾é«çæ§è½ã\n * ä¸ä¸ªå­å¨è¿ç¨æ¿ä»£å¤§é T_SQL è¯­å¥ ï¼å¯ä»¥éä½ç½ç»éä¿¡éï¼æé«éä¿¡éçã\n\nå­å¨è¿ç¨çç¼ºç¹ï¼\n\n * ç±äºä¸åæ°æ®åºçå­å¨è¿ç¨è¯­æ³å ä¹é½ä¸ä¸æ ·ï¼ååé¾ä»¥ç»´æ¤ï¼ä¸éç¨ï¼ã\n * ä¸å¡é»è¾æ¾å¨æ°æ®åºä¸ï¼é¾ä»¥è¿­ä»£ã\n\n\n# ä½¿ç¨å­å¨è¿ç¨\n\nåå»ºå­å¨è¿ç¨çè¦ç¹ï¼\n\n * å½ä»¤è¡ä¸­åå»ºå­å¨è¿ç¨éè¦èªå®ä¹åéç¬¦ï¼å ä¸ºå½ä»¤è¡æ¯ä»¥ ; ä¸ºç»æç¬¦ï¼èå­å¨è¿ç¨ä¸­ä¹åå«äºåå·ï¼å æ­¤ä¼éè¯¯æè¿é¨ååå·å½ææ¯ç»æç¬¦ï¼é æè¯­æ³éè¯¯ã\n * åå« inãout å inout ä¸ç§åæ°ã\n * ç»åéèµå¼é½éè¦ç¨ select into è¯­å¥ã\n * æ¯æ¬¡åªè½ç»ä¸ä¸ªåéèµå¼ï¼ä¸æ¯æéåçæä½ã\n\nåå»ºå­å¨è¿ç¨ç¤ºä¾ï¼\n\nDROP PROCEDURE IF EXISTS `proc_adder`;\nDELIMITER ;;\nCREATE DEFINER=`root`@`localhost` PROCEDURE `proc_adder`(IN a int, IN b int, OUT sum int)\nBEGIN\n    DECLARE c int;\n    if a is null then set a = 0;\n    end if;\n\n    if b is null then set b = 0;\n    end if;\n\n    set sum  = a + b;\nEND\n;;\nDELIMITER ;\n\n\nä½¿ç¨å­å¨è¿ç¨ç¤ºä¾ï¼\n\nset @b=5;\ncall proc_adder(2,@b,@s);\nselect @s as sum;\n\n\n\n# æ¸¸æ \n\n> æ¸¸æ ï¼CURSORï¼æ¯ä¸ä¸ªå­å¨å¨ DBMS æå¡å¨ä¸çæ°æ®åºæ¥è¯¢ï¼å®ä¸æ¯ä¸æ¡ SELECT è¯­å¥ï¼èæ¯è¢«è¯¥è¯­å¥æ£ç´¢åºæ¥çç»æéãå¨å­å¨è¿ç¨ä¸­ä½¿ç¨æ¸¸æ å¯ä»¥å¯¹ä¸ä¸ªç»æéè¿è¡ç§»å¨éåã\n\næ¸¸æ ä¸»è¦ç¨äºäº¤äºå¼åºç¨ï¼å¶ä¸­ç¨æ·éè¦å¯¹æ°æ®éä¸­çä»»æè¡è¿è¡æµè§åä¿®æ¹ã\n\nä½¿ç¨æ¸¸æ çåä¸ªæ­¥éª¤ï¼\n\n 1. å£°ææ¸¸æ ï¼è¿ä¸ªè¿ç¨æ²¡æå®éæ£ç´¢åºæ°æ®ï¼\n 2. æå¼æ¸¸æ ï¼\n 3. ååºæ°æ®ï¼\n 4. å³é­æ¸¸æ ï¼\n\næ¸¸æ ä½¿ç¨ç¤ºä¾ï¼\n\nDELIMITER $\nCREATE PROCEDURE getTotal()\nBEGIN\n    DECLARE total INT;\n    -- åå»ºæ¥æ¶æ¸¸æ æ°æ®çåé\n    DECLARE sid INT;\n    DECLARE sname VARCHAR(10);\n    -- åå»ºæ»æ°åé\n    DECLARE sage INT;\n    -- åå»ºç»ææ å¿åé\n    DECLARE done INT DEFAULT false;\n    -- åå»ºæ¸¸æ \n    DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age>30;\n    -- æå®æ¸¸æ å¾ªç¯ç»ææ¶çè¿åå¼\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;\n    SET total = 0;\n    OPEN cur;\n    FETCH cur INTO sid, sname, sage;\n    WHILE(NOT done)\n    DO\n        SET total = total + 1;\n        FETCH cur INTO sid, sname, sage;\n    END WHILE;\n\n    CLOSE cur;\n    SELECT total;\nEND $\nDELIMITER ;\n\n-- è°ç¨å­å¨è¿ç¨\ncall getTotal();\n\n\n\n# è§¦åå¨\n\n> è§¦åå¨å¯ä»¥è§ä¸ºä¸ç§ç¹æ®çå­å¨è¿ç¨ã\n> \n> è§¦åå¨æ¯ä¸ç§ä¸è¡¨æä½æå³çæ°æ®åºå¯¹è±¡ï¼å½è§¦åå¨æå¨è¡¨ä¸åºç°æå®äºä»¶æ¶ï¼å°è°ç¨è¯¥å¯¹è±¡ï¼å³è¡¨çæä½äºä»¶è§¦åè¡¨ä¸çè§¦åå¨çæ§è¡ã\n\n# è§¦åå¨ç¹æ§\n\nå¯ä»¥ä½¿ç¨è§¦åå¨æ¥è¿è¡å®¡è®¡è·è¸ªï¼æä¿®æ¹è®°å½å°å¦å¤ä¸å¼ è¡¨ä¸­ã\n\nMySQL ä¸åè®¸å¨è§¦åå¨ä¸­ä½¿ç¨ CALL è¯­å¥ ï¼ä¹å°±æ¯ä¸è½è°ç¨å­å¨è¿ç¨ã\n\nBEGIN å END\n\nå½è§¦åå¨çè§¦åæ¡ä»¶æ»¡è¶³æ¶ï¼å°ä¼æ§è¡ BEGIN å END ä¹é´çè§¦åå¨æ§è¡å¨ä½ã\n\n> ð æ³¨æï¼å¨ MySQL ä¸­ï¼åå· ; æ¯è¯­å¥ç»æçæ è¯ç¬¦ï¼éå°åå·è¡¨ç¤ºè¯¥æ®µè¯­å¥å·²ç»ç»æï¼MySQL å¯ä»¥å¼å§æ§è¡äºãå æ­¤ï¼è§£éå¨éå°è§¦åå¨æ§è¡å¨ä½ä¸­çåå·åå°±å¼å§æ§è¡ï¼ç¶åä¼æ¥éï¼å ä¸ºæ²¡ææ¾å°å BEGIN å¹éç ENDã\n> \n> è¿æ¶å°±ä¼ç¨å° DELIMITER å½ä»¤ï¼DELIMITER æ¯å®çç¬¦ï¼åéç¬¦çææï¼ãå®æ¯ä¸æ¡å½ä»¤ï¼ä¸éè¦è¯­å¥ç»ææ è¯ï¼è¯­æ³ä¸ºï¼DELIMITER new_delemiterãnew_delemiter å¯ä»¥è®¾ä¸º 1 ä¸ªæå¤ä¸ªé¿åº¦çç¬¦å·ï¼é»è®¤çæ¯åå· ;ï¼æä»¬å¯ä»¥æå®ä¿®æ¹ä¸ºå¶ä»ç¬¦å·ï¼å¦ $ - DELIMITER $ ãå¨è¿ä¹åçè¯­å¥ï¼ä»¥åå·ç»æï¼è§£éå¨ä¸ä¼æä»ä¹ååºï¼åªæéå°äº $ï¼æè®¤ä¸ºæ¯è¯­å¥ç»æãæ³¨æï¼ä½¿ç¨å®ä¹åï¼æä»¬è¿åºè¯¥è®°å¾æå®ç»ä¿®æ¹åæ¥ã\n\nNEW å OLD\n\n * MySQL ä¸­å®ä¹äº NEW å OLD å³é®å­ï¼ç¨æ¥è¡¨ç¤ºè§¦åå¨çæå¨è¡¨ä¸­ï¼è§¦åäºè§¦åå¨çé£ä¸è¡æ°æ®ã\n * å¨ INSERT åè§¦åå¨ä¸­ï¼NEW ç¨æ¥è¡¨ç¤ºå°è¦ï¼BEFOREï¼æå·²ç»ï¼AFTERï¼æå¥çæ°æ°æ®ï¼\n * å¨ UPDATE åè§¦åå¨ä¸­ï¼OLD ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«ä¿®æ¹çåæ°æ®ï¼NEW ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»ä¿®æ¹ä¸ºçæ°æ°æ®ï¼\n * å¨ DELETE åè§¦åå¨ä¸­ï¼OLD ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«å é¤çåæ°æ®ï¼\n * ä½¿ç¨æ¹æ³ï¼ NEW.columnName ï¼columnName ä¸ºç¸åºæ°æ®è¡¨æä¸ååï¼\n\n# è§¦åå¨æä»¤\n\n> æç¤ºï¼ä¸ºäºçè§£è§¦åå¨çè¦ç¹ï¼æå¿è¦åäºè§£ä¸ä¸åå»ºè§¦åå¨çæä»¤ã\n\nCREATE TRIGGER æä»¤ç¨äºåå»ºè§¦åå¨ã\n\nè¯­æ³ï¼\n\nCREATE TRIGGER trigger_name\ntrigger_time\ntrigger_event\nON table_name\nFOR EACH ROW\nBEGIN\n  trigger_statements\nEND;\n\n\nè¯´æï¼\n\n * trigger_nameï¼è§¦åå¨å\n * trigger_time: è§¦åå¨çè§¦åæ¶æºãåå¼ä¸º BEFORE æ AFTERã\n * trigger_event: è§¦åå¨ççå¬äºä»¶ãåå¼ä¸º INSERTãUPDATE æ DELETEã\n * table_name: è§¦åå¨ççå¬ç®æ ãæå®å¨åªå¼ è¡¨ä¸å»ºç«è§¦åå¨ã\n * FOR EACH ROW: è¡çº§çè§ï¼Mysql åºå®åæ³ï¼å¶ä» DBMS ä¸åã\n * trigger_statements: è§¦åå¨æ§è¡å¨ä½ãæ¯ä¸æ¡æå¤æ¡ SQL è¯­å¥çåè¡¨ï¼åè¡¨åçæ¯æ¡è¯­å¥é½å¿é¡»ç¨åå· ; æ¥ç»å°¾ã\n\nåå»ºè§¦åå¨ç¤ºä¾ï¼\n\nDELIMITER $\nCREATE TRIGGER `trigger_insert_user`\nAFTER INSERT ON `user`\nFOR EACH ROW\nBEGIN\n    INSERT INTO `user_history`(user_id, operate_type, operate_time)\n    VALUES (NEW.id, 'add a user',  now());\nEND $\nDELIMITER ;\n\n\næ¥çè§¦åå¨ç¤ºä¾ï¼\n\nSHOW TRIGGERS;\n\n\nå é¤è§¦åå¨ç¤ºä¾ï¼\n\nDROP TRIGGER IF EXISTS trigger_insert_user;\n\n\n\n# åèèµæ\n\n * ãSQL å¿ç¥å¿ä¼ã\n * ãæµå¥æ·±åºãMySQL ä¸­äºå¡çå®ç°\n * MySQL çå­¦ä¹ --è§¦åå¨\n * ç»´åºç¾ç§è¯æ¡ - SQL\n * https://www.sitesbay.com/sql/index\n * SQL Subqueries\n * Quick breakdown of the types of joins\n * SQL UNION\n * SQL database security\n * Mysql ä¸­çå­å¨è¿ç¨",normalizedContent:"# sql cheat sheet\n\n> æ¬æéå¯¹å³ç³»åæ°æ®åºçåºæ¬è¯­æ³ãéäºç¯å¹ï¼æ¬æä¾§éè¯´æç¨æ³ï¼ä¸ä¼å±å¼è®²è§£ç¹æ§ãåçã\n> \n> æ¬æè¯­æ³ä¸»è¦éå¯¹ mysqlï¼ä½å¤§é¨åçè¯­æ³å¯¹å¶ä»å³ç³»åæ°æ®åºä¹éç¨ã\n\n\n\n\n# ä¸ãåºæ¬æ¦å¿µ\n\n\n# æ°æ®åºæ¯è¯­\n\n * æ°æ®åºï¼databaseï¼ - ä¿å­æç»ç»çæ°æ®çå®¹å¨ï¼éå¸¸æ¯ä¸ä¸ªæä»¶æä¸ç»æä»¶ï¼ã\n * æ°æ®è¡¨ï¼tableï¼ - æç§ç¹å®ç±»åæ°æ®çç»æåæ¸åã\n * æ¨¡å¼ï¼schemaï¼ - å³äºæ°æ®åºåè¡¨çå¸å±åç¹æ§çä¿¡æ¯ãæ¨¡å¼å®ä¹äºæ°æ®å¨è¡¨ä¸­å¦ä½å­å¨ï¼åå«å­å¨ä»ä¹æ ·çæ°æ®ï¼æ°æ®å¦ä½åè§£ï¼åé¨åä¿¡æ¯å¦ä½å½åç­ä¿¡æ¯ãæ°æ®åºåè¡¨é½ææ¨¡å¼ã\n * åï¼columnï¼ - è¡¨ä¸­çä¸ä¸ªå­æ®µãææè¡¨é½æ¯ç±ä¸ä¸ªæå¤ä¸ªåç»æçã\n * è¡ï¼rowï¼ - è¡¨ä¸­çä¸ä¸ªè®°å½ã\n * ä¸»é®ï¼primary keyï¼ - ä¸åï¼æä¸ç»åï¼ï¼å¶å¼è½å¤å¯ä¸æ è¯è¡¨ä¸­æ¯ä¸è¡ã\n\n\n# sql è¯­æ³\n\n> sqlï¼structured query language)ï¼æ å sql ç± ansi æ åå§åä¼ç®¡çï¼ä»èç§°ä¸º ansi sqlãåä¸ª dbms é½æèªå·±çå®ç°ï¼å¦ pl/sqlãtransact-sql ç­ã\n\n# sql è¯­æ³ç»æ\n\n\n\nsql è¯­æ³ç»æåæ¬ï¼\n\n * å­å¥ - æ¯è¯­å¥åæ¥è¯¢çç»ææåãï¼å¨æäºæåµä¸ï¼è¿äºé½æ¯å¯éçãï¼\n * è¡¨è¾¾å¼ - å¯ä»¥äº§çä»»ä½æ éå¼ï¼æç±ååè¡çæ°æ®åºè¡¨\n * è°è¯ - ç»éè¦è¯ä¼°ç sql ä¸å¼é»è¾ï¼3vlï¼ï¼true/false/unknownï¼æå¸å°çå¼æå®æ¡ä»¶ï¼å¹¶éå¶è¯­å¥åæ¥è¯¢çææï¼ææ¹åç¨åºæµç¨ã\n * æ¥è¯¢ - åºäºç¹å®æ¡ä»¶æ£ç´¢æ°æ®ãè¿æ¯ sql çä¸ä¸ªéè¦ç»æé¨åã\n * è¯­å¥ - å¯ä»¥æä¹å°å½±åçº²è¦åæ°æ®ï¼ä¹å¯ä»¥æ§å¶æ°æ®åºäºå¡ãç¨åºæµç¨ãè¿æ¥ãä¼è¯æè¯æ­ã\n\n# sql è¯­æ³è¦ç¹\n\n * sql è¯­å¥ä¸åºåå¤§å°åï¼ä½æ¯æ°æ®åºè¡¨åãåååå¼æ¯å¦åºåï¼ä¾èµäºå·ä½ç dbms ä»¥åéç½®ã\n\nä¾å¦ï¼select ä¸ select ãselect æ¯ç¸åçã\n\n * å¤æ¡ sql è¯­å¥å¿é¡»ä»¥åå·ï¼;ï¼åéã\n\n * å¤ç sql è¯­å¥æ¶ï¼ææç©ºæ ¼é½è¢«å¿½ç¥ãsql è¯­å¥å¯ä»¥åæä¸è¡ï¼ä¹å¯ä»¥ååä¸ºå¤è¡ã\n\n-- ä¸è¡ sql è¯­å¥\nupdate user set username='robot', password='robot' where username = 'root';\n\n-- å¤è¡ sql è¯­å¥\nupdate user\nset username='robot', password='robot'\nwhere username = 'root';\n\n\n * sql æ¯æä¸ç§æ³¨é\n\n## æ³¨é1\n-- æ³¨é2\n/* æ³¨é3 */\n\n\n# sql åç±»\n\n# æ°æ®å®ä¹è¯­è¨ï¼ddlï¼\n\næ°æ®å®ä¹è¯­è¨ï¼data definition languageï¼ddlï¼æ¯ sql è¯­è¨éä¸­è´è´£æ°æ®ç»æå®ä¹ä¸æ°æ®åºå¯¹è±¡å®ä¹çè¯­è¨ã\n\nddl çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ã\n\nddl çæ ¸å¿æä»¤æ¯ createãalterãdropã\n\n# æ°æ®æçºµè¯­è¨ï¼dmlï¼\n\næ°æ®æçºµè¯­è¨ï¼data manipulation language, dmlï¼æ¯ç¨äºæ°æ®åºæä½ï¼å¯¹æ°æ®åºå¶ä¸­çå¯¹è±¡åæ°æ®è¿è¡è®¿é®å·¥ä½çç¼ç¨è¯­å¥ã\n\ndml çä¸»è¦åè½æ¯ è®¿é®æ°æ®ï¼å æ­¤å¶è¯­æ³é½æ¯ä»¥è¯»åæ°æ®åºä¸ºä¸»ã\n\ndml çæ ¸å¿æä»¤æ¯ insertãupdateãdeleteãselectãè¿åä¸ªæä»¤åç§° crud(create, read, update, delete)ï¼å³å¢å æ¹æ¥ã\n\n# äºå¡æ§å¶è¯­è¨ï¼tclï¼\n\näºå¡æ§å¶è¯­è¨ (transaction control language, tcl) ç¨äºç®¡çæ°æ®åºä¸­çäºå¡ãè¿äºç¨äºç®¡çç± dml è¯­å¥æåçæ´æ¹ãå®è¿åè®¸å°è¯­å¥åç»ä¸ºé»è¾äºå¡ã\n\ntcl çæ ¸å¿æä»¤æ¯ commitãrollbackã\n\n# æ°æ®æ§å¶è¯­è¨ï¼dclï¼\n\næ°æ®æ§å¶è¯­è¨ (data control language, dcl) æ¯ä¸ç§å¯å¯¹æ°æ®è®¿é®æè¿è¡æ§å¶çæä»¤ï¼å®å¯ä»¥æ§å¶ç¹å®ç¨æ·è´¦æ·å¯¹æ°æ®è¡¨ãæ¥çè¡¨ãé¢å­ç¨åºãç¨æ·èªå®ä¹å½æ°ç­æ°æ®åºå¯¹è±¡çæ§å¶æã\n\ndcl çæ ¸å¿æä»¤æ¯ grantãrevokeã\n\ndcl ä»¥æ§å¶ç¨æ·çè®¿é®æéä¸ºä¸»ï¼å æ­¤å¶æä»¤ä½æ³å¹¶ä¸å¤æï¼å¯å©ç¨ dcl æ§å¶çæéæï¼connectãselectãinsertãupdateãdeleteãexecuteãusageãreferencesã\n\næ ¹æ®ä¸åç dbms ä»¥åä¸åçå®å¨æ§å®ä½ï¼å¶æ¯æçæéæ§å¶ä¹ææä¸åã\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º dml è¯­å¥ç¨æ³ï¼\n\n\n# äºãå¢å æ¹æ¥\n\n> å¢å æ¹æ¥ï¼åç§°ä¸º crudï¼æ°æ®åºåºæ¬æä½ä¸­çåºæ¬æä½ã\n\n\n# æå¥æ°æ®\n\n>  * insert into è¯­å¥ç¨äºåè¡¨ä¸­æå¥æ°è®°å½ã\n\næå¥å®æ´çè¡\n\ninsert into user\nvalues (10, 'root', 'root', 'xxxx@163.com');\n\n\næå¥è¡çä¸é¨å\n\ninsert into user(username, password, email)\nvalues ('admin', 'admin', 'xxxx@163.com');\n\n\næå¥æ¥è¯¢åºæ¥çæ°æ®\n\ninsert into user(username)\nselect name\nfrom account;\n\n\n\n# æ´æ°æ°æ®\n\n>  * update è¯­å¥ç¨äºæ´æ°è¡¨ä¸­çè®°å½ã\n\nupdate user\nset username='robot', password='robot'\nwhere username = 'root';\n\n\n\n# å é¤æ°æ®\n\n>  * delete è¯­å¥ç¨äºå é¤è¡¨ä¸­çè®°å½ã\n>  * truncate table å¯ä»¥æ¸ç©ºè¡¨ï¼ä¹å°±æ¯å é¤ææè¡ã\n\nå é¤è¡¨ä¸­çæå®æ°æ®\n\ndelete from user\nwhere username = 'robot';\n\n\næ¸ç©ºè¡¨ä¸­çæ°æ®\n\ntruncate table user;\n\n\n\n# æ¥è¯¢æ°æ®\n\n>  * select è¯­å¥ç¨äºä»æ°æ®åºä¸­æ¥è¯¢æ°æ®ã\n>  * distinct ç¨äºè¿åå¯ä¸ä¸åçå¼ãå®ä½ç¨äºææåï¼ä¹å°±æ¯è¯´ææåçå¼é½ç¸åæç®ç¸åã\n>  * limit éå¶è¿åçè¡æ°ãå¯ä»¥æä¸¤ä¸ªåæ°ï¼ç¬¬ä¸ä¸ªåæ°ä¸ºèµ·å§è¡ï¼ä» 0 å¼å§ï¼ç¬¬äºä¸ªåæ°ä¸ºè¿åçæ»è¡æ°ã\n>    * asc ï¼ååºï¼é»è®¤ï¼\n>    * desc ï¼éåº\n\næ¥è¯¢åå\n\nselect prod_name\nfrom products;\n\n\næ¥è¯¢å¤å\n\nselect prod_id, prod_name, prod_price\nfrom products;\n\n\næ¥è¯¢ææå\n\nelect *\nfrom products;\n\n\næ¥è¯¢ä¸åçå¼\n\nselect distinct\nvend_id from products;\n\n\néå¶æ¥è¯¢ç»æ\n\n-- è¿åå 5 è¡\nselect * from mytable limit 5;\nselect * from mytable limit 0, 5;\n-- è¿åç¬¬ 3 ~ 5 è¡\nselect * from mytable limit 2, 3;\n\n\n\n# ä¸ãå­æ¥è¯¢\n\n> å­æ¥è¯¢æ¯åµå¥å¨è¾å¤§æ¥è¯¢ä¸­ç sql æ¥è¯¢ãå­æ¥è¯¢ä¹ç§°ä¸ºåé¨æ¥è¯¢æåé¨éæ©ï¼èåå«å­æ¥è¯¢çè¯­å¥ä¹ç§°ä¸ºå¤é¨æ¥è¯¢æå¤é¨éæ©ã\n\n * å­æ¥è¯¢å¯ä»¥åµå¥å¨ selectï¼insertï¼update æ delete è¯­å¥åæå¦ä¸ä¸ªå­æ¥è¯¢ä¸­ã\n\n * å­æ¥è¯¢éå¸¸ä¼å¨å¦ä¸ä¸ª select è¯­å¥ç where å­å¥ä¸­æ·»å ã\n\n * æ¨å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦ >ï¼<ï¼æ =ãæ¯è¾è¿ç®ç¬¦ä¹å¯ä»¥æ¯å¤è¡è¿ç®ç¬¦ï¼å¦ inï¼any æ allã\n\n * å­æ¥è¯¢å¿é¡»è¢«åæ¬å· () æ¬èµ·æ¥ã\n\n * åé¨æ¥è¯¢é¦åå¨å¶ç¶æ¥è¯¢ä¹åæ§è¡ï¼ä»¥ä¾¿å¯ä»¥å°åé¨æ¥è¯¢çç»æä¼ éç»å¤é¨æ¥è¯¢ãæ§è¡è¿ç¨å¯ä»¥åèä¸å¾ï¼\n   \n   \n\nå­æ¥è¯¢çå­æ¥è¯¢\n\nselect cust_name, cust_contact\nfrom customers\nwhere cust_id in (select cust_id\n                  from orders\n                  where order_num in (select order_num\n                                      from orderitems\n                                      where prod_id = 'rgan01'));\n\n\n\n# where\n\n> where å­å¥ç¨äºè¿æ»¤è®°å½ï¼å³ç¼©å°è®¿é®æ°æ®çèå´ãwhere åè·ä¸ä¸ªè¿å true æ false çæ¡ä»¶ã\n> \n> where å¯ä»¥ä¸ selectï¼update å delete ä¸èµ·ä½¿ç¨ã\n\nå¯ä»¥å¨ where å­å¥ä¸­ä½¿ç¨çæä½ç¬¦ï¼\n\nè¿ç®ç¬¦       æè¿°\n=         ç­äº\n<>        ä¸ç­äºãæ³¨éï¼å¨ sql çä¸äºçæ¬ä¸­ï¼è¯¥æä½ç¬¦å¯è¢«åæ !=\n>         å¤§äº\n<         å°äº\n>=        å¤§äºç­äº\n<=        å°äºç­äº\nbetween   å¨æä¸ªèå´å\nlike      æç´¢æç§æ¨¡å¼\nin        æå®éå¯¹æä¸ªåçå¤ä¸ªå¯è½å¼\n\nselect è¯­å¥ä¸­ç where å­å¥\n\nselect * from customers\nwhere cust_name = 'kids place';\n\n\nupdate è¯­å¥ä¸­ç where å­å¥\n\nupdate customers\nset cust_name = 'jack jones'\nwhere cust_name = 'kids place';\n\n\ndelete è¯­å¥ä¸­ç where å­å¥\n\ndelete from customers\nwhere cust_name = 'kids place';\n\n\n\n# in å between\n\n> in æä½ç¬¦å¨ where å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯å¨æå®çå ä¸ªç¹å®å¼ä¸­ä»»éä¸ä¸ªå¼ã\n> \n> between æä½ç¬¦å¨ where å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯éåä»äºæä¸ªèå´åçå¼ã\n\nin ç¤ºä¾\n\nselect *\nfrom products\nwhere vend_id in ('dll01', 'brs01');\n\n\nbetween ç¤ºä¾\n\nselect *\nfrom products\nwhere prod_price between 3 and 5;\n\n\n\n# andãorãnot\n\n> andãorãnot æ¯ç¨äºå¯¹è¿æ»¤æ¡ä»¶çé»è¾å¤çæä»¤ã\n> \n> and ä¼åçº§é«äº orï¼ä¸ºäºæç¡®å¤çé¡ºåºï¼å¯ä»¥ä½¿ç¨ ()ãand æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶é½è¦æ»¡è¶³ã\n> \n> or æä½ç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶æ»¡è¶³ä»»æä¸ä¸ªå³å¯ã\n> \n> not æä½ç¬¦ç¨äºå¦å®ä¸ä¸ªæ¡ä»¶ã\n\nand ç¤ºä¾\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere vend_id = 'dll01' and prod_price <= 4;\n\n\nor ç¤ºä¾\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere vend_id = 'dll01' or vend_id = 'brs01';\n\n\nnot ç¤ºä¾\n\nselect *\nfrom products\nwhere prod_price not between 3 and 5;\n\n\n\n# like\n\n> like æä½ç¬¦å¨ where å­å¥ä¸­ä½¿ç¨ï¼ä½ç¨æ¯ç¡®å®å­ç¬¦ä¸²æ¯å¦å¹éæ¨¡å¼ãåªæå­æ®µæ¯ææ¬å¼æ¶æä½¿ç¨ likeã\n> \n> like æ¯æä¸¤ä¸ªééç¬¦å¹ééé¡¹ï¼% å _ã\n> \n>  * % è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä»»ææ¬¡æ°ã\n>  * _ è¡¨ç¤ºä»»ä½å­ç¬¦åºç°ä¸æ¬¡ã\n> \n> ä¸è¦æ»¥ç¨ééç¬¦ï¼ééç¬¦ä½äºå¼å¤´å¤å¹éä¼éå¸¸æ¢ã\n\n% ç¤ºä¾ï¼\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere prod_name like '%bean bag%';\n\n\n_ ç¤ºä¾ï¼\n\nselect prod_id, prod_name, prod_price\nfrom products\nwhere prod_name like '__ inch teddy bear';\n\n\n\n# åãè¿æ¥åç»å\n\n\n# è¿æ¥ï¼joinï¼\n\n> è¿æ¥ç¨äºè¿æ¥å¤ä¸ªè¡¨ï¼ä½¿ç¨ join å³é®å­ï¼å¹¶ä¸æ¡ä»¶è¯­å¥ä½¿ç¨ on èä¸æ¯ whereã\n\nå¦æä¸ä¸ª join è³å°æä¸ä¸ªå¬å±å­æ®µå¹¶ä¸å®ä»¬ä¹é´å­å¨å³ç³»ï¼åè¯¥ join å¯ä»¥å¨ä¸¤ä¸ªæå¤ä¸ªè¡¨ä¸å·¥ä½ã\n\njoin ä¿æåºè¡¨ï¼ç»æåæ°æ®ï¼ä¸åãè¿æ¥å¯ä»¥æ¿æ¢å­æ¥è¯¢ï¼å¹¶ä¸æ¯å­æ¥è¯¢çæçä¸è¬ä¼æ´å¿«ã\n\njoin æä¸¤ç§è¿æ¥ç±»åï¼åè¿æ¥åå¤è¿æ¥ã\n\n\n\n# åè¿æ¥ï¼inner joinï¼\n\nåè¿æ¥åç§°ç­å¼è¿æ¥ï¼ä½¿ç¨ inner join å³é®å­ãå¨æ²¡ææ¡ä»¶è¯­å¥çæåµä¸è¿åç¬å¡å°ç§¯ã\n\nselect vend_name, prod_name, prod_price\nfrom vendors inner join products\non vendors.vend_id = products.vend_id;\n\n\n# èªè¿æ¥ï¼=ï¼\n\nèªè¿æ¥å¯ä»¥çæåè¿æ¥çä¸ç§ï¼åªæ¯è¿æ¥çè¡¨æ¯èªèº«èå·²ãèªç¶è¿æ¥æ¯æåååéè¿ = è¿æ¥èµ·æ¥çï¼åååå¯ä»¥æå¤ä¸ªã\n\nselect c1.cust_id, c1.cust_name, c1.cust_contact\nfrom customers c1, customers c2\nwhere c1.cust_name = c2.cust_name\nand c2.cust_contact = 'jim jones';\n\n\n# èªç¶è¿æ¥ï¼natural joinï¼\n\nåè¿æ¥æä¾è¿æ¥çåï¼èèªç¶è¿æ¥èªå¨è¿æ¥ææåååãèªç¶è¿æ¥ä½¿ç¨ natural join å³é®å­ã\n\nselect *\nfrom products\nnatural join customers;\n\n\n# å¤è¿æ¥ï¼outer joinï¼\n\nå¤è¿æ¥è¿åä¸ä¸ªè¡¨ä¸­çææè¡ï¼å¹¶ä¸ä»è¿åæ¥èªæ­¤è¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çé£äºè¡ï¼å³ä¸¤ä¸ªè¡¨ä¸­çåæ¯ç¸ç­çãå¤è¿æ¥åä¸ºå·¦å¤è¿æ¥ãå³å¤è¿æ¥ãå¨å¤è¿æ¥ï¼mysql ä¸æ¯æï¼ã\n\n# å·¦è¿æ¥ï¼left joinï¼\n\nå·¦å¤è¿æ¥å°±æ¯ä¿çå·¦è¡¨æ²¡æå³èçè¡ã\n\nselect customers.cust_id, orders.order_num\nfrom customers left join orders\non customers.cust_id = orders.cust_id;\n\n\n# å³è¿æ¥ï¼right joinï¼\n\nå³å¤è¿æ¥å°±æ¯ä¿çå³è¡¨æ²¡æå³èçè¡ã\n\nselect customers.cust_id, orders.order_num\nfrom customers right join orders\non customers.cust_id = orders.cust_id;\n\n\n\n# ç»åï¼unionï¼\n\n> union è¿ç®ç¬¦å°ä¸¤ä¸ªææ´å¤æ¥è¯¢çç»æç»åèµ·æ¥ï¼å¹¶çæä¸ä¸ªç»æéï¼å¶ä¸­åå«æ¥èª union ä¸­åä¸æ¥è¯¢çæåè¡ã\n\nunion åºæ¬è§åï¼\n\n * æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * æ¯ä¸ªæ¥è¯¢ä¸­æ¶åè¡¨çåçæ°æ®ç±»åå¿é¡»ç¸åæå¼å®¹ã\n * éå¸¸è¿åçåååèªç¬¬ä¸ä¸ªæ¥è¯¢ã\n\né»è®¤ä¼å»é¤ç¸åè¡ï¼å¦æéè¦ä¿çç¸åè¡ï¼ä½¿ç¨ union allã\n\nåªè½åå«ä¸ä¸ª order by å­å¥ï¼å¹¶ä¸å¿é¡»ä½äºè¯­å¥çæåã\n\nåºç¨åºæ¯ï¼\n\n * å¨ä¸ä¸ªæ¥è¯¢ä¸­ä»ä¸åçè¡¨è¿åç»ææ°æ®ã\n * å¯¹ä¸ä¸ªè¡¨æ§è¡å¤ä¸ªæ¥è¯¢ï¼æä¸ä¸ªæ¥è¯¢è¿åæ°æ®ã\n\nç»åæ¥è¯¢ç¤ºä¾ï¼\n\nselect cust_name, cust_contact, cust_email\nfrom customers\nwhere cust_state in ('il', 'in', 'mi')\nunion\nselect cust_name, cust_contact, cust_email\nfrom customers\nwhere cust_name = 'fun4all';\n\n\n\n# join vs union\n\n * join ä¸­è¿æ¥è¡¨çåå¯è½ä¸åï¼ä½å¨ union ä¸­ï¼æææ¥è¯¢çåæ°ååé¡ºåºå¿é¡»ç¸åã\n * union å°æ¥è¯¢ä¹åçè¡æ¾å¨ä¸èµ·ï¼åç´æ¾ç½®ï¼ï¼ä½ join å°æ¥è¯¢ä¹åçåæ¾å¨ä¸èµ·ï¼æ°´å¹³æ¾ç½®ï¼ï¼å³å®ææä¸ä¸ªç¬å¡å°ç§¯ã\n\n\n# äºãå½æ°\n\n> ð æ³¨æï¼ä¸åæ°æ®åºçå½æ°å¾å¾åä¸ç¸åï¼å æ­¤ä¸å¯ç§»æ¤ãæ¬èä¸»è¦ä»¥ mysql çå½æ°ä¸ºä¾ã\n\n\n# ææ¬å¤ç\n\nå½æ°                è¯´æ\nleft()ãright()    å·¦è¾¹æèå³è¾¹çå­ç¬¦\nlower()ãupper()   è½¬æ¢ä¸ºå°åæèå¤§å\nltrim()ãrtim()    å»é¤å·¦è¾¹æèå³è¾¹çç©ºæ ¼\nlength()          é¿åº¦\nsoundex()         è½¬æ¢ä¸ºè¯­é³å¼\n\nå¶ä¸­ï¼ soundex() å¯ä»¥å°ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å¶è¯­é³è¡¨ç¤ºçå­æ¯æ°å­æ¨¡å¼ã\n\nselect *\nfrom mytable\nwhere soundex(col1) = soundex('apple')\n\n\n\n# æ¥æåæ¶é´å¤ç\n\n * æ¥ææ ¼å¼ï¼yyyy-mm-dd\n * æ¶é´æ ¼å¼ï¼hh:mm:ss\n\nå½ æ°             è¯´ æ\nadddate()       å¢å ä¸ä¸ªæ¥æï¼å¤©ãå¨ç­ï¼\naddtime()       å¢å ä¸ä¸ªæ¶é´ï¼æ¶ãåç­ï¼\ncurdate()       è¿åå½åæ¥æ\ncurtime()       è¿åå½åæ¶é´\ndate()          è¿åæ¥ææ¶é´çæ¥æé¨å\ndatediff()      è®¡ç®ä¸¤ä¸ªæ¥æä¹å·®\ndate_add()      é«åº¦çµæ´»çæ¥æè¿ç®å½æ°\ndate_format()   è¿åä¸ä¸ªæ ¼å¼åçæ¥æææ¶é´ä¸²\nday()           è¿åä¸ä¸ªæ¥æçå¤©æ°é¨å\ndayofweek()     å¯¹äºä¸ä¸ªæ¥æï¼è¿åå¯¹åºçææå \nhour()          è¿åä¸ä¸ªæ¶é´çå°æ¶é¨å\nminute()        è¿åä¸ä¸ªæ¶é´çåéé¨å\nmonth()         è¿åä¸ä¸ªæ¥æçæä»½é¨å\nnow()           è¿åå½åæ¥æåæ¶é´\nsecond()        è¿åä¸ä¸ªæ¶é´çç§é¨å\ntime()          è¿åä¸ä¸ªæ¥ææ¶é´çæ¶é´é¨å\nyear()          è¿åä¸ä¸ªæ¥æçå¹´ä»½é¨å\n\nmysql> select now();\n\n\n2018-4-14 20:25:11\n\n\n\n# æ°å¼å¤ç\n\nå½æ°       è¯´æ\nsin()    æ­£å¼¦\ncos()    ä½å¼¦\ntan()    æ­£å\nabs()    ç»å¯¹å¼\nsqrt()   å¹³æ¹æ ¹\nmod()    ä½æ°\nexp()    ææ°\npi()     åå¨ç\nrand()   éæºæ°\n\n\n# æ±æ»\n\nå½ æ°       è¯´ æ\navg()     è¿åæåçå¹³åå¼\ncount()   è¿åæåçè¡æ°\nmax()     è¿åæåçæå¤§å¼\nmin()     è¿åæåçæå°å¼\nsum()     è¿åæåå¼ä¹å\n\navg() ä¼å¿½ç¥ null è¡ã\n\nä½¿ç¨ distinct å¯ä»¥è®©æ±æ»å½æ°å¼æ±æ»ä¸åçå¼ã\n\nselect avg(distinct col1) as avg_col\nfrom mytable\n\n\n\n# å­ãæåºååç»\n\n\n# order by\n\n> order by ç¨äºå¯¹ç»æéè¿è¡æåºã\n\norder by æä¸¤ç§æåºæ¨¡å¼ï¼\n\n * asc ï¼ååºï¼é»è®¤ï¼\n * desc ï¼éåº\n\nå¯ä»¥æå¤ä¸ªåè¿è¡æåºï¼å¹¶ä¸ä¸ºæ¯ä¸ªåæå®ä¸åçæåºæ¹å¼ã\n\næå®å¤ä¸ªåçæåºç¤ºä¾ï¼\n\nselect * from products\norder by prod_price desc, prod_name asc;\n\n\n\n# group by\n\n> group by å­å¥å°è®°å½åç»å°æ±æ»è¡ä¸­ï¼group by ä¸ºæ¯ä¸ªç»è¿åä¸ä¸ªè®°å½ã\n\ngroup by å¯ä»¥æä¸åæå¤åè¿è¡åç»ã\n\ngroup by éå¸¸è¿æ¶åèåå½æ°ï¼countï¼maxï¼sumï¼avg ç­ã\n\ngroup by æåç»å­æ®µè¿è¡æåºåï¼order by å¯ä»¥ä»¥æ±æ»å­æ®µæ¥è¿è¡æåºã\n\nåç»ç¤ºä¾ï¼\n\nselect cust_name, count(cust_address) as addr_num\nfrom customers group by cust_name;\n\n\nåç»åæåºç¤ºä¾ï¼\n\nselect cust_name, count(cust_address) as addr_num\nfrom customers group by cust_name\norder by cust_name desc;\n\n\n\n# having\n\n> having ç¨äºå¯¹æ±æ»ç group by ç»æè¿è¡è¿æ»¤ãhaving è¦æ±å­å¨ä¸ä¸ª group by å­å¥ã\n\nwhere å having å¯ä»¥å¨ç¸åçæ¥è¯¢ä¸­ã\n\nhaving vs whereï¼\n\n * where å having é½æ¯ç¨äºè¿æ»¤ã\n * having éç¨äºæ±æ»çç»è®°å½ï¼è where éç¨äºåä¸ªè®°å½ã\n\nä½¿ç¨ where å having è¿æ»¤æ°æ®ç¤ºä¾ï¼\n\nselect cust_name, count(*) as num\nfrom customers\nwhere cust_email is not null\ngroup by cust_name\nhaving count(*) >= 1;\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º ddl è¯­å¥ç¨æ³ï¼\n\n\n# ä¸ãæ°æ®å®ä¹\n\n> ddl çä¸»è¦åè½æ¯å®ä¹æ°æ®åºå¯¹è±¡ï¼å¦ï¼æ°æ®åºãæ°æ®è¡¨ãè§å¾ãç´¢å¼ç­ï¼ã\n\n\n# æ°æ®åºï¼databaseï¼\n\n# åå»ºæ°æ®åº\n\ncreate database test;\n\n\n# å é¤æ°æ®åº\n\ndrop database test;\n\n\n# éæ©æ°æ®åº\n\nuse test;\n\n\n\n# æ°æ®è¡¨ï¼tableï¼\n\n# åå»ºæ°æ®è¡¨\n\næ®éåå»º\n\ncreate table user (\n  id int(10) unsigned not null comment 'id',\n  username varchar(64) not null default 'default' comment 'ç¨æ·å',\n  password varchar(64) not null default 'default' comment 'å¯ç ',\n  email varchar(64) not null default 'default' comment 'é®ç®±'\n) comment='ç¨æ·è¡¨';\n\n\næ ¹æ®å·²æçè¡¨åå»ºæ°è¡¨\n\ncreate table vip_user as\nselect * from user;\n\n\n# å é¤æ°æ®è¡¨\n\ndrop table user;\n\n\n# ä¿®æ¹æ°æ®è¡¨\n\næ·»å å\n\nalter table user\nadd age int(3);\n\n\nå é¤å\n\nalter table user\ndrop column age;\n\n\nä¿®æ¹å\n\nalter table `user`\nmodify column age tinyint;\n\n\næ·»å ä¸»é®\n\nalter table user\nadd primary key (id);\n\n\nå é¤ä¸»é®\n\nalter table user\ndrop primary key;\n\n\n\n# è§å¾ï¼viewï¼\n\n> è§å¾æ¯åºäº sql è¯­å¥çç»æéçå¯è§åçè¡¨ãè§å¾æ¯èæçè¡¨ï¼æ¬èº«ä¸å­å¨æ°æ®ï¼ä¹å°±ä¸è½å¯¹å¶è¿è¡ç´¢å¼æä½ãå¯¹è§å¾çæä½åå¯¹æ®éè¡¨çæä½ä¸æ ·ã\n\nè§å¾çä½ç¨ï¼\n\n * ç®åå¤æç sql æä½ï¼æ¯å¦å¤æçè¿æ¥ã\n * åªä½¿ç¨å®éè¡¨çä¸é¨åæ°æ®ã\n * éè¿åªç»ç¨æ·è®¿é®è§å¾çæéï¼ä¿è¯æ°æ®çå®å¨æ§ã\n * æ´æ¹æ°æ®æ ¼å¼åè¡¨ç¤ºã\n\n# åå»ºè§å¾\n\ncreate view top_10_user_view as\nselect id, username\nfrom user\nwhere id < 10;\n\n\n# å é¤è§å¾\n\ndrop view top_10_user_view;\n\n\n\n# ç´¢å¼ï¼indexï¼\n\n> éè¿ç´¢å¼å¯ä»¥æ´å å¿«éé«æå°æ¥è¯¢æ°æ®ãç¨æ·æ æ³çå°ç´¢å¼ï¼å®ä»¬åªè½è¢«ç¨æ¥å éæ¥è¯¢ã\n\næ´æ°ä¸ä¸ªåå«ç´¢å¼çè¡¨éè¦æ¯æ´æ°ä¸ä¸ªæ²¡æç´¢å¼çè¡¨è±è´¹æ´å¤çæ¶é´ï¼è¿æ¯ç±äºç´¢å¼æ¬èº«ä¹éè¦æ´æ°ãå æ­¤ï¼çæ³çåæ³æ¯ä»ä»å¨å¸¸å¸¸è¢«æç´¢çåï¼ä»¥åè¡¨ï¼ä¸é¢åå»ºç´¢å¼ã\n\nå¯ä¸ç´¢å¼ï¼å¯ä¸ç´¢å¼è¡¨ææ­¤ç´¢å¼çæ¯ä¸ä¸ªç´¢å¼å¼åªå¯¹åºå¯ä¸çæ°æ®è®°å½ã\n\n# åå»ºç´¢å¼\n\ncreate index user_index\non user (id);\n\n\n# åå»ºå¯ä¸ç´¢å¼\n\ncreate unique index user_index\non user (id);\n\n\n# å é¤ç´¢å¼\n\nalter table user\ndrop index user_index;\n\n\n\n# çº¦æ\n\n> sql çº¦æç¨äºè§å®è¡¨ä¸­çæ°æ®è§åã\n\n * å¦æå­å¨è¿åçº¦æçæ°æ®è¡ä¸ºï¼è¡ä¸ºä¼è¢«çº¦æç»æ­¢ã\n * çº¦æå¯ä»¥å¨åå»ºè¡¨æ¶è§å®ï¼éè¿ create table è¯­å¥ï¼ï¼æèå¨è¡¨åå»ºä¹åè§å®ï¼éè¿ alter table è¯­å¥ï¼ã\n * çº¦æç±»å\n   * not null - æç¤ºæåä¸è½å­å¨ null å¼ã\n   * unique - ä¿è¯æåçæ¯è¡å¿é¡»æå¯ä¸çå¼ã\n   * primary key - not null å unique çç»åãç¡®ä¿æåï¼æä¸¤ä¸ªåå¤ä¸ªåçç»åï¼æå¯ä¸æ è¯ï¼æå©äºæ´å®¹ææ´å¿«éå°æ¾å°è¡¨ä¸­çä¸ä¸ªç¹å®çè®°å½ã\n   * foreign key - ä¿è¯ä¸ä¸ªè¡¨ä¸­çæ°æ®å¹éå¦ä¸ä¸ªè¡¨ä¸­çå¼çåç§å®æ´æ§ã\n   * check - ä¿è¯åä¸­çå¼ç¬¦åæå®çæ¡ä»¶ã\n   * default - è§å®æ²¡æç»åèµå¼æ¶çé»è®¤å¼ã\n\nåå»ºè¡¨æ¶ä½¿ç¨çº¦ææ¡ä»¶ï¼\n\ncreate table users (\n  id int(10) unsigned not null auto_increment comment 'èªå¢id',\n  username varchar(64) not null unique default 'default' comment 'ç¨æ·å',\n  password varchar(64) not null default 'default' comment 'å¯ç ',\n  email varchar(64) not null default 'default' comment 'é®ç®±å°å',\n  enabled tinyint(4) default null comment 'æ¯å¦ææ',\n  primary key (id)\n) engine=innodb auto_increment=2 default charset=utf8mb4 comment='ç¨æ·è¡¨';\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º tcl è¯­å¥ç¨æ³ï¼\n\n\n# å«ãäºå¡å¤ç\n\nä¸è½åé select è¯­å¥ï¼åé select è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé create å drop è¯­å¥ã\n\nmysql é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ï¼æ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° start transaction è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ commit æ rollback è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\näºå¡å¤çæä»¤ï¼\n\n * start transaction - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * savepoint - æä»¤ç¨äºåå»ºä¿çç¹ã\n * rollback to - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° start transaction è¯­å¥å¤ã\n * commit - æäº¤äºå¡ã\n\näºå¡å¤çç¤ºä¾ï¼\n\n-- å¼å§äºå¡\nstart transaction;\n\n-- æå¥æä½ a\ninsert into `user`\nvalues (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updatea\nsavepoint updatea;\n\n-- æå¥æä½ b\ninsert into `user`\nvalues (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updatea\nrollback to updatea;\n\n-- æäº¤äºå¡ï¼åªææä½ a çæ\ncommit;\n\n\n----------------------------------------\n\nï¼ä»¥ä¸ä¸º dcl è¯­å¥ç¨æ³ï¼\n\n\n# ä¹ãæéæ§å¶\n\ngrant å revoke å¯å¨å ä¸ªå±æ¬¡ä¸æ§å¶è®¿é®æéï¼\n\n * æ´ä¸ªæå¡å¨ï¼ä½¿ç¨ grant all å revoke allï¼\n * æ´ä¸ªæ°æ®åºï¼ä½¿ç¨ on database.*ï¼\n * ç¹å®çè¡¨ï¼ä½¿ç¨ on database.tableï¼\n * ç¹å®çåï¼\n * ç¹å®çå­å¨è¿ç¨ã\n\næ°åå»ºçè´¦æ·æ²¡æä»»ä½æéã\n\nè´¦æ·ç¨ username@host çå½¢å¼å®ä¹ï¼username@% ä½¿ç¨çæ¯é»è®¤ä¸»æºåã\n\nmysql çè´¦æ·ä¿¡æ¯ä¿å­å¨ mysql è¿ä¸ªæ°æ®åºä¸­ã\n\nuse mysql;\nselect user from user;\n\n\n\n# åå»ºè´¦æ·\n\ncreate user myuser identified by 'mypassword';\n\n\n\n# ä¿®æ¹è´¦æ·å\n\nupdate user set user='newuser' where user='myuser';\nflush privileges;\n\n\n\n# å é¤è´¦æ·\n\ndrop user myuser;\n\n\n\n# æ¥çæé\n\nshow grants for myuser;\n\n\n\n# æäºæé\n\ngrant select, insert on *.* to myuser;\n\n\n\n# å é¤æé\n\nrevoke select, insert on *.* from myuser;\n\n\n\n# æ´æ¹å¯ç \n\nset password for myuser = 'mypass';\n\n\n\n# åãå­å¨è¿ç¨åæ¸¸æ \n\n> å­å¨è¿ç¨å¯ä»¥çææ¯å¯¹ä¸ç³»å sql æä½çæ¹å¤çï¼ä¿å­å¨æ°æ®åºä¸­ãå®å°±åæä»¬ç¼ç¨è¯­è¨ä¸­çå½æ°ä¸æ ·ï¼å°è£äºæä»¬çä»£ç (plsqlãt-sql)ã\n\n\n# å­å¨è¿ç¨ä¼ç¼ºç¹\n\nå­å¨è¿ç¨çä¼ç¹ï¼\n\n * ä»£ç å°è£ï¼ä¿è¯äºä¸å®çå®å¨æ§ã\n * è®©ç¼ç¨è¯­è¨è¿è¡è°ç¨ï¼æé«ä»£ç å¤ç¨ã\n * ç±äºæ¯é¢åç¼è¯ï¼å æ­¤å·æå¾é«çæ§è½ã\n * ä¸ä¸ªå­å¨è¿ç¨æ¿ä»£å¤§é t_sql è¯­å¥ ï¼å¯ä»¥éä½ç½ç»éä¿¡éï¼æé«éä¿¡éçã\n\nå­å¨è¿ç¨çç¼ºç¹ï¼\n\n * ç±äºä¸åæ°æ®åºçå­å¨è¿ç¨è¯­æ³å ä¹é½ä¸ä¸æ ·ï¼ååé¾ä»¥ç»´æ¤ï¼ä¸éç¨ï¼ã\n * ä¸å¡é»è¾æ¾å¨æ°æ®åºä¸ï¼é¾ä»¥è¿­ä»£ã\n\n\n# ä½¿ç¨å­å¨è¿ç¨\n\nåå»ºå­å¨è¿ç¨çè¦ç¹ï¼\n\n * å½ä»¤è¡ä¸­åå»ºå­å¨è¿ç¨éè¦èªå®ä¹åéç¬¦ï¼å ä¸ºå½ä»¤è¡æ¯ä»¥ ; ä¸ºç»æç¬¦ï¼èå­å¨è¿ç¨ä¸­ä¹åå«äºåå·ï¼å æ­¤ä¼éè¯¯æè¿é¨ååå·å½ææ¯ç»æç¬¦ï¼é æè¯­æ³éè¯¯ã\n * åå« inãout å inout ä¸ç§åæ°ã\n * ç»åéèµå¼é½éè¦ç¨ select into è¯­å¥ã\n * æ¯æ¬¡åªè½ç»ä¸ä¸ªåéèµå¼ï¼ä¸æ¯æéåçæä½ã\n\nåå»ºå­å¨è¿ç¨ç¤ºä¾ï¼\n\ndrop procedure if exists `proc_adder`;\ndelimiter ;;\ncreate definer=`root`@`localhost` procedure `proc_adder`(in a int, in b int, out sum int)\nbegin\n    declare c int;\n    if a is null then set a = 0;\n    end if;\n\n    if b is null then set b = 0;\n    end if;\n\n    set sum  = a + b;\nend\n;;\ndelimiter ;\n\n\nä½¿ç¨å­å¨è¿ç¨ç¤ºä¾ï¼\n\nset @b=5;\ncall proc_adder(2,@b,@s);\nselect @s as sum;\n\n\n\n# æ¸¸æ \n\n> æ¸¸æ ï¼cursorï¼æ¯ä¸ä¸ªå­å¨å¨ dbms æå¡å¨ä¸çæ°æ®åºæ¥è¯¢ï¼å®ä¸æ¯ä¸æ¡ select è¯­å¥ï¼èæ¯è¢«è¯¥è¯­å¥æ£ç´¢åºæ¥çç»æéãå¨å­å¨è¿ç¨ä¸­ä½¿ç¨æ¸¸æ å¯ä»¥å¯¹ä¸ä¸ªç»æéè¿è¡ç§»å¨éåã\n\næ¸¸æ ä¸»è¦ç¨äºäº¤äºå¼åºç¨ï¼å¶ä¸­ç¨æ·éè¦å¯¹æ°æ®éä¸­çä»»æè¡è¿è¡æµè§åä¿®æ¹ã\n\nä½¿ç¨æ¸¸æ çåä¸ªæ­¥éª¤ï¼\n\n 1. å£°ææ¸¸æ ï¼è¿ä¸ªè¿ç¨æ²¡æå®éæ£ç´¢åºæ°æ®ï¼\n 2. æå¼æ¸¸æ ï¼\n 3. ååºæ°æ®ï¼\n 4. å³é­æ¸¸æ ï¼\n\næ¸¸æ ä½¿ç¨ç¤ºä¾ï¼\n\ndelimiter $\ncreate procedure gettotal()\nbegin\n    declare total int;\n    -- åå»ºæ¥æ¶æ¸¸æ æ°æ®çåé\n    declare sid int;\n    declare sname varchar(10);\n    -- åå»ºæ»æ°åé\n    declare sage int;\n    -- åå»ºç»ææ å¿åé\n    declare done int default false;\n    -- åå»ºæ¸¸æ \n    declare cur cursor for select id,name,age from cursor_table where age>30;\n    -- æå®æ¸¸æ å¾ªç¯ç»ææ¶çè¿åå¼\n    declare continue handler for not found set done = true;\n    set total = 0;\n    open cur;\n    fetch cur into sid, sname, sage;\n    while(not done)\n    do\n        set total = total + 1;\n        fetch cur into sid, sname, sage;\n    end while;\n\n    close cur;\n    select total;\nend $\ndelimiter ;\n\n-- è°ç¨å­å¨è¿ç¨\ncall gettotal();\n\n\n\n# è§¦åå¨\n\n> è§¦åå¨å¯ä»¥è§ä¸ºä¸ç§ç¹æ®çå­å¨è¿ç¨ã\n> \n> è§¦åå¨æ¯ä¸ç§ä¸è¡¨æä½æå³çæ°æ®åºå¯¹è±¡ï¼å½è§¦åå¨æå¨è¡¨ä¸åºç°æå®äºä»¶æ¶ï¼å°è°ç¨è¯¥å¯¹è±¡ï¼å³è¡¨çæä½äºä»¶è§¦åè¡¨ä¸çè§¦åå¨çæ§è¡ã\n\n# è§¦åå¨ç¹æ§\n\nå¯ä»¥ä½¿ç¨è§¦åå¨æ¥è¿è¡å®¡è®¡è·è¸ªï¼æä¿®æ¹è®°å½å°å¦å¤ä¸å¼ è¡¨ä¸­ã\n\nmysql ä¸åè®¸å¨è§¦åå¨ä¸­ä½¿ç¨ call è¯­å¥ ï¼ä¹å°±æ¯ä¸è½è°ç¨å­å¨è¿ç¨ã\n\nbegin å end\n\nå½è§¦åå¨çè§¦åæ¡ä»¶æ»¡è¶³æ¶ï¼å°ä¼æ§è¡ begin å end ä¹é´çè§¦åå¨æ§è¡å¨ä½ã\n\n> ð æ³¨æï¼å¨ mysql ä¸­ï¼åå· ; æ¯è¯­å¥ç»æçæ è¯ç¬¦ï¼éå°åå·è¡¨ç¤ºè¯¥æ®µè¯­å¥å·²ç»ç»æï¼mysql å¯ä»¥å¼å§æ§è¡äºãå æ­¤ï¼è§£éå¨éå°è§¦åå¨æ§è¡å¨ä½ä¸­çåå·åå°±å¼å§æ§è¡ï¼ç¶åä¼æ¥éï¼å ä¸ºæ²¡ææ¾å°å begin å¹éç endã\n> \n> è¿æ¶å°±ä¼ç¨å° delimiter å½ä»¤ï¼delimiter æ¯å®çç¬¦ï¼åéç¬¦çææï¼ãå®æ¯ä¸æ¡å½ä»¤ï¼ä¸éè¦è¯­å¥ç»ææ è¯ï¼è¯­æ³ä¸ºï¼delimiter new_delemiterãnew_delemiter å¯ä»¥è®¾ä¸º 1 ä¸ªæå¤ä¸ªé¿åº¦çç¬¦å·ï¼é»è®¤çæ¯åå· ;ï¼æä»¬å¯ä»¥æå®ä¿®æ¹ä¸ºå¶ä»ç¬¦å·ï¼å¦ $ - delimiter $ ãå¨è¿ä¹åçè¯­å¥ï¼ä»¥åå·ç»æï¼è§£éå¨ä¸ä¼æä»ä¹ååºï¼åªæéå°äº $ï¼æè®¤ä¸ºæ¯è¯­å¥ç»æãæ³¨æï¼ä½¿ç¨å®ä¹åï¼æä»¬è¿åºè¯¥è®°å¾æå®ç»ä¿®æ¹åæ¥ã\n\nnew å old\n\n * mysql ä¸­å®ä¹äº new å old å³é®å­ï¼ç¨æ¥è¡¨ç¤ºè§¦åå¨çæå¨è¡¨ä¸­ï¼è§¦åäºè§¦åå¨çé£ä¸è¡æ°æ®ã\n * å¨ insert åè§¦åå¨ä¸­ï¼new ç¨æ¥è¡¨ç¤ºå°è¦ï¼beforeï¼æå·²ç»ï¼afterï¼æå¥çæ°æ°æ®ï¼\n * å¨ update åè§¦åå¨ä¸­ï¼old ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«ä¿®æ¹çåæ°æ®ï¼new ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»ä¿®æ¹ä¸ºçæ°æ°æ®ï¼\n * å¨ delete åè§¦åå¨ä¸­ï¼old ç¨æ¥è¡¨ç¤ºå°è¦æå·²ç»è¢«å é¤çåæ°æ®ï¼\n * ä½¿ç¨æ¹æ³ï¼ new.columnname ï¼columnname ä¸ºç¸åºæ°æ®è¡¨æä¸ååï¼\n\n# è§¦åå¨æä»¤\n\n> æç¤ºï¼ä¸ºäºçè§£è§¦åå¨çè¦ç¹ï¼æå¿è¦åäºè§£ä¸ä¸åå»ºè§¦åå¨çæä»¤ã\n\ncreate trigger æä»¤ç¨äºåå»ºè§¦åå¨ã\n\nè¯­æ³ï¼\n\ncreate trigger trigger_name\ntrigger_time\ntrigger_event\non table_name\nfor each row\nbegin\n  trigger_statements\nend;\n\n\nè¯´æï¼\n\n * trigger_nameï¼è§¦åå¨å\n * trigger_time: è§¦åå¨çè§¦åæ¶æºãåå¼ä¸º before æ afterã\n * trigger_event: è§¦åå¨ççå¬äºä»¶ãåå¼ä¸º insertãupdate æ deleteã\n * table_name: è§¦åå¨ççå¬ç®æ ãæå®å¨åªå¼ è¡¨ä¸å»ºç«è§¦åå¨ã\n * for each row: è¡çº§çè§ï¼mysql åºå®åæ³ï¼å¶ä» dbms ä¸åã\n * trigger_statements: è§¦åå¨æ§è¡å¨ä½ãæ¯ä¸æ¡æå¤æ¡ sql è¯­å¥çåè¡¨ï¼åè¡¨åçæ¯æ¡è¯­å¥é½å¿é¡»ç¨åå· ; æ¥ç»å°¾ã\n\nåå»ºè§¦åå¨ç¤ºä¾ï¼\n\ndelimiter $\ncreate trigger `trigger_insert_user`\nafter insert on `user`\nfor each row\nbegin\n    insert into `user_history`(user_id, operate_type, operate_time)\n    values (new.id, 'add a user',  now());\nend $\ndelimiter ;\n\n\næ¥çè§¦åå¨ç¤ºä¾ï¼\n\nshow triggers;\n\n\nå é¤è§¦åå¨ç¤ºä¾ï¼\n\ndrop trigger if exists trigger_insert_user;\n\n\n\n# åèèµæ\n\n * ãsql å¿ç¥å¿ä¼ã\n * ãæµå¥æ·±åºãmysql ä¸­äºå¡çå®ç°\n * mysql çå­¦ä¹ --è§¦åå¨\n * ç»´åºç¾ç§è¯æ¡ - sql\n * https://www.sitesbay.com/sql/index\n * sql subqueries\n * quick breakdown of the types of joins\n * sql union\n * sql database security\n * mysql ä¸­çå­å¨è¿ç¨",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"æ©å± SQL",frontmatter:{title:"æ©å± SQL",date:"2020-10-10T19:03:05.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQL"],permalink:"/pages/0f3524/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/03.%E6%89%A9%E5%B1%95SQL.html",relativePath:"03.å³ç³»åæ°æ®åº/01.ç»¼å/03.æ©å±SQL.md",key:"v-5e14aa88",path:"/pages/0f3524/",headers:[{level:2,title:"æ°æ®åº",slug:"æ°æ®åº",normalizedTitle:"æ°æ®åº",charIndex:66},{level:2,title:"è¡¨",slug:"è¡¨",normalizedTitle:"è¡¨",charIndex:74},{level:3,title:"æ¥çè¡¨çåºæ¬ä¿¡æ¯",slug:"æ¥çè¡¨çåºæ¬ä¿¡æ¯",normalizedTitle:"æ¥çè¡¨çåºæ¬ä¿¡æ¯",charIndex:80},{level:3,title:"æ¥çè¡¨çåä¿¡æ¯",slug:"æ¥çè¡¨çåä¿¡æ¯",normalizedTitle:"æ¥çè¡¨çåä¿¡æ¯",charIndex:188},{level:3,title:"å¦ä½æ¹éå é¤å¤§éæ°æ®",slug:"å¦ä½æ¹éå é¤å¤§éæ°æ®",normalizedTitle:"å¦ä½æ¹éå é¤å¤§éæ°æ®",charIndex:296},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:688}],headersStr:"æ°æ®åº è¡¨ æ¥çè¡¨çåºæ¬ä¿¡æ¯ æ¥çè¡¨çåä¿¡æ¯ å¦ä½æ¹éå é¤å¤§éæ°æ® åèèµæ",content:"# æ©å± SQL\n\n> ä¸åäº SQL Cheat Sheet ä¸­çä¸è¬è¯­æ³ï¼æ¬æä¸»è¦æ´çæ¶éä¸äºé«çº§ä½æ¯å¾æç¨ç SQL\n\n\n# æ°æ®åº\n\n\n# è¡¨\n\n\n# æ¥çè¡¨çåºæ¬ä¿¡æ¯\n\nSELECT * FROM information_schema.tables\nWHERE table_schema = 'test' AND table_name = 'user';\n\n\n\n# æ¥çè¡¨çåä¿¡æ¯\n\nSELECT * FROM information_schema.columns\nWHERE table_schema = 'test' AND table_name = 'user';\n\n\n\n# å¦ä½æ¹éå é¤å¤§éæ°æ®\n\nå¦æè¦æ ¹æ®æ¶é´èå´æ¹éå é¤å¤§éæ°æ®ï¼æç®åçè¯­å¥å¦ä¸ï¼\n\ndelete from orders\nwhere timestamp < SUBDATE(CURDATE(),INTERVAL 3 month);\n\n\nä¸é¢çè¯­å¥ï¼å¤§æ¦çæ§è¡ä¼æ¥éï¼æç¤ºå é¤å¤±è´¥ï¼å ä¸ºéè¦å é¤çæ°æ®éå¤ªå¤§äºï¼æä»¥éè¦åæ¹å é¤ã\n\nå¯ä»¥åéè¿ä¸æ¬¡æ¥è¯¢ï¼æ¾å°ç¬¦åæ¡ä»¶çåå²è®¢åä¸­æå¤§çé£ä¸ªè®¢å IDï¼ç¶åå¨å é¤è¯­å¥ä¸­æå é¤çæ¡ä»¶è½¬æ¢ææä¸»é®å é¤ã\n\nselect max(id) from orders\nwhere timestamp < SUBDATE(CURDATE(),INTERVAL 3 month);\n\n-- åæ¹å é¤ï¼? å¡«ä¸ä¸æ¡è¯­å¥æ¥å°çæå¤§ ID\ndelete from orders\nwhere id <= ?\norder by id limit 1000;\n\n\n\n# åèèµæ\n\n * ãSQL å¿ç¥å¿ä¼ã",normalizedContent:"# æ©å± sql\n\n> ä¸åäº sql cheat sheet ä¸­çä¸è¬è¯­æ³ï¼æ¬æä¸»è¦æ´çæ¶éä¸äºé«çº§ä½æ¯å¾æç¨ç sql\n\n\n# æ°æ®åº\n\n\n# è¡¨\n\n\n# æ¥çè¡¨çåºæ¬ä¿¡æ¯\n\nselect * from information_schema.tables\nwhere table_schema = 'test' and table_name = 'user';\n\n\n\n# æ¥çè¡¨çåä¿¡æ¯\n\nselect * from information_schema.columns\nwhere table_schema = 'test' and table_name = 'user';\n\n\n\n# å¦ä½æ¹éå é¤å¤§éæ°æ®\n\nå¦æè¦æ ¹æ®æ¶é´èå´æ¹éå é¤å¤§éæ°æ®ï¼æç®åçè¯­å¥å¦ä¸ï¼\n\ndelete from orders\nwhere timestamp < subdate(curdate(),interval 3 month);\n\n\nä¸é¢çè¯­å¥ï¼å¤§æ¦çæ§è¡ä¼æ¥éï¼æç¤ºå é¤å¤±è´¥ï¼å ä¸ºéè¦å é¤çæ°æ®éå¤ªå¤§äºï¼æä»¥éè¦åæ¹å é¤ã\n\nå¯ä»¥åéè¿ä¸æ¬¡æ¥è¯¢ï¼æ¾å°ç¬¦åæ¡ä»¶çåå²è®¢åä¸­æå¤§çé£ä¸ªè®¢å idï¼ç¶åå¨å é¤è¯­å¥ä¸­æå é¤çæ¡ä»¶è½¬æ¢ææä¸»é®å é¤ã\n\nselect max(id) from orders\nwhere timestamp < subdate(curdate(),interval 3 month);\n\n-- åæ¹å é¤ï¼? å¡«ä¸ä¸æ¡è¯­å¥æ¥å°çæå¤§ id\ndelete from orders\nwhere id <= ?\norder by id limit 1000;\n\n\n\n# åèèµæ\n\n * ãsql å¿ç¥å¿ä¼ã",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"å³ç³»åæ°æ®åºç»¼åç¥è¯",frontmatter:{title:"å³ç³»åæ°æ®åºç»¼åç¥è¯",date:"2020-07-16T11:14:07.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/1e2ee7/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/01.%E7%BB%BC%E5%90%88/",relativePath:"03.å³ç³»åæ°æ®åº/01.ç»¼å/README.md",key:"v-04da5df4",path:"/pages/1e2ee7/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:17},{level:3,title:"å³ç³»åæ°æ®åºé¢è¯é¢ ð¯",slug:"å³ç³»åæ°æ®åºé¢è¯é¢-ð¯",normalizedTitle:"å³ç³»åæ°æ®åºé¢è¯é¢ ð¯",charIndex:27},{level:3,title:"SQL Cheat Sheet",slug:"sql-cheat-sheet",normalizedTitle:"sql cheat sheet",charIndex:44},{level:3,title:"åå¸å¼å­å¨åºæ¬åç",slug:"åå¸å¼å­å¨åºæ¬åç",normalizedTitle:"åå¸å¼å­å¨åºæ¬åç",charIndex:66},{level:3,title:"åå¸å¼äºå¡åºæ¬åç",slug:"åå¸å¼äºå¡åºæ¬åç",normalizedTitle:"åå¸å¼äºå¡åºæ¬åç",charIndex:82},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:96},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:316}],headersStr:"ð åå®¹ å³ç³»åæ°æ®åºé¢è¯é¢ ð¯ SQL Cheat Sheet åå¸å¼å­å¨åºæ¬åç åå¸å¼äºå¡åºæ¬åç ð èµæ ðª ä¼ é",content:"# å³ç³»åæ°æ®åºç»¼åç¥è¯\n\n\n# ð åå®¹\n\n\n# å³ç³»åæ°æ®åºé¢è¯é¢ ð¯\n\n\n# SQL Cheat Sheet\n\n\n\n\n# åå¸å¼å­å¨åºæ¬åç\n\n\n\n\n# åå¸å¼äºå¡åºæ¬åç\n\n\n# ð èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * Mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - Mysql ç»å¸\n   * ãSQL å¿ç¥å¿ä¼ã - SQL å¥é¨\n * æç¨\n   * runoob.com MySQL æç¨ - å¥é¨çº§ SQL æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# å³ç³»åæ°æ®åºç»¼åç¥è¯\n\n\n# ð åå®¹\n\n\n# å³ç³»åæ°æ®åºé¢è¯é¢ ð¯\n\n\n# sql cheat sheet\n\n\n\n\n# åå¸å¼å­å¨åºæ¬åç\n\n\n\n\n# åå¸å¼äºå¡åºæ¬åç\n\n\n# ð èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - mysql ç»å¸\n   * ãsql å¿ç¥å¿ä¼ã - sql å¥é¨\n * æç¨\n   * runoob.com mysql æç¨ - å¥é¨çº§ sql æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql åºç¨æå",frontmatter:{title:"Mysql åºç¨æå",date:"2020-07-13T10:08:37.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],permalink:"/pages/0b2452/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/01.Mysql%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/01.Mysqlåºç¨æå.md",key:"v-6d3cde8c",path:"/pages/0b2452/",headers:[{level:2,title:"1. SQL æ§è¡è¿ç¨",slug:"_1-sql-æ§è¡è¿ç¨",normalizedTitle:"1. sql æ§è¡è¿ç¨",charIndex:17},{level:2,title:"2. å­å¨å¼æ",slug:"_2-å­å¨å¼æ",normalizedTitle:"2. å­å¨å¼æ",charIndex:82},{level:3,title:"2.1. éæ©å­å¨å¼æ",slug:"_2-1-éæ©å­å¨å¼æ",normalizedTitle:"2.1. éæ©å­å¨å¼æ",charIndex:313},{level:4,title:"Mysql åç½®çå­å¨å¼æ",slug:"mysql-åç½®çå­å¨å¼æ",normalizedTitle:"mysql åç½®çå­å¨å¼æ",charIndex:328},{level:4,title:"å¦ä½éæ©åéçå­å¨å¼æ",slug:"å¦ä½éæ©åéçå­å¨å¼æ",normalizedTitle:"å¦ä½éæ©åéçå­å¨å¼æ",charIndex:2358},{level:4,title:"è½¬æ¢è¡¨çå­å¨å¼æ",slug:"è½¬æ¢è¡¨çå­å¨å¼æ",normalizedTitle:"è½¬æ¢è¡¨çå­å¨å¼æ",charIndex:2787},{level:3,title:"2.2. MyISAM",slug:"_2-2-myisam",normalizedTitle:"2.2. myisam",charIndex:2871},{level:3,title:"2.3. InnoDB",slug:"_2-3-innodb",normalizedTitle:"2.3. innodb",charIndex:3078},{level:2,title:"3. æ°æ®ç±»å",slug:"_3-æ°æ®ç±»å",normalizedTitle:"3. æ°æ®ç±»å",charIndex:3653},{level:3,title:"3.1. æ´å",slug:"_3-1-æ´å",normalizedTitle:"3.1. æ´å",charIndex:3665},{level:3,title:"3.2. æµ®ç¹å",slug:"_3-2-æµ®ç¹å",normalizedTitle:"3.2. æµ®ç¹å",charIndex:3843},{level:3,title:"3.3. å­ç¬¦ä¸²",slug:"_3-3-å­ç¬¦ä¸²",normalizedTitle:"3.3. å­ç¬¦ä¸²",charIndex:4063},{level:3,title:"3.4. æ¶é´åæ¥æ",slug:"_3-4-æ¶é´åæ¥æ",normalizedTitle:"3.4. æ¶é´åæ¥æ",charIndex:4279},{level:4,title:"DATATIME",slug:"datatime",normalizedTitle:"datatime",charIndex:4312},{level:4,title:"TIMESTAMP",slug:"timestamp",normalizedTitle:"timestamp",charIndex:4323},{level:3,title:"3.5. BLOB å TEXT",slug:"_3-5-blob-å-text",normalizedTitle:"3.5. blob å text",charIndex:4796},{level:3,title:"3.6. æä¸¾ç±»å",slug:"_3-6-æä¸¾ç±»å",normalizedTitle:"3.6. æä¸¾ç±»å",charIndex:4898},{level:3,title:"3.7. ç±»åçéæ©",slug:"_3-7-ç±»åçéæ©",normalizedTitle:"3.7. ç±»åçéæ©",charIndex:5006},{level:2,title:"4. ç´¢å¼",slug:"_4-ç´¢å¼",normalizedTitle:"4. ç´¢å¼",charIndex:5346},{level:2,title:"5. é",slug:"_5-é",normalizedTitle:"5. é",charIndex:5371},{level:2,title:"6. äºå¡",slug:"_6-äºå¡",normalizedTitle:"6. äºå¡",charIndex:5394},{level:2,title:"7. æ§è½ä¼å",slug:"_7-æ§è½ä¼å",normalizedTitle:"7. æ§è½ä¼å",charIndex:5419},{level:2,title:"8. å¤å¶",slug:"_8-å¤å¶",normalizedTitle:"8. å¤å¶",charIndex:5448},{level:3,title:"8.1. ä¸»ä»å¤å¶",slug:"_8-1-ä¸»ä»å¤å¶",normalizedTitle:"8.1. ä¸»ä»å¤å¶",charIndex:5458},{level:3,title:"8.2. è¯»ååç¦»",slug:"_8-2-è¯»ååç¦»",normalizedTitle:"8.2. è¯»ååç¦»",charIndex:5738},{level:2,title:'<img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/mysql/master-slave-proxy.png" />',slug:"div-align-center-img-src-https-raw-githubusercontent-com-dunwu-images-dev-cs-database-mysql-master-slave-proxy-png-div",normalizedTitle:'<img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/mysql/master-slave-proxy.png" />',charIndex:null},{level:2,title:"9. åå¸å¼äºå¡",slug:"_9-åå¸å¼äºå¡",normalizedTitle:"9. åå¸å¼äºå¡",charIndex:5979},{level:2,title:"10. ååºåè¡¨",slug:"_10-ååºåè¡¨",normalizedTitle:"10. ååºåè¡¨",charIndex:6008},{level:2,title:"11. åèèµæ",slug:"_11-åèèµæ",normalizedTitle:"11. åèèµæ",charIndex:6037},{level:2,title:"12. ä¼ éé¨",slug:"_12-ä¼ éé¨",normalizedTitle:"12. ä¼ éé¨",charIndex:6183}],headersStr:'1. SQL æ§è¡è¿ç¨ 2. å­å¨å¼æ 2.1. éæ©å­å¨å¼æ Mysql åç½®çå­å¨å¼æ å¦ä½éæ©åéçå­å¨å¼æ è½¬æ¢è¡¨çå­å¨å¼æ 2.2. MyISAM 2.3. InnoDB 3. æ°æ®ç±»å 3.1. æ´å 3.2. æµ®ç¹å 3.3. å­ç¬¦ä¸² 3.4. æ¶é´åæ¥æ DATATIME TIMESTAMP 3.5. BLOB å TEXT 3.6. æä¸¾ç±»å 3.7. ç±»åçéæ© 4. ç´¢å¼ 5. é 6. äºå¡ 7. æ§è½ä¼å 8. å¤å¶ 8.1. ä¸»ä»å¤å¶ 8.2. è¯»ååç¦» <img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/database/mysql/master-slave-proxy.png" /> 9. åå¸å¼äºå¡ 10. ååºåè¡¨ 11. åèèµæ 12. ä¼ éé¨',content:"# Mysql åºç¨æå\n\n\n# 1. SQL æ§è¡è¿ç¨\n\nå­¦ä¹  Mysqlï¼æå¥½æ¯åä»å®è§ä¸äºè§£ Mysql å·¥ä½åçã\n\n> åèï¼Mysql å·¥ä½æµ\n\n\n# 2. å­å¨å¼æ\n\nå¨æä»¶ç³»ç»ä¸­ï¼Mysql å°æ¯ä¸ªæ°æ®åºï¼ä¹å¯ä»¥æä¸º schemaï¼ä¿å­ä¸ºæ°æ®ç®å½ä¸çä¸ä¸ªå­ç®å½ãåå»ºè¡¨ç¤ºï¼Mysql ä¼å¨æ°æ®åºå­ç®å½ä¸åå»ºä¸ä¸ªåè¡¨ååç .frm æä»¶ä¿å­è¡¨çå®ä¹ãå ä¸º Mysql ä½¿ç¨æä»¶ç³»ç»çç®å½åæä»¶æ¥ä¿å­æ°æ®åºåè¡¨çå®ä¹ï¼å¤§å°åæææ§åå·ä½å¹³å°å¯åç¸å³ãWindows ä¸­å¤§å°åä¸ææï¼ç±» Unix ä¸­å¤§å°åææãä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ Mysql æå¡å±ç»ä¸å¤ççã\n\n\n# 2.1. éæ©å­å¨å¼æ\n\n# Mysql åç½®çå­å¨å¼æ\n\nmysql> SHOW ENGINES;\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |\n| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |\n| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |\n| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |\n| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |\n| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |\n| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |\n| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |\n| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n9 rows in set (0.00 sec)\n\n\n * InnoDB - Mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶ä¸æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨å´©æºæ¢å¤ã\n * MyISAM - Mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡æå´©æºæ¢å¤åè½ã\n * CSV - å¯ä»¥å° CSV æä»¶ä½ä¸º Mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * Memory - éåå¿«éè®¿é®æ°æ®ï¼ä¸æ°æ®ä¸ä¼è¢«ä¿®æ¹ï¼éå¯ä¸¢å¤±ä¹æ²¡æå³ç³»ã\n * NDB - ç¨äº Mysql éç¾¤åºæ¯ã\n\n# å¦ä½éæ©åéçå­å¨å¼æ\n\nå¤§å¤æ°æåµä¸ï¼InnoDB é½æ¯æ­£ç¡®çéæ©ï¼é¤ééè¦ç¨å° InnoDB ä¸å·å¤çç¹æ§ã\n\nå¦æåºç¨éè¦éæ© InnoDB ä»¥å¤çå­å¨å¼æï¼å¯ä»¥èèä»¥ä¸å ç´ ï¼\n\n * äºå¡ï¼å¦æéè¦æ¯æäºå¡ï¼InnoDB æ¯é¦éãå¦æä¸éè¦æ¯æäºå¡ï¼ä¸ä¸»è¦æ¯ SELECT å INSERT æä½ï¼MyISAM æ¯ä¸éçéæ©ãæä»¥ï¼å¦æ Mysql é¨ç½²æ¹å¼ä¸ºä¸»å¤æ¨¡å¼ï¼å¹¶è¿è¡è¯»ååç¦»ãé£ä¹å¯ä»¥è¿ä¹åï¼ä¸»èç¹åªæ¯æåæä½ï¼é»è®¤å¼æä¸º InnoDBï¼å¤èç¹åªæ¯æè¯»æä½ï¼é»è®¤å¼æä¸º MyISAMã\n * å¹¶åï¼MyISAM åªæ¯æè¡¨çº§éï¼è InnoDB è¿æ¯æè¡çº§éãæä»¥ï¼InnoDB å¹¶åæ§è½æ´é«ã\n * å¤é®ï¼InnoDB æ¯æå¤é®ã\n * å¤ä»½ï¼InnoDB æ¯æå¨çº¿ç­å¤ä»½ã\n * å´©æºæ¢å¤ï¼MyISAM å´©æºååçæåçæ¦çæ¯ InnoDB é«å¾å¤ï¼èä¸æ¢å¤çéåº¦ä¹æ´æ¢ã\n * å¶å®ç¹æ§ï¼MyISAM æ¯æåç¼©è¡¨åç©ºé´æ°æ®ç´¢å¼ã\n\n# è½¬æ¢è¡¨çå­å¨å¼æ\n\nä¸é¢çè¯­å¥å¯ä»¥å° mytable è¡¨çå¼æä¿®æ¹ä¸º InnoDB\n\nALTER TABLE mytable ENGINE = InnoDB\n\n\n\n# 2.2. MyISAM\n\nMyISAM è®¾è®¡ç®åï¼æ°æ®ä»¥ç´§å¯æ ¼å¼å­å¨ãå¯¹äºåªè¯»æ°æ®ï¼æèè¡¨æ¯è¾å°ãå¯ä»¥å®¹å¿ä¿®å¤æä½ï¼åä¾ç¶å¯ä»¥ä½¿ç¨ MyISAMã\n\nMyISAM å¼æä½¿ç¨ B+Tree ä½ä¸ºç´¢å¼ç»æï¼å¶èç¹ç data åå­æ¾çæ¯æ°æ®è®°å½çå°åã\n\nMyISAM æä¾äºå¤§éçç¹æ§ï¼åæ¬ï¼å¨æç´¢å¼ãåç¼©è¡¨ãç©ºé´å½æ°ç­ãä½æ¯ï¼MyISAM ä¸æ¯æäºå¡åè¡çº§éãå¹¶ä¸ MyISAM ä¸æ¯æå´©æºåçå®å¨æ¢å¤ã\n\n\n# 2.3. InnoDB\n\nInnoDB æ¯ MySQL é»è®¤çäºå¡åå­å¨å¼æï¼åªæå¨éè¦ InnoDB ä¸æ¯æçç¹æ§æ¶ï¼æèèä½¿ç¨å¶å®å­å¨å¼æã\n\nç¶ InnoDB ä¹ä½¿ç¨ B+Tree ä½ä¸ºç´¢å¼ç»æï¼ä½å·ä½å®ç°æ¹å¼å´ä¸ MyISAM æªç¶ä¸åãMyISAM ç´¢å¼æä»¶åæ°æ®æä»¶æ¯åç¦»çï¼ç´¢å¼æä»¶ä»ä¿å­æ°æ®è®°å½çå°åãèå¨ InnoDB ä¸­ï¼è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯æ B+Tree ç»ç»çä¸ä¸ªç´¢å¼ç»æï¼è¿æ£µæ çå¶èç¹ data åä¿å­äºå®æ´çæ°æ®è®°å½ãè¿ä¸ªç´¢å¼ç key æ¯æ°æ®è¡¨çä¸»é®ï¼å æ­¤InnoDB è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯ä¸»ç´¢å¼ã\n\nInnoDB éç¨ MVCC æ¥æ¯æé«å¹¶åï¼å¹¶ä¸å®ç°äºåä¸ªæ åçéç¦»çº§å«ãå¶é»è®¤çº§å«æ¯å¯éå¤è¯»ï¼REPEATABLE READï¼ï¼å¹¶ä¸éè¿é´ééï¼next-key lockingï¼é²æ­¢å¹»è¯»ã\n\nInnoDB æ¯åºäºèç°ç´¢å¼å»ºç«çï¼ä¸å¶ä»å­å¨å¼ææå¾å¤§ä¸åãå¨ç´¢å¼ä¸­ä¿å­äºæ°æ®ï¼ä»èé¿åç´æ¥è¯»åç£çï¼å æ­¤å¯¹æ¥è¯¢æ§è½æå¾å¤§çæåã\n\nåé¨åäºå¾å¤ä¼åï¼åæ¬ä»ç£çè¯»åæ°æ®æ¶éç¨çå¯é¢æµæ§è¯»ãè½å¤å å¿«è¯»æä½å¹¶ä¸èªå¨åå»ºçèªéåºåå¸ç´¢å¼ãè½å¤å éæå¥æä½çæå¥ç¼å²åºç­ã\n\næ¯æçæ­£çå¨çº¿ç­å¤ä»½ãå¶å®å­å¨å¼æä¸æ¯æå¨çº¿ç­å¤ä»½ï¼è¦è·åä¸è´æ§è§å¾éè¦åæ­¢å¯¹ææè¡¨çåå¥ï¼èå¨è¯»åæ··ååºæ¯ä¸­ï¼åæ­¢åå¥å¯è½ä¹æå³çåæ­¢è¯»åã\n\n\n# 3. æ°æ®ç±»å\n\n\n# 3.1. æ´å\n\nTINYINT, SMALLINT, MEDIUMINT, INT, BIGINT åå«ä½¿ç¨ 8, 16, 24, 32, 64 ä½å­å¨ç©ºé´ï¼ä¸è¬æåµä¸è¶å°çåè¶å¥½ã\n\nUNSIGNED è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n\nINT(11) ä¸­çæ°å­åªæ¯è§å®äºäº¤äºå·¥å·æ¾ç¤ºå­ç¬¦çä¸ªæ°ï¼å¯¹äºå­å¨åè®¡ç®æ¥è¯´æ¯æ²¡ææä¹çã\n\n\n# 3.2. æµ®ç¹å\n\nFLOAT å DOUBLE ä¸ºæµ®ç¹ç±»åã\n\nDECIMAL ç±»åä¸»è¦ç¨äºç²¾ç¡®è®¡ç®ï¼ä»£ä»·è¾é«ï¼åºè¯¥å°½éåªå¨å¯¹å°æ°è¿è¡ç²¾ç¡®è®¡ç®æ¶æä½¿ç¨ DECIMAL ââä¾å¦å­å¨è´¢å¡æ°æ®ãæ°æ®éæ¯è¾å¤§çæ¶åï¼å¯ä»¥ä½¿ç¨ BIGINT ä»£æ¿ DECIMALã\n\nFLOATãDOUBLE å DECIMAL é½å¯ä»¥æå®åå®½ï¼ä¾å¦ DECIMAL(18, 9) è¡¨ç¤ºæ»å± 18 ä½ï¼å 9 ä½å­å¨å°æ°é¨åï¼å©ä¸ 9 ä½å­å¨æ´æ°é¨åã\n\n\n# 3.3. å­ç¬¦ä¸²\n\nä¸»è¦æ CHAR å VARCHAR ä¸¤ç§ç±»åï¼ä¸ç§æ¯å®é¿çï¼ä¸ç§æ¯åé¿çã\n\nVARCHAR è¿ç§åé¿ç±»åè½å¤èçç©ºé´ï¼å ä¸ºåªéè¦å­å¨å¿è¦çåå®¹ãä½æ¯å¨æ§è¡ UPDATE æ¶å¯è½ä¼ä½¿è¡åå¾æ¯åæ¥é¿ãå½è¶åºä¸ä¸ªé¡µæè½å®¹çº³çå¤§å°æ¶ï¼å°±è¦æ§è¡é¢å¤çæä½ãMyISAM ä¼å°è¡ææä¸åççæ®µå­å¨ï¼è InnoDB åéè¦åè£é¡µæ¥ä½¿è¡æ¾è¿é¡µåã\n\nVARCHAR ä¼ä¿çå­ç¬¦ä¸²æ«å°¾çç©ºæ ¼ï¼è CHAR ä¼å é¤ã\n\n\n# 3.4. æ¶é´åæ¥æ\n\nMySQL æä¾äºä¸¤ç§ç¸ä¼¼çæ¥ææ¶é´ç±»åï¼DATATIME å TIMESTAMPã\n\n# DATATIME\n\nè½å¤ä¿å­ä» 1001 å¹´å° 9999 å¹´çæ¥æåæ¶é´ï¼ç²¾åº¦ä¸ºç§ï¼ä½¿ç¨ 8 å­èçå­å¨ç©ºé´ã\n\nå®ä¸æ¶åºæ å³ã\n\né»è®¤æåµä¸ï¼MySQL ä»¥ä¸ç§å¯æåºçãæ æ­§ä¹çæ ¼å¼æ¾ç¤º DATATIME å¼ï¼ä¾å¦â2008-01-16 22:37:08âï¼è¿æ¯ ANSI æ åå®ä¹çæ¥æåæ¶é´è¡¨ç¤ºæ¹æ³ã\n\n# TIMESTAMP\n\nå UNIX æ¶é´æ³ç¸åï¼ä¿å­ä» 1970 å¹´ 1 æ 1 æ¥åå¤ï¼æ ¼æå¨æ²»æ¶é´ï¼ä»¥æ¥çç§æ°ï¼ä½¿ç¨ 4 ä¸ªå­èï¼åªè½è¡¨ç¤ºä» 1970 å¹´ å° 2038 å¹´ã\n\nå®åæ¶åºæå³ï¼ä¹å°±æ¯è¯´ä¸ä¸ªæ¶é´æ³å¨ä¸åçæ¶åºæä»£è¡¨çå·ä½æ¶é´æ¯ä¸åçã\n\nMySQL æä¾äº FROM_UNIXTIME() å½æ°æ UNIX æ¶é´æ³è½¬æ¢ä¸ºæ¥æï¼å¹¶æä¾äº UNIX_TIMESTAMP() å½æ°ææ¥æè½¬æ¢ä¸º UNIX æ¶é´æ³ã\n\né»è®¤æåµä¸ï¼å¦ææå¥æ¶æ²¡ææå® TIMESTAMP åçå¼ï¼ä¼å°è¿ä¸ªå¼è®¾ç½®ä¸ºå½åæ¶é´ã\n\nåºè¯¥å°½éä½¿ç¨ TIMESTAMPï¼å ä¸ºå®æ¯ DATETIME ç©ºé´æçæ´é«ã\n\n\n# 3.5. BLOB å TEXT\n\nBLOB å TEXT é½æ¯ä¸ºäºå­å¨å¤§çæ°æ®èè®¾è®¡ï¼åèå­å¨äºè¿å¶æ°æ®ï¼åèå­å¨å­ç¬¦ä¸²æ°æ®ã\n\nä¸è½å¯¹ BLOB å TEXT ç±»åçå¨é¨åå®¹è¿è¡æåºãç´¢å¼ã\n\n\n# 3.6. æä¸¾ç±»å\n\nå¤§å¤æ°æåµä¸æ²¡æä½¿ç¨æä¸¾ç±»åçå¿è¦ï¼å¶ä¸­ä¸ä¸ªç¼ºç¹æ¯ï¼æä¸¾çå­ç¬¦ä¸²åè¡¨æ¯åºå®çï¼æ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨ALTER TABLEï¼å¦æåªåªæ¯å¨åè¡¨æ«å°¾è¿½å åç´ ï¼ä¸éè¦éå»ºè¡¨ï¼ã\n\n\n# 3.7. ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ AUTO_INCREMENTã\n\n * ENUM å SET ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº MD5ãSHAãUUID è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ INSERT ä»¥åä¸äº SELECT è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ UUID ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ UNHEX() å½æ°è½¬æ¢ UUID å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª BINARY(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ HEX() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# 4. ç´¢å¼\n\n> è¯¦è§ï¼Mysql ç´¢å¼\n\n\n# 5. é\n\n> è¯¦è§ï¼Mysql é\n\n\n# 6. äºå¡\n\n> è¯¦è§ï¼Mysql äºå¡\n\n\n# 7. æ§è½ä¼å\n\n> è¯¦è§ï¼Mysql æ§è½ä¼å\n\n\n# 8. å¤å¶\n\n\n# 8.1. ä¸»ä»å¤å¶\n\nMysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼ç¶åå¨ä»åºéæ¾æ¥å¿çæ¹å¼æ¥å®ç°å¼æ­¥çæ°æ®å¤å¶ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãI/O çº¿ç¨å SQL çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * I/O çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çä¸­ç»§æ¥å¿ä¸­ã\n * SQL çº¿ç¨ ï¼è´è´£è¯»åä¸­ç»§æ¥å¿å¹¶éæ¾å¶ä¸­ç SQL è¯­å¥ã\n\n\n\n\n# 8.2. è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nMySQL è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® MyISAM å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n#\n\n\nï¼åå²çº¿ï¼ä»¥ä¸ä¸ºé«çº§ç¹æ§ï¼ä¹æ¯å³ç³»åæ°æ®åºéç¨æ¹æ¡\n\n\n# 9. åå¸å¼äºå¡\n\n> åèï¼åå¸å¼äºå¡åºæ¬åç\n\n\n# 10. ååºåè¡¨\n\n> åèï¼åå¸å¼å­å¨åºæ¬åç\n\n\n# 11. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * 20+ æ¡ MySQL æ§è½ä¼åçæä½³ç»éª\n * How to create unique row ID in sharded databases?\n * SQL Azure Federation â Introduction\n\n\n# 12. ä¼ éé¨\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# mysql åºç¨æå\n\n\n# 1. sql æ§è¡è¿ç¨\n\nå­¦ä¹  mysqlï¼æå¥½æ¯åä»å®è§ä¸äºè§£ mysql å·¥ä½åçã\n\n> åèï¼mysql å·¥ä½æµ\n\n\n# 2. å­å¨å¼æ\n\nå¨æä»¶ç³»ç»ä¸­ï¼mysql å°æ¯ä¸ªæ°æ®åºï¼ä¹å¯ä»¥æä¸º schemaï¼ä¿å­ä¸ºæ°æ®ç®å½ä¸çä¸ä¸ªå­ç®å½ãåå»ºè¡¨ç¤ºï¼mysql ä¼å¨æ°æ®åºå­ç®å½ä¸åå»ºä¸ä¸ªåè¡¨ååç .frm æä»¶ä¿å­è¡¨çå®ä¹ãå ä¸º mysql ä½¿ç¨æä»¶ç³»ç»çç®å½åæä»¶æ¥ä¿å­æ°æ®åºåè¡¨çå®ä¹ï¼å¤§å°åæææ§åå·ä½å¹³å°å¯åç¸å³ãwindows ä¸­å¤§å°åä¸ææï¼ç±» unix ä¸­å¤§å°åææãä¸åçå­å¨å¼æä¿å­æ°æ®åç´¢å¼çæ¹å¼æ¯ä¸åçï¼ä½è¡¨çå®ä¹åæ¯å¨ mysql æå¡å±ç»ä¸å¤ççã\n\n\n# 2.1. éæ©å­å¨å¼æ\n\n# mysql åç½®çå­å¨å¼æ\n\nmysql> show engines;\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| engine             | support | comment                                                        | transactions | xa   | savepoints |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n| federated          | no      | federated mysql storage engine                                 | null         | null | null       |\n| memory             | yes     | hash based, stored in memory, useful for temporary tables      | no           | no   | no         |\n| innodb             | default | supports transactions, row-level locking, and foreign keys     | yes          | yes  | yes        |\n| performance_schema | yes     | performance schema                                             | no           | no   | no         |\n| myisam             | yes     | myisam storage engine                                          | no           | no   | no         |\n| mrg_myisam         | yes     | collection of identical myisam tables                          | no           | no   | no         |\n| blackhole          | yes     | /dev/null storage engine (anything you write to it disappears) | no           | no   | no         |\n| csv                | yes     | csv storage engine                                             | no           | no   | no         |\n| archive            | yes     | archive storage engine                                         | no           | no   | no         |\n+--------------------+---------+----------------------------------------------------------------+--------------+------+------------+\n9 rows in set (0.00 sec)\n\n\n * innodb - mysql çé»è®¤äºå¡åå­å¨å¼æï¼å¹¶ä¸æä¾äºè¡çº§éåå¤é®ççº¦æãæ§è½ä¸éä¸æ¯æèªå¨å´©æºæ¢å¤ã\n * myisam - mysql 5.1 çæ¬åçé»è®¤å­å¨å¼æãç¹æ§ä¸°å¯ä½ä¸æ¯æäºå¡ï¼ä¹ä¸æ¯æè¡çº§éåå¤é®ï¼ä¹æ²¡æå´©æºæ¢å¤åè½ã\n * csv - å¯ä»¥å° csv æä»¶ä½ä¸º mysql çè¡¨æ¥å¤çï¼ä½è¿ç§è¡¨ä¸æ¯æç´¢å¼ã\n * memory - éåå¿«éè®¿é®æ°æ®ï¼ä¸æ°æ®ä¸ä¼è¢«ä¿®æ¹ï¼éå¯ä¸¢å¤±ä¹æ²¡æå³ç³»ã\n * ndb - ç¨äº mysql éç¾¤åºæ¯ã\n\n# å¦ä½éæ©åéçå­å¨å¼æ\n\nå¤§å¤æ°æåµä¸ï¼innodb é½æ¯æ­£ç¡®çéæ©ï¼é¤ééè¦ç¨å° innodb ä¸å·å¤çç¹æ§ã\n\nå¦æåºç¨éè¦éæ© innodb ä»¥å¤çå­å¨å¼æï¼å¯ä»¥èèä»¥ä¸å ç´ ï¼\n\n * äºå¡ï¼å¦æéè¦æ¯æäºå¡ï¼innodb æ¯é¦éãå¦æä¸éè¦æ¯æäºå¡ï¼ä¸ä¸»è¦æ¯ select å insert æä½ï¼myisam æ¯ä¸éçéæ©ãæä»¥ï¼å¦æ mysql é¨ç½²æ¹å¼ä¸ºä¸»å¤æ¨¡å¼ï¼å¹¶è¿è¡è¯»ååç¦»ãé£ä¹å¯ä»¥è¿ä¹åï¼ä¸»èç¹åªæ¯æåæä½ï¼é»è®¤å¼æä¸º innodbï¼å¤èç¹åªæ¯æè¯»æä½ï¼é»è®¤å¼æä¸º myisamã\n * å¹¶åï¼myisam åªæ¯æè¡¨çº§éï¼è innodb è¿æ¯æè¡çº§éãæä»¥ï¼innodb å¹¶åæ§è½æ´é«ã\n * å¤é®ï¼innodb æ¯æå¤é®ã\n * å¤ä»½ï¼innodb æ¯æå¨çº¿ç­å¤ä»½ã\n * å´©æºæ¢å¤ï¼myisam å´©æºååçæåçæ¦çæ¯ innodb é«å¾å¤ï¼èä¸æ¢å¤çéåº¦ä¹æ´æ¢ã\n * å¶å®ç¹æ§ï¼myisam æ¯æåç¼©è¡¨åç©ºé´æ°æ®ç´¢å¼ã\n\n# è½¬æ¢è¡¨çå­å¨å¼æ\n\nä¸é¢çè¯­å¥å¯ä»¥å° mytable è¡¨çå¼æä¿®æ¹ä¸º innodb\n\nalter table mytable engine = innodb\n\n\n\n# 2.2. myisam\n\nmyisam è®¾è®¡ç®åï¼æ°æ®ä»¥ç´§å¯æ ¼å¼å­å¨ãå¯¹äºåªè¯»æ°æ®ï¼æèè¡¨æ¯è¾å°ãå¯ä»¥å®¹å¿ä¿®å¤æä½ï¼åä¾ç¶å¯ä»¥ä½¿ç¨ myisamã\n\nmyisam å¼æä½¿ç¨ b+tree ä½ä¸ºç´¢å¼ç»æï¼å¶èç¹ç data åå­æ¾çæ¯æ°æ®è®°å½çå°åã\n\nmyisam æä¾äºå¤§éçç¹æ§ï¼åæ¬ï¼å¨æç´¢å¼ãåç¼©è¡¨ãç©ºé´å½æ°ç­ãä½æ¯ï¼myisam ä¸æ¯æäºå¡åè¡çº§éãå¹¶ä¸ myisam ä¸æ¯æå´©æºåçå®å¨æ¢å¤ã\n\n\n# 2.3. innodb\n\ninnodb æ¯ mysql é»è®¤çäºå¡åå­å¨å¼æï¼åªæå¨éè¦ innodb ä¸æ¯æçç¹æ§æ¶ï¼æèèä½¿ç¨å¶å®å­å¨å¼æã\n\nç¶ innodb ä¹ä½¿ç¨ b+tree ä½ä¸ºç´¢å¼ç»æï¼ä½å·ä½å®ç°æ¹å¼å´ä¸ myisam æªç¶ä¸åãmyisam ç´¢å¼æä»¶åæ°æ®æä»¶æ¯åç¦»çï¼ç´¢å¼æä»¶ä»ä¿å­æ°æ®è®°å½çå°åãèå¨ innodb ä¸­ï¼è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯æ b+tree ç»ç»çä¸ä¸ªç´¢å¼ç»æï¼è¿æ£µæ çå¶èç¹ data åä¿å­äºå®æ´çæ°æ®è®°å½ãè¿ä¸ªç´¢å¼ç key æ¯æ°æ®è¡¨çä¸»é®ï¼å æ­¤innodb è¡¨æ°æ®æä»¶æ¬èº«å°±æ¯ä¸»ç´¢å¼ã\n\ninnodb éç¨ mvcc æ¥æ¯æé«å¹¶åï¼å¹¶ä¸å®ç°äºåä¸ªæ åçéç¦»çº§å«ãå¶é»è®¤çº§å«æ¯å¯éå¤è¯»ï¼repeatable readï¼ï¼å¹¶ä¸éè¿é´ééï¼next-key lockingï¼é²æ­¢å¹»è¯»ã\n\ninnodb æ¯åºäºèç°ç´¢å¼å»ºç«çï¼ä¸å¶ä»å­å¨å¼ææå¾å¤§ä¸åãå¨ç´¢å¼ä¸­ä¿å­äºæ°æ®ï¼ä»èé¿åç´æ¥è¯»åç£çï¼å æ­¤å¯¹æ¥è¯¢æ§è½æå¾å¤§çæåã\n\nåé¨åäºå¾å¤ä¼åï¼åæ¬ä»ç£çè¯»åæ°æ®æ¶éç¨çå¯é¢æµæ§è¯»ãè½å¤å å¿«è¯»æä½å¹¶ä¸èªå¨åå»ºçèªéåºåå¸ç´¢å¼ãè½å¤å éæå¥æä½çæå¥ç¼å²åºç­ã\n\næ¯æçæ­£çå¨çº¿ç­å¤ä»½ãå¶å®å­å¨å¼æä¸æ¯æå¨çº¿ç­å¤ä»½ï¼è¦è·åä¸è´æ§è§å¾éè¦åæ­¢å¯¹ææè¡¨çåå¥ï¼èå¨è¯»åæ··ååºæ¯ä¸­ï¼åæ­¢åå¥å¯è½ä¹æå³çåæ­¢è¯»åã\n\n\n# 3. æ°æ®ç±»å\n\n\n# 3.1. æ´å\n\ntinyint, smallint, mediumint, int, bigint åå«ä½¿ç¨ 8, 16, 24, 32, 64 ä½å­å¨ç©ºé´ï¼ä¸è¬æåµä¸è¶å°çåè¶å¥½ã\n\nunsigned è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n\nint(11) ä¸­çæ°å­åªæ¯è§å®äºäº¤äºå·¥å·æ¾ç¤ºå­ç¬¦çä¸ªæ°ï¼å¯¹äºå­å¨åè®¡ç®æ¥è¯´æ¯æ²¡ææä¹çã\n\n\n# 3.2. æµ®ç¹å\n\nfloat å double ä¸ºæµ®ç¹ç±»åã\n\ndecimal ç±»åä¸»è¦ç¨äºç²¾ç¡®è®¡ç®ï¼ä»£ä»·è¾é«ï¼åºè¯¥å°½éåªå¨å¯¹å°æ°è¿è¡ç²¾ç¡®è®¡ç®æ¶æä½¿ç¨ decimal ââä¾å¦å­å¨è´¢å¡æ°æ®ãæ°æ®éæ¯è¾å¤§çæ¶åï¼å¯ä»¥ä½¿ç¨ bigint ä»£æ¿ decimalã\n\nfloatãdouble å decimal é½å¯ä»¥æå®åå®½ï¼ä¾å¦ decimal(18, 9) è¡¨ç¤ºæ»å± 18 ä½ï¼å 9 ä½å­å¨å°æ°é¨åï¼å©ä¸ 9 ä½å­å¨æ´æ°é¨åã\n\n\n# 3.3. å­ç¬¦ä¸²\n\nä¸»è¦æ char å varchar ä¸¤ç§ç±»åï¼ä¸ç§æ¯å®é¿çï¼ä¸ç§æ¯åé¿çã\n\nvarchar è¿ç§åé¿ç±»åè½å¤èçç©ºé´ï¼å ä¸ºåªéè¦å­å¨å¿è¦çåå®¹ãä½æ¯å¨æ§è¡ update æ¶å¯è½ä¼ä½¿è¡åå¾æ¯åæ¥é¿ãå½è¶åºä¸ä¸ªé¡µæè½å®¹çº³çå¤§å°æ¶ï¼å°±è¦æ§è¡é¢å¤çæä½ãmyisam ä¼å°è¡ææä¸åççæ®µå­å¨ï¼è innodb åéè¦åè£é¡µæ¥ä½¿è¡æ¾è¿é¡µåã\n\nvarchar ä¼ä¿çå­ç¬¦ä¸²æ«å°¾çç©ºæ ¼ï¼è char ä¼å é¤ã\n\n\n# 3.4. æ¶é´åæ¥æ\n\nmysql æä¾äºä¸¤ç§ç¸ä¼¼çæ¥ææ¶é´ç±»åï¼datatime å timestampã\n\n# datatime\n\nè½å¤ä¿å­ä» 1001 å¹´å° 9999 å¹´çæ¥æåæ¶é´ï¼ç²¾åº¦ä¸ºç§ï¼ä½¿ç¨ 8 å­èçå­å¨ç©ºé´ã\n\nå®ä¸æ¶åºæ å³ã\n\né»è®¤æåµä¸ï¼mysql ä»¥ä¸ç§å¯æåºçãæ æ­§ä¹çæ ¼å¼æ¾ç¤º datatime å¼ï¼ä¾å¦â2008-01-16 22:37:08âï¼è¿æ¯ ansi æ åå®ä¹çæ¥æåæ¶é´è¡¨ç¤ºæ¹æ³ã\n\n# timestamp\n\nå unix æ¶é´æ³ç¸åï¼ä¿å­ä» 1970 å¹´ 1 æ 1 æ¥åå¤ï¼æ ¼æå¨æ²»æ¶é´ï¼ä»¥æ¥çç§æ°ï¼ä½¿ç¨ 4 ä¸ªå­èï¼åªè½è¡¨ç¤ºä» 1970 å¹´ å° 2038 å¹´ã\n\nå®åæ¶åºæå³ï¼ä¹å°±æ¯è¯´ä¸ä¸ªæ¶é´æ³å¨ä¸åçæ¶åºæä»£è¡¨çå·ä½æ¶é´æ¯ä¸åçã\n\nmysql æä¾äº from_unixtime() å½æ°æ unix æ¶é´æ³è½¬æ¢ä¸ºæ¥æï¼å¹¶æä¾äº unix_timestamp() å½æ°ææ¥æè½¬æ¢ä¸º unix æ¶é´æ³ã\n\né»è®¤æåµä¸ï¼å¦ææå¥æ¶æ²¡ææå® timestamp åçå¼ï¼ä¼å°è¿ä¸ªå¼è®¾ç½®ä¸ºå½åæ¶é´ã\n\nåºè¯¥å°½éä½¿ç¨ timestampï¼å ä¸ºå®æ¯ datetime ç©ºé´æçæ´é«ã\n\n\n# 3.5. blob å text\n\nblob å text é½æ¯ä¸ºäºå­å¨å¤§çæ°æ®èè®¾è®¡ï¼åèå­å¨äºè¿å¶æ°æ®ï¼åèå­å¨å­ç¬¦ä¸²æ°æ®ã\n\nä¸è½å¯¹ blob å text ç±»åçå¨é¨åå®¹è¿è¡æåºãç´¢å¼ã\n\n\n# 3.6. æä¸¾ç±»å\n\nå¤§å¤æ°æåµä¸æ²¡æä½¿ç¨æä¸¾ç±»åçå¿è¦ï¼å¶ä¸­ä¸ä¸ªç¼ºç¹æ¯ï¼æä¸¾çå­ç¬¦ä¸²åè¡¨æ¯åºå®çï¼æ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨alter tableï¼å¦æåªåªæ¯å¨åè¡¨æ«å°¾è¿½å åç´ ï¼ä¸éè¦éå»ºè¡¨ï¼ã\n\n\n# 3.7. ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ auto_incrementã\n\n * enum å set ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº md5ãshaãuuid è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ insert ä»¥åä¸äº select è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ uuid ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ unhex() å½æ°è½¬æ¢ uuid å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª binary(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ hex() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# 4. ç´¢å¼\n\n> è¯¦è§ï¼mysql ç´¢å¼\n\n\n# 5. é\n\n> è¯¦è§ï¼mysql é\n\n\n# 6. äºå¡\n\n> è¯¦è§ï¼mysql äºå¡\n\n\n# 7. æ§è½ä¼å\n\n> è¯¦è§ï¼mysql æ§è½ä¼å\n\n\n# 8. å¤å¶\n\n\n# 8.1. ä¸»ä»å¤å¶\n\nmysql æ¯æä¸¤ç§å¤å¶ï¼åºäºè¡çå¤å¶ååºäºè¯­å¥çå¤å¶ã\n\nè¿ä¸¤ç§æ¹å¼é½æ¯å¨ä¸»åºä¸è®°å½äºè¿å¶æ¥å¿ï¼ç¶åå¨ä»åºéæ¾æ¥å¿çæ¹å¼æ¥å®ç°å¼æ­¥çæ°æ®å¤å¶ãè¿æå³çï¼å¤å¶è¿ç¨å­å¨æ¶å»¶ï¼è¿æ®µæ¶é´åï¼ä¸»ä»æ°æ®å¯è½ä¸ä¸è´ã\n\nä¸»è¦æ¶åä¸ä¸ªçº¿ç¨ï¼binlog çº¿ç¨ãi/o çº¿ç¨å sql çº¿ç¨ã\n\n * binlog çº¿ç¨ ï¼è´è´£å°ä¸»æå¡å¨ä¸çæ°æ®æ´æ¹åå¥äºè¿å¶æä»¶ï¼binlogï¼ä¸­ã\n * i/o çº¿ç¨ ï¼è´è´£ä»ä¸»æå¡å¨ä¸è¯»åäºè¿å¶æ¥å¿æä»¶ï¼å¹¶åå¥ä»æå¡å¨çä¸­ç»§æ¥å¿ä¸­ã\n * sql çº¿ç¨ ï¼è´è´£è¯»åä¸­ç»§æ¥å¿å¹¶éæ¾å¶ä¸­ç sql è¯­å¥ã\n\n\n\n\n# 8.2. è¯»ååç¦»\n\nä¸»æå¡å¨ç¨æ¥å¤çåæä½ä»¥åå®æ¶æ§è¦æ±æ¯è¾é«çè¯»æä½ï¼èä»æå¡å¨ç¨æ¥å¤çè¯»æä½ã\n\nè¯»ååç¦»å¸¸ç¨ä»£çæ¹å¼æ¥å®ç°ï¼ä»£çæå¡å¨æ¥æ¶åºç¨å±ä¼ æ¥çè¯»åè¯·æ±ï¼ç¶åå³å®è½¬åå°åªä¸ªæå¡å¨ã\n\nmysql è¯»ååç¦»è½æé«æ§è½çåå å¨äºï¼\n\n * ä¸»ä»æå¡å¨è´è´£åèªçè¯»ååï¼æå¤§ç¨åº¦ç¼è§£äºéçäºç¨ï¼\n * ä»æå¡å¨å¯ä»¥éç½® myisam å¼æï¼æåæ¥è¯¢æ§è½ä»¥åèçº¦ç³»ç»å¼éï¼\n * å¢å åä½ï¼æé«å¯ç¨æ§ã\n\n\n#\n\n\nï¼åå²çº¿ï¼ä»¥ä¸ä¸ºé«çº§ç¹æ§ï¼ä¹æ¯å³ç³»åæ°æ®åºéç¨æ¹æ¡\n\n\n# 9. åå¸å¼äºå¡\n\n> åèï¼åå¸å¼äºå¡åºæ¬åç\n\n\n# 10. ååºåè¡¨\n\n> åèï¼åå¸å¼å­å¨åºæ¬åç\n\n\n# 11. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * 20+ æ¡ mysql æ§è½ä¼åçæä½³ç»éª\n * how to create unique row id in sharded databases?\n * sql azure federation â introduction\n\n\n# 12. ä¼ éé¨\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MySQL å·¥ä½æµ",frontmatter:{title:"MySQL å·¥ä½æµ",date:"2020-07-16T11:14:07.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],permalink:"/pages/0a031b/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/02.MySQL%E5%B7%A5%E4%BD%9C%E6%B5%81.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/02.MySQLå·¥ä½æµ.md",key:"v-a6cffc1a",path:"/pages/0a031b/",headers:[{level:2,title:"1. åºç¡æ¶æ",slug:"_1-åºç¡æ¶æ",normalizedTitle:"1. åºç¡æ¶æ",charIndex:16},{level:2,title:"2. æ¥è¯¢è¿ç¨",slug:"_2-æ¥è¯¢è¿ç¨",normalizedTitle:"2. æ¥è¯¢è¿ç¨",charIndex:289},{level:3,title:"2.1. ï¼ä¸ï¼è¿æ¥",slug:"_2-1-ä¸-è¿æ¥",normalizedTitle:"2.1. ï¼ä¸ï¼è¿æ¥",charIndex:584},{level:3,title:"2.2. ï¼äºï¼æ¥è¯¢ç¼å­",slug:"_2-2-äº-æ¥è¯¢ç¼å­",normalizedTitle:"2.2. ï¼äºï¼æ¥è¯¢ç¼å­",charIndex:1520},{level:3,title:"2.3. ï¼ä¸ï¼è¯­æ³åæ",slug:"_2-3-ä¸-è¯­æ³åæ",normalizedTitle:"2.3. ï¼ä¸ï¼è¯­æ³åæ",charIndex:2391},{level:3,title:"2.4. ï¼åï¼æ¥è¯¢ä¼å",slug:"_2-4-å-æ¥è¯¢ä¼å",normalizedTitle:"2.4. ï¼åï¼æ¥è¯¢ä¼å",charIndex:2919},{level:3,title:"2.5. ï¼äºï¼æ¥è¯¢æ§è¡å¼æ",slug:"_2-5-äº-æ¥è¯¢æ§è¡å¼æ",normalizedTitle:"2.5. ï¼äºï¼æ¥è¯¢æ§è¡å¼æ",charIndex:4131},{level:3,title:"2.6. ï¼å­ï¼è¿åç»æ",slug:"_2-6-å­-è¿åç»æ",normalizedTitle:"2.6. ï¼å­ï¼è¿åç»æ",charIndex:4415},{level:2,title:"3. æ´æ°è¿ç¨",slug:"_3-æ´æ°è¿ç¨",normalizedTitle:"3. æ´æ°è¿ç¨",charIndex:4735},{level:3,title:"3.1. redo log",slug:"_3-1-redo-log",normalizedTitle:"3.1. redo log",charIndex:4836},{level:3,title:"3.2. bin log",slug:"_3-2-bin-log",normalizedTitle:"3.2. bin log",charIndex:5291},{level:3,title:"3.3. redo log vs. bin log",slug:"_3-3-redo-log-vs-bin-log",normalizedTitle:"3.3. redo log vs. bin log",charIndex:5534},{level:3,title:"3.4. ä¸¤é¶æ®µæäº¤",slug:"_3-4-ä¸¤é¶æ®µæäº¤",normalizedTitle:"3.4. ä¸¤é¶æ®µæäº¤",charIndex:6308},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:7026}],headersStr:"1. åºç¡æ¶æ 2. æ¥è¯¢è¿ç¨ 2.1. ï¼ä¸ï¼è¿æ¥ 2.2. ï¼äºï¼æ¥è¯¢ç¼å­ 2.3. ï¼ä¸ï¼è¯­æ³åæ 2.4. ï¼åï¼æ¥è¯¢ä¼å 2.5. ï¼äºï¼æ¥è¯¢æ§è¡å¼æ 2.6. ï¼å­ï¼è¿åç»æ 3. æ´æ°è¿ç¨ 3.1. redo log 3.2. bin log 3.3. redo log vs. bin log 3.4. ä¸¤é¶æ®µæäº¤ 4. åèèµæ",content:'# MySQL å·¥ä½æµ\n\n\n# 1. åºç¡æ¶æ\n\nå¤§ä½æ¥è¯´ï¼MySQL å¯ä»¥åä¸º Server å±åå­å¨å¼æå±ä¸¤é¨åã\n\nServer å±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µç MySQL çå¤§å¤æ°æ ¸å¿æå¡åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã\n\nå­å¨å¼æå±è´è´£æ°æ®çå­å¨åæåãå¶æ¶ææ¨¡å¼æ¯æä»¶å¼çï¼æ¯æ InnoDBãMyISAMãMemory ç­å¤ä¸ªå­å¨å¼æãç°å¨æå¸¸ç¨çå­å¨å¼ææ¯ InnoDBï¼å®ä» MySQL 5.5.5 çæ¬å¼å§æä¸ºäºé»è®¤å­å¨å¼æã\n\n\n\n\n# 2. æ¥è¯¢è¿ç¨\n\nSQL è¯­å¥å¨ MySQL ä¸­æ¯å¦ä½æ§è¡çï¼\n\nMySQL æ´ä¸ªæ¥è¯¢æ§è¡è¿ç¨ï¼æ»çæ¥è¯´åä¸º 6 ä¸ªæ­¥éª¤ï¼\n\n 1. å®¢æ·ç«¯å MySQL æå¡å¨å»ºç«è¿æ¥ï¼å®¢æ·ç«¯å MySQL æå¡å¨åéä¸æ¡æ¥è¯¢è¯·æ±ã\n 2. MySQL æå¡å¨é¦åæ£æ¥æ¥è¯¢ç¼å­ï¼å¦æå½ä¸­ç¼å­ï¼åç«å»è¿åç»æãå¦åè¿å¥ä¸ä¸é¶æ®µã\n 3. MySQL æå¡å¨è¿è¡ SQL åæï¼è¯­æ³åæãè¯æ³åæã\n 4. MySQL æå¡å¨ç¨ä¼åå¨çæå¯¹åºçæ§è¡è®¡åã\n 5. MySQL æå¡å¨æ ¹æ®æ§è¡è®¡åï¼è°ç¨å­å¨å¼æç API æ¥æ§è¡æ¥è¯¢ã\n 6. MySQL æå¡å¨å°ç»æè¿åç»å®¢æ·ç«¯ï¼åæ¶ç¼å­æ¥è¯¢ç»æã\n\n\n# 2.1. ï¼ä¸ï¼è¿æ¥\n\nä½¿ç¨ MySQL ç¬¬ä¸æ­¥èªç¶æ¯è¦è¿æ¥æ°æ®åºã\n\nMySQL å®¢æ·ç«¯/æå¡ç«¯éä¿¡æ¯ååå·¥æ¨¡å¼ï¼å³ä»»ä¸æ¶å»ï¼è¦ä¹æ¯æå¡ç«¯åå®¢æ·ç«¯åéæ°æ®ï¼è¦ä¹æ¯å®¢æ·ç«¯åæå¡å¨åéæ°æ®ãå®¢æ·ç«¯ç¨ä¸ä¸ªåç¬çæ°æ®åå°æ¥è¯¢è¯·æ±åéç»æå¡å¨ï¼æä»¥å½æ¥è¯¢è¯­å¥å¾é¿çæ¶åï¼éè¦è®¾ç½®max_allowed_packetåæ°ãä½æ¯éè¦æ³¨æçæ¯ï¼å¦ææ¥è¯¢å®å¨æ¯å¤ªå¤§ï¼æå¡ç«¯ä¼æç»æ¥æ¶æ´å¤æ°æ®å¹¶æåºå¼å¸¸ã\n\nMySQL å®¢æ·ç«¯è¿æ¥å½ä»¤ï¼mysql -h<ä¸»æº> -P<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >ãå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãå®¢æ·ç«¯è¿æ¥ç»´ææ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ãå¦æå¨è¿æ¥è¢«æ­å¼ä¹åï¼å®¢æ·ç«¯åæ¬¡åéè¯·æ±çè¯ï¼å°±ä¼æ¶å°ä¸ä¸ªéè¯¯æéï¼ Lost connection to MySQL server during queryãè¿æ¶åå¦æä½ è¦ç»§ç»­ï¼å°±éè¦éè¿ï¼ç¶ååæ§è¡è¯·æ±äºã\n\nå»ºç«è¿æ¥çè¿ç¨éå¸¸æ¯æ¯è¾å¤æçï¼å»ºè®®å¨ä½¿ç¨ä¸­è¦å°½éåå°å»ºç«è¿æ¥çå¨ä½ï¼ä¹å°±æ¯å°½éä½¿ç¨é¿è¿æ¥ãä¸ºäºå¨ç¨åºä¸­æé«æ°æ®åºè¿æ¥çæç¨äºï¼ä¸è¬ä¼ä½¿ç¨æ°æ®åºè¿æ¥æ± æ¥ç»´æ¤ç®¡çã\n\nä½æ¯å¨é¨ä½¿ç¨é¿è¿æ¥åï¼ä½ å¯è½ä¼åç°ï¼æäºæ¶å MySQL å ç¨åå­æ¶¨å¾ç¹å«å¿«ï¼è¿æ¯å ä¸º MySQL å¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯ç®¡çå¨è¿æ¥å¯¹è±¡éé¢çãè¿äºèµæºä¼å¨è¿æ¥æ­å¼çæ¶åæéæ¾ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼OOMï¼ï¼ä»ç°è±¡çå°±æ¯ MySQL å¼å¸¸éå¯äºã\n\næä¹è§£å³è¿ä¸ªé®é¢å¢ï¼ä½ å¯ä»¥èèä»¥ä¸ä¸¤ç§æ¹æ¡ã\n\n * å®ææ­å¼é¿è¿æ¥ãä½¿ç¨ä¸æ®µæ¶é´ï¼æèç¨åºéé¢å¤æ­æ§è¡è¿ä¸ä¸ªå ç¨åå­çå¤§æ¥è¯¢åï¼æ­å¼è¿æ¥ï¼ä¹åè¦æ¥è¯¢åéè¿ã\n * å¦æä½ ç¨çæ¯ MySQL 5.7 ææ´æ°çæ¬ï¼å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ mysql_reset_connection æ¥éæ°åå§åè¿æ¥èµæºãè¿ä¸ªè¿ç¨ä¸éè¦éè¿åéæ°åæééªè¯ï¼ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æã\n\n\n# 2.2. ï¼äºï¼æ¥è¯¢ç¼å­\n\n> ä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ã\n\nè§£æä¸ä¸ªæ¥è¯¢è¯­å¥åï¼å¦ææ¥è¯¢ç¼å­æ¯æå¼çï¼é£ä¹ MySQL ä¼æ£æ¥è¿ä¸ªæ¥è¯¢è¯­å¥æ¯å¦å½ä¸­æ¥è¯¢ç¼å­ä¸­çæ°æ®ãå¦æå½åæ¥è¯¢æ°å¥½å½ä¸­æ¥è¯¢ç¼å­ï¼å¨æ£æ¥ä¸æ¬¡ç¨æ·æéåç´æ¥è¿åç¼å­ä¸­çç»æãè¿ç§æåµä¸ï¼æ¥è¯¢ä¸ä¼è¢«è§£æï¼ä¹ä¸ä¼çææ§è¡è®¡åï¼æ´ä¸ä¼æ§è¡ã\n\nMySQL å°ç¼å­å­æ¾å¨ä¸ä¸ªå¼ç¨è¡¨ï¼ä¸è¦çè§£ætableï¼å¯ä»¥è®¤ä¸ºæ¯ç±»ä¼¼äºHashMapçæ°æ®ç»æï¼ï¼éè¿ä¸ä¸ªåå¸å¼ç´¢å¼ï¼è¿ä¸ªåå¸å¼éè¿æ¥è¯¢æ¬èº«ãå½åè¦æ¥è¯¢çæ°æ®åºãå®¢æ·ç«¯åè®®çæ¬å·ç­ä¸äºå¯è½å½±åç»æçä¿¡æ¯è®¡ç®å¾æ¥ãæä»¥ä¸¤ä¸ªæ¥è¯¢å¨ä»»ä½å­ç¬¦ä¸çä¸åï¼ä¾å¦ï¼ç©ºæ ¼ãæ³¨éï¼ï¼é½ä¼å¯¼è´ç¼å­ä¸ä¼å½ä¸­ã\n\nå¦ææ¥è¯¢ä¸­åå«ä»»ä½ç¨æ·èªå®ä¹å½æ°ãå­å¨å½æ°ãç¨æ·åéãä¸´æ¶è¡¨ãmysql åºä¸­çç³»ç»è¡¨ï¼å¶æ¥è¯¢ç»æé½ä¸ä¼è¢«ç¼å­ãæ¯å¦å½æ°NOW()æèCURRENT_DATE()ä¼å ä¸ºä¸åçæ¥è¯¢æ¶é´ï¼è¿åä¸åçæ¥è¯¢ç»æï¼åæ¯å¦åå«CURRENT_USERæèCONNECION_ID()çæ¥è¯¢è¯­å¥ä¼å ä¸ºä¸åçç¨æ·èè¿åä¸åçç»æï¼å°è¿æ ·çæ¥è¯¢ç»æç¼å­èµ·æ¥æ²¡æä»»ä½çæä¹ã\n\nä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ãæ¥è¯¢ç¼å­çå¤±æéå¸¸é¢ç¹ï¼åªè¦æå¯¹ä¸ä¸ªè¡¨çæ´æ°ï¼è¿ä¸ªè¡¨ä¸ææçæ¥è¯¢ç¼å­é½ä¼è¢«æ¸ç©ºãå æ­¤å¾å¯è½ä½ è´¹å²å°æç»æå­èµ·æ¥ï¼è¿æ²¡ä½¿ç¨å¢ï¼å°±è¢«ä¸ä¸ªæ´æ°å¨æ¸ç©ºäºãå¯¹äºæ´æ°ååå¤§çæ°æ®åºæ¥è¯´ï¼æ¥è¯¢ç¼å­çå½ä¸­çä¼éå¸¸ä½ãé¤éä½ çä¸å¡å°±æ¯æä¸å¼ éæè¡¨ï¼å¾é¿æ¶é´æä¼æ´æ°ä¸æ¬¡ãæ¯å¦ï¼ä¸ä¸ªç³»ç»éç½®è¡¨ï¼é£è¿å¼ è¡¨ä¸çæ¥è¯¢æéåä½¿ç¨æ¥è¯¢ç¼å­ã\n\nå¥½å¨ MySQL ä¹æä¾äºè¿ç§âæéä½¿ç¨âçæ¹å¼ãä½ å¯ä»¥å°åæ° query_cache_type è®¾ç½®æ DEMANDï¼è¿æ ·å¯¹äºé»è®¤ç SQL è¯­å¥é½ä¸ä½¿ç¨æ¥è¯¢ç¼å­ãèå¯¹äºä½ ç¡®å®è¦ä½¿ç¨æ¥è¯¢ç¼å­çè¯­å¥ï¼å¯ä»¥ç¨ SQL_CACHE æ¾å¼æå®ï¼åä¸é¢è¿ä¸ªè¯­å¥ä¸æ ·ï¼\n\nselect SQL_CACHE * from T where ID=10;\n\n\n> æ³¨æï¼MySQL 8.0 çæ¬ç´æ¥å°æ¥è¯¢ç¼å­çæ´ååè½å æäºã\n\n\n# 2.3. ï¼ä¸ï¼è¯­æ³åæ\n\nå¦ææ²¡æå½ä¸­æ¥è¯¢ç¼å­ï¼å°±è¦å¼å§çæ­£æ§è¡è¯­å¥äºãé¦åï¼MySQL éè¦ç¥éä½ è¦åä»ä¹ï¼å æ­¤éè¦å¯¹ SQL è¯­å¥åè§£æãMySQL éè¿å³é®å­å¯¹ SQL è¯­å¥è¿è¡è§£æï¼å¹¶çæä¸é¢å¯¹åºçè¯­æ³è§£ææ ãè¿ä¸ªè¿ç¨ä¸­ï¼åæå¨ä¸»è¦éè¿è¯­æ³è§åæ¥éªè¯åè§£æãæ¯å¦ SQL ä¸­æ¯å¦ä½¿ç¨äºéè¯¯çå³é®å­æèå³é®å­çé¡ºåºæ¯å¦æ­£ç¡®ç­ç­ãé¢å¤çåä¼æ ¹æ® MySQL è§åè¿ä¸æ­¥æ£æ¥è§£ææ æ¯å¦åæ³ãæ¯å¦æ£æ¥è¦æ¥è¯¢çæ°æ®è¡¨åæ°æ®åæ¯å¦å­å¨ç­ç­ã\n\n * åæå¨åä¼ååâè¯æ³åæâãä½ è¾å¥çæ¯ç±å¤ä¸ªå­ç¬¦ä¸²åç©ºæ ¼ç»æçä¸æ¡ SQL è¯­å¥ï¼MySQL éè¦è¯å«åºéé¢çå­ç¬¦ä¸²åå«æ¯ä»ä¹ï¼ä»£è¡¨ä»ä¹ãMySQL ä»ä½ è¾å¥ç"select"è¿ä¸ªå³é®å­è¯å«åºæ¥ï¼è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ãå®ä¹è¦æå­ç¬¦ä¸²âTâè¯å«æâè¡¨å Tâï¼æå­ç¬¦ä¸²âIDâè¯å«æâå IDâã\n * æ¥ä¸æ¥ï¼è¦åâè¯­æ³åæâãæ ¹æ®è¯æ³åæçç»æï¼è¯­æ³åæå¨ä¼æ ¹æ®è¯­æ³è§åï¼å¤æ­ä½ è¾å¥çè¿ä¸ª SQL è¯­å¥æ¯å¦æ»¡è¶³ MySQL è¯­æ³ãå¦æä½ çè¯­å¥ä¸å¯¹ï¼å°±ä¼æ¶å°âYou have an error in your SQL syntaxâçéè¯¯æéï¼æ¯å¦ä¸é¢è¿ä¸ªè¯­å¥ select å°æäºå¼å¤´çå­æ¯âsâã\n\n\n# 2.4. ï¼åï¼æ¥è¯¢ä¼å\n\nç»è¿äºåæå¨ï¼MySQL å°±ç¥éä½ è¦åä»ä¹äºãå¨å¼å§æ§è¡ä¹åï¼è¿è¦åç»è¿ä¼åå¨çå¤çã\n\nç»è¿åé¢çæ­¥éª¤çæçè¯­æ³æ è¢«è®¤ä¸ºæ¯åæ³çäºï¼å¹¶ä¸ç±ä¼åå¨å°å¶è½¬åææ§è¡è®¡åãå¤æ°æåµä¸ï¼ä¸æ¡æ¥è¯¢å¯ä»¥æå¾å¤ç§æ§è¡æ¹å¼ï¼æåé½è¿åç¸åºçç»æãä¼åå¨çä½ç¨å°±æ¯æ¾å°è¿å¶ä¸­æå¥½çæ§è¡è®¡åã\n\nMySQL ä½¿ç¨åºäºææ¬çä¼åå¨ï¼å®å°è¯é¢æµä¸ä¸ªæ¥è¯¢ä½¿ç¨æç§æ§è¡è®¡åæ¶çææ¬ï¼å¹¶éæ©å¶ä¸­ææ¬æå°çä¸ä¸ªãå¨ MySQL å¯ä»¥éè¿æ¥è¯¢å½åä¼è¯ç last_query_cost çå¼æ¥å¾å°å¶è®¡ç®å½åæ¥è¯¢çææ¬ã\n\nmysql> select * from t_message limit 10;\n...çç¥ç»æé\n\nmysql> show status like \'last_query_cost\';\n+-----------------+-------------+\n| Variable_name   | Value       |\n+-----------------+-------------+\n| Last_query_cost | 6391.799000 |\n+-----------------+-------------+\n\n\nç¤ºä¾ä¸­çç»æè¡¨ç¤ºä¼åå¨è®¤ä¸ºå¤§æ¦éè¦å 6391 ä¸ªæ°æ®é¡µçéæºæ¥æ¾æè½å®æä¸é¢çæ¥è¯¢ãè¿ä¸ªç»ææ¯æ ¹æ®ä¸äºåçç»è®¡ä¿¡æ¯è®¡ç®å¾æ¥çï¼è¿äºç»è®¡ä¿¡æ¯åæ¬ï¼æ¯å¼ è¡¨æèç´¢å¼çé¡µé¢ä¸ªæ°ãç´¢å¼çåºæ°ãç´¢å¼åæ°æ®è¡çé¿åº¦ãç´¢å¼çåå¸æåµç­ç­ã\n\næéå¸¸å¤çåå ä¼å¯¼è´ MySQL éæ©éè¯¯çæ§è¡è®¡åï¼æ¯å¦ç»è®¡ä¿¡æ¯ä¸åç¡®ãä¸ä¼èèä¸åå¶æ§å¶çæä½ææ¬ï¼ç¨æ·èªå®ä¹å½æ°ãå­å¨è¿ç¨ï¼ãMySQL è®¤ä¸ºçæä¼è·æä»¬æ³çä¸ä¸æ ·ï¼æä»¬å¸ææ§è¡æ¶é´å°½å¯è½ç­ï¼ä½ MySQL å¼éæ©å®è®¤ä¸ºææ¬å°çï¼ä½ææ¬å°å¹¶ä¸æå³çæ§è¡æ¶é´ç­ï¼ç­ç­ã\n\nMySQL çæ¥è¯¢ä¼åå¨æ¯ä¸ä¸ªéå¸¸å¤æçé¨ä»¶ï¼å®ä½¿ç¨äºéå¸¸å¤çä¼åç­ç¥æ¥çæä¸ä¸ªæä¼çæ§è¡è®¡åï¼\n\n * éæ°å®ä¹è¡¨çå³èé¡ºåºï¼å¤å¼ è¡¨å³èæ¥è¯¢æ¶ï¼å¹¶ä¸ä¸å®æç§ SQL ä¸­æå®çé¡ºåºè¿è¡ï¼ä½æä¸äºæå·§å¯ä»¥æå®å³èé¡ºåºï¼\n * ä¼åMIN()åMAX()å½æ°ï¼æ¾æåçæå°å¼ï¼å¦æè¯¥åæç´¢å¼ï¼åªéè¦æ¥æ¾ B+Tree ç´¢å¼æå·¦ç«¯ï¼åä¹åå¯ä»¥æ¾å°æå¤§å¼ï¼å·ä½åçè§ä¸æï¼\n * æåç»æ­¢æ¥è¯¢ï¼æ¯å¦ï¼ä½¿ç¨ Limit æ¶ï¼æ¥æ¾å°æ»¡è¶³æ°éçç»æéåä¼ç«å³ç»æ­¢æ¥è¯¢ï¼\n * ä¼åæåºï¼å¨èçæ¬ MySQL ä¼ä½¿ç¨ä¸¤æ¬¡ä¼ è¾æåºï¼å³åè¯»åè¡æéåéè¦æåºçå­æ®µå¨åå­ä¸­å¯¹å¶æåºï¼ç¶ååæ ¹æ®æåºç»æå»è¯»åæ°æ®è¡ï¼èæ°çæ¬éç¨çæ¯åæ¬¡ä¼ è¾æåºï¼ä¹å°±æ¯ä¸æ¬¡è¯»åææçæ°æ®è¡ï¼ç¶åæ ¹æ®ç»å®çåæåºãå¯¹äº I/O å¯éååºç¨ï¼æçä¼é«å¾å¤ï¼\n\néç MySQL çä¸æ­åå±ï¼ä¼åå¨ä½¿ç¨çä¼åç­ç¥ä¹å¨ä¸æ­çè¿åï¼è¿éä»ä»ä»ç»å ä¸ªéå¸¸å¸¸ç¨ä¸å®¹æçè§£çä¼åç­ç¥ï¼å¶ä»çä¼åç­ç¥ï¼å¤§å®¶èªè¡æ¥éå§ã\n\n\n# 2.5. ï¼äºï¼æ¥è¯¢æ§è¡å¼æ\n\nå¨å®æè§£æåä¼åé¶æ®µä»¥åï¼MySQL ä¼çæå¯¹åºçæ§è¡è®¡åï¼æ¥è¯¢æ§è¡å¼ææ ¹æ®æ§è¡è®¡åç»åºçæä»¤éæ­¥æ§è¡å¾åºç»æãæ´ä¸ªæ§è¡è¿ç¨çå¤§é¨åæä½åæ¯éè¿è°ç¨å­å¨å¼æå®ç°çæ¥å£æ¥å®æï¼è¿äºæ¥å£è¢«ç§°ä¸ºhandler APIãæ¥è¯¢è¿ç¨ä¸­çæ¯ä¸å¼ è¡¨ç±ä¸ä¸ªhandlerå®ä¾è¡¨ç¤ºãå®éä¸ï¼MySQL å¨æ¥è¯¢ä¼åé¶æ®µå°±ä¸ºæ¯ä¸å¼ è¡¨åå»ºäºä¸ä¸ªhandlerå®ä¾ï¼ä¼åå¨å¯ä»¥æ ¹æ®è¿äºå®ä¾çæ¥å£æ¥è·åè¡¨çç¸å³ä¿¡æ¯ï¼åæ¬è¡¨çææååãç´¢å¼ç»è®¡ä¿¡æ¯ç­ãå­å¨å¼ææ¥å£æä¾äºéå¸¸ä¸°å¯çåè½ï¼ä½å¶åºå±ä»æå åä¸ªæ¥å£ï¼è¿äºæ¥å£åæ­ç§¯æ¨ä¸æ ·å®æäºä¸æ¬¡æ¥è¯¢çå¤§é¨åæä½ã\n\n\n# 2.6. ï¼å­ï¼è¿åç»æ\n\næ¥è¯¢è¿ç¨çæåä¸ä¸ªé¶æ®µå°±æ¯å°ç»æè¿åç»å®¢æ·ç«¯ãå³ä½¿æ¥è¯¢ä¸å°æ°æ®ï¼MySQL ä»ç¶ä¼è¿åè¿ä¸ªæ¥è¯¢çç¸å³ä¿¡æ¯ï¼æ¯å¦è¯¥æ¥è¯¢å½±åå°çè¡æ°ä»¥åæ§è¡æ¶é´ç­ç­ã\n\nå¦ææ¥è¯¢ç¼å­è¢«æå¼ä¸è¿ä¸ªæ¥è¯¢å¯ä»¥è¢«ç¼å­ï¼MySQL ä¹ä¼å°ç»æå­æ¾å°ç¼å­ä¸­ã\n\nç»æéè¿åå®¢æ·ç«¯æ¯ä¸ä¸ªå¢éä¸éæ­¥è¿åçè¿ç¨ãæå¯è½ MySQL å¨çæç¬¬ä¸æ¡ç»ææ¶ï¼å°±å¼å§åå®¢æ·ç«¯éæ­¥è¿åç»æéäºãè¿æ ·æå¡ç«¯å°±æ é¡»å­å¨å¤ªå¤ç»æèæ¶èè¿å¤åå­ï¼ä¹å¯ä»¥è®©å®¢æ·ç«¯ç¬¬ä¸æ¶é´è·å¾è¿åç»æãéè¦æ³¨æçæ¯ï¼ç»æéä¸­çæ¯ä¸è¡é½ä¼ä»¥ä¸ä¸ªæ»¡è¶³ â  ä¸­ææè¿°çéä¿¡åè®®çæ°æ®ååéï¼åéè¿ TCP åè®®è¿è¡ä¼ è¾ï¼å¨ä¼ è¾è¿ç¨ä¸­ï¼å¯è½å¯¹ MySQL çæ°æ®åè¿è¡ç¼å­ç¶åæ¹éåéã\n\n\n# 3. æ´æ°è¿ç¨\n\nMySQL æ´æ°è¿ç¨å MySQL æ¥è¯¢è¿ç¨ç±»ä¼¼ï¼ä¹ä¼å°æµç¨èµ°ä¸éãä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡åï¼ï¼redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼ã\n\n\n# 3.1. redo log\n\nredo log æ¯ InnoDB å¼æç¹æçæ¥å¿ãredo log å³éåæ¥å¿ãredo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âã\n\nredo log æ¯åºäº WAL ææ¯ãWAL çå¨ç§°æ¯ Write-Ahead Loggingï¼å®çå³é®ç¹å°±æ¯ååæ¥å¿ï¼ååç£çãå·ä½æ¥è¯´ï¼å½æä¸æ¡è®°å½éè¦æ´æ°çæ¶åï¼InnoDB å¼æå°±ä¼åæè®°å½åå° redo log éï¼å¹¶æ´æ°åå­ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäºãåæ¶ï¼InnoDB å¼æä¼å¨éå½çæ¶åï¼å°è¿ä¸ªæä½è®°å½æ´æ°å°ç£çéé¢ï¼èè¿ä¸ªæ´æ°å¾å¾æ¯å¨ç³»ç»æ¯è¾ç©ºé²çæ¶ååã\n\nInnoDB ç redo log æ¯åºå®å¤§å°çï¼æ¯å¦å¯ä»¥éç½®ä¸ºä¸ç» 4 ä¸ªæä»¶ï¼æ¯ä¸ªæä»¶çå¤§å°æ¯ 1GBï¼é£ä¹è¿åâç²æ¿âæ»å±å°±å¯ä»¥è®°å½ 4GB çæä½ãä»å¤´å¼å§åï¼åå°æ«å°¾å°±ååå°å¼å¤´å¾ªç¯åã\n\n\n\næäº redo logï¼InnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±ï¼è¿ä¸ªè½åç§°ä¸ºcrash-safeã\n\n\n# 3.2. bin log\n\nbin log å³å½æ¡£æ¥å¿ãbinlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ã\n\nbinlog æ¯å¯ä»¥è¿½å åå¥çï¼å³åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\nbinlog æ¯ MySQL ç Server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n\nsync_binlog è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç binlog é½æä¹åå°ç£çãè¿ä¸ªåæ°æä¹å»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ MySQL å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n\n\n# 3.3. redo log vs. bin log\n\nè¿ä¸¤ç§æ¥å¿æä»¥ä¸ä¸ç¹ä¸åã\n\n * redo log æ¯ InnoDB å¼æç¹æçï¼binlog æ¯ MySQL ç Server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n * redo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç» ID=2 è¿ä¸è¡ç c å­æ®µå  1 âã\n * redo log æ¯å¾ªç¯åçï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlog æ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æ binlog æä»¶åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\næäºå¯¹è¿ä¸¤ä¸ªæ¥å¿çæ¦å¿µæ§çè§£ï¼æä»¬åæ¥çæ§è¡å¨å InnoDB å¼æå¨æ§è¡è¿ä¸ªç®åç update è¯­å¥æ¶çåé¨æµç¨ã\n\n 1. æ§è¡å¨åæ¾å¼æå ID=2 è¿ä¸è¡ãID æ¯ä¸»é®ï¼å¼æç´æ¥ç¨æ æç´¢æ¾å°è¿ä¸è¡ãå¦æ ID=2 è¿ä¸è¡æå¨çæ°æ®é¡µæ¬æ¥å°±å¨åå­ä¸­ï¼å°±ç´æ¥è¿åç»æ§è¡å¨ï¼å¦åï¼éè¦åä»ç£çè¯»å¥åå­ï¼ç¶ååè¿åã\n 2. æ§è¡å¨æ¿å°å¼æç»çè¡æ°æ®ï¼æè¿ä¸ªå¼å ä¸ 1ï¼æ¯å¦åæ¥æ¯ Nï¼ç°å¨å°±æ¯ N+1ï¼å¾å°æ°çä¸è¡æ°æ®ï¼åè°ç¨å¼ææ¥å£åå¥è¿è¡æ°æ°æ®ã\n 3. å¼æå°è¿è¡æ°æ°æ®æ´æ°å°åå­ä¸­ï¼åæ¶å°è¿ä¸ªæ´æ°æä½è®°å½å° redo log éé¢ï¼æ­¤æ¶ redo log å¤äº prepare ç¶æãç¶ååç¥æ§è¡å¨æ§è¡å®æäºï¼éæ¶å¯ä»¥æäº¤äºå¡ã\n 4. æ§è¡å¨çæè¿ä¸ªæä½ç binlogï¼å¹¶æ binlog åå¥ç£çã\n 5. æ§è¡å¨è°ç¨å¼æçæäº¤äºå¡æ¥å£ï¼å¼ææåååå¥ç redo log æ¹ææäº¤ï¼commitï¼ç¶æï¼æ´æ°å®æã\n\nè¿éæç»åºè¿ä¸ª update è¯­å¥çæ§è¡æµç¨å¾ï¼å¾ä¸­æµè²æ¡è¡¨ç¤ºæ¯å¨ InnoDB åé¨æ§è¡çï¼æ·±è²æ¡è¡¨ç¤ºæ¯å¨æ§è¡å¨ä¸­æ§è¡çã\n\n\n\n\n# 3.4. ä¸¤é¶æ®µæäº¤\n\nredo log çåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepare å commitï¼è¿å°±æ¯"ä¸¤é¶æ®µæäº¤"ãä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âã\n\nç±äº redo log å binlog æ¯ä¸¤ä¸ªç¬ç«çé»è¾ï¼å¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼è¦ä¹å°±æ¯ååå® redo log åå binlogï¼æèéç¨åè¿æ¥çé¡ºåºãæä»¬ççè¿ä¸¤ç§æ¹å¼ä¼æä»ä¹é®é¢ã\n\n * åå redo log åå binlogãåè®¾å¨ redo log åå®ï¼binlog è¿æ²¡æåå®çæ¶åï¼MySQL è¿ç¨å¼å¸¸éå¯ãç±äºæä»¬åé¢è¯´è¿çï¼redo log åå®ä¹åï¼ç³»ç»å³ä½¿å´©æºï¼ä»ç¶è½å¤ææ°æ®æ¢å¤åæ¥ï¼æä»¥æ¢å¤åè¿ä¸è¡ c çå¼æ¯ 1ã ä½æ¯ç±äº binlog æ²¡åå®å°± crash äºï¼è¿æ¶å binlog éé¢å°±æ²¡æè®°å½è¿ä¸ªè¯­å¥ãå æ­¤ï¼ä¹åå¤ä»½æ¥å¿çæ¶åï¼å­èµ·æ¥ç binlog éé¢å°±æ²¡æè¿æ¡è¯­å¥ã ç¶åä½ ä¼åç°ï¼å¦æéè¦ç¨è¿ä¸ª binlog æ¥æ¢å¤ä¸´æ¶åºçè¯ï¼ç±äºè¿ä¸ªè¯­å¥ç binlog ä¸¢å¤±ï¼è¿ä¸ªä¸´æ¶åºå°±ä¼å°äºè¿ä¸æ¬¡æ´æ°ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 0ï¼ä¸ååºçå¼ä¸åã\n * åå binlog åå redo logãå¦æå¨ binlog åå®ä¹å crashï¼ç±äº redo log è¿æ²¡åï¼å´©æºæ¢å¤ä»¥åè¿ä¸ªäºå¡æ æï¼æä»¥è¿ä¸è¡ c çå¼æ¯ 0ãä½æ¯ binlog éé¢å·²ç»è®°å½äºâæ c ä» 0 æ¹æ 1âè¿ä¸ªæ¥å¿ãæä»¥ï¼å¨ä¹åç¨ binlog æ¥æ¢å¤çæ¶åå°±å¤äºä¸ä¸ªäºå¡åºæ¥ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 1ï¼ä¸ååºçå¼ä¸åã\n\nå¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºçç¶æä¸ä¸è´ã\n\n\n# 4. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * MySQL å®æ 45 è®²',normalizedContent:'# mysql å·¥ä½æµ\n\n\n# 1. åºç¡æ¶æ\n\nå¤§ä½æ¥è¯´ï¼mysql å¯ä»¥åä¸º server å±åå­å¨å¼æå±ä¸¤é¨åã\n\nserver å±åæ¬è¿æ¥å¨ãæ¥è¯¢ç¼å­ãåæå¨ãä¼åå¨ãæ§è¡å¨ç­ï¼æ¶µç mysql çå¤§å¤æ°æ ¸å¿æå¡åè½ï¼ä»¥åææçåç½®å½æ°ï¼å¦æ¥æãæ¶é´ãæ°å­¦åå å¯å½æ°ç­ï¼ï¼ææè·¨å­å¨å¼æçåè½é½å¨è¿ä¸å±å®ç°ï¼æ¯å¦å­å¨è¿ç¨ãè§¦åå¨ãè§å¾ç­ã\n\nå­å¨å¼æå±è´è´£æ°æ®çå­å¨åæåãå¶æ¶ææ¨¡å¼æ¯æä»¶å¼çï¼æ¯æ innodbãmyisamãmemory ç­å¤ä¸ªå­å¨å¼æãç°å¨æå¸¸ç¨çå­å¨å¼ææ¯ innodbï¼å®ä» mysql 5.5.5 çæ¬å¼å§æä¸ºäºé»è®¤å­å¨å¼æã\n\n\n\n\n# 2. æ¥è¯¢è¿ç¨\n\nsql è¯­å¥å¨ mysql ä¸­æ¯å¦ä½æ§è¡çï¼\n\nmysql æ´ä¸ªæ¥è¯¢æ§è¡è¿ç¨ï¼æ»çæ¥è¯´åä¸º 6 ä¸ªæ­¥éª¤ï¼\n\n 1. å®¢æ·ç«¯å mysql æå¡å¨å»ºç«è¿æ¥ï¼å®¢æ·ç«¯å mysql æå¡å¨åéä¸æ¡æ¥è¯¢è¯·æ±ã\n 2. mysql æå¡å¨é¦åæ£æ¥æ¥è¯¢ç¼å­ï¼å¦æå½ä¸­ç¼å­ï¼åç«å»è¿åç»æãå¦åè¿å¥ä¸ä¸é¶æ®µã\n 3. mysql æå¡å¨è¿è¡ sql åæï¼è¯­æ³åæãè¯æ³åæã\n 4. mysql æå¡å¨ç¨ä¼åå¨çæå¯¹åºçæ§è¡è®¡åã\n 5. mysql æå¡å¨æ ¹æ®æ§è¡è®¡åï¼è°ç¨å­å¨å¼æç api æ¥æ§è¡æ¥è¯¢ã\n 6. mysql æå¡å¨å°ç»æè¿åç»å®¢æ·ç«¯ï¼åæ¶ç¼å­æ¥è¯¢ç»æã\n\n\n# 2.1. ï¼ä¸ï¼è¿æ¥\n\nä½¿ç¨ mysql ç¬¬ä¸æ­¥èªç¶æ¯è¦è¿æ¥æ°æ®åºã\n\nmysql å®¢æ·ç«¯/æå¡ç«¯éä¿¡æ¯ååå·¥æ¨¡å¼ï¼å³ä»»ä¸æ¶å»ï¼è¦ä¹æ¯æå¡ç«¯åå®¢æ·ç«¯åéæ°æ®ï¼è¦ä¹æ¯å®¢æ·ç«¯åæå¡å¨åéæ°æ®ãå®¢æ·ç«¯ç¨ä¸ä¸ªåç¬çæ°æ®åå°æ¥è¯¢è¯·æ±åéç»æå¡å¨ï¼æä»¥å½æ¥è¯¢è¯­å¥å¾é¿çæ¶åï¼éè¦è®¾ç½®max_allowed_packetåæ°ãä½æ¯éè¦æ³¨æçæ¯ï¼å¦ææ¥è¯¢å®å¨æ¯å¤ªå¤§ï¼æå¡ç«¯ä¼æç»æ¥æ¶æ´å¤æ°æ®å¹¶æåºå¼å¸¸ã\n\nmysql å®¢æ·ç«¯è¿æ¥å½ä»¤ï¼mysql -h<ä¸»æº> -p<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >ãå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãå®¢æ·ç«¯è¿æ¥ç»´ææ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ãå¦æå¨è¿æ¥è¢«æ­å¼ä¹åï¼å®¢æ·ç«¯åæ¬¡åéè¯·æ±çè¯ï¼å°±ä¼æ¶å°ä¸ä¸ªéè¯¯æéï¼ lost connection to mysql server during queryãè¿æ¶åå¦æä½ è¦ç»§ç»­ï¼å°±éè¦éè¿ï¼ç¶ååæ§è¡è¯·æ±äºã\n\nå»ºç«è¿æ¥çè¿ç¨éå¸¸æ¯æ¯è¾å¤æçï¼å»ºè®®å¨ä½¿ç¨ä¸­è¦å°½éåå°å»ºç«è¿æ¥çå¨ä½ï¼ä¹å°±æ¯å°½éä½¿ç¨é¿è¿æ¥ãä¸ºäºå¨ç¨åºä¸­æé«æ°æ®åºè¿æ¥çæç¨äºï¼ä¸è¬ä¼ä½¿ç¨æ°æ®åºè¿æ¥æ± æ¥ç»´æ¤ç®¡çã\n\nä½æ¯å¨é¨ä½¿ç¨é¿è¿æ¥åï¼ä½ å¯è½ä¼åç°ï¼æäºæ¶å mysql å ç¨åå­æ¶¨å¾ç¹å«å¿«ï¼è¿æ¯å ä¸º mysql å¨æ§è¡è¿ç¨ä¸­ä¸´æ¶ä½¿ç¨çåå­æ¯ç®¡çå¨è¿æ¥å¯¹è±¡éé¢çãè¿äºèµæºä¼å¨è¿æ¥æ­å¼çæ¶åæéæ¾ãæä»¥å¦æé¿è¿æ¥ç´¯ç§¯ä¸æ¥ï¼å¯è½å¯¼è´åå­å ç¨å¤ªå¤§ï¼è¢«ç³»ç»å¼ºè¡ææï¼oomï¼ï¼ä»ç°è±¡çå°±æ¯ mysql å¼å¸¸éå¯äºã\n\næä¹è§£å³è¿ä¸ªé®é¢å¢ï¼ä½ å¯ä»¥èèä»¥ä¸ä¸¤ç§æ¹æ¡ã\n\n * å®ææ­å¼é¿è¿æ¥ãä½¿ç¨ä¸æ®µæ¶é´ï¼æèç¨åºéé¢å¤æ­æ§è¡è¿ä¸ä¸ªå ç¨åå­çå¤§æ¥è¯¢åï¼æ­å¼è¿æ¥ï¼ä¹åè¦æ¥è¯¢åéè¿ã\n * å¦æä½ ç¨çæ¯ mysql 5.7 ææ´æ°çæ¬ï¼å¯ä»¥å¨æ¯æ¬¡æ§è¡ä¸ä¸ªæ¯è¾å¤§çæä½åï¼éè¿æ§è¡ mysql_reset_connection æ¥éæ°åå§åè¿æ¥èµæºãè¿ä¸ªè¿ç¨ä¸éè¦éè¿åéæ°åæééªè¯ï¼ä½æ¯ä¼å°è¿æ¥æ¢å¤å°åååå»ºå®æ¶çç¶æã\n\n\n# 2.2. ï¼äºï¼æ¥è¯¢ç¼å­\n\n> ä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ã\n\nè§£æä¸ä¸ªæ¥è¯¢è¯­å¥åï¼å¦ææ¥è¯¢ç¼å­æ¯æå¼çï¼é£ä¹ mysql ä¼æ£æ¥è¿ä¸ªæ¥è¯¢è¯­å¥æ¯å¦å½ä¸­æ¥è¯¢ç¼å­ä¸­çæ°æ®ãå¦æå½åæ¥è¯¢æ°å¥½å½ä¸­æ¥è¯¢ç¼å­ï¼å¨æ£æ¥ä¸æ¬¡ç¨æ·æéåç´æ¥è¿åç¼å­ä¸­çç»æãè¿ç§æåµä¸ï¼æ¥è¯¢ä¸ä¼è¢«è§£æï¼ä¹ä¸ä¼çææ§è¡è®¡åï¼æ´ä¸ä¼æ§è¡ã\n\nmysql å°ç¼å­å­æ¾å¨ä¸ä¸ªå¼ç¨è¡¨ï¼ä¸è¦çè§£ætableï¼å¯ä»¥è®¤ä¸ºæ¯ç±»ä¼¼äºhashmapçæ°æ®ç»æï¼ï¼éè¿ä¸ä¸ªåå¸å¼ç´¢å¼ï¼è¿ä¸ªåå¸å¼éè¿æ¥è¯¢æ¬èº«ãå½åè¦æ¥è¯¢çæ°æ®åºãå®¢æ·ç«¯åè®®çæ¬å·ç­ä¸äºå¯è½å½±åç»æçä¿¡æ¯è®¡ç®å¾æ¥ãæä»¥ä¸¤ä¸ªæ¥è¯¢å¨ä»»ä½å­ç¬¦ä¸çä¸åï¼ä¾å¦ï¼ç©ºæ ¼ãæ³¨éï¼ï¼é½ä¼å¯¼è´ç¼å­ä¸ä¼å½ä¸­ã\n\nå¦ææ¥è¯¢ä¸­åå«ä»»ä½ç¨æ·èªå®ä¹å½æ°ãå­å¨å½æ°ãç¨æ·åéãä¸´æ¶è¡¨ãmysql åºä¸­çç³»ç»è¡¨ï¼å¶æ¥è¯¢ç»æé½ä¸ä¼è¢«ç¼å­ãæ¯å¦å½æ°now()æècurrent_date()ä¼å ä¸ºä¸åçæ¥è¯¢æ¶é´ï¼è¿åä¸åçæ¥è¯¢ç»æï¼åæ¯å¦åå«current_useræèconnecion_id()çæ¥è¯¢è¯­å¥ä¼å ä¸ºä¸åçç¨æ·èè¿åä¸åçç»æï¼å°è¿æ ·çæ¥è¯¢ç»æç¼å­èµ·æ¥æ²¡æä»»ä½çæä¹ã\n\nä¸å»ºè®®ä½¿ç¨æ°æ®åºç¼å­ï¼å ä¸ºå¾å¾å¼å¤§äºå©ãæ¥è¯¢ç¼å­çå¤±æéå¸¸é¢ç¹ï¼åªè¦æå¯¹ä¸ä¸ªè¡¨çæ´æ°ï¼è¿ä¸ªè¡¨ä¸ææçæ¥è¯¢ç¼å­é½ä¼è¢«æ¸ç©ºãå æ­¤å¾å¯è½ä½ è´¹å²å°æç»æå­èµ·æ¥ï¼è¿æ²¡ä½¿ç¨å¢ï¼å°±è¢«ä¸ä¸ªæ´æ°å¨æ¸ç©ºäºãå¯¹äºæ´æ°ååå¤§çæ°æ®åºæ¥è¯´ï¼æ¥è¯¢ç¼å­çå½ä¸­çä¼éå¸¸ä½ãé¤éä½ çä¸å¡å°±æ¯æä¸å¼ éæè¡¨ï¼å¾é¿æ¶é´æä¼æ´æ°ä¸æ¬¡ãæ¯å¦ï¼ä¸ä¸ªç³»ç»éç½®è¡¨ï¼é£è¿å¼ è¡¨ä¸çæ¥è¯¢æéåä½¿ç¨æ¥è¯¢ç¼å­ã\n\nå¥½å¨ mysql ä¹æä¾äºè¿ç§âæéä½¿ç¨âçæ¹å¼ãä½ å¯ä»¥å°åæ° query_cache_type è®¾ç½®æ demandï¼è¿æ ·å¯¹äºé»è®¤ç sql è¯­å¥é½ä¸ä½¿ç¨æ¥è¯¢ç¼å­ãèå¯¹äºä½ ç¡®å®è¦ä½¿ç¨æ¥è¯¢ç¼å­çè¯­å¥ï¼å¯ä»¥ç¨ sql_cache æ¾å¼æå®ï¼åä¸é¢è¿ä¸ªè¯­å¥ä¸æ ·ï¼\n\nselect sql_cache * from t where id=10;\n\n\n> æ³¨æï¼mysql 8.0 çæ¬ç´æ¥å°æ¥è¯¢ç¼å­çæ´ååè½å æäºã\n\n\n# 2.3. ï¼ä¸ï¼è¯­æ³åæ\n\nå¦ææ²¡æå½ä¸­æ¥è¯¢ç¼å­ï¼å°±è¦å¼å§çæ­£æ§è¡è¯­å¥äºãé¦åï¼mysql éè¦ç¥éä½ è¦åä»ä¹ï¼å æ­¤éè¦å¯¹ sql è¯­å¥åè§£æãmysql éè¿å³é®å­å¯¹ sql è¯­å¥è¿è¡è§£æï¼å¹¶çæä¸é¢å¯¹åºçè¯­æ³è§£ææ ãè¿ä¸ªè¿ç¨ä¸­ï¼åæå¨ä¸»è¦éè¿è¯­æ³è§åæ¥éªè¯åè§£æãæ¯å¦ sql ä¸­æ¯å¦ä½¿ç¨äºéè¯¯çå³é®å­æèå³é®å­çé¡ºåºæ¯å¦æ­£ç¡®ç­ç­ãé¢å¤çåä¼æ ¹æ® mysql è§åè¿ä¸æ­¥æ£æ¥è§£ææ æ¯å¦åæ³ãæ¯å¦æ£æ¥è¦æ¥è¯¢çæ°æ®è¡¨åæ°æ®åæ¯å¦å­å¨ç­ç­ã\n\n * åæå¨åä¼ååâè¯æ³åæâãä½ è¾å¥çæ¯ç±å¤ä¸ªå­ç¬¦ä¸²åç©ºæ ¼ç»æçä¸æ¡ sql è¯­å¥ï¼mysql éè¦è¯å«åºéé¢çå­ç¬¦ä¸²åå«æ¯ä»ä¹ï¼ä»£è¡¨ä»ä¹ãmysql ä»ä½ è¾å¥ç"select"è¿ä¸ªå³é®å­è¯å«åºæ¥ï¼è¿æ¯ä¸ä¸ªæ¥è¯¢è¯­å¥ãå®ä¹è¦æå­ç¬¦ä¸²âtâè¯å«æâè¡¨å tâï¼æå­ç¬¦ä¸²âidâè¯å«æâå idâã\n * æ¥ä¸æ¥ï¼è¦åâè¯­æ³åæâãæ ¹æ®è¯æ³åæçç»æï¼è¯­æ³åæå¨ä¼æ ¹æ®è¯­æ³è§åï¼å¤æ­ä½ è¾å¥çè¿ä¸ª sql è¯­å¥æ¯å¦æ»¡è¶³ mysql è¯­æ³ãå¦æä½ çè¯­å¥ä¸å¯¹ï¼å°±ä¼æ¶å°âyou have an error in your sql syntaxâçéè¯¯æéï¼æ¯å¦ä¸é¢è¿ä¸ªè¯­å¥ select å°æäºå¼å¤´çå­æ¯âsâã\n\n\n# 2.4. ï¼åï¼æ¥è¯¢ä¼å\n\nç»è¿äºåæå¨ï¼mysql å°±ç¥éä½ è¦åä»ä¹äºãå¨å¼å§æ§è¡ä¹åï¼è¿è¦åç»è¿ä¼åå¨çå¤çã\n\nç»è¿åé¢çæ­¥éª¤çæçè¯­æ³æ è¢«è®¤ä¸ºæ¯åæ³çäºï¼å¹¶ä¸ç±ä¼åå¨å°å¶è½¬åææ§è¡è®¡åãå¤æ°æåµä¸ï¼ä¸æ¡æ¥è¯¢å¯ä»¥æå¾å¤ç§æ§è¡æ¹å¼ï¼æåé½è¿åç¸åºçç»æãä¼åå¨çä½ç¨å°±æ¯æ¾å°è¿å¶ä¸­æå¥½çæ§è¡è®¡åã\n\nmysql ä½¿ç¨åºäºææ¬çä¼åå¨ï¼å®å°è¯é¢æµä¸ä¸ªæ¥è¯¢ä½¿ç¨æç§æ§è¡è®¡åæ¶çææ¬ï¼å¹¶éæ©å¶ä¸­ææ¬æå°çä¸ä¸ªãå¨ mysql å¯ä»¥éè¿æ¥è¯¢å½åä¼è¯ç last_query_cost çå¼æ¥å¾å°å¶è®¡ç®å½åæ¥è¯¢çææ¬ã\n\nmysql> select * from t_message limit 10;\n...çç¥ç»æé\n\nmysql> show status like \'last_query_cost\';\n+-----------------+-------------+\n| variable_name   | value       |\n+-----------------+-------------+\n| last_query_cost | 6391.799000 |\n+-----------------+-------------+\n\n\nç¤ºä¾ä¸­çç»æè¡¨ç¤ºä¼åå¨è®¤ä¸ºå¤§æ¦éè¦å 6391 ä¸ªæ°æ®é¡µçéæºæ¥æ¾æè½å®æä¸é¢çæ¥è¯¢ãè¿ä¸ªç»ææ¯æ ¹æ®ä¸äºåçç»è®¡ä¿¡æ¯è®¡ç®å¾æ¥çï¼è¿äºç»è®¡ä¿¡æ¯åæ¬ï¼æ¯å¼ è¡¨æèç´¢å¼çé¡µé¢ä¸ªæ°ãç´¢å¼çåºæ°ãç´¢å¼åæ°æ®è¡çé¿åº¦ãç´¢å¼çåå¸æåµç­ç­ã\n\næéå¸¸å¤çåå ä¼å¯¼è´ mysql éæ©éè¯¯çæ§è¡è®¡åï¼æ¯å¦ç»è®¡ä¿¡æ¯ä¸åç¡®ãä¸ä¼èèä¸åå¶æ§å¶çæä½ææ¬ï¼ç¨æ·èªå®ä¹å½æ°ãå­å¨è¿ç¨ï¼ãmysql è®¤ä¸ºçæä¼è·æä»¬æ³çä¸ä¸æ ·ï¼æä»¬å¸ææ§è¡æ¶é´å°½å¯è½ç­ï¼ä½ mysql å¼éæ©å®è®¤ä¸ºææ¬å°çï¼ä½ææ¬å°å¹¶ä¸æå³çæ§è¡æ¶é´ç­ï¼ç­ç­ã\n\nmysql çæ¥è¯¢ä¼åå¨æ¯ä¸ä¸ªéå¸¸å¤æçé¨ä»¶ï¼å®ä½¿ç¨äºéå¸¸å¤çä¼åç­ç¥æ¥çæä¸ä¸ªæä¼çæ§è¡è®¡åï¼\n\n * éæ°å®ä¹è¡¨çå³èé¡ºåºï¼å¤å¼ è¡¨å³èæ¥è¯¢æ¶ï¼å¹¶ä¸ä¸å®æç§ sql ä¸­æå®çé¡ºåºè¿è¡ï¼ä½æä¸äºæå·§å¯ä»¥æå®å³èé¡ºåºï¼\n * ä¼åmin()åmax()å½æ°ï¼æ¾æåçæå°å¼ï¼å¦æè¯¥åæç´¢å¼ï¼åªéè¦æ¥æ¾ b+tree ç´¢å¼æå·¦ç«¯ï¼åä¹åå¯ä»¥æ¾å°æå¤§å¼ï¼å·ä½åçè§ä¸æï¼\n * æåç»æ­¢æ¥è¯¢ï¼æ¯å¦ï¼ä½¿ç¨ limit æ¶ï¼æ¥æ¾å°æ»¡è¶³æ°éçç»æéåä¼ç«å³ç»æ­¢æ¥è¯¢ï¼\n * ä¼åæåºï¼å¨èçæ¬ mysql ä¼ä½¿ç¨ä¸¤æ¬¡ä¼ è¾æåºï¼å³åè¯»åè¡æéåéè¦æåºçå­æ®µå¨åå­ä¸­å¯¹å¶æåºï¼ç¶ååæ ¹æ®æåºç»æå»è¯»åæ°æ®è¡ï¼èæ°çæ¬éç¨çæ¯åæ¬¡ä¼ è¾æåºï¼ä¹å°±æ¯ä¸æ¬¡è¯»åææçæ°æ®è¡ï¼ç¶åæ ¹æ®ç»å®çåæåºãå¯¹äº i/o å¯éååºç¨ï¼æçä¼é«å¾å¤ï¼\n\néç mysql çä¸æ­åå±ï¼ä¼åå¨ä½¿ç¨çä¼åç­ç¥ä¹å¨ä¸æ­çè¿åï¼è¿éä»ä»ä»ç»å ä¸ªéå¸¸å¸¸ç¨ä¸å®¹æçè§£çä¼åç­ç¥ï¼å¶ä»çä¼åç­ç¥ï¼å¤§å®¶èªè¡æ¥éå§ã\n\n\n# 2.5. ï¼äºï¼æ¥è¯¢æ§è¡å¼æ\n\nå¨å®æè§£æåä¼åé¶æ®µä»¥åï¼mysql ä¼çæå¯¹åºçæ§è¡è®¡åï¼æ¥è¯¢æ§è¡å¼ææ ¹æ®æ§è¡è®¡åç»åºçæä»¤éæ­¥æ§è¡å¾åºç»æãæ´ä¸ªæ§è¡è¿ç¨çå¤§é¨åæä½åæ¯éè¿è°ç¨å­å¨å¼æå®ç°çæ¥å£æ¥å®æï¼è¿äºæ¥å£è¢«ç§°ä¸ºhandler apiãæ¥è¯¢è¿ç¨ä¸­çæ¯ä¸å¼ è¡¨ç±ä¸ä¸ªhandlerå®ä¾è¡¨ç¤ºãå®éä¸ï¼mysql å¨æ¥è¯¢ä¼åé¶æ®µå°±ä¸ºæ¯ä¸å¼ è¡¨åå»ºäºä¸ä¸ªhandlerå®ä¾ï¼ä¼åå¨å¯ä»¥æ ¹æ®è¿äºå®ä¾çæ¥å£æ¥è·åè¡¨çç¸å³ä¿¡æ¯ï¼åæ¬è¡¨çææååãç´¢å¼ç»è®¡ä¿¡æ¯ç­ãå­å¨å¼ææ¥å£æä¾äºéå¸¸ä¸°å¯çåè½ï¼ä½å¶åºå±ä»æå åä¸ªæ¥å£ï¼è¿äºæ¥å£åæ­ç§¯æ¨ä¸æ ·å®æäºä¸æ¬¡æ¥è¯¢çå¤§é¨åæä½ã\n\n\n# 2.6. ï¼å­ï¼è¿åç»æ\n\næ¥è¯¢è¿ç¨çæåä¸ä¸ªé¶æ®µå°±æ¯å°ç»æè¿åç»å®¢æ·ç«¯ãå³ä½¿æ¥è¯¢ä¸å°æ°æ®ï¼mysql ä»ç¶ä¼è¿åè¿ä¸ªæ¥è¯¢çç¸å³ä¿¡æ¯ï¼æ¯å¦è¯¥æ¥è¯¢å½±åå°çè¡æ°ä»¥åæ§è¡æ¶é´ç­ç­ã\n\nå¦ææ¥è¯¢ç¼å­è¢«æå¼ä¸è¿ä¸ªæ¥è¯¢å¯ä»¥è¢«ç¼å­ï¼mysql ä¹ä¼å°ç»æå­æ¾å°ç¼å­ä¸­ã\n\nç»æéè¿åå®¢æ·ç«¯æ¯ä¸ä¸ªå¢éä¸éæ­¥è¿åçè¿ç¨ãæå¯è½ mysql å¨çæç¬¬ä¸æ¡ç»ææ¶ï¼å°±å¼å§åå®¢æ·ç«¯éæ­¥è¿åç»æéäºãè¿æ ·æå¡ç«¯å°±æ é¡»å­å¨å¤ªå¤ç»æèæ¶èè¿å¤åå­ï¼ä¹å¯ä»¥è®©å®¢æ·ç«¯ç¬¬ä¸æ¶é´è·å¾è¿åç»æãéè¦æ³¨æçæ¯ï¼ç»æéä¸­çæ¯ä¸è¡é½ä¼ä»¥ä¸ä¸ªæ»¡è¶³ â  ä¸­ææè¿°çéä¿¡åè®®çæ°æ®ååéï¼åéè¿ tcp åè®®è¿è¡ä¼ è¾ï¼å¨ä¼ è¾è¿ç¨ä¸­ï¼å¯è½å¯¹ mysql çæ°æ®åè¿è¡ç¼å­ç¶åæ¹éåéã\n\n\n# 3. æ´æ°è¿ç¨\n\nmysql æ´æ°è¿ç¨å mysql æ¥è¯¢è¿ç¨ç±»ä¼¼ï¼ä¹ä¼å°æµç¨èµ°ä¸éãä¸ä¸æ ·çæ¯ï¼æ´æ°æµç¨è¿æ¶åä¸¤ä¸ªéè¦çæ¥å¿æ¨¡åï¼ï¼redo logï¼éåæ¥å¿ï¼å binlogï¼å½æ¡£æ¥å¿ï¼ã\n\n\n# 3.1. redo log\n\nredo log æ¯ innodb å¼æç¹æçæ¥å¿ãredo log å³éåæ¥å¿ãredo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âã\n\nredo log æ¯åºäº wal ææ¯ãwal çå¨ç§°æ¯ write-ahead loggingï¼å®çå³é®ç¹å°±æ¯ååæ¥å¿ï¼ååç£çãå·ä½æ¥è¯´ï¼å½æä¸æ¡è®°å½éè¦æ´æ°çæ¶åï¼innodb å¼æå°±ä¼åæè®°å½åå° redo log éï¼å¹¶æ´æ°åå­ï¼è¿ä¸ªæ¶åæ´æ°å°±ç®å®æäºãåæ¶ï¼innodb å¼æä¼å¨éå½çæ¶åï¼å°è¿ä¸ªæä½è®°å½æ´æ°å°ç£çéé¢ï¼èè¿ä¸ªæ´æ°å¾å¾æ¯å¨ç³»ç»æ¯è¾ç©ºé²çæ¶ååã\n\ninnodb ç redo log æ¯åºå®å¤§å°çï¼æ¯å¦å¯ä»¥éç½®ä¸ºä¸ç» 4 ä¸ªæä»¶ï¼æ¯ä¸ªæä»¶çå¤§å°æ¯ 1gbï¼é£ä¹è¿åâç²æ¿âæ»å±å°±å¯ä»¥è®°å½ 4gb çæä½ãä»å¤´å¼å§åï¼åå°æ«å°¾å°±ååå°å¼å¤´å¾ªç¯åã\n\n\n\næäº redo logï¼innodb å°±å¯ä»¥ä¿è¯å³ä½¿æ°æ®åºåçå¼å¸¸éå¯ï¼ä¹åæäº¤çè®°å½é½ä¸ä¼ä¸¢å¤±ï¼è¿ä¸ªè½åç§°ä¸ºcrash-safeã\n\n\n# 3.2. bin log\n\nbin log å³å½æ¡£æ¥å¿ãbinlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ã\n\nbinlog æ¯å¯ä»¥è¿½å åå¥çï¼å³åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\nbinlog æ¯ mysql ç server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n\nsync_binlog è¿ä¸ªåæ°è®¾ç½®æ 1 çæ¶åï¼è¡¨ç¤ºæ¯æ¬¡äºå¡ç binlog é½æä¹åå°ç£çãè¿ä¸ªåæ°æä¹å»ºè®®ä½ è®¾ç½®æ 1ï¼è¿æ ·å¯ä»¥ä¿è¯ mysql å¼å¸¸éå¯ä¹å binlog ä¸ä¸¢å¤±ã\n\n\n# 3.3. redo log vs. bin log\n\nè¿ä¸¤ç§æ¥å¿æä»¥ä¸ä¸ç¹ä¸åã\n\n * redo log æ¯ innodb å¼æç¹æçï¼binlog æ¯ mysql ç server å±å®ç°çï¼ææå¼æé½å¯ä»¥ä½¿ç¨ã\n * redo log æ¯ç©çæ¥å¿ï¼è®°å½çæ¯âå¨æä¸ªæ°æ®é¡µä¸åäºä»ä¹ä¿®æ¹âï¼binlog æ¯é»è¾æ¥å¿ï¼è®°å½çæ¯è¿ä¸ªè¯­å¥çåå§é»è¾ï¼æ¯å¦âç» id=2 è¿ä¸è¡ç c å­æ®µå  1 âã\n * redo log æ¯å¾ªç¯åçï¼ç©ºé´åºå®ä¼ç¨å®ï¼binlog æ¯å¯ä»¥è¿½å åå¥çãâè¿½å åâæ¯æ binlog æä»¶åå°ä¸å®å¤§å°åä¼åæ¢å°ä¸ä¸ä¸ªï¼å¹¶ä¸ä¼è¦çä»¥åçæ¥å¿ã\n\næäºå¯¹è¿ä¸¤ä¸ªæ¥å¿çæ¦å¿µæ§çè§£ï¼æä»¬åæ¥çæ§è¡å¨å innodb å¼æå¨æ§è¡è¿ä¸ªç®åç update è¯­å¥æ¶çåé¨æµç¨ã\n\n 1. æ§è¡å¨åæ¾å¼æå id=2 è¿ä¸è¡ãid æ¯ä¸»é®ï¼å¼æç´æ¥ç¨æ æç´¢æ¾å°è¿ä¸è¡ãå¦æ id=2 è¿ä¸è¡æå¨çæ°æ®é¡µæ¬æ¥å°±å¨åå­ä¸­ï¼å°±ç´æ¥è¿åç»æ§è¡å¨ï¼å¦åï¼éè¦åä»ç£çè¯»å¥åå­ï¼ç¶ååè¿åã\n 2. æ§è¡å¨æ¿å°å¼æç»çè¡æ°æ®ï¼æè¿ä¸ªå¼å ä¸ 1ï¼æ¯å¦åæ¥æ¯ nï¼ç°å¨å°±æ¯ n+1ï¼å¾å°æ°çä¸è¡æ°æ®ï¼åè°ç¨å¼ææ¥å£åå¥è¿è¡æ°æ°æ®ã\n 3. å¼æå°è¿è¡æ°æ°æ®æ´æ°å°åå­ä¸­ï¼åæ¶å°è¿ä¸ªæ´æ°æä½è®°å½å° redo log éé¢ï¼æ­¤æ¶ redo log å¤äº prepare ç¶æãç¶ååç¥æ§è¡å¨æ§è¡å®æäºï¼éæ¶å¯ä»¥æäº¤äºå¡ã\n 4. æ§è¡å¨çæè¿ä¸ªæä½ç binlogï¼å¹¶æ binlog åå¥ç£çã\n 5. æ§è¡å¨è°ç¨å¼æçæäº¤äºå¡æ¥å£ï¼å¼ææåååå¥ç redo log æ¹ææäº¤ï¼commitï¼ç¶æï¼æ´æ°å®æã\n\nè¿éæç»åºè¿ä¸ª update è¯­å¥çæ§è¡æµç¨å¾ï¼å¾ä¸­æµè²æ¡è¡¨ç¤ºæ¯å¨ innodb åé¨æ§è¡çï¼æ·±è²æ¡è¡¨ç¤ºæ¯å¨æ§è¡å¨ä¸­æ§è¡çã\n\n\n\n\n# 3.4. ä¸¤é¶æ®µæäº¤\n\nredo log çåå¥ææäºä¸¤ä¸ªæ­¥éª¤ï¼prepare å commitï¼è¿å°±æ¯"ä¸¤é¶æ®µæäº¤"ãä¸ºä»ä¹æ¥å¿éè¦âä¸¤é¶æ®µæäº¤âã\n\nç±äº redo log å binlog æ¯ä¸¤ä¸ªç¬ç«çé»è¾ï¼å¦æä¸ç¨ä¸¤é¶æ®µæäº¤ï¼è¦ä¹å°±æ¯ååå® redo log åå binlogï¼æèéç¨åè¿æ¥çé¡ºåºãæä»¬ççè¿ä¸¤ç§æ¹å¼ä¼æä»ä¹é®é¢ã\n\n * åå redo log åå binlogãåè®¾å¨ redo log åå®ï¼binlog è¿æ²¡æåå®çæ¶åï¼mysql è¿ç¨å¼å¸¸éå¯ãç±äºæä»¬åé¢è¯´è¿çï¼redo log åå®ä¹åï¼ç³»ç»å³ä½¿å´©æºï¼ä»ç¶è½å¤ææ°æ®æ¢å¤åæ¥ï¼æä»¥æ¢å¤åè¿ä¸è¡ c çå¼æ¯ 1ã ä½æ¯ç±äº binlog æ²¡åå®å°± crash äºï¼è¿æ¶å binlog éé¢å°±æ²¡æè®°å½è¿ä¸ªè¯­å¥ãå æ­¤ï¼ä¹åå¤ä»½æ¥å¿çæ¶åï¼å­èµ·æ¥ç binlog éé¢å°±æ²¡æè¿æ¡è¯­å¥ã ç¶åä½ ä¼åç°ï¼å¦æéè¦ç¨è¿ä¸ª binlog æ¥æ¢å¤ä¸´æ¶åºçè¯ï¼ç±äºè¿ä¸ªè¯­å¥ç binlog ä¸¢å¤±ï¼è¿ä¸ªä¸´æ¶åºå°±ä¼å°äºè¿ä¸æ¬¡æ´æ°ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 0ï¼ä¸ååºçå¼ä¸åã\n * åå binlog åå redo logãå¦æå¨ binlog åå®ä¹å crashï¼ç±äº redo log è¿æ²¡åï¼å´©æºæ¢å¤ä»¥åè¿ä¸ªäºå¡æ æï¼æä»¥è¿ä¸è¡ c çå¼æ¯ 0ãä½æ¯ binlog éé¢å·²ç»è®°å½äºâæ c ä» 0 æ¹æ 1âè¿ä¸ªæ¥å¿ãæä»¥ï¼å¨ä¹åç¨ binlog æ¥æ¢å¤çæ¶åå°±å¤äºä¸ä¸ªäºå¡åºæ¥ï¼æ¢å¤åºæ¥çè¿ä¸è¡ c çå¼å°±æ¯ 1ï¼ä¸ååºçå¼ä¸åã\n\nå¯ä»¥çå°ï¼å¦æä¸ä½¿ç¨âä¸¤é¶æ®µæäº¤âï¼é£ä¹æ°æ®åºçç¶æå°±æå¯è½åç¨å®çæ¥å¿æ¢å¤åºæ¥çåºçç¶æä¸ä¸è´ã\n\n\n# 4. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * mysql å®æ 45 è®²',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql äºå¡",frontmatter:{title:"Mysql äºå¡",date:"2020-06-03T19:32:09.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","äºå¡"],permalink:"/pages/f3295c/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/03.Mysql%E4%BA%8B%E5%8A%A1.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/03.Mysqläºå¡.md",key:"v-398cfa40",path:"/pages/f3295c/",headers:[{level:2,title:"1. äºå¡ç®ä»",slug:"_1-äºå¡ç®ä»",normalizedTitle:"1. äºå¡ç®ä»",charIndex:156},{level:2,title:"2. äºå¡ç¨æ³",slug:"_2-äºå¡ç¨æ³",normalizedTitle:"2. äºå¡ç¨æ³",charIndex:474},{level:3,title:"2.1. äºå¡å¤çæä»¤",slug:"_2-1-äºå¡å¤çæä»¤",normalizedTitle:"2.1. äºå¡å¤çæä»¤",charIndex:486},{level:3,title:"2.2. AUTOCOMMIT",slug:"_2-2-autocommit",normalizedTitle:"2.2. autocommit",charIndex:1497},{level:2,title:"3. ACID",slug:"_3-acid",normalizedTitle:"3. acid",charIndex:1866},{level:2,title:"4. äºå¡éç¦»çº§å«",slug:"_4-äºå¡éç¦»çº§å«",normalizedTitle:"4. äºå¡éç¦»çº§å«",charIndex:2617},{level:3,title:"4.1. äºå¡éç¦»ç®ä»",slug:"_4-1-äºå¡éç¦»ç®ä»",normalizedTitle:"4.1. äºå¡éç¦»ç®ä»",charIndex:2631},{level:3,title:"4.2. æªæäº¤è¯»",slug:"_4-2-æªæäº¤è¯»",normalizedTitle:"4.2. æªæäº¤è¯»",charIndex:3197},{level:3,title:"4.3. æäº¤è¯»",slug:"_4-3-æäº¤è¯»",normalizedTitle:"4.3. æäº¤è¯»",charIndex:3363},{level:3,title:"4.4. å¯éå¤è¯»",slug:"_4-4-å¯éå¤è¯»",normalizedTitle:"4.4. å¯éå¤è¯»",charIndex:3586},{level:3,title:"4.5. ä¸²è¡å",slug:"_4-5-ä¸²è¡å",normalizedTitle:"4.5. ä¸²è¡å",charIndex:3846},{level:3,title:"4.6. éç¦»çº§å«å°ç»",slug:"_4-6-éç¦»çº§å«å°ç»",normalizedTitle:"4.6. éç¦»çº§å«å°ç»",charIndex:3980},{level:2,title:"5. æ­»é",slug:"_5-æ­»é",normalizedTitle:"5. æ­»é",charIndex:4376},{level:3,title:"5.1. æ­»éçåå ",slug:"_5-1-æ­»éçåå ",normalizedTitle:"5.1. æ­»éçåå ",charIndex:4501},{level:3,title:"5.2. é¿åæ­»é",slug:"_5-2-é¿åæ­»é",normalizedTitle:"5.2. é¿åæ­»é",charIndex:5685},{level:3,title:"5.3. è§£å³æ­»é",slug:"_5-3-è§£å³æ­»é",normalizedTitle:"5.3. è§£å³æ­»é",charIndex:6165},{level:2,title:"6. åå¸å¼äºå¡",slug:"_6-åå¸å¼äºå¡",normalizedTitle:"6. åå¸å¼äºå¡",charIndex:6825},{level:2,title:"7. äºå¡æä½³å®è·µ",slug:"_7-äºå¡æä½³å®è·µ",normalizedTitle:"7. äºå¡æä½³å®è·µ",charIndex:8008},{level:3,title:"7.1. å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»",slug:"_7-1-å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»",normalizedTitle:"7.1. å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»",charIndex:8041},{level:3,title:"7.2. é¿åè¡éåçº§è¡¨é",slug:"_7-2-é¿åè¡éåçº§è¡¨é",normalizedTitle:"7.2. é¿åè¡éåçº§è¡¨é",charIndex:8082},{level:3,title:"7.3. ç¼©å°äºå¡èå´",slug:"_7-3-ç¼©å°äºå¡èå´",normalizedTitle:"7.3. ç¼©å°äºå¡èå´",charIndex:8181},{level:2,title:"8. åèèµæ",slug:"_8-åèèµæ",normalizedTitle:"8. åèèµæ",charIndex:8759}],headersStr:"1. äºå¡ç®ä» 2. äºå¡ç¨æ³ 2.1. äºå¡å¤çæä»¤ 2.2. AUTOCOMMIT 3. ACID 4. äºå¡éç¦»çº§å« 4.1. äºå¡éç¦»ç®ä» 4.2. æªæäº¤è¯» 4.3. æäº¤è¯» 4.4. å¯éå¤è¯» 4.5. ä¸²è¡å 4.6. éç¦»çº§å«å°ç» 5. æ­»é 5.1. æ­»éçåå  5.2. é¿åæ­»é 5.3. è§£å³æ­»é 6. åå¸å¼äºå¡ 7. äºå¡æä½³å®è·µ 7.1. å°½éä½¿ç¨ä½çº§å«äºå¡éç¦» 7.2. é¿åè¡éåçº§è¡¨é 7.3. ç¼©å°äºå¡èå´ 8. åèèµæ",content:"# Mysql äºå¡\n\n> ä¸æ¯ææç Mysql å­å¨å¼æé½å®ç°äºäºå¡å¤çãæ¯æäºå¡çå­å¨å¼ææï¼InnoDB å NDB Clusterãä¸æ¯æäºå¡çå­å¨å¼æï¼ä»£è¡¨æï¼MyISAMã\n> \n> ç¨æ·å¯ä»¥æ ¹æ®ä¸å¡æ¯å¦éè¦äºå¡å¤çï¼äºå¡å¤çå¯ä»¥ä¿è¯æ°æ®å®å¨ï¼ä½ä¼å¢å ç³»ç»å¼éï¼ï¼éæ©åéçå­å¨å¼æã\n\n\n\n\n# 1. äºå¡ç®ä»\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª Session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãè¿ä¸æ­¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ ACID ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ Commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ Rollback è¿è¡åæ»ã\n\n\n\näºå¡å°±æ¯ä¸ç»åå­æ§ç SQL è¯­å¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ ACID ç¹æ§çä¸ç»æä½ã\n\näºå¡åç SQL è¯­å¥ï¼è¦ä¹å¨æ§è¡æåï¼è¦ä¹å¨æ§è¡å¤±è´¥ã\n\néè¿å éçæ¹å¼ï¼å¯ä»¥å®ç°ä¸åçäºå¡éç¦»æºå¶ã\n\næ³è±¡ä¸ä¸ï¼å¦ææ²¡æäºå¡ï¼å¨å¹¶åç¯å¢ä¸ï¼å°±å¯è½åºç°ä¸¢å¤±ä¿®æ¹çé®é¢ã\n\nT1 å T2 ä¸¤ä¸ªçº¿ç¨é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼T1 åä¿®æ¹ï¼T2 éåä¿®æ¹ï¼T2 çä¿®æ¹è¦çäº T1 çä¿®æ¹ã\n\n\n\n\n# 2. äºå¡ç¨æ³\n\n\n# 2.1. äºå¡å¤çæä»¤\n\nMysql ä¸­ï¼ä½¿ç¨ START TRANSACTION è¯­å¥å¼å§ä¸ä¸ªäºå¡ï¼ä½¿ç¨ COMMIT è¯­å¥æäº¤ææçä¿®æ¹ï¼ä½¿ç¨ ROLLBACK è¯­å¥æ¤éææçä¿®æ¹ãä¸è½åé SELECT è¯­å¥ï¼åé SELECT è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé CREATE å DROP è¯­å¥ã\n\n * START TRANSACTION - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * SAVEPOINT - æä»¤ç¨äºåå»ºä¿çç¹ã\n * ROLLBACK TO - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° START TRANSACTION è¯­å¥å¤ã\n * COMMIT - æäº¤äºå¡ã\n\näºå¡å¤çç¤ºä¾ï¼\n\nï¼1ï¼åå»ºä¸å¼ ç¤ºä¾è¡¨\n\n-- æ¤éè¡¨ user\nDROP TABLE IF EXISTS user;\n\n-- åå»ºè¡¨ user\nCREATE TABLE user (\n  id int(10) unsigned NOT NULL COMMENT 'Id',\n  username varchar(64) NOT NULL DEFAULT 'default' COMMENT 'ç¨æ·å',\n  password varchar(64) NOT NULL DEFAULT 'default' COMMENT 'å¯ç ',\n  email varchar(64) NOT NULL DEFAULT 'default' COMMENT 'é®ç®±'\n) COMMENT='ç¨æ·è¡¨';\n\n\nï¼2ï¼æ§è¡äºå¡æä½\n\n-- å¼å§äºå¡\nSTART TRANSACTION;\n\n-- æå¥æä½ A\nINSERT INTO `user`\nVALUES (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updateA\nSAVEPOINT updateA;\n\n-- æå¥æä½ B\nINSERT INTO `user`\nVALUES (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updateA\nROLLBACK TO updateA;\n\n-- æäº¤äºå¡ï¼åªææä½ A çæ\nCOMMIT;\n\n\nï¼3ï¼æ§è¡ç»æ\n\nSELECT * FROM user;\n\n\nç»æï¼\n\n1\troot1\troot1\txxxx@163.com\n\n\n\n# 2.2. AUTOCOMMIT\n\nMySQL é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ãæ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° START TRANSACTION è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ COMMIT æ ROLLBACK è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\n-- æ¥ç AUTOCOMMIT\nSHOW VARIABLES LIKE 'AUTOCOMMIT';\n\n-- å³é­ AUTOCOMMIT\nSET autocommit = 0;\n\n-- å¼å¯ AUTOCOMMIT\nSET autocommit = 1;\n\n\n\n# 3. ACID\n\nACID æ¯æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ã\n\n * åå­æ§ï¼Atomicityï¼\n   * äºå¡è¢«è§ä¸ºä¸å¯åå²çæå°ååï¼äºå¡ä¸­çæææä½è¦ä¹å¨é¨æäº¤æåï¼è¦ä¹å¨é¨å¤±è´¥åæ»ã\n   * åæ»å¯ä»¥ç¨æ¥å¿æ¥å®ç°ï¼æ¥å¿è®°å½çäºå¡ææ§è¡çä¿®æ¹æä½ï¼å¨åæ»æ¶ååæ§è¡è¿äºä¿®æ¹æä½å³å¯ã\n * ä¸è´æ§ï¼Consistencyï¼\n   * æ°æ®åºå¨äºå¡æ§è¡ååé½ä¿æä¸è´æ§ç¶æã\n   * å¨ä¸è´æ§ç¶æä¸ï¼ææäºå¡å¯¹ä¸ä¸ªæ°æ®çè¯»åç»æé½æ¯ç¸åçã\n * éç¦»æ§ï¼Isolationï¼\n   * ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æç»æäº¤ä»¥åï¼å¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * æä¹æ§ï¼Durabilityï¼\n   * ä¸æ¦äºå¡æäº¤ï¼åå¶æåçä¿®æ¹å°ä¼æ°¸è¿ä¿å­å°æ°æ®åºä¸­ãå³ä½¿ç³»ç»åçå´©æºï¼äºå¡æ§è¡çç»æä¹ä¸è½ä¸¢å¤±ã\n   * å¯ä»¥éè¿æ°æ®åºå¤ä»½åæ¢å¤æ¥å®ç°ï¼å¨ç³»ç»åçå¥æºæ¶ï¼ä½¿ç¨å¤ä»½çæ°æ®åºè¿è¡æ°æ®æ¢å¤ã\n\nä¸ä¸ªæ¯æäºå¡ï¼Transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼Transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n * åªææ»¡è¶³ä¸è´æ§ï¼äºå¡çæ§è¡ç»æææ¯æ­£ç¡®çã\n * å¨æ å¹¶åçæåµä¸ï¼äºå¡ä¸²è¡æ§è¡ï¼éç¦»æ§ä¸å®è½å¤æ»¡è¶³ãæ­¤æ¶åªè¦è½æ»¡è¶³åå­æ§ï¼å°±ä¸å®è½æ»¡è¶³ä¸è´æ§ã\n * å¨å¹¶åçæåµä¸ï¼å¤ä¸ªäºå¡å¹¶è¡æ§è¡ï¼äºå¡ä¸ä»è¦æ»¡è¶³åå­æ§ï¼è¿éè¦æ»¡è¶³éç¦»æ§ï¼æè½æ»¡è¶³ä¸è´æ§ã\n * äºå¡æ»¡è¶³æä¹åæ¯ä¸ºäºè½åºå¯¹ç³»ç»å´©æºçæåµã\n\n\n\n> MySQL é»è®¤éç¨èªå¨æäº¤æ¨¡å¼ï¼AUTO COMMITï¼ãä¹å°±æ¯è¯´ï¼å¦æä¸æ¾å¼ä½¿ç¨ START TRANSACTION è¯­å¥æ¥å¼å§ä¸ä¸ªäºå¡ï¼é£ä¹æ¯ä¸ªæ¥è¯¢æä½é½ä¼è¢«å½åä¸ä¸ªäºå¡å¹¶èªå¨æäº¤ã\n\n\n# 4. äºå¡éç¦»çº§å«\n\n\n# 4.1. äºå¡éç¦»ç®ä»\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ï¼\n\n * ä¸¢å¤±ä¿®æ¹\n * èè¯»\n * ä¸å¯éå¤è¯»\n * å¹»è¯»\n\nå¨ SQL æ åä¸­ï¼å®ä¹äºåç§äºå¡éç¦»çº§å«ï¼çº§å«ç±ä½å°é«ï¼ï¼\n\n * æªæäº¤è¯»\n * æäº¤è¯»\n * å¯éå¤è¯»\n * ä¸²è¡å\n\nMysql ä¸­æ¥çåè®¾ç½®äºå¡éç¦»çº§å«ï¼\n\n-- æ¥çäºå¡éç¦»çº§å«\nSHOW VARIABLES LIKE 'transaction_isolation';\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º READ UNCOMMITTED\nSET SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º READ COMMITTED\nSET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º REPEATABLE READ\nSET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º SERIALIZABLE\nSET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;\n\n\n\n# 4.2. æªæäº¤è¯»\n\næªæäº¤è¯»ï¼READ UNCOMMITTEDï¼ æ¯æï¼äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n\næªæäº¤è¯»çé®é¢ï¼äºå¡å¯ä»¥è¯»åæªæäº¤çæ°æ®ï¼ä¹è¢«ç§°ä¸º èè¯»ï¼Dirty Readï¼ã\n\nT1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼T2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ T1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ T2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n\n# 4.3. æäº¤è¯»\n\næäº¤è¯»ï¼READ COMMITTEDï¼ æ¯æï¼äºå¡æäº¤åï¼å¶ä»äºå¡æè½çå°å®çä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çãæäº¤è¯»è§£å³äºèè¯»çé®é¢ã\n\næäº¤è¯»æ¯å¤§å¤æ°æ°æ®åºçé»è®¤äºå¡éç¦»çº§å«ã\n\næäº¤è¯»ææ¶ä¹å«ä¸å¯éå¤è¯»ï¼å®çé®é¢æ¯ï¼æ§è¡ä¸¤æ¬¡ç¸åçæ¥è¯¢ï¼å¾å°çç»æå¯è½ä¸ä¸è´ã\n\nT2 è¯»åä¸ä¸ªæ°æ®ï¼T1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ T2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n\n# 4.4. å¯éå¤è¯»\n\nå¯éå¤è¯»ï¼REPEATABLE READï¼ æ¯æï¼ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çãå¯éå¤è¯»è§£å³äºä¸å¯éå¤è¯»é®é¢ã\n\nå¯éå¤è¯»æ¯ Mysql çé»è®¤äºå¡éç¦»çº§å«ã\n\nå¯éå¤è¯»çé®é¢ï¼å½æä¸ªäºå¡è¯»åæä¸ªèå´åçè®°å½æ¶ï¼å¦å¤ä¸ä¸ªäºå¡åå¨è¯¥èå´åæå¥äºæ°çè®°å½ï¼å½ä¹åçäºå¡ååæ¬¡è¯»åè¯¥èå´çè®°å½æ¶ï¼ä¼äº§ç å¹»è¯»ï¼Phantom Readï¼ã\n\nT1 è¯»åæä¸ªèå´çæ°æ®ï¼T2 å¨è¿ä¸ªèå´åæå¥æ°çæ°æ®ï¼T1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n\n# 4.5. ä¸²è¡å\n\nä¸²è¡åï¼SERIALIXABLEï¼ æ¯æï¼å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\nå¼ºå¶äºå¡ä¸²è¡æ§è¡ï¼åé¿åäºææçå¹¶åé®é¢ãä¸²è¡åç­ç¥ä¼å¨è¯»åçæ¯ä¸è¡æ°æ®ä¸é½å éï¼è¿å¯è½å¯¼è´å¤§éçè¶æ¶åéç«äºãè¿å¯¹äºé«å¹¶ååºç¨åºæ¬ä¸æ¯ä¸å¯æ¥åçï¼æä»¥ä¸è¬ä¸ä¼éç¨è¿ä¸ªçº§å«ã\n\n\n# 4.6. éç¦»çº§å«å°ç»\n\n * æªæäº¤è¯»ï¼READ UNCOMMITTEDï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * æäº¤è¯»ï¼READ COMMITTEDï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼REPEATABLE READï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼SERIALIXABLEï¼ - å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   ä¸¢å¤±ä¿®æ¹   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\næªæäº¤è¯»   âï¸     â    â       â\næäº¤è¯»    âï¸     âï¸   â       â\nå¯éå¤è¯»   âï¸     âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸     âï¸   âï¸      âï¸\n\n\n# 5. æ­»é\n\næ­»éæ¯æä¸¤ä¸ªæå¤ä¸ªäºå¡ç«äºåä¸èµæºï¼å¹¶è¯·æ±éå®å¯¹æ¹å ç¨çèµæºï¼ä»èå¯¼è´æ¶æ§å¾ªç¯çç°è±¡ã\n\näº§çæ­»éçåºæ¯ï¼\n\n * å½å¤ä¸ªäºå¡è¯å¾ä»¥ä¸åçé¡ºåºéå®èµæºæ¶ï¼å°±å¯è½ä¼äº§çæ­»éã\n\n * å¤ä¸ªäºå¡åæ¶éå®åä¸ä¸ªèµæºæ¶ï¼ä¹ä¼äº§çæ­»éã\n\n\n# 5.1. æ­»éçåå \n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockãrecord lock æ¯ä¸é¨å¯¹ç´¢å¼é¡¹å éï¼gap lock æ¯å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éï¼next-key lock åæ¯åé¢ä¸¤ç§çç»åï¼å¯¹ç´¢å¼é¡¹ä»¥å¶ä¹é´çé´éå éã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockï¼å¨ SelectãUpdate å Delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nå¨ MySQL ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ MySQL ä¸­é»è®¤çæ¯ RR äºå¡éç¦»çº§å«ã\n\nå½æä»¬æ§è¡ä»¥ä¸æ¥è¯¢ SQL æ¶ï¼ç±äº order_no åä¸ºéå¯ä¸ç´¢å¼ï¼æ­¤æ¶åæ¯ RR äºå¡éç¦»çº§å«ï¼æä»¥ SELECT çå éç±»åä¸º gap lockï¼è¿éç gap èå´æ¯ (4,+âï¼ã\n\n> SELECT id FROM demo.order_record where order_no = 4 for update;\n\næ§è¡æ¥è¯¢ SQL è¯­å¥è·åç gap lock å¹¶ä¸ä¼å¯¼è´é»å¡ï¼èå½æä»¬æ§è¡ä»¥ä¸æå¥ SQL æ¶ï¼ä¼å¨æå¥é´éä¸åæ¬¡è·åæå¥æåéãæå¥æåéå¶å®ä¹æ¯ä¸ç§ gap éï¼å®ä¸ gap lock æ¯å²çªçï¼æä»¥å½å¶å®äºå¡ææè¯¥é´éç gap lock æ¶ï¼éè¦ç­å¾å¶å®äºå¡éæ¾ gap lock ä¹åï¼æè½è·åå°æå¥æåéã\n\nä»¥ä¸äºå¡ A åäºå¡ B é½ææé´é (4,+âï¼ç gap éï¼èæ¥ä¸æ¥çæå¥æä½ä¸ºäºè·åå°æå¥æåéï¼é½å¨ç­å¾å¯¹æ¹äºå¡ç gap ééæ¾ï¼äºæ¯å°±é æäºå¾ªç¯ç­å¾ï¼å¯¼è´æ­»éã\n\n> INSERT INTO demo.order_record(order_no, status, create_date) VALUES (5, 1, â2019-07-13 10:57:03â);\n\n\n\nå¦ä¸ä¸ªæ­»éåºæ¯\n\nInnoDB å­å¨å¼æçä¸»é®ç´¢å¼ä¸ºèç°ç´¢å¼ï¼å¶å®ç´¢å¼ä¸ºè¾å©ç´¢å¼ãå¦æä½¿ç¨è¾å©ç´¢å¼æ¥æ´æ°æ°æ®åºï¼å°±éè¦ä½¿ç¨èç°ç´¢å¼æ¥æ´æ°æ°æ®åºå­æ®µãå¦æä¸¤ä¸ªæ´æ°äºå¡ä½¿ç¨äºä¸åçè¾å©ç´¢å¼ï¼æä¸ä¸ªä½¿ç¨äºè¾å©ç´¢å¼ï¼ä¸ä¸ªä½¿ç¨äºèç°ç´¢å¼ï¼å°±é½æå¯è½å¯¼è´éèµæºçå¾ªç¯ç­å¾ãç±äºæ¬èº«ä¸¤ä¸ªäºå¡æ¯äºæ¥ï¼ä¹å°±ææäºä»¥ä¸æ­»éçåä¸ªå¿è¦æ¡ä»¶äºã\n\n\n\nåºç°æ­»éçæ­¥éª¤ï¼\n\n\n\nç»¼ä¸å¯ç¥ï¼å¨æ´æ°æä½æ¶ï¼æä»¬åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥æ´æ°è¡¨å­æ®µï¼è¿æ ·å¯ä»¥ææé¿åä¸äºä¸å¿è¦çæ­»éåçã\n\n\n# 5.2. é¿åæ­»é\n\né¢é²æ­»éçæ³¨æäºé¡¹ï¼\n\n * å¨ç¼ç¨ä¸­å°½éæç§åºå®çé¡ºåºæ¥å¤çæ°æ®åºè®°å½ï¼åè®¾æä¸¤ä¸ªæ´æ°æä½ï¼åå«æ´æ°ä¸¤æ¡ç¸åçè®°å½ï¼ä½æ´æ°é¡ºåºä¸ä¸æ ·ï¼æå¯è½å¯¼è´æ­»éï¼\n * å¨åè®¸å¹»è¯»åä¸å¯éå¤è¯»çæåµä¸ï¼å°½éä½¿ç¨ RC äºå¡éç¦»çº§å«ï¼å¯ä»¥é¿å gap lock å¯¼è´çæ­»éé®é¢ï¼\n * æ´æ°è¡¨æ¶ï¼å°½éä½¿ç¨ä¸»é®æ´æ°ï¼\n * é¿åé¿äºå¡ï¼å°½éå°é¿äºå¡æè§£ï¼å¯ä»¥éä½ä¸å¶å®äºå¡åçå²çªçæ¦çï¼\n * è®¾ç½®åççéç­å¾è¶æ¶åæ°ï¼æä»¬å¯ä»¥éè¿ innodb_lock_wait_timeout è®¾ç½®åççç­å¾è¶æ¶éå¼ï¼ç¹å«æ¯å¨ä¸äºé«å¹¶åçä¸å¡ä¸­ï¼æä»¬å¯ä»¥å°½éå°è¯¥å¼è®¾ç½®å¾å°ä¸äºï¼é¿åå¤§éäºå¡ç­å¾ï¼å ç¨ç³»ç»èµæºï¼é æä¸¥éçæ§è½å¼éã\n\nå¦å¤ï¼æä»¬è¿å¯ä»¥å° order_no åè®¾ç½®ä¸ºå¯ä¸ç´¢å¼åãè½ç¶ä¸è½é²æ­¢å¹»è¯»ï¼ä½æä»¬å¯ä»¥å©ç¨å®çå¯ä¸æ§æ¥ä¿è¯è®¢åè®°å½ä¸éå¤åå»ºï¼è¿ç§æ¹å¼å¯ä¸çç¼ºç¹å°±æ¯å½éå°éå¤åå»ºè®¢åæ¶ä¼æåºå¼å¸¸ã\n\næä»¬è¿å¯ä»¥ä½¿ç¨å¶å®çæ¹å¼æ¥ä»£æ¿æ°æ®åºå®ç°å¹ç­æ§æ ¡éªãä¾å¦ï¼ä½¿ç¨ Redis ä»¥å ZooKeeper æ¥å®ç°ï¼è¿è¡æçæ¯æ°æ®åºæ´ä½³ã\n\n\n# 5.3. è§£å³æ­»é\n\nå½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼\n\n * ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°è¶æ¶ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ° innodb_lock_wait_timeout æ¥è®¾ç½®ã\n * å¦ä¸ç§ç­ç¥æ¯ï¼åèµ·æ­»éæ£æµï¼åç°æ­»éåï¼ä¸»å¨åæ»æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ° innodb_deadlock_detect è®¾ç½®ä¸º onï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã\n\nå¨ InnoDB ä¸­ï¼innodb_lock_wait_timeout çé»è®¤å¼æ¯ 50sï¼æå³çå¦æéç¨ç¬¬ä¸ä¸ªç­ç¥ï¼å½åºç°æ­»éä»¥åï¼ç¬¬ä¸ä¸ªè¢«éä½ççº¿ç¨è¦è¿ 50s æä¼è¶æ¶éåºï¼ç¶åå¶ä»çº¿ç¨ææå¯è½ç»§ç»­æ§è¡ãå¯¹äºå¨çº¿æå¡æ¥è¯´ï¼è¿ä¸ªç­å¾æ¶é´å¾å¾æ¯æ æ³æ¥åçã\n\nä½æ¯ï¼æä»¬åä¸å¯è½ç´æ¥æè¿ä¸ªæ¶é´è®¾ç½®æä¸ä¸ªå¾å°çå¼ï¼æ¯å¦ 1sãè¿æ ·å½åºç°æ­»éçæ¶åï¼ç¡®å®å¾å¿«å°±å¯ä»¥è§£å¼ï¼ä½å¦æä¸æ¯æ­»éï¼èæ¯ç®åçéç­å¾å¢ï¼æä»¥ï¼è¶æ¶æ¶é´è®¾ç½®å¤ªç­çè¯ï¼ä¼åºç°å¾å¤è¯¯ä¼¤ã\n\næä»¥ï¼æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detect çé»è®¤å¼æ¬èº«å°±æ¯ onãä¸ºäºè§£å³æ­»éé®é¢ï¼ä¸åæ°æ®åºå®ç°äºåèªçæ­»éæ£æµåè¶æ¶æºå¶ãInnoDB çå¤çç­ç¥æ¯ï¼å°æææå°è¡çº§æå®éçäºå¡è¿è¡åæ»ã\n\nä¸»å¨æ­»éæ£æµå¨åçæ­»éçæ¶åï¼æ¯è½å¤å¿«éåç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçãä½ å¯ä»¥æ³è±¡ä¸ä¸è¿ä¸ªè¿ç¨ï¼æ¯å½ä¸ä¸ªäºå¡è¢«éçæ¶åï¼å°±è¦ççå®æä¾èµççº¿ç¨ææ²¡æè¢«å«äººéä½ï¼å¦æ­¤å¾ªç¯ï¼æåå¤æ­æ¯å¦åºç°äºå¾ªç¯ç­å¾ï¼ä¹å°±æ¯æ­»éã\n\n\n# 6. åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡æçæ¯äºå¡æä½è·¨è¶å¤ä¸ªèç¹ï¼å¹¶ä¸è¦æ±æ»¡è¶³äºå¡ç ACID ç¹æ§ã\n\nåå¸å¼äºå¡çå¸¸è§æ¹æ¡å¦ä¸ï¼\n\n * ä¸¤é¶æ®µæäº¤ï¼2PCï¼ - å°äºå¡çæäº¤è¿ç¨åä¸ºä¸¤ä¸ªé¶æ®µæ¥è¿è¡å¤çï¼åå¤é¶æ®µåæäº¤é¶æ®µãåä¸èå°æä½æè´¥éç¥åè°èï¼åç±åè°èæ ¹æ®ææåä¸èçåé¦ææ¥å³å®ååä¸èæ¯å¦è¦æäº¤æä½è¿æ¯ä¸­æ­¢æä½ã\n * ä¸é¶æ®µæäº¤ï¼3PCï¼ - ä¸äºé¶æ®µæäº¤ä¸åçæ¯ï¼å¼å¥è¶æ¶æºå¶ãåæ¶å¨åè°èååä¸èä¸­é½å¼å¥è¶æ¶æºå¶ãå°äºé¶æ®µçåå¤é¶æ®µæåä¸º 2 ä¸ªé¶æ®µï¼æå¥äºä¸ä¸ª preCommit é¶æ®µï¼ä½¿å¾ååå¨äºé¶æ®µæäº¤ä¸­ï¼åä¸èå¨åå¤ä¹åï¼ç±äºåè°èåçå´©æºæéè¯¯ï¼èå¯¼è´åä¸èå¤äºæ æ³ç¥ææ¯å¦æäº¤æèä¸­æ­¢çâä¸ç¡®å®ç¶æâæäº§ççå¯è½ç¸å½é¿çå»¶æ¶çé®é¢å¾ä»¥è§£å³ã\n * è¡¥å¿äºå¡ï¼TCCï¼\n   * Try - æä½ä½ä¸ºä¸é¶æ®µï¼è´è´£èµæºçæ£æ¥åé¢çã\n   * Confirm - æä½ä½ä¸ºäºé¶æ®µæäº¤æä½ï¼æ§è¡çæ­£çä¸å¡ã\n   * Cancel - æ¯é¢çèµæºçåæ¶ã\n * æ¬å°æ¶æ¯è¡¨ - å¨äºå¡ä¸»å¨åèµ·æ¹é¢å¤æ°å»ºäºå¡æ¶æ¯è¡¨ï¼äºå¡åèµ·æ¹å¤çä¸å¡åè®°å½äºå¡æ¶æ¯å¨æ¬å°äºå¡ä¸­å®æï¼è½®è¯¢äºå¡æ¶æ¯è¡¨çæ°æ®åéäºå¡æ¶æ¯ï¼äºå¡è¢«å¨æ¹åºäºæ¶æ¯ä¸­é´ä»¶æ¶è´¹äºå¡æ¶æ¯è¡¨ä¸­çäºå¡ã\n * MQ äºå¡ - åºäº MQ çåå¸å¼äºå¡æ¹æ¡å¶å®æ¯å¯¹æ¬å°æ¶æ¯è¡¨çå°è£ã\n * SAGA - Saga äºå¡æ ¸å¿ææ³æ¯å°é¿äºå¡æåä¸ºå¤ä¸ªæ¬å°ç­äºå¡ï¼ç± Saga äºå¡åè°å¨åè°ï¼å¦ææ­£å¸¸ç»æé£å°±æ­£å¸¸å®æï¼å¦ææä¸ªæ­¥éª¤å¤±è´¥ï¼åæ ¹æ®ç¸åé¡ºåºä¸æ¬¡è°ç¨è¡¥å¿æä½ã\n\nåå¸å¼äºå¡æ¹æ¡åæï¼\n\n * 2PC/3PC ä¾èµäºæ°æ®åºï¼è½å¤å¾å¥½çæä¾å¼ºä¸è´æ§åå¼ºäºå¡æ§ï¼ä½ç¸å¯¹æ¥è¯´å»¶è¿æ¯è¾é«ï¼æ¯è¾éåä¼ ç»çåä½åºç¨ï¼å¨åä¸ä¸ªæ¹æ³ä¸­å­å¨è·¨åºæä½çæåµï¼ä¸éåé«å¹¶ååé«æ§è½è¦æ±çåºæ¯ã\n * TCC éç¨äºæ§è¡æ¶é´ç¡®å®ä¸è¾ç­ï¼å®æ¶æ§è¦æ±é«ï¼å¯¹æ°æ®ä¸è´æ§è¦æ±é«ï¼æ¯å¦äºèç½éèä¼ä¸ææ ¸å¿çä¸ä¸ªæå¡ï¼äº¤æãæ¯ä»ãè´¦å¡ã\n * æ¬å°æ¶æ¯è¡¨/MQ äºå¡ é½éç¨äºäºå¡ä¸­åä¸æ¹æ¯ææä½å¹ç­ï¼å¯¹ä¸è´æ§è¦æ±ä¸é«ï¼ä¸å¡ä¸è½å®¹å¿æ°æ®ä¸ä¸è´å°ä¸ä¸ªäººå·¥æ£æ¥å¨æï¼äºå¡æ¶åçåä¸æ¹ãåä¸ç¯èè¾å°ï¼ä¸å¡ä¸æå¯¹è´¦/æ ¡éªç³»ç»ååºã\n * Saga äºå¡ ç±äº Saga äºå¡ä¸è½ä¿è¯éç¦»æ§ï¼éè¦å¨ä¸å¡å±æ§å¶å¹¶åï¼éåäºä¸å¡åºæ¯äºå¡å¹¶åæä½åä¸èµæºè¾å°çæåµã Saga ç¸æ¯ç¼ºå°é¢æäº¤å¨ä½ï¼å¯¼è´è¡¥å¿å¨ä½çå®ç°æ¯è¾éº»ç¦ï¼ä¾å¦ä¸å¡æ¯åéç­ä¿¡ï¼è¡¥å¿å¨ä½åå¾ååéä¸æ¬¡ç­ä¿¡è¯´ææ¤éï¼ç¨æ·ä½éªæ¯è¾å·®ãSaga äºå¡è¾éç¨äºè¡¥å¿å¨ä½å®¹æå¤ççåºæ¯ã\n\n> åå¸å¼äºå¡è¯¦ç»è¯´æãåæè¯·åèï¼åå¸å¼äºå¡åºæ¬åç\n\n\n# 7. äºå¡æä½³å®è·µ\n\né«å¹¶ååºæ¯ä¸çäºå¡å°åºè¯¥å¦ä½è°ä¼ï¼\n\n\n# 7.1. å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\nç»åä¸å¡åºæ¯ï¼å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\n\n# 7.2. é¿åè¡éåçº§è¡¨é\n\nå¨ InnoDB ä¸­ï¼è¡éæ¯éè¿ç´¢å¼å®ç°çï¼å¦æä¸éè¿ç´¢å¼æ¡ä»¶æ£ç´¢æ°æ®ï¼è¡éå°ä¼åçº§å°è¡¨éãæä»¬ç¥éï¼è¡¨éæ¯ä¼ä¸¥éå½±åå°æ´å¼ è¡¨çæä½æ§è½çï¼æä»¥åºè¯¥å°½åé¿åã\n\n\n# 7.3. ç¼©å°äºå¡èå´\n\nææ¶åï¼æ°æ®åºå¹¶åè®¿é®éå¤ªå¤§ï¼ä¼åºç°ä»¥ä¸å¼å¸¸ï¼\n\nMySQLQueryInterruptedException: Query execution was interrupted\n\n\né«å¹¶åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°çæåµä¸ï¼ç±äºæ´æ°è®°å½æå¨çäºå¡è¿å¯è½å­å¨å¶ä»æä½ï¼å¯¼è´ä¸ä¸ªäºå¡æ¯è¾é¿ï¼å½æå¤§éè¯·æ±è¿å¥æ¶ï¼å°±å¯è½å¯¼è´ä¸äºè¯·æ±åæ¶è¿å¥å°äºå¡ä¸­ã\n\nåå ä¸ºéçç«äºæ¯ä¸å¬å¹³çï¼å½å¤ä¸ªäºå¡åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°æ¶ï¼æç«¯æåµä¸ï¼ä¸ä¸ªæ´æ°æä½è¿å»æéç³»ç»åï¼å¯è½ä¼ä¸ç´æ¿ä¸å°éï¼æåå è¶æ¶è¢«ç³»ç»ææ­è¸¢åºã\n\n\n\nå¦ä¸å¾ä¸­çæä½ï¼è½ç¶é½æ¯å¨ä¸ä¸ªäºå¡ä¸­ï¼ä½éçç³è¯·å¨ä¸åæ¶é´ï¼åªæå½å¶ä»æä½é½æ§è¡å®ï¼æä¼éæ¾ææéãå ä¸ºæ£é¤åºå­æ¯æ´æ°æä½ï¼å±äºè¡éï¼è¿å°ä¼å½±åå°å¶ä»æä½è¯¥æ°æ®çäºå¡ï¼æä»¥æä»¬åºè¯¥å°½éé¿åé¿æ¶é´å°ææè¯¥éï¼å°½å¿«éæ¾è¯¥éãåå ä¸ºåæ°å»ºè®¢åååæ£é¤åºå­é½ä¸ä¼å½±åä¸å¡ï¼æä»¥æä»¬å¯ä»¥å°æ£é¤åºå­æä½æ¾å°æåï¼ä¹å°±æ¯ä½¿ç¨æ§è¡é¡ºåº 1ï¼ä»¥æ­¤å°½éåå°éçæææ¶é´ã\n\nå¨ InnoDB äºå¡ä¸­ï¼è¡éæ¯å¨éè¦çæ¶åæå ä¸çï¼ä½å¹¶ä¸æ¯ä¸éè¦äºå°±ç«å»éæ¾ï¼èæ¯è¦ç­å°äºå¡ç»ææ¶æéæ¾ãè¿ä¸ªå°±æ¯ä¸¤é¶æ®µéåè®®ã\n\nç¥éäºè¿ä¸ªè®¾å®ï¼å¯¹æä»¬ä½¿ç¨äºå¡æä»ä¹å¸®å©å¢ï¼é£å°±æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ã\n\n\n# 8. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * ãJava æ§è½è°ä¼å®æã\n * ShardingSphere åå¸å¼äºå¡",normalizedContent:"# mysql äºå¡\n\n> ä¸æ¯ææç mysql å­å¨å¼æé½å®ç°äºäºå¡å¤çãæ¯æäºå¡çå­å¨å¼ææï¼innodb å ndb clusterãä¸æ¯æäºå¡çå­å¨å¼æï¼ä»£è¡¨æï¼myisamã\n> \n> ç¨æ·å¯ä»¥æ ¹æ®ä¸å¡æ¯å¦éè¦äºå¡å¤çï¼äºå¡å¤çå¯ä»¥ä¿è¯æ°æ®å®å¨ï¼ä½ä¼å¢å ç³»ç»å¼éï¼ï¼éæ©åéçå­å¨å¼æã\n\n\n\n\n# 1. äºå¡ç®ä»\n\n> äºå¡ç®åæ¥è¯´ï¼ä¸ä¸ª session ä¸­æè¿è¡ææçæä½ï¼è¦ä¹åæ¶æåï¼è¦ä¹åæ¶å¤±è´¥ãè¿ä¸æ­¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ acid ç¹æ§çä¸ç»æä½ï¼å¯ä»¥éè¿ commit æäº¤ä¸ä¸ªäºå¡ï¼ä¹å¯ä»¥ä½¿ç¨ rollback è¿è¡åæ»ã\n\n\n\näºå¡å°±æ¯ä¸ç»åå­æ§ç sql è¯­å¥ãå·ä½æ¥è¯´ï¼äºå¡æçæ¯æ»¡è¶³ acid ç¹æ§çä¸ç»æä½ã\n\näºå¡åç sql è¯­å¥ï¼è¦ä¹å¨æ§è¡æåï¼è¦ä¹å¨æ§è¡å¤±è´¥ã\n\néè¿å éçæ¹å¼ï¼å¯ä»¥å®ç°ä¸åçäºå¡éç¦»æºå¶ã\n\næ³è±¡ä¸ä¸ï¼å¦ææ²¡æäºå¡ï¼å¨å¹¶åç¯å¢ä¸ï¼å°±å¯è½åºç°ä¸¢å¤±ä¿®æ¹çé®é¢ã\n\nt1 å t2 ä¸¤ä¸ªçº¿ç¨é½å¯¹ä¸ä¸ªæ°æ®è¿è¡ä¿®æ¹ï¼t1 åä¿®æ¹ï¼t2 éåä¿®æ¹ï¼t2 çä¿®æ¹è¦çäº t1 çä¿®æ¹ã\n\n\n\n\n# 2. äºå¡ç¨æ³\n\n\n# 2.1. äºå¡å¤çæä»¤\n\nmysql ä¸­ï¼ä½¿ç¨ start transaction è¯­å¥å¼å§ä¸ä¸ªäºå¡ï¼ä½¿ç¨ commit è¯­å¥æäº¤ææçä¿®æ¹ï¼ä½¿ç¨ rollback è¯­å¥æ¤éææçä¿®æ¹ãä¸è½åé select è¯­å¥ï¼åé select è¯­å¥ä¹æ²¡æä¹ï¼ä¹ä¸è½åé create å drop è¯­å¥ã\n\n * start transaction - æä»¤ç¨äºæ è®°äºå¡çèµ·å§ç¹ã\n * savepoint - æä»¤ç¨äºåå»ºä¿çç¹ã\n * rollback to - æä»¤ç¨äºåæ»å°æå®çä¿çç¹ï¼å¦ææ²¡æè®¾ç½®ä¿çç¹ï¼ååéå° start transaction è¯­å¥å¤ã\n * commit - æäº¤äºå¡ã\n\näºå¡å¤çç¤ºä¾ï¼\n\nï¼1ï¼åå»ºä¸å¼ ç¤ºä¾è¡¨\n\n-- æ¤éè¡¨ user\ndrop table if exists user;\n\n-- åå»ºè¡¨ user\ncreate table user (\n  id int(10) unsigned not null comment 'id',\n  username varchar(64) not null default 'default' comment 'ç¨æ·å',\n  password varchar(64) not null default 'default' comment 'å¯ç ',\n  email varchar(64) not null default 'default' comment 'é®ç®±'\n) comment='ç¨æ·è¡¨';\n\n\nï¼2ï¼æ§è¡äºå¡æä½\n\n-- å¼å§äºå¡\nstart transaction;\n\n-- æå¥æä½ a\ninsert into `user`\nvalues (1, 'root1', 'root1', 'xxxx@163.com');\n\n-- åå»ºä¿çç¹ updatea\nsavepoint updatea;\n\n-- æå¥æä½ b\ninsert into `user`\nvalues (2, 'root2', 'root2', 'xxxx@163.com');\n\n-- åæ»å°ä¿çç¹ updatea\nrollback to updatea;\n\n-- æäº¤äºå¡ï¼åªææä½ a çæ\ncommit;\n\n\nï¼3ï¼æ§è¡ç»æ\n\nselect * from user;\n\n\nç»æï¼\n\n1\troot1\troot1\txxxx@163.com\n\n\n\n# 2.2. autocommit\n\nmysql é»è®¤éç¨éå¼æäº¤ç­ç¥ï¼autocommitï¼ãæ¯æ§è¡ä¸æ¡è¯­å¥å°±æè¿æ¡è¯­å¥å½æä¸ä¸ªäºå¡ç¶åè¿è¡æäº¤ãå½åºç° start transaction è¯­å¥æ¶ï¼ä¼å³é­éå¼æäº¤ï¼å½ commit æ rollback è¯­å¥æ§è¡åï¼äºå¡ä¼èªå¨å³é­ï¼éæ°æ¢å¤éå¼æäº¤ã\n\néè¿ set autocommit=0 å¯ä»¥åæ¶èªå¨æäº¤ï¼ç´å° set autocommit=1 æä¼æäº¤ï¼autocommit æ è®°æ¯éå¯¹æ¯ä¸ªè¿æ¥èä¸æ¯éå¯¹æå¡å¨çã\n\n-- æ¥ç autocommit\nshow variables like 'autocommit';\n\n-- å³é­ autocommit\nset autocommit = 0;\n\n-- å¼å¯ autocommit\nset autocommit = 1;\n\n\n\n# 3. acid\n\nacid æ¯æ°æ®åºäºå¡æ­£ç¡®æ§è¡çåä¸ªåºæ¬è¦ç´ ã\n\n * åå­æ§ï¼atomicityï¼\n   * äºå¡è¢«è§ä¸ºä¸å¯åå²çæå°ååï¼äºå¡ä¸­çæææä½è¦ä¹å¨é¨æäº¤æåï¼è¦ä¹å¨é¨å¤±è´¥åæ»ã\n   * åæ»å¯ä»¥ç¨æ¥å¿æ¥å®ç°ï¼æ¥å¿è®°å½çäºå¡ææ§è¡çä¿®æ¹æä½ï¼å¨åæ»æ¶ååæ§è¡è¿äºä¿®æ¹æä½å³å¯ã\n * ä¸è´æ§ï¼consistencyï¼\n   * æ°æ®åºå¨äºå¡æ§è¡ååé½ä¿æä¸è´æ§ç¶æã\n   * å¨ä¸è´æ§ç¶æä¸ï¼ææäºå¡å¯¹ä¸ä¸ªæ°æ®çè¯»åç»æé½æ¯ç¸åçã\n * éç¦»æ§ï¼isolationï¼\n   * ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æç»æäº¤ä»¥åï¼å¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * æä¹æ§ï¼durabilityï¼\n   * ä¸æ¦äºå¡æäº¤ï¼åå¶æåçä¿®æ¹å°ä¼æ°¸è¿ä¿å­å°æ°æ®åºä¸­ãå³ä½¿ç³»ç»åçå´©æºï¼äºå¡æ§è¡çç»æä¹ä¸è½ä¸¢å¤±ã\n   * å¯ä»¥éè¿æ°æ®åºå¤ä»½åæ¢å¤æ¥å®ç°ï¼å¨ç³»ç»åçå¥æºæ¶ï¼ä½¿ç¨å¤ä»½çæ°æ®åºè¿è¡æ°æ®æ¢å¤ã\n\nä¸ä¸ªæ¯æäºå¡ï¼transactionï¼ä¸­çæ°æ®åºç³»ç»ï¼å¿éè¦å·æè¿åç§ç¹æ§ï¼å¦åå¨äºå¡è¿ç¨ï¼transaction processingï¼å½ä¸­æ æ³ä¿è¯æ°æ®çæ­£ç¡®æ§ï¼äº¤æè¿ç¨æå¯è½è¾¾ä¸å°äº¤æã\n\n * åªææ»¡è¶³ä¸è´æ§ï¼äºå¡çæ§è¡ç»æææ¯æ­£ç¡®çã\n * å¨æ å¹¶åçæåµä¸ï¼äºå¡ä¸²è¡æ§è¡ï¼éç¦»æ§ä¸å®è½å¤æ»¡è¶³ãæ­¤æ¶åªè¦è½æ»¡è¶³åå­æ§ï¼å°±ä¸å®è½æ»¡è¶³ä¸è´æ§ã\n * å¨å¹¶åçæåµä¸ï¼å¤ä¸ªäºå¡å¹¶è¡æ§è¡ï¼äºå¡ä¸ä»è¦æ»¡è¶³åå­æ§ï¼è¿éè¦æ»¡è¶³éç¦»æ§ï¼æè½æ»¡è¶³ä¸è´æ§ã\n * äºå¡æ»¡è¶³æä¹åæ¯ä¸ºäºè½åºå¯¹ç³»ç»å´©æºçæåµã\n\n\n\n> mysql é»è®¤éç¨èªå¨æäº¤æ¨¡å¼ï¼auto commitï¼ãä¹å°±æ¯è¯´ï¼å¦æä¸æ¾å¼ä½¿ç¨ start transaction è¯­å¥æ¥å¼å§ä¸ä¸ªäºå¡ï¼é£ä¹æ¯ä¸ªæ¥è¯¢æä½é½ä¼è¢«å½åä¸ä¸ªäºå¡å¹¶èªå¨æäº¤ã\n\n\n# 4. äºå¡éç¦»çº§å«\n\n\n# 4.1. äºå¡éç¦»ç®ä»\n\nå¨å¹¶åç¯å¢ä¸ï¼äºå¡çéç¦»æ§å¾é¾ä¿è¯ï¼å æ­¤ä¼åºç°å¾å¤å¹¶åä¸è´æ§é®é¢ï¼\n\n * ä¸¢å¤±ä¿®æ¹\n * èè¯»\n * ä¸å¯éå¤è¯»\n * å¹»è¯»\n\nå¨ sql æ åä¸­ï¼å®ä¹äºåç§äºå¡éç¦»çº§å«ï¼çº§å«ç±ä½å°é«ï¼ï¼\n\n * æªæäº¤è¯»\n * æäº¤è¯»\n * å¯éå¤è¯»\n * ä¸²è¡å\n\nmysql ä¸­æ¥çåè®¾ç½®äºå¡éç¦»çº§å«ï¼\n\n-- æ¥çäºå¡éç¦»çº§å«\nshow variables like 'transaction_isolation';\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º read uncommitted\nset session transaction isolation level read uncommitted;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º read committed\nset session transaction isolation level read committed;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º repeatable read\nset session transaction isolation level repeatable read;\n\n-- è®¾ç½®äºå¡éç¦»çº§å«ä¸º serializable\nset session transaction isolation level serializable;\n\n\n\n# 4.2. æªæäº¤è¯»\n\næªæäº¤è¯»ï¼read uncommittedï¼ æ¯æï¼äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n\næªæäº¤è¯»çé®é¢ï¼äºå¡å¯ä»¥è¯»åæªæäº¤çæ°æ®ï¼ä¹è¢«ç§°ä¸º èè¯»ï¼dirty readï¼ã\n\nt1 ä¿®æ¹ä¸ä¸ªæ°æ®ï¼t2 éåè¯»åè¿ä¸ªæ°æ®ãå¦æ t1 æ¤éäºè¿æ¬¡ä¿®æ¹ï¼é£ä¹ t2 è¯»åçæ°æ®æ¯èæ°æ®ã\n\n\n\n\n# 4.3. æäº¤è¯»\n\næäº¤è¯»ï¼read committedï¼ æ¯æï¼äºå¡æäº¤åï¼å¶ä»äºå¡æè½çå°å®çä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çãæäº¤è¯»è§£å³äºèè¯»çé®é¢ã\n\næäº¤è¯»æ¯å¤§å¤æ°æ°æ®åºçé»è®¤äºå¡éç¦»çº§å«ã\n\næäº¤è¯»ææ¶ä¹å«ä¸å¯éå¤è¯»ï¼å®çé®é¢æ¯ï¼æ§è¡ä¸¤æ¬¡ç¸åçæ¥è¯¢ï¼å¾å°çç»æå¯è½ä¸ä¸è´ã\n\nt2 è¯»åä¸ä¸ªæ°æ®ï¼t1 å¯¹è¯¥æ°æ®åäºä¿®æ¹ãå¦æ t2 åæ¬¡è¯»åè¿ä¸ªæ°æ®ï¼æ­¤æ¶è¯»åçç»æåç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n\n# 4.4. å¯éå¤è¯»\n\nå¯éå¤è¯»ï¼repeatable readï¼ æ¯æï¼ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çãå¯éå¤è¯»è§£å³äºä¸å¯éå¤è¯»é®é¢ã\n\nå¯éå¤è¯»æ¯ mysql çé»è®¤äºå¡éç¦»çº§å«ã\n\nå¯éå¤è¯»çé®é¢ï¼å½æä¸ªäºå¡è¯»åæä¸ªèå´åçè®°å½æ¶ï¼å¦å¤ä¸ä¸ªäºå¡åå¨è¯¥èå´åæå¥äºæ°çè®°å½ï¼å½ä¹åçäºå¡ååæ¬¡è¯»åè¯¥èå´çè®°å½æ¶ï¼ä¼äº§ç å¹»è¯»ï¼phantom readï¼ã\n\nt1 è¯»åæä¸ªèå´çæ°æ®ï¼t2 å¨è¿ä¸ªèå´åæå¥æ°çæ°æ®ï¼t1 åæ¬¡è¯»åè¿ä¸ªèå´çæ°æ®ï¼æ­¤æ¶è¯»åçç»æååç¬¬ä¸æ¬¡è¯»åçç»æä¸åã\n\n\n\n\n# 4.5. ä¸²è¡å\n\nä¸²è¡åï¼serialixableï¼ æ¯æï¼å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\nå¼ºå¶äºå¡ä¸²è¡æ§è¡ï¼åé¿åäºææçå¹¶åé®é¢ãä¸²è¡åç­ç¥ä¼å¨è¯»åçæ¯ä¸è¡æ°æ®ä¸é½å éï¼è¿å¯è½å¯¼è´å¤§éçè¶æ¶åéç«äºãè¿å¯¹äºé«å¹¶ååºç¨åºæ¬ä¸æ¯ä¸å¯æ¥åçï¼æä»¥ä¸è¬ä¸ä¼éç¨è¿ä¸ªçº§å«ã\n\n\n# 4.6. éç¦»çº§å«å°ç»\n\n * æªæäº¤è¯»ï¼read uncommittedï¼ - äºå¡ä¸­çä¿®æ¹ï¼å³ä½¿æ²¡ææäº¤ï¼å¯¹å¶å®äºå¡ä¹æ¯å¯è§çã\n * æäº¤è¯»ï¼read committedï¼ - ä¸ä¸ªäºå¡åªè½è¯»åå·²ç»æäº¤çäºå¡æåçä¿®æ¹ãæ¢å¥è¯è¯´ï¼ä¸ä¸ªäºå¡æåçä¿®æ¹å¨æäº¤ä¹åå¯¹å¶å®äºå¡æ¯ä¸å¯è§çã\n * éå¤è¯»ï¼repeatable readï¼ - ä¿è¯å¨åä¸ä¸ªäºå¡ä¸­å¤æ¬¡è¯»ååæ ·æ°æ®çç»ææ¯ä¸æ ·çã\n * ä¸²è¡åï¼serialixableï¼ - å¼ºå¶äºå¡ä¸²è¡æ§è¡ã\n\næ°æ®åºéç¦»çº§å«è§£å³çé®é¢ï¼\n\néç¦»çº§å«   ä¸¢å¤±ä¿®æ¹   èè¯»   ä¸å¯éå¤è¯»   å¹»è¯»\næªæäº¤è¯»   âï¸     â    â       â\næäº¤è¯»    âï¸     âï¸   â       â\nå¯éå¤è¯»   âï¸     âï¸   âï¸      â\nå¯ä¸²è¡å   âï¸     âï¸   âï¸      âï¸\n\n\n# 5. æ­»é\n\næ­»éæ¯æä¸¤ä¸ªæå¤ä¸ªäºå¡ç«äºåä¸èµæºï¼å¹¶è¯·æ±éå®å¯¹æ¹å ç¨çèµæºï¼ä»èå¯¼è´æ¶æ§å¾ªç¯çç°è±¡ã\n\näº§çæ­»éçåºæ¯ï¼\n\n * å½å¤ä¸ªäºå¡è¯å¾ä»¥ä¸åçé¡ºåºéå®èµæºæ¶ï¼å°±å¯è½ä¼äº§çæ­»éã\n\n * å¤ä¸ªäºå¡åæ¶éå®åä¸ä¸ªèµæºæ¶ï¼ä¹ä¼äº§çæ­»éã\n\n\n# 5.1. æ­»éçåå \n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockãrecord lock æ¯ä¸é¨å¯¹ç´¢å¼é¡¹å éï¼gap lock æ¯å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éï¼next-key lock åæ¯åé¢ä¸¤ç§çç»åï¼å¯¹ç´¢å¼é¡¹ä»¥å¶ä¹é´çé´éå éã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockï¼å¨ selectãupdate å delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nå¨ mysql ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ mysql ä¸­é»è®¤çæ¯ rr äºå¡éç¦»çº§å«ã\n\nå½æä»¬æ§è¡ä»¥ä¸æ¥è¯¢ sql æ¶ï¼ç±äº order_no åä¸ºéå¯ä¸ç´¢å¼ï¼æ­¤æ¶åæ¯ rr äºå¡éç¦»çº§å«ï¼æä»¥ select çå éç±»åä¸º gap lockï¼è¿éç gap èå´æ¯ (4,+âï¼ã\n\n> select id from demo.order_record where order_no = 4 for update;\n\næ§è¡æ¥è¯¢ sql è¯­å¥è·åç gap lock å¹¶ä¸ä¼å¯¼è´é»å¡ï¼èå½æä»¬æ§è¡ä»¥ä¸æå¥ sql æ¶ï¼ä¼å¨æå¥é´éä¸åæ¬¡è·åæå¥æåéãæå¥æåéå¶å®ä¹æ¯ä¸ç§ gap éï¼å®ä¸ gap lock æ¯å²çªçï¼æä»¥å½å¶å®äºå¡ææè¯¥é´éç gap lock æ¶ï¼éè¦ç­å¾å¶å®äºå¡éæ¾ gap lock ä¹åï¼æè½è·åå°æå¥æåéã\n\nä»¥ä¸äºå¡ a åäºå¡ b é½ææé´é (4,+âï¼ç gap éï¼èæ¥ä¸æ¥çæå¥æä½ä¸ºäºè·åå°æå¥æåéï¼é½å¨ç­å¾å¯¹æ¹äºå¡ç gap ééæ¾ï¼äºæ¯å°±é æäºå¾ªç¯ç­å¾ï¼å¯¼è´æ­»éã\n\n> insert into demo.order_record(order_no, status, create_date) values (5, 1, â2019-07-13 10:57:03â);\n\n\n\nå¦ä¸ä¸ªæ­»éåºæ¯\n\ninnodb å­å¨å¼æçä¸»é®ç´¢å¼ä¸ºèç°ç´¢å¼ï¼å¶å®ç´¢å¼ä¸ºè¾å©ç´¢å¼ãå¦æä½¿ç¨è¾å©ç´¢å¼æ¥æ´æ°æ°æ®åºï¼å°±éè¦ä½¿ç¨èç°ç´¢å¼æ¥æ´æ°æ°æ®åºå­æ®µãå¦æä¸¤ä¸ªæ´æ°äºå¡ä½¿ç¨äºä¸åçè¾å©ç´¢å¼ï¼æä¸ä¸ªä½¿ç¨äºè¾å©ç´¢å¼ï¼ä¸ä¸ªä½¿ç¨äºèç°ç´¢å¼ï¼å°±é½æå¯è½å¯¼è´éèµæºçå¾ªç¯ç­å¾ãç±äºæ¬èº«ä¸¤ä¸ªäºå¡æ¯äºæ¥ï¼ä¹å°±ææäºä»¥ä¸æ­»éçåä¸ªå¿è¦æ¡ä»¶äºã\n\n\n\nåºç°æ­»éçæ­¥éª¤ï¼\n\n\n\nç»¼ä¸å¯ç¥ï¼å¨æ´æ°æä½æ¶ï¼æä»¬åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥æ´æ°è¡¨å­æ®µï¼è¿æ ·å¯ä»¥ææé¿åä¸äºä¸å¿è¦çæ­»éåçã\n\n\n# 5.2. é¿åæ­»é\n\né¢é²æ­»éçæ³¨æäºé¡¹ï¼\n\n * å¨ç¼ç¨ä¸­å°½éæç§åºå®çé¡ºåºæ¥å¤çæ°æ®åºè®°å½ï¼åè®¾æä¸¤ä¸ªæ´æ°æä½ï¼åå«æ´æ°ä¸¤æ¡ç¸åçè®°å½ï¼ä½æ´æ°é¡ºåºä¸ä¸æ ·ï¼æå¯è½å¯¼è´æ­»éï¼\n * å¨åè®¸å¹»è¯»åä¸å¯éå¤è¯»çæåµä¸ï¼å°½éä½¿ç¨ rc äºå¡éç¦»çº§å«ï¼å¯ä»¥é¿å gap lock å¯¼è´çæ­»éé®é¢ï¼\n * æ´æ°è¡¨æ¶ï¼å°½éä½¿ç¨ä¸»é®æ´æ°ï¼\n * é¿åé¿äºå¡ï¼å°½éå°é¿äºå¡æè§£ï¼å¯ä»¥éä½ä¸å¶å®äºå¡åçå²çªçæ¦çï¼\n * è®¾ç½®åççéç­å¾è¶æ¶åæ°ï¼æä»¬å¯ä»¥éè¿ innodb_lock_wait_timeout è®¾ç½®åççç­å¾è¶æ¶éå¼ï¼ç¹å«æ¯å¨ä¸äºé«å¹¶åçä¸å¡ä¸­ï¼æä»¬å¯ä»¥å°½éå°è¯¥å¼è®¾ç½®å¾å°ä¸äºï¼é¿åå¤§éäºå¡ç­å¾ï¼å ç¨ç³»ç»èµæºï¼é æä¸¥éçæ§è½å¼éã\n\nå¦å¤ï¼æä»¬è¿å¯ä»¥å° order_no åè®¾ç½®ä¸ºå¯ä¸ç´¢å¼åãè½ç¶ä¸è½é²æ­¢å¹»è¯»ï¼ä½æä»¬å¯ä»¥å©ç¨å®çå¯ä¸æ§æ¥ä¿è¯è®¢åè®°å½ä¸éå¤åå»ºï¼è¿ç§æ¹å¼å¯ä¸çç¼ºç¹å°±æ¯å½éå°éå¤åå»ºè®¢åæ¶ä¼æåºå¼å¸¸ã\n\næä»¬è¿å¯ä»¥ä½¿ç¨å¶å®çæ¹å¼æ¥ä»£æ¿æ°æ®åºå®ç°å¹ç­æ§æ ¡éªãä¾å¦ï¼ä½¿ç¨ redis ä»¥å zookeeper æ¥å®ç°ï¼è¿è¡æçæ¯æ°æ®åºæ´ä½³ã\n\n\n# 5.3. è§£å³æ­»é\n\nå½åºç°æ­»éä»¥åï¼æä¸¤ç§ç­ç¥ï¼\n\n * ä¸ç§ç­ç¥æ¯ï¼ç´æ¥è¿å¥ç­å¾ï¼ç´å°è¶æ¶ãè¿ä¸ªè¶æ¶æ¶é´å¯ä»¥éè¿åæ° innodb_lock_wait_timeout æ¥è®¾ç½®ã\n * å¦ä¸ç§ç­ç¥æ¯ï¼åèµ·æ­»éæ£æµï¼åç°æ­»éåï¼ä¸»å¨åæ»æ­»éé¾æ¡ä¸­çæä¸ä¸ªäºå¡ï¼è®©å¶ä»äºå¡å¾ä»¥ç»§ç»­æ§è¡ãå°åæ° innodb_deadlock_detect è®¾ç½®ä¸º onï¼è¡¨ç¤ºå¼å¯è¿ä¸ªé»è¾ã\n\nå¨ innodb ä¸­ï¼innodb_lock_wait_timeout çé»è®¤å¼æ¯ 50sï¼æå³çå¦æéç¨ç¬¬ä¸ä¸ªç­ç¥ï¼å½åºç°æ­»éä»¥åï¼ç¬¬ä¸ä¸ªè¢«éä½ççº¿ç¨è¦è¿ 50s æä¼è¶æ¶éåºï¼ç¶åå¶ä»çº¿ç¨ææå¯è½ç»§ç»­æ§è¡ãå¯¹äºå¨çº¿æå¡æ¥è¯´ï¼è¿ä¸ªç­å¾æ¶é´å¾å¾æ¯æ æ³æ¥åçã\n\nä½æ¯ï¼æä»¬åä¸å¯è½ç´æ¥æè¿ä¸ªæ¶é´è®¾ç½®æä¸ä¸ªå¾å°çå¼ï¼æ¯å¦ 1sãè¿æ ·å½åºç°æ­»éçæ¶åï¼ç¡®å®å¾å¿«å°±å¯ä»¥è§£å¼ï¼ä½å¦æä¸æ¯æ­»éï¼èæ¯ç®åçéç­å¾å¢ï¼æä»¥ï¼è¶æ¶æ¶é´è®¾ç½®å¤ªç­çè¯ï¼ä¼åºç°å¾å¤è¯¯ä¼¤ã\n\næä»¥ï¼æ­£å¸¸æåµä¸æä»¬è¿æ¯è¦éç¨ç¬¬äºç§ç­ç¥ï¼å³ï¼ä¸»å¨æ­»éæ£æµï¼èä¸ innodb_deadlock_detect çé»è®¤å¼æ¬èº«å°±æ¯ onãä¸ºäºè§£å³æ­»éé®é¢ï¼ä¸åæ°æ®åºå®ç°äºåèªçæ­»éæ£æµåè¶æ¶æºå¶ãinnodb çå¤çç­ç¥æ¯ï¼å°æææå°è¡çº§æå®éçäºå¡è¿è¡åæ»ã\n\nä¸»å¨æ­»éæ£æµå¨åçæ­»éçæ¶åï¼æ¯è½å¤å¿«éåç°å¹¶è¿è¡å¤ççï¼ä½æ¯å®ä¹æ¯æé¢å¤è´æçãä½ å¯ä»¥æ³è±¡ä¸ä¸è¿ä¸ªè¿ç¨ï¼æ¯å½ä¸ä¸ªäºå¡è¢«éçæ¶åï¼å°±è¦ççå®æä¾èµççº¿ç¨ææ²¡æè¢«å«äººéä½ï¼å¦æ­¤å¾ªç¯ï¼æåå¤æ­æ¯å¦åºç°äºå¾ªç¯ç­å¾ï¼ä¹å°±æ¯æ­»éã\n\n\n# 6. åå¸å¼äºå¡\n\nå¨åä¸æ°æ®èç¹ä¸­ï¼äºå¡ä»éäºå¯¹åä¸æ°æ®åºèµæºçè®¿é®æ§å¶ï¼ç§°ä¹ä¸º æ¬å°äºå¡ãå ä¹ææçæççå³ç³»åæ°æ®åºé½æä¾äºå¯¹æ¬å°äºå¡çåçæ¯æã\n\nåå¸å¼äºå¡æçæ¯äºå¡æä½è·¨è¶å¤ä¸ªèç¹ï¼å¹¶ä¸è¦æ±æ»¡è¶³äºå¡ç acid ç¹æ§ã\n\nåå¸å¼äºå¡çå¸¸è§æ¹æ¡å¦ä¸ï¼\n\n * ä¸¤é¶æ®µæäº¤ï¼2pcï¼ - å°äºå¡çæäº¤è¿ç¨åä¸ºä¸¤ä¸ªé¶æ®µæ¥è¿è¡å¤çï¼åå¤é¶æ®µåæäº¤é¶æ®µãåä¸èå°æä½æè´¥éç¥åè°èï¼åç±åè°èæ ¹æ®ææåä¸èçåé¦ææ¥å³å®ååä¸èæ¯å¦è¦æäº¤æä½è¿æ¯ä¸­æ­¢æä½ã\n * ä¸é¶æ®µæäº¤ï¼3pcï¼ - ä¸äºé¶æ®µæäº¤ä¸åçæ¯ï¼å¼å¥è¶æ¶æºå¶ãåæ¶å¨åè°èååä¸èä¸­é½å¼å¥è¶æ¶æºå¶ãå°äºé¶æ®µçåå¤é¶æ®µæåä¸º 2 ä¸ªé¶æ®µï¼æå¥äºä¸ä¸ª precommit é¶æ®µï¼ä½¿å¾ååå¨äºé¶æ®µæäº¤ä¸­ï¼åä¸èå¨åå¤ä¹åï¼ç±äºåè°èåçå´©æºæéè¯¯ï¼èå¯¼è´åä¸èå¤äºæ æ³ç¥ææ¯å¦æäº¤æèä¸­æ­¢çâä¸ç¡®å®ç¶æâæäº§ççå¯è½ç¸å½é¿çå»¶æ¶çé®é¢å¾ä»¥è§£å³ã\n * è¡¥å¿äºå¡ï¼tccï¼\n   * try - æä½ä½ä¸ºä¸é¶æ®µï¼è´è´£èµæºçæ£æ¥åé¢çã\n   * confirm - æä½ä½ä¸ºäºé¶æ®µæäº¤æä½ï¼æ§è¡çæ­£çä¸å¡ã\n   * cancel - æ¯é¢çèµæºçåæ¶ã\n * æ¬å°æ¶æ¯è¡¨ - å¨äºå¡ä¸»å¨åèµ·æ¹é¢å¤æ°å»ºäºå¡æ¶æ¯è¡¨ï¼äºå¡åèµ·æ¹å¤çä¸å¡åè®°å½äºå¡æ¶æ¯å¨æ¬å°äºå¡ä¸­å®æï¼è½®è¯¢äºå¡æ¶æ¯è¡¨çæ°æ®åéäºå¡æ¶æ¯ï¼äºå¡è¢«å¨æ¹åºäºæ¶æ¯ä¸­é´ä»¶æ¶è´¹äºå¡æ¶æ¯è¡¨ä¸­çäºå¡ã\n * mq äºå¡ - åºäº mq çåå¸å¼äºå¡æ¹æ¡å¶å®æ¯å¯¹æ¬å°æ¶æ¯è¡¨çå°è£ã\n * saga - saga äºå¡æ ¸å¿ææ³æ¯å°é¿äºå¡æåä¸ºå¤ä¸ªæ¬å°ç­äºå¡ï¼ç± saga äºå¡åè°å¨åè°ï¼å¦ææ­£å¸¸ç»æé£å°±æ­£å¸¸å®æï¼å¦ææä¸ªæ­¥éª¤å¤±è´¥ï¼åæ ¹æ®ç¸åé¡ºåºä¸æ¬¡è°ç¨è¡¥å¿æä½ã\n\nåå¸å¼äºå¡æ¹æ¡åæï¼\n\n * 2pc/3pc ä¾èµäºæ°æ®åºï¼è½å¤å¾å¥½çæä¾å¼ºä¸è´æ§åå¼ºäºå¡æ§ï¼ä½ç¸å¯¹æ¥è¯´å»¶è¿æ¯è¾é«ï¼æ¯è¾éåä¼ ç»çåä½åºç¨ï¼å¨åä¸ä¸ªæ¹æ³ä¸­å­å¨è·¨åºæä½çæåµï¼ä¸éåé«å¹¶ååé«æ§è½è¦æ±çåºæ¯ã\n * tcc éç¨äºæ§è¡æ¶é´ç¡®å®ä¸è¾ç­ï¼å®æ¶æ§è¦æ±é«ï¼å¯¹æ°æ®ä¸è´æ§è¦æ±é«ï¼æ¯å¦äºèç½éèä¼ä¸ææ ¸å¿çä¸ä¸ªæå¡ï¼äº¤æãæ¯ä»ãè´¦å¡ã\n * æ¬å°æ¶æ¯è¡¨/mq äºå¡ é½éç¨äºäºå¡ä¸­åä¸æ¹æ¯ææä½å¹ç­ï¼å¯¹ä¸è´æ§è¦æ±ä¸é«ï¼ä¸å¡ä¸è½å®¹å¿æ°æ®ä¸ä¸è´å°ä¸ä¸ªäººå·¥æ£æ¥å¨æï¼äºå¡æ¶åçåä¸æ¹ãåä¸ç¯èè¾å°ï¼ä¸å¡ä¸æå¯¹è´¦/æ ¡éªç³»ç»ååºã\n * saga äºå¡ ç±äº saga äºå¡ä¸è½ä¿è¯éç¦»æ§ï¼éè¦å¨ä¸å¡å±æ§å¶å¹¶åï¼éåäºä¸å¡åºæ¯äºå¡å¹¶åæä½åä¸èµæºè¾å°çæåµã saga ç¸æ¯ç¼ºå°é¢æäº¤å¨ä½ï¼å¯¼è´è¡¥å¿å¨ä½çå®ç°æ¯è¾éº»ç¦ï¼ä¾å¦ä¸å¡æ¯åéç­ä¿¡ï¼è¡¥å¿å¨ä½åå¾ååéä¸æ¬¡ç­ä¿¡è¯´ææ¤éï¼ç¨æ·ä½éªæ¯è¾å·®ãsaga äºå¡è¾éç¨äºè¡¥å¿å¨ä½å®¹æå¤ççåºæ¯ã\n\n> åå¸å¼äºå¡è¯¦ç»è¯´æãåæè¯·åèï¼åå¸å¼äºå¡åºæ¬åç\n\n\n# 7. äºå¡æä½³å®è·µ\n\né«å¹¶ååºæ¯ä¸çäºå¡å°åºè¯¥å¦ä½è°ä¼ï¼\n\n\n# 7.1. å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\nç»åä¸å¡åºæ¯ï¼å°½éä½¿ç¨ä½çº§å«äºå¡éç¦»\n\n\n# 7.2. é¿åè¡éåçº§è¡¨é\n\nå¨ innodb ä¸­ï¼è¡éæ¯éè¿ç´¢å¼å®ç°çï¼å¦æä¸éè¿ç´¢å¼æ¡ä»¶æ£ç´¢æ°æ®ï¼è¡éå°ä¼åçº§å°è¡¨éãæä»¬ç¥éï¼è¡¨éæ¯ä¼ä¸¥éå½±åå°æ´å¼ è¡¨çæä½æ§è½çï¼æä»¥åºè¯¥å°½åé¿åã\n\n\n# 7.3. ç¼©å°äºå¡èå´\n\nææ¶åï¼æ°æ®åºå¹¶åè®¿é®éå¤ªå¤§ï¼ä¼åºç°ä»¥ä¸å¼å¸¸ï¼\n\nmysqlqueryinterruptedexception: query execution was interrupted\n\n\né«å¹¶åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°çæåµä¸ï¼ç±äºæ´æ°è®°å½æå¨çäºå¡è¿å¯è½å­å¨å¶ä»æä½ï¼å¯¼è´ä¸ä¸ªäºå¡æ¯è¾é¿ï¼å½æå¤§éè¯·æ±è¿å¥æ¶ï¼å°±å¯è½å¯¼è´ä¸äºè¯·æ±åæ¶è¿å¥å°äºå¡ä¸­ã\n\nåå ä¸ºéçç«äºæ¯ä¸å¬å¹³çï¼å½å¤ä¸ªäºå¡åæ¶å¯¹ä¸æ¡è®°å½è¿è¡æ´æ°æ¶ï¼æç«¯æåµä¸ï¼ä¸ä¸ªæ´æ°æä½è¿å»æéç³»ç»åï¼å¯è½ä¼ä¸ç´æ¿ä¸å°éï¼æåå è¶æ¶è¢«ç³»ç»ææ­è¸¢åºã\n\n\n\nå¦ä¸å¾ä¸­çæä½ï¼è½ç¶é½æ¯å¨ä¸ä¸ªäºå¡ä¸­ï¼ä½éçç³è¯·å¨ä¸åæ¶é´ï¼åªæå½å¶ä»æä½é½æ§è¡å®ï¼æä¼éæ¾ææéãå ä¸ºæ£é¤åºå­æ¯æ´æ°æä½ï¼å±äºè¡éï¼è¿å°ä¼å½±åå°å¶ä»æä½è¯¥æ°æ®çäºå¡ï¼æä»¥æä»¬åºè¯¥å°½éé¿åé¿æ¶é´å°ææè¯¥éï¼å°½å¿«éæ¾è¯¥éãåå ä¸ºåæ°å»ºè®¢åååæ£é¤åºå­é½ä¸ä¼å½±åä¸å¡ï¼æä»¥æä»¬å¯ä»¥å°æ£é¤åºå­æä½æ¾å°æåï¼ä¹å°±æ¯ä½¿ç¨æ§è¡é¡ºåº 1ï¼ä»¥æ­¤å°½éåå°éçæææ¶é´ã\n\nå¨ innodb äºå¡ä¸­ï¼è¡éæ¯å¨éè¦çæ¶åæå ä¸çï¼ä½å¹¶ä¸æ¯ä¸éè¦äºå°±ç«å»éæ¾ï¼èæ¯è¦ç­å°äºå¡ç»ææ¶æéæ¾ãè¿ä¸ªå°±æ¯ä¸¤é¶æ®µéåè®®ã\n\nç¥éäºè¿ä¸ªè®¾å®ï¼å¯¹æä»¬ä½¿ç¨äºå¡æä»ä¹å¸®å©å¢ï¼é£å°±æ¯ï¼å¦æä½ çäºå¡ä¸­éè¦éå¤ä¸ªè¡ï¼è¦ææå¯è½é æéå²çªãæå¯è½å½±åå¹¶ååº¦çéå°½éå¾åæ¾ã\n\n\n# 8. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * ãjava æ§è½è°ä¼å®æã\n * shardingsphere åå¸å¼äºå¡",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql é",frontmatter:{title:"Mysql é",date:"2020-09-07T07:54:19.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","é"],permalink:"/pages/86db3b/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/04.Mysql%E9%94%81.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/04.Mysqlé.md",key:"v-0c3c1ebd",path:"/pages/86db3b/",headers:[{level:2,title:"1. æ²è§éåä¹è§é",slug:"_1-æ²è§éåä¹è§é",normalizedTitle:"1. æ²è§éåä¹è§é",charIndex:16},{level:2,title:"2. è¡¨çº§éåè¡çº§é",slug:"_2-è¡¨çº§éåè¡çº§é",normalizedTitle:"2. è¡¨çº§éåè¡çº§é",charIndex:608},{level:2,title:"3. è¯»åé",slug:"_3-è¯»åé",normalizedTitle:"3. è¯»åé",charIndex:1029},{level:2,title:"4. æåé",slug:"_4-æåé",normalizedTitle:"4. æåé",charIndex:1234},{level:2,title:"5. MVCC",slug:"_5-mvcc",normalizedTitle:"5. mvcc",charIndex:2032},{level:3,title:"5.1. MVCC ææ³",slug:"_5-1-mvcc-ææ³",normalizedTitle:"5.1. mvcc ææ³",charIndex:2316},{level:3,title:"5.2. çæ¬å·",slug:"_5-2-çæ¬å·",normalizedTitle:"5.2. çæ¬å·",charIndex:2637},{level:3,title:"5.3. Undo æ¥å¿",slug:"_5-3-undo-æ¥å¿",normalizedTitle:"5.3. undo æ¥å¿",charIndex:2865},{level:3,title:"5.4. ReadView",slug:"_5-4-readview",normalizedTitle:"5.4. readview",charIndex:3370},{level:3,title:"5.5. å¿«ç§è¯»ä¸å½åè¯»",slug:"_5-5-å¿«ç§è¯»ä¸å½åè¯»",normalizedTitle:"5.5. å¿«ç§è¯»ä¸å½åè¯»",charIndex:4241},{level:2,title:"6. è¡é",slug:"_6-è¡é",normalizedTitle:"6. è¡é",charIndex:4605},{level:2,title:"7. åèèµæ",slug:"_7-åèèµæ",normalizedTitle:"7. åèèµæ",charIndex:5592}],headersStr:"1. æ²è§éåä¹è§é 2. è¡¨çº§éåè¡çº§é 3. è¯»åé 4. æåé 5. MVCC 5.1. MVCC ææ³ 5.2. çæ¬å· 5.3. Undo æ¥å¿ 5.4. ReadView 5.5. å¿«ç§è¯»ä¸å½åè¯» 6. è¡é 7. åèèµæ",content:'# Mysql é\n\n\n\n\n# 1. æ²è§éåä¹è§é\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼COMMITï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶ã\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³ã\n\nãç¤ºä¾ãä¹è§éç¤ºä¾\n\nåå goods è¡¨ä¸­æä¸ä¸ªå­æ®µ statusï¼status ä¸º 1 ä»£è¡¨ååæªè¢«ä¸åï¼status ä¸º 2 ä»£è¡¨ååå·²ç»è¢«ä¸åï¼é£ä¹æä»¬å¯¹æä¸ªååä¸åæ¶å¿é¡»ç¡®ä¿è¯¥åå status ä¸º 1ãåè®¾ååç id ä¸º 1ã\n\nselect (status,status,version) from t_goods where id=#{id}\n\nupdate t_goods\nset status=2,version=version+1\nwhere id=#{id} and version=#{version};\n\n\n> æ´è¯¦ç»çä¹è§éè¯´å¯ä»¥åèï¼ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢\n\n\n# 2. è¡¨çº§éåè¡çº§é\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼MySQL ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - éå®æå®çè¡è®°å½ãè¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\nåºè¯¥å°½éåªéå®éè¦ä¿®æ¹çé£é¨åæ°æ®ï¼èä¸æ¯ææçèµæºãéå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ãä½æ¯å ééè¦æ¶èèµæºï¼éçåç§æä½ï¼åæ¬è·åéãéæ¾éãä»¥åæ£æ¥éç¶æï¼é½ä¼å¢å ç³»ç»å¼éãå æ­¤éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨éæ©éç²åº¦æ¶ï¼éè¦å¨éå¼éåå¹¶åç¨åº¦ä¹é´åä¸ä¸ªæè¡¡ã\n\nå¨ InnoDB ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼InnoDB å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# 3. è¯»åé\n\n * ç¬äº«éï¼Exclusiveï¼ï¼ç®åä¸º X éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼SELECT ... FOR UPDATE;\n * å±äº«éï¼Sharedï¼ï¼ç®åä¸º S éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼SELECT ... LOCK IN SHARE MODE;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\nInnoDB ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# 4. æåé\n\nå½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼Intention Locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ InnoDB èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\nå¨å­å¨è¡çº§éåè¡¨çº§éçæåµä¸ï¼äºå¡ T æ³è¦å¯¹è¡¨ A å  X éï¼å°±éè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ A æèè¡¨ A ä¸­çä»»æä¸è¡å äºéï¼é£ä¹å°±éè¦å¯¹è¡¨ A çæ¯ä¸è¡é½æ£æµä¸æ¬¡ï¼è¿æ¯éå¸¸èæ¶çã\n\næåéè§å®ï¼\n\n * IX/IS æ¯è¡¨éï¼\n * X/S æ¯è¡éã\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç S éä¹åï¼å¿é¡»åè·å¾è¡¨ç IS éæèæ´å¼ºçéï¼\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç X éä¹åï¼å¿é¡»åè·å¾è¡¨ç IX éã\n\néè¿å¼å¥æåéï¼äºå¡ T æ³è¦å¯¹è¡¨ A å  X éï¼åªéè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ A å äº X/IX/S/IS éï¼å¦æå äºå°±è¡¨ç¤ºæå¶å®äºå¡æ­£å¨ä½¿ç¨è¿ä¸ªè¡¨æèè¡¨ä¸­æä¸è¡çéï¼å æ­¤äºå¡ T å  X éå¤±è´¥ã\n\nåç§éçå¼å®¹å³ç³»å¦ä¸ï¼\n\n-    X   IX   S    IS\nX    â   â    â    â\nIX   â   âï¸   â    âï¸\nS    â   â    âï¸   âï¸\nIS   â   âï¸   âï¸   âï¸\n\nè§£éå¦ä¸ï¼\n\n * ä»»æ IS/IX éä¹é´é½æ¯å¼å®¹çï¼å ä¸ºå®ä»¬åªè¡¨ç¤ºæ³è¦å¯¹è¡¨å éï¼èä¸æ¯çæ­£å éï¼\n * è¿éå¼å®¹å³ç³»éå¯¹çæ¯è¡¨çº§éï¼èè¡¨çº§ç IX éåè¡çº§ç X éå¼å®¹ï¼ä¸¤ä¸ªäºå¡å¯ä»¥å¯¹ä¸¤ä¸ªæ°æ®è¡å  X éãï¼äºå¡ T1 æ³è¦å¯¹æ°æ®è¡ R1 å  X éï¼äºå¡ T2 æ³è¦å¯¹åä¸ä¸ªè¡¨çæ°æ®è¡ R2 å  X éï¼ä¸¤ä¸ªäºå¡é½éè¦å¯¹è¯¥è¡¨å  IX éï¼ä½æ¯ IX éæ¯å¼å®¹çï¼å¹¶ä¸ IX éä¸è¡çº§ç X éä¹æ¯å¼å®¹çï¼å æ­¤ä¸¤ä¸ªäºå¡é½è½å éæåï¼å¯¹åä¸ä¸ªè¡¨ä¸­çä¸¤ä¸ªæ°æ®è¡åä¿®æ¹ãï¼\n\n\n# 5. MVCC\n\nå¤çæ¬å¹¶åæ§å¶ï¼Multi-Version Concurrency Control, MVCCï¼å¯ä»¥è§ä¸ºè¡çº§éçä¸ä¸ªåç§ãå®å¨å¾å¤æåµä¸é½é¿åäºå éæä½ï¼å æ­¤å¼éæ´ä½ãä¸ä»æ¯ Mysqlï¼åæ¬ OracleãPostgreSQL ç­å¶ä»æ°æ®åºé½å®ç°äºåèªç MVCCï¼å®ç°æºå¶æ²¡æç»ä¸æ åã\n\nMVCC æ¯ InnoDB å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ MVCCãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ MVCC æ æ³å®ç°ã\n\n\n# 5.1. MVCC ææ³\n\nå éè½è§£å³å¤ä¸ªäºå¡åæ¶æ§è¡æ¶åºç°çå¹¶åä¸è´æ§é®é¢ãå¨å®éåºæ¯ä¸­è¯»æä½å¾å¾å¤äºåæä½ï¼å æ­¤åå¼å¥äºè¯»åéæ¥é¿åä¸å¿è¦çå éæä½ï¼ä¾å¦è¯»åè¯»æ²¡æäºæ¥å³ç³»ãè¯»åéä¸­è¯»ååæä½ä»ç¶æ¯äºæ¥çã\n\nMVCC çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ï¼åæä½ï¼DELETEãINSERTãUPDATEï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ãè¿ä¸ç¹å CopyOnWrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼MVCC è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# 5.2. çæ¬å·\n\nInnoDB ç MVCC å®ç°æ¯ï¼å¨æ¯è¡è®°å½åé¢ä¿å­ä¸¤ä¸ªéèåï¼ä¸ä¸ªåä¿å­è¡çåå»ºæ¶é´ï¼å¦ä¸ä¸ªåä¿å­è¡çè¿ææ¶é´ï¼è¿éçæ¶é´æ¯æç³»ç»çæ¬å·ï¼ãæ¯å¼å§ä¸ä¸ªæ°äºå¡ï¼ç³»ç»çæ¬å·ä¼èªå¨éå¢ï¼äºå¡å¼å§æ¶å»çç³»ç»çæ¬å·ä¼ä½ä¸ºäºå¡ççæ¬å·ï¼ç¨æ¥åæ¥è¯¢å°çæ¯è¡è®°å½ççæ¬å·è¿è¡æ¯è¾ã\n\n * ç³»ç»çæ¬å· SYS_IDï¼æ¯ä¸ä¸ªéå¢çæ°å­ï¼æ¯å¼å§ä¸ä¸ªæ°çäºå¡ï¼ç³»ç»çæ¬å·å°±ä¼èªå¨éå¢ã\n * äºå¡çæ¬å· TRX_ID ï¼äºå¡å¼å§æ¶çç³»ç»çæ¬å·ã\n\n\n# 5.3. Undo æ¥å¿\n\nMVCC çå¤çæ¬æçæ¯å¤ä¸ªçæ¬çå¿«ç§ï¼å¿«ç§å­å¨å¨ Undo æ¥å¿ä¸­ï¼è¯¥æ¥å¿éè¿åæ»æé ROLL_PTR æä¸ä¸ªæ°æ®è¡çææå¿«ç§è¿æ¥èµ·æ¥ã\n\nä¾å¦å¨ MySQL åå»ºä¸ä¸ªè¡¨ tï¼åå«ä¸»é® id åä¸ä¸ªå­æ®µ xãæä»¬åæå¥ä¸ä¸ªæ°æ®è¡ï¼ç¶åå¯¹è¯¥æ°æ®è¡æ§è¡ä¸¤æ¬¡æ´æ°æä½ã\n\nINSERT INTO t(id, x) VALUES(1, "a");\nUPDATE t SET x="b" WHERE id=1;\nUPDATE t SET x="c" WHERE id=1;\n\n\nå ä¸ºæ²¡æä½¿ç¨ START TRANSACTION å°ä¸é¢çæä½å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æ ¹æ® MySQL ç AUTOCOMMIT æºå¶ï¼æ¯ä¸ªæä½é½ä¼è¢«å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æä»¥ä¸é¢çæä½æ»å±æ¶åå°ä¸ä¸ªäºå¡ãå¿«ç§ä¸­é¤äºè®°å½äºå¡çæ¬å· TRX_ID åæä½ä¹å¤ï¼è¿è®°å½äºä¸ä¸ª bit ç DEL å­æ®µï¼ç¨äºæ è®°æ¯å¦è¢«å é¤ã\n\nINSERTãUPDATEãDELETE æä½ä¼åå»ºä¸ä¸ªæ¥å¿ï¼å¹¶å°äºå¡çæ¬å· TRX_ID åå¥ãDELETE å¯ä»¥çææ¯ä¸ä¸ªç¹æ®ç UPDATEï¼è¿ä¼é¢å¤å° DEL å­æ®µè®¾ç½®ä¸º 1ã\n\n\n# 5.4. ReadView\n\nMVCC ç»´æ¤äºä¸ä¸ªä¸è´æ§è¯»è§å¾ consistent read view ï¼ä¸»è¦åå«äºå½åç³»ç»æªæäº¤çäºå¡åè¡¨ TRX_IDs {TRX_ID_1, TRX_ID_2, ...}ï¼è¿æè¯¥åè¡¨çæå°å¼ TRX_ID_MIN å TRX_ID_MAXã\n\n\n\nè¿æ ·ï¼å¯¹äºå½åäºå¡çå¯å¨ç¬é´æ¥è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ç row trx_idï¼æä»¥ä¸å ç§å¯è½ï¼\n\n 1. å¦æè½å¨ç»¿è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²æäº¤çäºå¡æèæ¯å½åäºå¡èªå·±çæçï¼è¿ä¸ªæ°æ®æ¯å¯è§çï¼\n 2. å¦æè½å¨çº¢è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±å°æ¥å¯å¨çäºå¡çæçï¼æ¯è¯å®ä¸å¯è§çï¼\n 3. å¦æè½å¨é»è²é¨åï¼é£å°±åæ¬ä¸¤ç§æåµ a. è¥ row trx_id å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±è¿æ²¡æäº¤çäºå¡çæçï¼ä¸å¯è§ï¼ b. è¥ row trx_id ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²ç»æäº¤äºçäºå¡çæçï¼å¯è§ã\n\nå¨è¿è¡ SELECT æä½æ¶ï¼æ ¹æ®æ°æ®è¡å¿«ç§ç TRX_ID ä¸ TRX_ID_MIN å TRX_ID_MAX ä¹é´çå³ç³»ï¼ä»èå¤æ­æ°æ®è¡å¿«ç§æ¯å¦å¯ä»¥ä½¿ç¨ï¼\n\n * TRX_ID < TRX_ID_MINï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¶å¨å½åæææªæäº¤äºå¡ä¹åè¿è¡æ´æ¹çï¼å æ­¤å¯ä»¥ä½¿ç¨ã\n * TRX_ID > TRX_ID_MAXï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¯å¨äºå¡å¯å¨ä¹åè¢«æ´æ¹çï¼å æ­¤ä¸å¯ä½¿ç¨ã\n * TRX_ID_MIN <= TRX_ID <= TRX_ID_MAXï¼éè¦æ ¹æ®éç¦»çº§å«åè¿è¡å¤æ­ï¼\n   * æäº¤è¯»ï¼å¦æ TRX_ID å¨ TRX_IDs åè¡¨ä¸­ï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§å¯¹åºçäºå¡è¿æªæäº¤ï¼åè¯¥å¿«ç§ä¸å¯ä½¿ç¨ãå¦åè¡¨ç¤ºå·²ç»æäº¤ï¼å¯ä»¥ä½¿ç¨ã\n   * å¯éå¤è¯»ï¼é½ä¸å¯ä»¥ä½¿ç¨ãå ä¸ºå¦æå¯ä»¥ä½¿ç¨çè¯ï¼é£ä¹å¶å®äºå¡ä¹å¯ä»¥è¯»å°è¿ä¸ªæ°æ®è¡å¿«ç§å¹¶è¿è¡ä¿®æ¹ï¼é£ä¹å½åäºå¡åå»è¯»è¿ä¸ªæ°æ®è¡å¾å°çå¼å°±ä¼åçæ¹åï¼ä¹å°±æ¯åºç°äºä¸å¯éå¤è¯»é®é¢ã\n\nå¨æ°æ®è¡å¿«ç§ä¸å¯ä½¿ç¨çæåµä¸ï¼éè¦æ²¿ç Undo Log çåæ»æé ROLL_PTR æ¾å°ä¸ä¸ä¸ªå¿«ç§ï¼åè¿è¡ä¸é¢çå¤æ­ã\n\n\n# 5.5. å¿«ç§è¯»ä¸å½åè¯»\n\nå¿«ç§è¯»\n\nMVCC ç SELECT æä½æ¯å¿«ç§ä¸­çæ°æ®ï¼ä¸éè¦è¿è¡å éæä½ã\n\nSELECT * FROM table ...;\n\n\nå½åè¯»\n\nMVCC å¶å®ä¼å¯¹æ°æ®åºè¿è¡ä¿®æ¹çæä½ï¼INSERTãUPDATEãDELETEï¼éè¦è¿è¡å éæä½ï¼ä»èè¯»åææ°çæ°æ®ãå¯ä»¥çå° MVCC å¹¶ä¸æ¯å®å¨ä¸ç¨å éï¼èåªæ¯é¿åäº SELECT çå éæä½ã\n\nINSERT;\nUPDATE;\nDELETE;\n\n\nå¨è¿è¡ SELECT æä½æ¶ï¼å¯ä»¥å¼ºå¶æå®è¿è¡å éæä½ãä»¥ä¸ç¬¬ä¸ä¸ªè¯­å¥éè¦å  S éï¼ç¬¬äºä¸ªéè¦å  X éã\n\nSELECT * FROM table WHERE ? lock in share mode;\nSELECT * FROM table WHERE ? for update;\n\n\n\n# 6. è¡é\n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockã\n\n * Record Lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * Gap Lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ï¼SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;ãå¨ MySQL ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ MySQL ä¸­é»è®¤çæ¯ RR äºå¡éç¦»çº§å«ã\n * Next-key lock -å®æ¯ Record Lock å Gap Lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockãå¨ SelectãUpdate å Delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nMVCC ä¸è½è§£å³å¹»è¯»é®é¢ï¼Next-Key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼REPEATABLE READï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ MVCC + Next-Key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ SQL è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼MySQL å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼MySQL ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ UPDATEãDELETE æä½æ¶ï¼MySQL ä¸ä»éå® WHERE æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼InnoDB ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# 7. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * ãJava æ§è½è°ä¼å®æã\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢',normalizedContent:'# mysql é\n\n\n\n\n# 1. æ²è§éåä¹è§é\n\nç¡®ä¿å¨å¤ä¸ªäºå¡åæ¶å­åæ°æ®åºä¸­åä¸æ°æ®æ¶ä¸ç ´åäºå¡çéç¦»æ§åç»ä¸æ§ä»¥åæ°æ®åºçç»ä¸æ§ï¼ä¹è§éåæ²è§éæ¯å¹¶åæ§å¶ä¸»è¦éç¨çææ¯ææ®µã\n\n * æ²è§é - åå®ä¼åçå¹¶åå²çªï¼å±è½ä¸åå¯è½è¿åæ°æ®å®æ´æ§çæä½\n   * å¨æ¥è¯¢å®æ°æ®çæ¶åå°±æäºå¡éèµ·æ¥ï¼ç´å°æäº¤äºå¡ï¼commitï¼\n   * å®ç°æ¹å¼ï¼ä½¿ç¨æ°æ®åºä¸­çéæºå¶ã\n * ä¹è§é - åè®¾ä¸ä¼åçå¹¶åå²çªï¼åªå¨æäº¤æä½æ¶æ£æ¥æ¯å¦è¿åæ°æ®å®æ´æ§ã\n   * å¨ä¿®æ¹æ°æ®çæ¶åæäºå¡éèµ·æ¥ï¼éè¿ version çæ¹å¼æ¥è¿è¡éå®\n   * å®ç°æ¹å¼ï¼ä½¿ç¨ version çæ¬æèæ¶é´æ³ã\n\nãç¤ºä¾ãä¹è§éç¤ºä¾\n\nåå goods è¡¨ä¸­æä¸ä¸ªå­æ®µ statusï¼status ä¸º 1 ä»£è¡¨ååæªè¢«ä¸åï¼status ä¸º 2 ä»£è¡¨ååå·²ç»è¢«ä¸åï¼é£ä¹æä»¬å¯¹æä¸ªååä¸åæ¶å¿é¡»ç¡®ä¿è¯¥åå status ä¸º 1ãåè®¾ååç id ä¸º 1ã\n\nselect (status,status,version) from t_goods where id=#{id}\n\nupdate t_goods\nset status=2,version=version+1\nwhere id=#{id} and version=#{version};\n\n\n> æ´è¯¦ç»çä¹è§éè¯´å¯ä»¥åèï¼ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢\n\n\n# 2. è¡¨çº§éåè¡çº§é\n\nä»æ°æ®åºçéç²åº¦æ¥çï¼mysql ä¸­æä¾äºä¸¤ç§å°éç²åº¦ï¼è¡çº§éåè¡¨çº§éã\n\n * è¡¨çº§éï¼table lockï¼ - éå®æ´å¼ è¡¨ãç¨æ·å¯¹è¡¨è¿è¡åæä½åï¼éè¦åè·å¾åéï¼è¿ä¼é»å¡å¶ä»ç¨æ·å¯¹è¯¥è¡¨çææè¯»åæä½ãåªææ²¡æåéæ¶ï¼å¶ä»ç¨æ·æè½è·å¾è¯»éï¼è¯»éä¹é´ä¸ä¼ç¸äºé»å¡ã\n * è¡çº§éï¼row lockï¼ - éå®æå®çè¡è®°å½ãè¿æ ·å¶å®è¿ç¨è¿æ¯å¯ä»¥å¯¹åä¸ä¸ªè¡¨ä¸­çå¶å®è®°å½è¿è¡æä½ã\n\nåºè¯¥å°½éåªéå®éè¦ä¿®æ¹çé£é¨åæ°æ®ï¼èä¸æ¯ææçèµæºãéå®çæ°æ®éè¶å°ï¼éç«äºçåçé¢çå°±è¶å°ï¼ç³»ç»çå¹¶åç¨åº¦å°±è¶é«ãä½æ¯å ééè¦æ¶èèµæºï¼éçåç§æä½ï¼åæ¬è·åéãéæ¾éãä»¥åæ£æ¥éç¶æï¼é½ä¼å¢å ç³»ç»å¼éãå æ­¤éç²åº¦è¶å°ï¼ç³»ç»å¼éå°±è¶å¤§ã\n\nå¨éæ©éç²åº¦æ¶ï¼éè¦å¨éå¼éåå¹¶åç¨åº¦ä¹é´åä¸ä¸ªæè¡¡ã\n\nå¨ innodb ä¸­ï¼è¡éæ¯éè¿ç»ç´¢å¼ä¸çç´¢å¼é¡¹å éæ¥å®ç°çãå¦ææ²¡æç´¢å¼ï¼innodb å°ä¼éè¿éèçèç°ç´¢å¼æ¥å¯¹è®°å½å éã\n\n\n# 3. è¯»åé\n\n * ç¬äº«éï¼exclusiveï¼ï¼ç®åä¸º x éï¼åç§°åéãä½¿ç¨æ¹å¼ï¼select ... for update;\n * å±äº«éï¼sharedï¼ï¼ç®åä¸º s éï¼åç§°è¯»éãä½¿ç¨æ¹å¼ï¼select ... lock in share mode;\n\nåéåè¯»éçå³ç³»ï¼ç®è¨ä¹ï¼ç¬äº«éå­å¨ï¼å¶ä»äºå¡å°±ä¸è½åä»»ä½æä½ã\n\ninnodb ä¸çè¡éãé´ééãnext-key éç»ç»å±äºç¬äº«éã\n\n\n# 4. æåé\n\nå½å­å¨è¡¨çº§éåè¡çº§éçæåµä¸ï¼å¿é¡»åç³è¯·æåéï¼è¡¨çº§éï¼ä½ä¸æ¯ççå éï¼ï¼åè·åè¡çº§éãä½¿ç¨æåéï¼intention locksï¼å¯ä»¥æ´å®¹æå°æ¯æå¤ç²åº¦å°éã\n\næåéæ¯ innodb èªå¨å çï¼ä¸éè¦ç¨æ·å¹²é¢ã\n\nå¨å­å¨è¡çº§éåè¡¨çº§éçæåµä¸ï¼äºå¡ t æ³è¦å¯¹è¡¨ a å  x éï¼å°±éè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ a æèè¡¨ a ä¸­çä»»æä¸è¡å äºéï¼é£ä¹å°±éè¦å¯¹è¡¨ a çæ¯ä¸è¡é½æ£æµä¸æ¬¡ï¼è¿æ¯éå¸¸èæ¶çã\n\næåéè§å®ï¼\n\n * ix/is æ¯è¡¨éï¼\n * x/s æ¯è¡éã\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç s éä¹åï¼å¿é¡»åè·å¾è¡¨ç is éæèæ´å¼ºçéï¼\n * ä¸ä¸ªäºå¡å¨è·å¾æä¸ªæ°æ®è¡ç x éä¹åï¼å¿é¡»åè·å¾è¡¨ç ix éã\n\néè¿å¼å¥æåéï¼äºå¡ t æ³è¦å¯¹è¡¨ a å  x éï¼åªéè¦åæ£æµæ¯å¦æå¶å®äºå¡å¯¹è¡¨ a å äº x/ix/s/is éï¼å¦æå äºå°±è¡¨ç¤ºæå¶å®äºå¡æ­£å¨ä½¿ç¨è¿ä¸ªè¡¨æèè¡¨ä¸­æä¸è¡çéï¼å æ­¤äºå¡ t å  x éå¤±è´¥ã\n\nåç§éçå¼å®¹å³ç³»å¦ä¸ï¼\n\n-    x   ix   s    is\nx    â   â    â    â\nix   â   âï¸   â    âï¸\ns    â   â    âï¸   âï¸\nis   â   âï¸   âï¸   âï¸\n\nè§£éå¦ä¸ï¼\n\n * ä»»æ is/ix éä¹é´é½æ¯å¼å®¹çï¼å ä¸ºå®ä»¬åªè¡¨ç¤ºæ³è¦å¯¹è¡¨å éï¼èä¸æ¯çæ­£å éï¼\n * è¿éå¼å®¹å³ç³»éå¯¹çæ¯è¡¨çº§éï¼èè¡¨çº§ç ix éåè¡çº§ç x éå¼å®¹ï¼ä¸¤ä¸ªäºå¡å¯ä»¥å¯¹ä¸¤ä¸ªæ°æ®è¡å  x éãï¼äºå¡ t1 æ³è¦å¯¹æ°æ®è¡ r1 å  x éï¼äºå¡ t2 æ³è¦å¯¹åä¸ä¸ªè¡¨çæ°æ®è¡ r2 å  x éï¼ä¸¤ä¸ªäºå¡é½éè¦å¯¹è¯¥è¡¨å  ix éï¼ä½æ¯ ix éæ¯å¼å®¹çï¼å¹¶ä¸ ix éä¸è¡çº§ç x éä¹æ¯å¼å®¹çï¼å æ­¤ä¸¤ä¸ªäºå¡é½è½å éæåï¼å¯¹åä¸ä¸ªè¡¨ä¸­çä¸¤ä¸ªæ°æ®è¡åä¿®æ¹ãï¼\n\n\n# 5. mvcc\n\nå¤çæ¬å¹¶åæ§å¶ï¼multi-version concurrency control, mvccï¼å¯ä»¥è§ä¸ºè¡çº§éçä¸ä¸ªåç§ãå®å¨å¾å¤æåµä¸é½é¿åäºå éæä½ï¼å æ­¤å¼éæ´ä½ãä¸ä»æ¯ mysqlï¼åæ¬ oracleãpostgresql ç­å¶ä»æ°æ®åºé½å®ç°äºåèªç mvccï¼å®ç°æºå¶æ²¡æç»ä¸æ åã\n\nmvcc æ¯ innodb å­å¨å¼æå®ç°éç¦»çº§å«çä¸ç§å·ä½æ¹å¼ï¼ç¨äºå®ç°æäº¤è¯»åå¯éå¤è¯»è¿ä¸¤ç§éç¦»çº§å«ãèæªæäº¤è¯»éç¦»çº§å«æ»æ¯è¯»åææ°çæ°æ®è¡ï¼è¦æ±å¾ä½ï¼æ éä½¿ç¨ mvccãå¯ä¸²è¡åéç¦»çº§å«éè¦å¯¹ææè¯»åçè¡é½å éï¼åçº¯ä½¿ç¨ mvcc æ æ³å®ç°ã\n\n\n# 5.1. mvcc ææ³\n\nå éè½è§£å³å¤ä¸ªäºå¡åæ¶æ§è¡æ¶åºç°çå¹¶åä¸è´æ§é®é¢ãå¨å®éåºæ¯ä¸­è¯»æä½å¾å¾å¤äºåæä½ï¼å æ­¤åå¼å¥äºè¯»åéæ¥é¿åä¸å¿è¦çå éæä½ï¼ä¾å¦è¯»åè¯»æ²¡æäºæ¥å³ç³»ãè¯»åéä¸­è¯»ååæä½ä»ç¶æ¯äºæ¥çã\n\nmvcc çææ³æ¯ï¼\n\n * ä¿å­æ°æ®å¨æä¸ªæ¶é´ç¹çå¿«ç§ï¼åæä½ï¼deleteãinsertãupdateï¼æ´æ°ææ°ççæ¬å¿«ç§ï¼èè¯»æä½å»è¯»æ§çæ¬å¿«ç§ï¼æ²¡æäºæ¥å³ç³»ãè¿ä¸ç¹å copyonwrite ç±»ä¼¼ã\n * èè¯»åä¸å¯éå¤è¯»ææ ¹æ¬çåå æ¯äºå¡è¯»åå°å¶å®äºå¡æªæäº¤çä¿®æ¹ãå¨äºå¡è¿è¡è¯»åæä½æ¶ï¼ä¸ºäºè§£å³èè¯»åä¸å¯éå¤è¯»é®é¢ï¼mvcc è§å®åªè½è¯»åå·²ç»æäº¤çå¿«ç§ãå½ç¶ä¸ä¸ªäºå¡å¯ä»¥è¯»åèªèº«æªæäº¤çå¿«ç§ï¼è¿ä¸ç®æ¯èè¯»ã\n\n\n# 5.2. çæ¬å·\n\ninnodb ç mvcc å®ç°æ¯ï¼å¨æ¯è¡è®°å½åé¢ä¿å­ä¸¤ä¸ªéèåï¼ä¸ä¸ªåä¿å­è¡çåå»ºæ¶é´ï¼å¦ä¸ä¸ªåä¿å­è¡çè¿ææ¶é´ï¼è¿éçæ¶é´æ¯æç³»ç»çæ¬å·ï¼ãæ¯å¼å§ä¸ä¸ªæ°äºå¡ï¼ç³»ç»çæ¬å·ä¼èªå¨éå¢ï¼äºå¡å¼å§æ¶å»çç³»ç»çæ¬å·ä¼ä½ä¸ºäºå¡ççæ¬å·ï¼ç¨æ¥åæ¥è¯¢å°çæ¯è¡è®°å½ççæ¬å·è¿è¡æ¯è¾ã\n\n * ç³»ç»çæ¬å· sys_idï¼æ¯ä¸ä¸ªéå¢çæ°å­ï¼æ¯å¼å§ä¸ä¸ªæ°çäºå¡ï¼ç³»ç»çæ¬å·å°±ä¼èªå¨éå¢ã\n * äºå¡çæ¬å· trx_id ï¼äºå¡å¼å§æ¶çç³»ç»çæ¬å·ã\n\n\n# 5.3. undo æ¥å¿\n\nmvcc çå¤çæ¬æçæ¯å¤ä¸ªçæ¬çå¿«ç§ï¼å¿«ç§å­å¨å¨ undo æ¥å¿ä¸­ï¼è¯¥æ¥å¿éè¿åæ»æé roll_ptr æä¸ä¸ªæ°æ®è¡çææå¿«ç§è¿æ¥èµ·æ¥ã\n\nä¾å¦å¨ mysql åå»ºä¸ä¸ªè¡¨ tï¼åå«ä¸»é® id åä¸ä¸ªå­æ®µ xãæä»¬åæå¥ä¸ä¸ªæ°æ®è¡ï¼ç¶åå¯¹è¯¥æ°æ®è¡æ§è¡ä¸¤æ¬¡æ´æ°æä½ã\n\ninsert into t(id, x) values(1, "a");\nupdate t set x="b" where id=1;\nupdate t set x="c" where id=1;\n\n\nå ä¸ºæ²¡æä½¿ç¨ start transaction å°ä¸é¢çæä½å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æ ¹æ® mysql ç autocommit æºå¶ï¼æ¯ä¸ªæä½é½ä¼è¢«å½æä¸ä¸ªäºå¡æ¥æ§è¡ï¼æä»¥ä¸é¢çæä½æ»å±æ¶åå°ä¸ä¸ªäºå¡ãå¿«ç§ä¸­é¤äºè®°å½äºå¡çæ¬å· trx_id åæä½ä¹å¤ï¼è¿è®°å½äºä¸ä¸ª bit ç del å­æ®µï¼ç¨äºæ è®°æ¯å¦è¢«å é¤ã\n\ninsertãupdateãdelete æä½ä¼åå»ºä¸ä¸ªæ¥å¿ï¼å¹¶å°äºå¡çæ¬å· trx_id åå¥ãdelete å¯ä»¥çææ¯ä¸ä¸ªç¹æ®ç updateï¼è¿ä¼é¢å¤å° del å­æ®µè®¾ç½®ä¸º 1ã\n\n\n# 5.4. readview\n\nmvcc ç»´æ¤äºä¸ä¸ªä¸è´æ§è¯»è§å¾ consistent read view ï¼ä¸»è¦åå«äºå½åç³»ç»æªæäº¤çäºå¡åè¡¨ trx_ids {trx_id_1, trx_id_2, ...}ï¼è¿æè¯¥åè¡¨çæå°å¼ trx_id_min å trx_id_maxã\n\n\n\nè¿æ ·ï¼å¯¹äºå½åäºå¡çå¯å¨ç¬é´æ¥è¯´ï¼ä¸ä¸ªæ°æ®çæ¬ç row trx_idï¼æä»¥ä¸å ç§å¯è½ï¼\n\n 1. å¦æè½å¨ç»¿è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²æäº¤çäºå¡æèæ¯å½åäºå¡èªå·±çæçï¼è¿ä¸ªæ°æ®æ¯å¯è§çï¼\n 2. å¦æè½å¨çº¢è²é¨åï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±å°æ¥å¯å¨çäºå¡çæçï¼æ¯è¯å®ä¸å¯è§çï¼\n 3. å¦æè½å¨é»è²é¨åï¼é£å°±åæ¬ä¸¤ç§æåµ a. è¥ row trx_id å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯ç±è¿æ²¡æäº¤çäºå¡çæçï¼ä¸å¯è§ï¼ b. è¥ row trx_id ä¸å¨æ°ç»ä¸­ï¼è¡¨ç¤ºè¿ä¸ªçæ¬æ¯å·²ç»æäº¤äºçäºå¡çæçï¼å¯è§ã\n\nå¨è¿è¡ select æä½æ¶ï¼æ ¹æ®æ°æ®è¡å¿«ç§ç trx_id ä¸ trx_id_min å trx_id_max ä¹é´çå³ç³»ï¼ä»èå¤æ­æ°æ®è¡å¿«ç§æ¯å¦å¯ä»¥ä½¿ç¨ï¼\n\n * trx_id < trx_id_minï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¶å¨å½åæææªæäº¤äºå¡ä¹åè¿è¡æ´æ¹çï¼å æ­¤å¯ä»¥ä½¿ç¨ã\n * trx_id > trx_id_maxï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§æ¯å¨äºå¡å¯å¨ä¹åè¢«æ´æ¹çï¼å æ­¤ä¸å¯ä½¿ç¨ã\n * trx_id_min <= trx_id <= trx_id_maxï¼éè¦æ ¹æ®éç¦»çº§å«åè¿è¡å¤æ­ï¼\n   * æäº¤è¯»ï¼å¦æ trx_id å¨ trx_ids åè¡¨ä¸­ï¼è¡¨ç¤ºè¯¥æ°æ®è¡å¿«ç§å¯¹åºçäºå¡è¿æªæäº¤ï¼åè¯¥å¿«ç§ä¸å¯ä½¿ç¨ãå¦åè¡¨ç¤ºå·²ç»æäº¤ï¼å¯ä»¥ä½¿ç¨ã\n   * å¯éå¤è¯»ï¼é½ä¸å¯ä»¥ä½¿ç¨ãå ä¸ºå¦æå¯ä»¥ä½¿ç¨çè¯ï¼é£ä¹å¶å®äºå¡ä¹å¯ä»¥è¯»å°è¿ä¸ªæ°æ®è¡å¿«ç§å¹¶è¿è¡ä¿®æ¹ï¼é£ä¹å½åäºå¡åå»è¯»è¿ä¸ªæ°æ®è¡å¾å°çå¼å°±ä¼åçæ¹åï¼ä¹å°±æ¯åºç°äºä¸å¯éå¤è¯»é®é¢ã\n\nå¨æ°æ®è¡å¿«ç§ä¸å¯ä½¿ç¨çæåµä¸ï¼éè¦æ²¿ç undo log çåæ»æé roll_ptr æ¾å°ä¸ä¸ä¸ªå¿«ç§ï¼åè¿è¡ä¸é¢çå¤æ­ã\n\n\n# 5.5. å¿«ç§è¯»ä¸å½åè¯»\n\nå¿«ç§è¯»\n\nmvcc ç select æä½æ¯å¿«ç§ä¸­çæ°æ®ï¼ä¸éè¦è¿è¡å éæä½ã\n\nselect * from table ...;\n\n\nå½åè¯»\n\nmvcc å¶å®ä¼å¯¹æ°æ®åºè¿è¡ä¿®æ¹çæä½ï¼insertãupdateãdeleteï¼éè¦è¿è¡å éæä½ï¼ä»èè¯»åææ°çæ°æ®ãå¯ä»¥çå° mvcc å¹¶ä¸æ¯å®å¨ä¸ç¨å éï¼èåªæ¯é¿åäº select çå éæä½ã\n\ninsert;\nupdate;\ndelete;\n\n\nå¨è¿è¡ select æä½æ¶ï¼å¯ä»¥å¼ºå¶æå®è¿è¡å éæä½ãä»¥ä¸ç¬¬ä¸ä¸ªè¯­å¥éè¦å  s éï¼ç¬¬äºä¸ªéè¦å  x éã\n\nselect * from table where ? lock in share mode;\nselect * from table where ? for update;\n\n\n\n# 6. è¡é\n\nè¡éçå·ä½å®ç°ç®æ³æä¸ç§ï¼record lockãgap lock ä»¥å next-key lockã\n\n * record lock - è¡éå¯¹ç´¢å¼é¡¹å éï¼è¥æ²¡æç´¢å¼åä½¿ç¨è¡¨éã\n * gap lock - å¯¹ç´¢å¼é¡¹ä¹é´çé´éå éãéå®ç´¢å¼ä¹é´çé´éï¼ä½æ¯ä¸åå«ç´¢å¼æ¬èº«ãä¾å¦å½ä¸ä¸ªäºå¡æ§è¡ä»¥ä¸è¯­å¥ï¼å¶å®äºå¡å°±ä¸è½å¨ t.c ä¸­æå¥ 15ï¼select c from t where c between 10 and 20 for update;ãå¨ mysql ä¸­ï¼gap lock é»è®¤æ¯å¼å¯çï¼å³ innodb_locks_unsafe_for_binlog åæ°å¼æ¯ disable çï¼ä¸ mysql ä¸­é»è®¤çæ¯ rr äºå¡éç¦»çº§å«ã\n * next-key lock -å®æ¯ record lock å gap lock çç»åï¼ä¸ä»éå®ä¸ä¸ªè®°å½ä¸çç´¢å¼ï¼ä¹éå®ç´¢å¼ä¹é´çé´éãå®éå®ä¸ä¸ªåå¼åé­åºé´ã\n\nåªå¨å¯éå¤è¯»æä»¥ä¸éç¦»çº§å«ä¸çç¹å®æä½æä¼åå¾ gap lock æ next-key lockãå¨ selectãupdate å delete æ¶ï¼é¤äºåºäºå¯ä¸ç´¢å¼çæ¥è¯¢ä¹å¤ï¼å¶å®ç´¢å¼æ¥è¯¢æ¶é½ä¼è·å gap lock æ next-key lockï¼å³éä½å¶æ«æçèå´ãä¸»é®ç´¢å¼ä¹å±äºå¯ä¸ç´¢å¼ï¼æä»¥ä¸»é®ç´¢å¼æ¯ä¸ä¼ä½¿ç¨ gap lock æ next-key lockã\n\nmvcc ä¸è½è§£å³å¹»è¯»é®é¢ï¼next-key éå°±æ¯ä¸ºäºè§£å³å¹»è¯»é®é¢ãå¨å¯éå¤è¯»ï¼repeatable readï¼éç¦»çº§å«ä¸ï¼ä½¿ç¨ mvcc + next-key é å¯ä»¥è§£å³å¹»è¯»é®é¢ã\n\nç´¢å¼åä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ä¸¤ç§ï¼å¦æä¸æ¡ sql è¯­å¥æä½äºä¸»é®ç´¢å¼ï¼mysql å°±ä¼éå®è¿æ¡ä¸»é®ç´¢å¼ï¼å¦æä¸æ¡è¯­å¥æä½äºéä¸»é®ç´¢å¼ï¼mysql ä¼åéå®è¯¥éä¸»é®ç´¢å¼ï¼åéå®ç¸å³çä¸»é®ç´¢å¼ãå¨ updateãdelete æä½æ¶ï¼mysql ä¸ä»éå® where æ¡ä»¶æ«æè¿çææç´¢å¼è®°å½ï¼èä¸ä¼éå®ç¸é»çé®å¼ï¼å³æè°ç next-key lockã\n\nå½ä¸¤ä¸ªäºå¡åæ¶æ§è¡ï¼ä¸ä¸ªéä½äºä¸»é®ç´¢å¼ï¼å¨ç­å¾å¶ä»ç¸å³ç´¢å¼ãå¦ä¸ä¸ªéå®äºéä¸»é®ç´¢å¼ï¼å¨ç­å¾ä¸»é®ç´¢å¼ãè¿æ ·å°±ä¼åçæ­»éãåçæ­»éåï¼innodb ä¸è¬é½å¯ä»¥æ£æµå°ï¼å¹¶ä½¿ä¸ä¸ªäºå¡éæ¾éåéï¼å¦ä¸ä¸ªè·åéå®æäºå¡ã\n\n\n# 7. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * ãjava æ§è½è°ä¼å®æã\n * æ°æ®åºç³»ç»åç\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * ä½¿ç¨ mysql ä¹è§éè§£å³å¹¶åé®é¢',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql ç´¢å¼",frontmatter:{title:"Mysql ç´¢å¼",date:"2020-07-16T11:14:07.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","ç´¢å¼"],permalink:"/pages/516ac6/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/05.Mysql%E7%B4%A2%E5%BC%95.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/05.Mysqlç´¢å¼.md",key:"v-6b994900",path:"/pages/516ac6/",headers:[{level:2,title:"1. ç´¢å¼ç®ä»",slug:"_1-ç´¢å¼ç®ä»",normalizedTitle:"1. ç´¢å¼ç®ä»",charIndex:261},{level:3,title:"1.1. ç´¢å¼çä¼ç¼ºç¹",slug:"_1-1-ç´¢å¼çä¼ç¼ºç¹",normalizedTitle:"1.1. ç´¢å¼çä¼ç¼ºç¹",charIndex:388},{level:3,title:"1.2. ä½æ¶ä½¿ç¨ç´¢å¼",slug:"_1-2-ä½æ¶ä½¿ç¨ç´¢å¼",normalizedTitle:"1.2. ä½æ¶ä½¿ç¨ç´¢å¼",charIndex:903},{level:2,title:"2. ç´¢å¼çæ°æ®ç»æ",slug:"_2-ç´¢å¼çæ°æ®ç»æ",normalizedTitle:"2. ç´¢å¼çæ°æ®ç»æ",charIndex:1219},{level:3,title:"æ°ç»",slug:"æ°ç»",normalizedTitle:"æ°ç»",charIndex:1299},{level:3,title:"2.1. åå¸ç´¢å¼",slug:"_2-1-åå¸ç´¢å¼",normalizedTitle:"2.1. åå¸ç´¢å¼",charIndex:1491},{level:3,title:"2.2. B æ ç´¢å¼",slug:"_2-2-b-æ ç´¢å¼",normalizedTitle:"2.2. b æ ç´¢å¼",charIndex:2376},{level:4,title:"äºåæç´¢æ ",slug:"äºåæç´¢æ ",normalizedTitle:"äºåæç´¢æ ",charIndex:2657},{level:4,title:"B+ æ ",slug:"b-æ ",normalizedTitle:"b+ æ ",charIndex:3057},{level:3,title:"2.3. å¨æç´¢å¼",slug:"_2-3-å¨æç´¢å¼",normalizedTitle:"2.3. å¨æç´¢å¼",charIndex:4137},{level:3,title:"2.4. ç©ºé´æ°æ®ç´¢å¼",slug:"_2-4-ç©ºé´æ°æ®ç´¢å¼",normalizedTitle:"2.4. ç©ºé´æ°æ®ç´¢å¼",charIndex:4303},{level:2,title:"3. ç´¢å¼çç±»å",slug:"_3-ç´¢å¼çç±»å",normalizedTitle:"3. ç´¢å¼çç±»å",charIndex:4419},{level:3,title:"3.1. ä¸»é®ç´¢å¼ï¼PRIMARYï¼",slug:"_3-1-ä¸»é®ç´¢å¼-primary",normalizedTitle:"3.1. ä¸»é®ç´¢å¼ï¼primaryï¼",charIndex:4455},{level:3,title:"3.2. å¯ä¸ç´¢å¼ï¼UNIQUEï¼",slug:"_3-2-å¯ä¸ç´¢å¼-unique",normalizedTitle:"3.2. å¯ä¸ç´¢å¼ï¼uniqueï¼",charIndex:4651},{level:3,title:"3.3. æ®éç´¢å¼ï¼INDEXï¼",slug:"_3-3-æ®éç´¢å¼-index",normalizedTitle:"3.3. æ®éç´¢å¼ï¼indexï¼",charIndex:4788},{level:3,title:"3.4. å¨æç´¢å¼ï¼FULLTEXTï¼",slug:"_3-4-å¨æç´¢å¼-fulltext",normalizedTitle:"3.4. å¨æç´¢å¼ï¼fulltextï¼",charIndex:4902},{level:3,title:"3.5. èåç´¢å¼",slug:"_3-5-èåç´¢å¼",normalizedTitle:"3.5. èåç´¢å¼",charIndex:5321},{level:2,title:"4. ç´¢å¼çç­ç¥",slug:"_4-ç´¢å¼çç­ç¥",normalizedTitle:"4. ç´¢å¼çç­ç¥",charIndex:5492},{level:3,title:"4.1. ç´¢å¼åºæ¬åå",slug:"_4-1-ç´¢å¼åºæ¬åå",normalizedTitle:"4.1. ç´¢å¼åºæ¬åå",charIndex:5745},{level:3,title:"4.2. ç¬ç«çå",slug:"_4-2-ç¬ç«çå",normalizedTitle:"4.2. ç¬ç«çå",charIndex:5962},{level:3,title:"4.3. è¦çç´¢å¼",slug:"_4-3-è¦çç´¢å¼",normalizedTitle:"4.3. è¦çç´¢å¼",charIndex:6209},{level:3,title:"4.4. ä½¿ç¨ç´¢å¼æ¥æåº",slug:"_4-4-ä½¿ç¨ç´¢å¼æ¥æåº",normalizedTitle:"4.4. ä½¿ç¨ç´¢å¼æ¥æåº",charIndex:6982},{level:3,title:"4.5. åç¼ç´¢å¼",slug:"_4-5-åç¼ç´¢å¼",normalizedTitle:"4.5. åç¼ç´¢å¼",charIndex:7314},{level:3,title:"4.6. æå·¦åç¼å¹éåå",slug:"_4-6-æå·¦åç¼å¹éåå",normalizedTitle:"4.6. æå·¦åç¼å¹éåå",charIndex:8090},{level:3,title:"4.7. = å in å¯ä»¥ä¹±åº",slug:"_4-7-å-in-å¯ä»¥ä¹±åº",normalizedTitle:"4.7. = å in å¯ä»¥ä¹±åº",charIndex:9017},{level:2,title:"5. ç´¢å¼æä½³å®è·µ",slug:"_5-ç´¢å¼æä½³å®è·µ",normalizedTitle:"5. ç´¢å¼æä½³å®è·µ",charIndex:9261},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:9553}],headersStr:"1. ç´¢å¼ç®ä» 1.1. ç´¢å¼çä¼ç¼ºç¹ 1.2. ä½æ¶ä½¿ç¨ç´¢å¼ 2. ç´¢å¼çæ°æ®ç»æ æ°ç» 2.1. åå¸ç´¢å¼ 2.2. B æ ç´¢å¼ äºåæç´¢æ  B+ æ  2.3. å¨æç´¢å¼ 2.4. ç©ºé´æ°æ®ç´¢å¼ 3. ç´¢å¼çç±»å 3.1. ä¸»é®ç´¢å¼ï¼PRIMARYï¼ 3.2. å¯ä¸ç´¢å¼ï¼UNIQUEï¼ 3.3. æ®éç´¢å¼ï¼INDEXï¼ 3.4. å¨æç´¢å¼ï¼FULLTEXTï¼ 3.5. èåç´¢å¼ 4. ç´¢å¼çç­ç¥ 4.1. ç´¢å¼åºæ¬åå 4.2. ç¬ç«çå 4.3. è¦çç´¢å¼ 4.4. ä½¿ç¨ç´¢å¼æ¥æåº 4.5. åç¼ç´¢å¼ 4.6. æå·¦åç¼å¹éåå 4.7. = å in å¯ä»¥ä¹±åº 5. ç´¢å¼æä½³å®è·µ 6. åèèµæ",content:"# Mysql ç´¢å¼\n\n> ç´¢å¼æ¯æé« MySQL æ¥è¯¢æ§è½çä¸ä¸ªéè¦éå¾ï¼ä½è¿å¤çç´¢å¼å¯è½ä¼å¯¼è´è¿é«çç£çä½¿ç¨çä»¥åè¿é«çåå­å ç¨ï¼ä»èå½±ååºç¨ç¨åºçæ´ä½æ§è½ãåºå½å°½éé¿åäºåææ³èµ·æ·»å ç´¢å¼ï¼å ä¸ºäºåå¯è½éè¦çæ§å¤§éç SQL æè½å®ä½å°é®é¢æå¨ï¼èä¸æ·»å ç´¢å¼çæ¶é´è¯å®æ¯è¿å¤§äºåå§æ·»å ç´¢å¼æéè¦çæ¶é´ï¼å¯è§ç´¢å¼çæ·»å ä¹æ¯éå¸¸æææ¯å«éçã\n> \n> æ¥ä¸æ¥å°åä½ å±ç¤ºä¸ç³»ååå»ºé«æ§è½ç´¢å¼çç­ç¥ï¼ä»¥åæ¯æ¡ç­ç¥å¶èåçå·¥ä½åçãä½å¨æ­¤ä¹åï¼åäºè§£ä¸ç´¢å¼ç¸å³çä¸äºç®æ³åæ°æ®ç»æï¼å°æå©äºæ´å¥½ççè§£åæçåå®¹ã\n\n\n\n\n# 1. ç´¢å¼ç®ä»\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æã\n\nç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\n\n# 1.1. ç´¢å¼çä¼ç¼ºç¹\n\nB æ æ¯æå¸¸è§çç´¢å¼ï¼æç§é¡ºåºå­å¨æ°æ®ï¼æä»¥ Mysql å¯ä»¥ç¨æ¥å ORDER BY å GROUP BY æä½ãå ä¸ºæ°æ®æ¯æåºçï¼æä»¥ B æ ä¹å°±ä¼å°ç¸å³çåå¼é½å­å¨å¨ä¸èµ·ãæåï¼å ä¸ºç´¢å¼ä¸­å­å¨äºå®éçåå¼ï¼æä»¥æäºæ¥è¯¢åªä½¿ç¨ç´¢å¼å°±è½å¤å®æå¨é¨æ¥è¯¢ã\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº I/O åä¸ºé¡ºåº I/Oã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ InnoDB ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼INSERT/UPDATE/DELETEï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# 1.2. ä½æ¶ä½¿ç¨ç´¢å¼\n\n> ç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * é¢ç¹è¯»æä½ï¼ SELECT ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ã\n * ååç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­ã\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ INSERT/UPDATE/DELETE ï¼ï¼ä¹å°±æå³çéè¦æ´æ°ç´¢å¼ã\n * ååä¸ç»å¸¸åºç°å¨ WHERE æè¿æ¥ï¼JOINï¼æ¡ä»¶ä¸­ï¼ä¹å°±æå³çç´¢å¼ä¼ç»å¸¸æ æ³å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * éå¸¸å°çè¡¨ï¼å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ç¹å¤§åçè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ Nosqlã\n\n\n# 2. ç´¢å¼çæ°æ®ç»æ\n\nå¨ Mysql ä¸­ï¼ç´¢å¼æ¯å¨å­å¨å¼æå±èä¸æ¯æå¡å¨å±å®ç°çãæä»¥ï¼å¹¶æ²¡æç»ä¸çç´¢å¼æ åï¼ä¸åå­å¨å¼æçç´¢å¼çæ°æ®ç»æä¹ä¸ç¸åã\n\n\n# æ°ç»\n\næ°ç»æ¯ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶ä¸æ¯æéæºè®¿é®ã\n\næåºæ°ç»å¯ä»¥ä½¿ç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º O(log n)ï¼æ è®ºæ¯ç­å¼æ¥è¯¢è¿æ¯èå´æ¥è¯¢ï¼é½éå¸¸é«æã\n\nä½æ°ç»æä¸¤ä¸ªéè¦éå¶ï¼\n\n * æ°ç»çç©ºé´å¤§å°åºå®ï¼å¦æè¦æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ã\n * æå¥ãå é¤æ¶é´å¤æåº¦ä¸º O(n)ã\n\nè¿æå³çï¼å¦æä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼å¦æè¦ä¿è¯æ°ç»æåºï¼å¶æ´æ°æä½ä»£ä»·é«æã\n\n\n# 2.1. åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ Valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ Hash å½æ°å° Key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ O(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nå¨ Mysql ä¸­ï¼åªæ Memory å­å¨å¼ææ¾ç¤ºæ¯æåå¸ç´¢å¼ã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (A,B) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å Aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãIN()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ WHERE price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èã\n\n\n# 2.2. B æ ç´¢å¼\n\néå¸¸æä»¬æè¯´çç´¢å¼æ¯æB-Treeç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨B-Treeè¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º MySQL å¨CREATE TABLEæå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ InnoDB å°±æ¯ä½¿ç¨çB+Treeã\n\nB+Treeä¸­ç B æ¯æbalanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼B+æ ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ $$O(log(N))$$ã\n\nå½ç¶ä¸ºäºç»´æ $$O(log(N))$$ çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ $$O(log(N))$$ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç I/O æ¶èï¼ç¸å¯¹äºåå­å­åï¼I/O å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç I/O è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç I/O å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º N åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è B+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n# B+ æ \n\nB+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£B+Treeæ¶ï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçB+Treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãInnoDB çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº B æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ InnoDB éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from T where ID=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ ID è¿æ£µ B+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from T where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° ID çå¼ä¸º 500ï¼åå° ID ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ NOT NULL PRIMARY KEY AUTO_INCREMENTãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ã\n\nè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n\n# 2.3. å¨æç´¢å¼\n\nMyISAM å­å¨å¼ææ¯æå¨æç´¢å¼ï¼ç¨äºæ¥æ¾ææ¬ä¸­çå³é®è¯ï¼èä¸æ¯ç´æ¥æ¯è¾æ¯å¦ç¸ç­ãæ¥æ¾æ¡ä»¶ä½¿ç¨ MATCH AGAINSTï¼èä¸æ¯æ®éç WHEREã\n\nå¨æç´¢å¼ä¸è¬ä½¿ç¨åæç´¢å¼å®ç°ï¼å®è®°å½çå³é®è¯å°å¶æå¨ææ¡£çæ å°ã\n\nInnoDB å­å¨å¼æå¨ MySQL 5.6.4 çæ¬ä¸­ä¹å¼å§æ¯æå¨æç´¢å¼ã\n\n\n# 2.4. ç©ºé´æ°æ®ç´¢å¼\n\nMyISAM å­å¨å¼ææ¯æç©ºé´æ°æ®ç´¢å¼ï¼R-Treeï¼ï¼å¯ä»¥ç¨äºå°çæ°æ®å­å¨ãç©ºé´æ°æ®ç´¢å¼ä¼ä»ææç»´åº¦æ¥ç´¢å¼æ°æ®ï¼å¯ä»¥ææå°ä½¿ç¨ä»»æç»´åº¦æ¥è¿è¡ç»åæ¥è¯¢ã\n\nå¿é¡»ä½¿ç¨ GIS ç¸å³çå½æ°æ¥ç»´æ¤æ°æ®ã\n\n\n# 3. ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\n\n# 3.1. ä¸»é®ç´¢å¼ï¼PRIMARYï¼\n\nä¸»é®ç´¢å¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸åè®¸æç©ºå¼ãä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼å¨ InnoDB ä¸­æ¬è´¨ä¸å³èç°ç´¢å¼ï¼ï¼ä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n\nCREATE TABLE `table` (\n    `id` int(11) NOT NULL AUTO_INCREMENT,\n    ...\n    PRIMARY KEY (`id`)\n)\n\n\n\n# 3.2. å¯ä¸ç´¢å¼ï¼UNIQUEï¼\n\nå¯ä¸ç´¢å¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n\nCREATE TABLE `table` (\n    ...\n    UNIQUE indexName (title(length))\n)\n\n\n\n# 3.3. æ®éç´¢å¼ï¼INDEXï¼\n\næ®éç´¢å¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n\nCREATE TABLE `table` (\n    ...\n    INDEX index_name (title(length))\n)\n\n\n\n# 3.4. å¨æç´¢å¼ï¼FULLTEXTï¼\n\nå¨æç´¢å¼ï¼ä¸»è¦ç¨æ¥æ¥æ¾ææ¬ä¸­çå³é®å­ï¼èä¸æ¯ç´æ¥ä¸ç´¢å¼ä¸­çå¼ç¸æ¯è¾ã\n\nå¨æç´¢å¼è·å¶å®ç´¢å¼å¤§ä¸ç¸åï¼å®æ´åæ¯ä¸ä¸ªæç´¢å¼æï¼èä¸æ¯ç®åç WHERE è¯­å¥çåæ°å¹éãå¨æç´¢å¼éå match against æä½ä½¿ç¨ï¼èä¸æ¯ä¸è¬ç WHERE è¯­å¥å  LIKEãå®å¯ä»¥å¨ CREATE TABLEï¼ALTER TABLE ï¼CREATE INDEX ä½¿ç¨ï¼ä¸è¿ç®ååªæ charãvarcharï¼text åä¸å¯ä»¥åå»ºå¨æç´¢å¼ãå¼å¾ä¸æçæ¯ï¼å¨æ°æ®éè¾å¤§æ¶åï¼ç°å°æ°æ®æ¾å¥ä¸ä¸ªæ²¡æå¨å±ç´¢å¼çè¡¨ä¸­ï¼ç¶ååç¨ CREATE INDEX åå»ºå¨æç´¢å¼ï¼è¦æ¯åä¸ºä¸å¼ è¡¨å»ºç«å¨æç´¢å¼ç¶ååå°æ°æ®åå¥çéåº¦å¿«å¾å¤ã\n\nCREATE TABLE `table` (\n    `content` text CHARACTER NULL,\n    ...\n    FULLTEXT (content)\n)\n\n\n\n# 3.5. èåç´¢å¼\n\nç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\nCREATE TABLE `table` (\n    ...\n    INDEX index_name (title(length), title(length), ...)\n)\n\n\n\n# 4. ç´¢å¼çç­ç¥\n\nåè®¾æä»¥ä¸è¡¨ï¼\n\nCREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `city` varchar(16) NOT NULL,\n  `name` varchar(16) NOT NULL,\n  `age` int(11) NOT NULL,\n  `addr` varchar(128) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `city` (`city`)\n) ENGINE=InnoDB;\n\n\n\n# 4.1. ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ãè¦èèå°ç´¢å¼çç»´æ¤ä»£ä»·ãç©ºé´å ç¨åæ¥è¯¢æ¶åè¡¨çä»£ä»·ãç´¢å¼ä¸å®æ¯æéåå»ºçï¼å¹¶ä¸è¦å°½å¯è½ç¡®ä¿è¶³å¤è½»éãä¸æ¦åå»ºäºå¤å­æ®µçèåç´¢å¼ï¼æä»¬è¦èèå°½å¯è½å©ç¨ç´¢å¼æ¬èº«å®ææ°æ®æ¥è¯¢ï¼åå°åè¡¨çææ¬ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n * é¢ç¹ä½ä¸º WHERE è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n\n\n# 4.2. ç¬ç«çå\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nå¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼å¯è½ä¼ç ´åç´¢å¼å¼çæåºæ§ï¼å æ­¤ä¼åå¨å°±å³å®æ¾å¼èµ°æ æç´¢åè½ã\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nSELECT actor_id FROM actor WHERE actor_id + 1 = 5;\nSELECT ... WHERE TO_DAYS(current_date) - TO_DAYS(date_col) <= 10;\n\n\n\n# 4.3. è¦çç´¢å¼\n\nè¦çç´¢å¼æ¯æï¼ç´¢å¼ä¸çä¿¡æ¯è¶³å¤æ»¡è¶³æ¥è¯¢è¯·æ±ï¼ä¸éè¦åè¡¨æ¥è¯¢æ°æ®ã\n\nãç¤ºä¾ãèå´æ¥è¯¢\n\ncreate table T (\nID int primary key,\nk int NOT NULL DEFAULT 0,\ns varchar(16) NOT NULL DEFAULT '',\nindex k(k))\nengine=InnoDB;\n\ninsert into T values(100,1, 'aa'),(200,2,'bb'),(300,3,'cc'),(500,5,'ee'),(600,6,'ff'),(700,7,'gg');\n\nselect * from T where k between 3 and 5\n\n\néè¦æ§è¡å æ¬¡æ çæç´¢æä½ï¼ä¼æ«æå¤å°è¡ï¼\n\n 1. å¨ k ç´¢å¼æ ä¸æ¾å° k=3 çè®°å½ï¼åå¾ ID = 300ï¼\n 2. åå° ID ç´¢å¼æ æ¥å° ID=300 å¯¹åºç R3ï¼\n 3. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=5ï¼åå¾ ID=500ï¼\n 4. ååå° ID ç´¢å¼æ æ¥å° ID=500 å¯¹åºç R4ï¼\n 5. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=6ï¼ä¸æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼åå°ä¸»é®ç´¢å¼æ æç´¢çè¿ç¨ï¼æä»¬ç§°ä¸ºåè¡¨ãå¯ä»¥çå°ï¼è¿ä¸ªæ¥è¯¢è¿ç¨è¯»äº k ç´¢å¼æ ç 3 æ¡è®°å½ï¼æ­¥éª¤ 1ã3 å 5ï¼ï¼åè¡¨äºä¸¤æ¬¡ï¼æ­¥éª¤ 2 å 4ï¼ã\n\nå¦ææ§è¡çè¯­å¥æ¯ select ID from T where k between 3 and 5ï¼è¿æ¶åªéè¦æ¥ ID çå¼ï¼è ID çå¼å·²ç»å¨ k ç´¢å¼æ ä¸äºï¼å æ­¤å¯ä»¥ç´æ¥æä¾æ¥è¯¢ç»æï¼ä¸éè¦åè¡¨ãç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ï¼ç§°ä¸ºè¦çç´¢å¼ã\n\nç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µã\n\n\n# 4.4. ä½¿ç¨ç´¢å¼æ¥æåº\n\nMysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥éè¿å½ä¸­è¦çç´¢å¼ç´æ¥å°ç»ææ¥åºæ¥ï¼ä¹å°±ä¸åéè¦æåºäºã\n\nè¿æ ·æ´ä¸ªæ¥è¯¢è¯­å¥çæ§è¡æµç¨å°±åæäºï¼\n\n 1. ä»ç´¢å¼ (city,name,age) æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³ city='æ­å·âæ¡ä»¶çè®°å½ï¼ååºå¶ä¸­ç cityãname å age è¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 2. ä»ç´¢å¼ (city,name,age) åä¸ä¸ä¸ªè®°å½ï¼åæ ·ååºè¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 3. éå¤æ§è¡æ­¥éª¤ 2ï¼ç´å°æ¥å°ç¬¬ 1000 æ¡è®°å½ï¼æèæ¯ä¸æ»¡è¶³ city='æ­å·âæ¡ä»¶æ¶å¾ªç¯ç»æã\n\n\n# 4.5. åç¼ç´¢å¼\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè¿æ¶ï¼å¯ä»¥ä½¿ç¨åç¼ç´¢å¼ï¼å³åªç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ãå¯¹äº BLOB/TEXT/VARCHAR è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ãå¦æå­å¨å¤æ¡å½ä¸­åç¼ç´¢å¼çæåµï¼å°±éè¦ä¾æ¬¡æ«æï¼ç´å°æç»æ¾å°æ­£ç¡®è®°å½ã\n\nä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥è¯¢ææ¬ã\n\né£ä¹ï¼å¦ä½ç¡®å®åç¼ç´¢å¼åéçé¿åº¦å¢ï¼\n\nå¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªè¯­å¥ï¼ç®åºè¿ä¸ªåä¸æå¤å°ä¸ªä¸åçå¼ï¼\n\nselect count(distinct email) as L from SUser;\n\n\nç¶åï¼ä¾æ¬¡éåä¸åé¿åº¦çåç¼æ¥çè¿ä¸ªå¼ï¼æ¯å¦æä»¬è¦çä¸ä¸ 4~7 ä¸ªå­èçåç¼ç´¢å¼ï¼å¯ä»¥ç¨è¿ä¸ªè¯­å¥ï¼\n\nselect\n  count(distinct left(email,4)ï¼as L4,\n  count(distinct left(email,5)ï¼as L5,\n  count(distinct left(email,6)ï¼as L6,\n  count(distinct left(email,7)ï¼as L7,\nfrom SUser;\n\n\nå½ç¶ï¼ä½¿ç¨åç¼ç´¢å¼å¾å¯è½ä¼æå¤±åºååº¦ï¼æä»¥ä½ éè¦é¢åè®¾å®ä¸ä¸ªå¯ä»¥æ¥åçæå¤±æ¯ä¾ï¼æ¯å¦ 5%ãç¶åï¼å¨è¿åç L4~L7 ä¸­ï¼æ¾åºä¸å°äº L * 95% çå¼ï¼åè®¾è¿é L6ãL7 é½æ»¡è¶³ï¼ä½ å°±å¯ä»¥éæ©åç¼é¿åº¦ä¸º 6ã\n\næ­¤å¤ï¼order by æ æ³ä½¿ç¨åç¼ç´¢å¼ï¼æ æ³æåç¼ç´¢å¼ç¨ä½è¦çç´¢å¼ã\n\n\n# 4.6. æå·¦åç¼å¹éåå\n\nä¸åªæ¯ç´¢å¼çå¨é¨å®ä¹ï¼åªè¦æ»¡è¶³æå·¦åç¼ï¼å°±å¯ä»¥å©ç¨ç´¢å¼æ¥å éæ£ç´¢ãè¿ä¸ªæå·¦åç¼å¯ä»¥æ¯èåç´¢å¼çæå·¦ N ä¸ªå­æ®µï¼ä¹å¯ä»¥æ¯å­ç¬¦ä¸²ç´¢å¼çæå·¦ M ä¸ªå­ç¬¦ã\n\nMySQL ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,BETWEEN,LIKE) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè WHERE å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¾å¦ï¼a = 1 and b = 2 and c > 3 and d = 4ï¼å¦æå»ºç«ï¼a,b,c,dï¼é¡ºåºçç´¢å¼ï¼d æ¯ç¨ä¸å°ç´¢å¼çï¼å¦æå»ºç«(a,b,d,c)çç´¢å¼åé½å¯ä»¥ç¨å°ï¼a,b,d çé¡ºåºå¯ä»¥ä»»æè°æ´ã\n\nè®©éæ©æ§æå¼ºçç´¢å¼åæ¾å¨åé¢ï¼ç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åè®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nä¾å¦ä¸é¢æ¾ç¤ºçç»æä¸­ customer_id çéæ©æ§æ¯ staff_id æ´é«ï¼å æ­¤æå¥½æ customer_id åæ¾å¨å¤åç´¢å¼çåé¢ã\n\nSELECT COUNT(DISTINCT staff_id)/COUNT(*) AS staff_id_selectivity,\nCOUNT(DISTINCT customer_id)/COUNT(*) AS customer_id_selectivity,\nCOUNT(*)\nFROM payment;\n\n\n   staff_id_selectivity: 0.0001\ncustomer_id_selectivity: 0.0373\n               COUNT(*): 16049\n\n\n\n# 4.7. = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè =ãIN ç­çé¡ºåºï¼Mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nãç¤ºä¾ãå¦æç´¢å¼ (a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼MySQL ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcãdã\n\n\n# 5. ç´¢å¼æä½³å®è·µ\n\nåå»ºäºç´¢å¼ï¼å¹¶éä¸å®ææãæ¯å¦ä¸æ»¡è¶³åç¼ç´¢å¼ãæå·¦åç¼å¹éååãæ¥è¯¢æ¡ä»¶æ¶åå½æ°è®¡ç®ç­æåµé½æ æ³ä½¿ç¨ç´¢å¼ãæ­¤å¤ï¼å³ä½¿ SQL æ¬èº«ç¬¦åç´¢å¼çä½¿ç¨æ¡ä»¶ï¼MySQL ä¹ä¼éè¿è¯ä¼°åç§æ¥è¯¢æ¹å¼çä»£ä»·ï¼æ¥å³å®æ¯å¦èµ°ç´¢å¼ï¼ä»¥åèµ°åªä¸ªç´¢å¼ã\n\nå æ­¤ï¼å¨å°è¯éè¿ç´¢å¼è¿è¡ SQL æ§è½ä¼åçæ¶åï¼å¡å¿éè¿æ§è¡è®¡åï¼EXPLAINï¼æå®éçæææ¥ç¡®è®¤ç´¢å¼æ¯å¦è½æææ¹åæ§è½é®é¢ï¼å¦åå¢å äºç´¢å¼ä¸ä½æ²¡è§£å³æ§è½é®é¢ï¼è¿å¢å äºæ°æ®åºå¢å æ¹çè´æãå¦æå¯¹ EXPLAIN ç»åºçæ§è¡è®¡åæçé®çè¯ï¼ä½ è¿å¯ä»¥å©ç¨ optimizer_trace æ¥çè¯¦ç»çæ§è¡è®¡ååè¿ä¸æ­¥åæã\n\n\n# 6. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * MySQL ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n * MySQL å®æ 45 è®²",normalizedContent:"# mysql ç´¢å¼\n\n> ç´¢å¼æ¯æé« mysql æ¥è¯¢æ§è½çä¸ä¸ªéè¦éå¾ï¼ä½è¿å¤çç´¢å¼å¯è½ä¼å¯¼è´è¿é«çç£çä½¿ç¨çä»¥åè¿é«çåå­å ç¨ï¼ä»èå½±ååºç¨ç¨åºçæ´ä½æ§è½ãåºå½å°½éé¿åäºåææ³èµ·æ·»å ç´¢å¼ï¼å ä¸ºäºåå¯è½éè¦çæ§å¤§éç sql æè½å®ä½å°é®é¢æå¨ï¼èä¸æ·»å ç´¢å¼çæ¶é´è¯å®æ¯è¿å¤§äºåå§æ·»å ç´¢å¼æéè¦çæ¶é´ï¼å¯è§ç´¢å¼çæ·»å ä¹æ¯éå¸¸æææ¯å«éçã\n> \n> æ¥ä¸æ¥å°åä½ å±ç¤ºä¸ç³»ååå»ºé«æ§è½ç´¢å¼çç­ç¥ï¼ä»¥åæ¯æ¡ç­ç¥å¶èåçå·¥ä½åçãä½å¨æ­¤ä¹åï¼åäºè§£ä¸ç´¢å¼ç¸å³çä¸äºç®æ³åæ°æ®ç»æï¼å°æå©äºæ´å¥½ççè§£åæçåå®¹ã\n\n\n\n\n# 1. ç´¢å¼ç®ä»\n\nç´¢å¼æ¯æ°æ®åºä¸ºäºæé«æ¥æ¾æççä¸ç§æ°æ®ç»æã\n\nç´¢å¼å¯¹äºè¯å¥½çæ§è½éå¸¸å³é®ï¼å¨æ°æ®éå°ä¸è´è½½è¾ä½æ¶ï¼ä¸æ°å½çç´¢å¼å¯¹äºæ§è½çå½±åå¯è½è¿ä¸ææ¾ï¼ä½éçæ°æ®ééæ¸å¢å¤§ï¼æ§è½åä¼æ¥å§ä¸éãå æ­¤ï¼ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n\n\n# 1.1. ç´¢å¼çä¼ç¼ºç¹\n\nb æ æ¯æå¸¸è§çç´¢å¼ï¼æç§é¡ºåºå­å¨æ°æ®ï¼æä»¥ mysql å¯ä»¥ç¨æ¥å order by å group by æä½ãå ä¸ºæ°æ®æ¯æåºçï¼æä»¥ b æ ä¹å°±ä¼å°ç¸å³çåå¼é½å­å¨å¨ä¸èµ·ãæåï¼å ä¸ºç´¢å¼ä¸­å­å¨äºå®éçåå¼ï¼æä»¥æäºæ¥è¯¢åªä½¿ç¨ç´¢å¼å°±è½å¤å®æå¨é¨æ¥è¯¢ã\n\nâ ç´¢å¼çä¼ç¹ï¼\n\n * ç´¢å¼å¤§å¤§åå°äºæå¡å¨éè¦æ«æçæ°æ®éï¼ä»èå å¿«æ£ç´¢éåº¦ã\n * ç´¢å¼å¯ä»¥å¸®å©æå¡å¨é¿åæåºåä¸´æ¶è¡¨ã\n * ç´¢å¼å¯ä»¥å°éæº i/o åä¸ºé¡ºåº i/oã\n * æ¯æè¡çº§éçæ°æ®åºï¼å¦ innodb ä¼å¨è®¿é®è¡çæ¶åå éãä½¿ç¨ç´¢å¼å¯ä»¥åå°è®¿é®çè¡æ°ï¼ä»èåå°éçç«äºï¼æé«å¹¶åã\n * å¯ä¸ç´¢å¼å¯ä»¥ç¡®ä¿æ¯ä¸è¡æ°æ®çå¯ä¸æ§ï¼éè¿ä½¿ç¨ç´¢å¼ï¼å¯ä»¥å¨æ¥è¯¢çè¿ç¨ä¸­ä½¿ç¨ä¼åéèå¨ï¼æé«ç³»ç»çæ§è½ã\n\nâ ç´¢å¼çç¼ºç¹ï¼\n\n * åå»ºåç»´æ¤ç´¢å¼è¦èè´¹æ¶é´ï¼è¿ä¼éçæ°æ®éçå¢å èå¢å ã\n * ç´¢å¼éè¦å ç¨é¢å¤çç©çç©ºé´ï¼é¤äºæ°æ®è¡¨å æ°æ®ç©ºé´ä¹å¤ï¼æ¯ä¸ä¸ªç´¢å¼è¿è¦å ä¸å®çç©çç©ºé´ï¼å¦æè¦å»ºç«ç»åç´¢å¼é£ä¹éè¦çç©ºé´å°±ä¼æ´å¤§ã\n * åæä½ï¼insert/update/deleteï¼æ¶å¾å¯è½éè¦æ´æ°ç´¢å¼ï¼å¯¼è´æ°æ®åºçåæä½æ§è½éä½ã\n\n\n# 1.2. ä½æ¶ä½¿ç¨ç´¢å¼\n\n> ç´¢å¼è½å¤è½»æå°æ¥è¯¢æ§è½æåå ä¸ªæ°éçº§ã\n\nâ ä»ä¹æåµéç¨ç´¢å¼ï¼\n\n * é¢ç¹è¯»æä½ï¼ select ï¼\n * è¡¨çæ°æ®éæ¯è¾å¤§ã\n * ååç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­ã\n\nâ ä»ä¹æåµä¸éç¨ç´¢å¼ï¼\n\n * é¢ç¹åæä½ï¼ insert/update/delete ï¼ï¼ä¹å°±æå³çéè¦æ´æ°ç´¢å¼ã\n * ååä¸ç»å¸¸åºç°å¨ where æè¿æ¥ï¼joinï¼æ¡ä»¶ä¸­ï¼ä¹å°±æå³çç´¢å¼ä¼ç»å¸¸æ æ³å½ä¸­ï¼æ²¡ææä¹ï¼è¿å¢å ç©ºé´å¼éã\n * éå¸¸å°çè¡¨ï¼å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * ç¹å¤§åçè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯æ nosqlã\n\n\n# 2. ç´¢å¼çæ°æ®ç»æ\n\nå¨ mysql ä¸­ï¼ç´¢å¼æ¯å¨å­å¨å¼æå±èä¸æ¯æå¡å¨å±å®ç°çãæä»¥ï¼å¹¶æ²¡æç»ä¸çç´¢å¼æ åï¼ä¸åå­å¨å¼æçç´¢å¼çæ°æ®ç»æä¹ä¸ç¸åã\n\n\n# æ°ç»\n\næ°ç»æ¯ç¨è¿ç»­çåå­ç©ºé´æ¥å­å¨æ°æ®ï¼å¹¶ä¸æ¯æéæºè®¿é®ã\n\næåºæ°ç»å¯ä»¥ä½¿ç¨äºåæ¥æ¾æ³ï¼å¶æ¶é´å¤æåº¦ä¸º o(log n)ï¼æ è®ºæ¯ç­å¼æ¥è¯¢è¿æ¯èå´æ¥è¯¢ï¼é½éå¸¸é«æã\n\nä½æ°ç»æä¸¤ä¸ªéè¦éå¶ï¼\n\n * æ°ç»çç©ºé´å¤§å°åºå®ï¼å¦æè¦æ©å®¹åªè½éç¨å¤å¶æ°ç»çæ¹å¼ã\n * æå¥ãå é¤æ¶é´å¤æåº¦ä¸º o(n)ã\n\nè¿æå³çï¼å¦æä½¿ç¨æ°ç»ä½ä¸ºç´¢å¼ï¼å¦æè¦ä¿è¯æ°ç»æåºï¼å¶æ´æ°æä½ä»£ä»·é«æã\n\n\n# 2.1. åå¸ç´¢å¼\n\nåå¸è¡¨æ¯ä¸ç§ä»¥é® - å¼ï¼key-valueï¼å¯¹å½¢å¼å­å¨æ°æ®çç»æï¼æä»¬åªè¦è¾å¥å¾æ¥æ¾çå¼å³ keyï¼å°±å¯ä»¥æ¾å°å¶å¯¹åºçå¼å³ valueã\n\nåå¸è¡¨ ä½¿ç¨ åå¸å½æ° ç»ç»æ°æ®ï¼ä»¥æ¯æå¿«éæå¥åæç´¢çæ°æ®ç»æãåå¸è¡¨çæ¬è´¨æ¯ä¸ä¸ªæ°ç»ï¼å¶æè·¯æ¯ï¼ä½¿ç¨ hash å½æ°å° key è½¬æ¢ä¸ºæ°ç»ä¸æ ï¼å©ç¨æ°ç»çéæºè®¿é®ç¹æ§ï¼ä½¿å¾æä»¬è½å¨ o(1) çæ¶é´ä»£ä»·åå®ææ£ç´¢ã\n\n\n\næä¸¤ç§ä¸åç±»åçåå¸è¡¨ï¼åå¸éå å åå¸æ å°ã\n\n * åå¸éå æ¯éåæ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨ééå¤å¼ã\n * åå¸æ å° æ¯æ å° æ°æ®ç»æçå®ç°ä¹ä¸ï¼ç¨äºå­å¨é®å¼å¯¹ã\n\nåå¸ç´¢å¼åºäºåå¸è¡¨å®ç°ï¼åªéç¨äºç­å¼æ¥è¯¢ãå¯¹äºæ¯ä¸è¡æ°æ®ï¼åå¸ç´¢å¼é½ä¼å°ææçç´¢å¼åè®¡ç®ä¸ä¸ªåå¸ç ï¼hashcodeï¼ï¼åå¸ç æ¯ä¸ä¸ªè¾å°çå¼ãåå¸ç´¢å¼å°ææçåå¸ç å­å¨å¨ç´¢å¼ä¸­ï¼åæ¶å¨åå¸è¡¨ä¸­ä¿å­æåæ¯ä¸ªæ°æ®è¡çæéã\n\nå¨ mysql ä¸­ï¼åªæ memory å­å¨å¼ææ¾ç¤ºæ¯æåå¸ç´¢å¼ã\n\nâ åå¸ç´¢å¼çä¼ç¹ï¼\n\n * å ä¸ºç´¢å¼æ°æ®ç»æç´§åï¼æä»¥æ¥è¯¢éåº¦éå¸¸å¿«ã\n\nâ åå¸ç´¢å¼çç¼ºç¹ï¼\n\n * åå¸ç´¢å¼å¼åå«åå¸å¼åè¡æéï¼èä¸å­å¨å­æ®µå¼ï¼æä»¥ä¸è½ä½¿ç¨ç´¢å¼ä¸­çå¼æ¥é¿åè¯»åè¡ãä¸è¿ï¼è®¿é®åå­ä¸­çè¡çéåº¦å¾å¿«ï¼æä»¥å¤§é¨åæåµä¸è¿ä¸ç¹å¯¹æ§è½å½±åä¸å¤§ã\n * åå¸ç´¢å¼æ°æ®ä¸æ¯æç§ç´¢å¼å¼é¡ºåºå­å¨çï¼æä»¥æ æ³ç¨äºæåºã\n * åå¸ç´¢å¼ä¸æ¯æé¨åç´¢å¼å¹éæ¥æ¾ï¼å ä¸ºåå¸ç´¢å¼æ¶ä½¿ç¨ç´¢å¼åçå¨é¨åå®¹æ¥è¿è¡åå¸è®¡ç®çãå¦ï¼å¨æ°æ®å (a,b) ä¸å»ºç«åå¸ç´¢å¼ï¼å¦ææ¥è¯¢åªææ°æ®å aï¼æ æ³ä½¿ç¨è¯¥ç´¢å¼ã\n * åå¸ç´¢å¼åªæ¯æç­å¼æ¯è¾æ¥è¯¢ï¼åæ¬ =ãin()ã<=>ï¼ä¸æ¯æä»»ä½èå´æ¥è¯¢ï¼å¦ where price > 100ã\n * åå¸ç´¢å¼æå¯è½åºç°åå¸å²çª\n   * åºç°åå¸å²çªæ¶ï¼å¿é¡»éåé¾è¡¨ä¸­ææçè¡æéï¼éè¡æ¯è¾ï¼ç´å°æ¾å°ç¬¦åæ¡ä»¶çè¡ã\n   * å¦æåå¸å²çªå¤çè¯ï¼ç»´æ¤ç´¢å¼çä»£ä»·ä¼å¾é«ã\n\n> å ä¸ºç§ç§éå¶ï¼æä»¥åå¸ç´¢å¼åªéç¨äºç¹å®çåºåãèä¸æ¦ä½¿ç¨åå¸ç´¢å¼ï¼åå®å¸¦æ¥çæ§è½æåä¼éå¸¸æ¾èã\n\n\n# 2.2. b æ ç´¢å¼\n\néå¸¸æä»¬æè¯´çç´¢å¼æ¯æb-treeç´¢å¼ï¼å®æ¯ç®åå³ç³»åæ°æ®åºä¸­æ¥æ¾æ°æ®æä¸ºå¸¸ç¨åææçç´¢å¼ï¼å¤§å¤æ°å­å¨å¼æé½æ¯æè¿ç§ç´¢å¼ãä½¿ç¨b-treeè¿ä¸ªæ¯è¯­ï¼æ¯å ä¸º mysql å¨create tableæå¶å®è¯­å¥ä¸­ä½¿ç¨äºè¿ä¸ªå³é®å­ï¼ä½å®éä¸ä¸åçå­å¨å¼æå¯è½ä½¿ç¨ä¸åçæ°æ®ç»æï¼æ¯å¦ innodb å°±æ¯ä½¿ç¨çb+treeã\n\nb+treeä¸­ç b æ¯æbalanceï¼æä¸ºå¹³è¡¡ãéè¦æ³¨æçæ¯ï¼b+æ ç´¢å¼å¹¶ä¸è½æ¾å°ä¸ä¸ªç»å®é®å¼çå·ä½è¡ï¼å®æ¾å°çåªæ¯è¢«æ¥æ¾æ°æ®è¡æå¨çé¡µï¼æ¥çæ°æ®åºä¼æé¡µè¯»å¥å°åå­ï¼åå¨åå­ä¸­è¿è¡æ¥æ¾ï¼æåå¾å°è¦æ¥æ¾çæ°æ®ã\n\n# äºåæç´¢æ \n\näºåæç´¢æ çç¹ç¹æ¯ï¼æ¯ä¸ªèç¹çå·¦å¿å­å°äºç¶èç¹ï¼ç¶èç¹åå°äºå³å¿å­ãå¶æ¥è¯¢æ¶é´å¤æåº¦æ¯ $$o(log(n))$$ã\n\nå½ç¶ä¸ºäºç»´æ $$o(log(n))$$ çæ¥è¯¢å¤æåº¦ï¼ä½ å°±éè¦ä¿æè¿æ£µæ æ¯å¹³è¡¡äºåæ ãä¸ºäºåè¿ä¸ªä¿è¯ï¼æ´æ°çæ¶é´å¤æåº¦ä¹æ¯ $$o(log(n))$$ã\n\néçæ°æ®åºä¸­æ°æ®çå¢å ï¼ç´¢å¼æ¬èº«å¤§å°éä¹å¢å ï¼ä¸å¯è½å¨é¨å­å¨å¨åå­ä¸­ï¼å æ­¤ç´¢å¼å¾å¾ä»¥ç´¢å¼æä»¶çå½¢å¼å­å¨çç£çä¸ãè¿æ ·çè¯ï¼ç´¢å¼æ¥æ¾è¿ç¨ä¸­å°±è¦äº§çç£ç i/o æ¶èï¼ç¸å¯¹äºåå­å­åï¼i/o å­åçæ¶èè¦é«å ä¸ªæ°éçº§ãå¯ä»¥æ³è±¡ä¸ä¸ä¸æ£µå ç¾ä¸èç¹çäºåæ çæ·±åº¦æ¯å¤å°ï¼å¦æå°è¿ä¹å¤§æ·±åº¦çä¸é¢äºåæ æ¾ç£çä¸ï¼æ¯è¯»åä¸ä¸ªèç¹ï¼éè¦ä¸æ¬¡ç£çç i/o è¯»åï¼æ´ä¸ªæ¥æ¾çèæ¶æ¾ç¶æ¯ä¸è½å¤æ¥åçãé£ä¹å¦ä½åå°æ¥æ¾è¿ç¨ä¸­ç i/o å­åæ¬¡æ°ï¼\n\nä¸ç§è¡ä¹ææçè§£å³æ¹æ³æ¯åå°æ çæ·±åº¦ï¼å°äºåæ åä¸º n åæ ï¼å¤è·¯æç´¢æ ï¼ï¼è b+ æ å°±æ¯ä¸ç§å¤è·¯æç´¢æ ã\n\n# b+ æ \n\nb+ æ ç´¢å¼éç¨äºå¨é®å¼æ¥æ¾ãé®å¼èå´æ¥æ¾åé®åç¼æ¥æ¾ï¼å¶ä¸­é®åç¼æ¥æ¾åªéç¨äºæå·¦åç¼æ¥æ¾ã\n\nçè§£b+treeæ¶ï¼åªéè¦çè§£å¶æéè¦çä¸¤ä¸ªç¹å¾å³å¯ï¼\n\n * ç¬¬ä¸ï¼ææçå³é®å­ï¼å¯ä»¥çè§£ä¸ºæ°æ®ï¼é½å­å¨å¨å¶å­èç¹ï¼éå¶å­èç¹å¹¶ä¸å­å¨çæ­£çæ°æ®ï¼ææè®°å½èç¹é½æ¯æé®å¼å¤§å°é¡ºåºå­æ¾å¨åä¸å±å¶å­èç¹ä¸ã\n * å¶æ¬¡ï¼ææçå¶å­èç¹ç±æéè¿æ¥ãå¦ä¸å¾ä¸ºç®åäºçb+treeã\n\n\n\næ ¹æ®å¶å­èç¹çåå®¹ï¼ç´¢å¼ç±»ååä¸ºä¸»é®ç´¢å¼åéä¸»é®ç´¢å¼ã\n\n * èç°ç´¢å¼ï¼clusteredï¼ï¼åç§°ä¸ºä¸»é®ç´¢å¼ï¼å¶å¶å­èç¹å­çæ¯æ´è¡æ°æ®ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ãinnodb çèç°ç´¢å¼å®éæ¯å¨åä¸ä¸ªç»æä¸­ä¿å­äº b æ çç´¢å¼åæ°æ®è¡ã\n * éä¸»é®ç´¢å¼çå¶å­èç¹åå®¹æ¯ä¸»é®çå¼ãå¨ innodb éï¼éä¸»é®ç´¢å¼ä¹è¢«ç§°ä¸ºäºçº§ç´¢å¼ï¼secondaryï¼ãæ°æ®å­å¨å¨ä¸ä¸ªä½ç½®ï¼ç´¢å¼å­å¨å¨å¦ä¸ä¸ªä½ç½®ï¼ç´¢å¼ä¸­åå«æåæ°æ®å­å¨ä½ç½®çæéãå¯ä»¥æå¤ä¸ªï¼å°äº 249 ä¸ªã\n\nèç°è¡¨ç¤ºæ°æ®è¡åç¸é»çé®å¼ç´§åå°å­å¨å¨ä¸èµ·ï¼å ä¸ºæ°æ®ç´§åï¼æä»¥è®¿é®å¿«ãå ä¸ºæ æ³åæ¶ææ°æ®è¡å­æ¾å¨ä¸¤ä¸ªä¸åçå°æ¹ï¼æä»¥ä¸ä¸ªè¡¨åªè½æä¸ä¸ªèç°ç´¢å¼ã\n\nèç°ç´¢å¼åéèç°ç´¢å¼çæ¥è¯¢æä»ä¹åºå«\n\n * å¦æè¯­å¥æ¯ select * from t where id=500ï¼å³èç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼ååªéè¦æç´¢ id è¿æ£µ b+ æ ï¼\n * å¦æè¯­å¥æ¯ select * from t where k=5ï¼å³éèç°ç´¢å¼æ¥è¯¢æ¹å¼ï¼åéè¦åæç´¢ k ç´¢å¼æ ï¼å¾å° id çå¼ä¸º 500ï¼åå° id ç´¢å¼æ æç´¢ä¸æ¬¡ãè¿ä¸ªè¿ç¨ç§°ä¸ºåè¡¨ã\n\nä¹å°±æ¯è¯´ï¼åºäºéèç°ç´¢å¼çæ¥è¯¢éè¦å¤æ«æä¸æ£µç´¢å¼æ ãå æ­¤ï¼æä»¬å¨åºç¨ä¸­åºè¯¥å°½éä½¿ç¨ä¸»é®æ¥è¯¢ã\n\næ¾ç¶ï¼ä¸»é®é¿åº¦è¶å°ï¼éèç°ç´¢å¼çå¶å­èç¹å°±è¶å°ï¼éèç°ç´¢å¼å ç¨çç©ºé´ä¹å°±è¶å°ã\n\nèªå¢ä¸»é®æ¯æèªå¢åä¸å®ä¹çä¸»é®ï¼å¨å»ºè¡¨è¯­å¥ä¸­ä¸è¬æ¯è¿ä¹å®ä¹çï¼ not null primary key auto_incrementãä»æ§è½åå­å¨ç©ºé´æ¹é¢èéï¼èªå¢ä¸»é®å¾å¾æ¯æ´åççéæ©ãææ²¡æä»ä¹åºæ¯éåç¨ä¸å¡å­æ®µç´æ¥åä¸»é®çå¢ï¼è¿æ¯æçãæ¯å¦ï¼æäºä¸å¡çåºæ¯éæ±æ¯è¿æ ·çï¼\n\n * åªæä¸ä¸ªç´¢å¼ï¼\n * è¯¥ç´¢å¼å¿é¡»æ¯å¯ä¸ç´¢å¼ã\n\nç±äºæ²¡æå¶ä»ç´¢å¼ï¼æä»¥ä¹å°±ä¸ç¨èèå¶ä»ç´¢å¼çå¶å­èç¹å¤§å°çé®é¢ã\n\nè¿æ¶åæä»¬å°±è¦ä¼åèèä¸ä¸æ®µæå°çâå°½éä½¿ç¨ä¸»é®æ¥è¯¢âååï¼ç´æ¥å°è¿ä¸ªç´¢å¼è®¾ç½®ä¸ºä¸»é®ï¼å¯ä»¥é¿åæ¯æ¬¡æ¥è¯¢éè¦æç´¢ä¸¤æ£µæ ã\n\n\n# 2.3. å¨æç´¢å¼\n\nmyisam å­å¨å¼ææ¯æå¨æç´¢å¼ï¼ç¨äºæ¥æ¾ææ¬ä¸­çå³é®è¯ï¼èä¸æ¯ç´æ¥æ¯è¾æ¯å¦ç¸ç­ãæ¥æ¾æ¡ä»¶ä½¿ç¨ match againstï¼èä¸æ¯æ®éç whereã\n\nå¨æç´¢å¼ä¸è¬ä½¿ç¨åæç´¢å¼å®ç°ï¼å®è®°å½çå³é®è¯å°å¶æå¨ææ¡£çæ å°ã\n\ninnodb å­å¨å¼æå¨ mysql 5.6.4 çæ¬ä¸­ä¹å¼å§æ¯æå¨æç´¢å¼ã\n\n\n# 2.4. ç©ºé´æ°æ®ç´¢å¼\n\nmyisam å­å¨å¼ææ¯æç©ºé´æ°æ®ç´¢å¼ï¼r-treeï¼ï¼å¯ä»¥ç¨äºå°çæ°æ®å­å¨ãç©ºé´æ°æ®ç´¢å¼ä¼ä»ææç»´åº¦æ¥ç´¢å¼æ°æ®ï¼å¯ä»¥ææå°ä½¿ç¨ä»»æç»´åº¦æ¥è¿è¡ç»åæ¥è¯¢ã\n\nå¿é¡»ä½¿ç¨ gis ç¸å³çå½æ°æ¥ç»´æ¤æ°æ®ã\n\n\n# 3. ç´¢å¼çç±»å\n\nä¸»æµçå³ç³»åæ°æ®åºä¸è¬é½æ¯æä»¥ä¸ç´¢å¼ç±»åï¼\n\n\n# 3.1. ä¸»é®ç´¢å¼ï¼primaryï¼\n\nä¸»é®ç´¢å¼ï¼ä¸ç§ç¹æ®çå¯ä¸ç´¢å¼ï¼ä¸åè®¸æç©ºå¼ãä¸ä¸ªè¡¨åªè½æä¸ä¸ªä¸»é®ï¼å¨ innodb ä¸­æ¬è´¨ä¸å³èç°ç´¢å¼ï¼ï¼ä¸è¬æ¯å¨å»ºè¡¨çæ¶ååæ¶åå»ºä¸»é®ç´¢å¼ã\n\ncreate table `table` (\n    `id` int(11) not null auto_increment,\n    ...\n    primary key (`id`)\n)\n\n\n\n# 3.2. å¯ä¸ç´¢å¼ï¼uniqueï¼\n\nå¯ä¸ç´¢å¼ï¼ç´¢å¼åçå¼å¿é¡»å¯ä¸ï¼ä½åè®¸æç©ºå¼ãå¦ææ¯ç»åç´¢å¼ï¼ååå¼çç»åå¿é¡»å¯ä¸ã\n\ncreate table `table` (\n    ...\n    unique indexname (title(length))\n)\n\n\n\n# 3.3. æ®éç´¢å¼ï¼indexï¼\n\næ®éç´¢å¼ï¼æåºæ¬çç´¢å¼ï¼æ²¡æä»»ä½éå¶ã\n\ncreate table `table` (\n    ...\n    index index_name (title(length))\n)\n\n\n\n# 3.4. å¨æç´¢å¼ï¼fulltextï¼\n\nå¨æç´¢å¼ï¼ä¸»è¦ç¨æ¥æ¥æ¾ææ¬ä¸­çå³é®å­ï¼èä¸æ¯ç´æ¥ä¸ç´¢å¼ä¸­çå¼ç¸æ¯è¾ã\n\nå¨æç´¢å¼è·å¶å®ç´¢å¼å¤§ä¸ç¸åï¼å®æ´åæ¯ä¸ä¸ªæç´¢å¼æï¼èä¸æ¯ç®åç where è¯­å¥çåæ°å¹éãå¨æç´¢å¼éå match against æä½ä½¿ç¨ï¼èä¸æ¯ä¸è¬ç where è¯­å¥å  likeãå®å¯ä»¥å¨ create tableï¼alter table ï¼create index ä½¿ç¨ï¼ä¸è¿ç®ååªæ charãvarcharï¼text åä¸å¯ä»¥åå»ºå¨æç´¢å¼ãå¼å¾ä¸æçæ¯ï¼å¨æ°æ®éè¾å¤§æ¶åï¼ç°å°æ°æ®æ¾å¥ä¸ä¸ªæ²¡æå¨å±ç´¢å¼çè¡¨ä¸­ï¼ç¶ååç¨ create index åå»ºå¨æç´¢å¼ï¼è¦æ¯åä¸ºä¸å¼ è¡¨å»ºç«å¨æç´¢å¼ç¶ååå°æ°æ®åå¥çéåº¦å¿«å¾å¤ã\n\ncreate table `table` (\n    `content` text character null,\n    ...\n    fulltext (content)\n)\n\n\n\n# 3.5. èåç´¢å¼\n\nç»åç´¢å¼ï¼å¤ä¸ªå­æ®µä¸åå»ºçç´¢å¼ï¼åªæå¨æ¥è¯¢æ¡ä»¶ä¸­ä½¿ç¨äºåå»ºç´¢å¼æ¶çç¬¬ä¸ä¸ªå­æ®µï¼ç´¢å¼æä¼è¢«ä½¿ç¨ãä½¿ç¨ç»åç´¢å¼æ¶éµå¾ªæå·¦åç¼éåã\n\ncreate table `table` (\n    ...\n    index index_name (title(length), title(length), ...)\n)\n\n\n\n# 4. ç´¢å¼çç­ç¥\n\nåè®¾æä»¥ä¸è¡¨ï¼\n\ncreate table `t` (\n  `id` int(11) not null,\n  `city` varchar(16) not null,\n  `name` varchar(16) not null,\n  `age` int(11) not null,\n  `addr` varchar(128) default null,\n  primary key (`id`),\n  key `city` (`city`)\n) engine=innodb;\n\n\n\n# 4.1. ç´¢å¼åºæ¬åå\n\n * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ãè¦èèå°ç´¢å¼çç»´æ¤ä»£ä»·ãç©ºé´å ç¨åæ¥è¯¢æ¶åè¡¨çä»£ä»·ãç´¢å¼ä¸å®æ¯æéåå»ºçï¼å¹¶ä¸è¦å°½å¯è½ç¡®ä¿è¶³å¤è½»éãä¸æ¦åå»ºäºå¤å­æ®µçèåç´¢å¼ï¼æä»¬è¦èèå°½å¯è½å©ç¨ç´¢å¼æ¬èº«å®ææ°æ®æ¥è¯¢ï¼åå°åè¡¨çææ¬ã\n * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n * é¢ç¹ä½ä¸º where è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n\n\n# 4.2. ç¬ç«çå\n\nâç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n\nå¯¹ç´¢å¼å­æ®µåå½æ°æä½ï¼å¯è½ä¼ç ´åç´¢å¼å¼çæåºæ§ï¼å æ­¤ä¼åå¨å°±å³å®æ¾å¼èµ°æ æç´¢åè½ã\n\nå¦ææ¥è¯¢ä¸­çåä¸æ¯ç¬ç«çåï¼åæ°æ®åºä¸ä¼ä½¿ç¨ç´¢å¼ã\n\nâ éè¯¯ç¤ºä¾ï¼\n\nselect actor_id from actor where actor_id + 1 = 5;\nselect ... where to_days(current_date) - to_days(date_col) <= 10;\n\n\n\n# 4.3. è¦çç´¢å¼\n\nè¦çç´¢å¼æ¯æï¼ç´¢å¼ä¸çä¿¡æ¯è¶³å¤æ»¡è¶³æ¥è¯¢è¯·æ±ï¼ä¸éè¦åè¡¨æ¥è¯¢æ°æ®ã\n\nãç¤ºä¾ãèå´æ¥è¯¢\n\ncreate table t (\nid int primary key,\nk int not null default 0,\ns varchar(16) not null default '',\nindex k(k))\nengine=innodb;\n\ninsert into t values(100,1, 'aa'),(200,2,'bb'),(300,3,'cc'),(500,5,'ee'),(600,6,'ff'),(700,7,'gg');\n\nselect * from t where k between 3 and 5\n\n\néè¦æ§è¡å æ¬¡æ çæç´¢æä½ï¼ä¼æ«æå¤å°è¡ï¼\n\n 1. å¨ k ç´¢å¼æ ä¸æ¾å° k=3 çè®°å½ï¼åå¾ id = 300ï¼\n 2. åå° id ç´¢å¼æ æ¥å° id=300 å¯¹åºç r3ï¼\n 3. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=5ï¼åå¾ id=500ï¼\n 4. ååå° id ç´¢å¼æ æ¥å° id=500 å¯¹åºç r4ï¼\n 5. å¨ k ç´¢å¼æ åä¸ä¸ä¸ªå¼ k=6ï¼ä¸æ»¡è¶³æ¡ä»¶ï¼å¾ªç¯ç»æã\n\nå¨è¿ä¸ªè¿ç¨ä¸­ï¼åå°ä¸»é®ç´¢å¼æ æç´¢çè¿ç¨ï¼æä»¬ç§°ä¸ºåè¡¨ãå¯ä»¥çå°ï¼è¿ä¸ªæ¥è¯¢è¿ç¨è¯»äº k ç´¢å¼æ ç 3 æ¡è®°å½ï¼æ­¥éª¤ 1ã3 å 5ï¼ï¼åè¡¨äºä¸¤æ¬¡ï¼æ­¥éª¤ 2 å 4ï¼ã\n\nå¦ææ§è¡çè¯­å¥æ¯ select id from t where k between 3 and 5ï¼è¿æ¶åªéè¦æ¥ id çå¼ï¼è id çå¼å·²ç»å¨ k ç´¢å¼æ ä¸äºï¼å æ­¤å¯ä»¥ç´æ¥æä¾æ¥è¯¢ç»æï¼ä¸éè¦åè¡¨ãç´¢å¼åå«ææéè¦æ¥è¯¢çå­æ®µçå¼ï¼ç§°ä¸ºè¦çç´¢å¼ã\n\nç±äºè¦çç´¢å¼å¯ä»¥åå°æ çæç´¢æ¬¡æ°ï¼æ¾èæåæ¥è¯¢æ§è½ï¼æä»¥ä½¿ç¨è¦çç´¢å¼æ¯ä¸ä¸ªå¸¸ç¨çæ§è½ä¼åææ®µã\n\n\n# 4.4. ä½¿ç¨ç´¢å¼æ¥æåº\n\nmysql æä¸¤ç§æ¹å¼å¯ä»¥çææåºç»æï¼éè¿æåºæä½ï¼æèæç´¢å¼é¡ºåºæ«æã\n\nç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥éè¿å½ä¸­è¦çç´¢å¼ç´æ¥å°ç»ææ¥åºæ¥ï¼ä¹å°±ä¸åéè¦æåºäºã\n\nè¿æ ·æ´ä¸ªæ¥è¯¢è¯­å¥çæ§è¡æµç¨å°±åæäºï¼\n\n 1. ä»ç´¢å¼ (city,name,age) æ¾å°ç¬¬ä¸ä¸ªæ»¡è¶³ city='æ­å·âæ¡ä»¶çè®°å½ï¼ååºå¶ä¸­ç cityãname å age è¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 2. ä»ç´¢å¼ (city,name,age) åä¸ä¸ä¸ªè®°å½ï¼åæ ·ååºè¿ä¸ä¸ªå­æ®µçå¼ï¼ä½ä¸ºç»æéçä¸é¨åç´æ¥è¿åï¼\n 3. éå¤æ§è¡æ­¥éª¤ 2ï¼ç´å°æ¥å°ç¬¬ 1000 æ¡è®°å½ï¼æèæ¯ä¸æ»¡è¶³ city='æ­å·âæ¡ä»¶æ¶å¾ªç¯ç»æã\n\n\n# 4.5. åç¼ç´¢å¼\n\nææ¶åéè¦ç´¢å¼å¾é¿çå­ç¬¦åï¼è¿ä¼è®©ç´¢å¼åå¾å¤§ä¸æ¢ã\n\nè¿æ¶ï¼å¯ä»¥ä½¿ç¨åç¼ç´¢å¼ï¼å³åªç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ï¼ä»èæé«ç´¢å¼æçãä½è¿æ ·ä¹ä¼éä½ç´¢å¼çéæ©æ§ãå¯¹äº blob/text/varchar è¿ç§ææ¬ç±»åçåï¼å¿é¡»ä½¿ç¨åç¼ç´¢å¼ï¼å ä¸ºæ°æ®åºå¾å¾ä¸åè®¸ç´¢å¼è¿äºåçå®æ´é¿åº¦ã\n\nç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åæ°æ®è¡¨è®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ãå¦æå­å¨å¤æ¡å½ä¸­åç¼ç´¢å¼çæåµï¼å°±éè¦ä¾æ¬¡æ«æï¼ç´å°æç»æ¾å°æ­£ç¡®è®°å½ã\n\nä½¿ç¨åç¼ç´¢å¼ï¼å®ä¹å¥½é¿åº¦ï¼å°±å¯ä»¥åå°æ¢èçç©ºé´ï¼åä¸ç¨é¢å¤å¢å å¤ªå¤çæ¥è¯¢ææ¬ã\n\né£ä¹ï¼å¦ä½ç¡®å®åç¼ç´¢å¼åéçé¿åº¦å¢ï¼\n\nå¯ä»¥ä½¿ç¨ä¸é¢è¿ä¸ªè¯­å¥ï¼ç®åºè¿ä¸ªåä¸æå¤å°ä¸ªä¸åçå¼ï¼\n\nselect count(distinct email) as l from suser;\n\n\nç¶åï¼ä¾æ¬¡éåä¸åé¿åº¦çåç¼æ¥çè¿ä¸ªå¼ï¼æ¯å¦æä»¬è¦çä¸ä¸ 4~7 ä¸ªå­èçåç¼ç´¢å¼ï¼å¯ä»¥ç¨è¿ä¸ªè¯­å¥ï¼\n\nselect\n  count(distinct left(email,4)ï¼as l4,\n  count(distinct left(email,5)ï¼as l5,\n  count(distinct left(email,6)ï¼as l6,\n  count(distinct left(email,7)ï¼as l7,\nfrom suser;\n\n\nå½ç¶ï¼ä½¿ç¨åç¼ç´¢å¼å¾å¯è½ä¼æå¤±åºååº¦ï¼æä»¥ä½ éè¦é¢åè®¾å®ä¸ä¸ªå¯ä»¥æ¥åçæå¤±æ¯ä¾ï¼æ¯å¦ 5%ãç¶åï¼å¨è¿åç l4~l7 ä¸­ï¼æ¾åºä¸å°äº l * 95% çå¼ï¼åè®¾è¿é l6ãl7 é½æ»¡è¶³ï¼ä½ å°±å¯ä»¥éæ©åç¼é¿åº¦ä¸º 6ã\n\næ­¤å¤ï¼order by æ æ³ä½¿ç¨åç¼ç´¢å¼ï¼æ æ³æåç¼ç´¢å¼ç¨ä½è¦çç´¢å¼ã\n\n\n# 4.6. æå·¦åç¼å¹éåå\n\nä¸åªæ¯ç´¢å¼çå¨é¨å®ä¹ï¼åªè¦æ»¡è¶³æå·¦åç¼ï¼å°±å¯ä»¥å©ç¨ç´¢å¼æ¥å éæ£ç´¢ãè¿ä¸ªæå·¦åç¼å¯ä»¥æ¯èåç´¢å¼çæå·¦ n ä¸ªå­æ®µï¼ä¹å¯ä»¥æ¯å­ç¬¦ä¸²ç´¢å¼çæå·¦ m ä¸ªå­ç¬¦ã\n\nmysql ä¼ä¸ç´åå³å¹éç´å°éå°èå´æ¥è¯¢ (>,<,between,like) å°±åæ­¢å¹éã\n\n * ç´¢å¼å¯ä»¥ç®åå¦ä¸ä¸ªå(a)ï¼ä¹å¯ä»¥å¤æå¦å¤ä¸ªå(a, b, c, d)ï¼å³èåç´¢å¼ã\n * å¦ææ¯èåç´¢å¼ï¼é£ä¹ key ä¹ç±å¤ä¸ªåç»æï¼åæ¶ï¼ç´¢å¼åªè½ç¨äºæ¥æ¾ key æ¯å¦å­å¨ï¼ç¸ç­ï¼ï¼éå°èå´æ¥è¯¢(>ã<ãbetweenãlike å·¦å¹é)ç­å°±ä¸è½è¿ä¸æ­¥å¹éäºï¼åç»­éåä¸ºçº¿æ§æ¥æ¾ã\n * å æ­¤ï¼åçæåé¡ºåºå³å®äºå¯å½ä¸­ç´¢å¼çåæ°ã\n\nä¸è¦ä¸ºæ¯ä¸ªåé½åå»ºç¬ç«ç´¢å¼ã\n\nå°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååãä½ææ¶ï¼ä¹éè¦èè where å­å¥ä¸­çæåºãåç»åèå´æ¡ä»¶ç­å ç´ ï¼è¿äºå ç´ ä¹ä¼å¯¹æ¥è¯¢æ§è½é æè¾å¤§å½±åã\n\nä¾å¦ï¼a = 1 and b = 2 and c > 3 and d = 4ï¼å¦æå»ºç«ï¼a,b,c,dï¼é¡ºåºçç´¢å¼ï¼d æ¯ç¨ä¸å°ç´¢å¼çï¼å¦æå»ºç«(a,b,d,c)çç´¢å¼åé½å¯ä»¥ç¨å°ï¼a,b,d çé¡ºåºå¯ä»¥ä»»æè°æ´ã\n\nè®©éæ©æ§æå¼ºçç´¢å¼åæ¾å¨åé¢ï¼ç´¢å¼çéæ©æ§æ¯æï¼ä¸éå¤çç´¢å¼å¼åè®°å½æ»æ°çæ¯å¼ãæå¤§å¼ä¸º 1ï¼æ­¤æ¶æ¯ä¸ªè®°å½é½æå¯ä¸çç´¢å¼ä¸å¶å¯¹åºãéæ©æ§è¶é«ï¼æ¥è¯¢æçä¹è¶é«ã\n\nä¾å¦ä¸é¢æ¾ç¤ºçç»æä¸­ customer_id çéæ©æ§æ¯ staff_id æ´é«ï¼å æ­¤æå¥½æ customer_id åæ¾å¨å¤åç´¢å¼çåé¢ã\n\nselect count(distinct staff_id)/count(*) as staff_id_selectivity,\ncount(distinct customer_id)/count(*) as customer_id_selectivity,\ncount(*)\nfrom payment;\n\n\n   staff_id_selectivity: 0.0001\ncustomer_id_selectivity: 0.0373\n               count(*): 16049\n\n\n\n# 4.7. = å in å¯ä»¥ä¹±åº\n\nä¸éè¦èè =ãin ç­çé¡ºåºï¼mysql ä¼èªå¨ä¼åè¿äºæ¡ä»¶çé¡ºåºï¼ä»¥å¹éå°½å¯è½å¤çç´¢å¼åã\n\nãç¤ºä¾ãå¦æç´¢å¼ (a, b, c, d)ï¼æ¥è¯¢æ¡ä»¶ c > 3 and b = 2 and a = 1 and d < 4 ä¸ a = 1 and c > 3 and b = 2 and d < 4 ç­é¡ºåºé½æ¯å¯ä»¥çï¼mysql ä¼èªå¨ä¼åä¸º a = 1 and b = 2 and c > 3 and d < 4ï¼ä¾æ¬¡å½ä¸­ aãbãcãdã\n\n\n# 5. ç´¢å¼æä½³å®è·µ\n\nåå»ºäºç´¢å¼ï¼å¹¶éä¸å®ææãæ¯å¦ä¸æ»¡è¶³åç¼ç´¢å¼ãæå·¦åç¼å¹éååãæ¥è¯¢æ¡ä»¶æ¶åå½æ°è®¡ç®ç­æåµé½æ æ³ä½¿ç¨ç´¢å¼ãæ­¤å¤ï¼å³ä½¿ sql æ¬èº«ç¬¦åç´¢å¼çä½¿ç¨æ¡ä»¶ï¼mysql ä¹ä¼éè¿è¯ä¼°åç§æ¥è¯¢æ¹å¼çä»£ä»·ï¼æ¥å³å®æ¯å¦èµ°ç´¢å¼ï¼ä»¥åèµ°åªä¸ªç´¢å¼ã\n\nå æ­¤ï¼å¨å°è¯éè¿ç´¢å¼è¿è¡ sql æ§è½ä¼åçæ¶åï¼å¡å¿éè¿æ§è¡è®¡åï¼explainï¼æå®éçæææ¥ç¡®è®¤ç´¢å¼æ¯å¦è½æææ¹åæ§è½é®é¢ï¼å¦åå¢å äºç´¢å¼ä¸ä½æ²¡è§£å³æ§è½é®é¢ï¼è¿å¢å äºæ°æ®åºå¢å æ¹çè´æãå¦æå¯¹ explain ç»åºçæ§è¡è®¡åæçé®çè¯ï¼ä½ è¿å¯ä»¥å©ç¨ optimizer_trace æ¥çè¯¦ç»çæ§è¡è®¡ååè¿ä¸æ­¥åæã\n\n\n# 6. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * æ°æ®åºä¸¤å¤§ç¥å¨ãç´¢å¼åéã\n * mysql ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n * mysql å®æ 45 è®²",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql æ§è½ä¼å",frontmatter:{title:"Mysql æ§è½ä¼å",date:"2020-06-03T20:16:48.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","æ§è½"],permalink:"/pages/8c404f/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/06.Mysql%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/06.Mysqlæ§è½ä¼å.md",key:"v-63d8b17b",path:"/pages/8c404f/",headers:[{level:2,title:"1. æ°æ®ç»æä¼å",slug:"_1-æ°æ®ç»æä¼å",normalizedTitle:"1. æ°æ®ç»æä¼å",charIndex:17},{level:3,title:"1.1. æ°æ®ç±»åä¼å",slug:"_1-1-æ°æ®ç±»åä¼å",normalizedTitle:"1.1. æ°æ®ç±»åä¼å",charIndex:53},{level:4,title:"æ°æ®ç±»åä¼ååºæ¬åå",slug:"æ°æ®ç±»åä¼ååºæ¬åå",normalizedTitle:"æ°æ®ç±»åä¼ååºæ¬åå",charIndex:68},{level:4,title:"ç±»åçéæ©",slug:"ç±»åçéæ©",normalizedTitle:"ç±»åçéæ©",charIndex:341},{level:3,title:"1.2. è¡¨è®¾è®¡",slug:"_1-2-è¡¨è®¾è®¡",normalizedTitle:"1.2. è¡¨è®¾è®¡",charIndex:676},{level:3,title:"1.3. èå¼ååèå¼",slug:"_1-3-èå¼ååèå¼",normalizedTitle:"1.3. èå¼ååèå¼",charIndex:945},{level:3,title:"1.4. ç´¢å¼ä¼å",slug:"_1-4-ç´¢å¼ä¼å",normalizedTitle:"1.4. ç´¢å¼ä¼å",charIndex:1152},{level:4,title:"ä½æ¶ä½¿ç¨ç´¢å¼",slug:"ä½æ¶ä½¿ç¨ç´¢å¼",normalizedTitle:"ä½æ¶ä½¿ç¨ç´¢å¼",charIndex:1218},{level:4,title:"ç´¢å¼ä¼åç­ç¥",slug:"ç´¢å¼ä¼åç­ç¥",normalizedTitle:"ç´¢å¼ä¼åç­ç¥",charIndex:1356},{level:2,title:"2. SQL ä¼å",slug:"_2-sql-ä¼å",normalizedTitle:"2. sql ä¼å",charIndex:1720},{level:3,title:"2.1. ä¼å COUNT() æ¥è¯¢",slug:"_2-1-ä¼å-count-æ¥è¯¢",normalizedTitle:"2.1. ä¼å count() æ¥è¯¢",charIndex:1977},{level:3,title:"2.2. ä¼åå³èæ¥è¯¢",slug:"_2-2-ä¼åå³èæ¥è¯¢",normalizedTitle:"2.2. ä¼åå³èæ¥è¯¢",charIndex:2640},{level:3,title:"2.3. ä¼å GROUP BY å DISTINCT",slug:"_2-3-ä¼å-group-by-å-distinct",normalizedTitle:"2.3. ä¼å group by å distinct",charIndex:3770},{level:3,title:"2.4. ä¼å LIMIT",slug:"_2-4-ä¼å-limit",normalizedTitle:"2.4. ä¼å limit",charIndex:3857},{level:3,title:"2.5. ä¼å UNION",slug:"_2-5-ä¼å-union",normalizedTitle:"2.5. ä¼å union",charIndex:4670},{level:3,title:"2.6. ä¼åæ¥è¯¢æ¹å¼",slug:"_2-6-ä¼åæ¥è¯¢æ¹å¼",normalizedTitle:"2.6. ä¼åæ¥è¯¢æ¹å¼",charIndex:4993},{level:4,title:"ååå¤§æ¥è¯¢",slug:"ååå¤§æ¥è¯¢",normalizedTitle:"ååå¤§æ¥è¯¢",charIndex:5008},{level:4,title:"åè§£å¤§è¿æ¥æ¥è¯¢",slug:"åè§£å¤§è¿æ¥æ¥è¯¢",normalizedTitle:"åè§£å¤§è¿æ¥æ¥è¯¢",charIndex:5318},{level:2,title:"3. æ§è¡è®¡åï¼EXPLAINï¼",slug:"_3-æ§è¡è®¡å-explain",normalizedTitle:"3. æ§è¡è®¡åï¼explainï¼",charIndex:5914},{level:2,title:"4. optimizer trace",slug:"_4-optimizer-trace",normalizedTitle:"4. optimizer trace",charIndex:7464},{level:2,title:"5. æ°æ®æ¨¡ååä¸å¡",slug:"_5-æ°æ®æ¨¡ååä¸å¡",normalizedTitle:"5. æ°æ®æ¨¡ååä¸å¡",charIndex:7921},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:8177}],headersStr:"1. æ°æ®ç»æä¼å 1.1. æ°æ®ç±»åä¼å æ°æ®ç±»åä¼ååºæ¬åå ç±»åçéæ© 1.2. è¡¨è®¾è®¡ 1.3. èå¼ååèå¼ 1.4. ç´¢å¼ä¼å ä½æ¶ä½¿ç¨ç´¢å¼ ç´¢å¼ä¼åç­ç¥ 2. SQL ä¼å 2.1. ä¼å COUNT() æ¥è¯¢ 2.2. ä¼åå³èæ¥è¯¢ 2.3. ä¼å GROUP BY å DISTINCT 2.4. ä¼å LIMIT 2.5. ä¼å UNION 2.6. ä¼åæ¥è¯¢æ¹å¼ ååå¤§æ¥è¯¢ åè§£å¤§è¿æ¥æ¥è¯¢ 3. æ§è¡è®¡åï¼EXPLAINï¼ 4. optimizer trace 5. æ°æ®æ¨¡ååä¸å¡ 6. åèèµæ",content:"# Mysql æ§è½ä¼å\n\n\n# 1. æ°æ®ç»æä¼å\n\nè¯å¥½çé»è¾è®¾è®¡åç©çè®¾è®¡æ¯é«æ§è½çåºç³ã\n\n\n# 1.1. æ°æ®ç±»åä¼å\n\n# æ°æ®ç±»åä¼ååºæ¬åå\n\n * æ´å°çéå¸¸æ´å¥½ - è¶å°çæ°æ®ç±»åéå¸¸ä¼æ´å¿«ï¼å ç¨æ´å°çç£çãåå­ï¼å¤çæ¶éè¦ç CPU å¨æä¹æ´å°ã\n   * ä¾å¦ï¼æ´åæ¯å­ç¬¦ç±»åæä½ä»£ä»·ä½ï¼å èä¼ä½¿ç¨æ´åæ¥å­å¨ IP å°åï¼ä½¿ç¨ DATETIME æ¥å­å¨æ¶é´ï¼èä¸æ¯ä½¿ç¨å­ç¬¦ä¸²ã\n * ç®åå°±å¥½ - å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½ã\n   * ä¾å¦ï¼å¾å¤è½¯ä»¶ä¼ç¨æ´åæ¥å­å¨ IP å°åã\n   * ä¾å¦ï¼UNSIGNED è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n * å°½éé¿å NULL - å¯ä¸º NULL çåä¼ä½¿å¾ç´¢å¼ãç´¢å¼ç»è®¡åå¼æ¯è¾é½æ´å¤æã\n\n# ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ AUTO_INCREMENTã\n\n * ENUM å SET ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº MD5ãSHAãUUID è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ INSERT ä»¥åä¸äº SELECT è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ UUID ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ UNHEX() å½æ°è½¬æ¢ UUID å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª BINARY(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ HEX() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# 1.2. è¡¨è®¾è®¡\n\nåºè¯¥é¿åçè®¾è®¡é®é¢ï¼\n\n * å¤ªå¤çå - è®¾è®¡èä¸ºäºå¾æ¹ä¾¿ï¼å°å¤§éåä½åå å¥è¡¨ä¸­ï¼å®éæ¥è¯¢ä¸­ï¼è¡¨ä¸­å¾å¤åæ¯ç¨ä¸å°çãè¿ç§å®½è¡¨æ¨¡å¼è®¾è®¡ï¼ä¼é æä¸å°çæ§è½ä»£ä»·ï¼å°¤å¶æ¯ ALTER TABLE éå¸¸èæ¶ã\n * å¤ªå¤çå³è - æè°çå®ä½ - å±æ§ - å¼ï¼EVAï¼è®¾è®¡æ¨¡å¼æ¯ä¸ä¸ªå¸¸è§çç³ç³è®¾è®¡æ¨¡å¼ãMysql éå¶äºæ¯ä¸ªå³èæä½æå¤åªè½æ 61 å¼ è¡¨ï¼ä½ EVA æ¨¡å¼éè¦è®¸å¤èªå³èã\n * æä¸¾ - å°½éä¸è¦ç¨æä¸¾ï¼å ä¸ºæ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨ ALTER TABLEã\n * å°½éé¿å NULL\n\n\n# 1.3. èå¼ååèå¼\n\nèå¼åç®æ æ¯å°½éåå°åä½ï¼èåèå¼ååç¸åã\n\nèå¼åçä¼ç¹ï¼\n\n * æ¯åèå¼æ´èçç©ºé´\n * æ´æ°æä½æ¯åèå¼å¿«\n * æ´å°éè¦ DISTINCT æ GROUP BY è¯­å¥\n\nèå¼åçç¼ºç¹ï¼\n\n * éå¸¸éè¦å³èæ¥è¯¢ãèå³èæ¥è¯¢ä»£ä»·è¾é«ï¼å¦ææ¯åè¡¨çå³èæ¥è¯¢ï¼ä»£ä»·æ´æ¯é«æã\n\nå¨çå®ä¸çä¸­ï¼å¾å°ä¼æç«¯å°ä½¿ç¨èå¼åæåèå¼åãå®éä¸ï¼åºè¯¥æè¡¡èå¼ååèå¼çå©å¼ï¼æ··åä½¿ç¨ã\n\n\n# 1.4. ç´¢å¼ä¼å\n\n> ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n> \n> å¦ææ³è¯¦ç»äºè§£ç´¢å¼ç¹æ§è¯·åèï¼Mysql ç´¢å¼\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\n * å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * å¯¹äºä¸­ãå¤§åè¡¨ï¼ç´¢å¼éå¸¸ææã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯ã\n * å¦æè¡¨çæ°éç¹å«å¤ï¼å¯ä»¥å»ºç«ä¸ä¸ªåæ°æ®ä¿¡æ¯è¡¨ï¼ç¨æ¥æ¥è¯¢éè¦ç¨å°çæäºç¹æ§ã\n\n# ç´¢å¼ä¼åç­ç¥\n\n * ç´¢å¼åºæ¬åå\n   * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n   * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n   * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n   * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n   * é¢ç¹ä½ä¸º WHERE è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n * ç¬ç«çå - âç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n * åç¼ç´¢å¼ - ç´¢å¼å¾é¿çå­ç¬¦åï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ã\n * æå·¦å¹éåå - å°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååã\n * ä½¿ç¨ç´¢å¼æ¥æåº - ç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n * =ãIN å¯ä»¥ä¹±åº - ä¸éè¦èè =ãIN ç­çé¡ºåº\n * è¦çç´¢å¼\n * èªå¢å­æ®µä½ä¸»é®\n\n\n# 2. SQL ä¼å\n\nä½¿ç¨ EXPLAIN å½ä»¤æ¥çå½å SQL æ¯å¦ä½¿ç¨äºç´¢å¼ï¼ä¼ååï¼åéè¿æ§è¡è®¡åï¼EXPLAINï¼æ¥æ¥çä¼åææã\n\nSQL ä¼ååºæ¬æè·¯ï¼\n\n * åªè¿åå¿è¦çå - æå¥½ä¸è¦ä½¿ç¨ SELECT * è¯­å¥ã\n\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ WHERE å­æ¥è¯¢è¯­å¥è¿è¡è¿æ»¤æ¥è¯¢ï¼ææ¶åä¹éè¦ä½¿ç¨ LIMIT è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - åºè¯¥èèå¨å®¢æ·ç«¯ä½¿ç¨ç¼å­ï¼å°½éä¸è¦ä½¿ç¨ Mysql æå¡å¨ç¼å­ï¼å­å¨è¾å¤é®é¢åéå¶ï¼ã\n\n * ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢\n\n\n# 2.1. ä¼å COUNT() æ¥è¯¢\n\nCOUNT() æä¸¤ç§ä½ç¨ï¼\n\n * ç»è®¡æä¸ªåå¼çæ°éãç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯é NULL çï¼å®ä¸ä¼ç»è®¡ NULLã\n * ç»è®¡è¡æ°ã\n\nç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯éç©ºçï¼å®ä¸ä¼ç»è®¡ NULLãå¦æç¡®è®¤æ¬å·ä¸­çè¡¨è¾¾å¼ä¸å¯è½ä¸ºç©ºæ¶ï¼å®éä¸å°±æ¯å¨ç»è®¡è¡æ°ãæç®åçå°±æ¯å½ä½¿ç¨ COUNT(*) æ¶ï¼å¹¶ä¸æ¯æä»¬ææ³è±¡çé£æ ·æ©å±æææçåï¼å®éä¸ï¼å®ä¼å¿½ç¥ææçåèç´æ¥ç»è®¡è¡æ°ã\n\næä»¬æå¸¸è§çè¯¯è§£ä¹å°±å¨è¿å¿ï¼å¨æ¬å·åæå®äºä¸åå´å¸æç»è®¡ç»ææ¯è¡æ°ï¼èä¸è¿å¸¸å¸¸è¯¯ä»¥ä¸ºåèçæ§è½ä¼æ´å¥½ãä½å®éå¹¶éè¿æ ·ï¼å¦æè¦ç»è®¡è¡æ°ï¼ç´æ¥ä½¿ç¨ COUNT(*)ï¼æä¹æ¸æ°ï¼ä¸æ§è½æ´å¥½ã\n\nï¼1ï¼ç®åä¼å\n\nSELECT count(*) FROM world.city WHERE id > 5;\n\nSELECT (SELECT count(*) FROM world.city) - count(*)\nFROM world.city WHERE id <= 5;\n\n\nï¼2ï¼ä½¿ç¨è¿ä¼¼å¼\n\nææ¶åæäºä¸å¡åºæ¯å¹¶ä¸éè¦å®å¨ç²¾ç¡®çç»è®¡å¼ï¼å¯ä»¥ç¨è¿ä¼¼å¼æ¥ä»£æ¿ï¼EXPLAIN åºæ¥çè¡æ°å°±æ¯ä¸ä¸ªä¸éçè¿ä¼¼å¼ï¼èä¸æ§è¡ EXPLAIN å¹¶ä¸éè¦çæ­£å°å»æ§è¡æ¥è¯¢ï¼æä»¥ææ¬éå¸¸ä½ãéå¸¸æ¥è¯´ï¼æ§è¡ COUNT() é½éè¦æ«æå¤§éçè¡æè½è·åå°ç²¾ç¡®çæ°æ®ï¼å æ­¤å¾é¾ä¼åï¼MySQL å±é¢è¿è½åå¾ä¹å°±åªæè¦çç´¢å¼äºãå¦æä¸è¿è½è§£å³é®é¢ï¼åªæä»æ¶æå±é¢è§£å³äºï¼æ¯å¦æ·»å æ±æ»è¡¨ï¼æèä½¿ç¨ Redis è¿æ ·çå¤é¨ç¼å­ç³»ç»ã\n\n\n# 2.2. ä¼åå³èæ¥è¯¢\n\nå¨å¤§æ°æ®åºæ¯ä¸ï¼è¡¨ä¸è¡¨ä¹é´éè¿ä¸ä¸ªåä½å­æ®µæ¥å³èï¼è¦æ¯ç´æ¥ä½¿ç¨ JOIN ææ´å¥½çæ§è½ã\n\nå¦æç¡®å®éè¦ä½¿ç¨å³èæ¥è¯¢çæåµä¸ï¼éè¦ç¹å«æ³¨æçæ¯ï¼\n\n * ç¡®ä¿ ON å USING å­å¥ä¸­çåä¸æç´¢å¼ãå¨åå»ºç´¢å¼çæ¶åå°±è¦èèå°å³èçé¡ºåºãå½è¡¨ A åè¡¨ B ç¨æå column å³èçæ¶åï¼å¦æä¼åå¨å³èçé¡ºåºæ¯ AãBï¼é£ä¹å°±ä¸éè¦å¨ A è¡¨çå¯¹åºåä¸åå»ºç´¢å¼ãæ²¡æç¨å°çç´¢å¼ä¼å¸¦æ¥é¢å¤çè´æï¼ä¸è¬æ¥è¯´ï¼é¤éæå¶ä»çç±ï¼åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼ï¼å·ä½åå ä¸æåæï¼ã\n * ç¡®ä¿ä»»ä½ç GROUP BY å ORDER BY ä¸­çè¡¨è¾¾å¼åªæ¶åå°ä¸ä¸ªè¡¨ä¸­çåï¼è¿æ · MySQL ææå¯è½ä½¿ç¨ç´¢å¼æ¥ä¼åã\n\nè¦çè§£ä¼åå³èæ¥è¯¢çç¬¬ä¸ä¸ªæå·§ï¼å°±éè¦çè§£ MySQL æ¯å¦ä½æ§è¡å³èæ¥è¯¢çãå½å MySQL å³èæ§è¡çç­ç¥éå¸¸ç®åï¼å®å¯¹ä»»ä½çå³èé½æ§è¡åµå¥å¾ªç¯å³èæä½ï¼å³åå¨ä¸ä¸ªè¡¨ä¸­å¾ªç¯ååºåæ¡æ°æ®ï¼ç¶åå¨åµå¥å¾ªç¯å°ä¸ä¸ä¸ªè¡¨ä¸­å¯»æ¾å¹éçè¡ï¼ä¾æ¬¡ä¸å»ï¼ç´å°æ¾å°ææè¡¨ä¸­å¹éçè¡ä¸ºä¸ºæ­¢ãç¶åæ ¹æ®åä¸ªè¡¨å¹éçè¡ï¼è¿åæ¥è¯¢ä¸­éè¦çåä¸ªåã\n\nå¤ªæ½è±¡äºï¼ä»¥ä¸é¢çç¤ºä¾æ¥è¯´æï¼æ¯å¦æè¿æ ·çä¸ä¸ªæ¥è¯¢ï¼\n\nSELECT A.xx,B.yy\nFROM A INNER JOIN B USING(c)\nWHERE A.xx IN (5,6)\n\n\nåè®¾ MySQL æç§æ¥è¯¢ä¸­çå³èé¡ºåº AãB æ¥è¿è¡å³èæä½ï¼é£ä¹å¯ä»¥ç¨ä¸é¢çä¼ªä»£ç è¡¨ç¤º MySQL å¦ä½å®æè¿ä¸ªæ¥è¯¢ï¼\n\nouter_iterator = SELECT A.xx,A.c FROM A WHERE A.xx IN (5,6);\nouter_row = outer_iterator.next;\nwhile(outer_row) {\n    inner_iterator = SELECT B.yy FROM B WHERE B.c = outer_row.c;\n    inner_row = inner_iterator.next;\n    while(inner_row) {\n        output[inner_row.yy,outer_row.xx];\n        inner_row = inner_iterator.next;\n    }\n    outer_row = outer_iterator.next;\n}\n\n\nå¯ä»¥çå°ï¼æå¤å±çæ¥è¯¢æ¯æ ¹æ®A.xxåæ¥æ¥è¯¢çï¼A.cä¸å¦ææç´¢å¼çè¯ï¼æ´ä¸ªå³èæ¥è¯¢ä¹ä¸ä¼ä½¿ç¨ãåçåå±çæ¥è¯¢ï¼å¾ææ¾B.cä¸å¦ææç´¢å¼çè¯ï¼è½å¤å éæ¥è¯¢ï¼å æ­¤åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼å³å¯ã\n\n\n# 2.3. ä¼å GROUP BY å DISTINCT\n\nMysql ä¼åå¨ä¼å¨åé¨å¤ççæ¶åç¸äºè½¬åè¿ä¸¤ç±»æ¥è¯¢ãå®ä»¬é½å¯ä»¥ä½¿ç¨ç´¢å¼æ¥ä¼åï¼è¿ä¹æ¯æææçä¼åæ¹æ³ã\n\n\n# 2.4. ä¼å LIMIT\n\nå½éè¦åé¡µæä½æ¶ï¼éå¸¸ä¼ä½¿ç¨ LIMIT å ä¸åç§»éçåæ³å®ç°ï¼åæ¶å ä¸åéç ORDER BY å­å¥ãå¦ææå¯¹åºçç´¢å¼ï¼éå¸¸æçä¼ä¸éï¼å¦åï¼MySQL éè¦åå¤§éçæä»¶æåºæä½ã\n\nä¸ä¸ªå¸¸è§çé®é¢æ¯å½åç§»ééå¸¸å¤§çæ¶åï¼æ¯å¦ï¼LIMIT 10000 20è¿æ ·çæ¥è¯¢ï¼MySQL éè¦æ¥è¯¢ 10020 æ¡è®°å½ç¶ååªè¿å 20 æ¡è®°å½ï¼åé¢ç 10000 æ¡é½å°è¢«æå¼ï¼è¿æ ·çä»£ä»·éå¸¸é«ã\n\nä¼åè¿ç§æ¥è¯¢ä¸ä¸ªæç®åçåæ³å°±æ¯å°½å¯è½çä½¿ç¨è¦çç´¢å¼æ«æï¼èä¸æ¯æ¥è¯¢ææçåãç¶åæ ¹æ®éè¦åä¸æ¬¡å³èæ¥è¯¢åè¿åææçåãå¯¹äºåç§»éå¾å¤§æ¶ï¼è¿æ ·åçæçä¼æåéå¸¸å¤§ãèèä¸é¢çæ¥è¯¢ï¼\n\nSELECT film_id,description FROM film ORDER BY title LIMIT 50,5;\n\n\nå¦æè¿å¼ è¡¨éå¸¸å¤§ï¼é£ä¹è¿ä¸ªæ¥è¯¢æå¥½æ¹æä¸é¢çæ ·å­ï¼\n\nSELECT film.film_id,film.description\nFROM film INNER JOIN (\n    SELECT film_id FROM film ORDER BY title LIMIT 50,5\n) AS tmp USING(film_id);\n\n\nè¿éçå»¶è¿å³èå°å¤§å¤§æåæ¥è¯¢æçï¼è®© MySQL æ«æå°½å¯è½å°çé¡µé¢ï¼è·åéè¦è®¿é®çè®°å½åå¨æ ¹æ®å³èåååè¡¨æ¥è¯¢æéè¦çåã\n\nææ¶åå¦æå¯ä»¥ä½¿ç¨ä¹¦ç­¾è®°å½ä¸æ¬¡åæ°æ®çä½ç½®ï¼é£ä¹ä¸æ¬¡å°±å¯ä»¥ç´æ¥ä»è¯¥ä¹¦ç­¾è®°å½çä½ç½®å¼å§æ«æï¼è¿æ ·å°±å¯ä»¥é¿åä½¿ç¨OFFSETï¼æ¯å¦ä¸é¢çæ¥è¯¢ï¼\n\nSELECT id FROM t LIMIT 10000, 10;\næ¹ä¸ºï¼\nSELECT id FROM t WHERE id > 10000 LIMIT 10;\n\n\nå¶ä»ä¼åçåæ³è¿åæ¬ä½¿ç¨é¢åè®¡ç®çæ±æ»è¡¨ï¼æèå³èå°ä¸ä¸ªåä½è¡¨ï¼åä½è¡¨ä¸­åªåå«ä¸»é®ååéè¦åæåºçåã\n\n\n# 2.5. ä¼å UNION\n\nMySQL æ»æ¯éè¿åå»ºå¹¶å¡«åä¸´æ¶è¡¨çæ¹å¼æ¥æ§è¡ UNION æ¥è¯¢ãå æ­¤å¾å¤ä¼åç­ç¥å¨UNIONæ¥è¯¢ä¸­é½æ²¡æåæ³å¾å¥½çæ¶åãç»å¸¸éè¦æå¨å°WHEREãLIMITãORDER BYç­å­å¥âä¸æ¨âå°åä¸ªå­æ¥è¯¢ä¸­ï¼ä»¥ä¾¿ä¼åå¨å¯ä»¥ååå©ç¨è¿äºæ¡ä»¶åä¼åã\n\né¤éç¡®å®éè¦æå¡å¨å»éï¼å¦åå°±ä¸å®è¦ä½¿ç¨UNION ALLï¼å¦ææ²¡æALLå³é®å­ï¼MySQL ä¼ç»ä¸´æ¶è¡¨å ä¸DISTINCTéé¡¹ï¼è¿ä¼å¯¼è´æ´ä¸ªä¸´æ¶è¡¨çæ°æ®åå¯ä¸æ§æ£æ¥ï¼è¿æ ·åçä»£ä»·éå¸¸é«ãå½ç¶å³ä½¿ä½¿ç¨ ALL å³é®å­ï¼MySQL æ»æ¯å°ç»ææ¾å¥ä¸´æ¶è¡¨ï¼ç¶ååè¯»åºï¼åè¿åç»å®¢æ·ç«¯ãè½ç¶å¾å¤æ¶åæ²¡æè¿ä¸ªå¿è¦ï¼æ¯å¦ææ¶åå¯ä»¥ç´æ¥ææ¯ä¸ªå­æ¥è¯¢çç»æè¿åç»å®¢æ·ç«¯ã\n\n\n# 2.6. ä¼åæ¥è¯¢æ¹å¼\n\n# ååå¤§æ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\nDELEFT FROM messages WHERE create < DATE_SUB(NOW(), INTERVAL 3 MONTH);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"DELETE FROM messages WHERE create  < DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000\")\n} while rows_affected > 0\n\n\n# åè§£å¤§è¿æ¥æ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼JOINï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * è®©ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ IN() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© MySQL æç§ ID é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nSELECT * FROM tag\nJOIN tag_post ON tag_post.tag_id=tag.id\nJOIN post ON tag_post.post_id=post.id\nWHERE tag.tag='mysql';\n\n\nSELECT * FROM tag WHERE tag='mysql';\nSELECT * FROM tag_post WHERE tag_id=1234;\nSELECT * FROM post WHERE post.id IN (123,456,567,9098,8904);\n\n\n\n# 3. æ§è¡è®¡åï¼EXPLAINï¼\n\nå¦ä½å¤æ­å½å SQL æ¯å¦ä½¿ç¨äºç´¢å¼ï¼å¦ä½æ£éªä¿®æ¹åç SQL ç¡®å®æä¼åææï¼\n\nå¨ SQL ä¸­ï¼å¯ä»¥éè¿æ§è¡è®¡åï¼EXPLAINï¼åæ SELECT æ¥è¯¢æçã\n\nmysql> explain select * from user_info where id = 2\\G\n*************************** 1. row ***************************\n           id: 1\n  select_type: SIMPLE\n        table: user_info\n   partitions: NULL\n         type: const\npossible_keys: PRIMARY\n          key: PRIMARY\n      key_len: 8\n          ref: const\n         rows: 1\n     filtered: 100.00\n        Extra: NULL\n1 row in set, 1 warning (0.00 sec)\n\n\nEXPLAIN åæ°è¯´æï¼\n\n * id: SELECT æ¥è¯¢çæ è¯ç¬¦. æ¯ä¸ª SELECT é½ä¼èªå¨åéä¸ä¸ªå¯ä¸çæ è¯ç¬¦.\n * select_type â­ ï¼SELECT æ¥è¯¢çç±»å.\n   * SIMPLEï¼è¡¨ç¤ºæ­¤æ¥è¯¢ä¸åå« UNION æ¥è¯¢æå­æ¥è¯¢\n   * PRIMARYï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯æå¤å±çæ¥è¯¢\n   * UNIONï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯ UNION çç¬¬äºæéåçæ¥è¯¢\n   * DEPENDENT UNIONï¼UNION ä¸­çç¬¬äºä¸ªæåé¢çæ¥è¯¢è¯­å¥, åå³äºå¤é¢çæ¥è¯¢\n   * UNION RESULTï¼UNION çç»æ\n   * SUBQUERYï¼å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª SELECT\n   * DEPENDENT SUBQUERY: å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª SELECT, åå³äºå¤é¢çæ¥è¯¢. å³å­æ¥è¯¢ä¾èµäºå¤å±æ¥è¯¢çç»æ.\n * table: æ¥è¯¢çæ¯åªä¸ªè¡¨ï¼å¦æç»è¡¨èµ·å«åäºï¼åæ¾ç¤ºå«åã\n * partitionsï¼å¹éçååº\n * type â­ï¼è¡¨ç¤ºä»è¡¨ä¸­æ¥è¯¢å°è¡ææ§è¡çæ¹å¼ï¼æ¥è¯¢æ¹å¼æ¯ SQL ä¼åä¸­ä¸ä¸ªå¾éè¦çææ ï¼ç»æå¼ä»å¥½å°å·®ä¾æ¬¡æ¯ï¼system > const > eq_ref > ref > range > index > ALLã\n   * system/constï¼è¡¨ä¸­åªæä¸è¡æ°æ®å¹éï¼æ­¤æ¶æ ¹æ®ç´¢å¼æ¥è¯¢ä¸æ¬¡å°±è½æ¾å°å¯¹åºçæ°æ®ãå¦ææ¯ B + æ ç´¢å¼ï¼æä»¬ç¥éæ­¤æ¶ç´¢å¼æé æäºå¤ä¸ªå±çº§çæ ï¼å½æ¥è¯¢çç´¢å¼å¨æ çåºå±æ¶ï¼æ¥è¯¢æçå°±è¶ä½ãconst è¡¨ç¤ºæ­¤æ¶ç´¢å¼å¨ç¬¬ä¸å±ï¼åªéè®¿é®ä¸å±ä¾¿è½å¾å°æ°æ®ã\n   * eq_refï¼ä½¿ç¨å¯ä¸ç´¢å¼æ«æï¼å¸¸è§äºå¤è¡¨è¿æ¥ä¸­ä½¿ç¨ä¸»é®åå¯ä¸ç´¢å¼ä½ä¸ºå³èæ¡ä»¶ã\n   * refï¼éå¯ä¸ç´¢å¼æ«æï¼è¿å¯è§äºå¯ä¸ç´¢å¼æå·¦ååå¹éæ«æã\n   * rangeï¼ç´¢å¼èå´æ«æï¼æ¯å¦ï¼<ï¼>ï¼between ç­æä½ã\n   * indexï¼ç´¢å¼å¨è¡¨æ«æï¼æ­¤æ¶éåæ´ä¸ªç´¢å¼æ ã\n   * ALLï¼è¡¨ç¤ºå¨è¡¨æ«æï¼éè¦éåå¨è¡¨æ¥æ¾å°å¯¹åºçè¡ã\n * possible_keysï¼æ­¤æ¬¡æ¥è¯¢ä¸­å¯è½éç¨çç´¢å¼ã\n * key â­ï¼æ­¤æ¬¡æ¥è¯¢ä¸­å®éä½¿ç¨çç´¢å¼ã\n * refï¼åªä¸ªå­æ®µæå¸¸æ°ä¸ key ä¸èµ·è¢«ä½¿ç¨ã\n * rows â­ï¼æ¾ç¤ºæ­¤æ¥è¯¢ä¸å±æ«æäºå¤å°è¡ï¼è¿ä¸ªæ¯ä¸ä¸ªä¼°è®¡å¼ã\n * filteredï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¡ä»¶æè¿æ»¤çæ°æ®çç¾åæ¯ã\n * extraï¼é¢å¤çä¿¡æ¯ã\n\n> æ´å¤åå®¹è¯·åèï¼MySQL æ§è½ä¼åç¥å¨ Explain ä½¿ç¨åæ\n\n\n# 4. optimizer trace\n\nå¨ MySQL 5.6 åä¹åççæ¬ä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ optimizer trace åè½æ¥çä¼åå¨çææ§è¡è®¡åçæ´ä¸ªè¿ç¨ãæäºè¿ä¸ªåè½ï¼æä»¬ä¸ä»å¯ä»¥äºè§£ä¼åå¨çéæ©è¿ç¨ï¼æ´å¯ä»¥äºè§£æ¯ä¸ä¸ªæ§è¡ç¯èçææ¬ï¼ç¶åä¾é è¿äºä¿¡æ¯è¿ä¸æ­¥ä¼åæ¥è¯¢ã\n\nå¦ä¸ä»£ç æç¤ºï¼æå¼ optimizer_trace åï¼åæ§è¡ SQL å°±å¯ä»¥æ¥è¯¢ information_schema.OPTIMIZER_TRACE è¡¨æ¥çæ§è¡è®¡åäºï¼æåå¯ä»¥å³é­ optimizer_trace åè½ï¼\n\nSET optimizer_trace=\"enabled=on\";\nSELECT * FROM person WHERE NAME >'name84059' AND create_time>'2020-01-24 05:00\nSELECT * FROM information_schema.OPTIMIZER_TRACE;\nSET optimizer_trace=\"enabled=off\";\n\n\n\n# 5. æ°æ®æ¨¡ååä¸å¡\n\n * è¡¨å­æ®µæ¯è¾å¤æãæåå¨ãç»æé¾ä»¥ç»ä¸çæåµä¸ï¼å¯ä»¥èèä½¿ç¨ Nosql æ¥ä»£æ¿å³ç³»æ°æ®åºè¡¨å­å¨ï¼å¦ ElasticSearchãMongoDBã\n * å¨é«å¹¶åæåµä¸çæ¥è¯¢æä½ï¼å¯ä»¥ä½¿ç¨ç¼å­ï¼å¦ Redisï¼ä»£æ¿æ°æ®åºæä½ï¼æé«å¹¶åæ§è½ã\n * æ°æ®éå¢é¿è¾å¿«çè¡¨ï¼éè¦èèæ°´å¹³åè¡¨æååºï¼é¿ååè¡¨æä½çæ§è½ç¶é¢ã\n * é¤æ­¤ä¹å¤ï¼æä»¬åºè¯¥éè¿ä¸äºä¼åï¼å°½éé¿åæ¯è¾å¤æç JOIN æ¥è¯¢æä½ï¼ä¾å¦åä½ä¸äºå­æ®µï¼åå° JOIN æ¥è¯¢ï¼åå»ºä¸äºä¸­é´è¡¨ï¼åå° JOIN æ¥è¯¢ã\n\n\n# 6. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * ãJava æ§è½è°ä¼å®æã\n * æå¿é¡»å¾åè¯å¤§å®¶ç MySQL ä¼ååç\n * 20+ æ¡ MySQL æ§è½ä¼åçæä½³ç»éª\n * MySQL æ§è½ä¼åç¥å¨ Explain ä½¿ç¨åæ",normalizedContent:"# mysql æ§è½ä¼å\n\n\n# 1. æ°æ®ç»æä¼å\n\nè¯å¥½çé»è¾è®¾è®¡åç©çè®¾è®¡æ¯é«æ§è½çåºç³ã\n\n\n# 1.1. æ°æ®ç±»åä¼å\n\n# æ°æ®ç±»åä¼ååºæ¬åå\n\n * æ´å°çéå¸¸æ´å¥½ - è¶å°çæ°æ®ç±»åéå¸¸ä¼æ´å¿«ï¼å ç¨æ´å°çç£çãåå­ï¼å¤çæ¶éè¦ç cpu å¨æä¹æ´å°ã\n   * ä¾å¦ï¼æ´åæ¯å­ç¬¦ç±»åæä½ä»£ä»·ä½ï¼å èä¼ä½¿ç¨æ´åæ¥å­å¨ ip å°åï¼ä½¿ç¨ datetime æ¥å­å¨æ¶é´ï¼èä¸æ¯ä½¿ç¨å­ç¬¦ä¸²ã\n * ç®åå°±å¥½ - å¦æ´åæ¯å­ç¬¦åæä½ä»£ä»·ä½ã\n   * ä¾å¦ï¼å¾å¤è½¯ä»¶ä¼ç¨æ´åæ¥å­å¨ ip å°åã\n   * ä¾å¦ï¼unsigned è¡¨ç¤ºä¸åè®¸è´å¼ï¼å¤§è´å¯ä»¥ä½¿æ­£æ°çä¸éæé«ä¸åã\n * å°½éé¿å null - å¯ä¸º null çåä¼ä½¿å¾ç´¢å¼ãç´¢å¼ç»è®¡åå¼æ¯è¾é½æ´å¤æã\n\n# ç±»åçéæ©\n\n * æ´æ°ç±»åéå¸¸æ¯æ è¯åæå¥½çéæ©ï¼å ä¸ºå®ä»¬å¾å¿«å¹¶ä¸å¯ä»¥ä½¿ç¨ auto_incrementã\n\n * enum å set ç±»åéå¸¸æ¯ä¸ä¸ªç³ç³çéæ©ï¼åºå°½éé¿åã\n\n * åºè¯¥å°½éé¿åç¨å­ç¬¦ä¸²ç±»åä½ä¸ºæ è¯åï¼å ä¸ºå®ä»¬å¾æ¶èç©ºé´ï¼å¹¶ä¸éå¸¸æ¯æ°å­ç±»åæ¢ãå¯¹äº md5ãshaãuuid è¿ç±»éæºå­ç¬¦ä¸²ï¼ç±äºæ¯è¾éæºï¼æä»¥å¯è½åå¸å¨å¾å¤§çç©ºé´åï¼å¯¼è´ insert ä»¥åä¸äº select è¯­å¥åå¾å¾æ¢ã\n   \n   * å¦æå­å¨ uuid ï¼åºè¯¥ç§»é¤ - ç¬¦å·ï¼æ´å¥½çåæ³æ¯ï¼ç¨ unhex() å½æ°è½¬æ¢ uuid å¼ä¸º 16 å­èçæ°å­ï¼å¹¶å­å¨å¨ä¸ä¸ª binary(16) çåä¸­ï¼æ£ç´¢æ¶ï¼å¯ä»¥éè¿ hex() å½æ°æ¥æ ¼å¼åä¸º 16 è¿å¶æ ¼å¼ã\n\n\n# 1.2. è¡¨è®¾è®¡\n\nåºè¯¥é¿åçè®¾è®¡é®é¢ï¼\n\n * å¤ªå¤çå - è®¾è®¡èä¸ºäºå¾æ¹ä¾¿ï¼å°å¤§éåä½åå å¥è¡¨ä¸­ï¼å®éæ¥è¯¢ä¸­ï¼è¡¨ä¸­å¾å¤åæ¯ç¨ä¸å°çãè¿ç§å®½è¡¨æ¨¡å¼è®¾è®¡ï¼ä¼é æä¸å°çæ§è½ä»£ä»·ï¼å°¤å¶æ¯ alter table éå¸¸èæ¶ã\n * å¤ªå¤çå³è - æè°çå®ä½ - å±æ§ - å¼ï¼evaï¼è®¾è®¡æ¨¡å¼æ¯ä¸ä¸ªå¸¸è§çç³ç³è®¾è®¡æ¨¡å¼ãmysql éå¶äºæ¯ä¸ªå³èæä½æå¤åªè½æ 61 å¼ è¡¨ï¼ä½ eva æ¨¡å¼éè¦è®¸å¤èªå³èã\n * æä¸¾ - å°½éä¸è¦ç¨æä¸¾ï¼å ä¸ºæ·»å åå é¤å­ç¬¦ä¸²ï¼æä¸¾éé¡¹ï¼å¿é¡»ä½¿ç¨ alter tableã\n * å°½éé¿å null\n\n\n# 1.3. èå¼ååèå¼\n\nèå¼åç®æ æ¯å°½éåå°åä½ï¼èåèå¼ååç¸åã\n\nèå¼åçä¼ç¹ï¼\n\n * æ¯åèå¼æ´èçç©ºé´\n * æ´æ°æä½æ¯åèå¼å¿«\n * æ´å°éè¦ distinct æ group by è¯­å¥\n\nèå¼åçç¼ºç¹ï¼\n\n * éå¸¸éè¦å³èæ¥è¯¢ãèå³èæ¥è¯¢ä»£ä»·è¾é«ï¼å¦ææ¯åè¡¨çå³èæ¥è¯¢ï¼ä»£ä»·æ´æ¯é«æã\n\nå¨çå®ä¸çä¸­ï¼å¾å°ä¼æç«¯å°ä½¿ç¨èå¼åæåèå¼åãå®éä¸ï¼åºè¯¥æè¡¡èå¼ååèå¼çå©å¼ï¼æ··åä½¿ç¨ã\n\n\n# 1.4. ç´¢å¼ä¼å\n\n> ç´¢å¼ä¼ååºè¯¥æ¯æ¥è¯¢æ§è½ä¼åçæææææ®µã\n> \n> å¦ææ³è¯¦ç»äºè§£ç´¢å¼ç¹æ§è¯·åèï¼mysql ç´¢å¼\n\n# ä½æ¶ä½¿ç¨ç´¢å¼\n\n * å¯¹äºéå¸¸å°çè¡¨ï¼å¤§é¨åæåµä¸ç®åçå¨è¡¨æ«ææ´é«æã\n * å¯¹äºä¸­ãå¤§åè¡¨ï¼ç´¢å¼éå¸¸ææã\n * å¯¹äºç¹å¤§åè¡¨ï¼å»ºç«åä½¿ç¨ç´¢å¼çä»£ä»·å°éä¹å¢é¿ãå¯ä»¥èèä½¿ç¨ååºææ¯ã\n * å¦æè¡¨çæ°éç¹å«å¤ï¼å¯ä»¥å»ºç«ä¸ä¸ªåæ°æ®ä¿¡æ¯è¡¨ï¼ç¨æ¥æ¥è¯¢éè¦ç¨å°çæäºç¹æ§ã\n\n# ç´¢å¼ä¼åç­ç¥\n\n * ç´¢å¼åºæ¬åå\n   * ç´¢å¼ä¸æ¯è¶å¤è¶å¥½ï¼ä¸è¦ä¸ºææåé½åå»ºç´¢å¼ã\n   * è¦å°½éé¿ååä½åéå¤ç´¢å¼ã\n   * è¦èèå é¤æªä½¿ç¨çç´¢å¼ã\n   * å°½éçæ©å±ç´¢å¼ï¼ä¸è¦æ°å»ºç´¢å¼ã\n   * é¢ç¹ä½ä¸º where è¿æ»¤æ¡ä»¶çååºè¯¥èèæ·»å ç´¢å¼ã\n * ç¬ç«çå - âç¬ç«çåâ æ¯æç´¢å¼åä¸è½æ¯è¡¨è¾¾å¼çä¸é¨åï¼ä¹ä¸è½æ¯å½æ°çåæ°ã\n * åç¼ç´¢å¼ - ç´¢å¼å¾é¿çå­ç¬¦åï¼å¯ä»¥ç´¢å¼å¼å§çé¨åå­ç¬¦ï¼è¿æ ·å¯ä»¥å¤§å¤§èçº¦ç´¢å¼ç©ºé´ã\n * æå·¦å¹éåå - å°éæ©æ§é«çåæåºæ°å¤§çåä¼åæå¨å¤åç´¢å¼æååã\n * ä½¿ç¨ç´¢å¼æ¥æåº - ç´¢å¼æå¥½æ¢æ»¡è¶³æåºï¼åç¨äºæ¥æ¾è¡ãè¿æ ·ï¼å°±å¯ä»¥ä½¿ç¨ç´¢å¼æ¥å¯¹ç»ææåºã\n * =ãin å¯ä»¥ä¹±åº - ä¸éè¦èè =ãin ç­çé¡ºåº\n * è¦çç´¢å¼\n * èªå¢å­æ®µä½ä¸»é®\n\n\n# 2. sql ä¼å\n\nä½¿ç¨ explain å½ä»¤æ¥çå½å sql æ¯å¦ä½¿ç¨äºç´¢å¼ï¼ä¼ååï¼åéè¿æ§è¡è®¡åï¼explainï¼æ¥æ¥çä¼åææã\n\nsql ä¼ååºæ¬æè·¯ï¼\n\n * åªè¿åå¿è¦çå - æå¥½ä¸è¦ä½¿ç¨ select * è¯­å¥ã\n\n * åªè¿åå¿è¦çè¡ - ä½¿ç¨ where å­æ¥è¯¢è¯­å¥è¿è¡è¿æ»¤æ¥è¯¢ï¼ææ¶åä¹éè¦ä½¿ç¨ limit è¯­å¥æ¥éå¶è¿åçæ°æ®ã\n\n * ç¼å­éå¤æ¥è¯¢çæ°æ® - åºè¯¥èèå¨å®¢æ·ç«¯ä½¿ç¨ç¼å­ï¼å°½éä¸è¦ä½¿ç¨ mysql æå¡å¨ç¼å­ï¼å­å¨è¾å¤é®é¢åéå¶ï¼ã\n\n * ä½¿ç¨ç´¢å¼æ¥è¦çæ¥è¯¢\n\n\n# 2.1. ä¼å count() æ¥è¯¢\n\ncount() æä¸¤ç§ä½ç¨ï¼\n\n * ç»è®¡æä¸ªåå¼çæ°éãç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯é null çï¼å®ä¸ä¼ç»è®¡ nullã\n * ç»è®¡è¡æ°ã\n\nç»è®¡åå¼æ¶ï¼è¦æ±åå¼æ¯éç©ºçï¼å®ä¸ä¼ç»è®¡ nullãå¦æç¡®è®¤æ¬å·ä¸­çè¡¨è¾¾å¼ä¸å¯è½ä¸ºç©ºæ¶ï¼å®éä¸å°±æ¯å¨ç»è®¡è¡æ°ãæç®åçå°±æ¯å½ä½¿ç¨ count(*) æ¶ï¼å¹¶ä¸æ¯æä»¬ææ³è±¡çé£æ ·æ©å±æææçåï¼å®éä¸ï¼å®ä¼å¿½ç¥ææçåèç´æ¥ç»è®¡è¡æ°ã\n\næä»¬æå¸¸è§çè¯¯è§£ä¹å°±å¨è¿å¿ï¼å¨æ¬å·åæå®äºä¸åå´å¸æç»è®¡ç»ææ¯è¡æ°ï¼èä¸è¿å¸¸å¸¸è¯¯ä»¥ä¸ºåèçæ§è½ä¼æ´å¥½ãä½å®éå¹¶éè¿æ ·ï¼å¦æè¦ç»è®¡è¡æ°ï¼ç´æ¥ä½¿ç¨ count(*)ï¼æä¹æ¸æ°ï¼ä¸æ§è½æ´å¥½ã\n\nï¼1ï¼ç®åä¼å\n\nselect count(*) from world.city where id > 5;\n\nselect (select count(*) from world.city) - count(*)\nfrom world.city where id <= 5;\n\n\nï¼2ï¼ä½¿ç¨è¿ä¼¼å¼\n\nææ¶åæäºä¸å¡åºæ¯å¹¶ä¸éè¦å®å¨ç²¾ç¡®çç»è®¡å¼ï¼å¯ä»¥ç¨è¿ä¼¼å¼æ¥ä»£æ¿ï¼explain åºæ¥çè¡æ°å°±æ¯ä¸ä¸ªä¸éçè¿ä¼¼å¼ï¼èä¸æ§è¡ explain å¹¶ä¸éè¦çæ­£å°å»æ§è¡æ¥è¯¢ï¼æä»¥ææ¬éå¸¸ä½ãéå¸¸æ¥è¯´ï¼æ§è¡ count() é½éè¦æ«æå¤§éçè¡æè½è·åå°ç²¾ç¡®çæ°æ®ï¼å æ­¤å¾é¾ä¼åï¼mysql å±é¢è¿è½åå¾ä¹å°±åªæè¦çç´¢å¼äºãå¦æä¸è¿è½è§£å³é®é¢ï¼åªæä»æ¶æå±é¢è§£å³äºï¼æ¯å¦æ·»å æ±æ»è¡¨ï¼æèä½¿ç¨ redis è¿æ ·çå¤é¨ç¼å­ç³»ç»ã\n\n\n# 2.2. ä¼åå³èæ¥è¯¢\n\nå¨å¤§æ°æ®åºæ¯ä¸ï¼è¡¨ä¸è¡¨ä¹é´éè¿ä¸ä¸ªåä½å­æ®µæ¥å³èï¼è¦æ¯ç´æ¥ä½¿ç¨ join ææ´å¥½çæ§è½ã\n\nå¦æç¡®å®éè¦ä½¿ç¨å³èæ¥è¯¢çæåµä¸ï¼éè¦ç¹å«æ³¨æçæ¯ï¼\n\n * ç¡®ä¿ on å using å­å¥ä¸­çåä¸æç´¢å¼ãå¨åå»ºç´¢å¼çæ¶åå°±è¦èèå°å³èçé¡ºåºãå½è¡¨ a åè¡¨ b ç¨æå column å³èçæ¶åï¼å¦æä¼åå¨å³èçé¡ºåºæ¯ aãbï¼é£ä¹å°±ä¸éè¦å¨ a è¡¨çå¯¹åºåä¸åå»ºç´¢å¼ãæ²¡æç¨å°çç´¢å¼ä¼å¸¦æ¥é¢å¤çè´æï¼ä¸è¬æ¥è¯´ï¼é¤éæå¶ä»çç±ï¼åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼ï¼å·ä½åå ä¸æåæï¼ã\n * ç¡®ä¿ä»»ä½ç group by å order by ä¸­çè¡¨è¾¾å¼åªæ¶åå°ä¸ä¸ªè¡¨ä¸­çåï¼è¿æ · mysql ææå¯è½ä½¿ç¨ç´¢å¼æ¥ä¼åã\n\nè¦çè§£ä¼åå³èæ¥è¯¢çç¬¬ä¸ä¸ªæå·§ï¼å°±éè¦çè§£ mysql æ¯å¦ä½æ§è¡å³èæ¥è¯¢çãå½å mysql å³èæ§è¡çç­ç¥éå¸¸ç®åï¼å®å¯¹ä»»ä½çå³èé½æ§è¡åµå¥å¾ªç¯å³èæä½ï¼å³åå¨ä¸ä¸ªè¡¨ä¸­å¾ªç¯ååºåæ¡æ°æ®ï¼ç¶åå¨åµå¥å¾ªç¯å°ä¸ä¸ä¸ªè¡¨ä¸­å¯»æ¾å¹éçè¡ï¼ä¾æ¬¡ä¸å»ï¼ç´å°æ¾å°ææè¡¨ä¸­å¹éçè¡ä¸ºä¸ºæ­¢ãç¶åæ ¹æ®åä¸ªè¡¨å¹éçè¡ï¼è¿åæ¥è¯¢ä¸­éè¦çåä¸ªåã\n\nå¤ªæ½è±¡äºï¼ä»¥ä¸é¢çç¤ºä¾æ¥è¯´æï¼æ¯å¦æè¿æ ·çä¸ä¸ªæ¥è¯¢ï¼\n\nselect a.xx,b.yy\nfrom a inner join b using(c)\nwhere a.xx in (5,6)\n\n\nåè®¾ mysql æç§æ¥è¯¢ä¸­çå³èé¡ºåº aãb æ¥è¿è¡å³èæä½ï¼é£ä¹å¯ä»¥ç¨ä¸é¢çä¼ªä»£ç è¡¨ç¤º mysql å¦ä½å®æè¿ä¸ªæ¥è¯¢ï¼\n\nouter_iterator = select a.xx,a.c from a where a.xx in (5,6);\nouter_row = outer_iterator.next;\nwhile(outer_row) {\n    inner_iterator = select b.yy from b where b.c = outer_row.c;\n    inner_row = inner_iterator.next;\n    while(inner_row) {\n        output[inner_row.yy,outer_row.xx];\n        inner_row = inner_iterator.next;\n    }\n    outer_row = outer_iterator.next;\n}\n\n\nå¯ä»¥çå°ï¼æå¤å±çæ¥è¯¢æ¯æ ¹æ®a.xxåæ¥æ¥è¯¢çï¼a.cä¸å¦ææç´¢å¼çè¯ï¼æ´ä¸ªå³èæ¥è¯¢ä¹ä¸ä¼ä½¿ç¨ãåçåå±çæ¥è¯¢ï¼å¾ææ¾b.cä¸å¦ææç´¢å¼çè¯ï¼è½å¤å éæ¥è¯¢ï¼å æ­¤åªéè¦å¨å³èé¡ºåºä¸­çç¬¬äºå¼ è¡¨çç¸åºåä¸åå»ºç´¢å¼å³å¯ã\n\n\n# 2.3. ä¼å group by å distinct\n\nmysql ä¼åå¨ä¼å¨åé¨å¤ççæ¶åç¸äºè½¬åè¿ä¸¤ç±»æ¥è¯¢ãå®ä»¬é½å¯ä»¥ä½¿ç¨ç´¢å¼æ¥ä¼åï¼è¿ä¹æ¯æææçä¼åæ¹æ³ã\n\n\n# 2.4. ä¼å limit\n\nå½éè¦åé¡µæä½æ¶ï¼éå¸¸ä¼ä½¿ç¨ limit å ä¸åç§»éçåæ³å®ç°ï¼åæ¶å ä¸åéç order by å­å¥ãå¦ææå¯¹åºçç´¢å¼ï¼éå¸¸æçä¼ä¸éï¼å¦åï¼mysql éè¦åå¤§éçæä»¶æåºæä½ã\n\nä¸ä¸ªå¸¸è§çé®é¢æ¯å½åç§»ééå¸¸å¤§çæ¶åï¼æ¯å¦ï¼limit 10000 20è¿æ ·çæ¥è¯¢ï¼mysql éè¦æ¥è¯¢ 10020 æ¡è®°å½ç¶ååªè¿å 20 æ¡è®°å½ï¼åé¢ç 10000 æ¡é½å°è¢«æå¼ï¼è¿æ ·çä»£ä»·éå¸¸é«ã\n\nä¼åè¿ç§æ¥è¯¢ä¸ä¸ªæç®åçåæ³å°±æ¯å°½å¯è½çä½¿ç¨è¦çç´¢å¼æ«æï¼èä¸æ¯æ¥è¯¢ææçåãç¶åæ ¹æ®éè¦åä¸æ¬¡å³èæ¥è¯¢åè¿åææçåãå¯¹äºåç§»éå¾å¤§æ¶ï¼è¿æ ·åçæçä¼æåéå¸¸å¤§ãèèä¸é¢çæ¥è¯¢ï¼\n\nselect film_id,description from film order by title limit 50,5;\n\n\nå¦æè¿å¼ è¡¨éå¸¸å¤§ï¼é£ä¹è¿ä¸ªæ¥è¯¢æå¥½æ¹æä¸é¢çæ ·å­ï¼\n\nselect film.film_id,film.description\nfrom film inner join (\n    select film_id from film order by title limit 50,5\n) as tmp using(film_id);\n\n\nè¿éçå»¶è¿å³èå°å¤§å¤§æåæ¥è¯¢æçï¼è®© mysql æ«æå°½å¯è½å°çé¡µé¢ï¼è·åéè¦è®¿é®çè®°å½åå¨æ ¹æ®å³èåååè¡¨æ¥è¯¢æéè¦çåã\n\nææ¶åå¦æå¯ä»¥ä½¿ç¨ä¹¦ç­¾è®°å½ä¸æ¬¡åæ°æ®çä½ç½®ï¼é£ä¹ä¸æ¬¡å°±å¯ä»¥ç´æ¥ä»è¯¥ä¹¦ç­¾è®°å½çä½ç½®å¼å§æ«æï¼è¿æ ·å°±å¯ä»¥é¿åä½¿ç¨offsetï¼æ¯å¦ä¸é¢çæ¥è¯¢ï¼\n\nselect id from t limit 10000, 10;\næ¹ä¸ºï¼\nselect id from t where id > 10000 limit 10;\n\n\nå¶ä»ä¼åçåæ³è¿åæ¬ä½¿ç¨é¢åè®¡ç®çæ±æ»è¡¨ï¼æèå³èå°ä¸ä¸ªåä½è¡¨ï¼åä½è¡¨ä¸­åªåå«ä¸»é®ååéè¦åæåºçåã\n\n\n# 2.5. ä¼å union\n\nmysql æ»æ¯éè¿åå»ºå¹¶å¡«åä¸´æ¶è¡¨çæ¹å¼æ¥æ§è¡ union æ¥è¯¢ãå æ­¤å¾å¤ä¼åç­ç¥å¨unionæ¥è¯¢ä¸­é½æ²¡æåæ³å¾å¥½çæ¶åãç»å¸¸éè¦æå¨å°whereãlimitãorder byç­å­å¥âä¸æ¨âå°åä¸ªå­æ¥è¯¢ä¸­ï¼ä»¥ä¾¿ä¼åå¨å¯ä»¥ååå©ç¨è¿äºæ¡ä»¶åä¼åã\n\né¤éç¡®å®éè¦æå¡å¨å»éï¼å¦åå°±ä¸å®è¦ä½¿ç¨union allï¼å¦ææ²¡æallå³é®å­ï¼mysql ä¼ç»ä¸´æ¶è¡¨å ä¸distinctéé¡¹ï¼è¿ä¼å¯¼è´æ´ä¸ªä¸´æ¶è¡¨çæ°æ®åå¯ä¸æ§æ£æ¥ï¼è¿æ ·åçä»£ä»·éå¸¸é«ãå½ç¶å³ä½¿ä½¿ç¨ all å³é®å­ï¼mysql æ»æ¯å°ç»ææ¾å¥ä¸´æ¶è¡¨ï¼ç¶ååè¯»åºï¼åè¿åç»å®¢æ·ç«¯ãè½ç¶å¾å¤æ¶åæ²¡æè¿ä¸ªå¿è¦ï¼æ¯å¦ææ¶åå¯ä»¥ç´æ¥ææ¯ä¸ªå­æ¥è¯¢çç»æè¿åç»å®¢æ·ç«¯ã\n\n\n# 2.6. ä¼åæ¥è¯¢æ¹å¼\n\n# ååå¤§æ¥è¯¢\n\nä¸ä¸ªå¤§æ¥è¯¢å¦æä¸æ¬¡æ§æ§è¡çè¯ï¼å¯è½ä¸æ¬¡éä½å¾å¤æ°æ®ãå æ»¡æ´ä¸ªäºå¡æ¥å¿ãèå°½ç³»ç»èµæºãé»å¡å¾å¤å°çä½éè¦çæ¥è¯¢ã\n\ndeleft from messages where create < date_sub(now(), interval 3 month);\n\n\nrows_affected = 0\ndo {\n    rows_affected = do_query(\n    \"delete from messages where create  < date_sub(now(), interval 3 month) limit 10000\")\n} while rows_affected > 0\n\n\n# åè§£å¤§è¿æ¥æ¥è¯¢\n\nå°ä¸ä¸ªå¤§è¿æ¥æ¥è¯¢ï¼joinï¼åè§£æå¯¹æ¯ä¸ä¸ªè¡¨è¿è¡ä¸æ¬¡åè¡¨æ¥è¯¢ï¼ç¶åå°ç»æå¨åºç¨ç¨åºä¸­è¿è¡å³èï¼è¿æ ·åçå¥½å¤æï¼\n\n * è®©ç¼å­æ´é«æãå¯¹äºè¿æ¥æ¥è¯¢ï¼å¦æå¶ä¸­ä¸ä¸ªè¡¨åçååï¼é£ä¹æ´ä¸ªæ¥è¯¢ç¼å­å°±æ æ³ä½¿ç¨ãèåè§£åçå¤ä¸ªæ¥è¯¢ï¼å³ä½¿å¶ä¸­ä¸ä¸ªè¡¨åçååï¼å¯¹å¶å®è¡¨çæ¥è¯¢ç¼å­ä¾ç¶å¯ä»¥ä½¿ç¨ã\n * åè§£æå¤ä¸ªåè¡¨æ¥è¯¢ï¼è¿äºåè¡¨æ¥è¯¢çç¼å­ç»ææ´å¯è½è¢«å¶å®æ¥è¯¢ä½¿ç¨å°ï¼ä»èåå°åä½è®°å½çæ¥è¯¢ã\n * åå°éç«äºï¼\n * å¨åºç¨å±è¿è¡è¿æ¥ï¼å¯ä»¥æ´å®¹æå¯¹æ°æ®åºè¿è¡æåï¼ä»èæ´å®¹æåå°é«æ§è½åå¯æ©å±ã\n * æ¥è¯¢æ¬èº«æçä¹å¯è½ä¼æææåãä¾å¦ä¸é¢çä¾å­ä¸­ï¼ä½¿ç¨ in() ä»£æ¿è¿æ¥æ¥è¯¢ï¼å¯ä»¥è®© mysql æç§ id é¡ºåºè¿è¡æ¥è¯¢ï¼è¿å¯è½æ¯éæºçè¿æ¥è¦æ´é«æã\n\nselect * from tag\njoin tag_post on tag_post.tag_id=tag.id\njoin post on tag_post.post_id=post.id\nwhere tag.tag='mysql';\n\n\nselect * from tag where tag='mysql';\nselect * from tag_post where tag_id=1234;\nselect * from post where post.id in (123,456,567,9098,8904);\n\n\n\n# 3. æ§è¡è®¡åï¼explainï¼\n\nå¦ä½å¤æ­å½å sql æ¯å¦ä½¿ç¨äºç´¢å¼ï¼å¦ä½æ£éªä¿®æ¹åç sql ç¡®å®æä¼åææï¼\n\nå¨ sql ä¸­ï¼å¯ä»¥éè¿æ§è¡è®¡åï¼explainï¼åæ select æ¥è¯¢æçã\n\nmysql> explain select * from user_info where id = 2\\g\n*************************** 1. row ***************************\n           id: 1\n  select_type: simple\n        table: user_info\n   partitions: null\n         type: const\npossible_keys: primary\n          key: primary\n      key_len: 8\n          ref: const\n         rows: 1\n     filtered: 100.00\n        extra: null\n1 row in set, 1 warning (0.00 sec)\n\n\nexplain åæ°è¯´æï¼\n\n * id: select æ¥è¯¢çæ è¯ç¬¦. æ¯ä¸ª select é½ä¼èªå¨åéä¸ä¸ªå¯ä¸çæ è¯ç¬¦.\n * select_type â­ ï¼select æ¥è¯¢çç±»å.\n   * simpleï¼è¡¨ç¤ºæ­¤æ¥è¯¢ä¸åå« union æ¥è¯¢æå­æ¥è¯¢\n   * primaryï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯æå¤å±çæ¥è¯¢\n   * unionï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¯ union çç¬¬äºæéåçæ¥è¯¢\n   * dependent unionï¼union ä¸­çç¬¬äºä¸ªæåé¢çæ¥è¯¢è¯­å¥, åå³äºå¤é¢çæ¥è¯¢\n   * union resultï¼union çç»æ\n   * subqueryï¼å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª select\n   * dependent subquery: å­æ¥è¯¢ä¸­çç¬¬ä¸ä¸ª select, åå³äºå¤é¢çæ¥è¯¢. å³å­æ¥è¯¢ä¾èµäºå¤å±æ¥è¯¢çç»æ.\n * table: æ¥è¯¢çæ¯åªä¸ªè¡¨ï¼å¦æç»è¡¨èµ·å«åäºï¼åæ¾ç¤ºå«åã\n * partitionsï¼å¹éçååº\n * type â­ï¼è¡¨ç¤ºä»è¡¨ä¸­æ¥è¯¢å°è¡ææ§è¡çæ¹å¼ï¼æ¥è¯¢æ¹å¼æ¯ sql ä¼åä¸­ä¸ä¸ªå¾éè¦çææ ï¼ç»æå¼ä»å¥½å°å·®ä¾æ¬¡æ¯ï¼system > const > eq_ref > ref > range > index > allã\n   * system/constï¼è¡¨ä¸­åªæä¸è¡æ°æ®å¹éï¼æ­¤æ¶æ ¹æ®ç´¢å¼æ¥è¯¢ä¸æ¬¡å°±è½æ¾å°å¯¹åºçæ°æ®ãå¦ææ¯ b + æ ç´¢å¼ï¼æä»¬ç¥éæ­¤æ¶ç´¢å¼æé æäºå¤ä¸ªå±çº§çæ ï¼å½æ¥è¯¢çç´¢å¼å¨æ çåºå±æ¶ï¼æ¥è¯¢æçå°±è¶ä½ãconst è¡¨ç¤ºæ­¤æ¶ç´¢å¼å¨ç¬¬ä¸å±ï¼åªéè®¿é®ä¸å±ä¾¿è½å¾å°æ°æ®ã\n   * eq_refï¼ä½¿ç¨å¯ä¸ç´¢å¼æ«æï¼å¸¸è§äºå¤è¡¨è¿æ¥ä¸­ä½¿ç¨ä¸»é®åå¯ä¸ç´¢å¼ä½ä¸ºå³èæ¡ä»¶ã\n   * refï¼éå¯ä¸ç´¢å¼æ«æï¼è¿å¯è§äºå¯ä¸ç´¢å¼æå·¦ååå¹éæ«æã\n   * rangeï¼ç´¢å¼èå´æ«æï¼æ¯å¦ï¼<ï¼>ï¼between ç­æä½ã\n   * indexï¼ç´¢å¼å¨è¡¨æ«æï¼æ­¤æ¶éåæ´ä¸ªç´¢å¼æ ã\n   * allï¼è¡¨ç¤ºå¨è¡¨æ«æï¼éè¦éåå¨è¡¨æ¥æ¾å°å¯¹åºçè¡ã\n * possible_keysï¼æ­¤æ¬¡æ¥è¯¢ä¸­å¯è½éç¨çç´¢å¼ã\n * key â­ï¼æ­¤æ¬¡æ¥è¯¢ä¸­å®éä½¿ç¨çç´¢å¼ã\n * refï¼åªä¸ªå­æ®µæå¸¸æ°ä¸ key ä¸èµ·è¢«ä½¿ç¨ã\n * rows â­ï¼æ¾ç¤ºæ­¤æ¥è¯¢ä¸å±æ«æäºå¤å°è¡ï¼è¿ä¸ªæ¯ä¸ä¸ªä¼°è®¡å¼ã\n * filteredï¼è¡¨ç¤ºæ­¤æ¥è¯¢æ¡ä»¶æè¿æ»¤çæ°æ®çç¾åæ¯ã\n * extraï¼é¢å¤çä¿¡æ¯ã\n\n> æ´å¤åå®¹è¯·åèï¼mysql æ§è½ä¼åç¥å¨ explain ä½¿ç¨åæ\n\n\n# 4. optimizer trace\n\nå¨ mysql 5.6 åä¹åççæ¬ä¸­ï¼æä»¬å¯ä»¥ä½¿ç¨ optimizer trace åè½æ¥çä¼åå¨çææ§è¡è®¡åçæ´ä¸ªè¿ç¨ãæäºè¿ä¸ªåè½ï¼æä»¬ä¸ä»å¯ä»¥äºè§£ä¼åå¨çéæ©è¿ç¨ï¼æ´å¯ä»¥äºè§£æ¯ä¸ä¸ªæ§è¡ç¯èçææ¬ï¼ç¶åä¾é è¿äºä¿¡æ¯è¿ä¸æ­¥ä¼åæ¥è¯¢ã\n\nå¦ä¸ä»£ç æç¤ºï¼æå¼ optimizer_trace åï¼åæ§è¡ sql å°±å¯ä»¥æ¥è¯¢ information_schema.optimizer_trace è¡¨æ¥çæ§è¡è®¡åäºï¼æåå¯ä»¥å³é­ optimizer_trace åè½ï¼\n\nset optimizer_trace=\"enabled=on\";\nselect * from person where name >'name84059' and create_time>'2020-01-24 05:00\nselect * from information_schema.optimizer_trace;\nset optimizer_trace=\"enabled=off\";\n\n\n\n# 5. æ°æ®æ¨¡ååä¸å¡\n\n * è¡¨å­æ®µæ¯è¾å¤æãæåå¨ãç»æé¾ä»¥ç»ä¸çæåµä¸ï¼å¯ä»¥èèä½¿ç¨ nosql æ¥ä»£æ¿å³ç³»æ°æ®åºè¡¨å­å¨ï¼å¦ elasticsearchãmongodbã\n * å¨é«å¹¶åæåµä¸çæ¥è¯¢æä½ï¼å¯ä»¥ä½¿ç¨ç¼å­ï¼å¦ redisï¼ä»£æ¿æ°æ®åºæä½ï¼æé«å¹¶åæ§è½ã\n * æ°æ®éå¢é¿è¾å¿«çè¡¨ï¼éè¦èèæ°´å¹³åè¡¨æååºï¼é¿ååè¡¨æä½çæ§è½ç¶é¢ã\n * é¤æ­¤ä¹å¤ï¼æä»¬åºè¯¥éè¿ä¸äºä¼åï¼å°½éé¿åæ¯è¾å¤æç join æ¥è¯¢æä½ï¼ä¾å¦åä½ä¸äºå­æ®µï¼åå° join æ¥è¯¢ï¼åå»ºä¸äºä¸­é´è¡¨ï¼åå° join æ¥è¯¢ã\n\n\n# 6. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * ãjava æ§è½è°ä¼å®æã\n * æå¿é¡»å¾åè¯å¤§å®¶ç mysql ä¼ååç\n * 20+ æ¡ mysql æ§è½ä¼åçæä½³ç»éª\n * mysql æ§è½ä¼åç¥å¨ explain ä½¿ç¨åæ",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql è¿ç»´",frontmatter:{title:"Mysql è¿ç»´",date:"2019-11-26T21:37:17.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","è¿ç»´"],permalink:"/pages/ada3b2/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/20.Mysql%E8%BF%90%E7%BB%B4.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/20.Mysqlè¿ç»´.md",key:"v-bf86eaa6",path:"/pages/ada3b2/",headers:[{level:2,title:"1. å®è£é¨ç½²",slug:"_1-å®è£é¨ç½²",normalizedTitle:"1. å®è£é¨ç½²",charIndex:98},{level:3,title:"1.1. Windows å®è£",slug:"_1-1-windows-å®è£",normalizedTitle:"1.1. windows å®è£",charIndex:110},{level:3,title:"1.2. CentOS å®è£",slug:"_1-2-centos-å®è£",normalizedTitle:"1.2. centos å®è£",charIndex:782},{level:4,title:"å®è£ mysql yum æº",slug:"å®è£-mysql-yum-æº",normalizedTitle:"å®è£ mysql yum æº",charIndex:818},{level:4,title:"mysql æå¡ç®¡ç",slug:"mysql-æå¡ç®¡ç",normalizedTitle:"mysql æå¡ç®¡ç",charIndex:1897},{level:3,title:"1.3. åå§åæ°æ®åºå¯ç ",slug:"_1-3-åå§åæ°æ®åºå¯ç ",normalizedTitle:"1.3. åå§åæ°æ®åºå¯ç ",charIndex:2168},{level:3,title:"1.4. éç½®è¿ç¨è®¿é®",slug:"_1-4-éç½®è¿ç¨è®¿é®",normalizedTitle:"1.4. éç½®è¿ç¨è®¿é®",charIndex:2529},{level:3,title:"1.5. è·³è¿ç»å½è®¤è¯",slug:"_1-5-è·³è¿ç»å½è®¤è¯",normalizedTitle:"1.5. è·³è¿ç»å½è®¤è¯",charIndex:2713},{level:2,title:"2. åºæ¬è¿ç»´",slug:"_2-åºæ¬è¿ç»´",normalizedTitle:"2. åºæ¬è¿ç»´",charIndex:2859},{level:3,title:"2.1. å®¢æ·ç«¯è¿æ¥",slug:"_2-1-å®¢æ·ç«¯è¿æ¥",normalizedTitle:"2.1. å®¢æ·ç«¯è¿æ¥",charIndex:2871},{level:3,title:"2.2. æ¥çè¿æ¥",slug:"_2-2-æ¥çè¿æ¥",normalizedTitle:"2.2. æ¥çè¿æ¥",charIndex:3471},{level:3,title:"2.3. åå»ºç¨æ·",slug:"_2-3-åå»ºç¨æ·",normalizedTitle:"2.3. åå»ºç¨æ·",charIndex:3608},{level:3,title:"2.4. æ¥çç¨æ·",slug:"_2-4-æ¥çç¨æ·",normalizedTitle:"2.4. æ¥çç¨æ·",charIndex:4298},{level:3,title:"2.5. ææ",slug:"_2-5-ææ",normalizedTitle:"2.5. ææ",charIndex:4413},{level:3,title:"2.6. æ¤éææ",slug:"_2-6-æ¤éææ",normalizedTitle:"2.6. æ¤éææ",charIndex:4996},{level:3,title:"2.7. æ¥çææ",slug:"_2-7-æ¥çææ",normalizedTitle:"2.7. æ¥çææ",charIndex:5498},{level:3,title:"2.8. æ´æ¹ç¨æ·å¯ç ",slug:"_2-8-æ´æ¹ç¨æ·å¯ç ",normalizedTitle:"2.8. æ´æ¹ç¨æ·å¯ç ",charIndex:5552},{level:3,title:"2.9. å¤ä»½ä¸æ¢å¤",slug:"_2-9-å¤ä»½ä¸æ¢å¤",normalizedTitle:"2.9. å¤ä»½ä¸æ¢å¤",charIndex:5743},{level:4,title:"å¤ä»½ä¸ä¸ªæ°æ®åº",slug:"å¤ä»½ä¸ä¸ªæ°æ®åº",normalizedTitle:"å¤ä»½ä¸ä¸ªæ°æ®åº",charIndex:5843},{level:4,title:"å¤ä»½å¤ä¸ªæ°æ®åº",slug:"å¤ä»½å¤ä¸ªæ°æ®åº",normalizedTitle:"å¤ä»½å¤ä¸ªæ°æ®åº",charIndex:6165},{level:4,title:"å¤ä»½æææ°æ®åº",slug:"å¤ä»½æææ°æ®åº",normalizedTitle:"å¤ä»½æææ°æ®åº",charIndex:6258},{level:4,title:"æ¢å¤ä¸ä¸ªæ°æ®åº",slug:"æ¢å¤ä¸ä¸ªæ°æ®åº",normalizedTitle:"æ¢å¤ä¸ä¸ªæ°æ®åº",charIndex:6327},{level:4,title:"æ¢å¤æææ°æ®åº",slug:"æ¢å¤æææ°æ®åº",normalizedTitle:"æ¢å¤æææ°æ®åº",charIndex:6433},{level:3,title:"2.10. å¸è½½",slug:"_2-10-å¸è½½",normalizedTitle:"2.10. å¸è½½",charIndex:6498},{level:3,title:"2.11. ä¸»ä»èç¹é¨ç½²",slug:"_2-11-ä¸»ä»èç¹é¨ç½²",normalizedTitle:"2.11. ä¸»ä»èç¹é¨ç½²",charIndex:6860},{level:4,title:"ä¸»èç¹ä¸çæä½",slug:"ä¸»èç¹ä¸çæä½",normalizedTitle:"ä¸»èç¹ä¸çæä½",charIndex:6952},{level:4,title:"ä»èç¹ä¸çæä½",slug:"ä»èç¹ä¸çæä½",normalizedTitle:"ä»èç¹ä¸çæä½",charIndex:9196},{level:2,title:"3. æå¡å¨éç½®",slug:"_3-æå¡å¨éç½®",normalizedTitle:"3. æå¡å¨éç½®",charIndex:10513},{level:3,title:"3.1. éç½®æä»¶è·¯å¾",slug:"_3-1-éç½®æä»¶è·¯å¾",normalizedTitle:"3.1. éç½®æä»¶è·¯å¾",charIndex:10717},{level:3,title:"3.2. éç½®é¡¹è¯­æ³",slug:"_3-2-éç½®é¡¹è¯­æ³",normalizedTitle:"3.2. éç½®é¡¹è¯­æ³",charIndex:11080},{level:3,title:"3.3. å¸¸ç¨éç½®é¡¹è¯´æ",slug:"_3-3-å¸¸ç¨éç½®é¡¹è¯´æ",normalizedTitle:"3.3. å¸¸ç¨éç½®é¡¹è¯´æ",charIndex:11259},{level:2,title:"4. å¸¸è§é®é¢",slug:"_4-å¸¸è§é®é¢",normalizedTitle:"4. å¸¸è§é®é¢",charIndex:15260},{level:3,title:"4.1. Too many connections",slug:"_4-1-too-many-connections",normalizedTitle:"4.1. too many connections",charIndex:15272},{level:3,title:"4.2. æ¶åºï¼time_zoneï¼åå·®",slug:"_4-2-æ¶åº-time-zone-åå·®",normalizedTitle:"4.2. æ¶åºï¼time_zoneï¼åå·®",charIndex:16488},{level:3,title:"4.3. æ°æ®è¡¨æåå¦ä½ä¿®å¤",slug:"_4-3-æ°æ®è¡¨æåå¦ä½ä¿®å¤",normalizedTitle:"4.3. æ°æ®è¡¨æåå¦ä½ä¿®å¤",charIndex:17248},{level:3,title:"4.4. æ°æ®ç»æ",slug:"_4-4-æ°æ®ç»æ",normalizedTitle:"4.4. æ°æ®ç»æ",charIndex:17628},{level:2,title:"5. èæ¬",slug:"_5-èæ¬",normalizedTitle:"5. èæ¬",charIndex:17789},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:17856}],headersStr:"1. å®è£é¨ç½² 1.1. Windows å®è£ 1.2. CentOS å®è£ å®è£ mysql yum æº mysql æå¡ç®¡ç 1.3. åå§åæ°æ®åºå¯ç  1.4. éç½®è¿ç¨è®¿é® 1.5. è·³è¿ç»å½è®¤è¯ 2. åºæ¬è¿ç»´ 2.1. å®¢æ·ç«¯è¿æ¥ 2.2. æ¥çè¿æ¥ 2.3. åå»ºç¨æ· 2.4. æ¥çç¨æ· 2.5. ææ 2.6. æ¤éææ 2.7. æ¥çææ 2.8. æ´æ¹ç¨æ·å¯ç  2.9. å¤ä»½ä¸æ¢å¤ å¤ä»½ä¸ä¸ªæ°æ®åº å¤ä»½å¤ä¸ªæ°æ®åº å¤ä»½æææ°æ®åº æ¢å¤ä¸ä¸ªæ°æ®åº æ¢å¤æææ°æ®åº 2.10. å¸è½½ 2.11. ä¸»ä»èç¹é¨ç½² ä¸»èç¹ä¸çæä½ ä»èç¹ä¸çæä½ 3. æå¡å¨éç½® 3.1. éç½®æä»¶è·¯å¾ 3.2. éç½®é¡¹è¯­æ³ 3.3. å¸¸ç¨éç½®é¡¹è¯´æ 4. å¸¸è§é®é¢ 4.1. Too many connections 4.2. æ¶åºï¼time_zoneï¼åå·® 4.3. æ°æ®è¡¨æåå¦ä½ä¿®å¤ 4.4. æ°æ®ç»æ 5. èæ¬ 6. åèèµæ",content:"# Mysql è¿ç»´\n\n> å¦æä½ çå¬å¸æ DBAï¼é£ä¹ææ­åä½ ï¼ä½ å¯ä»¥æ è§ Mysql è¿ç»´ãå¦æä½ çå¬å¸æ²¡æ DBAï¼é£ä½ å°±å¥½å¥½å­¦ä¸¤æ Mysql åºæ¬è¿ç»´æä½ï¼è¡èµ°æ±æ¹ï¼é²èº«å¿å¤ã\n\n\n# 1. å®è£é¨ç½²\n\n\n# 1.1. Windows å®è£\n\nï¼1ï¼ä¸è½½ Mysql 5.7 åå®è£ç\n\nä¸è½½å°åï¼https://dev.mysql.com/downloads/mysql/5.7.html#downloads\n\nï¼2ï¼è§£åå¹¶åå»º my.ini å¨æ ¹ç®å½\n\nmy.ini æä»¶ç¤ºä¾ï¼\n\n[mysqld]\n#è®¾ç½®3306ç«¯å£\nport = 3306\n# è®¾ç½®mysqlçå®è£ç®å½ è¿åæ¢æèªå·±è§£åçè·¯å¾\nbasedir=D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31\n# åè®¸æå¤§è¿æ¥æ°\nmax_connections=200\n# æå¡ç«¯ä½¿ç¨çå­ç¬¦éé»è®¤ä¸º8æ¯ç¹ç¼ç çlatin1å­ç¬¦é\ncharacter-set-server=utf8\n# åå»ºæ°è¡¨æ¶å°ä½¿ç¨çé»è®¤å­å¨å¼æ\ndefault-storage-engine=INNODB\n\n[client]\n# è®¾ç½®mysqlå®¢æ·ç«¯é»è®¤å­ç¬¦é\ndefault-character-set=utf8\n\n\nï¼3ï¼æ§è¡å®è£å½ä»¤\n\nå¨æ§å¶å° CMD ä¸­ä¾æ¬¡æ§è¡ä»¥ä¸å®è£å½ä»¤\n\ncd D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31\nmysqld --initialize\nmysqld -install\n\n\nè¯´æï¼\n\n * mysqld --initialize ä¼èªå¨åå§ååå»º data æä»¶å¤¹å¹¶åå§å mysqlã\n * mysqld -install ä¼å®è£ mysql æå¡ã\n\nï¼4ï¼å¯å¨æå¡\n\nå¨æ§å¶å°æ§è¡ net start mysql å¯å¨æå¡ã\n\n\n# 1.2. CentOS å®è£\n\n> æ¬æä»ä»ç» rpm å®è£æ¹å¼\n\n# å®è£ mysql yum æº\n\nå®æ¹ä¸è½½å°åï¼https://dev.mysql.com/downloads/repo/yum/\n\nï¼1ï¼ä¸è½½ yum æº\n\nwget https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n\n\nï¼2ï¼å®è£ yum repo æä»¶å¹¶æ´æ° yum ç¼å­\n\nrpm -ivh mysql80-community-release-el7-1.noarch.rpm\n\n\næ§è¡ç»æï¼\n\nä¼å¨ /etc/yum.repos.d/ ç®å½ä¸çæä¸¤ä¸ª repo æä»¶\n\n$ ls | grep mysql\nmysql-community.repo\nmysql-community-source.repo\n\n\næ´æ° yumï¼\n\nyum clean all\nyum makecache\n\n\nï¼3ï¼æ¥ç rpm å®è£ç¶æ\n\n$ yum search mysql | grep server\nmysql-community-common.i686 : MySQL database common files for server and client\nmysql-community-common.x86_64 : MySQL database common files for server and\nmysql-community-test.x86_64 : Test suite for the MySQL database server\n                       : administering MySQL servers\nmysql-community-server.x86_64 : A very fast and reliable SQL database server\n\n\néè¿ yum å®è£ mysql æå ä¸ªéè¦ç®å½ï¼\n\n## éç½®æä»¶\n/etc/my.cnf\n## æ°æ®åºç®å½\n/var/lib/mysql/\n## éç½®æä»¶\n/usr/share/mysqlï¼mysql.serverå½ä»¤åéç½®æä»¶ï¼\n## ç¸å³å½ä»¤\n/usr/binï¼mysqladmin mysqldumpç­å½ä»¤ï¼\n## å¯å¨èæ¬\n/usr/lib/systemd/system/mysqld.service ï¼æ³¨åä¸º systemd æå¡ï¼\n\n\nï¼4ï¼å®è£ mysql æå¡å¨\n\nyum install mysql-community-server\n\n\n# mysql æå¡ç®¡ç\n\néè¿ yum æ¹å¼å®è£ mysql åï¼æ¬å°ä¼æä¸ä¸ªåä¸º mysqld ç systemd æå¡ã\n\nå¶æå¡ç®¡çååç®ä¾¿ï¼\n\n## æ¥çç¶æ\nsystemctl status mysqld\n## å¯ç¨æå¡\nsystemctl enable mysqld\n## ç¦ç¨æå¡\nsystemctl disable mysqld\n## å¯å¨æå¡\nsystemctl start mysqld\n## éå¯æå¡\nsystemctl restart mysqld\n## åæ­¢æå¡\nsystemctl stop mysqld\n\n\n\n# 1.3. åå§åæ°æ®åºå¯ç \n\næ¥çä¸ä¸åå§å¯ç \n\n$ grep \"password\" /var/log/mysqld.log\n2018-09-30T03:13:41.727736Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: %:lt+srWu4k1\n\n\næ§è¡å½ä»¤ï¼\n\nmysql -uroot -p<ä¸´æ¶å¯ç >\n\n\nè¾å¥ä¸´æ¶å¯ç ï¼è¿å¥ mysqlï¼å¦æè¦ä¿®æ¹å¯ç ï¼æ§è¡ä»¥ä¸æä»¤ï¼\n\nALTER user 'root'@'localhost' IDENTIFIED BY 'ä½ çå¯ç ';\n\n\næ³¨ï¼å¯ç å¼ºåº¦é»è®¤ä¸ºä¸­ç­ï¼å¤§å°åå­æ¯ãæ°å­ãç¹æ®ç¬¦å·ï¼åªæä¿®æ¹æååæè½ä¿®æ¹éç½®åè®¾ç½®æ´ç®åçå¯ç \n\n\n# 1.4. éç½®è¿ç¨è®¿é®\n\nCREATE USER 'root'@'%' IDENTIFIED BY 'ä½ çå¯ç ';\nGRANT ALL ON *.* TO 'root'@'%';\nALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'ä½ çå¯ç ';\nFLUSH PRIVILEGES;\n\n\n\n# 1.5. è·³è¿ç»å½è®¤è¯\n\nvim /etc/my.cnf\n\n\nå¨ [mysqld] ä¸é¢å ä¸ skip-grant-tables\n\nä½ç¨æ¯ç»å½æ¶è·³è¿ç»å½è®¤è¯ï¼æ¢å¥è¯è¯´å°±æ¯ root ä»ä¹å¯ç é½å¯ä»¥ç»å½è¿å»ã\n\næ§è¡ systemctl restart mysqldï¼éå¯ mysql\n\n\n# 2. åºæ¬è¿ç»´\n\n\n# 2.1. å®¢æ·ç«¯è¿æ¥\n\nè¯­æ³ï¼mysql -h<ä¸»æº> -P<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >\n\nå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nãç¤ºä¾ãè¿æ¥æ¬å° Mysql\n\n$ mysql -h 127.0.0.1 -P 3306 -u root -p\nEnter password:\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 13501\nServer version: 8.0.19 MySQL Community Server - GPL\n\nCopyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql>\n\n\n\n# 2.2. æ¥çè¿æ¥\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\n\n\n\n# 2.3. åå»ºç¨æ·\n\nCREATE USER 'username'@'host' IDENTIFIED BY 'password';\n\n\nè¯´æï¼\n\n * usernameï¼ä½ å°åå»ºçç¨æ·å\n * hostï¼æå®è¯¥ç¨æ·å¨åªä¸ªä¸»æºä¸å¯ä»¥ç»éï¼å¦ææ¯æ¬å°ç¨æ·å¯ç¨ localhostï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ä»ä»»æè¿ç¨ä¸»æºç»éï¼å¯ä»¥ä½¿ç¨ééç¬¦%\n * passwordï¼è¯¥ç¨æ·çç»éå¯ç ï¼å¯ç å¯ä»¥ä¸ºç©ºï¼å¦æä¸ºç©ºåè¯¥ç¨æ·å¯ä»¥ä¸éè¦å¯ç ç»éæå¡å¨\n\nç¤ºä¾ï¼\n\nCREATE USER 'dog'@'localhost' IDENTIFIED BY '123456';\nCREATE USER 'pig'@'192.168.1.101_' IDENDIFIED BY '123456';\nCREATE USER 'pig'@'%' IDENTIFIED BY '123456';\nCREATE USER 'pig'@'%' IDENTIFIED BY '';\nCREATE USER 'pig'@'%';\n\n\n> æ³¨æï¼å¨ Mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çã\n> \n> æä»¥ï¼éè¦å ä¸ IDENTIFIED WITH mysql_native_passwordï¼ä¾å¦ï¼CREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY '123456';\n\n\n# 2.4. æ¥çç¨æ·\n\n-- æ¥çææç¨æ·\nSELECT DISTINCT CONCAT('User: ''', user, '''@''', host, ''';') AS query\nFROM mysql.user;\n\n\n\n# 2.5. ææ\n\nå½ä»¤ï¼\n\nGRANT privileges ON databasename.tablename TO 'username'@'host'\n\n\nè¯´æï¼\n\n * privilegesï¼ç¨æ·çæä½æéï¼å¦SELECTï¼INSERTï¼UPDATEç­ï¼å¦æè¦æäºæçæéåä½¿ç¨ALL\n * databasenameï¼æ°æ®åºå\n * tablenameï¼è¡¨åï¼å¦æè¦æäºè¯¥ç¨æ·å¯¹æææ°æ®åºåè¡¨çç¸åºæä½æéåå¯ç¨*è¡¨ç¤ºï¼å¦*.*\n\nç¤ºä¾ï¼\n\nGRANT SELECT, INSERT ON test.user TO 'pig'@'%';\nGRANT ALL ON *.* TO 'pig'@'%';\nGRANT ALL ON maindataplus.* TO 'pig'@'%';\n\n\næ³¨æï¼\n\nç¨ä»¥ä¸å½ä»¤ææçç¨æ·ä¸è½ç»å¶å®ç¨æ·ææï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ææï¼ç¨ä»¥ä¸å½ä»¤:\n\n-- ä¸ºæå®ç¨æ·éç½®æå®æé\nGRANT privileges ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION;\n-- ä¸º root ç¨æ·åéæææé\nGRANT ALL ON *.* TO 'root'@'%' IDENTIFIED BY 'å¯ç ' WITH GRANT OPTION;\n\n\n\n# 2.6. æ¤éææ\n\nå½ä»¤:\n\nREVOKE privilege ON databasename.tablename FROM 'username'@'host';\n\n\nè¯´æ:\n\nprivilege, databasename, tablenameï¼åææé¨å\n\nä¾å­:\n\nREVOKE SELECT ON *.* FROM 'pig'@'%';\n\n\næ³¨æ:\n\nåå¦ä½ å¨ç»ç¨æ·'pig'@'%'ææçæ¶åæ¯è¿æ ·çï¼æç±»ä¼¼çï¼ï¼GRANT SELECT ON test.user TO 'pig'@'%'ï¼åå¨ä½¿ç¨REVOKE SELECT ON *.* FROM 'pig'@'%';å½ä»¤å¹¶ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çSELECT æä½ãç¸åï¼å¦æææä½¿ç¨çæ¯GRANT SELECT ON *.* TO 'pig'@'%';åREVOKE SELECT ON test.user FROM 'pig'@'%';å½ä»¤ä¹ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çSelectæéã\n\nå·ä½ä¿¡æ¯å¯ä»¥ç¨å½ä»¤SHOW GRANTS FOR 'pig'@'%'; æ¥çã\n\n\n# 2.7. æ¥çææ\n\n-- æ¥çç¨æ·æé\nSHOW GRANTS FOR 'root'@'%';\n\n\n\n# 2.8. æ´æ¹ç¨æ·å¯ç \n\nSET PASSWORD FOR 'username'@'host' = PASSWORD('newpassword');\n\n\nå¦ææ¯å½åç»éç¨æ·ç¨:\n\nSET PASSWORD = PASSWORD(\"newpassword\");\n\n\nç¤ºä¾ï¼\n\nSET PASSWORD FOR 'pig'@'%' = PASSWORD(\"123456\");\n\n\n\n# 2.9. å¤ä»½ä¸æ¢å¤\n\nMysql å¤ä»½æ°æ®ä½¿ç¨ mysqldump å½ä»¤ã\n\nmysqldump å°æ°æ®åºä¸­çæ°æ®å¤ä»½æä¸ä¸ªææ¬æä»¶ï¼è¡¨çç»æåè¡¨ä¸­çæ°æ®å°å­å¨å¨çæçææ¬æä»¶ä¸­ã\n\nå¤ä»½ï¼\n\n# å¤ä»½ä¸ä¸ªæ°æ®åº\n\nè¯­æ³ï¼\n\nmysqldump -h <host> -P<port> -u<username> -p<database> [<table1> <table2> ...] > backup.sql\n\n\n * host - Mysql Server ç host\n * port - Mysql Server çç«¯å£\n * username - æ°æ®åºç¨æ·\n * dbname - æ°æ®åºåç§°\n * table1 å table2 åæ°è¡¨ç¤ºéè¦å¤ä»½çè¡¨çåç§°ï¼ä¸ºç©ºåæ´ä¸ªæ°æ®åºå¤ä»½ï¼\n * BackupName.sql åæ°è¡¨è®¾è®¡å¤ä»½æä»¶çåç§°ï¼æä»¶ååé¢å¯ä»¥å ä¸ä¸ä¸ªç»å¯¹è·¯å¾ãéå¸¸å°æ°æ®åºè¢«åæä¸ä¸ªåç¼åä¸º sql çæä»¶\n\n# å¤ä»½å¤ä¸ªæ°æ®åº\n\nmysqldump -u <username> -p --databases <database1> <database2> ... > backup.sql\n\n\n# å¤ä»½æææ°æ®åº\n\nmysqldump -u <username> -p --all-databases > backup.sql\n\n\n# æ¢å¤ä¸ä¸ªæ°æ®åº\n\nMysql æ¢å¤æ°æ®ä½¿ç¨ mysql å½ä»¤ã\n\nè¯­æ³ï¼\n\nmysql -h <host> -P<port> -u<username> -p<database> < backup.sql\n\n\n# æ¢å¤æææ°æ®åº\n\nmysql -u<username> -p --all-databases < backup.sql\n\n\n\n# 2.10. å¸è½½\n\nï¼1ï¼æ¥çå·²å®è£ç mysql\n\n$ rpm -qa | grep -i mysql\nperl-DBD-MySQL-4.023-6.el7.x86_64\nmysql80-community-release-el7-1.noarch\nmysql-community-common-8.0.12-1.el7.x86_64\nmysql-community-client-8.0.12-1.el7.x86_64\nmysql-community-libs-compat-8.0.12-1.el7.x86_64\nmysql-community-libs-8.0.12-1.el7.x86_64\n\n\nï¼2ï¼å¸è½½ mysql\n\nyum remove mysql-community-server.x86_64\n\n\n\n# 2.11. ä¸»ä»èç¹é¨ç½²\n\nåè®¾éè¦éç½®ä¸ä¸ªä¸»ä» Mysql æå¡å¨ç¯å¢\n\n * master èç¹ï¼192.168.8.10\n * slave èç¹ï¼192.168.8.11\n\n# ä¸»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=1\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ ID å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç ID å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼åå»ºç¨äºåæ­¥çç¨æ·\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\nPassword:\n\n\næ§è¡ä»¥ä¸ SQLï¼\n\n-- a. åå»º slave ç¨æ·\nCREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'å¯ç ';\n-- ä¸º slave èµäº REPLICATION SLAVE æé\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%';\n\n-- b. æèï¼åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·è½å¨ä»»æä¸»æºä¸ç»å½\n-- å¦ææå¤ä¸ªä»èç¹ï¼åæ³è®©ææä»èç¹é½ä½¿ç¨ç»ä¸çç¨æ·åãå¯ç è®¤è¯ï¼å¯ä»¥èèè¿ç§æ¹å¼\nCREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'å¯ç ';\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'%';\n\n-- å·æ°ææè¡¨ä¿¡æ¯\nFLUSH PRIVILEGES;\n\n\n> æ³¨æï¼å¨ Mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çãæä»¥ï¼éè¦å ä¸ IDENTIFIED WITH mysql_native_password BY 'password'\n\nè¡¥åç¨æ·ç®¡ç SQL:\n\n-- æ¥çææç¨æ·\nSELECT DISTINCT CONCAT('User: ''', user, '''@''', host, ''';') AS query\nFROM mysql.user;\n\n-- æ¥çç¨æ·æé\nSHOW GRANTS FOR 'root'@'%';\n\n-- åå»ºç¨æ·\n-- a. åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·åªè½å¨ä¸»æº 192.168.8.11 ä¸ç»å½\nCREATE USER 'slave'@'192.168.8.11' IDENTIFIED WITH mysql_native_password BY 'å¯ç ';\n-- ä¸º slave èµäº REPLICATION SLAVE æé\nGRANT REPLICATION SLAVE ON *.* TO 'slave'@'192.168.8.11';\n\n-- å é¤ç¨æ·\nDROP USER 'slave'@'192.168.8.11';\n\n\nï¼3ï¼å è¯»é\n\nä¸ºäºä¸»åºä¸ä»åºçæ°æ®ä¿æä¸è´ï¼æä»¬åä¸º mysql å å¥è¯»éï¼ä½¿å¶åä¸ºåªè¯»ã\n\nmysql> FLUSH TABLES WITH READ LOCK;\n\n\nï¼4ï¼æ¥çä¸»èç¹ç¶æ\n\nmysql> show master status;\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB                            | Executed_Gtid_Set |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| mysql-bin.000001 |     4202 |              | mysql,information_schema,performance_schema |                   |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n1 row in set (0.00 sec)\n\n\n> æ³¨æï¼éè¦è®°å½ä¸ File å Positionï¼åé¢ä¼ç¨å°ã\n\nï¼5ï¼å¯¼åº sql\n\nmysqldump -u root -p --all-databases --master-data > dbdump.sql\n\n\nï¼6ï¼è§£é¤è¯»é\n\nmysql> UNLOCK TABLES;\n\n\nï¼7ï¼å° sql è¿ç¨ä¼ éå°ä»èç¹ä¸\n\nscp dbdump.sql root@192.168.8.11:/home\n\n\n# ä»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=2\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ ID å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç ID å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼å¯¼å¥ sql\n\nmysql -u root -p < /home/dbdump.sql\n\n\nï¼3ï¼å¨ä»èç¹ä¸å»ºç«ä¸ä¸»èç¹çè¿æ¥\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\nPassword:\n\n\næ§è¡ä»¥ä¸ SQLï¼\n\n-- åæ­¢ä»èç¹æå¡\nSTOP SLAVE;\n\n-- æ³¨æï¼MASTER_USER å\nCHANGE MASTER TO\nMASTER_HOST='192.168.8.10',\nMASTER_USER='slave',\nMASTER_PASSWORD='å¯ç ',\nMASTER_LOG_FILE='binlog.000001',\nMASTER_LOG_POS=4202;\n\n\n * MASTER_LOG_FILE å MASTER_LOG_POS åæ°è¦åå«ä¸ show master status æä»¤è·å¾ç File å Position å±æ§å¼å¯¹åºã\n * MASTER_HOST æ¯ä¸»èç¹ç HOSTã\n * MASTER_USER å MASTER_PASSWORD æ¯å¨ä¸»èç¹ä¸æ³¨åçç¨æ·åå¯ç ã\n\nï¼4ï¼å¯å¨ slave è¿ç¨\n\nmysql> start slave;\n\n\nï¼5ï¼æ¥çä¸»ä»åæ­¥ç¶æ\n\nmysql> show slave status\\G;\n\n\nè¯´æï¼å¦æä»¥ä¸ä¸¤é¡¹åæ°åä¸º YESï¼è¯´æéç½®æ­£ç¡®ã\n\n * Slave_IO_Running\n * Slave_SQL_Running\n\nï¼6ï¼å°ä»èç¹è®¾ä¸ºåªè¯»\n\nmysql> set global read_only=1;\nmysql> set global super_read_only=1;\nmysql> show global variables like \"%read_only%\";\n+-----------------------+-------+\n| Variable_name         | Value |\n+-----------------------+-------+\n| innodb_read_only      | OFF   |\n| read_only             | ON    |\n| super_read_only       | ON    |\n| transaction_read_only | OFF   |\n+-----------------------+-------+\n\n\n> æ³¨ï¼è®¾ç½® slave æå¡å¨ä¸ºåªè¯»ï¼å¹¶ä¸å½±åä¸»ä»åæ­¥ã\n\n\n# 3. æå¡å¨éç½®\n\n> å¤§é¨åæåµä¸ï¼é»è®¤çåºæ¬éç½®å·²ç»è¶³å¤åºä»å¤§å¤æ°åºæ¯ï¼ä¸è¦è½»æä¿®æ¹ Mysql æå¡å¨éç½®ï¼é¤éä½ æç¡®ç¥éä¿®æ¹é¡¹æ¯æççã\n> \n> å°½éä¸è¦ä½¿ç¨ Mysql çç¼å­åè½ï¼å ä¸ºå¶è¦æ±æ¯æ¬¡è¯·æ±åæ°å®å¨ç¸åï¼æè½å½ä¸­ç¼å­ãè¿ç§æ¹å¼å®éä¸å¹¶ä¸é«æï¼è¿ä¼å¢å é¢å¤å¼éï¼å®éä¸å¡åºæ¯ä¸­ä¸è¬ä½¿ç¨ Redis ç­ key-value å­å¨æ¥è§£å³ç¼å­é®é¢ï¼æ§è½è¿é«äº Mysql çæ¥è¯¢ç¼å­ã\n\n\n# 3.1. éç½®æä»¶è·¯å¾\n\néç½® Mysql é¦åè¦ç¡®å®éç½®æä»¶å¨åªå¿ã\n\nä¸å Linux æä½ç³»ç»ä¸ï¼Mysql éç½®æä»¶è·¯å¾å¯è½ä¸åãéå¸¸çè·¯å¾ä¸º /etc/my.cnf æ /etc/mysql/my.cnf ã\n\nå¦æä¸ç¥ééç½®æä»¶è·¯å¾ï¼å¯ä»¥å°è¯ä»¥ä¸æä½ï¼\n\n# which mysqld\n/usr/sbin/mysqld\n# /usr/sbin/mysqld --verbose --help | grep -A 1 'Default options'\nDefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf\n\n\n\n# 3.2. éç½®é¡¹è¯­æ³\n\nMysql éç½®é¡¹è®¾ç½®é½ä½¿ç¨å°åï¼åè¯ä¹é´ç¨ä¸åçº¿ææ¨ªçº¿éå¼ï¼äºèæ¯ç­ä»·çï¼ã\n\nå»ºè®®ä½¿ç¨åºå®çé£æ ¼ï¼è¿æ ·æ£ç´¢éç½®é¡¹æ¶è¾ä¸ºæ¹ä¾¿ã\n\n# è¿ä¸¤ç§æ ¼å¼ç­ä»·\n/usr/sbin/mysqld --auto-increment-offset=5\n/usr/sbin/mysqld --auto_increment_offset=5\n\n\n\n# 3.3. å¸¸ç¨éç½®é¡¹è¯´æ\n\n> è¿éä»ç»æ¯è¾å¸¸ç¨çåºæ¬éç½®ï¼æ´å¤éç½®é¡¹è¯´æå¯ä»¥åèï¼Mysql æå¡å¨éç½®è¯´æ\n\nåç»åºä¸ä»½å¸¸ç¨éç½®æ¨¡æ¿ï¼åå®¹å¦ä¸ï¼\n\n[mysqld]\n# GENERAL\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = InnoDB\ndefault_time_zone = '+8:00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# LOG\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# InnoDB\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = O_DIRECT\n\n# MyIsam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# OTHER\n# -------------------------------------------------------------------------------\ntmp_table_size = 32M\nmax_heap_table_size = 32M\nquery_cache_type = 0\nquery_cache_size = 0\nmax_connections = <value>\nthread_cache = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n * GENERAL\n   \n   * datadir - mysql æ°æ®æä»¶æå¨ç®å½\n   * socket - scoket æä»¶\n   * pid_file - PID æä»¶\n   * user - å¯å¨ mysql æå¡è¿ç¨çç¨æ·\n   * port - æå¡ç«¯å£å·ï¼é»è®¤ 3306\n   * default_storage_engine - mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ InnoDB\n   * default_time_zone - é»è®¤æ¶åºãä¸­å½å¤§é¨åå°åºå¨ä¸å«åºï¼å³ +8:00\n   * character_set_server - æ°æ®åºé»è®¤å­ç¬¦é\n   * collation_server - æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\n\n * LOG\n   \n   * log_error - éè¯¯æ¥å¿æä»¶å°å\n   * slow_query_log - éè¯¯æ¥å¿æä»¶å°å\n\n * InnoDB\n   \n   * innodb_buffer_pool_size - InnoDB ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å MyISAMãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç I/O è¶å°ã\n     * å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸,ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n     * æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n     * é»è®¤å¼ï¼128Mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\n   * innodb_log_file_size - æ¥å¿æä»¶çå¤§å°ãé»è®¤å¼ï¼48Mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\n   * innodb_file_per_table - è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ãé»è®¤å¼ 1ï¼å¼å¯ã\n   * innodb_flush_method - è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼O_DSYNCï¼O_DIRECTãé»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ SAN æè raidï¼å»ºè®®ç¨ O_DIRECTï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ O_DIRECT\n     * fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n     * O_DSYNCï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n     * O_DIRECTï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n\n * MyIsam\n   \n   * key_buffer_size - æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º MYISAM æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ INNODB å¼ææ æãç¸å½å½±å MyISAM çæ§è½ã\n     * ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« OS ç¨æ¥ç¼å²è¡æ°æ®\n     * çè³å¨ä½ å¹¶ä¸ä½¿ç¨ MyISAM è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64M åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n     * é»è®¤å¼ 8Mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4GB å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256M æ 384Mã\n     * æ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\n\n * OTHER\n   \n   * tmp_table_size - åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16Mï¼æ­¤å¤è®¾ç½®æ 128M\n   * max_heap_table_size - ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16Mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ãè¶éçè¯ï¼MySQL å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç MyISAM è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ IO ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\n   * query_cache_type - è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® SQL_CACHE æç¼å­ã\n   * query_cache_size - é»è®¤å¼ 1Mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ãç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n   * max_connections - æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000ãå¦æå¨è®¿é®æ¶ç»å¸¸åºç° Too Many Connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\n   * thread_cache - å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éãé»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼\n     * æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1G â> 8ï¼2G â> 16ï¼ 3G â> 32ï¼ >3G â> 64ï¼\n     * æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç Threads_connected å¼ã\n   * open_files_limit - MySQL æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n     * å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n     * å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ª\n     * æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ Can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n     * è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\n\n\n# 4. å¸¸è§é®é¢\n\n\n# 4.1. Too many connections\n\nç°è±¡\n\nå°è¯è¿æ¥ Mysql æ¶ï¼éå° Too many connections éè¯¯ã\n\nåå \n\næ°æ®åºè¿æ¥çº¿ç¨æ°è¶è¿æå¤§å¼ï¼è®¿é®è¢«æç»ã\n\nè§£å³æ¹æ¡\n\nå¦æå®éè¿æ¥çº¿ç¨æ°è¿å¤§ï¼å¯ä»¥èèå¢å æå¡å¨èç¹æ¥åæµï¼å¦æå®éçº¿ç¨æ°å¹¶ä¸ç®è¿å¤§ï¼é£ä¹å¯ä»¥éç½® max_connections æ¥å¢å åè®¸çæå¤§è¿æ¥æ°ãéè¦æ³¨æçæ¯ï¼è¿æ¥æ°ä¸å®è¿å¤§ï¼ä¸è¬æ¥è¯´ï¼ååºæ¯ç§æ 2000 ä¸ªå¹¶åè¿æ¥æ¶ï¼å°±å¯ä»¥èèæ©å®¹äºï¼å¥åº·çç¶æåºè¯¥ç»´æå¨æ¯ç§ 1000 ä¸ªå¹¶åè¿æ¥å·¦å³ã\n\nï¼1ï¼æ¥çæå¤§è¿æ¥æ°\n\nmysql> show variables like '%max_connections%';\n+------------------------+-------+\n| Variable_name          | Value |\n+------------------------+-------+\n| max_connections        | 151   |\n| mysqlx_max_connections | 100   |\n+------------------------+-------+\n\n\nï¼2ï¼æ¥çæå¡å¨ååºçæå¤§è¿æ¥æ°\n\nmysql> show global status like 'Max_used_connections';\n+----------------------+-------+\n| Variable_name        | Value |\n+----------------------+-------+\n| Max_used_connections | 142   |\n+----------------------+-------+\n1 row in set (0.00 sec)\n\n\nï¼3ï¼ä¸´æ¶è®¾ç½®æå¤§è¿æ¥æ°\n\nset GLOBAL max_connections=256;\n\n\næ³¨æï¼å½æå¡å¨éå¯æ¶ï¼æå¤§è¿æ¥æ°ä¼è¢«éç½®ã\n\nï¼4ï¼æ°¸ä¹è®¾ç½®æå¤§è¿æ¥æ°\n\nä¿®æ¹ /etc/my.cnf éç½®æä»¶ï¼å¨ [mysqld] æ·»å ä»¥ä¸éç½®ï¼\n\nmax_connections=256\n\n\néå¯ mysql ä»¥çæ\n\nï¼5ï¼ä¿®æ¹ Linux æå¤§æä»¶æ°éå¶\n\nè®¾ç½®äºæå¤§è¿æ¥æ°ï¼å¦æè¿æ¯æ²¡æçæï¼èèæ£æ¥ä¸ä¸ Linux æå¤§æä»¶æ°\n\nMysql æå¤§è¿æ¥æ°ä¼åå°æå¤§æä»¶æ°éå¶ï¼vim /etc/security/limits.confï¼æ·»å  mysql ç¨æ·éç½®\n\nmysql hard nofile 65535\nmysql soft nofile 65535\n\n\nï¼6ï¼æ£æ¥ LimitNOFILE\n\nå¦ææ¯ä½¿ç¨ rpm æ¹å¼å®è£ mysqlï¼æ£æ¥ mysqld.service æä»¶ä¸­ç LimitNOFILE æ¯å¦éç½®çå¤ªå°ã\n\n\n# 4.2. æ¶åºï¼time_zoneï¼åå·®\n\nç°è±¡\n\næ°æ®åºä¸­å­å¨ç Timestamp å­æ®µå¼æ¯çå®å¼å°äº 13 ä¸ªå°æ¶ã\n\nåå \n\n * å½ JDBC ä¸ MySQL å¼å§å»ºç«è¿æ¥æ¶ï¼ä¼è·åæå¡å¨åæ°ã\n * å½ MySQL ç time_zone å¼ä¸º SYSTEM æ¶ï¼ä¼å system_time_zone å¼ä½ä¸ºåè°æ¶åºï¼è¥å¾å°çæ¯ CST é£ä¹ Java ä¼è¯¯ä»¥ä¸ºè¿æ¯ CST -0500 ï¼å æ­¤ä¼ç»åºéè¯¯çæ¶åºä¿¡æ¯ï¼å½åä¸è¬æ¯CST +0800ï¼å³ä¸å«åºï¼ã\n\næ¥çæ¶åºæ¹æ³ï¼\n\néè¿ show variables like '%time_zone%'; å½ä»¤æ¥ç Mysql æ¶åºéç½®ï¼\n\nmysql> show variables like '%time_zone%';\n+------------------+--------+\n| Variable_name    | Value  |\n+------------------+--------+\n| system_time_zone | CST    |\n| time_zone        | SYSTEM |\n+------------------+--------+\n\n\nè§£å³æ¹æ¡\n\næ¹æ¡ä¸\n\nmysql> set global time_zone = '+08:00';\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> set time_zone = '+08:00';\nQuery OK, 0 rows affected (0.00 sec)\n\n\næ¹æ¡äº\n\nä¿®æ¹ my.cnf æä»¶ï¼å¨ [mysqld] èä¸å¢å  default-time-zone='+08:00' ï¼ç¶åéå¯ã\n\n\n# 4.3. æ°æ®è¡¨æåå¦ä½ä¿®å¤\n\nä½¿ç¨ myisamchk æ¥ä¿®å¤ï¼å·ä½æ­¥éª¤ï¼\n\n 1. ä¿®å¤åå° mysql æå¡åæ­¢ã\n 2. æå¼å½ä»¤è¡æ¹å¼ï¼ç¶åè¿å¥å° mysql ç bin ç®å½ã\n 3. æ§è¡ myisamchk ârecover æ°æ®åºæå¨è·¯ /*.MYI\n\nä½¿ç¨ repair table æè OPTIMIZE table å½ä»¤æ¥ä¿®å¤ï¼REPAIR TABLE table_name ä¿®å¤è¡¨ OPTIMIZE TABLE table_name ä¼åè¡¨ REPAIR TABLE ç¨äºä¿®å¤è¢«ç ´åçè¡¨ã OPTIMIZE TABLE ç¨äºåæ¶é²ç½®çæ°æ®åºç©ºé´ï¼å½è¡¨ä¸çæ°æ®è¡è¢«å é¤æ¶ï¼æå æ®çç£çç©ºé´å¹¶æ²¡æç«å³è¢«åæ¶ï¼ä½¿ç¨äº OPTIMIZE TABLE å½ä»¤åè¿äºç©ºé´å°è¢«åæ¶ï¼å¹¶ä¸å¯¹ç£çä¸çæ°æ®è¡è¿è¡éæï¼æ³¨æï¼æ¯ç£çä¸ï¼èéæ°æ®åºï¼\n\n\n# 4.4. æ°æ®ç»æ\n\n> é®é¢ç°è±¡ï¼ERROR 1071: Specified key was too long; max key length is 767 bytes\n\né®é¢åå ï¼Mysql é»è®¤æåµä¸åä¸ªåçç´¢å¼ä¸è½è¶è¿ 767 ä½ï¼ä¸åçæ¬å¯è½å­å¨å·®å¼ï¼ ã\n\nè§£å³æ¹æ³ï¼ä¼åç´¢å¼ç»æï¼ç´¢å¼å­æ®µä¸å®è¿é¿ã\n\n\n# 5. èæ¬\n\nè¿éæ¨èæåçå ä¸ªä¸é®è¿ç»´èæ¬ï¼éå¸¸æ¹ä¾¿ï¼æ¬¢è¿ä½¿ç¨ï¼\n\n * Mysql å®è£èæ¬\n * Mysql å¤ä»½èæ¬\n\n\n# 6. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * https://www.cnblogs.com/xiaopotian/p/8196464.html\n * https://www.cnblogs.com/bigbrotherer/p/7241845.html\n * https://blog.csdn.net/managementandjava/article/details/80039650\n * http://www.manongjc.com/article/6996.html\n * https://www.cnblogs.com/xyabk/p/8967990.html\n * MySQL 8.0 ä¸»ä»ï¼Master-Slaveï¼éç½®\n * Mysql ä¸»ä»åæ­¥å®æ\n * MySQL å¤ä»½åæ¢å¤æºå¶",normalizedContent:"# mysql è¿ç»´\n\n> å¦æä½ çå¬å¸æ dbaï¼é£ä¹ææ­åä½ ï¼ä½ å¯ä»¥æ è§ mysql è¿ç»´ãå¦æä½ çå¬å¸æ²¡æ dbaï¼é£ä½ å°±å¥½å¥½å­¦ä¸¤æ mysql åºæ¬è¿ç»´æä½ï¼è¡èµ°æ±æ¹ï¼é²èº«å¿å¤ã\n\n\n# 1. å®è£é¨ç½²\n\n\n# 1.1. windows å®è£\n\nï¼1ï¼ä¸è½½ mysql 5.7 åå®è£ç\n\nä¸è½½å°åï¼https://dev.mysql.com/downloads/mysql/5.7.html#downloads\n\nï¼2ï¼è§£åå¹¶åå»º my.ini å¨æ ¹ç®å½\n\nmy.ini æä»¶ç¤ºä¾ï¼\n\n[mysqld]\n#è®¾ç½®3306ç«¯å£\nport = 3306\n# è®¾ç½®mysqlçå®è£ç®å½ è¿åæ¢æèªå·±è§£åçè·¯å¾\nbasedir=d:\\\\tools\\\\db\\\\mysql\\\\mysql-5.7.31\n# åè®¸æå¤§è¿æ¥æ°\nmax_connections=200\n# æå¡ç«¯ä½¿ç¨çå­ç¬¦éé»è®¤ä¸º8æ¯ç¹ç¼ç çlatin1å­ç¬¦é\ncharacter-set-server=utf8\n# åå»ºæ°è¡¨æ¶å°ä½¿ç¨çé»è®¤å­å¨å¼æ\ndefault-storage-engine=innodb\n\n[client]\n# è®¾ç½®mysqlå®¢æ·ç«¯é»è®¤å­ç¬¦é\ndefault-character-set=utf8\n\n\nï¼3ï¼æ§è¡å®è£å½ä»¤\n\nå¨æ§å¶å° cmd ä¸­ä¾æ¬¡æ§è¡ä»¥ä¸å®è£å½ä»¤\n\ncd d:\\\\tools\\\\db\\\\mysql\\\\mysql-5.7.31\nmysqld --initialize\nmysqld -install\n\n\nè¯´æï¼\n\n * mysqld --initialize ä¼èªå¨åå§ååå»º data æä»¶å¤¹å¹¶åå§å mysqlã\n * mysqld -install ä¼å®è£ mysql æå¡ã\n\nï¼4ï¼å¯å¨æå¡\n\nå¨æ§å¶å°æ§è¡ net start mysql å¯å¨æå¡ã\n\n\n# 1.2. centos å®è£\n\n> æ¬æä»ä»ç» rpm å®è£æ¹å¼\n\n# å®è£ mysql yum æº\n\nå®æ¹ä¸è½½å°åï¼https://dev.mysql.com/downloads/repo/yum/\n\nï¼1ï¼ä¸è½½ yum æº\n\nwget https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\n\n\nï¼2ï¼å®è£ yum repo æä»¶å¹¶æ´æ° yum ç¼å­\n\nrpm -ivh mysql80-community-release-el7-1.noarch.rpm\n\n\næ§è¡ç»æï¼\n\nä¼å¨ /etc/yum.repos.d/ ç®å½ä¸çæä¸¤ä¸ª repo æä»¶\n\n$ ls | grep mysql\nmysql-community.repo\nmysql-community-source.repo\n\n\næ´æ° yumï¼\n\nyum clean all\nyum makecache\n\n\nï¼3ï¼æ¥ç rpm å®è£ç¶æ\n\n$ yum search mysql | grep server\nmysql-community-common.i686 : mysql database common files for server and client\nmysql-community-common.x86_64 : mysql database common files for server and\nmysql-community-test.x86_64 : test suite for the mysql database server\n                       : administering mysql servers\nmysql-community-server.x86_64 : a very fast and reliable sql database server\n\n\néè¿ yum å®è£ mysql æå ä¸ªéè¦ç®å½ï¼\n\n## éç½®æä»¶\n/etc/my.cnf\n## æ°æ®åºç®å½\n/var/lib/mysql/\n## éç½®æä»¶\n/usr/share/mysqlï¼mysql.serverå½ä»¤åéç½®æä»¶ï¼\n## ç¸å³å½ä»¤\n/usr/binï¼mysqladmin mysqldumpç­å½ä»¤ï¼\n## å¯å¨èæ¬\n/usr/lib/systemd/system/mysqld.service ï¼æ³¨åä¸º systemd æå¡ï¼\n\n\nï¼4ï¼å®è£ mysql æå¡å¨\n\nyum install mysql-community-server\n\n\n# mysql æå¡ç®¡ç\n\néè¿ yum æ¹å¼å®è£ mysql åï¼æ¬å°ä¼æä¸ä¸ªåä¸º mysqld ç systemd æå¡ã\n\nå¶æå¡ç®¡çååç®ä¾¿ï¼\n\n## æ¥çç¶æ\nsystemctl status mysqld\n## å¯ç¨æå¡\nsystemctl enable mysqld\n## ç¦ç¨æå¡\nsystemctl disable mysqld\n## å¯å¨æå¡\nsystemctl start mysqld\n## éå¯æå¡\nsystemctl restart mysqld\n## åæ­¢æå¡\nsystemctl stop mysqld\n\n\n\n# 1.3. åå§åæ°æ®åºå¯ç \n\næ¥çä¸ä¸åå§å¯ç \n\n$ grep \"password\" /var/log/mysqld.log\n2018-09-30t03:13:41.727736z 5 [note] [my-010454] [server] a temporary password is generated for root@localhost: %:lt+srwu4k1\n\n\næ§è¡å½ä»¤ï¼\n\nmysql -uroot -p<ä¸´æ¶å¯ç >\n\n\nè¾å¥ä¸´æ¶å¯ç ï¼è¿å¥ mysqlï¼å¦æè¦ä¿®æ¹å¯ç ï¼æ§è¡ä»¥ä¸æä»¤ï¼\n\nalter user 'root'@'localhost' identified by 'ä½ çå¯ç ';\n\n\næ³¨ï¼å¯ç å¼ºåº¦é»è®¤ä¸ºä¸­ç­ï¼å¤§å°åå­æ¯ãæ°å­ãç¹æ®ç¬¦å·ï¼åªæä¿®æ¹æååæè½ä¿®æ¹éç½®åè®¾ç½®æ´ç®åçå¯ç \n\n\n# 1.4. éç½®è¿ç¨è®¿é®\n\ncreate user 'root'@'%' identified by 'ä½ çå¯ç ';\ngrant all on *.* to 'root'@'%';\nalter user 'root'@'%' identified with mysql_native_password by 'ä½ çå¯ç ';\nflush privileges;\n\n\n\n# 1.5. è·³è¿ç»å½è®¤è¯\n\nvim /etc/my.cnf\n\n\nå¨ [mysqld] ä¸é¢å ä¸ skip-grant-tables\n\nä½ç¨æ¯ç»å½æ¶è·³è¿ç»å½è®¤è¯ï¼æ¢å¥è¯è¯´å°±æ¯ root ä»ä¹å¯ç é½å¯ä»¥ç»å½è¿å»ã\n\næ§è¡ systemctl restart mysqldï¼éå¯ mysql\n\n\n# 2. åºæ¬è¿ç»´\n\n\n# 2.1. å®¢æ·ç«¯è¿æ¥\n\nè¯­æ³ï¼mysql -h<ä¸»æº> -p<ç«¯å£> -u<ç¨æ·å> -p<å¯ç >\n\nå¦ææ²¡ææ¾å¼æå®å¯ç ï¼ä¼è¦æ±è¾å¥å¯ç æè½è®¿é®ã\n\nãç¤ºä¾ãè¿æ¥æ¬å° mysql\n\n$ mysql -h 127.0.0.1 -p 3306 -u root -p\nenter password:\nwelcome to the mysql monitor.  commands end with ; or \\g.\nyour mysql connection id is 13501\nserver version: 8.0.19 mysql community server - gpl\n\ncopyright (c) 2000, 2020, oracle and/or its affiliates. all rights reserved.\n\noracle is a registered trademark of oracle corporation and/or its\naffiliates. other names may be trademarks of their respective\nowners.\n\ntype 'help;' or '\\h' for help. type '\\c' to clear the current input statement.\n\nmysql>\n\n\n\n# 2.2. æ¥çè¿æ¥\n\nè¿æ¥å®æåï¼å¦æä½ æ²¡æåç»­çå¨ä½ï¼è¿ä¸ªè¿æ¥å°±å¤äºç©ºé²ç¶æï¼ä½ å¯ä»¥å¨ show processlist å½ä»¤ä¸­çå°å®ãå®¢æ·ç«¯å¦æå¤ªé¿æ¶é´æ²¡å¨éï¼è¿æ¥å¨å°±ä¼èªå¨å°å®æ­å¼ãè¿ä¸ªæ¶é´æ¯ç±åæ° wait_timeout æ§å¶çï¼é»è®¤å¼æ¯ 8 å°æ¶ã\n\n\n\n\n# 2.3. åå»ºç¨æ·\n\ncreate user 'username'@'host' identified by 'password';\n\n\nè¯´æï¼\n\n * usernameï¼ä½ å°åå»ºçç¨æ·å\n * hostï¼æå®è¯¥ç¨æ·å¨åªä¸ªä¸»æºä¸å¯ä»¥ç»éï¼å¦ææ¯æ¬å°ç¨æ·å¯ç¨ localhostï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ä»ä»»æè¿ç¨ä¸»æºç»éï¼å¯ä»¥ä½¿ç¨ééç¬¦%\n * passwordï¼è¯¥ç¨æ·çç»éå¯ç ï¼å¯ç å¯ä»¥ä¸ºç©ºï¼å¦æä¸ºç©ºåè¯¥ç¨æ·å¯ä»¥ä¸éè¦å¯ç ç»éæå¡å¨\n\nç¤ºä¾ï¼\n\ncreate user 'dog'@'localhost' identified by '123456';\ncreate user 'pig'@'192.168.1.101_' idendified by '123456';\ncreate user 'pig'@'%' identified by '123456';\ncreate user 'pig'@'%' identified by '';\ncreate user 'pig'@'%';\n\n\n> æ³¨æï¼å¨ mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çã\n> \n> æä»¥ï¼éè¦å ä¸ identified with mysql_native_passwordï¼ä¾å¦ï¼create user 'slave'@'%' identified with mysql_native_password by '123456';\n\n\n# 2.4. æ¥çç¨æ·\n\n-- æ¥çææç¨æ·\nselect distinct concat('user: ''', user, '''@''', host, ''';') as query\nfrom mysql.user;\n\n\n\n# 2.5. ææ\n\nå½ä»¤ï¼\n\ngrant privileges on databasename.tablename to 'username'@'host'\n\n\nè¯´æï¼\n\n * privilegesï¼ç¨æ·çæä½æéï¼å¦selectï¼insertï¼updateç­ï¼å¦æè¦æäºæçæéåä½¿ç¨all\n * databasenameï¼æ°æ®åºå\n * tablenameï¼è¡¨åï¼å¦æè¦æäºè¯¥ç¨æ·å¯¹æææ°æ®åºåè¡¨çç¸åºæä½æéåå¯ç¨*è¡¨ç¤ºï¼å¦*.*\n\nç¤ºä¾ï¼\n\ngrant select, insert on test.user to 'pig'@'%';\ngrant all on *.* to 'pig'@'%';\ngrant all on maindataplus.* to 'pig'@'%';\n\n\næ³¨æï¼\n\nç¨ä»¥ä¸å½ä»¤ææçç¨æ·ä¸è½ç»å¶å®ç¨æ·ææï¼å¦ææ³è®©è¯¥ç¨æ·å¯ä»¥ææï¼ç¨ä»¥ä¸å½ä»¤:\n\n-- ä¸ºæå®ç¨æ·éç½®æå®æé\ngrant privileges on databasename.tablename to 'username'@'host' with grant option;\n-- ä¸º root ç¨æ·åéæææé\ngrant all on *.* to 'root'@'%' identified by 'å¯ç ' with grant option;\n\n\n\n# 2.6. æ¤éææ\n\nå½ä»¤:\n\nrevoke privilege on databasename.tablename from 'username'@'host';\n\n\nè¯´æ:\n\nprivilege, databasename, tablenameï¼åææé¨å\n\nä¾å­:\n\nrevoke select on *.* from 'pig'@'%';\n\n\næ³¨æ:\n\nåå¦ä½ å¨ç»ç¨æ·'pig'@'%'ææçæ¶åæ¯è¿æ ·çï¼æç±»ä¼¼çï¼ï¼grant select on test.user to 'pig'@'%'ï¼åå¨ä½¿ç¨revoke select on *.* from 'pig'@'%';å½ä»¤å¹¶ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çselect æä½ãç¸åï¼å¦æææä½¿ç¨çæ¯grant select on *.* to 'pig'@'%';årevoke select on test.user from 'pig'@'%';å½ä»¤ä¹ä¸è½æ¤éè¯¥ç¨æ·å¯¹ test æ°æ®åºä¸­ user è¡¨çselectæéã\n\nå·ä½ä¿¡æ¯å¯ä»¥ç¨å½ä»¤show grants for 'pig'@'%'; æ¥çã\n\n\n# 2.7. æ¥çææ\n\n-- æ¥çç¨æ·æé\nshow grants for 'root'@'%';\n\n\n\n# 2.8. æ´æ¹ç¨æ·å¯ç \n\nset password for 'username'@'host' = password('newpassword');\n\n\nå¦ææ¯å½åç»éç¨æ·ç¨:\n\nset password = password(\"newpassword\");\n\n\nç¤ºä¾ï¼\n\nset password for 'pig'@'%' = password(\"123456\");\n\n\n\n# 2.9. å¤ä»½ä¸æ¢å¤\n\nmysql å¤ä»½æ°æ®ä½¿ç¨ mysqldump å½ä»¤ã\n\nmysqldump å°æ°æ®åºä¸­çæ°æ®å¤ä»½æä¸ä¸ªææ¬æä»¶ï¼è¡¨çç»æåè¡¨ä¸­çæ°æ®å°å­å¨å¨çæçææ¬æä»¶ä¸­ã\n\nå¤ä»½ï¼\n\n# å¤ä»½ä¸ä¸ªæ°æ®åº\n\nè¯­æ³ï¼\n\nmysqldump -h <host> -p<port> -u<username> -p<database> [<table1> <table2> ...] > backup.sql\n\n\n * host - mysql server ç host\n * port - mysql server çç«¯å£\n * username - æ°æ®åºç¨æ·\n * dbname - æ°æ®åºåç§°\n * table1 å table2 åæ°è¡¨ç¤ºéè¦å¤ä»½çè¡¨çåç§°ï¼ä¸ºç©ºåæ´ä¸ªæ°æ®åºå¤ä»½ï¼\n * backupname.sql åæ°è¡¨è®¾è®¡å¤ä»½æä»¶çåç§°ï¼æä»¶ååé¢å¯ä»¥å ä¸ä¸ä¸ªç»å¯¹è·¯å¾ãéå¸¸å°æ°æ®åºè¢«åæä¸ä¸ªåç¼åä¸º sql çæä»¶\n\n# å¤ä»½å¤ä¸ªæ°æ®åº\n\nmysqldump -u <username> -p --databases <database1> <database2> ... > backup.sql\n\n\n# å¤ä»½æææ°æ®åº\n\nmysqldump -u <username> -p --all-databases > backup.sql\n\n\n# æ¢å¤ä¸ä¸ªæ°æ®åº\n\nmysql æ¢å¤æ°æ®ä½¿ç¨ mysql å½ä»¤ã\n\nè¯­æ³ï¼\n\nmysql -h <host> -p<port> -u<username> -p<database> < backup.sql\n\n\n# æ¢å¤æææ°æ®åº\n\nmysql -u<username> -p --all-databases < backup.sql\n\n\n\n# 2.10. å¸è½½\n\nï¼1ï¼æ¥çå·²å®è£ç mysql\n\n$ rpm -qa | grep -i mysql\nperl-dbd-mysql-4.023-6.el7.x86_64\nmysql80-community-release-el7-1.noarch\nmysql-community-common-8.0.12-1.el7.x86_64\nmysql-community-client-8.0.12-1.el7.x86_64\nmysql-community-libs-compat-8.0.12-1.el7.x86_64\nmysql-community-libs-8.0.12-1.el7.x86_64\n\n\nï¼2ï¼å¸è½½ mysql\n\nyum remove mysql-community-server.x86_64\n\n\n\n# 2.11. ä¸»ä»èç¹é¨ç½²\n\nåè®¾éè¦éç½®ä¸ä¸ªä¸»ä» mysql æå¡å¨ç¯å¢\n\n * master èç¹ï¼192.168.8.10\n * slave èç¹ï¼192.168.8.11\n\n# ä¸»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=1\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ id å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç id å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼åå»ºç¨äºåæ­¥çç¨æ·\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\npassword:\n\n\næ§è¡ä»¥ä¸ sqlï¼\n\n-- a. åå»º slave ç¨æ·\ncreate user 'slave'@'%' identified with mysql_native_password by 'å¯ç ';\n-- ä¸º slave èµäº replication slave æé\ngrant replication slave on *.* to 'slave'@'%';\n\n-- b. æèï¼åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·è½å¨ä»»æä¸»æºä¸ç»å½\n-- å¦ææå¤ä¸ªä»èç¹ï¼åæ³è®©ææä»èç¹é½ä½¿ç¨ç»ä¸çç¨æ·åãå¯ç è®¤è¯ï¼å¯ä»¥èèè¿ç§æ¹å¼\ncreate user 'slave'@'%' identified with mysql_native_password by 'å¯ç ';\ngrant replication slave on *.* to 'slave'@'%';\n\n-- å·æ°ææè¡¨ä¿¡æ¯\nflush privileges;\n\n\n> æ³¨æï¼å¨ mysql 8 ä¸­ï¼é»è®¤å¯ç éªè¯ä¸åæ¯ passwordãæä»¥å¨åå»ºç¨æ·æ¶ï¼create user 'username'@'%' identified by 'password'; å®¢æ·ç«¯æ¯æ æ³è¿æ¥æå¡çãæä»¥ï¼éè¦å ä¸ identified with mysql_native_password by 'password'\n\nè¡¥åç¨æ·ç®¡ç sql:\n\n-- æ¥çææç¨æ·\nselect distinct concat('user: ''', user, '''@''', host, ''';') as query\nfrom mysql.user;\n\n-- æ¥çç¨æ·æé\nshow grants for 'root'@'%';\n\n-- åå»ºç¨æ·\n-- a. åå»º slave ç¨æ·ï¼å¹¶æå®è¯¥ç¨æ·åªè½å¨ä¸»æº 192.168.8.11 ä¸ç»å½\ncreate user 'slave'@'192.168.8.11' identified with mysql_native_password by 'å¯ç ';\n-- ä¸º slave èµäº replication slave æé\ngrant replication slave on *.* to 'slave'@'192.168.8.11';\n\n-- å é¤ç¨æ·\ndrop user 'slave'@'192.168.8.11';\n\n\nï¼3ï¼å è¯»é\n\nä¸ºäºä¸»åºä¸ä»åºçæ°æ®ä¿æä¸è´ï¼æä»¬åä¸º mysql å å¥è¯»éï¼ä½¿å¶åä¸ºåªè¯»ã\n\nmysql> flush tables with read lock;\n\n\nï¼4ï¼æ¥çä¸»èç¹ç¶æ\n\nmysql> show master status;\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| file             | position | binlog_do_db | binlog_ignore_db                            | executed_gtid_set |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n| mysql-bin.000001 |     4202 |              | mysql,information_schema,performance_schema |                   |\n+------------------+----------+--------------+---------------------------------------------+-------------------+\n1 row in set (0.00 sec)\n\n\n> æ³¨æï¼éè¦è®°å½ä¸ file å positionï¼åé¢ä¼ç¨å°ã\n\nï¼5ï¼å¯¼åº sql\n\nmysqldump -u root -p --all-databases --master-data > dbdump.sql\n\n\nï¼6ï¼è§£é¤è¯»é\n\nmysql> unlock tables;\n\n\nï¼7ï¼å° sql è¿ç¨ä¼ éå°ä»èç¹ä¸\n\nscp dbdump.sql root@192.168.8.11:/home\n\n\n# ä»èç¹ä¸çæä½\n\nï¼1ï¼ä¿®æ¹éç½®å¹¶éå¯\n\næ§è¡ vi /etc/my.cnf ï¼æ·»å å¦ä¸éç½®ï¼\n\n[mysqld]\nserver-id=2\nlog_bin=/var/lib/mysql/binlog\n\n\n * server-id - æå¡å¨ id å·ãå¨ä¸»ä»æ¶æä¸­ï¼æ¯å°æºå¨ç id å¿é¡»å¯ä¸ã\n * log_bin - åæ­¥çæ¥å¿è·¯å¾åæä»¶åï¼ä¸å®æ³¨æè¿ä¸ªç®å½è¦æ¯ mysql ææéåå¥çï¼\n\nä¿®æ¹åï¼éå¯ mysql ä½¿éç½®çæï¼\n\nsystemctl restart mysql\n\n\nï¼2ï¼å¯¼å¥ sql\n\nmysql -u root -p < /home/dbdump.sql\n\n\nï¼3ï¼å¨ä»èç¹ä¸å»ºç«ä¸ä¸»èç¹çè¿æ¥\n\nè¿å¥ mysql å½ä»¤æ§å¶å°ï¼\n\n$ mysql -u root -p\npassword:\n\n\næ§è¡ä»¥ä¸ sqlï¼\n\n-- åæ­¢ä»èç¹æå¡\nstop slave;\n\n-- æ³¨æï¼master_user å\nchange master to\nmaster_host='192.168.8.10',\nmaster_user='slave',\nmaster_password='å¯ç ',\nmaster_log_file='binlog.000001',\nmaster_log_pos=4202;\n\n\n * master_log_file å master_log_pos åæ°è¦åå«ä¸ show master status æä»¤è·å¾ç file å position å±æ§å¼å¯¹åºã\n * master_host æ¯ä¸»èç¹ç hostã\n * master_user å master_password æ¯å¨ä¸»èç¹ä¸æ³¨åçç¨æ·åå¯ç ã\n\nï¼4ï¼å¯å¨ slave è¿ç¨\n\nmysql> start slave;\n\n\nï¼5ï¼æ¥çä¸»ä»åæ­¥ç¶æ\n\nmysql> show slave status\\g;\n\n\nè¯´æï¼å¦æä»¥ä¸ä¸¤é¡¹åæ°åä¸º yesï¼è¯´æéç½®æ­£ç¡®ã\n\n * slave_io_running\n * slave_sql_running\n\nï¼6ï¼å°ä»èç¹è®¾ä¸ºåªè¯»\n\nmysql> set global read_only=1;\nmysql> set global super_read_only=1;\nmysql> show global variables like \"%read_only%\";\n+-----------------------+-------+\n| variable_name         | value |\n+-----------------------+-------+\n| innodb_read_only      | off   |\n| read_only             | on    |\n| super_read_only       | on    |\n| transaction_read_only | off   |\n+-----------------------+-------+\n\n\n> æ³¨ï¼è®¾ç½® slave æå¡å¨ä¸ºåªè¯»ï¼å¹¶ä¸å½±åä¸»ä»åæ­¥ã\n\n\n# 3. æå¡å¨éç½®\n\n> å¤§é¨åæåµä¸ï¼é»è®¤çåºæ¬éç½®å·²ç»è¶³å¤åºä»å¤§å¤æ°åºæ¯ï¼ä¸è¦è½»æä¿®æ¹ mysql æå¡å¨éç½®ï¼é¤éä½ æç¡®ç¥éä¿®æ¹é¡¹æ¯æççã\n> \n> å°½éä¸è¦ä½¿ç¨ mysql çç¼å­åè½ï¼å ä¸ºå¶è¦æ±æ¯æ¬¡è¯·æ±åæ°å®å¨ç¸åï¼æè½å½ä¸­ç¼å­ãè¿ç§æ¹å¼å®éä¸å¹¶ä¸é«æï¼è¿ä¼å¢å é¢å¤å¼éï¼å®éä¸å¡åºæ¯ä¸­ä¸è¬ä½¿ç¨ redis ç­ key-value å­å¨æ¥è§£å³ç¼å­é®é¢ï¼æ§è½è¿é«äº mysql çæ¥è¯¢ç¼å­ã\n\n\n# 3.1. éç½®æä»¶è·¯å¾\n\néç½® mysql é¦åè¦ç¡®å®éç½®æä»¶å¨åªå¿ã\n\nä¸å linux æä½ç³»ç»ä¸ï¼mysql éç½®æä»¶è·¯å¾å¯è½ä¸åãéå¸¸çè·¯å¾ä¸º /etc/my.cnf æ /etc/mysql/my.cnf ã\n\nå¦æä¸ç¥ééç½®æä»¶è·¯å¾ï¼å¯ä»¥å°è¯ä»¥ä¸æä½ï¼\n\n# which mysqld\n/usr/sbin/mysqld\n# /usr/sbin/mysqld --verbose --help | grep -a 1 'default options'\ndefault options are read from the following files in the given order:\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf\n\n\n\n# 3.2. éç½®é¡¹è¯­æ³\n\nmysql éç½®é¡¹è®¾ç½®é½ä½¿ç¨å°åï¼åè¯ä¹é´ç¨ä¸åçº¿ææ¨ªçº¿éå¼ï¼äºèæ¯ç­ä»·çï¼ã\n\nå»ºè®®ä½¿ç¨åºå®çé£æ ¼ï¼è¿æ ·æ£ç´¢éç½®é¡¹æ¶è¾ä¸ºæ¹ä¾¿ã\n\n# è¿ä¸¤ç§æ ¼å¼ç­ä»·\n/usr/sbin/mysqld --auto-increment-offset=5\n/usr/sbin/mysqld --auto_increment_offset=5\n\n\n\n# 3.3. å¸¸ç¨éç½®é¡¹è¯´æ\n\n> è¿éä»ç»æ¯è¾å¸¸ç¨çåºæ¬éç½®ï¼æ´å¤éç½®é¡¹è¯´æå¯ä»¥åèï¼mysql æå¡å¨éç½®è¯´æ\n\nåç»åºä¸ä»½å¸¸ç¨éç½®æ¨¡æ¿ï¼åå®¹å¦ä¸ï¼\n\n[mysqld]\n# general\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = innodb\ndefault_time_zone = '+8:00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# log\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# innodb\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = o_direct\n\n# myisam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# other\n# -------------------------------------------------------------------------------\ntmp_table_size = 32m\nmax_heap_table_size = 32m\nquery_cache_type = 0\nquery_cache_size = 0\nmax_connections = <value>\nthread_cache = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n * general\n   \n   * datadir - mysql æ°æ®æä»¶æå¨ç®å½\n   * socket - scoket æä»¶\n   * pid_file - pid æä»¶\n   * user - å¯å¨ mysql æå¡è¿ç¨çç¨æ·\n   * port - æå¡ç«¯å£å·ï¼é»è®¤ 3306\n   * default_storage_engine - mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ innodb\n   * default_time_zone - é»è®¤æ¶åºãä¸­å½å¤§é¨åå°åºå¨ä¸å«åºï¼å³ +8:00\n   * character_set_server - æ°æ®åºé»è®¤å­ç¬¦é\n   * collation_server - æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\n\n * log\n   \n   * log_error - éè¯¯æ¥å¿æä»¶å°å\n   * slow_query_log - éè¯¯æ¥å¿æä»¶å°å\n\n * innodb\n   \n   * innodb_buffer_pool_size - innodb ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å myisamãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç i/o è¶å°ã\n     * å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸,ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n     * æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n     * é»è®¤å¼ï¼128mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\n   * innodb_log_file_size - æ¥å¿æä»¶çå¤§å°ãé»è®¤å¼ï¼48mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\n   * innodb_file_per_table - è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ãé»è®¤å¼ 1ï¼å¼å¯ã\n   * innodb_flush_method - è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼o_dsyncï¼o_directãé»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ san æè raidï¼å»ºè®®ç¨ o_directï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ o_direct\n     * fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n     * o_dsyncï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n     * o_directï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n\n * myisam\n   \n   * key_buffer_size - æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º myisam æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ innodb å¼ææ æãç¸å½å½±å myisam çæ§è½ã\n     * ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« os ç¨æ¥ç¼å²è¡æ°æ®\n     * çè³å¨ä½ å¹¶ä¸ä½¿ç¨ myisam è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64m åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n     * é»è®¤å¼ 8mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4gb å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256m æ 384mã\n     * æ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\n\n * other\n   \n   * tmp_table_size - åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16mï¼æ­¤å¤è®¾ç½®æ 128m\n   * max_heap_table_size - ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ãè¶éçè¯ï¼mysql å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç myisam è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ io ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\n   * query_cache_type - è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® sql_cache æç¼å­ã\n   * query_cache_size - é»è®¤å¼ 1mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ãç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n   * max_connections - æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000ãå¦æå¨è®¿é®æ¶ç»å¸¸åºç° too many connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\n   * thread_cache - å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éãé»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼\n     * æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1g â> 8ï¼2g â> 16ï¼ 3g â> 32ï¼ >3g â> 64ï¼\n     * æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç threads_connected å¼ã\n   * open_files_limit - mysql æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n     * å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n     * å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ª\n     * æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n     * è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\n\n\n# 4. å¸¸è§é®é¢\n\n\n# 4.1. too many connections\n\nç°è±¡\n\nå°è¯è¿æ¥ mysql æ¶ï¼éå° too many connections éè¯¯ã\n\nåå \n\næ°æ®åºè¿æ¥çº¿ç¨æ°è¶è¿æå¤§å¼ï¼è®¿é®è¢«æç»ã\n\nè§£å³æ¹æ¡\n\nå¦æå®éè¿æ¥çº¿ç¨æ°è¿å¤§ï¼å¯ä»¥èèå¢å æå¡å¨èç¹æ¥åæµï¼å¦æå®éçº¿ç¨æ°å¹¶ä¸ç®è¿å¤§ï¼é£ä¹å¯ä»¥éç½® max_connections æ¥å¢å åè®¸çæå¤§è¿æ¥æ°ãéè¦æ³¨æçæ¯ï¼è¿æ¥æ°ä¸å®è¿å¤§ï¼ä¸è¬æ¥è¯´ï¼ååºæ¯ç§æ 2000 ä¸ªå¹¶åè¿æ¥æ¶ï¼å°±å¯ä»¥èèæ©å®¹äºï¼å¥åº·çç¶æåºè¯¥ç»´æå¨æ¯ç§ 1000 ä¸ªå¹¶åè¿æ¥å·¦å³ã\n\nï¼1ï¼æ¥çæå¤§è¿æ¥æ°\n\nmysql> show variables like '%max_connections%';\n+------------------------+-------+\n| variable_name          | value |\n+------------------------+-------+\n| max_connections        | 151   |\n| mysqlx_max_connections | 100   |\n+------------------------+-------+\n\n\nï¼2ï¼æ¥çæå¡å¨ååºçæå¤§è¿æ¥æ°\n\nmysql> show global status like 'max_used_connections';\n+----------------------+-------+\n| variable_name        | value |\n+----------------------+-------+\n| max_used_connections | 142   |\n+----------------------+-------+\n1 row in set (0.00 sec)\n\n\nï¼3ï¼ä¸´æ¶è®¾ç½®æå¤§è¿æ¥æ°\n\nset global max_connections=256;\n\n\næ³¨æï¼å½æå¡å¨éå¯æ¶ï¼æå¤§è¿æ¥æ°ä¼è¢«éç½®ã\n\nï¼4ï¼æ°¸ä¹è®¾ç½®æå¤§è¿æ¥æ°\n\nä¿®æ¹ /etc/my.cnf éç½®æä»¶ï¼å¨ [mysqld] æ·»å ä»¥ä¸éç½®ï¼\n\nmax_connections=256\n\n\néå¯ mysql ä»¥çæ\n\nï¼5ï¼ä¿®æ¹ linux æå¤§æä»¶æ°éå¶\n\nè®¾ç½®äºæå¤§è¿æ¥æ°ï¼å¦æè¿æ¯æ²¡æçæï¼èèæ£æ¥ä¸ä¸ linux æå¤§æä»¶æ°\n\nmysql æå¤§è¿æ¥æ°ä¼åå°æå¤§æä»¶æ°éå¶ï¼vim /etc/security/limits.confï¼æ·»å  mysql ç¨æ·éç½®\n\nmysql hard nofile 65535\nmysql soft nofile 65535\n\n\nï¼6ï¼æ£æ¥ limitnofile\n\nå¦ææ¯ä½¿ç¨ rpm æ¹å¼å®è£ mysqlï¼æ£æ¥ mysqld.service æä»¶ä¸­ç limitnofile æ¯å¦éç½®çå¤ªå°ã\n\n\n# 4.2. æ¶åºï¼time_zoneï¼åå·®\n\nç°è±¡\n\næ°æ®åºä¸­å­å¨ç timestamp å­æ®µå¼æ¯çå®å¼å°äº 13 ä¸ªå°æ¶ã\n\nåå \n\n * å½ jdbc ä¸ mysql å¼å§å»ºç«è¿æ¥æ¶ï¼ä¼è·åæå¡å¨åæ°ã\n * å½ mysql ç time_zone å¼ä¸º system æ¶ï¼ä¼å system_time_zone å¼ä½ä¸ºåè°æ¶åºï¼è¥å¾å°çæ¯ cst é£ä¹ java ä¼è¯¯ä»¥ä¸ºè¿æ¯ cst -0500 ï¼å æ­¤ä¼ç»åºéè¯¯çæ¶åºä¿¡æ¯ï¼å½åä¸è¬æ¯cst +0800ï¼å³ä¸å«åºï¼ã\n\næ¥çæ¶åºæ¹æ³ï¼\n\néè¿ show variables like '%time_zone%'; å½ä»¤æ¥ç mysql æ¶åºéç½®ï¼\n\nmysql> show variables like '%time_zone%';\n+------------------+--------+\n| variable_name    | value  |\n+------------------+--------+\n| system_time_zone | cst    |\n| time_zone        | system |\n+------------------+--------+\n\n\nè§£å³æ¹æ¡\n\næ¹æ¡ä¸\n\nmysql> set global time_zone = '+08:00';\nquery ok, 0 rows affected (0.00 sec)\n\nmysql> set time_zone = '+08:00';\nquery ok, 0 rows affected (0.00 sec)\n\n\næ¹æ¡äº\n\nä¿®æ¹ my.cnf æä»¶ï¼å¨ [mysqld] èä¸å¢å  default-time-zone='+08:00' ï¼ç¶åéå¯ã\n\n\n# 4.3. æ°æ®è¡¨æåå¦ä½ä¿®å¤\n\nä½¿ç¨ myisamchk æ¥ä¿®å¤ï¼å·ä½æ­¥éª¤ï¼\n\n 1. ä¿®å¤åå° mysql æå¡åæ­¢ã\n 2. æå¼å½ä»¤è¡æ¹å¼ï¼ç¶åè¿å¥å° mysql ç bin ç®å½ã\n 3. æ§è¡ myisamchk ârecover æ°æ®åºæå¨è·¯ /*.myi\n\nä½¿ç¨ repair table æè optimize table å½ä»¤æ¥ä¿®å¤ï¼repair table table_name ä¿®å¤è¡¨ optimize table table_name ä¼åè¡¨ repair table ç¨äºä¿®å¤è¢«ç ´åçè¡¨ã optimize table ç¨äºåæ¶é²ç½®çæ°æ®åºç©ºé´ï¼å½è¡¨ä¸çæ°æ®è¡è¢«å é¤æ¶ï¼æå æ®çç£çç©ºé´å¹¶æ²¡æç«å³è¢«åæ¶ï¼ä½¿ç¨äº optimize table å½ä»¤åè¿äºç©ºé´å°è¢«åæ¶ï¼å¹¶ä¸å¯¹ç£çä¸çæ°æ®è¡è¿è¡éæï¼æ³¨æï¼æ¯ç£çä¸ï¼èéæ°æ®åºï¼\n\n\n# 4.4. æ°æ®ç»æ\n\n> é®é¢ç°è±¡ï¼error 1071: specified key was too long; max key length is 767 bytes\n\né®é¢åå ï¼mysql é»è®¤æåµä¸åä¸ªåçç´¢å¼ä¸è½è¶è¿ 767 ä½ï¼ä¸åçæ¬å¯è½å­å¨å·®å¼ï¼ ã\n\nè§£å³æ¹æ³ï¼ä¼åç´¢å¼ç»æï¼ç´¢å¼å­æ®µä¸å®è¿é¿ã\n\n\n# 5. èæ¬\n\nè¿éæ¨èæåçå ä¸ªä¸é®è¿ç»´èæ¬ï¼éå¸¸æ¹ä¾¿ï¼æ¬¢è¿ä½¿ç¨ï¼\n\n * mysql å®è£èæ¬\n * mysql å¤ä»½èæ¬\n\n\n# 6. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * https://www.cnblogs.com/xiaopotian/p/8196464.html\n * https://www.cnblogs.com/bigbrotherer/p/7241845.html\n * https://blog.csdn.net/managementandjava/article/details/80039650\n * http://www.manongjc.com/article/6996.html\n * https://www.cnblogs.com/xyabk/p/8967990.html\n * mysql 8.0 ä¸»ä»ï¼master-slaveï¼éç½®\n * mysql ä¸»ä»åæ­¥å®æ\n * mysql å¤ä»½åæ¢å¤æºå¶",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql éç½®",frontmatter:{title:"Mysql éç½®",date:"2020-02-29T22:32:57.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","éç½®"],permalink:"/pages/6ed8d9/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/21.Mysql%E9%85%8D%E7%BD%AE.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/21.Mysqléç½®.md",key:"v-581951d7",path:"/pages/6ed8d9/",headers:[{level:2,title:"1. åºæ¬éç½®",slug:"_1-åºæ¬éç½®",normalizedTitle:"1. åºæ¬éç½®",charIndex:22},{level:2,title:"2. éç½®é¡¹è¯´æ",slug:"_2-éç½®é¡¹è¯´æ",normalizedTitle:"2. éç½®é¡¹è¯´æ",charIndex:1170},{level:2,title:"3. åèèµæ",slug:"_3-åèèµæ",normalizedTitle:"3. åèèµæ",charIndex:13215}],headersStr:"1. åºæ¬éç½® 2. éç½®é¡¹è¯´æ 3. åèèµæ",content:"# Mysql éç½®\n\n> çæ¬ï¼\n\n\n# 1. åºæ¬éç½®\n\n[mysqld]\n# GENERAL\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = InnoDB\ndefault_time_zone = '+8ï¼00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# LOG\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# InnoDB\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = O_DIRECT\n\n# MyIsam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# OTHER\n# -------------------------------------------------------------------------------\ntmp_table_size = 32M\nmax_heap_table_size = 32M\nmax_connections = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n\n# 2. éç½®é¡¹è¯´æ\n\n[client]\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n[mysqld]\n\n# GENERAL\n# -------------------------------------------------------------------------------\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n# PID æä»¶\npid_file = /var/lib/mysql/mysql.pid\n\n# å¯å¨ mysql æå¡è¿ç¨çç¨æ·\nuser = mysql\n\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# é»è®¤æ¶åº\ndefault_time_zone = '+8ï¼00'\n\n# Mysql æå¡ IDï¼åç¹æå¡æ¶æ²¡å¿è¦è®¾ç½®\nserver-id = 1\n\n# äºå¡éç¦»çº§å«ï¼é»è®¤ä¸ºå¯éå¤è¯»ï¼REPEATABLE-READï¼ãï¼æ­¤çº§å«ä¸å¯è½åæ°å¾å¤é´ééï¼å½±åæ§è½ï¼ä½æ¯ä¿®æ¹åå½±åä¸»ä»å¤å¶åç¾é¾æ¢å¤ï¼å»ºè®®è¿æ¯ä¿®æ¹ä»£ç é»è¾å§ï¼\n# éç¦»çº§å«å¯éé¡¹ç®ï¼READ-UNCOMMITTED READ-COMMITTED REPEATABLE-READ SERIALIZABLE\ntransaction_isolation = REPEATABLE-READ\n\n# ç®å½éç½®\n# -------------------------------------------------------------------------------\n\n# mysql å®è£æ ¹ç®å½\nbasedir = /usr/local/mysql-5.7.21\n\n# mysql æ°æ®æä»¶æå¨ç®å½\ndatadir = /var/lib/mysql\n\n# ä¸´æ¶ç®å½ æ¯å¦ load data infile ä¼ç¨å°ï¼ä¸è¬é½æ¯ä½¿ç¨/tmp\ntmpdir = /tmp\n\n# æ°æ®åºå¼æéç½®\n# -------------------------------------------------------------------------------\n\n# mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ InnoDB\ndefault_storage_engine = InnoDB\n\n# åå­ä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ InnoDB\ndefault_tmp_storage_engine = InnoDB\n\n# mysql 5.7 æ°å¢ç¹æ§ï¼ç£çä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ InnoDB\ninternal_tmp_disk_storage_engine = InnoDB\n\n# å­ç¬¦ééç½®\n# -------------------------------------------------------------------------------\n\n# æ°æ®åºé»è®¤å­ç¬¦éï¼ä¸»æµå­ç¬¦éæ¯æä¸äºç¹æ®è¡¨æç¬¦å·ï¼ç¹æ®è¡¨æç¬¦å ç¨ 4 ä¸ªå­èï¼\ncharacter_set_server = utf8mb4\n\n# æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\ncollation-server = utf8mb4_0900_ai_ci\n\n# è®¾ç½® client è¿æ¥ mysql æ¶çå­ç¬¦éï¼é²æ­¢ä¹±ç \n# init_connect='SET NAMES utf8'\n\n# æ¯å¦å¯¹ sql è¯­å¥å¤§å°åææï¼é»è®¤å¼ä¸º 0ï¼1 è¡¨ç¤ºä¸ææ\nlower_case_table_names = 1\n\n# æ°æ®åºè¿æ¥éç½®\n# -------------------------------------------------------------------------------\n\n# æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000\n# å¦æå¨è®¿é®æ¶ç»å¸¸åºç° Too Many Connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\nmax_connections = 10000\n\n# é»è®¤å¼ 100ï¼æå¤§éè¯¯è¿æ¥æ°ï¼å¦ææè¶åºè¯¥åæ°å¼ä¸ªæ°çä¸­æ­éè¯¯è¿æ¥ï¼åè¯¥ä¸»æºå°è¢«ç¦æ­¢è¿æ¥ãå¦éå¯¹è¯¥ä¸»æºè¿è¡è§£ç¦ï¼æ§è¡ï¼FLUSH HOST\n# èèé«å¹¶ååºæ¯ä¸çå®¹éï¼å»ºè®®å å¤§ã\nmax_connect_errors = 10000\n\n# MySQL æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n# å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections\\*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n# å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections\\*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªã\n# æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ Can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n# è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\nopen_files_limit = 65535\n\n# è¶æ¶éç½®\n# -------------------------------------------------------------------------------\n\n# MySQL é»è®¤ç wait_timeout å¼ä¸º 8 ä¸ªå°æ¶ï¼interactive_timeout åæ°éè¦åæ¶éç½®æè½çæ\n# MySQL è¿æ¥é²ç½®è¶è¿ä¸å®æ¶é´å(åä½ï¼ç§ï¼æ­¤å¤ä¸º 1800 ç§)å°ä¼è¢«å¼ºè¡å³é­\ninteractive_timeout = 1800\nwait_timeout = 1800\n\n# å¨ MySQL ææ¶åæ­¢ååºæ°è¯·æ±ä¹åçç­æ¶é´åå¤å°ä¸ªè¯·æ±å¯ä»¥è¢«å­å¨å æ ä¸­\n# å®æ¹å»ºè®® back_log = 50 + (max_connections / 5)ï¼å°é¡¶æ°ä¸º 900\nback_log = 900\n\n# æ°æ®åºæ°æ®äº¤æ¢éç½®\n# -------------------------------------------------------------------------------\n# è¯¥åæ°éå¶æå¡å¨ç«¯ï¼æ¥åçæ°æ®åå¤§å°ï¼å¦ææ BLOB å­æ®µï¼å»ºè®®å¢å¤§æ­¤å¼ï¼é¿ååå¥æèæ´æ°åºéãæ BLOB å­æ®µï¼å»ºè®®æ¹ä¸º 1024M\nmax_allowed_packet = 128M\n\n# åå­ãcache ä¸ buffer è®¾ç½®\n\n# åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16Mï¼æ­¤å¤è®¾ç½®æ 64M\ntmp_table_size = 64M\n\n# ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16Mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ã\n# è¶éçè¯ï¼MySQL å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç MyISAM è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ IO ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\nmax_heap_table_size = 64M\n\n# è¡¨ç¤ºè¿ä¸ª mysql çæ¬æ¯å¦æ¯ææ¥è¯¢ç¼å­ãpsï¼SHOW STATUS LIKE 'qcache%'ï¼ä¸ç¼å­ç¸å³çç¶æåéã\n# have_query_cache\n\n# è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® SQL_CACHE æç¼å­ã\n# çä¸å¡åºæ¯å³å®æ¯å¦ä½¿ç¨ç¼å­ï¼ä¸ä½¿ç¨ï¼ä¸é¢å°±ä¸ç¨éç½®äºã\n# Mysql8 ä¸æ¯æ\nquery_cache_type = 0\n\n# é»è®¤å¼ 1Mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ã\n# ç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n# Mysql8 ä¸æ¯æ\nquery_cache_size = 64M\n\n# åªæå°äºæ­¤è®¾å®å¼çç»ææä¼è¢«ç¼å²ï¼ä¿æ¤æ¥è¯¢ç¼å²ï¼é²æ­¢ä¸ä¸ªæå¤§çç»æéå°å¶ä»ææçæ¥è¯¢ç»æé½è¦çã\nquery_cache_limit = 2M\n\n# æ¯ä¸ªè¢«ç¼å­çç»æéè¦å ç¨çæå°åå­ï¼é»è®¤å¼ 4kbï¼ä¸è¬ä¸æä¹è°æ´ã\n# å¦æ Qcache_free_blocks å¼è¿å¤§ï¼å¯è½æ¯ query_cache_min_res_unit å¼è¿å¤§ï¼åºè¯¥è°å°äº\n# query_cache_min_res_unit çä¼°è®¡å¼ï¼(query_cache_size - Qcache_free_memory) / Qcache_queries_in_cache\nquery_cache_min_res_unit = 4kb\n\n# å¨ä¸ä¸ªäºå¡ä¸­ binlog ä¸ºäºè®°å½ SQL ç¶ææææç cache å¤§å°\n# å¦æä½ ç»å¸¸ä½¿ç¨å¤§çãå¤å£°æçäºå¡ï¼ä½ å¯ä»¥å¢å æ­¤å¼æ¥è·åæ´å¤§çæ§è½ã\n# ææä»äºå¡æ¥çç¶æé½å°è¢«ç¼å²å¨ binlog ç¼å²ä¸­ç¶åå¨æäº¤åä¸æ¬¡æ§åå¥å° binlog ä¸­\n# å¦æäºå¡æ¯æ­¤å¼å¤§ï¼ä¼ä½¿ç¨ç£çä¸çä¸´æ¶æä»¶æ¥æ¿ä»£ã\n# æ­¤ç¼å²å¨æ¯ä¸ªè¿æ¥çäºå¡ç¬¬ä¸æ¬¡æ´æ°ç¶ææ¶è¢«åå»º\nbinlog_cache_size = 1M\n\n# æ¥å¿éç½®\n# -------------------------------------------------------------------------------\n\n# æ¥å¿æä»¶ç¸å³è®¾ç½®ï¼ä¸è¬åªå¼å¯ä¸ç§æ¥å¿ï¼éè¯¯æ¥å¿ï¼æ¢æ¥è¯¢æ¥å¿ï¼äºè¿å¶æ¥å¿ãæ®éæ¥è¯¢æ¥å¿ä¸å¼å¯ã\n# æ®éæ¥è¯¢æ¥å¿ï¼é»è®¤å¼ offï¼ä¸å¼å¯\ngeneral_log = 0\n\n# æ®éæ¥è¯¢æ¥å¿å­æ¾å°å\ngeneral_log_file = /usr/local/mysql-5.7.21/log/mysql-general.log\n\n# å¨å±å¨æåéï¼é»è®¤ 3ï¼èå´ï¼1 ï½ 3\n# è¡¨ç¤ºéè¯¯æ¥å¿è®°å½çä¿¡æ¯ï¼1ï¼åªè®°å½ error ä¿¡æ¯ï¼2ï¼è®°å½ error å warnings ä¿¡æ¯ï¼3ï¼è®°å½ errorãwarnings åæ®éç notes ä¿¡æ¯ã\nlog_error_verbosity = 2\n\n# éè¯¯æ¥å¿æä»¶å°å\nlog_error = /usr/local/mysql-5.7.21/log/mysql-error.log\n\n# å¼å¯æ¢æ¥è¯¢\nslow_query_log = 1\n\n# å¼å¯æ¢æ¥è¯¢æ¶é´ï¼æ­¤å¤ä¸º 1 ç§ï¼è¾¾å°æ­¤å¼æè®°å½æ°æ®\nlong_query_time = 3\n\n# æ£ç´¢è¡æ°è¾¾å°æ­¤æ°å¼ï¼æè®°å½æ¢æ¥è¯¢æ¥å¿ä¸­\nmin_examined_row_limit = 100\n\n# mysql 5.6.5 æ°å¢ï¼ç¨æ¥è¡¨ç¤ºæ¯åéåè®¸è®°å½å° slow log çä¸æªä½¿ç¨ç´¢å¼ç SQL è¯­å¥æ¬¡æ°ï¼é»è®¤å¼ä¸º 0ï¼ä¸éå¶ã\nlog_throttle_queries_not_using_indexes = 0\n\n# æ¢æ¥è¯¢æ¥å¿æä»¶å°å\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# å¼å¯è®°å½æ²¡æä½¿ç¨ç´¢å¼æ¥è¯¢è¯­å¥\nlog-queries-not-using-indexes = 1\n\n# å¼å¯äºè¿å¶æ¥å¿\nlog_bin = /usr/local/mysql-5.7.21/log/mysql-bin.log\n\n# mysql æ¸é¤è¿ææ¥å¿çæ¶é´ï¼é»è®¤å¼ 0ï¼ä¸èªå¨æ¸çï¼èæ¯ä½¿ç¨æ»å¨å¾ªç¯çæ¹å¼ã\nexpire_logs_days = 0\n\n# å¦æäºè¿å¶æ¥å¿åå¥çåå®¹è¶åºç»å®å¼ï¼æ¥å¿å°±ä¼åçæ»å¨ãä½ ä¸è½å°è¯¥åéè®¾ç½®ä¸ºå¤§äº 1GB æå°äº 4096 å­èã é»è®¤å¼æ¯ 1GBã\nmax_binlog_size = 1000M\n\n# binlog çæ ¼å¼ä¹æä¸ç§ï¼STATEMENTï¼ROWï¼MIXEDãmysql 5.7.7 åï¼é»è®¤å¼ä» MIXED æ¹ä¸º ROW\n# å³äº binlog æ¥å¿æ ¼å¼é®é¢ï¼è¯·æ¥éç½ç»èµæ\nbinlog_format = row\n\n# é»è®¤å¼ N=1ï¼ä½¿ binlog å¨æ¯ N æ¬¡ binlog åå¥åä¸ç¡¬çåæ­¥ï¼psï¼1 ææ¢\n# sync_binlog = 1\n\n# MyISAM å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º MYISAM æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ INNODB å¼ææ æãç¸å½å½±å MyISAM çæ§è½ã\n# ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« OS ç¨æ¥ç¼å²è¡æ°æ®\n# çè³å¨ä½ å¹¶ä¸ä½¿ç¨ MyISAM è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64M åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n# é»è®¤å¼ 8Mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4GB å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256M æ 384Mãæ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\nkey_buffer_size = 64M\n\n# ä¸ºæ¯ä¸ªæ«æ MyISAM ççº¿ç¨åéåæ°è®¾ç½®çåå­å¤§å°ç¼å²åºã\n# é»è®¤å¼ 128kbï¼å»ºè®®å¼ï¼16G åå­å»ºè®® 1Mï¼4Gï¼128kb æè 256kb å§\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# ä¸è¬ä¸éè¦å¤ªå³å¿è¯¥æ°å¼ï¼ç¨å¾®å¢å¤§å°±å¯ä»¥äºï¼\nread_buffer_size = 262144\n\n# æ¯æä»»ä½å­å¨å¼æ\n# MySQL çéæºè¯»ç¼å²åºå¤§å°ï¼éå½å¢å¤§ï¼å¯ä»¥æé«æ§è½ã\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16G åå­ï¼æäººæ¨è 8M\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nread_rnd_buffer_size = 1M\n\n# order by æ group by æ¶ç¨å°\n# æ¯æææå¼æï¼innodb å myisam æèªå·±ç innodb_sort_buffer_size å myisam_sort_buffer_size è®¾ç½®\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16G åå­ï¼æäººæ¨è 8Mã\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1M*è¿æ¥æ°ï¼æç«¯æåµ 1M*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nsort_buffer_size = 1M\n\n# æ­¤ç¼å²è¢«ä½¿ç¨æ¥ä¼åå¨èå(full JOINs ä¸å¸¦ç´¢å¼çèå)\n# ç±»ä¼¼çèåå¨æå¤§å¤æ°æåµä¸æéå¸¸ç³ç³çæ§è½è¡¨ç°ï¼ä½æ¯å°æ­¤å¼è®¾å¤§è½å¤åè½»æ§è½å½±åã\n# éè¿ âSelect_full_joinâ ç¶æåéæ¥çå¨èåçæ°é\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1M*è¿æ¥æ°ï¼æç«¯æåµ 1M*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# é»è®¤å¼ 256kb;å»ºè®®å¼ï¼16G åå­ï¼è®¾ç½® 8Mã\njoin_buffer_size = 1M\n\n# ç¼å­ linux æä»¶æè¿°ç¬¦ä¿¡æ¯ï¼å å¿«æ°æ®æä»¶æå¼éåº¦\n# å®å½±å myisam è¡¨çæå¼å³é­ï¼ä½æ¯ä¸å½±å innodb è¡¨çæå¼å³é­ã\n# é»è®¤å¼ 2000ï¼å»ºè®®å¼ï¼æ ¹æ®ç¶æåé Opened_tables å»è®¾å®\ntable_open_cache = 2000\n\n# ç¼å­è¡¨å®ä¹çç¸å³ä¿¡æ¯ï¼å å¿«è¯»åè¡¨ä¿¡æ¯éåº¦\n# é»è®¤å¼ 1400ï¼æå¤§å¼ 2000ï¼å»ºè®®å¼ï¼åºæ¬ä¸æ¹ã\ntable_definition_cache = 1400\n\n# è¯¥åæ°æ¯ myssql 5.6 åå¼å¥çï¼ç®çæ¯æé«å¹¶åã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼cpu æ ¸æ°ï¼å¹¶ä¸<=16\ntable_open_cache_instances = 2\n\n# å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éã\n# é»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1G â> 8ï¼2G â> 16ï¼ 3G â> 32ï¼ >3G â> 64ï¼\n# æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç Threads_connected å¼ã\nthread_cache_size = 16\n\n# é»è®¤å¼ 256kï¼å»ºè®®å¼ï¼16/32G åå­ï¼512kbï¼å¶ä»ä¸è¬ä¸æ¹åï¼å¦ææ¥éï¼Thread stack overrunï¼å°±å¢å¤§ççï¼\n# æ³¨æï¼æ¯ä¸ªçº¿ç¨åéåå­ç©ºé´ï¼æä»¥æ»åå­ç©ºé´ãããä½ æå¾ã\nthread_stack = 512k\n\n# InnoDB å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# è¯´æï¼è¯¥åæ°å¯ä»¥æåæ©å±æ§åå·èé¡µæ§è½ã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼4-8ï¼å¹¶ä¸å¿é¡»å°äº innodb_buffer_pool_instances\ninnodb_page_cleaners = 4\n\n# è¯´æï¼ä¸è¬ 8k å 16k ä¸­éæ©ï¼8k çè¯ï¼cpu æ¶èå°äºï¼selcet æçé«ä¸ç¹ï¼ä¸è¬ä¸ç¨æ¹\n# é»è®¤å¼ï¼16kï¼å»ºè®®å¼ï¼ä¸æ¹ï¼\ninnodb_page_size = 16384\n\n# è¯´æï¼InnoDB ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å MyISAMãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç I/O è¶å°ã\n# å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸ï¼ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n# æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n# é»è®¤å¼ï¼128Mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\ninnodb_buffer_pool_size = 512M\n\n# è¯´æï¼åªæå½è®¾ç½® innodb_buffer_pool_size å¼å¤§äº 1G æ¶æææä¹ï¼å°äº 1Gï¼instances é»è®¤ä¸º 1ï¼å¤§äº 1Gï¼instances é»è®¤ä¸º 8\n# ä½æ¯ç½ç»ä¸æè¯ä»·ï¼æä½³æ§è½ï¼æ¯ä¸ªå®ä¾è³å° 1G å¤§å°ã\n# é»è®¤å¼ï¼1 æ 8ï¼å»ºè®®å¼ï¼innodb_buffer_pool_size/innodb_buffer_pool_instances >= 1G\ninnodb_buffer_pool_instances = 1\n\n# è¯´æï¼mysql 5.7 æ°ç¹æ§ï¼defines the chunk size for online InnoDB buffer pool resizing operationsã\n# å®éç¼å²åºå¤§å°å¿é¡»ä¸º innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances*åæ°ï¼åç¥å¤§äº innodb_buffer_pool_size\n# é»è®¤å¼ 128Mï¼å»ºè®®å¼ï¼é»è®¤å¼å°±å¥½ï¼ä¹±æ¹åèå®¹æåºé®é¢ï¼å®ä¼å½±åå®é buffer pool å¤§å°ã\ninnodb_buffer_pool_chunk_size = 128M\n\n# å¨å¯å¨æ¶æç­æ°æ®å è½½å°åå­ãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_load_at_startup = 1\n\n# å¨å³é­æ¶æç­æ°æ® dump å°æ¬å°ç£çãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_dump_at_shutdown = 1\n\n# è¯´æï¼å½±å Innodb ç¼å²åºçå·æ°ç®æ³ï¼å»ºè®®ä»å°å°å¤§éç½®ï¼ç´å° zero free pagesï¼innodb_lru_scan_depth \\* innodb_buffer_pool_instances defines the amount of work performed by the page cleaner thread each secondã\n# é»è®¤å¼ 1024ï¼å»ºè®®å¼ï¼ æªç¥\ninnodb_lru_scan_depth = 1024\n\n# è¯´æï¼äºå¡ç­å¾è·åèµæºç­å¾çæé¿æ¶é´ï¼åä½ä¸ºç§ï¼çå·ä½ä¸å¡æåµï¼ä¸è¬é»è®¤å¼å°±å¥½\n# é»è®¤å¼ï¼50ï¼å»ºè®®å¼ï¼çä¸å¡ã\ninnodb_lock_wait_timeout = 60\n\n# è¯´æï¼è®¾ç½®äº Mysql åå°ä»»å¡ï¼ä¾å¦é¡µå·æ°å merge dadta from buffer poolï¼æ¯ç§ io æä½çä¸éã\n# é»è®¤å¼ï¼200ï¼å»ºè®®å¼ï¼æ¹æ³ä¸ï¼åç sata è®¾ 100ï¼sas10ï¼raid10 è®¾ 200ï¼ssd è®¾ 2000ï¼fushion-io è®¾ 50000ï¼æ¹æ³äºï¼éè¿æµè¯å·¥å·è·å¾ç£ç io æ§è½åï¼è®¾ç½® IOPS æ°å¼/2ã\ninnodb_io_capacity = 2000\n\n# è¯´æï¼è¯¥åæ°æ¯ææç¼å²åºçº¿ç¨ io æä½çæ»ä¸éã\n# é»è®¤å¼ï¼innodb_io_capacity çä¸¤åãå»ºè®®å¼ï¼ä¾å¦ç¨ iometer æµè¯åç iops æ°å¼å°±å¥½\ninnodb_io_capacity_max = 4000\n\n# è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼O_DSYNCï¼O_DIRECT\n# fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# O_DSYNCï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n# O_DIRECTï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# é»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ SAN æè raidï¼å»ºè®®ç¨ O_DIRECTï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ O_DIRECT\ninnodb_flush_method = O_DIRECT\n\n# è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ã\n# é»è®¤å¼ 1ï¼å¼å¯\ninnodb_file_per_table = 1\n\n# è¯´æï¼The path where InnoDB creates undo tablespacesãéå¸¸ç­äº undo log æä»¶çå­æ¾ç®å½ã\n# é»è®¤å¼ ./;èªè¡è®¾ç½®\ninnodb_undo_directory = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼The number of undo tablespaces used by InnoDB ç­äº undo log æä»¶æ°éã5.7.21 åå¼å§å¼ç¨\n# é»è®¤å¼ä¸º 0ï¼å»ºè®®é»è®¤å¼å°±å¥½ï¼ä¸ç¨è°æ´äºã\ninnodb_undo_tablespaces = 0\n\n# è¯´æï¼å®ä¹ undo ä½¿ç¨çåæ»æ®µæ°éã5.7.19 åå¼ç¨\n# é»è®¤å¼ 128ï¼å»ºè®®ä¸å¨ï¼ä»¥åå¼ç¨äºã\ninnodb_undo_logs = 128\n\n# è¯´æï¼5.7.5 åå¼å§ä½¿ç¨ï¼å¨çº¿æ¶ç¼© undo log ä½¿ç¨çç©ºé´ã\n# é»è®¤å¼ï¼å³é­ï¼å»ºè®®å¼ï¼å¼å¯\ninnodb_undo_log_truncate = 1\n\n# è¯´æï¼ç»å innodb_undo_log_truncateï¼å®ç° undo ç©ºé´æ¶ç¼©åè½\n# é»è®¤å¼ï¼1Gï¼å»ºè®®å¼ï¼ä¸æ¹ã\ninnodb_max_undo_log_size = 1G\n\n# è¯´æï¼éä½æ¥å¿æä»¶çå­æ¾ç®å½\ninnodb_log_group_home_dir = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼æ¥å¿æä»¶çå¤§å°\n# é»è®¤å¼ï¼48Mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_file_size = 128M\n\n# è¯´æï¼æ¥å¿ç»ä¸­çæä»¶æ°éï¼mysql ä»¥å¾ªç¯æ¹å¼åå¥æ¥å¿\n# é»è®¤å¼ 2ï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_files_in_group = 3\n\n# æ­¤åæ°ç¡®å®äºæ¥å¿æä»¶æç¨çåå­å¤§å°ï¼ä»¥ M ä¸ºåä½ãç¼å²åºæ´å¤§è½æé«æ§è½ï¼ä½æå¤çæéå°ä¼ä¸¢å¤±æ°æ®ãMySQL å¼åäººåå»ºè®®è®¾ç½®ä¸º 1ï¼8M ä¹é´\ninnodb_log_buffer_size = 16M\n\n# è¯´æï¼å¯ä»¥æ§å¶ log ä»ç³»ç» buffer å·å¥ç£çæä»¶çå·æ°é¢çï¼å¢å¤§å¯åè½»ç³»ç»è´è·\n# é»è®¤å¼æ¯ 1ï¼å»ºè®®å¼ä¸æ¹ãç³»ç»æ§è½ä¸è¬å¤ç¨ã\ninnodb_flush_log_at_timeout = 1\n\n# è¯´æï¼åæ°å¯è®¾ä¸º 0ï¼1ï¼2ï¼\n# åæ° 0ï¼è¡¨ç¤ºæ¯ç§å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼åè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\n# åæ° 1ï¼è¡¨ç¤ºæ¯æ¬¡äºç©æäº¤ï¼å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼åè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\n# åæ° 2ï¼è¡¨ç¤ºæ¯æ¬¡äºç©æäº¤ï¼å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼é 1 ç§ååè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\ninnodb_flush_log_at_trx_commit = 1\n\n# è¯´æï¼éå¶ Innodb è½æå¼çè¡¨çæ°æ®ï¼å¦æåºéçè¡¨ç¹å«å¤çæåµï¼è¯·å¢å è¿ä¸ªã\n# å¼é»è®¤æ¯ 2000ï¼å»ºè®®å¼ï¼åèæ°æ®åºè¡¨æ»æ°åè¿è¡è°æ´ï¼ä¸è¬å¤ç¨ä¸ç¨è°æ´ã\ninnodb_open_files = 8192\n\n# innodb å¤ç io è¯»åçåå°å¹¶åçº¿ç¨æ°éï¼æ ¹æ® cpu æ ¸æ¥ç¡®è®¤ï¼åå¼èå´ï¼1-64\n# é»è®¤å¼ï¼4ï¼å»ºè®®å¼ï¼ä¸é»è¾ cpu æ°éçä¸åä¿æä¸è´ã\ninnodb_read_io_threads = 4\ninnodb_write_io_threads = 4\n\n# é»è®¤è®¾ç½®ä¸º 0ï¼è¡¨ç¤ºä¸éå¶å¹¶åæ°ï¼è¿éæ¨èè®¾ç½®ä¸º 0ï¼æ´å¥½å»åæ¥ CPU å¤æ ¸å¤çè½åï¼æé«å¹¶åé\ninnodb_thread_concurrency = 0\n\n# é»è®¤å¼ä¸º 4ï¼å»ºè®®ä¸åãInnoDB ä¸­çæ¸é¤æä½æ¯ä¸ç±»å®æåæ¶æ ç¨æ°æ®çæä½ãmysql 5.5 ä¹åï¼æ¯æå¤çº¿ç¨æ¸é¤æä½ã\ninnodb_purge_threads = 4\n\n# è¯´æï¼mysql ç¼å²åºåä¸º new blocks å old blocksï¼æ­¤åæ°è¡¨ç¤º old blocks å æ¯ï¼\n# é»è®¤å¼ï¼37ï¼å»ºè®®å¼ï¼ä¸è¬ä¸å¨\ninnodb_old_blocks_pct = 37\n\n# è¯´æï¼æ°æ°æ®è¢«è½½å¥ç¼å²æ± ï¼è¿å¥ old pages é¾åºï¼å½ 1 ç§ååæ¬¡è®¿é®ï¼åæåè¿å¥ new pages é¾åºã\n# é»è®¤å¼ï¼1000\ninnodb_old_blocks_time=1000\n\n# è¯´æï¼å¼å¯å¼æ­¥ ioï¼å¯ä»¥æé«å¹¶åæ§ï¼é»è®¤å¼å¯ã\n# é»è®¤å¼ä¸º 1ï¼å»ºè®®ä¸å¨\ninnodb_use_native_aio = 1\n\n# è¯´æï¼é»è®¤ä¸ºç©ºï¼ä½¿ç¨ data ç®å½ï¼ä¸è¬ä¸æ¹ã\ninnodb_data_home_dir=/usr/local/mysql-5.7.21/data\n\n# è¯´æï¼Defines the nameï¼sizeï¼and attributes of InnoDB system tablespace data filesã\n# é»è®¤å¼ï¼ä¸æå®ï¼é»è®¤ä¸º ibdata1ï¼12Mï¼autoextend\ninnodb_data_file_path = ibdata1ï¼12Mï¼autoextend\n\n# è¯´æï¼è®¾ç½®äº InnoDB å­å¨å¼æç¨æ¥å­æ¾æ°æ®å­å¸ä¿¡æ¯ä»¥åä¸äºåé¨æ°æ®ç»æçåå­ç©ºé´å¤§å°ï¼é¤éä½ çæ°æ®å¯¹è±¡åå¶å¤ï¼å¦åä¸è¬é»è®¤ä¸æ¹ã\n# innodb_additional_mem_pool_size = 16M\n# è¯´æï¼The crash recovery modeãåªæç´§æ¥æåµéè¦æ¢å¤æ°æ®çæ¶åï¼ææ¹ä¸ºå¤§äº 1-6 ä¹é´æ°å¼ï¼å«ä¹æ¥ä¸å®ç½ã\n# é»è®¤å¼ä¸º 0ï¼\n#innodb_force_recovery = 0\n\n\n\n[mysqldump]\n\n# quick éé¡¹å¼ºå¶ mysqldump ä»æå¡å¨æ¥è¯¢åå¾è®°å½ç´æ¥è¾åºèä¸æ¯åå¾ææè®°å½åå°å®ä»¬ç¼å­å°åå­ä¸­\nquick\n\nmax_allowed_packet = 16M\n\n\n\n[mysql]\n\n# mysql å½ä»¤è¡å·¥å·ä¸ä½¿ç¨èªå¨è¡¥å¨åè½ï¼å»ºè®®è¿æ¯æ¹ä¸º\n# no-auto-rehash\nauto-rehash\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n# 3. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * Mysql éç½®æä»¶/etc/my.cnf è§£æ",normalizedContent:"# mysql éç½®\n\n> çæ¬ï¼\n\n\n# 1. åºæ¬éç½®\n\n[mysqld]\n# general\n# -------------------------------------------------------------------------------\ndatadir = /var/lib/mysql\nsocket  = /var/lib/mysql/mysql.sock\npid_file = /var/lib/mysql/mysql.pid\nuser = mysql\nport = 3306\ndefault_storage_engine = innodb\ndefault_time_zone = '+8ï¼00'\ncharacter_set_server = utf8mb4\ncollation_server = utf8mb4_0900_ai_ci\n\n# log\n# -------------------------------------------------------------------------------\nlog_error = /var/log/mysql/mysql-error.log\nslow_query_log = 1\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# innodb\n# -------------------------------------------------------------------------------\ninnodb_buffer_pool_size = <value>\ninnodb_log_file_size = <value>\ninnodb_file_per_table = 1\ninnodb_flush_method = o_direct\n\n# myisam\n# -------------------------------------------------------------------------------\nkey_buffer_size = <value>\n\n# other\n# -------------------------------------------------------------------------------\ntmp_table_size = 32m\nmax_heap_table_size = 32m\nmax_connections = <value>\nopen_files_limit = 65535\n\n[client]\nsocket  = /var/lib/mysql/mysql.sock\nport = 3306\n\n\n\n# 2. éç½®é¡¹è¯´æ\n\n[client]\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n[mysqld]\n\n# general\n# -------------------------------------------------------------------------------\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n# pid æä»¶\npid_file = /var/lib/mysql/mysql.pid\n\n# å¯å¨ mysql æå¡è¿ç¨çç¨æ·\nuser = mysql\n\n# æå¡ç«¯å£å·ï¼é»è®¤ 3306\nport = 3306\n\n# é»è®¤æ¶åº\ndefault_time_zone = '+8ï¼00'\n\n# mysql æå¡ idï¼åç¹æå¡æ¶æ²¡å¿è¦è®¾ç½®\nserver-id = 1\n\n# äºå¡éç¦»çº§å«ï¼é»è®¤ä¸ºå¯éå¤è¯»ï¼repeatable-readï¼ãï¼æ­¤çº§å«ä¸å¯è½åæ°å¾å¤é´ééï¼å½±åæ§è½ï¼ä½æ¯ä¿®æ¹åå½±åä¸»ä»å¤å¶åç¾é¾æ¢å¤ï¼å»ºè®®è¿æ¯ä¿®æ¹ä»£ç é»è¾å§ï¼\n# éç¦»çº§å«å¯éé¡¹ç®ï¼read-uncommitted read-committed repeatable-read serializable\ntransaction_isolation = repeatable-read\n\n# ç®å½éç½®\n# -------------------------------------------------------------------------------\n\n# mysql å®è£æ ¹ç®å½\nbasedir = /usr/local/mysql-5.7.21\n\n# mysql æ°æ®æä»¶æå¨ç®å½\ndatadir = /var/lib/mysql\n\n# ä¸´æ¶ç®å½ æ¯å¦ load data infile ä¼ç¨å°ï¼ä¸è¬é½æ¯ä½¿ç¨/tmp\ntmpdir = /tmp\n\n# æ°æ®åºå¼æéç½®\n# -------------------------------------------------------------------------------\n\n# mysql 5.1 ä¹åï¼é»è®¤å¼ææ¯ innodb\ndefault_storage_engine = innodb\n\n# åå­ä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ innodb\ndefault_tmp_storage_engine = innodb\n\n# mysql 5.7 æ°å¢ç¹æ§ï¼ç£çä¸´æ¶è¡¨é»è®¤å¼æï¼é»è®¤ innodb\ninternal_tmp_disk_storage_engine = innodb\n\n# å­ç¬¦ééç½®\n# -------------------------------------------------------------------------------\n\n# æ°æ®åºé»è®¤å­ç¬¦éï¼ä¸»æµå­ç¬¦éæ¯æä¸äºç¹æ®è¡¨æç¬¦å·ï¼ç¹æ®è¡¨æç¬¦å ç¨ 4 ä¸ªå­èï¼\ncharacter_set_server = utf8mb4\n\n# æ°æ®åºå­ç¬¦éå¯¹åºä¸äºæåºç­è§åï¼æ³¨æè¦å character_set_server å¯¹åº\ncollation-server = utf8mb4_0900_ai_ci\n\n# è®¾ç½® client è¿æ¥ mysql æ¶çå­ç¬¦éï¼é²æ­¢ä¹±ç \n# init_connect='set names utf8'\n\n# æ¯å¦å¯¹ sql è¯­å¥å¤§å°åææï¼é»è®¤å¼ä¸º 0ï¼1 è¡¨ç¤ºä¸ææ\nlower_case_table_names = 1\n\n# æ°æ®åºè¿æ¥éç½®\n# -------------------------------------------------------------------------------\n\n# æå¤§è¿æ¥æ°ï¼å¯è®¾æå¤§å¼ 16384ï¼ä¸è¬èèæ ¹æ®åæ¶å¨çº¿äººæ°è®¾ç½®ä¸ä¸ªæ¯è¾ç»¼åçæ°å­ï¼é´äºè¯¥æ°å¼å¢å¤§å¹¶ä¸å¤ªæ¶èç³»ç»èµæºï¼å»ºè®®ç´æ¥è®¾ 10000\n# å¦æå¨è®¿é®æ¶ç»å¸¸åºç° too many connections çéè¯¯æç¤ºï¼åéè¦å¢å¤§è¯¥åæ°å¼\nmax_connections = 10000\n\n# é»è®¤å¼ 100ï¼æå¤§éè¯¯è¿æ¥æ°ï¼å¦ææè¶åºè¯¥åæ°å¼ä¸ªæ°çä¸­æ­éè¯¯è¿æ¥ï¼åè¯¥ä¸»æºå°è¢«ç¦æ­¢è¿æ¥ãå¦éå¯¹è¯¥ä¸»æºè¿è¡è§£ç¦ï¼æ§è¡ï¼flush host\n# èèé«å¹¶ååºæ¯ä¸çå®¹éï¼å»ºè®®å å¤§ã\nmax_connect_errors = 10000\n\n# mysql æå¼çæä»¶æè¿°ç¬¦éå¶ï¼é»è®¤æå° 1024;\n# å½ open_files_limit æ²¡æè¢«éç½®çæ¶åï¼æ¯è¾ max_connections\\*5 å ulimit -n çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªï¼\n# å½ open_file_limit è¢«éç½®çæ¶åï¼æ¯è¾ open_files_limit å max_connections\\*5 çå¼ï¼åªä¸ªå¤§ç¨åªä¸ªã\n# æ³¨æï¼ä»ç¶å¯è½åºç°æ¥éä¿¡æ¯ can't create a new threadï¼æ­¤æ¶è§å¯ç³»ç» cat /proc/mysql è¿ç¨å·/limitsï¼è§å¯è¿ç¨ ulimit éå¶æåµ\n# è¿å°çè¯ï¼èèä¿®æ¹ç³»ç»éç½®è¡¨ï¼/etc/security/limits.conf å /etc/security/limits.d/90-nproc.conf\nopen_files_limit = 65535\n\n# è¶æ¶éç½®\n# -------------------------------------------------------------------------------\n\n# mysql é»è®¤ç wait_timeout å¼ä¸º 8 ä¸ªå°æ¶ï¼interactive_timeout åæ°éè¦åæ¶éç½®æè½çæ\n# mysql è¿æ¥é²ç½®è¶è¿ä¸å®æ¶é´å(åä½ï¼ç§ï¼æ­¤å¤ä¸º 1800 ç§)å°ä¼è¢«å¼ºè¡å³é­\ninteractive_timeout = 1800\nwait_timeout = 1800\n\n# å¨ mysql ææ¶åæ­¢ååºæ°è¯·æ±ä¹åçç­æ¶é´åå¤å°ä¸ªè¯·æ±å¯ä»¥è¢«å­å¨å æ ä¸­\n# å®æ¹å»ºè®® back_log = 50 + (max_connections / 5)ï¼å°é¡¶æ°ä¸º 900\nback_log = 900\n\n# æ°æ®åºæ°æ®äº¤æ¢éç½®\n# -------------------------------------------------------------------------------\n# è¯¥åæ°éå¶æå¡å¨ç«¯ï¼æ¥åçæ°æ®åå¤§å°ï¼å¦ææ blob å­æ®µï¼å»ºè®®å¢å¤§æ­¤å¼ï¼é¿ååå¥æèæ´æ°åºéãæ blob å­æ®µï¼å»ºè®®æ¹ä¸º 1024m\nmax_allowed_packet = 128m\n\n# åå­ãcache ä¸ buffer è®¾ç½®\n\n# åå­ä¸´æ¶è¡¨çæå¤§å¼ï¼é»è®¤ 16mï¼æ­¤å¤è®¾ç½®æ 64m\ntmp_table_size = 64m\n\n# ç¨æ·åå»ºçåå­è¡¨çå¤§å°ï¼é»è®¤ 16mï¼å¾å¾å tmp_table_size ä¸èµ·è®¾ç½®ï¼éå¶ç¨æ·ä¸´æ¶è¡¨å¤§å°ã\n# è¶éçè¯ï¼mysql å°±ä¼èªå¨å°æå®è½¬åä¸ºåºäºç£çç myisam è¡¨ï¼å­å¨å¨æå®ç tmpdir ç®å½ä¸ï¼å¢å¤§ io ååï¼å»ºè®®åå­å¤§ï¼å¢å¤§è¯¥æ°å¼ã\nmax_heap_table_size = 64m\n\n# è¡¨ç¤ºè¿ä¸ª mysql çæ¬æ¯å¦æ¯ææ¥è¯¢ç¼å­ãpsï¼show status like 'qcache%'ï¼ä¸ç¼å­ç¸å³çç¶æåéã\n# have_query_cache\n\n# è¿ä¸ªç³»ç»åéæ§å¶çæ¥è¯¢ç¼å­åè½çå¼å¯åå³é­ï¼0 è¡¨ç¤ºå³é­ï¼1 è¡¨ç¤ºæå¼ï¼2 è¡¨ç¤ºåªè¦ select ä¸­æç¡®æå® sql_cache æç¼å­ã\n# çä¸å¡åºæ¯å³å®æ¯å¦ä½¿ç¨ç¼å­ï¼ä¸ä½¿ç¨ï¼ä¸é¢å°±ä¸ç¨éç½®äºã\n# mysql8 ä¸æ¯æ\nquery_cache_type = 0\n\n# é»è®¤å¼ 1mï¼ä¼ç¹æ¯æ¥è¯¢ç¼å­å¯ä»¥æå¤§çæé«æå¡å¨éåº¦ï¼å¦æä½ æå¤§éçç¸åçæ¥è¯¢å¹¶ä¸å¾å°ä¿®æ¹è¡¨ã\n# ç¼ºç¹ï¼å¨ä½ è¡¨ç»å¸¸ååçæåµä¸æèå¦æä½ çæ¥è¯¢åææ¯æ¬¡é½ä¸åï¼æ¥è¯¢ç¼å­ä¹è®¸å¼èµ·æ§è½ä¸éèä¸æ¯æ§è½æåã\n# mysql8 ä¸æ¯æ\nquery_cache_size = 64m\n\n# åªæå°äºæ­¤è®¾å®å¼çç»ææä¼è¢«ç¼å²ï¼ä¿æ¤æ¥è¯¢ç¼å²ï¼é²æ­¢ä¸ä¸ªæå¤§çç»æéå°å¶ä»ææçæ¥è¯¢ç»æé½è¦çã\nquery_cache_limit = 2m\n\n# æ¯ä¸ªè¢«ç¼å­çç»æéè¦å ç¨çæå°åå­ï¼é»è®¤å¼ 4kbï¼ä¸è¬ä¸æä¹è°æ´ã\n# å¦æ qcache_free_blocks å¼è¿å¤§ï¼å¯è½æ¯ query_cache_min_res_unit å¼è¿å¤§ï¼åºè¯¥è°å°äº\n# query_cache_min_res_unit çä¼°è®¡å¼ï¼(query_cache_size - qcache_free_memory) / qcache_queries_in_cache\nquery_cache_min_res_unit = 4kb\n\n# å¨ä¸ä¸ªäºå¡ä¸­ binlog ä¸ºäºè®°å½ sql ç¶ææææç cache å¤§å°\n# å¦æä½ ç»å¸¸ä½¿ç¨å¤§çãå¤å£°æçäºå¡ï¼ä½ å¯ä»¥å¢å æ­¤å¼æ¥è·åæ´å¤§çæ§è½ã\n# ææä»äºå¡æ¥çç¶æé½å°è¢«ç¼å²å¨ binlog ç¼å²ä¸­ç¶åå¨æäº¤åä¸æ¬¡æ§åå¥å° binlog ä¸­\n# å¦æäºå¡æ¯æ­¤å¼å¤§ï¼ä¼ä½¿ç¨ç£çä¸çä¸´æ¶æä»¶æ¥æ¿ä»£ã\n# æ­¤ç¼å²å¨æ¯ä¸ªè¿æ¥çäºå¡ç¬¬ä¸æ¬¡æ´æ°ç¶ææ¶è¢«åå»º\nbinlog_cache_size = 1m\n\n# æ¥å¿éç½®\n# -------------------------------------------------------------------------------\n\n# æ¥å¿æä»¶ç¸å³è®¾ç½®ï¼ä¸è¬åªå¼å¯ä¸ç§æ¥å¿ï¼éè¯¯æ¥å¿ï¼æ¢æ¥è¯¢æ¥å¿ï¼äºè¿å¶æ¥å¿ãæ®éæ¥è¯¢æ¥å¿ä¸å¼å¯ã\n# æ®éæ¥è¯¢æ¥å¿ï¼é»è®¤å¼ offï¼ä¸å¼å¯\ngeneral_log = 0\n\n# æ®éæ¥è¯¢æ¥å¿å­æ¾å°å\ngeneral_log_file = /usr/local/mysql-5.7.21/log/mysql-general.log\n\n# å¨å±å¨æåéï¼é»è®¤ 3ï¼èå´ï¼1 ï½ 3\n# è¡¨ç¤ºéè¯¯æ¥å¿è®°å½çä¿¡æ¯ï¼1ï¼åªè®°å½ error ä¿¡æ¯ï¼2ï¼è®°å½ error å warnings ä¿¡æ¯ï¼3ï¼è®°å½ errorãwarnings åæ®éç notes ä¿¡æ¯ã\nlog_error_verbosity = 2\n\n# éè¯¯æ¥å¿æä»¶å°å\nlog_error = /usr/local/mysql-5.7.21/log/mysql-error.log\n\n# å¼å¯æ¢æ¥è¯¢\nslow_query_log = 1\n\n# å¼å¯æ¢æ¥è¯¢æ¶é´ï¼æ­¤å¤ä¸º 1 ç§ï¼è¾¾å°æ­¤å¼æè®°å½æ°æ®\nlong_query_time = 3\n\n# æ£ç´¢è¡æ°è¾¾å°æ­¤æ°å¼ï¼æè®°å½æ¢æ¥è¯¢æ¥å¿ä¸­\nmin_examined_row_limit = 100\n\n# mysql 5.6.5 æ°å¢ï¼ç¨æ¥è¡¨ç¤ºæ¯åéåè®¸è®°å½å° slow log çä¸æªä½¿ç¨ç´¢å¼ç sql è¯­å¥æ¬¡æ°ï¼é»è®¤å¼ä¸º 0ï¼ä¸éå¶ã\nlog_throttle_queries_not_using_indexes = 0\n\n# æ¢æ¥è¯¢æ¥å¿æä»¶å°å\nslow_query_log_file = /var/log/mysql/mysql-slow.log\n\n# å¼å¯è®°å½æ²¡æä½¿ç¨ç´¢å¼æ¥è¯¢è¯­å¥\nlog-queries-not-using-indexes = 1\n\n# å¼å¯äºè¿å¶æ¥å¿\nlog_bin = /usr/local/mysql-5.7.21/log/mysql-bin.log\n\n# mysql æ¸é¤è¿ææ¥å¿çæ¶é´ï¼é»è®¤å¼ 0ï¼ä¸èªå¨æ¸çï¼èæ¯ä½¿ç¨æ»å¨å¾ªç¯çæ¹å¼ã\nexpire_logs_days = 0\n\n# å¦æäºè¿å¶æ¥å¿åå¥çåå®¹è¶åºç»å®å¼ï¼æ¥å¿å°±ä¼åçæ»å¨ãä½ ä¸è½å°è¯¥åéè®¾ç½®ä¸ºå¤§äº 1gb æå°äº 4096 å­èã é»è®¤å¼æ¯ 1gbã\nmax_binlog_size = 1000m\n\n# binlog çæ ¼å¼ä¹æä¸ç§ï¼statementï¼rowï¼mixedãmysql 5.7.7 åï¼é»è®¤å¼ä» mixed æ¹ä¸º row\n# å³äº binlog æ¥å¿æ ¼å¼é®é¢ï¼è¯·æ¥éç½ç»èµæ\nbinlog_format = row\n\n# é»è®¤å¼ n=1ï¼ä½¿ binlog å¨æ¯ n æ¬¡ binlog åå¥åä¸ç¡¬çåæ­¥ï¼psï¼1 ææ¢\n# sync_binlog = 1\n\n# myisam å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# æå®ç´¢å¼ç¼å²åºçå¤§å°ï¼ä¸º myisam æ°æ®è¡¨å¼å¯ä¾çº¿ç¨å±äº«çç´¢å¼ç¼å­ï¼å¯¹ innodb å¼ææ æãç¸å½å½±å myisam çæ§è½ã\n# ä¸è¦å°å¶è®¾ç½®å¤§äºä½ å¯ç¨åå­ç 30%ï¼å ä¸ºä¸é¨ååå­åæ ·è¢« os ç¨æ¥ç¼å²è¡æ°æ®\n# çè³å¨ä½ å¹¶ä¸ä½¿ç¨ myisam è¡¨çæåµä¸ï¼ä½ ä¹éè¦ä»æ§è®¾ç½®èµ· 8-64m åå­ç±äºå®åæ ·ä¼è¢«åé¨ä¸´æ¶ç£çè¡¨ä½¿ç¨ã\n# é»è®¤å¼ 8mï¼å»ºè®®å¼ï¼å¯¹äºåå­å¨ 4gb å·¦å³çæå¡å¨è¯¥åæ°å¯è®¾ç½®ä¸º 256m æ 384mãæ³¨æï¼è¯¥åæ°å¼è®¾ç½®çè¿å¤§åèä¼æ¯æå¡å¨æ´ä½æçéä½ï¼\nkey_buffer_size = 64m\n\n# ä¸ºæ¯ä¸ªæ«æ myisam ççº¿ç¨åéåæ°è®¾ç½®çåå­å¤§å°ç¼å²åºã\n# é»è®¤å¼ 128kbï¼å»ºè®®å¼ï¼16g åå­å»ºè®® 1mï¼4gï¼128kb æè 256kb å§\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# ä¸è¬ä¸éè¦å¤ªå³å¿è¯¥æ°å¼ï¼ç¨å¾®å¢å¤§å°±å¯ä»¥äºï¼\nread_buffer_size = 262144\n\n# æ¯æä»»ä½å­å¨å¼æ\n# mysql çéæºè¯»ç¼å²åºå¤§å°ï¼éå½å¢å¤§ï¼å¯ä»¥æé«æ§è½ã\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16g åå­ï¼æäººæ¨è 8m\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 128kb*è¿æ¥æ°ï¼æç«¯æåµ 128kb*maxconnectiosnsï¼ä¼è¶çº§å¤§ï¼æä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nread_rnd_buffer_size = 1m\n\n# order by æ group by æ¶ç¨å°\n# æ¯æææå¼æï¼innodb å myisam æèªå·±ç innodb_sort_buffer_size å myisam_sort_buffer_size è®¾ç½®\n# é»è®¤å¼ 256kbï¼å»ºè®®å¼ï¼å¾åèè¿æ¥æ°ï¼16g åå­ï¼æäººæ¨è 8mã\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1m*è¿æ¥æ°ï¼æç«¯æåµ 1m*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\nsort_buffer_size = 1m\n\n# æ­¤ç¼å²è¢«ä½¿ç¨æ¥ä¼åå¨èå(full joins ä¸å¸¦ç´¢å¼çèå)\n# ç±»ä¼¼çèåå¨æå¤§å¤æ°æåµä¸æéå¸¸ç³ç³çæ§è½è¡¨ç°ï¼ä½æ¯å°æ­¤å¼è®¾å¤§è½å¤åè½»æ§è½å½±åã\n# éè¿ âselect_full_joinâ ç¶æåéæ¥çå¨èåçæ°é\n# æ³¨æï¼è¯¥ç¼å²åºæ¯æ¯ä¸ªè¿æ¥ç¬å çï¼æä»¥æ»ç¼å²åºå¤§å°ä¸º 1m*è¿æ¥æ°ï¼æç«¯æåµ 1m*maxconnectiosnsï¼ä¼è¶çº§å¤§ãæä»¥è¦èèæ¥å¸¸å¹³åè¿æ¥æ°ã\n# é»è®¤å¼ 256kb;å»ºè®®å¼ï¼16g åå­ï¼è®¾ç½® 8mã\njoin_buffer_size = 1m\n\n# ç¼å­ linux æä»¶æè¿°ç¬¦ä¿¡æ¯ï¼å å¿«æ°æ®æä»¶æå¼éåº¦\n# å®å½±å myisam è¡¨çæå¼å³é­ï¼ä½æ¯ä¸å½±å innodb è¡¨çæå¼å³é­ã\n# é»è®¤å¼ 2000ï¼å»ºè®®å¼ï¼æ ¹æ®ç¶æåé opened_tables å»è®¾å®\ntable_open_cache = 2000\n\n# ç¼å­è¡¨å®ä¹çç¸å³ä¿¡æ¯ï¼å å¿«è¯»åè¡¨ä¿¡æ¯éåº¦\n# é»è®¤å¼ 1400ï¼æå¤§å¼ 2000ï¼å»ºè®®å¼ï¼åºæ¬ä¸æ¹ã\ntable_definition_cache = 1400\n\n# è¯¥åæ°æ¯ myssql 5.6 åå¼å¥çï¼ç®çæ¯æé«å¹¶åã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼cpu æ ¸æ°ï¼å¹¶ä¸<=16\ntable_open_cache_instances = 2\n\n# å½å®¢æ·ç«¯æ­å¼ä¹åï¼æå¡å¨å¤çæ­¤å®¢æ·ççº¿ç¨å°ä¼ç¼å­èµ·æ¥ä»¥ååºä¸ä¸ä¸ªå®¢æ·èä¸æ¯éæ¯ãå¯éç¨ï¼åå°äºç³»ç»å¼éã\n# é»è®¤å¼ä¸º 9ï¼å»ºè®®å¼ï¼ä¸¤ç§åå¼æ¹å¼ï¼æ¹å¼ä¸ï¼æ ¹æ®ç©çåå­ï¼1g â> 8ï¼2g â> 16ï¼ 3g â> 32ï¼ >3g â> 64ï¼\n# æ¹å¼äºï¼æ ¹æ® show status like 'threads%'ï¼æ¥ç threads_connected å¼ã\nthread_cache_size = 16\n\n# é»è®¤å¼ 256kï¼å»ºè®®å¼ï¼16/32g åå­ï¼512kbï¼å¶ä»ä¸è¬ä¸æ¹åï¼å¦ææ¥éï¼thread stack overrunï¼å°±å¢å¤§ççï¼\n# æ³¨æï¼æ¯ä¸ªçº¿ç¨åéåå­ç©ºé´ï¼æä»¥æ»åå­ç©ºé´ãããä½ æå¾ã\nthread_stack = 512k\n\n# innodb å¼æéç½®\n# -------------------------------------------------------------------------------\n\n# è¯´æï¼è¯¥åæ°å¯ä»¥æåæ©å±æ§åå·èé¡µæ§è½ã\n# é»è®¤å¼ 1ï¼å»ºè®®å¼ï¼4-8ï¼å¹¶ä¸å¿é¡»å°äº innodb_buffer_pool_instances\ninnodb_page_cleaners = 4\n\n# è¯´æï¼ä¸è¬ 8k å 16k ä¸­éæ©ï¼8k çè¯ï¼cpu æ¶èå°äºï¼selcet æçé«ä¸ç¹ï¼ä¸è¬ä¸ç¨æ¹\n# é»è®¤å¼ï¼16kï¼å»ºè®®å¼ï¼ä¸æ¹ï¼\ninnodb_page_size = 16384\n\n# è¯´æï¼innodb ä½¿ç¨ä¸ä¸ªç¼å²æ± æ¥ä¿å­ç´¢å¼ååå§æ°æ®ï¼ä¸å myisamãè¿éä½ è®¾ç½®è¶å¤§ï¼ä½ å¨å­åè¡¨éé¢æ°æ®æ¶æéè¦çç£ç i/o è¶å°ã\n# å¨ä¸ä¸ªç¬ç«ä½¿ç¨çæ°æ®åºæå¡å¨ä¸ï¼ä½ å¯ä»¥è®¾ç½®è¿ä¸ªåéå°æå¡å¨ç©çåå­å¤§å°ç 60%-80%\n# æ³¨æå«è®¾ç½®çè¿å¤§ï¼ä¼å¯¼è´ system ç swap ç©ºé´è¢«å ç¨ï¼å¯¼è´æä½ç³»ç»åæ¢ï¼ä»èåä½ sql æ¥è¯¢çæç\n# é»è®¤å¼ï¼128mï¼å»ºè®®å¼ï¼ç©çåå­ç 60%-80%\ninnodb_buffer_pool_size = 512m\n\n# è¯´æï¼åªæå½è®¾ç½® innodb_buffer_pool_size å¼å¤§äº 1g æ¶æææä¹ï¼å°äº 1gï¼instances é»è®¤ä¸º 1ï¼å¤§äº 1gï¼instances é»è®¤ä¸º 8\n# ä½æ¯ç½ç»ä¸æè¯ä»·ï¼æä½³æ§è½ï¼æ¯ä¸ªå®ä¾è³å° 1g å¤§å°ã\n# é»è®¤å¼ï¼1 æ 8ï¼å»ºè®®å¼ï¼innodb_buffer_pool_size/innodb_buffer_pool_instances >= 1g\ninnodb_buffer_pool_instances = 1\n\n# è¯´æï¼mysql 5.7 æ°ç¹æ§ï¼defines the chunk size for online innodb buffer pool resizing operationsã\n# å®éç¼å²åºå¤§å°å¿é¡»ä¸º innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances*åæ°ï¼åç¥å¤§äº innodb_buffer_pool_size\n# é»è®¤å¼ 128mï¼å»ºè®®å¼ï¼é»è®¤å¼å°±å¥½ï¼ä¹±æ¹åèå®¹æåºé®é¢ï¼å®ä¼å½±åå®é buffer pool å¤§å°ã\ninnodb_buffer_pool_chunk_size = 128m\n\n# å¨å¯å¨æ¶æç­æ°æ®å è½½å°åå­ãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_load_at_startup = 1\n\n# å¨å³é­æ¶æç­æ°æ® dump å°æ¬å°ç£çãé»è®¤å¼ä¸º onï¼ä¸ä¿®æ¹\ninnodb_buffer_pool_dump_at_shutdown = 1\n\n# è¯´æï¼å½±å innodb ç¼å²åºçå·æ°ç®æ³ï¼å»ºè®®ä»å°å°å¤§éç½®ï¼ç´å° zero free pagesï¼innodb_lru_scan_depth \\* innodb_buffer_pool_instances defines the amount of work performed by the page cleaner thread each secondã\n# é»è®¤å¼ 1024ï¼å»ºè®®å¼ï¼ æªç¥\ninnodb_lru_scan_depth = 1024\n\n# è¯´æï¼äºå¡ç­å¾è·åèµæºç­å¾çæé¿æ¶é´ï¼åä½ä¸ºç§ï¼çå·ä½ä¸å¡æåµï¼ä¸è¬é»è®¤å¼å°±å¥½\n# é»è®¤å¼ï¼50ï¼å»ºè®®å¼ï¼çä¸å¡ã\ninnodb_lock_wait_timeout = 60\n\n# è¯´æï¼è®¾ç½®äº mysql åå°ä»»å¡ï¼ä¾å¦é¡µå·æ°å merge dadta from buffer poolï¼æ¯ç§ io æä½çä¸éã\n# é»è®¤å¼ï¼200ï¼å»ºè®®å¼ï¼æ¹æ³ä¸ï¼åç sata è®¾ 100ï¼sas10ï¼raid10 è®¾ 200ï¼ssd è®¾ 2000ï¼fushion-io è®¾ 50000ï¼æ¹æ³äºï¼éè¿æµè¯å·¥å·è·å¾ç£ç io æ§è½åï¼è®¾ç½® iops æ°å¼/2ã\ninnodb_io_capacity = 2000\n\n# è¯´æï¼è¯¥åæ°æ¯ææç¼å²åºçº¿ç¨ io æä½çæ»ä¸éã\n# é»è®¤å¼ï¼innodb_io_capacity çä¸¤åãå»ºè®®å¼ï¼ä¾å¦ç¨ iometer æµè¯åç iops æ°å¼å°±å¥½\ninnodb_io_capacity_max = 4000\n\n# è¯´æï¼æ§å¶ç innodb æ°æ®æä»¶å redo log çæå¼ãå·åæ¨¡å¼ï¼ä¸ç§æ¨¡å¼ï¼fdatasync(é»è®¤)ï¼o_dsyncï¼o_direct\n# fdatasyncï¼æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# o_dsyncï¼ æ°æ®æä»¶ï¼buffer pool->os buffer->ç£çï¼æ¥å¿æä»¶ï¼buffer pool->ç£çï¼\n# o_directï¼ æ°æ®æä»¶ï¼buffer pool->ç£çï¼ æ¥å¿æä»¶ï¼buffer pool->os buffer->ç£çï¼\n# é»è®¤å¼ä¸ºç©ºï¼å»ºè®®å¼ï¼ä½¿ç¨ san æè raidï¼å»ºè®®ç¨ o_directï¼ä¸ææµè¯çè¯ï¼é»è®¤çäº§ä¸ä½¿ç¨ o_direct\ninnodb_flush_method = o_direct\n\n# è¯´æï¼mysql5.7 ä¹åé»è®¤å¼å¯ï¼æææ¯ï¼æ¯å¼ è¡¨ä¸ä¸ªç¬ç«è¡¨ç©ºé´ã\n# é»è®¤å¼ 1ï¼å¼å¯\ninnodb_file_per_table = 1\n\n# è¯´æï¼the path where innodb creates undo tablespacesãéå¸¸ç­äº undo log æä»¶çå­æ¾ç®å½ã\n# é»è®¤å¼ ./;èªè¡è®¾ç½®\ninnodb_undo_directory = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼the number of undo tablespaces used by innodb ç­äº undo log æä»¶æ°éã5.7.21 åå¼å§å¼ç¨\n# é»è®¤å¼ä¸º 0ï¼å»ºè®®é»è®¤å¼å°±å¥½ï¼ä¸ç¨è°æ´äºã\ninnodb_undo_tablespaces = 0\n\n# è¯´æï¼å®ä¹ undo ä½¿ç¨çåæ»æ®µæ°éã5.7.19 åå¼ç¨\n# é»è®¤å¼ 128ï¼å»ºè®®ä¸å¨ï¼ä»¥åå¼ç¨äºã\ninnodb_undo_logs = 128\n\n# è¯´æï¼5.7.5 åå¼å§ä½¿ç¨ï¼å¨çº¿æ¶ç¼© undo log ä½¿ç¨çç©ºé´ã\n# é»è®¤å¼ï¼å³é­ï¼å»ºè®®å¼ï¼å¼å¯\ninnodb_undo_log_truncate = 1\n\n# è¯´æï¼ç»å innodb_undo_log_truncateï¼å®ç° undo ç©ºé´æ¶ç¼©åè½\n# é»è®¤å¼ï¼1gï¼å»ºè®®å¼ï¼ä¸æ¹ã\ninnodb_max_undo_log_size = 1g\n\n# è¯´æï¼éä½æ¥å¿æä»¶çå­æ¾ç®å½\ninnodb_log_group_home_dir = /usr/local/mysql-5.7.21/log\n\n# è¯´æï¼æ¥å¿æä»¶çå¤§å°\n# é»è®¤å¼ï¼48mï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_file_size = 128m\n\n# è¯´æï¼æ¥å¿ç»ä¸­çæä»¶æ°éï¼mysql ä»¥å¾ªç¯æ¹å¼åå¥æ¥å¿\n# é»è®¤å¼ 2ï¼å»ºè®®å¼ï¼æ ¹æ®ä½ ç³»ç»çç£çç©ºé´åæ¥å¿å¢é¿æåµè°æ´å¤§å°\ninnodb_log_files_in_group = 3\n\n# æ­¤åæ°ç¡®å®äºæ¥å¿æä»¶æç¨çåå­å¤§å°ï¼ä»¥ m ä¸ºåä½ãç¼å²åºæ´å¤§è½æé«æ§è½ï¼ä½æå¤çæéå°ä¼ä¸¢å¤±æ°æ®ãmysql å¼åäººåå»ºè®®è®¾ç½®ä¸º 1ï¼8m ä¹é´\ninnodb_log_buffer_size = 16m\n\n# è¯´æï¼å¯ä»¥æ§å¶ log ä»ç³»ç» buffer å·å¥ç£çæä»¶çå·æ°é¢çï¼å¢å¤§å¯åè½»ç³»ç»è´è·\n# é»è®¤å¼æ¯ 1ï¼å»ºè®®å¼ä¸æ¹ãç³»ç»æ§è½ä¸è¬å¤ç¨ã\ninnodb_flush_log_at_timeout = 1\n\n# è¯´æï¼åæ°å¯è®¾ä¸º 0ï¼1ï¼2ï¼\n# åæ° 0ï¼è¡¨ç¤ºæ¯ç§å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼åè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\n# åæ° 1ï¼è¡¨ç¤ºæ¯æ¬¡äºç©æäº¤ï¼å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼åè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\n# åæ° 2ï¼è¡¨ç¤ºæ¯æ¬¡äºç©æäº¤ï¼å° log buffer åå®¹å·æ°å°ç³»ç» buffer ä¸­ï¼é 1 ç§ååè°ç¨ç³»ç» flush æä½åå¥ç£çæä»¶ã\ninnodb_flush_log_at_trx_commit = 1\n\n# è¯´æï¼éå¶ innodb è½æå¼çè¡¨çæ°æ®ï¼å¦æåºéçè¡¨ç¹å«å¤çæåµï¼è¯·å¢å è¿ä¸ªã\n# å¼é»è®¤æ¯ 2000ï¼å»ºè®®å¼ï¼åèæ°æ®åºè¡¨æ»æ°åè¿è¡è°æ´ï¼ä¸è¬å¤ç¨ä¸ç¨è°æ´ã\ninnodb_open_files = 8192\n\n# innodb å¤ç io è¯»åçåå°å¹¶åçº¿ç¨æ°éï¼æ ¹æ® cpu æ ¸æ¥ç¡®è®¤ï¼åå¼èå´ï¼1-64\n# é»è®¤å¼ï¼4ï¼å»ºè®®å¼ï¼ä¸é»è¾ cpu æ°éçä¸åä¿æä¸è´ã\ninnodb_read_io_threads = 4\ninnodb_write_io_threads = 4\n\n# é»è®¤è®¾ç½®ä¸º 0ï¼è¡¨ç¤ºä¸éå¶å¹¶åæ°ï¼è¿éæ¨èè®¾ç½®ä¸º 0ï¼æ´å¥½å»åæ¥ cpu å¤æ ¸å¤çè½åï¼æé«å¹¶åé\ninnodb_thread_concurrency = 0\n\n# é»è®¤å¼ä¸º 4ï¼å»ºè®®ä¸åãinnodb ä¸­çæ¸é¤æä½æ¯ä¸ç±»å®æåæ¶æ ç¨æ°æ®çæä½ãmysql 5.5 ä¹åï¼æ¯æå¤çº¿ç¨æ¸é¤æä½ã\ninnodb_purge_threads = 4\n\n# è¯´æï¼mysql ç¼å²åºåä¸º new blocks å old blocksï¼æ­¤åæ°è¡¨ç¤º old blocks å æ¯ï¼\n# é»è®¤å¼ï¼37ï¼å»ºè®®å¼ï¼ä¸è¬ä¸å¨\ninnodb_old_blocks_pct = 37\n\n# è¯´æï¼æ°æ°æ®è¢«è½½å¥ç¼å²æ± ï¼è¿å¥ old pages é¾åºï¼å½ 1 ç§ååæ¬¡è®¿é®ï¼åæåè¿å¥ new pages é¾åºã\n# é»è®¤å¼ï¼1000\ninnodb_old_blocks_time=1000\n\n# è¯´æï¼å¼å¯å¼æ­¥ ioï¼å¯ä»¥æé«å¹¶åæ§ï¼é»è®¤å¼å¯ã\n# é»è®¤å¼ä¸º 1ï¼å»ºè®®ä¸å¨\ninnodb_use_native_aio = 1\n\n# è¯´æï¼é»è®¤ä¸ºç©ºï¼ä½¿ç¨ data ç®å½ï¼ä¸è¬ä¸æ¹ã\ninnodb_data_home_dir=/usr/local/mysql-5.7.21/data\n\n# è¯´æï¼defines the nameï¼sizeï¼and attributes of innodb system tablespace data filesã\n# é»è®¤å¼ï¼ä¸æå®ï¼é»è®¤ä¸º ibdata1ï¼12mï¼autoextend\ninnodb_data_file_path = ibdata1ï¼12mï¼autoextend\n\n# è¯´æï¼è®¾ç½®äº innodb å­å¨å¼æç¨æ¥å­æ¾æ°æ®å­å¸ä¿¡æ¯ä»¥åä¸äºåé¨æ°æ®ç»æçåå­ç©ºé´å¤§å°ï¼é¤éä½ çæ°æ®å¯¹è±¡åå¶å¤ï¼å¦åä¸è¬é»è®¤ä¸æ¹ã\n# innodb_additional_mem_pool_size = 16m\n# è¯´æï¼the crash recovery modeãåªæç´§æ¥æåµéè¦æ¢å¤æ°æ®çæ¶åï¼ææ¹ä¸ºå¤§äº 1-6 ä¹é´æ°å¼ï¼å«ä¹æ¥ä¸å®ç½ã\n# é»è®¤å¼ä¸º 0ï¼\n#innodb_force_recovery = 0\n\n\n\n[mysqldump]\n\n# quick éé¡¹å¼ºå¶ mysqldump ä»æå¡å¨æ¥è¯¢åå¾è®°å½ç´æ¥è¾åºèä¸æ¯åå¾ææè®°å½åå°å®ä»¬ç¼å­å°åå­ä¸­\nquick\n\nmax_allowed_packet = 16m\n\n\n\n[mysql]\n\n# mysql å½ä»¤è¡å·¥å·ä¸ä½¿ç¨èªå¨è¡¥å¨åè½ï¼å»ºè®®è¿æ¯æ¹ä¸º\n# no-auto-rehash\nauto-rehash\n\n# socket æä»¶\nsocket = /var/lib/mysql/mysql.sock\n\n\n\n# 3. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * mysql éç½®æä»¶/etc/my.cnf è§£æ",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql å¸¸è§é®é¢",frontmatter:{title:"Mysql å¸¸è§é®é¢",date:"2020-09-12T10:43:53.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql","FAQ"],permalink:"/pages/5885bb/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/99.Mysql%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/99.Mysqlå¸¸è§é®é¢.md",key:"v-47bbb02c",path:"/pages/5885bb/",headers:[{level:2,title:"1. ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å",slug:"_1-ä¸ºä»ä¹è¡¨æ°æ®å æä¸å-è¡¨æä»¶å¤§å°ä¸å",normalizedTitle:"1. ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å",charIndex:48},{level:2,title:"2. åèèµæ",slug:"_2-åèèµæ",normalizedTitle:"2. åèèµæ",charIndex:747}],headersStr:"1. ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å 2. åèèµæ",content:"# Mysql å¸¸è§é®é¢\n\n> ð¦ æ¬æä»¥åç¤ºä¾æºç å·²å½æ¡£å¨ db-tutorial\n\n\n# 1. ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å\n\nãé®é¢ãæ°æ®åºå ç¨ç©ºé´å¤ªå¤§ï¼ææä¸ä¸ªæå¤§çè¡¨å æäºä¸åçæ°æ®ï¼æä¹è¡¨æä»¶çå¤§å°è¿æ¯æ²¡åï¼\n\nè¡¨æ°æ®æ¢å¯ä»¥å­å¨å±äº«è¡¨ç©ºé´éï¼ä¹å¯ä»¥æ¯åç¬çæä»¶ãè¿ä¸ªè¡ä¸ºæ¯ç±åæ° innodb_file_per_table æ§å¶çï¼\n\n 1. è¿ä¸ªåæ°è®¾ç½®ä¸º OFF è¡¨ç¤ºçæ¯ï¼è¡¨çæ°æ®æ¾å¨ç³»ç»å±äº«è¡¨ç©ºé´ï¼ä¹å°±æ¯è·æ°æ®å­å¸æ¾å¨ä¸èµ·ï¼\n 2. è¿ä¸ªåæ°è®¾ç½®ä¸º ON è¡¨ç¤ºçæ¯ï¼æ¯ä¸ª InnoDB è¡¨æ°æ®å­å¨å¨ä¸ä¸ªä»¥ .ibd ä¸ºåç¼çæä»¶ä¸­ã\n\nä» MySQL 5.6.6 çæ¬å¼å§ï¼å®çé»è®¤å¼å°±æ¯ ON äºã\n\næå»ºè®®ä½ ä¸è®ºä½¿ç¨ MySQL çåªä¸ªçæ¬ï¼é½å°è¿ä¸ªå¼è®¾ç½®ä¸º ONãå ä¸ºï¼ä¸ä¸ªè¡¨åç¬å­å¨ä¸ºä¸ä¸ªæä»¶æ´å®¹æç®¡çï¼èä¸å¨ä½ ä¸éè¦è¿ä¸ªè¡¨çæ¶åï¼éè¿ drop table å½ä»¤ï¼ç³»ç»å°±ä¼ç´æ¥å é¤è¿ä¸ªæä»¶ãèå¦ææ¯æ¾å¨å±äº«è¡¨ç©ºé´ä¸­ï¼å³ä½¿è¡¨å æäºï¼ç©ºé´ä¹æ¯ä¸ä¼åæ¶çã\n\næä»¥ï¼å° innodb_file_per_table è®¾ç½®ä¸º ONï¼æ¯æ¨èåæ³ï¼æä»¬æ¥ä¸æ¥çè®¨è®ºé½æ¯åºäºè¿ä¸ªè®¾ç½®å±å¼çã\n\næä»¬å¨å é¤æ´ä¸ªè¡¨çæ¶åï¼å¯ä»¥ä½¿ç¨ drop table å½ä»¤åæ¶è¡¨ç©ºé´ãä½æ¯ï¼æä»¬éå°çæ´å¤çå é¤æ°æ®çåºæ¯æ¯å é¤æäºè¡ï¼è¿æ¶å°±éå°äºæä»¬æç« å¼å¤´çé®é¢ï¼è¡¨ä¸­çæ°æ®è¢«å é¤äºï¼ä½æ¯è¡¨ç©ºé´å´æ²¡æè¢«åæ¶ã\n\næå¥åå é¤æä½å¯è½ä¼é æç©ºæ´ã\n\n * æå¥æ¶ï¼å¦ææå¥ä½ç½®æå¨é¡µå·²æ»¡ï¼éè¦ç³è¯·æ°é¡µé¢ã\n * å é¤æ¶ï¼ä¸ä¼å é¤æå¨é¡µï¼èæ¯å°è®°å½å¨é¡µé¢çä½ç½®æ è®°ä¸ºå¯éç¨ã\n\næä»¥ï¼å¦æè½å¤æè¿äºç©ºæ´å»æï¼å°±è½è¾¾å°æ¶ç¼©è¡¨ç©ºé´çç®çã\n\nè¦è¾¾å°æ¶ç¼©ç©ºæ´çç®çï¼å¯ä»¥ä½¿ç¨éå»ºè¡¨çæ¹å¼ã\n\n\n# 2. åèèµæ\n\n * ãé«æ§è½ MySQLã\n * MySQL å®æ 45 è®²",normalizedContent:"# mysql å¸¸è§é®é¢\n\n> ð¦ æ¬æä»¥åç¤ºä¾æºç å·²å½æ¡£å¨ db-tutorial\n\n\n# 1. ä¸ºä»ä¹è¡¨æ°æ®å æä¸åï¼è¡¨æä»¶å¤§å°ä¸å\n\nãé®é¢ãæ°æ®åºå ç¨ç©ºé´å¤ªå¤§ï¼ææä¸ä¸ªæå¤§çè¡¨å æäºä¸åçæ°æ®ï¼æä¹è¡¨æä»¶çå¤§å°è¿æ¯æ²¡åï¼\n\nè¡¨æ°æ®æ¢å¯ä»¥å­å¨å±äº«è¡¨ç©ºé´éï¼ä¹å¯ä»¥æ¯åç¬çæä»¶ãè¿ä¸ªè¡ä¸ºæ¯ç±åæ° innodb_file_per_table æ§å¶çï¼\n\n 1. è¿ä¸ªåæ°è®¾ç½®ä¸º off è¡¨ç¤ºçæ¯ï¼è¡¨çæ°æ®æ¾å¨ç³»ç»å±äº«è¡¨ç©ºé´ï¼ä¹å°±æ¯è·æ°æ®å­å¸æ¾å¨ä¸èµ·ï¼\n 2. è¿ä¸ªåæ°è®¾ç½®ä¸º on è¡¨ç¤ºçæ¯ï¼æ¯ä¸ª innodb è¡¨æ°æ®å­å¨å¨ä¸ä¸ªä»¥ .ibd ä¸ºåç¼çæä»¶ä¸­ã\n\nä» mysql 5.6.6 çæ¬å¼å§ï¼å®çé»è®¤å¼å°±æ¯ on äºã\n\næå»ºè®®ä½ ä¸è®ºä½¿ç¨ mysql çåªä¸ªçæ¬ï¼é½å°è¿ä¸ªå¼è®¾ç½®ä¸º onãå ä¸ºï¼ä¸ä¸ªè¡¨åç¬å­å¨ä¸ºä¸ä¸ªæä»¶æ´å®¹æç®¡çï¼èä¸å¨ä½ ä¸éè¦è¿ä¸ªè¡¨çæ¶åï¼éè¿ drop table å½ä»¤ï¼ç³»ç»å°±ä¼ç´æ¥å é¤è¿ä¸ªæä»¶ãèå¦ææ¯æ¾å¨å±äº«è¡¨ç©ºé´ä¸­ï¼å³ä½¿è¡¨å æäºï¼ç©ºé´ä¹æ¯ä¸ä¼åæ¶çã\n\næä»¥ï¼å° innodb_file_per_table è®¾ç½®ä¸º onï¼æ¯æ¨èåæ³ï¼æä»¬æ¥ä¸æ¥çè®¨è®ºé½æ¯åºäºè¿ä¸ªè®¾ç½®å±å¼çã\n\næä»¬å¨å é¤æ´ä¸ªè¡¨çæ¶åï¼å¯ä»¥ä½¿ç¨ drop table å½ä»¤åæ¶è¡¨ç©ºé´ãä½æ¯ï¼æä»¬éå°çæ´å¤çå é¤æ°æ®çåºæ¯æ¯å é¤æäºè¡ï¼è¿æ¶å°±éå°äºæä»¬æç« å¼å¤´çé®é¢ï¼è¡¨ä¸­çæ°æ®è¢«å é¤äºï¼ä½æ¯è¡¨ç©ºé´å´æ²¡æè¢«åæ¶ã\n\næå¥åå é¤æä½å¯è½ä¼é æç©ºæ´ã\n\n * æå¥æ¶ï¼å¦ææå¥ä½ç½®æå¨é¡µå·²æ»¡ï¼éè¦ç³è¯·æ°é¡µé¢ã\n * å é¤æ¶ï¼ä¸ä¼å é¤æå¨é¡µï¼èæ¯å°è®°å½å¨é¡µé¢çä½ç½®æ è®°ä¸ºå¯éç¨ã\n\næä»¥ï¼å¦æè½å¤æè¿äºç©ºæ´å»æï¼å°±è½è¾¾å°æ¶ç¼©è¡¨ç©ºé´çç®çã\n\nè¦è¾¾å°æ¶ç¼©ç©ºæ´çç®çï¼å¯ä»¥ä½¿ç¨éå»ºè¡¨çæ¹å¼ã\n\n\n# 2. åèèµæ\n\n * ãé«æ§è½ mysqlã\n * mysql å®æ 45 è®²",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Mysql æç¨",frontmatter:{title:"Mysql æç¨",date:"2020-02-10T14:27:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","Mysql"],permalink:"/pages/a7b923/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/02.Mysql/",relativePath:"03.å³ç³»åæ°æ®åº/02.Mysql/README.md",key:"v-075759e4",path:"/pages/a7b923/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:17},{level:3,title:"Mysql åºç¨æå",slug:"mysql-åºç¨æå",normalizedTitle:"mysql åºç¨æå",charIndex:27},{level:3,title:"Mysql å·¥ä½æµ",slug:"mysql-å·¥ä½æµ",normalizedTitle:"mysql å·¥ä½æµ",charIndex:42},{level:3,title:"Mysql äºå¡",slug:"mysql-äºå¡",normalizedTitle:"mysql äºå¡",charIndex:56},{level:3,title:"Mysql é",slug:"mysql-é",normalizedTitle:"mysql é",charIndex:110},{level:3,title:"Mysql ç´¢å¼",slug:"mysql-ç´¢å¼",normalizedTitle:"mysql ç´¢å¼",charIndex:163},{level:3,title:"Mysql æ§è½ä¼å",slug:"mysql-æ§è½ä¼å",normalizedTitle:"mysql æ§è½ä¼å",charIndex:202},{level:3,title:"Mysql è¿ç»´ ð¨",slug:"mysql-è¿ç»´-ð¨",normalizedTitle:"mysql è¿ç»´ ð¨",charIndex:217},{level:3,title:"Mysql éç½® ð¨",slug:"mysql-éç½®-ð¨",normalizedTitle:"mysql éç½® ð¨",charIndex:233},{level:3,title:"Mysql å¸¸è§é®é¢",slug:"mysql-å¸¸è§é®é¢",normalizedTitle:"mysql å¸¸è§é®é¢",charIndex:249},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:365},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:605}],headersStr:"ð åå®¹ Mysql åºç¨æå Mysql å·¥ä½æµ Mysql äºå¡ Mysql é Mysql ç´¢å¼ Mysql æ§è½ä¼å Mysql è¿ç»´ ð¨ Mysql éç½® ð¨ Mysql å¸¸è§é®é¢ ð èµæ ðª ä¼ é",content:"# Mysql æç¨\n\n\n\n\n# ð åå®¹\n\n\n# Mysql åºç¨æå\n\n\n# Mysql å·¥ä½æµ\n\n\n# Mysql äºå¡\n\n> å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n\n\n\n\n# Mysql é\n\n> å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n\n\n\n\n# Mysql ç´¢å¼\n\n> å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n\n\n\n\n# Mysql æ§è½ä¼å\n\n\n# Mysql è¿ç»´ ð¨\n\n\n# Mysql éç½® ð¨\n\n\n# Mysql å¸¸è§é®é¢\n\n----------------------------------------\n\nç¸å³æ©å±ç¥è¯ï¼\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * SQL Cheat Sheet\n * åå¸å¼äºå¡åºæ¬åç\n\n\n# ð èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * Mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæå\n   * ãMySQL å¿ç¥å¿ä¼ã - éåå¥é¨è\n * æç¨\n   * MySQL å®æ 45 è®²\n   * runoob.com MySQL æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# mysql æç¨\n\n\n\n\n# ð åå®¹\n\n\n# mysql åºç¨æå\n\n\n# mysql å·¥ä½æµ\n\n\n# mysql äºå¡\n\n> å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n\n\n\n\n# mysql é\n\n> å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n\n\n\n\n# mysql ç´¢å¼\n\n> å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n\n\n\n\n# mysql æ§è½ä¼å\n\n\n# mysql è¿ç»´ ð¨\n\n\n# mysql éç½® ð¨\n\n\n# mysql å¸¸è§é®é¢\n\n----------------------------------------\n\nç¸å³æ©å±ç¥è¯ï¼\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * sql cheat sheet\n * åå¸å¼äºå¡åºæ¬åç\n\n\n# ð èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæå\n   * ãmysql å¿ç¥å¿ä¼ã - éåå¥é¨è\n * æç¨\n   * mysql å®æ 45 è®²\n   * runoob.com mysql æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"PostgreSQL åºç¨æå",frontmatter:{title:"PostgreSQL åºç¨æå",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","PostgreSQL"],permalink:"/pages/1d898b/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/01.PostgreSQL.html",relativePath:"03.å³ç³»åæ°æ®åº/99.å¶ä»/01.PostgreSQL.md",key:"v-5cb554e2",path:"/pages/1d898b/",headers:[{level:2,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:85},{level:2,title:"æ·»å æ°ç¨æ·åæ°æ°æ®åº",slug:"æ·»å æ°ç¨æ·åæ°æ°æ®åº",normalizedTitle:"æ·»å æ°ç¨æ·åæ°æ°æ®åº",charIndex:612},{level:2,title:"ç»å½æ°æ®åº",slug:"ç»å½æ°æ®åº",normalizedTitle:"ç»å½æ°æ®åº",charIndex:866},{level:2,title:"æ§å¶å°å½ä»¤",slug:"æ§å¶å°å½ä»¤",normalizedTitle:"æ§å¶å°å½ä»¤",charIndex:1897},{level:2,title:"æ°æ®åºæä½",slug:"æ°æ®åºæä½",normalizedTitle:"æ°æ®åºæä½",charIndex:1247},{level:2,title:"å¤ä»½åæ¢å¤",slug:"å¤ä»½åæ¢å¤",normalizedTitle:"å¤ä»½åæ¢å¤",charIndex:2901},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:3037},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:3166}],headersStr:"å®è£ æ·»å æ°ç¨æ·åæ°æ°æ®åº ç»å½æ°æ®åº æ§å¶å°å½ä»¤ æ°æ®åºæä½ å¤ä»½åæ¢å¤ åèèµæ ðª ä¼ éé¨",content:"# PostgreSQL åºç¨æå\n\n> PostgreSQL æ¯ä¸ä¸ªå³ç³»åæ°æ®åºï¼RDBMï¼ã\n> \n> å³é®è¯ï¼Database, RDBM, psql\n\n\n\n\n# å®è£\n\n> æ¬æä»ä»¥è¿è¡å¨ Centos ç¯å¢ä¸ä¸¾ä¾ã\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼æ ¹æ®æä½ç³»ç»éæ©åéçæ¬ã\n\nå®æ¹ä¸è½½é¡µé¢è¦æ±ç¨æ·éæ©ç¸åºçæ¬ï¼ç¶åå¨æçç»åºå®è£æç¤ºï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå 3 æ­¥è¦æ±ç¨æ·éæ©ï¼å 4 æ­¥æ¯æ ¹æ®éæ©å¨ææç¤ºçå®è£æ­¥éª¤\n\nï¼1ï¼éæ© PostgreSQL çæ¬\n\nï¼2ï¼éæ©å¹³å°\n\nï¼3ï¼éæ©æ¶æ\n\nï¼4ï¼å®è£ PostgreSQL ç rpm ä»åºï¼ä¸ºäºè¯å«ä¸è½½æºï¼\n\nyum install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm\n\n\nï¼5ï¼å®è£å®¢æ·ç«¯\n\nyum install postgresql10\n\n\nï¼6ï¼å®è£æå¡ç«¯ï¼å¯éçï¼\n\nyum install postgresql10-server\n\n\nï¼7ï¼è®¾ç½®å¼æºå¯å¨ï¼å¯éçï¼\n\n/usr/pgsql-10/bin/postgresql-10-setup initdb\nsystemctl enable postgresql-10\nsystemctl start postgresql-10\n\n\n\n# æ·»å æ°ç¨æ·åæ°æ°æ®åº\n\nåæ¬¡å®è£åï¼é»è®¤çæä¸ä¸ªåä¸º postgres çæ°æ®åºåä¸ä¸ªåä¸º postgres çæ°æ®åºç¨æ·ãè¿ééè¦æ³¨æçæ¯ï¼åæ¶è¿çæäºä¸ä¸ªåä¸º postgres ç Linux ç³»ç»ç¨æ·ã\n\né¦åï¼æ°å»ºä¸ä¸ª Linux æ°ç¨æ·ï¼å¯ä»¥åä½ æ³è¦çåå­ï¼è¿éä¸º dbuserã\n\nsudo adduser dbuser\n\n\nä½¿ç¨ psql å½ä»¤ç»å½ PostgreSQL æ§å¶å°ï¼\n\nsudo -u postgres psql\n\n\nè¿æ¶ç¸å½äºç³»ç»ç¨æ· postgres ä»¥ååæ°æ®åºç¨æ·çèº«ä»½ï¼ç»å½æ°æ®åºï¼è¿æ¯ä¸ç¨è¾å¥å¯ç çãå¦æä¸åæ­£å¸¸ï¼ç³»ç»æç¤ºç¬¦ä¼åä¸º\"postgres=#\"ï¼è¡¨ç¤ºè¿æ¶å·²ç»è¿å¥äºæ°æ®åºæ§å¶å°ãä»¥ä¸çå½ä»¤é½å¨æ§å¶å°åå®æã\n\nï¼1ï¼ä½¿ç¨ \\password å½ä»¤ï¼ä¸º postgres ç¨æ·è®¾ç½®ä¸ä¸ªå¯ç ã\n\npostgres=# \\password postgres\n\n\nï¼2ï¼åå»ºæ°æ®åºç¨æ· dbuserï¼åæåå»ºçæ¯ Linux ç³»ç»ç¨æ·ï¼ï¼å¹¶è®¾ç½®å¯ç ã\n\nCREATE USER dbuser WITH PASSWORD 'password';\n\n\nï¼3ï¼åå»ºç¨æ·æ°æ®åºï¼è¿éä¸º exampledbï¼å¹¶æå®ææèä¸º dbuserã\n\nCREATE DATABASE exampledb OWNER dbuser;\n\n\nï¼4ï¼å° exampledb æ°æ®åºçæææéé½èµäº dbuserï¼å¦å dbuser åªè½ç»å½æ§å¶å°ï¼æ²¡æä»»ä½æ°æ®åºæä½æéã\n\nGRANT ALL PRIVILEGES ON DATABASE exampledb to dbuser;\n\n\nï¼5ï¼ä½¿ç¨\\q å½ä»¤éåºæ§å¶å°ï¼ä¹å¯ä»¥ç´æ¥æ ctrl+Dï¼ã\n\n\n# ç»å½æ°æ®åº\n\næ·»å æ°ç¨æ·åæ°æ°æ®åºä»¥åï¼å°±è¦ä»¥æ°ç¨æ·çåä¹ç»å½æ°æ®åºï¼è¿æ¶ä½¿ç¨çæ¯ psql å½ä»¤ã\n\npsql -U dbuser -d exampledb -h 127.0.0.1 -p 5432\n\n\nä¸é¢å½ä»¤çåæ°å«ä¹å¦ä¸ï¼-U æå®ç¨æ·ï¼-d æå®æ°æ®åºï¼-h æå®æå¡å¨ï¼-p æå®ç«¯å£ã\n\nè¾å¥ä¸é¢å½ä»¤ä»¥åï¼ç³»ç»ä¼æç¤ºè¾å¥ dbuser ç¨æ·çå¯ç ãè¾å¥æ­£ç¡®ï¼å°±å¯ä»¥ç»å½æ§å¶å°äºã\n\npsql å½ä»¤å­å¨ç®åå½¢å¼ãå¦æå½å Linux ç³»ç»ç¨æ·ï¼åæ¶ä¹æ¯ PostgreSQL ç¨æ·ï¼åå¯ä»¥çç¥ç¨æ·åï¼-U åæ°çé¨åï¼ãä¸¾ä¾æ¥è¯´ï¼æç Linux ç³»ç»ç¨æ·åä¸º ruanyfï¼ä¸ PostgreSQL æ°æ®åºå­å¨ååç¨æ·ï¼åæä»¥ ruanyf èº«ä»½ç»å½ Linux ç³»ç»åï¼å¯ä»¥ç´æ¥ä½¿ç¨ä¸é¢çå½ä»¤ç»å½æ°æ®åºï¼ä¸ä¸éè¦å¯ç ã\n\npsql exampledb\n\n\næ­¤æ¶ï¼å¦æ PostgreSQL åé¨è¿å­å¨ä¸å½åç³»ç»ç¨æ·ååçæ°æ®åºï¼åè¿æ°æ®åºåé½å¯ä»¥çç¥ãæ¯å¦ï¼åå®å­å¨ä¸ä¸ªå«å ruanyf çæ°æ®åºï¼åç´æ¥é®å¥ psql å°±å¯ä»¥ç»å½è¯¥æ°æ®åºã\n\npsql\n\nå¦å¤ï¼å¦æè¦æ¢å¤å¤é¨æ°æ®ï¼å¯ä»¥ä½¿ç¨ä¸é¢çå½ä»¤ã\n\npsql exampledb < exampledb.sql\n\n\n\n# æ§å¶å°å½ä»¤\n\né¤äºåé¢å·²ç»ç¨å°ç \\password å½ä»¤ï¼è®¾ç½®å¯ç ï¼å \\q å½ä»¤ï¼éåºï¼ä»¥å¤ï¼æ§å¶å°è¿æä¾ä¸ç³»åå¶ä»å½ä»¤ã\n\n\\password           è®¾ç½®å¯ç \n\\q                  éåº\n\\h                  æ¥çSQLå½ä»¤çè§£éï¼æ¯å¦\\h select\n\\?                  æ¥çpsqlå½ä»¤åè¡¨\n\\l                  ååºæææ°æ®åº\n\\c [database_name]  è¿æ¥å¶ä»æ°æ®åº\n\\d                  ååºå½åæ°æ®åºçææè¡¨æ ¼\n\\d [table_name]     ååºæä¸å¼ è¡¨æ ¼çç»æ\n\\x                  å¯¹æ°æ®åå±å¼æä½\n\\du                 ååºææç¨æ·\n\n\n\n# æ°æ®åºæä½\n\nåºæ¬çæ°æ®åºæä½ï¼å°±æ¯ä½¿ç¨ä¸è¬ç SQL è¯­è¨ã\n\n# åå»ºæ°è¡¨\nCREATE TABLE user_tbl(name VARCHAR(20), signup_date DATE);\n# æå¥æ°æ®\nINSERT INTO user_tbl(name, signup_date) VALUES('å¼ ä¸', '2013-12-22');\n# éæ©è®°å½\nSELECT * FROM user_tbl;\n# æ´æ°æ°æ®\nUPDATE user_tbl set name = 'æå' WHERE name = 'å¼ ä¸';\n# å é¤è®°å½\nDELETE FROM user_tbl WHERE name = 'æå' ;\n# æ·»å æ ä½\nALTER TABLE user_tbl ADD email VARCHAR(40);\n# æ´æ°ç»æ\nALTER TABLE user_tbl ALTER COLUMN signup_date SET NOT NULL;\n# æ´åæ ä½\nALTER TABLE user_tbl RENAME COLUMN signup_date TO signup;\n# å é¤æ ä½\nALTER TABLE user_tbl DROP COLUMN email;\n# è¡¨æ ¼æ´å\nALTER TABLE user_tbl RENAME TO backup_tbl;\n# å é¤è¡¨æ ¼\nDROP TABLE IF EXISTS backup_tbl;\n\n\n\n# å¤ä»½åæ¢å¤\n\npg_dump --format=t -d db_name -U user_name -h 127.0.0.1 -O -W  > dump.sql\npsql -h 127.0.0.1 -U user_name db_name < dump.sql\n\n\n\n# åèèµæ\n\n * https://www.postgresql.org/download/\n * http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\n\n\n# ðª ä¼ éé¨\n\n| æç Github åå®¢ | db-tutorial é¦é¡µ |",normalizedContent:"# postgresql åºç¨æå\n\n> postgresql æ¯ä¸ä¸ªå³ç³»åæ°æ®åºï¼rdbmï¼ã\n> \n> å³é®è¯ï¼database, rdbm, psql\n\n\n\n\n# å®è£\n\n> æ¬æä»ä»¥è¿è¡å¨ centos ç¯å¢ä¸ä¸¾ä¾ã\n\nè¿å¥å®æ¹ä¸è½½é¡µé¢ï¼æ ¹æ®æä½ç³»ç»éæ©åéçæ¬ã\n\nå®æ¹ä¸è½½é¡µé¢è¦æ±ç¨æ·éæ©ç¸åºçæ¬ï¼ç¶åå¨æçç»åºå®è£æç¤ºï¼å¦ä¸å¾æç¤ºï¼\n\n\n\nå 3 æ­¥è¦æ±ç¨æ·éæ©ï¼å 4 æ­¥æ¯æ ¹æ®éæ©å¨ææç¤ºçå®è£æ­¥éª¤\n\nï¼1ï¼éæ© postgresql çæ¬\n\nï¼2ï¼éæ©å¹³å°\n\nï¼3ï¼éæ©æ¶æ\n\nï¼4ï¼å®è£ postgresql ç rpm ä»åºï¼ä¸ºäºè¯å«ä¸è½½æºï¼\n\nyum install https://download.postgresql.org/pub/repos/yum/10/redhat/rhel-7-x86_64/pgdg-centos10-10-2.noarch.rpm\n\n\nï¼5ï¼å®è£å®¢æ·ç«¯\n\nyum install postgresql10\n\n\nï¼6ï¼å®è£æå¡ç«¯ï¼å¯éçï¼\n\nyum install postgresql10-server\n\n\nï¼7ï¼è®¾ç½®å¼æºå¯å¨ï¼å¯éçï¼\n\n/usr/pgsql-10/bin/postgresql-10-setup initdb\nsystemctl enable postgresql-10\nsystemctl start postgresql-10\n\n\n\n# æ·»å æ°ç¨æ·åæ°æ°æ®åº\n\nåæ¬¡å®è£åï¼é»è®¤çæä¸ä¸ªåä¸º postgres çæ°æ®åºåä¸ä¸ªåä¸º postgres çæ°æ®åºç¨æ·ãè¿ééè¦æ³¨æçæ¯ï¼åæ¶è¿çæäºä¸ä¸ªåä¸º postgres ç linux ç³»ç»ç¨æ·ã\n\né¦åï¼æ°å»ºä¸ä¸ª linux æ°ç¨æ·ï¼å¯ä»¥åä½ æ³è¦çåå­ï¼è¿éä¸º dbuserã\n\nsudo adduser dbuser\n\n\nä½¿ç¨ psql å½ä»¤ç»å½ postgresql æ§å¶å°ï¼\n\nsudo -u postgres psql\n\n\nè¿æ¶ç¸å½äºç³»ç»ç¨æ· postgres ä»¥ååæ°æ®åºç¨æ·çèº«ä»½ï¼ç»å½æ°æ®åºï¼è¿æ¯ä¸ç¨è¾å¥å¯ç çãå¦æä¸åæ­£å¸¸ï¼ç³»ç»æç¤ºç¬¦ä¼åä¸º\"postgres=#\"ï¼è¡¨ç¤ºè¿æ¶å·²ç»è¿å¥äºæ°æ®åºæ§å¶å°ãä»¥ä¸çå½ä»¤é½å¨æ§å¶å°åå®æã\n\nï¼1ï¼ä½¿ç¨ \\password å½ä»¤ï¼ä¸º postgres ç¨æ·è®¾ç½®ä¸ä¸ªå¯ç ã\n\npostgres=# \\password postgres\n\n\nï¼2ï¼åå»ºæ°æ®åºç¨æ· dbuserï¼åæåå»ºçæ¯ linux ç³»ç»ç¨æ·ï¼ï¼å¹¶è®¾ç½®å¯ç ã\n\ncreate user dbuser with password 'password';\n\n\nï¼3ï¼åå»ºç¨æ·æ°æ®åºï¼è¿éä¸º exampledbï¼å¹¶æå®ææèä¸º dbuserã\n\ncreate database exampledb owner dbuser;\n\n\nï¼4ï¼å° exampledb æ°æ®åºçæææéé½èµäº dbuserï¼å¦å dbuser åªè½ç»å½æ§å¶å°ï¼æ²¡æä»»ä½æ°æ®åºæä½æéã\n\ngrant all privileges on database exampledb to dbuser;\n\n\nï¼5ï¼ä½¿ç¨\\q å½ä»¤éåºæ§å¶å°ï¼ä¹å¯ä»¥ç´æ¥æ ctrl+dï¼ã\n\n\n# ç»å½æ°æ®åº\n\næ·»å æ°ç¨æ·åæ°æ°æ®åºä»¥åï¼å°±è¦ä»¥æ°ç¨æ·çåä¹ç»å½æ°æ®åºï¼è¿æ¶ä½¿ç¨çæ¯ psql å½ä»¤ã\n\npsql -u dbuser -d exampledb -h 127.0.0.1 -p 5432\n\n\nä¸é¢å½ä»¤çåæ°å«ä¹å¦ä¸ï¼-u æå®ç¨æ·ï¼-d æå®æ°æ®åºï¼-h æå®æå¡å¨ï¼-p æå®ç«¯å£ã\n\nè¾å¥ä¸é¢å½ä»¤ä»¥åï¼ç³»ç»ä¼æç¤ºè¾å¥ dbuser ç¨æ·çå¯ç ãè¾å¥æ­£ç¡®ï¼å°±å¯ä»¥ç»å½æ§å¶å°äºã\n\npsql å½ä»¤å­å¨ç®åå½¢å¼ãå¦æå½å linux ç³»ç»ç¨æ·ï¼åæ¶ä¹æ¯ postgresql ç¨æ·ï¼åå¯ä»¥çç¥ç¨æ·åï¼-u åæ°çé¨åï¼ãä¸¾ä¾æ¥è¯´ï¼æç linux ç³»ç»ç¨æ·åä¸º ruanyfï¼ä¸ postgresql æ°æ®åºå­å¨ååç¨æ·ï¼åæä»¥ ruanyf èº«ä»½ç»å½ linux ç³»ç»åï¼å¯ä»¥ç´æ¥ä½¿ç¨ä¸é¢çå½ä»¤ç»å½æ°æ®åºï¼ä¸ä¸éè¦å¯ç ã\n\npsql exampledb\n\n\næ­¤æ¶ï¼å¦æ postgresql åé¨è¿å­å¨ä¸å½åç³»ç»ç¨æ·ååçæ°æ®åºï¼åè¿æ°æ®åºåé½å¯ä»¥çç¥ãæ¯å¦ï¼åå®å­å¨ä¸ä¸ªå«å ruanyf çæ°æ®åºï¼åç´æ¥é®å¥ psql å°±å¯ä»¥ç»å½è¯¥æ°æ®åºã\n\npsql\n\nå¦å¤ï¼å¦æè¦æ¢å¤å¤é¨æ°æ®ï¼å¯ä»¥ä½¿ç¨ä¸é¢çå½ä»¤ã\n\npsql exampledb < exampledb.sql\n\n\n\n# æ§å¶å°å½ä»¤\n\né¤äºåé¢å·²ç»ç¨å°ç \\password å½ä»¤ï¼è®¾ç½®å¯ç ï¼å \\q å½ä»¤ï¼éåºï¼ä»¥å¤ï¼æ§å¶å°è¿æä¾ä¸ç³»åå¶ä»å½ä»¤ã\n\n\\password           è®¾ç½®å¯ç \n\\q                  éåº\n\\h                  æ¥çsqlå½ä»¤çè§£éï¼æ¯å¦\\h select\n\\?                  æ¥çpsqlå½ä»¤åè¡¨\n\\l                  ååºæææ°æ®åº\n\\c [database_name]  è¿æ¥å¶ä»æ°æ®åº\n\\d                  ååºå½åæ°æ®åºçææè¡¨æ ¼\n\\d [table_name]     ååºæä¸å¼ è¡¨æ ¼çç»æ\n\\x                  å¯¹æ°æ®åå±å¼æä½\n\\du                 ååºææç¨æ·\n\n\n\n# æ°æ®åºæä½\n\nåºæ¬çæ°æ®åºæä½ï¼å°±æ¯ä½¿ç¨ä¸è¬ç sql è¯­è¨ã\n\n# åå»ºæ°è¡¨\ncreate table user_tbl(name varchar(20), signup_date date);\n# æå¥æ°æ®\ninsert into user_tbl(name, signup_date) values('å¼ ä¸', '2013-12-22');\n# éæ©è®°å½\nselect * from user_tbl;\n# æ´æ°æ°æ®\nupdate user_tbl set name = 'æå' where name = 'å¼ ä¸';\n# å é¤è®°å½\ndelete from user_tbl where name = 'æå' ;\n# æ·»å æ ä½\nalter table user_tbl add email varchar(40);\n# æ´æ°ç»æ\nalter table user_tbl alter column signup_date set not null;\n# æ´åæ ä½\nalter table user_tbl rename column signup_date to signup;\n# å é¤æ ä½\nalter table user_tbl drop column email;\n# è¡¨æ ¼æ´å\nalter table user_tbl rename to backup_tbl;\n# å é¤è¡¨æ ¼\ndrop table if exists backup_tbl;\n\n\n\n# å¤ä»½åæ¢å¤\n\npg_dump --format=t -d db_name -u user_name -h 127.0.0.1 -o -w  > dump.sql\npsql -h 127.0.0.1 -u user_name db_name < dump.sql\n\n\n\n# åèèµæ\n\n * https://www.postgresql.org/download/\n * http://www.ruanyifeng.com/blog/2013/12/getting_started_with_postgresql.html\n\n\n# ðª ä¼ éé¨\n\n| æç github åå®¢ | db-tutorial é¦é¡µ |",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"H2 åºç¨æå",frontmatter:{title:"H2 åºç¨æå",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","H2"],permalink:"/pages/87d312/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/02.H2.html",relativePath:"03.å³ç³»åæ°æ®åº/99.å¶ä»/02.H2.md",key:"v-2b51d042",path:"/pages/87d312/",headers:[{level:2,title:"æ¦è¿°",slug:"æ¦è¿°",normalizedTitle:"æ¦è¿°",charIndex:14},{level:2,title:"ä½¿ç¨è¯´æ",slug:"ä½¿ç¨è¯´æ",normalizedTitle:"ä½¿ç¨è¯´æ",charIndex:145},{level:3,title:"H2 æ§å¶å°åºç¨",slug:"h2-æ§å¶å°åºç¨",normalizedTitle:"h2 æ§å¶å°åºç¨",charIndex:154},{level:3,title:"åµå¥å¼åºç¨",slug:"åµå¥å¼åºç¨",normalizedTitle:"åµå¥å¼åºç¨",charIndex:389},{level:4,title:"JDBC API",slug:"jdbc-api",normalizedTitle:"jdbc api",charIndex:398},{level:4,title:"è¿æ¥æ± ",slug:"è¿æ¥æ± ",normalizedTitle:"è¿æ¥æ± ",charIndex:521},{level:4,title:"Maven",slug:"maven",normalizedTitle:"maven",charIndex:740},{level:4,title:"Hibernate",slug:"hibernate",normalizedTitle:"hibernate",charIndex:893},{level:4,title:"TopLink å Glassfish",slug:"toplink-å-glassfish",normalizedTitle:"toplink å glassfish",charIndex:1043},{level:3,title:"è¿è¡æ¹å¼",slug:"è¿è¡æ¹å¼",normalizedTitle:"è¿è¡æ¹å¼",charIndex:1197},{level:4,title:"åµå¥å¼",slug:"åµå¥å¼",normalizedTitle:"åµå¥å¼",charIndex:27},{level:4,title:"åå­å¼",slug:"åå­å¼",normalizedTitle:"åå­å¼",charIndex:1393},{level:4,title:"æå¡æ¨¡å¼",slug:"æå¡æ¨¡å¼",normalizedTitle:"æå¡æ¨¡å¼",charIndex:1573},{level:4,title:"å¯å¨æå¡",slug:"å¯å¨æå¡",normalizedTitle:"å¯å¨æå¡",charIndex:1806},{level:4,title:"è®¾ç½®",slug:"è®¾ç½®",normalizedTitle:"è®¾ç½®",charIndex:2075},{level:4,title:"è¿æ¥å­ç¬¦ä¸²åæ°",slug:"è¿æ¥å­ç¬¦ä¸²åæ°",normalizedTitle:"è¿æ¥å­ç¬¦ä¸²åæ°",charIndex:2172},{level:4,title:"maven æ¹å¼",slug:"maven-æ¹å¼",normalizedTitle:"maven æ¹å¼",charIndex:2569},{level:2,title:"Spring æ´å H2",slug:"spring-æ´å-h2",normalizedTitle:"spring æ´å h2",charIndex:3256},{level:2,title:"H2 SQL",slug:"h2-sql",normalizedTitle:"h2 sql",charIndex:4911},{level:3,title:"SELECT",slug:"select",normalizedTitle:"select",charIndex:4922},{level:3,title:"INSERT",slug:"insert",normalizedTitle:"insert",charIndex:4935},{level:3,title:"UPDATE",slug:"update",normalizedTitle:"update",charIndex:4948},{level:3,title:"DELETE",slug:"delete",normalizedTitle:"delete",charIndex:4961},{level:3,title:"BACKUP",slug:"backup",normalizedTitle:"backup",charIndex:4974},{level:3,title:"EXPLAIN",slug:"explain",normalizedTitle:"explain",charIndex:4987},{level:3,title:"RUNSCRIPT",slug:"runscript",normalizedTitle:"runscript",charIndex:5010},{level:3,title:"SCRIPT",slug:"script",normalizedTitle:"script",charIndex:5013},{level:3,title:"SHOW",slug:"show",normalizedTitle:"show",charIndex:5068},{level:3,title:"ALTER",slug:"alter",normalizedTitle:"alter",charIndex:5079},{level:4,title:"ALTER INDEX RENAME",slug:"alter-index-rename",normalizedTitle:"alter index rename",charIndex:5088},{level:4,title:"ALTER SCHEMA RENAME",slug:"alter-schema-rename",normalizedTitle:"alter schema rename",charIndex:5112},{level:4,title:"ALTER SEQUENCE",slug:"alter-sequence",normalizedTitle:"alter sequence",charIndex:5137},{level:4,title:"ALTER TABLE",slug:"alter-table",normalizedTitle:"alter table",charIndex:5157},{level:5,title:"å¢å çº¦æ",slug:"å¢å çº¦æ",normalizedTitle:"å¢å çº¦æ",charIndex:5174},{level:5,title:"ä¿®æ¹å",slug:"ä¿®æ¹å",normalizedTitle:"ä¿®æ¹å",charIndex:5184},{level:5,title:"å é¤å",slug:"å é¤å",normalizedTitle:"å é¤å",charIndex:5193},{level:5,title:"å é¤åºå",slug:"å é¤åºå",normalizedTitle:"å é¤åºå",charIndex:5202},{level:4,title:"ALTER USER",slug:"alter-user",normalizedTitle:"alter user",charIndex:5212},{level:5,title:"ä¿®æ¹ç¨æ·å",slug:"ä¿®æ¹ç¨æ·å",normalizedTitle:"ä¿®æ¹ç¨æ·å",charIndex:5226},{level:5,title:"ä¿®æ¹ç¨æ·å¯ç ",slug:"ä¿®æ¹ç¨æ·å¯ç ",normalizedTitle:"ä¿®æ¹ç¨æ·å¯ç ",charIndex:5237},{level:4,title:"ALTER VIEW",slug:"alter-view",normalizedTitle:"alter view",charIndex:5249},{level:3,title:"COMMENT",slug:"comment",normalizedTitle:"comment",charIndex:5266},{level:3,title:"CREATE CONSTANT",slug:"create-constant",normalizedTitle:"create constant",charIndex:5280},{level:3,title:"CREATE INDEX",slug:"create-index",normalizedTitle:"create index",charIndex:5302},{level:3,title:"CREATE ROLE",slug:"create-role",normalizedTitle:"create role",charIndex:5321},{level:3,title:"CREATE SCHEMA",slug:"create-schema",normalizedTitle:"create schema",charIndex:5339},{level:3,title:"CREATE SEQUENCE",slug:"create-sequence",normalizedTitle:"create sequence",charIndex:5359},{level:3,title:"CREATE TABLE",slug:"create-table",normalizedTitle:"create table",charIndex:5381},{level:3,title:"CREATE TRIGGER",slug:"create-trigger",normalizedTitle:"create trigger",charIndex:5400},{level:3,title:"CREATE USER",slug:"create-user",normalizedTitle:"create user",charIndex:5421},{level:3,title:"CREATE VIEW",slug:"create-view",normalizedTitle:"create view",charIndex:5439},{level:3,title:"DROP",slug:"drop",normalizedTitle:"drop",charIndex:5457},{level:3,title:"GRANT RIGHT",slug:"grant-right",normalizedTitle:"grant right",charIndex:5468},{level:4,title:"å¤å¶è§è²çæé",slug:"å¤å¶è§è²çæé",normalizedTitle:"å¤å¶è§è²çæé",charIndex:5526},{level:3,title:"REVOKE RIGHT",slug:"revoke-right",normalizedTitle:"revoke right",charIndex:5540},{level:4,title:"ç§»é¤ææ",slug:"ç§»é¤ææ",normalizedTitle:"ç§»é¤ææ",charIndex:5556},{level:4,title:"ç§»é¤è§è²å·æçæé",slug:"ç§»é¤è§è²å·æçæé",normalizedTitle:"ç§»é¤è§è²å·æçæé",charIndex:5566},{level:3,title:"ROLLBACK",slug:"rollback",normalizedTitle:"rollback",charIndex:5582},{level:4,title:"ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»",slug:"ä»æä¸ªè¿åç¹-savepoint-åæ»",normalizedTitle:"ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»",charIndex:5594},{level:4,title:"åæ»äºå¡",slug:"åæ»äºå¡",normalizedTitle:"åæ»äºå¡",charIndex:5619},{level:4,title:"åå»º savepoint",slug:"åå»º-savepoint",normalizedTitle:"åå»º savepoint",charIndex:5629},{level:2,title:"æ°æ®ç±»å",slug:"æ°æ®ç±»å",normalizedTitle:"æ°æ®ç±»å",charIndex:5648},{level:3,title:"INT Type",slug:"int-type",normalizedTitle:"int type",charIndex:5659},{level:2,title:"éç¾¤",slug:"éç¾¤",normalizedTitle:"éç¾¤",charIndex:5674},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6274},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:6337}],headersStr:"æ¦è¿° ä½¿ç¨è¯´æ H2 æ§å¶å°åºç¨ åµå¥å¼åºç¨ JDBC API è¿æ¥æ±  Maven Hibernate TopLink å Glassfish è¿è¡æ¹å¼ åµå¥å¼ åå­å¼ æå¡æ¨¡å¼ å¯å¨æå¡ è®¾ç½® è¿æ¥å­ç¬¦ä¸²åæ° maven æ¹å¼ Spring æ´å H2 H2 SQL SELECT INSERT UPDATE DELETE BACKUP EXPLAIN RUNSCRIPT SCRIPT SHOW ALTER ALTER INDEX RENAME ALTER SCHEMA RENAME ALTER SEQUENCE ALTER TABLE å¢å çº¦æ ä¿®æ¹å å é¤å å é¤åºå ALTER USER ä¿®æ¹ç¨æ·å ä¿®æ¹ç¨æ·å¯ç  ALTER VIEW COMMENT CREATE CONSTANT CREATE INDEX CREATE ROLE CREATE SCHEMA CREATE SEQUENCE CREATE TABLE CREATE TRIGGER CREATE USER CREATE VIEW DROP GRANT RIGHT å¤å¶è§è²çæé REVOKE RIGHT ç§»é¤ææ ç§»é¤è§è²å·æçæé ROLLBACK ä»æä¸ªè¿åç¹ï¼savepointï¼åæ» åæ»äºå¡ åå»º savepoint æ°æ®ç±»å INT Type éç¾¤ åèèµæ ðª ä¼ éé¨",content:'# H2 åºç¨æå\n\n\n# æ¦è¿°\n\nH2 æ¯ä¸ä¸ªå¼æºçåµå¥å¼æ°æ®åºå¼æï¼éç¨ java è¯­è¨ç¼åï¼ä¸åå¹³å°çéå¶ãåæ¶ H2 æä¾äºä¸ä¸ªååæ¹ä¾¿ç web æ§å¶å°ç¨äºæä½åç®¡çæ°æ®åºåå®¹ãH2 è¿æä¾å¼å®¹æ¨¡å¼ï¼å¯ä»¥å¼å®¹ä¸äºä¸»æµçæ°æ®åºï¼å æ­¤éç¨ H2 ä½ä¸ºå¼åæçæ°æ®åºéå¸¸æ¹ä¾¿ã\n\n\n# ä½¿ç¨è¯´æ\n\n\n# H2 æ§å¶å°åºç¨\n\nH2 åè®¸ç¨æ·éè¿æµè§å¨æ¥å£æ¹å¼è®¿é® SQL æ°æ®åºã\n\n 1. è¿å¥å®æ¹ä¸è½½å°åï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶å®è£å°æ¬å°ã\n 2. å¯å¨æ¹å¼ï¼å¨ bin ç®å½ä¸ï¼åå» jar åï¼æ§è¡ java -jar h2*.jarï¼æ§è¡èæ¬ï¼h2.bat æ h2.shã\n 3. å¨æµè§å¨ä¸­è®¿é®ï¼http://localhost:8082ï¼åºè¯¥å¯ä»¥çå°ä¸å¾ä¸­çé¡µé¢ï¼\n\n\n\nç¹å» Connect ï¼å¯ä»¥è¿å¥æä½çé¢ï¼\n\n\n\næä½çé¢ååç®åï¼ä¸ä¸ä¸ç»è¯´ã\n\n\n# åµå¥å¼åºç¨\n\n# JDBC API\n\nConnection conn = DriverManager.\n    getConnection("jdbc:h2:~/test");\nconn.close();\n\n\n> è¯¦è§ï¼Using the JDBC API\n\n# è¿æ¥æ± \n\nimport org.h2.jdbcx.JdbcConnectionPool;\nJdbcConnectionPool cp = JdbcConnectionPool.\ncreate("jdbc:h2:~/test", "sa", "sa");\nConnection conn = cp.getConnection();\nconn.close(); cp.dispose();\n\n\n> è¯¦è§ï¼Connection Pool\n\n# Maven\n\n<dependency>\n    <groupId>com.h2database</groupId>\n    <artifactId>h2</artifactId>\n    <version>1.4.197</version>\n</dependency>\n\n\n> è¯¦è§ï¼Maven 2\n\n# Hibernate\n\nhibernate.cfg.xml (or use the HSQLDialect):\n\n<property name="dialect">\n    org.hibernate.dialect.H2Dialect\n</property>\n\n\n> è¯¦è§ï¼Hibernate\n\n# TopLink å Glassfish\n\nDatasource class: org.h2.jdbcx.JdbcDataSource oracle.toplink.essentials.platform.database.H2Platform\n\n> è¯¦è§ï¼TopLink and Glassfish\n\n\n# è¿è¡æ¹å¼\n\n# åµå¥å¼\n\næ°æ®åºæä¹åå­å¨ä¸ºåä¸ªæä»¶ã\n\nè¿æ¥å­ç¬¦ä¸²ï¼\\~/.h2/DBName è¡¨ç¤ºæ°æ®åºæä»¶çå­å¨ä½ç½®ï¼å¦æç¬¬ä¸æ¬¡è¿æ¥åä¼èªå¨åå»ºæ°æ®åºã\n\n * jdbc:h2:\\~/test - \'test\' å¨ç¨æ·æ ¹ç®å½ä¸\n * jdbc:h2:/data/test - \'test\' å¨ /data ç®å½ä¸\n * jdbc:h2:test - \'test\' å¨å½åå·¥ä½ç®å½\n\n# åå­å¼\n\næ°æ®åºåªå¨åå­ä¸­è¿è¡ï¼å³é­è¿æ¥åæ°æ®åºå°è¢«æ¸ç©ºï¼éåæµè¯ç¯å¢\n\nè¿æ¥å­ç¬¦ä¸²ï¼jdbc:h2:mem:DBName;DB_CLOSE_DELAY=-1\n\nå¦æä¸æå® DBNameï¼åä»¥ç§ææ¹å¼å¯å¨ï¼åªåè®¸ä¸ä¸ªè¿æ¥ã\n\n * jdbc:h2:mem:test - ä¸ä¸ªè¿ç¨ä¸­æå¤ä¸ªè¿æ¥\n * jdbc:h2:mem: - æªå½åçç§æåºï¼ä¸ä¸ªè¿æ¥\n\n# æå¡æ¨¡å¼\n\nH2 æ¯æä¸ç§æå¡æ¨¡å¼ï¼\n\n * web serverï¼æ­¤ç§è¿è¡æ¹å¼æ¯æä½¿ç¨æµè§å¨è®¿é® H2 Console\n * TCP serverï¼æ¯æå®¢æ·ç«¯/æå¡å¨ç«¯çè¿æ¥æ¹å¼\n * PG serverï¼æ¯æ PostgreSQL å®¢æ·ç«¯\n\nå¯å¨ tcp æå¡è¿æ¥å­ç¬¦ä¸²ç¤ºä¾ï¼\n\n * jdbc:h2:tcp://localhost/\\~/test - ç¨æ·æ ¹ç®å½\n * jdbc:h2:tcp://localhost//data/test - ç»å¯¹è·¯å¾\n\n# å¯å¨æå¡\n\næ§è¡ java -cp *.jar org.h2.tools.Server\n\næ§è¡å¦ä¸å½ä»¤ï¼è·åéé¡¹åè¡¨åé»è®¤å¼\n\njava -cp h2*.jar org.h2.tools.Server -?\n\n\nå¸¸è§çéé¡¹å¦ä¸ï¼\n\n * -webï¼å¯å¨æ¯æ H2 Console çæå¡\n * -webPort <port>ï¼æå¡å¯å¨ç«¯å£ï¼é»è®¤ä¸º 8082\n * -browserï¼å¯å¨ H2 Console web ç®¡çé¡µé¢\n * -tcpï¼ä½¿ç¨ TCP server æ¨¡å¼å¯å¨\n * -pgï¼ä½¿ç¨ PG server æ¨¡å¼å¯å¨\n\n# è®¾ç½®\n\n * jdbc:h2:..;MODE=MySQL å¼å®¹æ¨¡å¼ï¼æ HSQLDB ç­ï¼\n * jdbc:h2:..;TRACE_LEVEL_FILE=3 è®°å½å° *.trace.db\n\n# è¿æ¥å­ç¬¦ä¸²åæ°\n\n * DB_CLOSE_DELAY - è¦æ±æåä¸ä¸ªæ­£å¨è¿æ¥çè¿æ¥æ­å¼åï¼ä¸è¦å³é­æ°æ®åº\n * MODE=MySQL - å¼å®¹æ¨¡å¼ï¼H2 å¼å®¹å¤ç§æ°æ®åºï¼è¯¥å¼å¯ä»¥ä¸ºï¼DB2ãDerbyãHSQLDBãMSSQLServerãMySQLãOracleãPostgreSQL\n * AUTO_RECONNECT=TRUE - è¿æ¥ä¸¢å¤±åèªå¨éæ°è¿æ¥\n * AUTO_SERVER=TRUE - å¯å¨èªå¨æ··åæ¨¡å¼ï¼åè®¸å¼å¯å¤ä¸ªè¿æ¥ï¼è¯¥åæ°ä¸æ¯æå¨åå­ä¸­è¿è¡æ¨¡å¼\n * TRACE_LEVEL_SYSTEM_OUTãTRACE_LEVEL_FILE - è¾åºè·è¸ªæ¥å¿å°æ§å¶å°ææä»¶ï¼ åå¼ 0 ä¸º OFFï¼1 ä¸º ERRORï¼é»è®¤å¼ï¼ï¼2 ä¸º INFOï¼3 ä¸º DEBUG\n * SET TRACE_MAX_FILE_SIZE mb - è®¾ç½®è·è¸ªæ¥å¿æä»¶çå¤§å°ï¼é»è®¤ä¸º 16M\n\n# maven æ¹å¼\n\næ­¤å¤ï¼ä½¿ç¨ maven ä¹å¯ä»¥å¯å¨ H2 æå¡ãæ·»å ä»¥ä¸æä»¶\n\n<plugin>\n  <groupId>org.codehaus.mojo</groupId>\n  <artifactId>exec-maven-plugin</artifactId>\n  <executions>\n    <execution>\n      <goals>\n        <goal>java</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    <mainClass>org.h2.tools.Server</mainClass>\n    <arguments>\n      <argument>-web</argument>\n      <argument>-webPort</argument>\n      <argument>8090</argument>\n      <argument>-browser</argument>\n    </arguments>\n  </configuration>\n</plugin>\n\n\nå¨å½ä»¤è¡ä¸­æ§è¡å¦ä¸å½ä»¤å¯å¨ H2 Console\n\nmvn exec:java\n\n\næèå»ºç«ä¸ä¸ª bat æä»¶\n\n@echo off\ncall mvn exec:java\npause\n\n\næ­¤æä½ç¸å½äºæ§è¡äºå¦ä¸å½ä»¤ï¼\n\njava -jar h2-1.3.168.jar -web -webPort 8090 -browser\n\n\n\n# Spring æ´å H2\n\nï¼1ï¼æ·»å ä¾èµ\n\n<dependency>\n  <groupId>com.h2database</groupId>\n  <artifactId>h2</artifactId>\n  <version>1.4.194</version>\n</dependency>\n\n\nï¼2ï¼spring éç½®\n\n<?xml version="1.0" encoding="UTF-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n       xmlns:jdbc="http://www.springframework.org/schema/jdbc"\n       xsi:schemaLocation="http://www.springframework.org/schema/beans\n            http://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n            http://www.springframework.org/schema/jdbc\n            http://www.springframework.org/schema/jdbc/spring-jdbc.xsd">\n\n  \x3c!--éç½®æ°æ®æº--\x3e\n  <bean id="dataSource" class="org.h2.jdbcx.JdbcConnectionPool"\n        destroy-method="dispose">\n    <constructor-arg>\n      <bean class="org.h2.jdbcx.JdbcDataSource">\n        \x3c!-- åå­æ¨¡å¼ --\x3e\n        <property name="URL" value="jdbc:h2:mem:test"/>\n        \x3c!-- æä»¶æ¨¡å¼ --\x3e\n        \x3c!-- <property name="URL" value="jdbc:h2:testRestDB" /> --\x3e\n        <property name="user" value="root"/>\n        <property name="password" value="root"/>\n      </bean>\n    </constructor-arg>\n  </bean>\n\n  \x3c!-- JDBCæ¨¡æ¿ --\x3e\n  <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">\n    <constructor-arg ref="dataSource"/>\n  </bean>\n  <bean id="myJdbcTemplate" class="org.zp.notes.spring.jdbc.MyJdbcTemplate">\n    <property name="jdbcTemplate" ref="jdbcTemplate"/>\n  </bean>\n\n  \x3c!-- åå§åæ°æ®è¡¨ç»æ --\x3e\n  <jdbc:initialize-database data-source="dataSource" ignore-failures="ALL">\n    <jdbc:script location="classpath:sql/h2/create_table_student.sql"/>\n  </jdbc:initialize-database>\n</beans>\n\n\n\n# H2 SQL\n\n\n# SELECT\n\n\n\n\n# INSERT\n\n\n\n\n# UPDATE\n\n\n\n\n# DELETE\n\n\n\n\n# BACKUP\n\n\n\n\n# EXPLAIN\n\n\n\n7ãMERGE\n\n\n# RUNSCRIPT\n\nè¿è¡ sql èæ¬æä»¶\n\n\n\n\n# SCRIPT\n\næ ¹æ®æ°æ®åºåå»º sql èæ¬\n\n\n\n\n# SHOW\n\n\n\n\n# ALTER\n\n# ALTER INDEX RENAME\n\n\n\n# ALTER SCHEMA RENAME\n\n\n\n# ALTER SEQUENCE\n\n\n\n# ALTER TABLE\n\n\n\n# å¢å çº¦æ\n\n\n\n# ä¿®æ¹å\n\n\n\n# å é¤å\n\n\n\n# å é¤åºå\n\n\n\n# ALTER USER\n\n# ä¿®æ¹ç¨æ·å\n\n\n\n# ä¿®æ¹ç¨æ·å¯ç \n\n\n\n# ALTER VIEW\n\n\n\n\n# COMMENT\n\n\n\n\n# CREATE CONSTANT\n\n\n\n\n# CREATE INDEX\n\n\n\n\n# CREATE ROLE\n\n\n\n\n# CREATE SCHEMA\n\n\n\n\n# CREATE SEQUENCE\n\n\n\n\n# CREATE TABLE\n\n\n\n\n# CREATE TRIGGER\n\n\n\n\n# CREATE USER\n\n\n\n\n# CREATE VIEW\n\n\n\n\n# DROP\n\n\n\n\n# GRANT RIGHT\n\nç» schema ææææ\n\n\n\nç» schema ææç» schema ææ\n\n\n\n# å¤å¶è§è²çæé\n\n\n\n\n# REVOKE RIGHT\n\n# ç§»é¤ææ\n\n\n\n# ç§»é¤è§è²å·æçæé\n\n\n\n\n# ROLLBACK\n\n# ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»\n\n\n\n# åæ»äºå¡\n\n\n\n# åå»º savepoint\n\n\n\n\n# æ°æ®ç±»å\n\n\n\n\n# INT Type\n\n\n\n\n# éç¾¤\n\nH2 æ¯æä¸¤å°æå¡å¨è¿è¡ä¸¤ä¸ªæ°æ®åºæä¸ºéç¾¤ï¼ä¸¤ä¸ªæ°æ®åºäºä¸ºå¤ä»½ï¼å¦æä¸ä¸ªæå¡å¨å¤±æï¼å¦ä¸ä¸ªæå¡å¨ä»ç¶å¯ä»¥å·¥ä½ãå¦å¤åªææå¡æ¨¡å¼æ¯æéç¾¤éç½®ã\n\nH2 å¯ä»¥éè¿ CreateCluster å·¥å·åå»ºéç¾¤ï¼ç¤ºä¾æ­¥éª¤å¦ä¸ï¼å¨å¨ä¸å°æå¡å¨ä¸æ¨¡æä¸¤ä¸ªæ°æ®åºç»æéç¾¤ï¼ï¼\n\n * åå»ºç®å½\n   * åå»ºä¸¤ä¸ªæå¡å¨å·¥ä½çç®å½\n * å¯å¨ tcp æå¡\n   * æ§è¡å¦ä¸å½ä»¤åå«å¨ 9101ã9102 ç«¯å£å¯å¨ä¸¤ä¸ªä½¿ç¨ tcp æå¡æ¨¡å¼çæ°æ®åº\n * ä½¿ç¨ CreateCluster å·¥å·åå»ºéç¾¤\n   * å¦æä¸¤ä¸ªæ°æ®åºä¸å­å¨ï¼è¯¥å½ä»¤å°ä¼èªå¨åå»ºæ°æ®åºãå¦æä¸ä¸ªæ°æ®åºå¤±æï¼å¯ä»¥åå é¤åçæ°æ®åºæä»¶ï¼éæ°å¯å¨æ°æ®åºï¼ç¶åéæ°è¿è¡ CreateCluster å·¥å·\n * è¿æ¥æ°æ®åºç°å¨å¯ä»¥ä½¿ç¨å¦ä¸è¿æ¥å­ç¬¦ä¸²è¿æ¥éç¾¤æ°æ®åº\n   * çæ§éç¾¤è¿è¡ç¶æ\n   * å¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤æ¥çéç½®çéç¾¤æå¡å¨æ¯å¦é½å¨è¿è¡\n * éå¶\n   * H2 çéç¾¤å¹¶ä¸æ¯æéå¯¹äºå¡çè´è½½åè¡¡ï¼æä»¥å¾å¤æä½ä¼ä½¿ä¸¤ä¸ªæ°æ®åºäº§çä¸ä¸è´çç»æ\n * æ§è¡å¦ä¸æä½æ¶è¯·å°å¿ï¼\n   * èªå¨å¢é¿ååæ è¯åä¸æ¯æéç¾¤ï¼å½æå¥æ°æ®æ¶ï¼åºåå¼éè¦æå¨åå»ºä¸æ¯æ SET AUTOCOMMIT FALSE è¯­å¥ï¼\n   * å¦æéè¦è®¾ç½®æä¸ºä¸èªå¨æäº¤ï¼å¯ä»¥æ§è¡æ¹æ³ Connection.setAutoCommit(false)\n\n\n# åèèµæ\n\n * h2database å®ç½\n * Java åµå¥å¼æ°æ®åº H2 å­¦ä¹ æ»ç»(ä¸)ââH2 æ°æ®åºå¥é¨\n\n\n# ðª ä¼ éé¨\n\n| æç Github åå®¢ | db-tutorial é¦é¡µ |',normalizedContent:'# h2 åºç¨æå\n\n\n# æ¦è¿°\n\nh2 æ¯ä¸ä¸ªå¼æºçåµå¥å¼æ°æ®åºå¼æï¼éç¨ java è¯­è¨ç¼åï¼ä¸åå¹³å°çéå¶ãåæ¶ h2 æä¾äºä¸ä¸ªååæ¹ä¾¿ç web æ§å¶å°ç¨äºæä½åç®¡çæ°æ®åºåå®¹ãh2 è¿æä¾å¼å®¹æ¨¡å¼ï¼å¯ä»¥å¼å®¹ä¸äºä¸»æµçæ°æ®åºï¼å æ­¤éç¨ h2 ä½ä¸ºå¼åæçæ°æ®åºéå¸¸æ¹ä¾¿ã\n\n\n# ä½¿ç¨è¯´æ\n\n\n# h2 æ§å¶å°åºç¨\n\nh2 åè®¸ç¨æ·éè¿æµè§å¨æ¥å£æ¹å¼è®¿é® sql æ°æ®åºã\n\n 1. è¿å¥å®æ¹ä¸è½½å°åï¼éæ©åéçæ¬ï¼ä¸è½½å¹¶å®è£å°æ¬å°ã\n 2. å¯å¨æ¹å¼ï¼å¨ bin ç®å½ä¸ï¼åå» jar åï¼æ§è¡ java -jar h2*.jarï¼æ§è¡èæ¬ï¼h2.bat æ h2.shã\n 3. å¨æµè§å¨ä¸­è®¿é®ï¼http://localhost:8082ï¼åºè¯¥å¯ä»¥çå°ä¸å¾ä¸­çé¡µé¢ï¼\n\n\n\nç¹å» connect ï¼å¯ä»¥è¿å¥æä½çé¢ï¼\n\n\n\næä½çé¢ååç®åï¼ä¸ä¸ä¸ç»è¯´ã\n\n\n# åµå¥å¼åºç¨\n\n# jdbc api\n\nconnection conn = drivermanager.\n    getconnection("jdbc:h2:~/test");\nconn.close();\n\n\n> è¯¦è§ï¼using the jdbc api\n\n# è¿æ¥æ± \n\nimport org.h2.jdbcx.jdbcconnectionpool;\njdbcconnectionpool cp = jdbcconnectionpool.\ncreate("jdbc:h2:~/test", "sa", "sa");\nconnection conn = cp.getconnection();\nconn.close(); cp.dispose();\n\n\n> è¯¦è§ï¼connection pool\n\n# maven\n\n<dependency>\n    <groupid>com.h2database</groupid>\n    <artifactid>h2</artifactid>\n    <version>1.4.197</version>\n</dependency>\n\n\n> è¯¦è§ï¼maven 2\n\n# hibernate\n\nhibernate.cfg.xml (or use the hsqldialect):\n\n<property name="dialect">\n    org.hibernate.dialect.h2dialect\n</property>\n\n\n> è¯¦è§ï¼hibernate\n\n# toplink å glassfish\n\ndatasource class: org.h2.jdbcx.jdbcdatasource oracle.toplink.essentials.platform.database.h2platform\n\n> è¯¦è§ï¼toplink and glassfish\n\n\n# è¿è¡æ¹å¼\n\n# åµå¥å¼\n\næ°æ®åºæä¹åå­å¨ä¸ºåä¸ªæä»¶ã\n\nè¿æ¥å­ç¬¦ä¸²ï¼\\~/.h2/dbname è¡¨ç¤ºæ°æ®åºæä»¶çå­å¨ä½ç½®ï¼å¦æç¬¬ä¸æ¬¡è¿æ¥åä¼èªå¨åå»ºæ°æ®åºã\n\n * jdbc:h2:\\~/test - \'test\' å¨ç¨æ·æ ¹ç®å½ä¸\n * jdbc:h2:/data/test - \'test\' å¨ /data ç®å½ä¸\n * jdbc:h2:test - \'test\' å¨å½åå·¥ä½ç®å½\n\n# åå­å¼\n\næ°æ®åºåªå¨åå­ä¸­è¿è¡ï¼å³é­è¿æ¥åæ°æ®åºå°è¢«æ¸ç©ºï¼éåæµè¯ç¯å¢\n\nè¿æ¥å­ç¬¦ä¸²ï¼jdbc:h2:mem:dbname;db_close_delay=-1\n\nå¦æä¸æå® dbnameï¼åä»¥ç§ææ¹å¼å¯å¨ï¼åªåè®¸ä¸ä¸ªè¿æ¥ã\n\n * jdbc:h2:mem:test - ä¸ä¸ªè¿ç¨ä¸­æå¤ä¸ªè¿æ¥\n * jdbc:h2:mem: - æªå½åçç§æåºï¼ä¸ä¸ªè¿æ¥\n\n# æå¡æ¨¡å¼\n\nh2 æ¯æä¸ç§æå¡æ¨¡å¼ï¼\n\n * web serverï¼æ­¤ç§è¿è¡æ¹å¼æ¯æä½¿ç¨æµè§å¨è®¿é® h2 console\n * tcp serverï¼æ¯æå®¢æ·ç«¯/æå¡å¨ç«¯çè¿æ¥æ¹å¼\n * pg serverï¼æ¯æ postgresql å®¢æ·ç«¯\n\nå¯å¨ tcp æå¡è¿æ¥å­ç¬¦ä¸²ç¤ºä¾ï¼\n\n * jdbc:h2:tcp://localhost/\\~/test - ç¨æ·æ ¹ç®å½\n * jdbc:h2:tcp://localhost//data/test - ç»å¯¹è·¯å¾\n\n# å¯å¨æå¡\n\næ§è¡ java -cp *.jar org.h2.tools.server\n\næ§è¡å¦ä¸å½ä»¤ï¼è·åéé¡¹åè¡¨åé»è®¤å¼\n\njava -cp h2*.jar org.h2.tools.server -?\n\n\nå¸¸è§çéé¡¹å¦ä¸ï¼\n\n * -webï¼å¯å¨æ¯æ h2 console çæå¡\n * -webport <port>ï¼æå¡å¯å¨ç«¯å£ï¼é»è®¤ä¸º 8082\n * -browserï¼å¯å¨ h2 console web ç®¡çé¡µé¢\n * -tcpï¼ä½¿ç¨ tcp server æ¨¡å¼å¯å¨\n * -pgï¼ä½¿ç¨ pg server æ¨¡å¼å¯å¨\n\n# è®¾ç½®\n\n * jdbc:h2:..;mode=mysql å¼å®¹æ¨¡å¼ï¼æ hsqldb ç­ï¼\n * jdbc:h2:..;trace_level_file=3 è®°å½å° *.trace.db\n\n# è¿æ¥å­ç¬¦ä¸²åæ°\n\n * db_close_delay - è¦æ±æåä¸ä¸ªæ­£å¨è¿æ¥çè¿æ¥æ­å¼åï¼ä¸è¦å³é­æ°æ®åº\n * mode=mysql - å¼å®¹æ¨¡å¼ï¼h2 å¼å®¹å¤ç§æ°æ®åºï¼è¯¥å¼å¯ä»¥ä¸ºï¼db2ãderbyãhsqldbãmssqlserverãmysqlãoracleãpostgresql\n * auto_reconnect=true - è¿æ¥ä¸¢å¤±åèªå¨éæ°è¿æ¥\n * auto_server=true - å¯å¨èªå¨æ··åæ¨¡å¼ï¼åè®¸å¼å¯å¤ä¸ªè¿æ¥ï¼è¯¥åæ°ä¸æ¯æå¨åå­ä¸­è¿è¡æ¨¡å¼\n * trace_level_system_outãtrace_level_file - è¾åºè·è¸ªæ¥å¿å°æ§å¶å°ææä»¶ï¼ åå¼ 0 ä¸º offï¼1 ä¸º errorï¼é»è®¤å¼ï¼ï¼2 ä¸º infoï¼3 ä¸º debug\n * set trace_max_file_size mb - è®¾ç½®è·è¸ªæ¥å¿æä»¶çå¤§å°ï¼é»è®¤ä¸º 16m\n\n# maven æ¹å¼\n\næ­¤å¤ï¼ä½¿ç¨ maven ä¹å¯ä»¥å¯å¨ h2 æå¡ãæ·»å ä»¥ä¸æä»¶\n\n<plugin>\n  <groupid>org.codehaus.mojo</groupid>\n  <artifactid>exec-maven-plugin</artifactid>\n  <executions>\n    <execution>\n      <goals>\n        <goal>java</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    <mainclass>org.h2.tools.server</mainclass>\n    <arguments>\n      <argument>-web</argument>\n      <argument>-webport</argument>\n      <argument>8090</argument>\n      <argument>-browser</argument>\n    </arguments>\n  </configuration>\n</plugin>\n\n\nå¨å½ä»¤è¡ä¸­æ§è¡å¦ä¸å½ä»¤å¯å¨ h2 console\n\nmvn exec:java\n\n\næèå»ºç«ä¸ä¸ª bat æä»¶\n\n@echo off\ncall mvn exec:java\npause\n\n\næ­¤æä½ç¸å½äºæ§è¡äºå¦ä¸å½ä»¤ï¼\n\njava -jar h2-1.3.168.jar -web -webport 8090 -browser\n\n\n\n# spring æ´å h2\n\nï¼1ï¼æ·»å ä¾èµ\n\n<dependency>\n  <groupid>com.h2database</groupid>\n  <artifactid>h2</artifactid>\n  <version>1.4.194</version>\n</dependency>\n\n\nï¼2ï¼spring éç½®\n\n<?xml version="1.0" encoding="utf-8"?>\n<beans xmlns="http://www.springframework.org/schema/beans"\n       xmlns:xsi="http://www.w3.org/2001/xmlschema-instance"\n       xmlns:jdbc="http://www.springframework.org/schema/jdbc"\n       xsi:schemalocation="http://www.springframework.org/schema/beans\n            http://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n            http://www.springframework.org/schema/jdbc\n            http://www.springframework.org/schema/jdbc/spring-jdbc.xsd">\n\n  \x3c!--éç½®æ°æ®æº--\x3e\n  <bean id="datasource" class="org.h2.jdbcx.jdbcconnectionpool"\n        destroy-method="dispose">\n    <constructor-arg>\n      <bean class="org.h2.jdbcx.jdbcdatasource">\n        \x3c!-- åå­æ¨¡å¼ --\x3e\n        <property name="url" value="jdbc:h2:mem:test"/>\n        \x3c!-- æä»¶æ¨¡å¼ --\x3e\n        \x3c!-- <property name="url" value="jdbc:h2:testrestdb" /> --\x3e\n        <property name="user" value="root"/>\n        <property name="password" value="root"/>\n      </bean>\n    </constructor-arg>\n  </bean>\n\n  \x3c!-- jdbcæ¨¡æ¿ --\x3e\n  <bean id="jdbctemplate" class="org.springframework.jdbc.core.jdbctemplate">\n    <constructor-arg ref="datasource"/>\n  </bean>\n  <bean id="myjdbctemplate" class="org.zp.notes.spring.jdbc.myjdbctemplate">\n    <property name="jdbctemplate" ref="jdbctemplate"/>\n  </bean>\n\n  \x3c!-- åå§åæ°æ®è¡¨ç»æ --\x3e\n  <jdbc:initialize-database data-source="datasource" ignore-failures="all">\n    <jdbc:script location="classpath:sql/h2/create_table_student.sql"/>\n  </jdbc:initialize-database>\n</beans>\n\n\n\n# h2 sql\n\n\n# select\n\n\n\n\n# insert\n\n\n\n\n# update\n\n\n\n\n# delete\n\n\n\n\n# backup\n\n\n\n\n# explain\n\n\n\n7ãmerge\n\n\n# runscript\n\nè¿è¡ sql èæ¬æä»¶\n\n\n\n\n# script\n\næ ¹æ®æ°æ®åºåå»º sql èæ¬\n\n\n\n\n# show\n\n\n\n\n# alter\n\n# alter index rename\n\n\n\n# alter schema rename\n\n\n\n# alter sequence\n\n\n\n# alter table\n\n\n\n# å¢å çº¦æ\n\n\n\n# ä¿®æ¹å\n\n\n\n# å é¤å\n\n\n\n# å é¤åºå\n\n\n\n# alter user\n\n# ä¿®æ¹ç¨æ·å\n\n\n\n# ä¿®æ¹ç¨æ·å¯ç \n\n\n\n# alter view\n\n\n\n\n# comment\n\n\n\n\n# create constant\n\n\n\n\n# create index\n\n\n\n\n# create role\n\n\n\n\n# create schema\n\n\n\n\n# create sequence\n\n\n\n\n# create table\n\n\n\n\n# create trigger\n\n\n\n\n# create user\n\n\n\n\n# create view\n\n\n\n\n# drop\n\n\n\n\n# grant right\n\nç» schema ææææ\n\n\n\nç» schema ææç» schema ææ\n\n\n\n# å¤å¶è§è²çæé\n\n\n\n\n# revoke right\n\n# ç§»é¤ææ\n\n\n\n# ç§»é¤è§è²å·æçæé\n\n\n\n\n# rollback\n\n# ä»æä¸ªè¿åç¹ï¼savepointï¼åæ»\n\n\n\n# åæ»äºå¡\n\n\n\n# åå»º savepoint\n\n\n\n\n# æ°æ®ç±»å\n\n\n\n\n# int type\n\n\n\n\n# éç¾¤\n\nh2 æ¯æä¸¤å°æå¡å¨è¿è¡ä¸¤ä¸ªæ°æ®åºæä¸ºéç¾¤ï¼ä¸¤ä¸ªæ°æ®åºäºä¸ºå¤ä»½ï¼å¦æä¸ä¸ªæå¡å¨å¤±æï¼å¦ä¸ä¸ªæå¡å¨ä»ç¶å¯ä»¥å·¥ä½ãå¦å¤åªææå¡æ¨¡å¼æ¯æéç¾¤éç½®ã\n\nh2 å¯ä»¥éè¿ createcluster å·¥å·åå»ºéç¾¤ï¼ç¤ºä¾æ­¥éª¤å¦ä¸ï¼å¨å¨ä¸å°æå¡å¨ä¸æ¨¡æä¸¤ä¸ªæ°æ®åºç»æéç¾¤ï¼ï¼\n\n * åå»ºç®å½\n   * åå»ºä¸¤ä¸ªæå¡å¨å·¥ä½çç®å½\n * å¯å¨ tcp æå¡\n   * æ§è¡å¦ä¸å½ä»¤åå«å¨ 9101ã9102 ç«¯å£å¯å¨ä¸¤ä¸ªä½¿ç¨ tcp æå¡æ¨¡å¼çæ°æ®åº\n * ä½¿ç¨ createcluster å·¥å·åå»ºéç¾¤\n   * å¦æä¸¤ä¸ªæ°æ®åºä¸å­å¨ï¼è¯¥å½ä»¤å°ä¼èªå¨åå»ºæ°æ®åºãå¦æä¸ä¸ªæ°æ®åºå¤±æï¼å¯ä»¥åå é¤åçæ°æ®åºæä»¶ï¼éæ°å¯å¨æ°æ®åºï¼ç¶åéæ°è¿è¡ createcluster å·¥å·\n * è¿æ¥æ°æ®åºç°å¨å¯ä»¥ä½¿ç¨å¦ä¸è¿æ¥å­ç¬¦ä¸²è¿æ¥éç¾¤æ°æ®åº\n   * çæ§éç¾¤è¿è¡ç¶æ\n   * å¯ä»¥ä½¿ç¨å¦ä¸å½ä»¤æ¥çéç½®çéç¾¤æå¡å¨æ¯å¦é½å¨è¿è¡\n * éå¶\n   * h2 çéç¾¤å¹¶ä¸æ¯æéå¯¹äºå¡çè´è½½åè¡¡ï¼æä»¥å¾å¤æä½ä¼ä½¿ä¸¤ä¸ªæ°æ®åºäº§çä¸ä¸è´çç»æ\n * æ§è¡å¦ä¸æä½æ¶è¯·å°å¿ï¼\n   * èªå¨å¢é¿ååæ è¯åä¸æ¯æéç¾¤ï¼å½æå¥æ°æ®æ¶ï¼åºåå¼éè¦æå¨åå»ºä¸æ¯æ set autocommit false è¯­å¥ï¼\n   * å¦æéè¦è®¾ç½®æä¸ºä¸èªå¨æäº¤ï¼å¯ä»¥æ§è¡æ¹æ³ connection.setautocommit(false)\n\n\n# åèèµæ\n\n * h2database å®ç½\n * java åµå¥å¼æ°æ®åº h2 å­¦ä¹ æ»ç»(ä¸)ââh2 æ°æ®åºå¥é¨\n\n\n# ðª ä¼ éé¨\n\n| æç github åå®¢ | db-tutorial é¦é¡µ |',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"sqlite",frontmatter:{title:"sqlite",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº","SQLite"],permalink:"/pages/d024ff/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/03.Sqlite.html",relativePath:"03.å³ç³»åæ°æ®åº/99.å¶ä»/03.Sqlite.md",key:"v-00d798bc",path:"/pages/d024ff/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:72},{level:3,title:"ä¼ç¹",slug:"ä¼ç¹",normalizedTitle:"ä¼ç¹",charIndex:79},{level:3,title:"å±é",slug:"å±é",normalizedTitle:"å±é",charIndex:456},{level:3,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:145},{level:2,title:"è¯­æ³",slug:"è¯­æ³",normalizedTitle:"è¯­æ³",charIndex:1046},{level:3,title:"å¤§å°åææ",slug:"å¤§å°åææ",normalizedTitle:"å¤§å°åææ",charIndex:1138},{level:3,title:"æ³¨é",slug:"æ³¨é",normalizedTitle:"æ³¨é",charIndex:1216},{level:3,title:"åå»ºæ°æ®åº",slug:"åå»ºæ°æ®åº",normalizedTitle:"åå»ºæ°æ®åº",charIndex:1254},{level:3,title:"æ¥çæ°æ®åº",slug:"æ¥çæ°æ®åº",normalizedTitle:"æ¥çæ°æ®åº",charIndex:1422},{level:3,title:"éåºæ°æ®åº",slug:"éåºæ°æ®åº",normalizedTitle:"éåºæ°æ®åº",charIndex:1597},{level:3,title:"éå æ°æ®åº",slug:"éå æ°æ®åº",normalizedTitle:"éå æ°æ®åº",charIndex:1623},{level:3,title:"åç¦»æ°æ®åº",slug:"åç¦»æ°æ®åº",normalizedTitle:"åç¦»æ°æ®åº",charIndex:2089},{level:3,title:"å¤ä»½æ°æ®åº",slug:"å¤ä»½æ°æ®åº",normalizedTitle:"å¤ä»½æ°æ®åº",charIndex:2570},{level:3,title:"æ¢å¤æ°æ®åº",slug:"æ¢å¤æ°æ®åº",normalizedTitle:"æ¢å¤æ°æ®åº",charIndex:2653},{level:2,title:"æ°æ®ç±»å",slug:"æ°æ®ç±»å",normalizedTitle:"æ°æ®ç±»å",charIndex:2726},{level:3,title:"SQLite å­å¨ç±»",slug:"sqlite-å­å¨ç±»",normalizedTitle:"sqlite å­å¨ç±»",charIndex:2796},{level:3,title:"SQLite äº²å(Affinity)ç±»å",slug:"sqlite-äº²å-affinity-ç±»å",normalizedTitle:"sqlite äº²å(affinity)ç±»å",charIndex:3122},{level:3,title:"SQLite äº²åç±»å(Affinity)åç±»ååç§°",slug:"sqlite-äº²åç±»å-affinity-åç±»ååç§°",normalizedTitle:"sqlite äº²åç±»å(affinity)åç±»ååç§°",charIndex:3806},{level:3,title:"Boolean æ°æ®ç±»å",slug:"boolean-æ°æ®ç±»å",normalizedTitle:"boolean æ°æ®ç±»å",charIndex:4379},{level:3,title:"Date ä¸ Time æ°æ®ç±»å",slug:"date-ä¸-time-æ°æ®ç±»å",normalizedTitle:"date ä¸ time æ°æ®ç±»å",charIndex:4454},{level:2,title:"SQLite å½ä»¤",slug:"sqlite-å½ä»¤",normalizedTitle:"sqlite å½ä»¤",charIndex:4750},{level:3,title:"å¿«éå¼å§",slug:"å¿«éå¼å§",normalizedTitle:"å¿«éå¼å§",charIndex:4764},{level:4,title:"è¿å¥ SQLite æ§å¶å°",slug:"è¿å¥-sqlite-æ§å¶å°",normalizedTitle:"è¿å¥ sqlite æ§å¶å°",charIndex:4772},{level:4,title:"è¿å¥ SQLite æ§å¶å°å¹¶æå®æ°æ®åº",slug:"è¿å¥-sqlite-æ§å¶å°å¹¶æå®æ°æ®åº",normalizedTitle:"è¿å¥ sqlite æ§å¶å°å¹¶æå®æ°æ®åº",charIndex:4925},{level:4,title:"éåº SQLite æ§å¶å°",slug:"éåº-sqlite-æ§å¶å°",normalizedTitle:"éåº sqlite æ§å¶å°",charIndex:5092},{level:4,title:"æ¥çå½ä»¤å¸®å©",slug:"æ¥çå½ä»¤å¸®å©",normalizedTitle:"æ¥çå½ä»¤å¸®å©",charIndex:5124},{level:3,title:"å¸¸ç¨å½ä»¤æ¸å",slug:"å¸¸ç¨å½ä»¤æ¸å",normalizedTitle:"å¸¸ç¨å½ä»¤æ¸å",charIndex:5150},{level:3,title:"å®æ",slug:"å®æ",normalizedTitle:"å®æ",charIndex:6586},{level:4,title:"æ ¼å¼åè¾åº",slug:"æ ¼å¼åè¾åº",normalizedTitle:"æ ¼å¼åè¾åº",charIndex:6592},{level:4,title:"è¾åºç»æå°æä»¶",slug:"è¾åºç»æå°æä»¶",normalizedTitle:"è¾åºç»æå°æä»¶",charIndex:6666},{level:2,title:"JAVA Client",slug:"java-client",normalizedTitle:"java client",charIndex:6842},{level:3,title:"å¦ä½æå®æ°æ®åºæä»¶",slug:"å¦ä½æå®æ°æ®åºæä»¶",normalizedTitle:"å¦ä½æå®æ°æ®åºæä»¶",charIndex:8534},{level:3,title:"å¦ä½ä½¿ç¨åå­æ°æ®åº",slug:"å¦ä½ä½¿ç¨åå­æ°æ®åº",normalizedTitle:"å¦ä½ä½¿ç¨åå­æ°æ®åº",charIndex:8777},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8870},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:9069}],headersStr:"ç®ä» ä¼ç¹ å±é å®è£ è¯­æ³ å¤§å°åææ æ³¨é åå»ºæ°æ®åº æ¥çæ°æ®åº éåºæ°æ®åº éå æ°æ®åº åç¦»æ°æ®åº å¤ä»½æ°æ®åº æ¢å¤æ°æ®åº æ°æ®ç±»å SQLite å­å¨ç±» SQLite äº²å(Affinity)ç±»å SQLite äº²åç±»å(Affinity)åç±»ååç§° Boolean æ°æ®ç±»å Date ä¸ Time æ°æ®ç±»å SQLite å½ä»¤ å¿«éå¼å§ è¿å¥ SQLite æ§å¶å° è¿å¥ SQLite æ§å¶å°å¹¶æå®æ°æ®åº éåº SQLite æ§å¶å° æ¥çå½ä»¤å¸®å© å¸¸ç¨å½ä»¤æ¸å å®æ æ ¼å¼åè¾åº è¾åºç»æå°æä»¶ JAVA Client å¦ä½æå®æ°æ®åºæä»¶ å¦ä½ä½¿ç¨åå­æ°æ®åº åèèµæ ðª ä¼ éé¨",content:'# SQLite\n\n> SQLite æ¯ä¸ä¸ªå®ç°äºèªç»èªè¶³çãæ æå¡å¨çãé¶éç½®çãäºå¡æ§ç SQL æ°æ®åºå¼æã ð å®æ´ç¤ºä¾æºç \n\n\n# ç®ä»\n\n\n# ä¼ç¹\n\n * SQLite æ¯èªç»èªè¶³çï¼è¿æå³çä¸éè¦ä»»ä½å¤é¨çä¾èµã\n * SQLite æ¯æ æå¡å¨çãé¶éç½®çï¼è¿æå³çä¸éè¦å®è£æç®¡çã\n * SQLite äºå¡æ¯å®å¨å¼å®¹ ACID çï¼åè®¸ä»å¤ä¸ªè¿ç¨æçº¿ç¨å®å¨è®¿é®ã\n * SQLite æ¯éå¸¸å°çï¼æ¯è½»éçº§çï¼å®å¨éç½®æ¶å°äº 400KiBï¼çç¥å¯éåè½éç½®æ¶å°äº 250KiBã\n * SQLite æ¯æ SQL92ï¼SQL2ï¼æ åçå¤§å¤æ°æ¥è¯¢è¯­è¨çåè½ã\n * ä¸ä¸ªå®æ´ç SQLite æ°æ®åºæ¯å­å¨å¨ä¸ä¸ªåä¸çè·¨å¹³å°çç£çæä»¶ã\n * SQLite ä½¿ç¨ ANSI-C ç¼åçï¼å¹¶æä¾äºç®ååæäºä½¿ç¨ç APIã\n * SQLite å¯å¨ UNIXï¼Linux, Mac OS-X, Android, iOSï¼å Windowsï¼Win32, WinCE, WinRTï¼ä¸­è¿è¡ã\n\n\n# å±é\n\nç¹æ§                 æè¿°\nRIGHT OUTER JOIN   åªå®ç°äº LEFT OUTER JOINã\nFULL OUTER JOIN    åªå®ç°äº LEFT OUTER JOINã\nALTER TABLE        æ¯æ RENAME TABLE å ALTER TABLE ç ADD COLUMN variants å½ä»¤ï¼ä¸æ¯æ\n                   DROP COLUMNãALTER COLUMNãADD CONSTRAINTã\nTrigger æ¯æ         æ¯æ FOR EACH ROW è§¦åå¨ï¼ä½ä¸æ¯æ FOR EACH STATEMENT è§¦åå¨ã\nVIEWs              å¨ SQLite ä¸­ï¼è§å¾æ¯åªè¯»çãæ¨ä¸å¯ä»¥å¨è§å¾ä¸æ§è¡ DELETEãINSERT æ UPDATE è¯­å¥ã\nGRANT å REVOKE     å¯ä»¥åºç¨çå¯ä¸çè®¿é®æéæ¯åºå±æä½ç³»ç»çæ­£å¸¸æä»¶è®¿é®æéã\n\n\n# å®è£\n\nSqlite å¯å¨ UNIXï¼Linux, Mac OS-X, Android, iOSï¼å Windowsï¼Win32, WinCE, WinRTï¼ä¸­è¿è¡ã\n\nä¸è¬ï¼Linux å Mac ä¸ä¼é¢å®è£ sqliteãå¦ææ²¡æå®è£ï¼å¯ä»¥å¨å®æ¹ä¸è½½å°åä¸è½½åéå®è£çæ¬ï¼èªè¡å®è£ã\n\n\n# è¯­æ³\n\n> è¿éä¸ä¼è¯¦ç»åä¸¾ææ SQL è¯­æ³ï¼ä»åä¸¾ SQLite é¤æ å SQL ä»¥å¤çï¼ä¸äºèªèº«ç¹æ®ç SQL è¯­æ³ã\n> \n> ð æ©å±éè¯»ï¼æ å SQL åºæ¬è¯­æ³\n\n\n# å¤§å°åææ\n\nSQLite æ¯ä¸åºåå¤§å°åçï¼ä½ä¹æä¸äºå½ä»¤æ¯å¤§å°åææçï¼æ¯å¦ GLOB å glob å¨ SQLite çè¯­å¥ä¸­æä¸åçå«ä¹ã\n\n\n# æ³¨é\n\n-- åè¡æ³¨é\n/*\n å¤è¡æ³¨é1\n å¤è¡æ³¨é2\n */\n\n\n\n# åå»ºæ°æ®åº\n\nå¦ä¸ï¼åå»ºä¸ä¸ªåä¸º test çæ°æ®åºï¼\n\n$ sqlite3 test.db\nSQLite version 3.7.17 2013-05-20 00:56:22\nEnter ".help" for instructions\nEnter SQL statements terminated with a ";"\n\n\n\n# æ¥çæ°æ®åº\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# éåºæ°æ®åº\n\nsqlite> .quit\n\n\n\n# éå æ°æ®åº\n\nåè®¾è¿æ ·ä¸ç§æåµï¼å½å¨åä¸æ¶é´æå¤ä¸ªæ°æ®åºå¯ç¨ï¼æ¨æ³ä½¿ç¨å¶ä¸­çä»»ä½ä¸ä¸ªã\n\nSQLite ç ATTACH DATABASE è¯­å¥æ¯ç¨æ¥éæ©ä¸ä¸ªç¹å®çæ°æ®åºï¼ä½¿ç¨è¯¥å½ä»¤åï¼ææç SQLite è¯­å¥å°å¨éå çæ°æ®åºä¸æ§è¡ã\n\nsqlite> ATTACH DATABASE \'test.db\' AS \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\n\n\n> ð æ³¨æï¼æ°æ®åºå main å temp è¢«ä¿çç¨äºä¸»æ°æ®åºåå­å¨ä¸´æ¶è¡¨åå¶ä»ä¸´æ¶æ°æ®å¯¹è±¡çæ°æ®åºãè¿ä¸¤ä¸ªæ°æ®åºåç§°å¯ç¨äºæ¯ä¸ªæ°æ®åºè¿æ¥ï¼ä¸ä¸åºè¯¥è¢«ç¨äºéå ï¼å¦åå°å¾å°ä¸ä¸ªè­¦åæ¶æ¯ã\n\n\n# åç¦»æ°æ®åº\n\nSQLite ç DETACH DATABASE è¯­å¥æ¯ç¨æ¥æå½åæ°æ®åºä»ä¸ä¸ªæ°æ®åºè¿æ¥åç¦»åæ¸¸ç¦»åºæ¥ï¼è¿æ¥æ¯ä¹åä½¿ç¨ ATTACH è¯­å¥éå çã\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\nsqlite> DETACH DATABASE \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# å¤ä»½æ°æ®åº\n\nå¦ä¸ï¼å¤ä»½ test æ°æ®åºå° /home/test.sql\n\nsqlite3 test.db .dump > /home/test.sql\n\n\n\n# æ¢å¤æ°æ®åº\n\nå¦ä¸ï¼æ ¹æ® /home/test.sql æ¢å¤ test æ°æ®åº\n\nsqlite3 test.db < test.sql\n\n\n\n# æ°æ®ç±»å\n\nSQLite ä½¿ç¨ä¸ä¸ªæ´æ®éçå¨æç±»åç³»ç»ãå¨ SQLite ä¸­ï¼å¼çæ°æ®ç±»åä¸å¼æ¬èº«æ¯ç¸å³çï¼èä¸æ¯ä¸å®çå®¹å¨ç¸å³ã\n\n\n# SQLite å­å¨ç±»\n\næ¯ä¸ªå­å¨å¨ SQLite æ°æ®åºä¸­çå¼é½å·æä»¥ä¸å­å¨ç±»ä¹ä¸ï¼\n\nå­å¨ç±»       æè¿°\nNULL      å¼æ¯ä¸ä¸ª NULL å¼ã\nINTEGER   å¼æ¯ä¸ä¸ªå¸¦ç¬¦å·çæ´æ°ï¼æ ¹æ®å¼çå¤§å°å­å¨å¨ 1ã2ã3ã4ã6 æ 8 å­èä¸­ã\nREAL      å¼æ¯ä¸ä¸ªæµ®ç¹å¼ï¼å­å¨ä¸º 8 å­èç IEEE æµ®ç¹æ°å­ã\nTEXT      å¼æ¯ä¸ä¸ªææ¬å­ç¬¦ä¸²ï¼ä½¿ç¨æ°æ®åºç¼ç ï¼UTF-8ãUTF-16BE æ UTF-16LEï¼å­å¨ã\nBLOB      å¼æ¯ä¸ä¸ª blob æ°æ®ï¼å®å¨æ ¹æ®å®çè¾å¥å­å¨ã\n\nSQLite çå­å¨ç±»ç¨å¾®æ¯æ°æ®ç±»åæ´æ®éãINTEGER å­å¨ç±»ï¼ä¾å¦ï¼åå« 6 ç§ä¸åçä¸åé¿åº¦çæ´æ°æ°æ®ç±»åã\n\n\n# SQLite äº²å(Affinity)ç±»å\n\nSQLite æ¯æåçäº²åç±»åæ¦å¿µãä»»ä½åä»ç¶å¯ä»¥å­å¨ä»»ä½ç±»åçæ°æ®ï¼å½æ°æ®æå¥æ¶ï¼è¯¥å­æ®µçæ°æ®å°ä¼ä¼åéç¨äº²ç¼ç±»åä½ä¸ºè¯¥å¼çå­å¨æ¹å¼ãSQLite ç®åççæ¬æ¯æä»¥ä¸äºç§äº²ç¼ç±»åï¼\n\näº²åç±»å      æè¿°\nTEXT      æ°å¼åæ°æ®å¨è¢«æå¥ä¹åï¼éè¦åè¢«è½¬æ¢ä¸ºææ¬æ ¼å¼ï¼ä¹ååæå¥å°ç®æ å­æ®µä¸­ã\nNUMERIC   å½ææ¬æ°æ®è¢«æå¥å°äº²ç¼æ§ä¸º NUMERIC çå­æ®µä¸­æ¶ï¼å¦æè½¬æ¢æä½ä¸ä¼å¯¼è´æ°æ®ä¿¡æ¯ä¸¢å¤±ä»¥åå®å¨å¯éï¼é£ä¹ SQLite\n          å°±ä¼å°è¯¥ææ¬æ°æ®è½¬æ¢ä¸º INTEGER æ REAL ç±»åçæ°æ®ï¼å¦æè½¬æ¢å¤±è´¥ï¼SQLite ä»ä¼ä»¥ TEXT\n          æ¹å¼å­å¨è¯¥æ°æ®ãå¯¹äº NULL æ BLOB ç±»åçæ°æ°æ®ï¼SQLite å°ä¸åä»»ä½è½¬æ¢ï¼ç´æ¥ä»¥ NULL æ BLOB\n          çæ¹å¼å­å¨è¯¥æ°æ®ãéè¦é¢å¤è¯´æçæ¯ï¼å¯¹äºæµ®ç¹æ ¼å¼çå¸¸éææ¬ï¼å¦"30000.0"ï¼å¦æè¯¥å¼å¯ä»¥è½¬æ¢ä¸º INTEGER\n          åæ¶åä¸ä¼ä¸¢å¤±æ°å¼ä¿¡æ¯ï¼é£ä¹ SQLite å°±ä¼å°å¶è½¬æ¢ä¸º INTEGER çå­å¨æ¹å¼ã\nINTEGER   å¯¹äºäº²ç¼ç±»åä¸º INTEGER çå­æ®µï¼å¶è§åç­åäº NUMERICï¼å¯ä¸å·®å«æ¯å¨æ§è¡ CAST è¡¨è¾¾å¼æ¶ã\nREAL      å¶è§ååºæ¬ç­åäº NUMERICï¼å¯ä¸çå·®å«æ¯ä¸ä¼å°"30000.0"è¿æ ·çææ¬æ°æ®è½¬æ¢ä¸º INTEGER å­å¨æ¹å¼ã\nNONE      ä¸åä»»ä½çè½¬æ¢ï¼ç´æ¥ä»¥è¯¥æ°æ®æå±çæ°æ®ç±»åè¿è¡å­å¨ã\n\n\n# SQLite äº²åç±»å(Affinity)åç±»ååç§°\n\nä¸è¡¨ååºäºå½åå»º SQLite3 è¡¨æ¶å¯ä½¿ç¨çåç§æ°æ®ç±»ååç§°ï¼åæ¶ä¹æ¾ç¤ºäºç¸åºçäº²åç±»åï¼\n\næ°æ®ç±»å                                                           äº²åç±»å\nINT, INTEGER, TINYINT, SMALLINT, MEDIUMINT, BIGINT, UNSIGNED   INTEGER\nBIG INT, INT2, INT8\nCHARACTER(20), VARCHAR(255), VARYING CHARACTER(255),           TEXT\nNCHAR(55), NATIVE CHARACTER(70), NVARCHAR(100), TEXT, CLOB\nBLOB, no datatype specified                                    NONE\nREAL, DOUBLE, DOUBLE PRECISION, FLOAT                          REAL\nNUMERIC, DECIMAL(10,5), BOOLEAN, DATE, DATETIME                NUMERIC\n\n\n# Boolean æ°æ®ç±»å\n\nSQLite æ²¡æåç¬ç Boolean å­å¨ç±»ãç¸åï¼å¸å°å¼è¢«å­å¨ä¸ºæ´æ° 0ï¼falseï¼å 1ï¼trueï¼ã\n\n\n# Date ä¸ Time æ°æ®ç±»å\n\nSQLite æ²¡æä¸ä¸ªåç¬çç¨äºå­å¨æ¥æå/ææ¶é´çå­å¨ç±»ï¼ä½ SQLite è½å¤ææ¥æåæ¶é´å­å¨ä¸º TEXTãREAL æ INTEGER å¼ã\n\nå­å¨ç±»       æ¥ææ ¼å¼\nTEXT      æ ¼å¼ä¸º "YYYY-MM-DD HH:MM:SS.SSS" çæ¥æã\nREAL      ä»å¬åå 4714 å¹´ 11 æ 24 æ¥æ ¼æå°¼æ²»æ¶é´çæ­£åå¼å§ç®èµ·çå¤©æ°ã\nINTEGER   ä» 1970-01-01 00:00:00 UTC ç®èµ·çç§æ°ã\n\næ¨å¯ä»¥ä»¥ä»»ä½ä¸è¿°æ ¼å¼æ¥å­å¨æ¥æåæ¶é´ï¼å¹¶ä¸å¯ä»¥ä½¿ç¨åç½®çæ¥æåæ¶é´å½æ°æ¥èªç±è½¬æ¢ä¸åæ ¼å¼ã\n\n\n# SQLite å½ä»¤\n\n\n# å¿«éå¼å§\n\n# è¿å¥ SQLite æ§å¶å°\n\n$ sqlite3\nSQLite version 3.7.17 2013-05-20 00:56:22\nEnter ".help" for instructions\nEnter SQL statements terminated with a ";"\nsqlite>\n\n\n# è¿å¥ SQLite æ§å¶å°å¹¶æå®æ°æ®åº\n\n$ sqlite3 test.db\nSQLite version 3.7.17 2013-05-20 00:56:22\nEnter ".help" for instructions\nEnter SQL statements terminated with a ";"\nsqlite>\n\n\n# éåº SQLite æ§å¶å°\n\nsqlite>.quit\n\n\n# æ¥çå½ä»¤å¸®å©\n\nsqlite>.help\n\n\n\n# å¸¸ç¨å½ä»¤æ¸å\n\nå½ä»¤                      æè¿°\n.backup ?DB? FILE       å¤ä»½ DB æ°æ®åºï¼é»è®¤æ¯ "main"ï¼å° FILE æä»¶ã\n.bail ON|OFF            åçéè¯¯ååæ­¢ãé»è®¤ä¸º OFFã\n.databases              ååºæ°æ®åºçåç§°åå¶æä¾éçæä»¶ã\n.dump ?TABLE?           ä»¥ SQL ææ¬æ ¼å¼è½¬å¨æ°æ®åºãå¦ææå®äº TABLE è¡¨ï¼ååªè½¬å¨å¹é LIKE æ¨¡å¼ç TABLE è¡¨ã\n.echo ON|OFF            å¼å¯æå³é­ echo å½ä»¤ã\n.exit                   éåº SQLite æç¤ºç¬¦ã\n.explain ON|OFF         å¼å¯æå³é­éåäº EXPLAIN çè¾åºæ¨¡å¼ãå¦ææ²¡æå¸¦åæ°ï¼åä¸º EXPLAIN onï¼åå¼å¯ EXPLAINã\n.header(s) ON|OFF       å¼å¯æå³é­å¤´é¨æ¾ç¤ºã\n.help                   æ¾ç¤ºæ¶æ¯ã\n.import FILE TABLE      å¯¼å¥æ¥èª FILE æä»¶çæ°æ®å° TABLE è¡¨ä¸­ã\n.indices ?TABLE?        æ¾ç¤ºææç´¢å¼çåç§°ãå¦ææå®äº TABLE è¡¨ï¼ååªæ¾ç¤ºå¹é LIKE æ¨¡å¼ç TABLE è¡¨çç´¢å¼ã\n.load FILE ?ENTRY?      å è½½ä¸ä¸ªæ©å±åºã\n.log FILE|off           å¼å¯æå³é­æ¥å¿ãFILE æä»¶å¯ä»¥æ¯ stderrï¼æ åéè¯¯ï¼/stdoutï¼æ åè¾åºï¼ã\n.mode MODE              è®¾ç½®è¾åºæ¨¡å¼ï¼MODE å¯ä»¥æ¯ä¸åä¹ä¸ï¼csv éå·åéçå¼column å·¦å¯¹é½çåhtml HTML ç\n.nullvalue STRING       å¨ NULL å¼çå°æ¹è¾åº STRING å­ç¬¦ä¸²ã\n.output FILENAME        åéè¾åºå° FILENAME æä»¶ã\n.output stdout          åéè¾åºå°å±å¹ã\n.print STRING...        éå­å°è¾åº STRING å­ç¬¦ä¸²ã\n.prompt MAIN CONTINUE   æ¿æ¢æ åæç¤ºç¬¦ã\n.quit                   éåº SQLite æç¤ºç¬¦ã\n.read FILENAME          æ§è¡ FILENAME æä»¶ä¸­ç SQLã\n.schema ?TABLE?         æ¾ç¤º CREATE è¯­å¥ãå¦ææå®äº TABLE è¡¨ï¼ååªæ¾ç¤ºå¹é LIKE æ¨¡å¼ç TABLE è¡¨ã\n.separator STRING       æ¹åè¾åºæ¨¡å¼å .import æä½¿ç¨çåéç¬¦ã\n.show                   æ¾ç¤ºåç§è®¾ç½®çå½åå¼ã\n.stats ON|OFF           å¼å¯æå³é­ç»è®¡ã\n.tables ?PATTERN?       ååºå¹é LIKE æ¨¡å¼çè¡¨çåç§°ã\n.timeout MS             å°è¯æå¼éå®çè¡¨ MS æ¯«ç§ã\n.width NUM NUM          ä¸º "column" æ¨¡å¼è®¾ç½®åå®½åº¦ã\n.timer ON|OFF           å¼å¯æå³é­ CPU å®æ¶å¨ã\n\n\n# å®æ\n\n# æ ¼å¼åè¾åº\n\nsqlite>.header on\nsqlite>.mode column\nsqlite>.timer on\nsqlite>\n\n\n# è¾åºç»æå°æä»¶\n\nsqlite> .mode list\nsqlite> .separator |\nsqlite> .output teyptest_file_1.txt\nsqlite> select * from tbl1;\nsqlite> .exit\n$ cat test_file_1.txt\nhello|10\ngoodbye|20\n$\n\n\n\n# JAVA Client\n\nï¼1ï¼å¨å®æ¹ä¸è½½å°åä¸è½½ sqlite-jdbc-(VERSION).jar ï¼ç¶åå° jar åæ¾å¨é¡¹ç®ä¸­ç classpathã\n\nï¼2ï¼éè¿ API æå¼ä¸ä¸ª SQLite æ°æ®åºè¿æ¥ã\n\næ§è¡æ¹æ³ï¼\n\n> javac Sample.java\n> java -classpath ".;sqlite-jdbc-(VERSION).jar" Sample   # in Windows\nor\n> java -classpath ".:sqlite-jdbc-(VERSION).jar" Sample   # in Mac or Linux\nname = leo\nid = 1\nname = yui\nid = 2\n\n\nç¤ºä¾ï¼\n\npublic class Sample {\n    public static void main(String[] args) {\n        Connection connection = null;\n        try {\n            // åå»ºæ°æ®åºè¿æ¥\n            connection = DriverManager.getConnection("jdbc:sqlite:sample.db");\n            Statement statement = connection.createStatement();\n            statement.setQueryTimeout(30);  // è®¾ç½® sql æ§è¡è¶æ¶æ¶é´ä¸º 30s\n\n            statement.executeUpdate("drop table if exists person");\n            statement.executeUpdate("create table person (id integer, name string)");\n            statement.executeUpdate("insert into person values(1, \'leo\')");\n            statement.executeUpdate("insert into person values(2, \'yui\')");\n            ResultSet rs = statement.executeQuery("select * from person");\n            while (rs.next()) {\n                // è¯»åç»æé\n                System.out.println("name = " + rs.getString("name"));\n                System.out.println("id = " + rs.getInt("id"));\n            }\n        } catch (SQLException e) {\n            // å¦æéè¯¯ä¿¡æ¯æ¯ "out of memory"ï¼å¯è½æ¯æ¾ä¸å°æ°æ®åºæä»¶\n            System.err.println(e.getMessage());\n        } finally {\n            try {\n                if (connection != null) {\n                    connection.close();\n                }\n            } catch (SQLException e) {\n                // å³é­è¿æ¥å¤±è´¥\n                System.err.println(e.getMessage());\n            }\n        }\n    }\n}\n\n\n\n# å¦ä½æå®æ°æ®åºæä»¶\n\nWindows\n\nConnection connection = DriverManager.getConnection("jdbc:sqlite:C:/work/mydatabase.db");\n\n\nUnix (Linux, Mac OS X, etc)\n\nConnection connection = DriverManager.getConnection("jdbc:sqlite:/home/leo/work/mydatabase.db");\n\n\n\n# å¦ä½ä½¿ç¨åå­æ°æ®åº\n\nConnection connection = DriverManager.getConnection("jdbc:sqlite::memory:");\n\n\n\n# åèèµæ\n\n * SQLite å®ç½\n * SQLite å®æ¹ææ¡£\n * SQLite å®æ¹å½ä»¤è¡æå\n * http://www.runoob.com/sqlite/sqlite-commands.html\n * https://github.com/xerial/sqlite-jdbc\n * http://www.runoob.com/sqlite/sqlite-java.html\n\n\n# ðª ä¼ éé¨\n\n| æç Github åå®¢ | db-tutorial é¦é¡µ |',normalizedContent:'# sqlite\n\n> sqlite æ¯ä¸ä¸ªå®ç°äºèªç»èªè¶³çãæ æå¡å¨çãé¶éç½®çãäºå¡æ§ç sql æ°æ®åºå¼æã ð å®æ´ç¤ºä¾æºç \n\n\n# ç®ä»\n\n\n# ä¼ç¹\n\n * sqlite æ¯èªç»èªè¶³çï¼è¿æå³çä¸éè¦ä»»ä½å¤é¨çä¾èµã\n * sqlite æ¯æ æå¡å¨çãé¶éç½®çï¼è¿æå³çä¸éè¦å®è£æç®¡çã\n * sqlite äºå¡æ¯å®å¨å¼å®¹ acid çï¼åè®¸ä»å¤ä¸ªè¿ç¨æçº¿ç¨å®å¨è®¿é®ã\n * sqlite æ¯éå¸¸å°çï¼æ¯è½»éçº§çï¼å®å¨éç½®æ¶å°äº 400kibï¼çç¥å¯éåè½éç½®æ¶å°äº 250kibã\n * sqlite æ¯æ sql92ï¼sql2ï¼æ åçå¤§å¤æ°æ¥è¯¢è¯­è¨çåè½ã\n * ä¸ä¸ªå®æ´ç sqlite æ°æ®åºæ¯å­å¨å¨ä¸ä¸ªåä¸çè·¨å¹³å°çç£çæä»¶ã\n * sqlite ä½¿ç¨ ansi-c ç¼åçï¼å¹¶æä¾äºç®ååæäºä½¿ç¨ç apiã\n * sqlite å¯å¨ unixï¼linux, mac os-x, android, iosï¼å windowsï¼win32, wince, winrtï¼ä¸­è¿è¡ã\n\n\n# å±é\n\nç¹æ§                 æè¿°\nright outer join   åªå®ç°äº left outer joinã\nfull outer join    åªå®ç°äº left outer joinã\nalter table        æ¯æ rename table å alter table ç add column variants å½ä»¤ï¼ä¸æ¯æ\n                   drop columnãalter columnãadd constraintã\ntrigger æ¯æ         æ¯æ for each row è§¦åå¨ï¼ä½ä¸æ¯æ for each statement è§¦åå¨ã\nviews              å¨ sqlite ä¸­ï¼è§å¾æ¯åªè¯»çãæ¨ä¸å¯ä»¥å¨è§å¾ä¸æ§è¡ deleteãinsert æ update è¯­å¥ã\ngrant å revoke     å¯ä»¥åºç¨çå¯ä¸çè®¿é®æéæ¯åºå±æä½ç³»ç»çæ­£å¸¸æä»¶è®¿é®æéã\n\n\n# å®è£\n\nsqlite å¯å¨ unixï¼linux, mac os-x, android, iosï¼å windowsï¼win32, wince, winrtï¼ä¸­è¿è¡ã\n\nä¸è¬ï¼linux å mac ä¸ä¼é¢å®è£ sqliteãå¦ææ²¡æå®è£ï¼å¯ä»¥å¨å®æ¹ä¸è½½å°åä¸è½½åéå®è£çæ¬ï¼èªè¡å®è£ã\n\n\n# è¯­æ³\n\n> è¿éä¸ä¼è¯¦ç»åä¸¾ææ sql è¯­æ³ï¼ä»åä¸¾ sqlite é¤æ å sql ä»¥å¤çï¼ä¸äºèªèº«ç¹æ®ç sql è¯­æ³ã\n> \n> ð æ©å±éè¯»ï¼æ å sql åºæ¬è¯­æ³\n\n\n# å¤§å°åææ\n\nsqlite æ¯ä¸åºåå¤§å°åçï¼ä½ä¹æä¸äºå½ä»¤æ¯å¤§å°åææçï¼æ¯å¦ glob å glob å¨ sqlite çè¯­å¥ä¸­æä¸åçå«ä¹ã\n\n\n# æ³¨é\n\n-- åè¡æ³¨é\n/*\n å¤è¡æ³¨é1\n å¤è¡æ³¨é2\n */\n\n\n\n# åå»ºæ°æ®åº\n\nå¦ä¸ï¼åå»ºä¸ä¸ªåä¸º test çæ°æ®åºï¼\n\n$ sqlite3 test.db\nsqlite version 3.7.17 2013-05-20 00:56:22\nenter ".help" for instructions\nenter sql statements terminated with a ";"\n\n\n\n# æ¥çæ°æ®åº\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# éåºæ°æ®åº\n\nsqlite> .quit\n\n\n\n# éå æ°æ®åº\n\nåè®¾è¿æ ·ä¸ç§æåµï¼å½å¨åä¸æ¶é´æå¤ä¸ªæ°æ®åºå¯ç¨ï¼æ¨æ³ä½¿ç¨å¶ä¸­çä»»ä½ä¸ä¸ªã\n\nsqlite ç attach database è¯­å¥æ¯ç¨æ¥éæ©ä¸ä¸ªç¹å®çæ°æ®åºï¼ä½¿ç¨è¯¥å½ä»¤åï¼ææç sqlite è¯­å¥å°å¨éå çæ°æ®åºä¸æ§è¡ã\n\nsqlite> attach database \'test.db\' as \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\n\n\n> ð æ³¨æï¼æ°æ®åºå main å temp è¢«ä¿çç¨äºä¸»æ°æ®åºåå­å¨ä¸´æ¶è¡¨åå¶ä»ä¸´æ¶æ°æ®å¯¹è±¡çæ°æ®åºãè¿ä¸¤ä¸ªæ°æ®åºåç§°å¯ç¨äºæ¯ä¸ªæ°æ®åºè¿æ¥ï¼ä¸ä¸åºè¯¥è¢«ç¨äºéå ï¼å¦åå°å¾å°ä¸ä¸ªè­¦åæ¶æ¯ã\n\n\n# åç¦»æ°æ®åº\n\nsqlite ç detach database è¯­å¥æ¯ç¨æ¥æå½åæ°æ®åºä»ä¸ä¸ªæ°æ®åºè¿æ¥åç¦»åæ¸¸ç¦»åºæ¥ï¼è¿æ¥æ¯ä¹åä½¿ç¨ attach è¯­å¥éå çã\n\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n2    test             /root/test.db\nsqlite> detach database \'test\';\nsqlite> .databases\nseq  name             file\n---  ---------------  ----------------------------------------------------------\n0    main             /root/test.db\n\n\n\n# å¤ä»½æ°æ®åº\n\nå¦ä¸ï¼å¤ä»½ test æ°æ®åºå° /home/test.sql\n\nsqlite3 test.db .dump > /home/test.sql\n\n\n\n# æ¢å¤æ°æ®åº\n\nå¦ä¸ï¼æ ¹æ® /home/test.sql æ¢å¤ test æ°æ®åº\n\nsqlite3 test.db < test.sql\n\n\n\n# æ°æ®ç±»å\n\nsqlite ä½¿ç¨ä¸ä¸ªæ´æ®éçå¨æç±»åç³»ç»ãå¨ sqlite ä¸­ï¼å¼çæ°æ®ç±»åä¸å¼æ¬èº«æ¯ç¸å³çï¼èä¸æ¯ä¸å®çå®¹å¨ç¸å³ã\n\n\n# sqlite å­å¨ç±»\n\næ¯ä¸ªå­å¨å¨ sqlite æ°æ®åºä¸­çå¼é½å·æä»¥ä¸å­å¨ç±»ä¹ä¸ï¼\n\nå­å¨ç±»       æè¿°\nnull      å¼æ¯ä¸ä¸ª null å¼ã\ninteger   å¼æ¯ä¸ä¸ªå¸¦ç¬¦å·çæ´æ°ï¼æ ¹æ®å¼çå¤§å°å­å¨å¨ 1ã2ã3ã4ã6 æ 8 å­èä¸­ã\nreal      å¼æ¯ä¸ä¸ªæµ®ç¹å¼ï¼å­å¨ä¸º 8 å­èç ieee æµ®ç¹æ°å­ã\ntext      å¼æ¯ä¸ä¸ªææ¬å­ç¬¦ä¸²ï¼ä½¿ç¨æ°æ®åºç¼ç ï¼utf-8ãutf-16be æ utf-16leï¼å­å¨ã\nblob      å¼æ¯ä¸ä¸ª blob æ°æ®ï¼å®å¨æ ¹æ®å®çè¾å¥å­å¨ã\n\nsqlite çå­å¨ç±»ç¨å¾®æ¯æ°æ®ç±»åæ´æ®éãinteger å­å¨ç±»ï¼ä¾å¦ï¼åå« 6 ç§ä¸åçä¸åé¿åº¦çæ´æ°æ°æ®ç±»åã\n\n\n# sqlite äº²å(affinity)ç±»å\n\nsqlite æ¯æåçäº²åç±»åæ¦å¿µãä»»ä½åä»ç¶å¯ä»¥å­å¨ä»»ä½ç±»åçæ°æ®ï¼å½æ°æ®æå¥æ¶ï¼è¯¥å­æ®µçæ°æ®å°ä¼ä¼åéç¨äº²ç¼ç±»åä½ä¸ºè¯¥å¼çå­å¨æ¹å¼ãsqlite ç®åççæ¬æ¯æä»¥ä¸äºç§äº²ç¼ç±»åï¼\n\näº²åç±»å      æè¿°\ntext      æ°å¼åæ°æ®å¨è¢«æå¥ä¹åï¼éè¦åè¢«è½¬æ¢ä¸ºææ¬æ ¼å¼ï¼ä¹ååæå¥å°ç®æ å­æ®µä¸­ã\nnumeric   å½ææ¬æ°æ®è¢«æå¥å°äº²ç¼æ§ä¸º numeric çå­æ®µä¸­æ¶ï¼å¦æè½¬æ¢æä½ä¸ä¼å¯¼è´æ°æ®ä¿¡æ¯ä¸¢å¤±ä»¥åå®å¨å¯éï¼é£ä¹ sqlite\n          å°±ä¼å°è¯¥ææ¬æ°æ®è½¬æ¢ä¸º integer æ real ç±»åçæ°æ®ï¼å¦æè½¬æ¢å¤±è´¥ï¼sqlite ä»ä¼ä»¥ text\n          æ¹å¼å­å¨è¯¥æ°æ®ãå¯¹äº null æ blob ç±»åçæ°æ°æ®ï¼sqlite å°ä¸åä»»ä½è½¬æ¢ï¼ç´æ¥ä»¥ null æ blob\n          çæ¹å¼å­å¨è¯¥æ°æ®ãéè¦é¢å¤è¯´æçæ¯ï¼å¯¹äºæµ®ç¹æ ¼å¼çå¸¸éææ¬ï¼å¦"30000.0"ï¼å¦æè¯¥å¼å¯ä»¥è½¬æ¢ä¸º integer\n          åæ¶åä¸ä¼ä¸¢å¤±æ°å¼ä¿¡æ¯ï¼é£ä¹ sqlite å°±ä¼å°å¶è½¬æ¢ä¸º integer çå­å¨æ¹å¼ã\ninteger   å¯¹äºäº²ç¼ç±»åä¸º integer çå­æ®µï¼å¶è§åç­åäº numericï¼å¯ä¸å·®å«æ¯å¨æ§è¡ cast è¡¨è¾¾å¼æ¶ã\nreal      å¶è§ååºæ¬ç­åäº numericï¼å¯ä¸çå·®å«æ¯ä¸ä¼å°"30000.0"è¿æ ·çææ¬æ°æ®è½¬æ¢ä¸º integer å­å¨æ¹å¼ã\nnone      ä¸åä»»ä½çè½¬æ¢ï¼ç´æ¥ä»¥è¯¥æ°æ®æå±çæ°æ®ç±»åè¿è¡å­å¨ã\n\n\n# sqlite äº²åç±»å(affinity)åç±»ååç§°\n\nä¸è¡¨ååºäºå½åå»º sqlite3 è¡¨æ¶å¯ä½¿ç¨çåç§æ°æ®ç±»ååç§°ï¼åæ¶ä¹æ¾ç¤ºäºç¸åºçäº²åç±»åï¼\n\næ°æ®ç±»å                                                           äº²åç±»å\nint, integer, tinyint, smallint, mediumint, bigint, unsigned   integer\nbig int, int2, int8\ncharacter(20), varchar(255), varying character(255),           text\nnchar(55), native character(70), nvarchar(100), text, clob\nblob, no datatype specified                                    none\nreal, double, double precision, float                          real\nnumeric, decimal(10,5), boolean, date, datetime                numeric\n\n\n# boolean æ°æ®ç±»å\n\nsqlite æ²¡æåç¬ç boolean å­å¨ç±»ãç¸åï¼å¸å°å¼è¢«å­å¨ä¸ºæ´æ° 0ï¼falseï¼å 1ï¼trueï¼ã\n\n\n# date ä¸ time æ°æ®ç±»å\n\nsqlite æ²¡æä¸ä¸ªåç¬çç¨äºå­å¨æ¥æå/ææ¶é´çå­å¨ç±»ï¼ä½ sqlite è½å¤ææ¥æåæ¶é´å­å¨ä¸º textãreal æ integer å¼ã\n\nå­å¨ç±»       æ¥ææ ¼å¼\ntext      æ ¼å¼ä¸º "yyyy-mm-dd hh:mm:ss.sss" çæ¥æã\nreal      ä»å¬åå 4714 å¹´ 11 æ 24 æ¥æ ¼æå°¼æ²»æ¶é´çæ­£åå¼å§ç®èµ·çå¤©æ°ã\ninteger   ä» 1970-01-01 00:00:00 utc ç®èµ·çç§æ°ã\n\næ¨å¯ä»¥ä»¥ä»»ä½ä¸è¿°æ ¼å¼æ¥å­å¨æ¥æåæ¶é´ï¼å¹¶ä¸å¯ä»¥ä½¿ç¨åç½®çæ¥æåæ¶é´å½æ°æ¥èªç±è½¬æ¢ä¸åæ ¼å¼ã\n\n\n# sqlite å½ä»¤\n\n\n# å¿«éå¼å§\n\n# è¿å¥ sqlite æ§å¶å°\n\n$ sqlite3\nsqlite version 3.7.17 2013-05-20 00:56:22\nenter ".help" for instructions\nenter sql statements terminated with a ";"\nsqlite>\n\n\n# è¿å¥ sqlite æ§å¶å°å¹¶æå®æ°æ®åº\n\n$ sqlite3 test.db\nsqlite version 3.7.17 2013-05-20 00:56:22\nenter ".help" for instructions\nenter sql statements terminated with a ";"\nsqlite>\n\n\n# éåº sqlite æ§å¶å°\n\nsqlite>.quit\n\n\n# æ¥çå½ä»¤å¸®å©\n\nsqlite>.help\n\n\n\n# å¸¸ç¨å½ä»¤æ¸å\n\nå½ä»¤                      æè¿°\n.backup ?db? file       å¤ä»½ db æ°æ®åºï¼é»è®¤æ¯ "main"ï¼å° file æä»¶ã\n.bail on|off            åçéè¯¯ååæ­¢ãé»è®¤ä¸º offã\n.databases              ååºæ°æ®åºçåç§°åå¶æä¾éçæä»¶ã\n.dump ?table?           ä»¥ sql ææ¬æ ¼å¼è½¬å¨æ°æ®åºãå¦ææå®äº table è¡¨ï¼ååªè½¬å¨å¹é like æ¨¡å¼ç table è¡¨ã\n.echo on|off            å¼å¯æå³é­ echo å½ä»¤ã\n.exit                   éåº sqlite æç¤ºç¬¦ã\n.explain on|off         å¼å¯æå³é­éåäº explain çè¾åºæ¨¡å¼ãå¦ææ²¡æå¸¦åæ°ï¼åä¸º explain onï¼åå¼å¯ explainã\n.header(s) on|off       å¼å¯æå³é­å¤´é¨æ¾ç¤ºã\n.help                   æ¾ç¤ºæ¶æ¯ã\n.import file table      å¯¼å¥æ¥èª file æä»¶çæ°æ®å° table è¡¨ä¸­ã\n.indices ?table?        æ¾ç¤ºææç´¢å¼çåç§°ãå¦ææå®äº table è¡¨ï¼ååªæ¾ç¤ºå¹é like æ¨¡å¼ç table è¡¨çç´¢å¼ã\n.load file ?entry?      å è½½ä¸ä¸ªæ©å±åºã\n.log file|off           å¼å¯æå³é­æ¥å¿ãfile æä»¶å¯ä»¥æ¯ stderrï¼æ åéè¯¯ï¼/stdoutï¼æ åè¾åºï¼ã\n.mode mode              è®¾ç½®è¾åºæ¨¡å¼ï¼mode å¯ä»¥æ¯ä¸åä¹ä¸ï¼csv éå·åéçå¼column å·¦å¯¹é½çåhtml html ç\n.nullvalue string       å¨ null å¼çå°æ¹è¾åº string å­ç¬¦ä¸²ã\n.output filename        åéè¾åºå° filename æä»¶ã\n.output stdout          åéè¾åºå°å±å¹ã\n.print string...        éå­å°è¾åº string å­ç¬¦ä¸²ã\n.prompt main continue   æ¿æ¢æ åæç¤ºç¬¦ã\n.quit                   éåº sqlite æç¤ºç¬¦ã\n.read filename          æ§è¡ filename æä»¶ä¸­ç sqlã\n.schema ?table?         æ¾ç¤º create è¯­å¥ãå¦ææå®äº table è¡¨ï¼ååªæ¾ç¤ºå¹é like æ¨¡å¼ç table è¡¨ã\n.separator string       æ¹åè¾åºæ¨¡å¼å .import æä½¿ç¨çåéç¬¦ã\n.show                   æ¾ç¤ºåç§è®¾ç½®çå½åå¼ã\n.stats on|off           å¼å¯æå³é­ç»è®¡ã\n.tables ?pattern?       ååºå¹é like æ¨¡å¼çè¡¨çåç§°ã\n.timeout ms             å°è¯æå¼éå®çè¡¨ ms æ¯«ç§ã\n.width num num          ä¸º "column" æ¨¡å¼è®¾ç½®åå®½åº¦ã\n.timer on|off           å¼å¯æå³é­ cpu å®æ¶å¨ã\n\n\n# å®æ\n\n# æ ¼å¼åè¾åº\n\nsqlite>.header on\nsqlite>.mode column\nsqlite>.timer on\nsqlite>\n\n\n# è¾åºç»æå°æä»¶\n\nsqlite> .mode list\nsqlite> .separator |\nsqlite> .output teyptest_file_1.txt\nsqlite> select * from tbl1;\nsqlite> .exit\n$ cat test_file_1.txt\nhello|10\ngoodbye|20\n$\n\n\n\n# java client\n\nï¼1ï¼å¨å®æ¹ä¸è½½å°åä¸è½½ sqlite-jdbc-(version).jar ï¼ç¶åå° jar åæ¾å¨é¡¹ç®ä¸­ç classpathã\n\nï¼2ï¼éè¿ api æå¼ä¸ä¸ª sqlite æ°æ®åºè¿æ¥ã\n\næ§è¡æ¹æ³ï¼\n\n> javac sample.java\n> java -classpath ".;sqlite-jdbc-(version).jar" sample   # in windows\nor\n> java -classpath ".:sqlite-jdbc-(version).jar" sample   # in mac or linux\nname = leo\nid = 1\nname = yui\nid = 2\n\n\nç¤ºä¾ï¼\n\npublic class sample {\n    public static void main(string[] args) {\n        connection connection = null;\n        try {\n            // åå»ºæ°æ®åºè¿æ¥\n            connection = drivermanager.getconnection("jdbc:sqlite:sample.db");\n            statement statement = connection.createstatement();\n            statement.setquerytimeout(30);  // è®¾ç½® sql æ§è¡è¶æ¶æ¶é´ä¸º 30s\n\n            statement.executeupdate("drop table if exists person");\n            statement.executeupdate("create table person (id integer, name string)");\n            statement.executeupdate("insert into person values(1, \'leo\')");\n            statement.executeupdate("insert into person values(2, \'yui\')");\n            resultset rs = statement.executequery("select * from person");\n            while (rs.next()) {\n                // è¯»åç»æé\n                system.out.println("name = " + rs.getstring("name"));\n                system.out.println("id = " + rs.getint("id"));\n            }\n        } catch (sqlexception e) {\n            // å¦æéè¯¯ä¿¡æ¯æ¯ "out of memory"ï¼å¯è½æ¯æ¾ä¸å°æ°æ®åºæä»¶\n            system.err.println(e.getmessage());\n        } finally {\n            try {\n                if (connection != null) {\n                    connection.close();\n                }\n            } catch (sqlexception e) {\n                // å³é­è¿æ¥å¤±è´¥\n                system.err.println(e.getmessage());\n            }\n        }\n    }\n}\n\n\n\n# å¦ä½æå®æ°æ®åºæä»¶\n\nwindows\n\nconnection connection = drivermanager.getconnection("jdbc:sqlite:c:/work/mydatabase.db");\n\n\nunix (linux, mac os x, etc)\n\nconnection connection = drivermanager.getconnection("jdbc:sqlite:/home/leo/work/mydatabase.db");\n\n\n\n# å¦ä½ä½¿ç¨åå­æ°æ®åº\n\nconnection connection = drivermanager.getconnection("jdbc:sqlite::memory:");\n\n\n\n# åèèµæ\n\n * sqlite å®ç½\n * sqlite å®æ¹ææ¡£\n * sqlite å®æ¹å½ä»¤è¡æå\n * http://www.runoob.com/sqlite/sqlite-commands.html\n * https://github.com/xerial/sqlite-jdbc\n * http://www.runoob.com/sqlite/sqlite-java.html\n\n\n# ðª ä¼ éé¨\n\n| æç github åå®¢ | db-tutorial é¦é¡µ |',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"å³ç³»åæ°æ®åºå¶ä»ç¥è¯",frontmatter:{title:"å³ç³»åæ°æ®åºå¶ä»ç¥è¯",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/b2560d/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/99.%E5%85%B6%E4%BB%96/",relativePath:"03.å³ç³»åæ°æ®åº/99.å¶ä»/README.md",key:"v-598fed5e",path:"/pages/b2560d/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:17},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:73},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:83}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# å³ç³»åæ°æ®åºå¶ä»ç¥è¯\n\n\n# ð åå®¹\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# å³ç³»åæ°æ®åºå¶ä»ç¥è¯\n\n\n# ð åå®¹\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ð èµæ\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"å³ç³»åæ°æ®åº",frontmatter:{title:"å³ç³»åæ°æ®åº",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","å³ç³»åæ°æ®åº"],tags:["æ°æ®åº","å³ç³»åæ°æ®åº"],permalink:"/pages/bdd9ad/"},regularPath:"/03.%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93/",relativePath:"03.å³ç³»åæ°æ®åº/README.md",key:"v-10ae1758",path:"/pages/bdd9ad/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:13},{level:3,title:"å¬å±ç¥è¯",slug:"å¬å±ç¥è¯",normalizedTitle:"å¬å±ç¥è¯",charIndex:23},{level:3,title:"Mysql",slug:"mysql",normalizedTitle:"mysql",charIndex:107},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:387},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:440},{level:3,title:"ç»¼å",slug:"ç»¼å",normalizedTitle:"ç»¼å",charIndex:450},{level:3,title:"Mysql",slug:"mysql-2",normalizedTitle:"mysql",charIndex:107},{level:3,title:"å¶ä»",slug:"å¶ä»-2",normalizedTitle:"å¶ä»",charIndex:387},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:793}],headersStr:"ð åå®¹ å¬å±ç¥è¯ Mysql å¶ä» ð èµæ ç»¼å Mysql å¶ä» ðª ä¼ é",content:"# å³ç³»åæ°æ®åº\n\n\n# ð åå®¹\n\n\n# å¬å±ç¥è¯\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * SQL Cheat Sheet æ¯ä¸ä¸ª SQL å¥é¨æç¨ã\n * æ©å± SQL æ¯ä¸ä¸ª SQL å¥é¨æç¨ã\n\n\n# Mysql\n\n\n\n * Mysql åºç¨æå â¡\n * Mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * Mysql äºå¡ - å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * Mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n * Mysql ç´¢å¼ - å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n * Mysql æ§è½ä¼å\n * Mysql è¿ç»´ ð¨\n * Mysql éç½® ð¨\n * Mysql é®é¢\n\n\n# å¶ä»\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ð èµæ\n\n\n# ç»¼å\n\n * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n * ãSQL å¿ç¥å¿ä¼ã - SQL çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n\n\n# Mysql\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * Mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæå\n   * ãMySQL å¿ç¥å¿ä¼ã - éåå¥é¨è\n * æç¨\n   * MySQL å®æ 45 è®²\n   * runoob.com MySQL æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# å¶ä»\n\n * ãOracle Database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# å³ç³»åæ°æ®åº\n\n\n# ð åå®¹\n\n\n# å¬å±ç¥è¯\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * sql cheat sheet æ¯ä¸ä¸ª sql å¥é¨æç¨ã\n * æ©å± sql æ¯ä¸ä¸ª sql å¥é¨æç¨ã\n\n\n# mysql\n\n\n\n * mysql åºç¨æå â¡\n * mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * mysql äºå¡ - å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n * mysql ç´¢å¼ - å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n * mysql æ§è½ä¼å\n * mysql è¿ç»´ ð¨\n * mysql éç½® ð¨\n * mysql é®é¢\n\n\n# å¶ä»\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ð èµæ\n\n\n# ç»¼å\n\n * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n * ãsql å¿ç¥å¿ä¼ã - sql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n\n\n# mysql\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * mysql å®æ¹ææ¡£ä¹å½ä»¤è¡å®¢æ·ç«¯\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæå\n   * ãmysql å¿ç¥å¿ä¼ã - éåå¥é¨è\n * æç¨\n   * mysql å®æ 45 è®²\n   * runoob.com mysql æç¨\n   * mysql-tutorial\n * æ´å¤èµæº\n   * awesome-mysql\n\n\n# å¶ä»\n\n * ãoracle database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB åºç¨æå",frontmatter:{title:"MongoDB åºç¨æå",date:"2020-09-07T07:54:19.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],permalink:"/pages/56d5b6/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/01.MongoDB%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/01.MongoDBåºç¨æå.md",key:"v-533deaa3",path:"/pages/56d5b6/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:19},{level:3,title:"MongoDB åå±",slug:"mongodb-åå±",normalizedTitle:"mongodb åå±",charIndex:178},{level:3,title:"MongoDB å RDBMS",slug:"mongodb-å-rdbms",normalizedTitle:"mongodb å rdbms",charIndex:273},{level:3,title:"MongoDB ç¹æ§",slug:"mongodb-ç¹æ§",normalizedTitle:"mongodb ç¹æ§",charIndex:652},{level:2,title:"MongoDB æ¦å¿µ",slug:"mongodb-æ¦å¿µ",normalizedTitle:"mongodb æ¦å¿µ",charIndex:748},{level:3,title:"æ°æ®åº",slug:"æ°æ®åº",normalizedTitle:"æ°æ®åº",charIndex:44},{level:3,title:"ææ¡£",slug:"ææ¡£",normalizedTitle:"ææ¡£",charIndex:105},{level:3,title:"éå",slug:"éå",normalizedTitle:"éå",charIndex:865},{level:3,title:"åæ°æ®",slug:"åæ°æ®",normalizedTitle:"åæ°æ®",charIndex:2594},{level:2,title:"MongoDB æ°æ®ç±»å",slug:"mongodb-æ°æ®ç±»å",normalizedTitle:"mongodb æ°æ®ç±»å",charIndex:3092},{level:2,title:"MongoDB CRUD",slug:"mongodb-crud",normalizedTitle:"mongodb crud",charIndex:3848},{level:3,title:"æ°æ®åºæä½",slug:"æ°æ®åºæä½",normalizedTitle:"æ°æ®åºæä½",charIndex:3865},{level:4,title:"æ¥çæææ°æ®åº",slug:"æ¥çæææ°æ®åº",normalizedTitle:"æ¥çæææ°æ®åº",charIndex:3874},{level:4,title:"åå»ºæ°æ®åº",slug:"åå»ºæ°æ®åº",normalizedTitle:"åå»ºæ°æ®åº",charIndex:3896},{level:4,title:"å é¤æ°æ®åº",slug:"å é¤æ°æ®åº",normalizedTitle:"å é¤æ°æ®åº",charIndex:4249},{level:3,title:"éåæä½",slug:"éåæä½",normalizedTitle:"éåæä½",charIndex:4288},{level:4,title:"æ¥çéå",slug:"æ¥çéå",normalizedTitle:"æ¥çéå",charIndex:4296},{level:4,title:"åå»ºéå",slug:"åå»ºéå",normalizedTitle:"åå»ºéå",charIndex:4323},{level:4,title:"å é¤éå",slug:"å é¤éå",normalizedTitle:"å é¤éå",charIndex:4899},{level:3,title:"æå¥ææ¡£æä½",slug:"æå¥ææ¡£æä½",normalizedTitle:"æå¥ææ¡£æä½",charIndex:4959},{level:3,title:"æ¥è¯¢ææ¡£æä½",slug:"æ¥è¯¢ææ¡£æä½",normalizedTitle:"æ¥è¯¢ææ¡£æä½",charIndex:5539},{level:4,title:"æ¥è¯¢æ¡ä»¶",slug:"æ¥è¯¢æ¡ä»¶",normalizedTitle:"æ¥è¯¢æ¡ä»¶",charIndex:5607},{level:4,title:"æ¥è¯¢é»è¾æ¡ä»¶",slug:"æ¥è¯¢é»è¾æ¡ä»¶",normalizedTitle:"æ¥è¯¢é»è¾æ¡ä»¶",charIndex:6768},{level:4,title:"æ¨¡ç³æ¥è¯¢",slug:"æ¨¡ç³æ¥è¯¢",normalizedTitle:"æ¨¡ç³æ¥è¯¢",charIndex:7058},{level:4,title:"Limit() æ¹æ³",slug:"limit-æ¹æ³",normalizedTitle:"limit() æ¹æ³",charIndex:7228},{level:4,title:"Skip() æ¹æ³",slug:"skip-æ¹æ³",normalizedTitle:"skip() æ¹æ³",charIndex:7401},{level:4,title:"Sort() æ¹æ³",slug:"sort-æ¹æ³",normalizedTitle:"sort() æ¹æ³",charIndex:7574},{level:3,title:"æ´æ°ææ¡£æä½",slug:"æ´æ°ææ¡£æä½",normalizedTitle:"æ´æ°ææ¡£æä½",charIndex:7835},{level:3,title:"å é¤ææ¡£æä½",slug:"å é¤ææ¡£æä½",normalizedTitle:"å é¤ææ¡£æä½",charIndex:9212},{level:3,title:"ç´¢å¼æä½",slug:"ç´¢å¼æä½",normalizedTitle:"ç´¢å¼æä½",charIndex:9399},{level:2,title:"MongoDB èåæä½",slug:"mongodb-èåæä½",normalizedTitle:"mongodb èåæä½",charIndex:10938},{level:3,title:"ç®¡é",slug:"ç®¡é",normalizedTitle:"ç®¡é",charIndex:11036},{level:3,title:"èåæ­¥éª¤",slug:"èåæ­¥éª¤",normalizedTitle:"èåæ­¥éª¤",charIndex:11228},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:13583}],headersStr:"ç®ä» MongoDB åå± MongoDB å RDBMS MongoDB ç¹æ§ MongoDB æ¦å¿µ æ°æ®åº ææ¡£ éå åæ°æ® MongoDB æ°æ®ç±»å MongoDB CRUD æ°æ®åºæä½ æ¥çæææ°æ®åº åå»ºæ°æ®åº å é¤æ°æ®åº éåæä½ æ¥çéå åå»ºéå å é¤éå æå¥ææ¡£æä½ æ¥è¯¢ææ¡£æä½ æ¥è¯¢æ¡ä»¶ æ¥è¯¢é»è¾æ¡ä»¶ æ¨¡ç³æ¥è¯¢ Limit() æ¹æ³ Skip() æ¹æ³ Sort() æ¹æ³ æ´æ°ææ¡£æä½ å é¤ææ¡£æä½ ç´¢å¼æä½ MongoDB èåæä½ ç®¡é èåæ­¥éª¤ åèèµæ",content:'# MongoDB åºç¨æå\n\n\n# ç®ä»\n\nMongoDB æ¯ä¸ä¸ªåºäºåå¸å¼æä»¶å­å¨çæ°æ®åºãç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n\nMongoDB å°æ°æ®å­å¨ä¸ºä¸ä¸ªææ¡£ï¼æ°æ®ç»æç±é®å¼(key=>value)å¯¹ç»æãMongoDB ææ¡£ç±»ä¼¼äº JSON å¯¹è±¡ãå­æ®µå¼å¯ä»¥åå«å¶ä»ææ¡£ï¼æ°ç»åææ¡£æ°ç»ã\n\n\n# MongoDB åå±\n\n * 1.x - æ¯æå¤å¶ååç\n * 2.x - æ´ä¸°å¯çæ°æ®åºåè½\n * 3.x - WiredTiger åå¨è¾¹çæ\n * 4.x - æ¯æåå¸å¼äºå¡\n\n\n# MongoDB å RDBMS\n\nç¹æ§        MONGODB                       RDBMS\næ°æ®æ¨¡å      ææ¡£æ¨¡å                          å³ç³»å\nCRUD æä½   MQL/SQL                       SQL\né«å¯ç¨       å¤å¶é                           éç¾¤æ¨¡å¼\næ©å±æ§       æ¯æåç                          æ°æ®ååº\næ©ç¹æ¹å¼      åç´æ©å±+æ°´å¹³æ©å±                     åç´æ©å±\nç´¢å¼ç±»å      B æ ãå¨æç´¢å¼ãå°çä½ç½®ç´¢å¼ãå¤é®ç´¢å¼ãTTL ç´¢å¼   B æ \næ°æ®å®¹é      æ²¡æçè®ºä¸é                        åä¸ãäº¿\n\n\n# MongoDB ç¹æ§\n\n * æ°æ®æ¯ JSON ç»æ\n   * æ¯æç»æåãåç»æåæ°æ®æ¨¡å\n   * å¯ä»¥å¨æååºç»æåå\n * éè¿å¯æ¬æºå¶æä¾é«å¯ç¨\n * éè¿åçæä¾æ©å®¹è½å\n\n\n# MongoDB æ¦å¿µ\n\nSQL æ¯è¯­/æ¦å¿µ     MONGODB æ¯è¯­/æ¦å¿µ   è§£é/è¯´æ\ndatabase      database        æ°æ®åº\ntable         collection      æ°æ®åºè¡¨/éå\nrow           document        æ°æ®è®°å½è¡/ææ¡£\ncolumn        field           æ°æ®å­æ®µ/å\nindex         index           ç´¢å¼\ntable joins                   è¡¨è¿æ¥,MongoDB ä¸æ¯æ\nprimary key   primary key     ä¸»é®,MongoDB èªå¨å°_id å­æ®µè®¾ç½®ä¸ºä¸»é®\n\n\n# æ°æ®åº\n\nä¸ä¸ª MongoDB ä¸­å¯ä»¥å»ºç«å¤ä¸ªæ°æ®åºã\n\nMongoDB çé»è®¤æ°æ®åºä¸º"db"ï¼è¯¥æ°æ®åºå­å¨å¨ data ç®å½ä¸­ã\n\nMongoDB çåä¸ªå®ä¾å¯ä»¥å®¹çº³å¤ä¸ªç¬ç«çæ°æ®åºï¼æ¯ä¸ä¸ªé½æèªå·±çéååæéï¼ä¸åçæ°æ®åºä¹æ¾ç½®å¨ä¸åçæä»¶ä¸­ã\n\n"show dbs" å½ä»¤å¯ä»¥æ¾ç¤ºæææ°æ®çåè¡¨ã\n\n$ ./mongo\nMongoDBshell version: 3.0.6\nconnecting to: test\n> show dbs\nlocal  0.078GB\ntest   0.078GB\n>\n\n\næ§è¡ "db" å½ä»¤å¯ä»¥æ¾ç¤ºå½åæ°æ®åºå¯¹è±¡æéåã\n\n$ ./mongo\nMongoDBshell version: 3.0.6\nconnecting to: test\n> db\ntest\n>\n\n\nè¿è¡"use"å½ä»¤ï¼å¯ä»¥è¿æ¥å°ä¸ä¸ªæå®çæ°æ®åºã\n\n> use local\nswitched to db local\n> db\nlocal\n>\n\n\næ°æ®åºä¹éè¿åå­æ¥æ è¯ãæ°æ®åºåå¯ä»¥æ¯æ»¡è¶³ä»¥ä¸æ¡ä»¶çä»»æ UTF-8 å­ç¬¦ä¸²ã\n\n * ä¸è½æ¯ç©ºå­ç¬¦ä¸²ï¼"")ã\n * ä¸å¾å«æ \' \'ï¼ç©ºæ ¼)ã.ã\\$ã/ã\\å \\0 (ç©ºå­ç¬¦)ã\n * åºå¨é¨å°åã\n * æå¤ 64 å­èã\n\næä¸äºæ°æ®åºåæ¯ä¿ççï¼å¯ä»¥ç´æ¥è®¿é®è¿äºæç¹æ®ä½ç¨çæ°æ®åºã\n\n * adminï¼ä»æéçè§åº¦æ¥çï¼è¿æ¯"root"æ°æ®åºãè¦æ¯å°ä¸ä¸ªç¨æ·æ·»å å°è¿ä¸ªæ°æ®åºï¼è¿ä¸ªç¨æ·èªå¨ç»§æ¿æææ°æ®åºçæéãä¸äºç¹å®çæå¡å¨ç«¯å½ä»¤ä¹åªè½ä»è¿ä¸ªæ°æ®åºè¿è¡ï¼æ¯å¦ååºææçæ°æ®åºæèå³é­æå¡å¨ã\n * localï¼è¿ä¸ªæ°æ®æ°¸è¿ä¸ä¼è¢«å¤å¶ï¼å¯ä»¥ç¨æ¥å­å¨éäºæ¬å°åå°æå¡å¨çä»»æéå\n * configï¼å½ Mongo ç¨äºåçè®¾ç½®æ¶ï¼config æ°æ®åºå¨åé¨ä½¿ç¨ï¼ç¨äºä¿å­åççç¸å³ä¿¡æ¯ã\n\n\n# ææ¡£\n\nææ¡£æ¯ä¸ç»é®å¼(key-value)å¯¹(å³ BSON)ãMongoDB çææ¡£ä¸éè¦è®¾ç½®ç¸åçå­æ®µï¼å¹¶ä¸ç¸åçå­æ®µä¸éè¦ç¸åçæ°æ®ç±»åï¼è¿ä¸å³ç³»åæ°æ®åºæå¾å¤§çåºå«ï¼ä¹æ¯ MongoDB éå¸¸çªåºçç¹ç¹ã\n\néè¦æ³¨æçæ¯ï¼\n\n * ææ¡£ä¸­çé®/å¼å¯¹æ¯æåºçã\n * ææ¡£ä¸­çå¼ä¸ä»å¯ä»¥æ¯å¨åå¼å·éé¢çå­ç¬¦ä¸²ï¼è¿å¯ä»¥æ¯å¶ä»å ç§æ°æ®ç±»åï¼çè³å¯ä»¥æ¯æ´ä¸ªåµå¥çææ¡£)ã\n * MongoDB åºåç±»ååå¤§å°åã\n * MongoDB çææ¡£ä¸è½æéå¤çé®ã\n * ææ¡£çé®æ¯å­ç¬¦ä¸²ãé¤äºå°æ°ä¾å¤æåµï¼é®å¯ä»¥ä½¿ç¨ä»»æ UTF-8 å­ç¬¦ã\n\nææ¡£é®å½åè§èï¼\n\n * é®ä¸è½å«æ \\0 (ç©ºå­ç¬¦)ãè¿ä¸ªå­ç¬¦ç¨æ¥è¡¨ç¤ºé®çç»å°¾ã\n * . å $ æç¹å«çæä¹ï¼åªæå¨ç¹å®ç¯å¢ä¸æè½ä½¿ç¨ã\n * ä»¥ä¸åçº¿ _ å¼å¤´çé®æ¯ä¿çç(ä¸æ¯ä¸¥æ ¼è¦æ±ç)ã\n\n\n# éå\n\néåå°±æ¯ MongoDB ææ¡£ç»ï¼ç±»ä¼¼äº RDBMS ï¼å³ç³»æ°æ®åºç®¡çç³»ç»ï¼Relational Database Management System)ä¸­çè¡¨æ ¼ã\n\néåå­å¨äºæ°æ®åºä¸­ï¼éåæ²¡æåºå®çç»æï¼è¿æå³çä½ å¨å¯¹éåå¯ä»¥æå¥ä¸åæ ¼å¼åç±»åçæ°æ®ï¼ä½éå¸¸æåµä¸æä»¬æå¥éåçæ°æ®é½ä¼æä¸å®çå³èæ§ã\n\nåæ³çéååï¼\n\n * éååä¸è½æ¯ç©ºå­ç¬¦ä¸²""ã\n * éååä¸è½å«æ \\0 å­ç¬¦ï¼ç©ºå­ç¬¦)ï¼è¿ä¸ªå­ç¬¦è¡¨ç¤ºéååçç»å°¾ã\n * éååä¸è½ä»¥"system."å¼å¤´ï¼è¿æ¯ä¸ºç³»ç»éåä¿ççåç¼ã\n * ç¨æ·åå»ºçéååå­ä¸è½å«æä¿çå­ç¬¦ãæäºé©±å¨ç¨åºçç¡®æ¯æå¨éååéé¢åå«ï¼è¿æ¯å ä¸ºæäºç³»ç»çæçéåä¸­åå«è¯¥å­ç¬¦ãé¤éä½ è¦è®¿é®è¿ç§ç³»ç»åå»ºçéåï¼å¦ååä¸ä¸è¦å¨åå­éåºç° $ã\n\n\n# åæ°æ®\n\næ°æ®åºçä¿¡æ¯æ¯å­å¨å¨éåä¸­ãå®ä»¬ä½¿ç¨äºç³»ç»çå½åç©ºé´ï¼dbname.system.*\n\nå¨ MongoDB æ°æ®åºä¸­åå­ç©ºé´ <dbname>.system.* æ¯åå«å¤ç§ç³»ç»ä¿¡æ¯çç¹æ®éå(Collection)ï¼å¦ä¸:\n\néåå½åç©ºé´                     æè¿°\ndbname.system.namespaces   ååºææåå­ç©ºé´ã\ndbname.system.indexes      ååºææç´¢å¼ã\ndbname.system.profile      åå«æ°æ®åºæ¦è¦(profile)ä¿¡æ¯ã\ndbname.system.users        ååºææå¯è®¿é®æ°æ®åºçç¨æ·ã\ndbname.local.sources       åå«å¤å¶å¯¹ç«¯ï¼slaveï¼çæå¡å¨ä¿¡æ¯åç¶æã\n\nå¯¹äºä¿®æ¹ç³»ç»éåä¸­çå¯¹è±¡æå¦ä¸éå¶ã\n\nå¨ system.indexes æå¥æ°æ®ï¼å¯ä»¥åå»ºç´¢å¼ãä½é¤æ­¤ä¹å¤è¯¥è¡¨ä¿¡æ¯æ¯ä¸å¯åç(ç¹æ®ç drop index å½ä»¤å°èªå¨æ´æ°ç¸å³ä¿¡æ¯)ãsystem.users æ¯å¯ä¿®æ¹çãsystem.profile æ¯å¯å é¤çã\n\n\n# MongoDB æ°æ®ç±»å\n\næ°æ®ç±»å                 æè¿°\nString               å­ç¬¦ä¸²ãå­å¨æ°æ®å¸¸ç¨çæ°æ®ç±»åãå¨ MongoDB ä¸­ï¼UTF-8 ç¼ç çå­ç¬¦ä¸²ææ¯åæ³çã\nInteger              æ´åæ°å¼ãç¨äºå­å¨æ°å¼ãæ ¹æ®ä½ æéç¨çæå¡å¨ï¼å¯åä¸º 32 ä½æ 64 ä½ã\nBoolean              å¸å°å¼ãç¨äºå­å¨å¸å°å¼ï¼ç/åï¼ã\nDouble               åç²¾åº¦æµ®ç¹å¼ãç¨äºå­å¨æµ®ç¹å¼ã\nMin/Max keys         å°ä¸ä¸ªå¼ä¸ BSONï¼äºè¿å¶ç JSONï¼åç´ çæä½å¼åæé«å¼ç¸å¯¹æ¯ã\nArray                ç¨äºå°æ°ç»æåè¡¨æå¤ä¸ªå¼å­å¨ä¸ºä¸ä¸ªé®ã\nTimestamp            æ¶é´æ³ãè®°å½ææ¡£ä¿®æ¹ææ·»å çå·ä½æ¶é´ã\nObject               ç¨äºååµææ¡£ã\nNull                 ç¨äºåå»ºç©ºå¼ã\nSymbol               ç¬¦å·ãè¯¥æ°æ®ç±»ååºæ¬ä¸ç­åäºå­ç¬¦ä¸²ç±»åï¼ä½ä¸åçæ¯ï¼å®ä¸è¬ç¨äºéç¨ç¹æ®ç¬¦å·ç±»åçè¯­è¨ã\nDate                 æ¥ææ¶é´ãç¨ UNIX æ¶é´æ ¼å¼æ¥å­å¨å½åæ¥æææ¶é´ãä½ å¯ä»¥æå®èªå·±çæ¥ææ¶é´ï¼åå»º Date å¯¹è±¡ï¼ä¼ å¥å¹´ææ¥ä¿¡æ¯ã\nObject ID            å¯¹è±¡ IDãç¨äºåå»ºææ¡£ç IDã\nBinary Data          äºè¿å¶æ°æ®ãç¨äºå­å¨äºè¿å¶æ°æ®ã\nCode                 ä»£ç ç±»åãç¨äºå¨ææ¡£ä¸­å­å¨ JavaScript ä»£ç ã\nRegular expression   æ­£åè¡¨è¾¾å¼ç±»åãç¨äºå­å¨æ­£åè¡¨è¾¾å¼ã\n\n\n# MongoDB CRUD\n\n\n# æ°æ®åºæä½\n\n# æ¥çæææ°æ®åº\n\nshow dbs\n\n\n# åå»ºæ°æ®åº\n\nuse <database>\n\n\nå¦ææ°æ®åºä¸å­å¨ï¼ååå»ºæ°æ®åºï¼å¦ååæ¢å°æå®æ°æ®åºã\n\nãç¤ºä¾ãåå»ºæ°æ®åºï¼å¹¶æå¥ä¸æ¡æ°æ®\n\nååå»ºçæ°æ®åº test å¹¶ä¸å¨æ°æ®åºçåè¡¨ä¸­ï¼ è¦æ¾ç¤ºå®ï¼éè¦æå¥ä¸äºæ°æ®\n\n> use test\nswitched to db test\n>\n> show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\n> db.test.insert({"name":"mongodb"})\nWriteResult({ "nInserted" : 1 })\n> show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\ntest    0.000GB\n\n\n# å é¤æ°æ®åº\n\nå é¤å½åæ°æ®åº\n\ndb.dropDatabase()\n\n\n\n# éåæä½\n\n# æ¥çéå\n\nshow collections\n\n\n# åå»ºéå\n\ndb.createCollection(name, options)\n\n\nåæ°è¯´æï¼\n\n * name: è¦åå»ºçéååç§°\n * options: å¯éåæ°, æå®æå³åå­å¤§å°åç´¢å¼çéé¡¹\n\noptions å¯ä»¥æ¯å¦ä¸åæ°ï¼\n\nå­æ®µ            ç±»å   æè¿°\ncapped        å¸å°   ï¼å¯éï¼å¦æä¸º trueï¼ååå»ºåºå®éåãåºå®éåæ¯ææçåºå®å¤§å°çéåï¼å½è¾¾å°æå¤§å¼æ¶ï¼å®ä¼èªå¨è¦çææ©çææ¡£ã\n                   å½è¯¥å¼ä¸º true æ¶ï¼å¿é¡»æå® size åæ°ã\nautoIndexId   å¸å°   3.2 ä¹åä¸åæ¯æè¯¥åæ°ãï¼å¯éï¼å¦ä¸º trueï¼èªå¨å¨ _id å­æ®µåå»ºç´¢å¼ãé»è®¤ä¸º falseã\nsize          æ°å¼   ï¼å¯éï¼ä¸ºåºå®éåæå®ä¸ä¸ªæå¤§å¼ï¼å³å­èæ°ã å¦æ capped ä¸º trueï¼ä¹éè¦æå®è¯¥å­æ®µã\nmax           æ°å¼   ï¼å¯éï¼æå®åºå®éåä¸­åå«ææ¡£çæå¤§æ°éã\n\nå¨æå¥ææ¡£æ¶ï¼MongoDB é¦åæ£æ¥åºå®éåç size å­æ®µï¼ç¶åæ£æ¥ max å­æ®µã\n\n> db.createCollection("collection")\n{ "ok" : 1 }\n> show collections\ncollection\n\n\n# å é¤éå\n\n> db.collection.drop()\ntrue\n> show collections\n>\n\n\n\n# æå¥ææ¡£æä½\n\nMongoDB ä½¿ç¨ insert() æ¹æ³å®ææå¥æä½ã\n\nè¯­æ³æ ¼å¼\n\n# æå¥åæ¡è®°å½\ndb.<éå>.insertOne(<JSON>)\n# æå¥å¤æ¡è®°å½\ndb.<éå>.insertMany([<JSON 1>, <JSON 2>, ..., <JSON N>])\n\n\nãç¤ºä¾ãinsertOne\n\n> db.color.insertOne({name: "red"})\n{\n        "acknowledged" : true,\n        "insertedId" : ObjectId("5f533ae4e8f16647950fdf43")\n}\n\n\nãç¤ºä¾ãinsertMany\n\n> db.color.insertMany([\n  {\n    "name": "yellow"\n  },\n  {\n    "name": "blue"\n  }\n])\n{\n        "acknowledged" : true,\n        "insertedIds" : [\n                ObjectId("5f533bcae8f16647950fdf44"),\n                ObjectId("5f533bcae8f16647950fdf45")\n        ]\n}\n>\n\n\n\n# æ¥è¯¢ææ¡£æä½\n\nMongoDB ä½¿ç¨ find() æ¹æ³å®ææ¥è¯¢ææ¡£æä½ã\n\nè¯­æ³æ ¼å¼\n\ndb.<éå>.find(<JSON>)\n\n\næ¥è¯¢æ¡ä»¶ä¹æ¯ json å½¢å¼ï¼å¦æä¸è®¾ç½®æ¥è¯¢æ¡ä»¶ï¼å³ä¸ºå¨éæ¥è¯¢ã\n\n# æ¥è¯¢æ¡ä»¶\n\næä½                      æ ¼å¼                                      èä¾                                         RDBMS ä¸­çç±»ä¼¼è¯­å¥\nç­äº                      {<key>:<value>}                         db.book.find({"pageCount": {$eq: 0}})      where pageCount = 0\nä¸ç­äº                     {<key>:{$ne:<value>}}                   db.book.find({"pageCount": {$ne: 0}})      where likes != 50\nå¤§äº                      {<key>:{$gt:<value>}}                   db.book.find({"pageCount": {$gt: 0}})      where likes > 50\n{<key>:{$gt:<value>}}   db.book.find({"pageCount": {$gt: 0}})   where likes > 50                           å¤§äºæç­äº\nå°äº                      {<key>:{$lt:<value>}}                   db.book.find({"pageCount": {$lt: 200}})    where likes < 50\nå°äºæç­äº                   {<key>:{$lte:<value>}}                  db.book.find({"pageCount": {$lte: 200}})   where likes <= 50\n\n> è¯´æï¼\n> \n> $eq  --------  equal  =\n> $ne ----------- not equal  !=\n> $gt -------- greater than  >\n> $gte --------- gt equal  >=\n> $lt -------- less than  <\n> $lte --------- lt equal  <=\n\nãç¤ºä¾ã\n\n\n\n# ç»è®¡å¹éæ¥è¯¢æ¡ä»¶çè®°å½æ°\n> db.book.find({"status": "MEAP"}).count()\n68\n\n\n# æ¥è¯¢é»è¾æ¡ä»¶\n\nï¼1ï¼and æ¡ä»¶\n\nMongoDB ç find() æ¹æ³å¯ä»¥ä¼ å¥å¤ä¸ªé®(key)ï¼æ¯ä¸ªé®(key)ä»¥éå·éå¼ï¼å³å¸¸è§ SQL ç AND æ¡ä»¶ã\n\nè¯­æ³æ ¼å¼å¦ä¸ï¼\n\n> db.col.find({key1:value1, key2:value2}).pretty()\n\n\nï¼2ï¼or æ¡ä»¶\n\nMongoDB OR æ¡ä»¶è¯­å¥ä½¿ç¨äºå³é®å­ $or,è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.col.find(\n   {\n      $or: [\n         {key1: value1}, {key2:value2}\n      ]\n   }\n).pretty()\n\n\n# æ¨¡ç³æ¥è¯¢\n\næ¥è¯¢ title åå«"æ"å­çææ¡£ï¼\n\ndb.col.find({ title: /æ/ })\n\n\næ¥è¯¢ title å­æ®µä»¥"æ"å­å¼å¤´çææ¡£ï¼\n\ndb.col.find({ title: /^æ/ })\n\n\næ¥è¯¢ titl e å­æ®µä»¥"æ"å­ç»å°¾çææ¡£ï¼\n\ndb.col.find({ title: /æ$/ })\n\n\n# Limit() æ¹æ³\n\nå¦æä½ éè¦å¨ MongoDB ä¸­è¯»åæå®æ°éçæ°æ®è®°å½ï¼å¯ä»¥ä½¿ç¨ MongoDB ç Limit æ¹æ³ï¼limit()æ¹æ³æ¥åä¸ä¸ªæ°å­åæ°ï¼è¯¥åæ°æå®ä» MongoDB ä¸­è¯»åçè®°å½æ¡æ°ã\n\nlimit()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.COLLECTION_NAME.find().limit(NUMBER)\n\n\n# Skip() æ¹æ³\n\næä»¬é¤äºå¯ä»¥ä½¿ç¨ limit()æ¹æ³æ¥è¯»åæå®æ°éçæ°æ®å¤ï¼è¿å¯ä»¥ä½¿ç¨ skip()æ¹æ³æ¥è·³è¿æå®æ°éçæ°æ®ï¼skip æ¹æ³åæ ·æ¥åä¸ä¸ªæ°å­åæ°ä½ä¸ºè·³è¿çè®°å½æ¡æ°ã\n\nskip() æ¹æ³èæ¬è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)\n\n\n# Sort() æ¹æ³\n\nå¨ MongoDB ä¸­ä½¿ç¨ sort() æ¹æ³å¯¹æ°æ®è¿è¡æåºï¼sort() æ¹æ³å¯ä»¥éè¿åæ°æå®æåºçå­æ®µï¼å¹¶ä½¿ç¨ 1 å -1 æ¥æå®æåºçæ¹å¼ï¼å¶ä¸­ 1 ä¸ºååºæåï¼è -1 æ¯ç¨äºéåºæåã\n\nsort()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.COLLECTION_NAME.find().sort({KEY:1})\n\n\n> æ³¨æï¼skip(), limilt(), sort()ä¸ä¸ªæ¾å¨ä¸èµ·æ§è¡çæ¶åï¼æ§è¡çé¡ºåºæ¯å sort(), ç¶åæ¯ skip()ï¼æåæ¯æ¾ç¤ºç limit()ã\n\n\n# æ´æ°ææ¡£æä½\n\nupdate() æ¹æ³ç¨äºæ´æ°å·²å­å¨çææ¡£ãè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeConcern: <document>\n   }\n)\n\n\nåæ°è¯´æï¼\n\n * query : update çæ¥è¯¢æ¡ä»¶ï¼ç±»ä¼¼ sql update æ¥è¯¢å where åé¢çã\n * update : update çå¯¹è±¡åä¸äºæ´æ°çæä½ç¬¦ï¼å¦$,$inc...ï¼ç­ï¼ä¹å¯ä»¥çè§£ä¸º sql update æ¥è¯¢å set åé¢ç\n * upsert : å¯éï¼è¿ä¸ªåæ°çæææ¯ï¼å¦æä¸å­å¨ update çè®°å½ï¼æ¯å¦æå¥ objNew,true ä¸ºæå¥ï¼é»è®¤æ¯ falseï¼ä¸æå¥ã\n * multi : å¯éï¼mongodb é»è®¤æ¯ false,åªæ´æ°æ¾å°çç¬¬ä¸æ¡è®°å½ï¼å¦æè¿ä¸ªåæ°ä¸º true,å°±æææ¡ä»¶æ¥åºæ¥å¤æ¡è®°å½å¨é¨æ´æ°ã\n * writeConcern :å¯éï¼æåºå¼å¸¸ççº§å«ã\n\nãç¤ºä¾ãæ´æ°ææ¡£\n\ndb.collection.update({ title: \'MongoDB æç¨\' }, { $set: { title: \'MongoDB\' } })\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ç¸åææ¡£\n\nä»¥ä¸è¯­å¥åªä¼ä¿®æ¹ç¬¬ä¸æ¡åç°çææ¡£ï¼å¦æä½ è¦ä¿®æ¹å¤æ¡ç¸åçææ¡£ï¼åéè¦è®¾ç½® multi åæ°ä¸º trueã\n\ndb.collection.update(\n  { title: \'MongoDB æç¨\' },\n  { $set: { title: \'MongoDB\' } },\n  { multi: true }\n)\n\n\nãç¤ºä¾ãæ´å¤å®ä¾\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update({ count: { $gt: 1 } }, { $set: { test2: \'OK\' } })\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 3 } },\n  { $set: { test2: \'OK\' } },\n  false,\n  true\n)\n\n\nåªæ·»å ç¬¬ä¸æ¡ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ·»å è¿å»:\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'OK\' } },\n  true,\n  false\n)\n\n\n\n# å é¤ææ¡£æä½\n\nå®æ¹æ¨èä½¿ç¨ deleteOne() å deleteMany() æ¹æ³å é¤æ°æ®ã\n\nå é¤ status ç­äº A çå¨é¨ææ¡£ï¼\n\ndb.collection.deleteMany({ status: \'A\' })\n\n\nå é¤ status ç­äº D çä¸ä¸ªææ¡£ï¼\n\ndb.collection.deleteOne({ status: \'D\' })\n\n\n\n# ç´¢å¼æä½\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçï¼å¦ææ²¡æç´¢å¼ï¼MongoDB å¨è¯»åæ°æ®æ¶å¿é¡»æ«æéåä¸­çæ¯ä¸ªæä»¶å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æçæ¯éå¸¸ä½çï¼ç¹å«å¨å¤çå¤§éçæ°æ®æ¶ï¼æ¥è¯¢å¯ä»¥è¦è±è´¹å åç§çè³å åéï¼è¿å¯¹ç½ç«çæ§è½æ¯éå¸¸è´å½çã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\nMongoDB ä½¿ç¨ createIndex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateIndex()æ¹æ³åºæ¬è¯­æ³æ ¼å¼å¦ä¸æç¤ºï¼\n\n>db.collection.createIndex(keys, options)\n\n\nè¯­æ³ä¸­ Key å¼ä¸ºä½ è¦åå»ºçç´¢å¼å­æ®µï¼1 ä¸ºæå®æååºåå»ºç´¢å¼ï¼å¦æä½ æ³æéåºæ¥åå»ºç´¢å¼æå®ä¸º -1 å³å¯ã\n\n>db.col.createIndex({"title":1})\n\n\ncreateIndex() æ¹æ³ä¸­ä½ ä¹å¯ä»¥è®¾ç½®ä½¿ç¨å¤ä¸ªå­æ®µåå»ºç´¢å¼ï¼å³ç³»åæ°æ®åºä¸­ç§°ä½å¤åç´¢å¼ï¼ã\n\n>db.col.createIndex({"title":1,"description":-1})\n\n\ncreateIndex() æ¥æ¶å¯éåæ°ï¼å¯éåæ°åè¡¨å¦ä¸ï¼\n\nPARAMETER            TYPE            DESCRIPTION\nbackground           Boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               Boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼MongoDB çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropDups             Boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º falseã\nsparse               Boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireAfterSeconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ TTL è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\n\n# MongoDB èåæä½\n\nMongoDB ä¸­èå(aggregate)ä¸»è¦ç¨äºå¤çæ°æ®(è¯¸å¦ç»è®¡å¹³åå¼,æ±åç­)ï¼å¹¶è¿åè®¡ç®åçæ°æ®ç»æãæç¹ç±»ä¼¼ sql è¯­å¥ä¸­ç count(*)ã\n\n\n# ç®¡é\n\næ´ä¸ªèåè¿ç®è¿ç¨ç§°ä¸ºç®¡éï¼å®æ¯ç±å¤ä¸ªæ­¥éª¤ç»æï¼æ¯ä¸ªç®¡é\n\n * æ¥åä¸ç³»åææ¡£ï¼åå§æ°æ®ï¼ï¼\n * æ¯ä¸ªæ­¥éª¤å¯¹è¿äºææ¡£è¿è¡ä¸ç³»åè¿ç®ï¼\n * ç»æææ¡£è¾åºç»ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nèåæä½çåºæ¬æ ¼å¼\n\npipeline = [$stage1, $stage1, ..., $stageN];\n\ndb.<éå>.aggregate(pipeline, {options});\n\n\n\n# èåæ­¥éª¤\n\næ­¥éª¤                 ä½ç¨     SQL ç­ä»·è¿ç®ç¬¦\n$match             è¿æ»¤     WHERE\n$project           æå½±     AS\n$sort              æåº     ORDER BY\n$group             åç»     GROUP BY\n$skip / $limit     ç»æéå¶   SKIP / LIMIT\n$lookup            å·¦å¤è¿æ¥   LEFT OUTER JOIN\n$unwind            å±å¼æ°ç»   N/A\n$graphLookup       å¾æç´¢    N/A\n$facet / $bucket   åé¢æç´¢   N/A\n\nãç¤ºä¾ã\n\n> db.collection.insertMany([{"title":"MongoDB Overview","description":"MongoDB is no sql database","by_user":"collection","tagsr":["mongodb","database","NoSQL"],"likes":"100"},{"title":"NoSQL Overview","description":"No sql database is very fast","by_user":"collection","tagsr":["mongodb","database","NoSQL"],"likes":"10"},{"title":"Neo4j Overview","description":"Neo4j is no sql database","by_user":"Neo4j","tagsr":["neo4j","database","NoSQL"],"likes":"750"}])\n> db.collection.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : 1}}}])\n{ "_id" : null, "num_tutorial" : 3 }\n{ "_id" : "Neo4j", "num_tutorial" : 1 }\n{ "_id" : "collection", "num_tutorial" : 2 }\n\n\nä¸è¡¨å±ç¤ºäºä¸äºèåçè¡¨è¾¾å¼:\n\nè¡¨è¾¾å¼         æè¿°                        å®ä¾\n$sum        è®¡ç®æ»åã                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$sum : "$likes"}}}])\n$avg        è®¡ç®å¹³åå¼                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$avg : "$likes"}}}])\n$min        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå°å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$min : "$likes"}}}])\n$max        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå¤§å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$max : "$likes"}}}])\n$push       å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ã          db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$push: "$url"}}}])\n$addToSet   å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ï¼ä½ä¸åå»ºå¯æ¬ã   db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$addToSet : "$url"}}}])\n$first      æ ¹æ®èµæºææ¡£çæåºè·åç¬¬ä¸ä¸ªææ¡£æ°æ®ã       db.mycol.aggregate([{$group : {_id : "$by_user", first_url :\n                                      {$first : "$url"}}}])\n$last       æ ¹æ®èµæºææ¡£çæåºè·åæåä¸ä¸ªææ¡£æ°æ®       db.mycol.aggregate([{$group : {_id : "$by_user", last_url :\n                                      {$last : "$url"}}}])\n\n\n# åèèµæ\n\n * MongoDB å®ç½\n * MongoDB Github\n * MongoDB æç¨',normalizedContent:'# mongodb åºç¨æå\n\n\n# ç®ä»\n\nmongodb æ¯ä¸ä¸ªåºäºåå¸å¼æä»¶å­å¨çæ°æ®åºãç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n\nmongodb å°æ°æ®å­å¨ä¸ºä¸ä¸ªææ¡£ï¼æ°æ®ç»æç±é®å¼(key=>value)å¯¹ç»æãmongodb ææ¡£ç±»ä¼¼äº json å¯¹è±¡ãå­æ®µå¼å¯ä»¥åå«å¶ä»ææ¡£ï¼æ°ç»åææ¡£æ°ç»ã\n\n\n# mongodb åå±\n\n * 1.x - æ¯æå¤å¶ååç\n * 2.x - æ´ä¸°å¯çæ°æ®åºåè½\n * 3.x - wiredtiger åå¨è¾¹çæ\n * 4.x - æ¯æåå¸å¼äºå¡\n\n\n# mongodb å rdbms\n\nç¹æ§        mongodb                       rdbms\næ°æ®æ¨¡å      ææ¡£æ¨¡å                          å³ç³»å\ncrud æä½   mql/sql                       sql\né«å¯ç¨       å¤å¶é                           éç¾¤æ¨¡å¼\næ©å±æ§       æ¯æåç                          æ°æ®ååº\næ©ç¹æ¹å¼      åç´æ©å±+æ°´å¹³æ©å±                     åç´æ©å±\nç´¢å¼ç±»å      b æ ãå¨æç´¢å¼ãå°çä½ç½®ç´¢å¼ãå¤é®ç´¢å¼ãttl ç´¢å¼   b æ \næ°æ®å®¹é      æ²¡æçè®ºä¸é                        åä¸ãäº¿\n\n\n# mongodb ç¹æ§\n\n * æ°æ®æ¯ json ç»æ\n   * æ¯æç»æåãåç»æåæ°æ®æ¨¡å\n   * å¯ä»¥å¨æååºç»æåå\n * éè¿å¯æ¬æºå¶æä¾é«å¯ç¨\n * éè¿åçæä¾æ©å®¹è½å\n\n\n# mongodb æ¦å¿µ\n\nsql æ¯è¯­/æ¦å¿µ     mongodb æ¯è¯­/æ¦å¿µ   è§£é/è¯´æ\ndatabase      database        æ°æ®åº\ntable         collection      æ°æ®åºè¡¨/éå\nrow           document        æ°æ®è®°å½è¡/ææ¡£\ncolumn        field           æ°æ®å­æ®µ/å\nindex         index           ç´¢å¼\ntable joins                   è¡¨è¿æ¥,mongodb ä¸æ¯æ\nprimary key   primary key     ä¸»é®,mongodb èªå¨å°_id å­æ®µè®¾ç½®ä¸ºä¸»é®\n\n\n# æ°æ®åº\n\nä¸ä¸ª mongodb ä¸­å¯ä»¥å»ºç«å¤ä¸ªæ°æ®åºã\n\nmongodb çé»è®¤æ°æ®åºä¸º"db"ï¼è¯¥æ°æ®åºå­å¨å¨ data ç®å½ä¸­ã\n\nmongodb çåä¸ªå®ä¾å¯ä»¥å®¹çº³å¤ä¸ªç¬ç«çæ°æ®åºï¼æ¯ä¸ä¸ªé½æèªå·±çéååæéï¼ä¸åçæ°æ®åºä¹æ¾ç½®å¨ä¸åçæä»¶ä¸­ã\n\n"show dbs" å½ä»¤å¯ä»¥æ¾ç¤ºæææ°æ®çåè¡¨ã\n\n$ ./mongo\nmongodbshell version: 3.0.6\nconnecting to: test\n> show dbs\nlocal  0.078gb\ntest   0.078gb\n>\n\n\næ§è¡ "db" å½ä»¤å¯ä»¥æ¾ç¤ºå½åæ°æ®åºå¯¹è±¡æéåã\n\n$ ./mongo\nmongodbshell version: 3.0.6\nconnecting to: test\n> db\ntest\n>\n\n\nè¿è¡"use"å½ä»¤ï¼å¯ä»¥è¿æ¥å°ä¸ä¸ªæå®çæ°æ®åºã\n\n> use local\nswitched to db local\n> db\nlocal\n>\n\n\næ°æ®åºä¹éè¿åå­æ¥æ è¯ãæ°æ®åºåå¯ä»¥æ¯æ»¡è¶³ä»¥ä¸æ¡ä»¶çä»»æ utf-8 å­ç¬¦ä¸²ã\n\n * ä¸è½æ¯ç©ºå­ç¬¦ä¸²ï¼"")ã\n * ä¸å¾å«æ \' \'ï¼ç©ºæ ¼)ã.ã\\$ã/ã\\å \\0 (ç©ºå­ç¬¦)ã\n * åºå¨é¨å°åã\n * æå¤ 64 å­èã\n\næä¸äºæ°æ®åºåæ¯ä¿ççï¼å¯ä»¥ç´æ¥è®¿é®è¿äºæç¹æ®ä½ç¨çæ°æ®åºã\n\n * adminï¼ä»æéçè§åº¦æ¥çï¼è¿æ¯"root"æ°æ®åºãè¦æ¯å°ä¸ä¸ªç¨æ·æ·»å å°è¿ä¸ªæ°æ®åºï¼è¿ä¸ªç¨æ·èªå¨ç»§æ¿æææ°æ®åºçæéãä¸äºç¹å®çæå¡å¨ç«¯å½ä»¤ä¹åªè½ä»è¿ä¸ªæ°æ®åºè¿è¡ï¼æ¯å¦ååºææçæ°æ®åºæèå³é­æå¡å¨ã\n * localï¼è¿ä¸ªæ°æ®æ°¸è¿ä¸ä¼è¢«å¤å¶ï¼å¯ä»¥ç¨æ¥å­å¨éäºæ¬å°åå°æå¡å¨çä»»æéå\n * configï¼å½ mongo ç¨äºåçè®¾ç½®æ¶ï¼config æ°æ®åºå¨åé¨ä½¿ç¨ï¼ç¨äºä¿å­åççç¸å³ä¿¡æ¯ã\n\n\n# ææ¡£\n\nææ¡£æ¯ä¸ç»é®å¼(key-value)å¯¹(å³ bson)ãmongodb çææ¡£ä¸éè¦è®¾ç½®ç¸åçå­æ®µï¼å¹¶ä¸ç¸åçå­æ®µä¸éè¦ç¸åçæ°æ®ç±»åï¼è¿ä¸å³ç³»åæ°æ®åºæå¾å¤§çåºå«ï¼ä¹æ¯ mongodb éå¸¸çªåºçç¹ç¹ã\n\néè¦æ³¨æçæ¯ï¼\n\n * ææ¡£ä¸­çé®/å¼å¯¹æ¯æåºçã\n * ææ¡£ä¸­çå¼ä¸ä»å¯ä»¥æ¯å¨åå¼å·éé¢çå­ç¬¦ä¸²ï¼è¿å¯ä»¥æ¯å¶ä»å ç§æ°æ®ç±»åï¼çè³å¯ä»¥æ¯æ´ä¸ªåµå¥çææ¡£)ã\n * mongodb åºåç±»ååå¤§å°åã\n * mongodb çææ¡£ä¸è½æéå¤çé®ã\n * ææ¡£çé®æ¯å­ç¬¦ä¸²ãé¤äºå°æ°ä¾å¤æåµï¼é®å¯ä»¥ä½¿ç¨ä»»æ utf-8 å­ç¬¦ã\n\nææ¡£é®å½åè§èï¼\n\n * é®ä¸è½å«æ \\0 (ç©ºå­ç¬¦)ãè¿ä¸ªå­ç¬¦ç¨æ¥è¡¨ç¤ºé®çç»å°¾ã\n * . å $ æç¹å«çæä¹ï¼åªæå¨ç¹å®ç¯å¢ä¸æè½ä½¿ç¨ã\n * ä»¥ä¸åçº¿ _ å¼å¤´çé®æ¯ä¿çç(ä¸æ¯ä¸¥æ ¼è¦æ±ç)ã\n\n\n# éå\n\néåå°±æ¯ mongodb ææ¡£ç»ï¼ç±»ä¼¼äº rdbms ï¼å³ç³»æ°æ®åºç®¡çç³»ç»ï¼relational database management system)ä¸­çè¡¨æ ¼ã\n\néåå­å¨äºæ°æ®åºä¸­ï¼éåæ²¡æåºå®çç»æï¼è¿æå³çä½ å¨å¯¹éåå¯ä»¥æå¥ä¸åæ ¼å¼åç±»åçæ°æ®ï¼ä½éå¸¸æåµä¸æä»¬æå¥éåçæ°æ®é½ä¼æä¸å®çå³èæ§ã\n\nåæ³çéååï¼\n\n * éååä¸è½æ¯ç©ºå­ç¬¦ä¸²""ã\n * éååä¸è½å«æ \\0 å­ç¬¦ï¼ç©ºå­ç¬¦)ï¼è¿ä¸ªå­ç¬¦è¡¨ç¤ºéååçç»å°¾ã\n * éååä¸è½ä»¥"system."å¼å¤´ï¼è¿æ¯ä¸ºç³»ç»éåä¿ççåç¼ã\n * ç¨æ·åå»ºçéååå­ä¸è½å«æä¿çå­ç¬¦ãæäºé©±å¨ç¨åºçç¡®æ¯æå¨éååéé¢åå«ï¼è¿æ¯å ä¸ºæäºç³»ç»çæçéåä¸­åå«è¯¥å­ç¬¦ãé¤éä½ è¦è®¿é®è¿ç§ç³»ç»åå»ºçéåï¼å¦ååä¸ä¸è¦å¨åå­éåºç° $ã\n\n\n# åæ°æ®\n\næ°æ®åºçä¿¡æ¯æ¯å­å¨å¨éåä¸­ãå®ä»¬ä½¿ç¨äºç³»ç»çå½åç©ºé´ï¼dbname.system.*\n\nå¨ mongodb æ°æ®åºä¸­åå­ç©ºé´ <dbname>.system.* æ¯åå«å¤ç§ç³»ç»ä¿¡æ¯çç¹æ®éå(collection)ï¼å¦ä¸:\n\néåå½åç©ºé´                     æè¿°\ndbname.system.namespaces   ååºææåå­ç©ºé´ã\ndbname.system.indexes      ååºææç´¢å¼ã\ndbname.system.profile      åå«æ°æ®åºæ¦è¦(profile)ä¿¡æ¯ã\ndbname.system.users        ååºææå¯è®¿é®æ°æ®åºçç¨æ·ã\ndbname.local.sources       åå«å¤å¶å¯¹ç«¯ï¼slaveï¼çæå¡å¨ä¿¡æ¯åç¶æã\n\nå¯¹äºä¿®æ¹ç³»ç»éåä¸­çå¯¹è±¡æå¦ä¸éå¶ã\n\nå¨ system.indexes æå¥æ°æ®ï¼å¯ä»¥åå»ºç´¢å¼ãä½é¤æ­¤ä¹å¤è¯¥è¡¨ä¿¡æ¯æ¯ä¸å¯åç(ç¹æ®ç drop index å½ä»¤å°èªå¨æ´æ°ç¸å³ä¿¡æ¯)ãsystem.users æ¯å¯ä¿®æ¹çãsystem.profile æ¯å¯å é¤çã\n\n\n# mongodb æ°æ®ç±»å\n\næ°æ®ç±»å                 æè¿°\nstring               å­ç¬¦ä¸²ãå­å¨æ°æ®å¸¸ç¨çæ°æ®ç±»åãå¨ mongodb ä¸­ï¼utf-8 ç¼ç çå­ç¬¦ä¸²ææ¯åæ³çã\ninteger              æ´åæ°å¼ãç¨äºå­å¨æ°å¼ãæ ¹æ®ä½ æéç¨çæå¡å¨ï¼å¯åä¸º 32 ä½æ 64 ä½ã\nboolean              å¸å°å¼ãç¨äºå­å¨å¸å°å¼ï¼ç/åï¼ã\ndouble               åç²¾åº¦æµ®ç¹å¼ãç¨äºå­å¨æµ®ç¹å¼ã\nmin/max keys         å°ä¸ä¸ªå¼ä¸ bsonï¼äºè¿å¶ç jsonï¼åç´ çæä½å¼åæé«å¼ç¸å¯¹æ¯ã\narray                ç¨äºå°æ°ç»æåè¡¨æå¤ä¸ªå¼å­å¨ä¸ºä¸ä¸ªé®ã\ntimestamp            æ¶é´æ³ãè®°å½ææ¡£ä¿®æ¹ææ·»å çå·ä½æ¶é´ã\nobject               ç¨äºååµææ¡£ã\nnull                 ç¨äºåå»ºç©ºå¼ã\nsymbol               ç¬¦å·ãè¯¥æ°æ®ç±»ååºæ¬ä¸ç­åäºå­ç¬¦ä¸²ç±»åï¼ä½ä¸åçæ¯ï¼å®ä¸è¬ç¨äºéç¨ç¹æ®ç¬¦å·ç±»åçè¯­è¨ã\ndate                 æ¥ææ¶é´ãç¨ unix æ¶é´æ ¼å¼æ¥å­å¨å½åæ¥æææ¶é´ãä½ å¯ä»¥æå®èªå·±çæ¥ææ¶é´ï¼åå»º date å¯¹è±¡ï¼ä¼ å¥å¹´ææ¥ä¿¡æ¯ã\nobject id            å¯¹è±¡ idãç¨äºåå»ºææ¡£ç idã\nbinary data          äºè¿å¶æ°æ®ãç¨äºå­å¨äºè¿å¶æ°æ®ã\ncode                 ä»£ç ç±»åãç¨äºå¨ææ¡£ä¸­å­å¨ javascript ä»£ç ã\nregular expression   æ­£åè¡¨è¾¾å¼ç±»åãç¨äºå­å¨æ­£åè¡¨è¾¾å¼ã\n\n\n# mongodb crud\n\n\n# æ°æ®åºæä½\n\n# æ¥çæææ°æ®åº\n\nshow dbs\n\n\n# åå»ºæ°æ®åº\n\nuse <database>\n\n\nå¦ææ°æ®åºä¸å­å¨ï¼ååå»ºæ°æ®åºï¼å¦ååæ¢å°æå®æ°æ®åºã\n\nãç¤ºä¾ãåå»ºæ°æ®åºï¼å¹¶æå¥ä¸æ¡æ°æ®\n\nååå»ºçæ°æ®åº test å¹¶ä¸å¨æ°æ®åºçåè¡¨ä¸­ï¼ è¦æ¾ç¤ºå®ï¼éè¦æå¥ä¸äºæ°æ®\n\n> use test\nswitched to db test\n>\n> show dbs\nadmin   0.000gb\nconfig  0.000gb\nlocal   0.000gb\n> db.test.insert({"name":"mongodb"})\nwriteresult({ "ninserted" : 1 })\n> show dbs\nadmin   0.000gb\nconfig  0.000gb\nlocal   0.000gb\ntest    0.000gb\n\n\n# å é¤æ°æ®åº\n\nå é¤å½åæ°æ®åº\n\ndb.dropdatabase()\n\n\n\n# éåæä½\n\n# æ¥çéå\n\nshow collections\n\n\n# åå»ºéå\n\ndb.createcollection(name, options)\n\n\nåæ°è¯´æï¼\n\n * name: è¦åå»ºçéååç§°\n * options: å¯éåæ°, æå®æå³åå­å¤§å°åç´¢å¼çéé¡¹\n\noptions å¯ä»¥æ¯å¦ä¸åæ°ï¼\n\nå­æ®µ            ç±»å   æè¿°\ncapped        å¸å°   ï¼å¯éï¼å¦æä¸º trueï¼ååå»ºåºå®éåãåºå®éåæ¯ææçåºå®å¤§å°çéåï¼å½è¾¾å°æå¤§å¼æ¶ï¼å®ä¼èªå¨è¦çææ©çææ¡£ã\n                   å½è¯¥å¼ä¸º true æ¶ï¼å¿é¡»æå® size åæ°ã\nautoindexid   å¸å°   3.2 ä¹åä¸åæ¯æè¯¥åæ°ãï¼å¯éï¼å¦ä¸º trueï¼èªå¨å¨ _id å­æ®µåå»ºç´¢å¼ãé»è®¤ä¸º falseã\nsize          æ°å¼   ï¼å¯éï¼ä¸ºåºå®éåæå®ä¸ä¸ªæå¤§å¼ï¼å³å­èæ°ã å¦æ capped ä¸º trueï¼ä¹éè¦æå®è¯¥å­æ®µã\nmax           æ°å¼   ï¼å¯éï¼æå®åºå®éåä¸­åå«ææ¡£çæå¤§æ°éã\n\nå¨æå¥ææ¡£æ¶ï¼mongodb é¦åæ£æ¥åºå®éåç size å­æ®µï¼ç¶åæ£æ¥ max å­æ®µã\n\n> db.createcollection("collection")\n{ "ok" : 1 }\n> show collections\ncollection\n\n\n# å é¤éå\n\n> db.collection.drop()\ntrue\n> show collections\n>\n\n\n\n# æå¥ææ¡£æä½\n\nmongodb ä½¿ç¨ insert() æ¹æ³å®ææå¥æä½ã\n\nè¯­æ³æ ¼å¼\n\n# æå¥åæ¡è®°å½\ndb.<éå>.insertone(<json>)\n# æå¥å¤æ¡è®°å½\ndb.<éå>.insertmany([<json 1>, <json 2>, ..., <json n>])\n\n\nãç¤ºä¾ãinsertone\n\n> db.color.insertone({name: "red"})\n{\n        "acknowledged" : true,\n        "insertedid" : objectid("5f533ae4e8f16647950fdf43")\n}\n\n\nãç¤ºä¾ãinsertmany\n\n> db.color.insertmany([\n  {\n    "name": "yellow"\n  },\n  {\n    "name": "blue"\n  }\n])\n{\n        "acknowledged" : true,\n        "insertedids" : [\n                objectid("5f533bcae8f16647950fdf44"),\n                objectid("5f533bcae8f16647950fdf45")\n        ]\n}\n>\n\n\n\n# æ¥è¯¢ææ¡£æä½\n\nmongodb ä½¿ç¨ find() æ¹æ³å®ææ¥è¯¢ææ¡£æä½ã\n\nè¯­æ³æ ¼å¼\n\ndb.<éå>.find(<json>)\n\n\næ¥è¯¢æ¡ä»¶ä¹æ¯ json å½¢å¼ï¼å¦æä¸è®¾ç½®æ¥è¯¢æ¡ä»¶ï¼å³ä¸ºå¨éæ¥è¯¢ã\n\n# æ¥è¯¢æ¡ä»¶\n\næä½                      æ ¼å¼                                      èä¾                                         rdbms ä¸­çç±»ä¼¼è¯­å¥\nç­äº                      {<key>:<value>}                         db.book.find({"pagecount": {$eq: 0}})      where pagecount = 0\nä¸ç­äº                     {<key>:{$ne:<value>}}                   db.book.find({"pagecount": {$ne: 0}})      where likes != 50\nå¤§äº                      {<key>:{$gt:<value>}}                   db.book.find({"pagecount": {$gt: 0}})      where likes > 50\n{<key>:{$gt:<value>}}   db.book.find({"pagecount": {$gt: 0}})   where likes > 50                           å¤§äºæç­äº\nå°äº                      {<key>:{$lt:<value>}}                   db.book.find({"pagecount": {$lt: 200}})    where likes < 50\nå°äºæç­äº                   {<key>:{$lte:<value>}}                  db.book.find({"pagecount": {$lte: 200}})   where likes <= 50\n\n> è¯´æï¼\n> \n> $eq  --------  equal  =\n> $ne ----------- not equal  !=\n> $gt -------- greater than  >\n> $gte --------- gt equal  >=\n> $lt -------- less than  <\n> $lte --------- lt equal  <=\n\nãç¤ºä¾ã\n\n\n\n# ç»è®¡å¹éæ¥è¯¢æ¡ä»¶çè®°å½æ°\n> db.book.find({"status": "meap"}).count()\n68\n\n\n# æ¥è¯¢é»è¾æ¡ä»¶\n\nï¼1ï¼and æ¡ä»¶\n\nmongodb ç find() æ¹æ³å¯ä»¥ä¼ å¥å¤ä¸ªé®(key)ï¼æ¯ä¸ªé®(key)ä»¥éå·éå¼ï¼å³å¸¸è§ sql ç and æ¡ä»¶ã\n\nè¯­æ³æ ¼å¼å¦ä¸ï¼\n\n> db.col.find({key1:value1, key2:value2}).pretty()\n\n\nï¼2ï¼or æ¡ä»¶\n\nmongodb or æ¡ä»¶è¯­å¥ä½¿ç¨äºå³é®å­ $or,è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.col.find(\n   {\n      $or: [\n         {key1: value1}, {key2:value2}\n      ]\n   }\n).pretty()\n\n\n# æ¨¡ç³æ¥è¯¢\n\næ¥è¯¢ title åå«"æ"å­çææ¡£ï¼\n\ndb.col.find({ title: /æ/ })\n\n\næ¥è¯¢ title å­æ®µä»¥"æ"å­å¼å¤´çææ¡£ï¼\n\ndb.col.find({ title: /^æ/ })\n\n\næ¥è¯¢ titl e å­æ®µä»¥"æ"å­ç»å°¾çææ¡£ï¼\n\ndb.col.find({ title: /æ$/ })\n\n\n# limit() æ¹æ³\n\nå¦æä½ éè¦å¨ mongodb ä¸­è¯»åæå®æ°éçæ°æ®è®°å½ï¼å¯ä»¥ä½¿ç¨ mongodb ç limit æ¹æ³ï¼limit()æ¹æ³æ¥åä¸ä¸ªæ°å­åæ°ï¼è¯¥åæ°æå®ä» mongodb ä¸­è¯»åçè®°å½æ¡æ°ã\n\nlimit()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.collection_name.find().limit(number)\n\n\n# skip() æ¹æ³\n\næä»¬é¤äºå¯ä»¥ä½¿ç¨ limit()æ¹æ³æ¥è¯»åæå®æ°éçæ°æ®å¤ï¼è¿å¯ä»¥ä½¿ç¨ skip()æ¹æ³æ¥è·³è¿æå®æ°éçæ°æ®ï¼skip æ¹æ³åæ ·æ¥åä¸ä¸ªæ°å­åæ°ä½ä¸ºè·³è¿çè®°å½æ¡æ°ã\n\nskip() æ¹æ³èæ¬è¯­æ³æ ¼å¼å¦ä¸ï¼\n\n>db.collection_name.find().limit(number).skip(number)\n\n\n# sort() æ¹æ³\n\nå¨ mongodb ä¸­ä½¿ç¨ sort() æ¹æ³å¯¹æ°æ®è¿è¡æåºï¼sort() æ¹æ³å¯ä»¥éè¿åæ°æå®æåºçå­æ®µï¼å¹¶ä½¿ç¨ 1 å -1 æ¥æå®æåºçæ¹å¼ï¼å¶ä¸­ 1 ä¸ºååºæåï¼è -1 æ¯ç¨äºéåºæåã\n\nsort()æ¹æ³åºæ¬è¯­æ³å¦ä¸æç¤ºï¼\n\n>db.collection_name.find().sort({key:1})\n\n\n> æ³¨æï¼skip(), limilt(), sort()ä¸ä¸ªæ¾å¨ä¸èµ·æ§è¡çæ¶åï¼æ§è¡çé¡ºåºæ¯å sort(), ç¶åæ¯ skip()ï¼æåæ¯æ¾ç¤ºç limit()ã\n\n\n# æ´æ°ææ¡£æä½\n\nupdate() æ¹æ³ç¨äºæ´æ°å·²å­å¨çææ¡£ãè¯­æ³æ ¼å¼å¦ä¸ï¼\n\ndb.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeconcern: <document>\n   }\n)\n\n\nåæ°è¯´æï¼\n\n * query : update çæ¥è¯¢æ¡ä»¶ï¼ç±»ä¼¼ sql update æ¥è¯¢å where åé¢çã\n * update : update çå¯¹è±¡åä¸äºæ´æ°çæä½ç¬¦ï¼å¦$,$inc...ï¼ç­ï¼ä¹å¯ä»¥çè§£ä¸º sql update æ¥è¯¢å set åé¢ç\n * upsert : å¯éï¼è¿ä¸ªåæ°çæææ¯ï¼å¦æä¸å­å¨ update çè®°å½ï¼æ¯å¦æå¥ objnew,true ä¸ºæå¥ï¼é»è®¤æ¯ falseï¼ä¸æå¥ã\n * multi : å¯éï¼mongodb é»è®¤æ¯ false,åªæ´æ°æ¾å°çç¬¬ä¸æ¡è®°å½ï¼å¦æè¿ä¸ªåæ°ä¸º true,å°±æææ¡ä»¶æ¥åºæ¥å¤æ¡è®°å½å¨é¨æ´æ°ã\n * writeconcern :å¯éï¼æåºå¼å¸¸ççº§å«ã\n\nãç¤ºä¾ãæ´æ°ææ¡£\n\ndb.collection.update({ title: \'mongodb æç¨\' }, { $set: { title: \'mongodb\' } })\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ç¸åææ¡£\n\nä»¥ä¸è¯­å¥åªä¼ä¿®æ¹ç¬¬ä¸æ¡åç°çææ¡£ï¼å¦æä½ è¦ä¿®æ¹å¤æ¡ç¸åçææ¡£ï¼åéè¦è®¾ç½® multi åæ°ä¸º trueã\n\ndb.collection.update(\n  { title: \'mongodb æç¨\' },\n  { $set: { title: \'mongodb\' } },\n  { multi: true }\n)\n\n\nãç¤ºä¾ãæ´å¤å®ä¾\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update({ count: { $gt: 1 } }, { $set: { test2: \'ok\' } })\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 3 } },\n  { $set: { test2: \'ok\' } },\n  false,\n  true\n)\n\n\nåªæ·»å ç¬¬ä¸æ¡ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ·»å è¿å»:\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\nå¨é¨æ´æ°ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\nåªæ´æ°ç¬¬ä¸æ¡è®°å½ï¼\n\ndb.collection.update(\n  { count: { $gt: 4 } },\n  { $set: { test5: \'ok\' } },\n  true,\n  false\n)\n\n\n\n# å é¤ææ¡£æä½\n\nå®æ¹æ¨èä½¿ç¨ deleteone() å deletemany() æ¹æ³å é¤æ°æ®ã\n\nå é¤ status ç­äº a çå¨é¨ææ¡£ï¼\n\ndb.collection.deletemany({ status: \'a\' })\n\n\nå é¤ status ç­äº d çä¸ä¸ªææ¡£ï¼\n\ndb.collection.deleteone({ status: \'d\' })\n\n\n\n# ç´¢å¼æä½\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçï¼å¦ææ²¡æç´¢å¼ï¼mongodb å¨è¯»åæ°æ®æ¶å¿é¡»æ«æéåä¸­çæ¯ä¸ªæä»¶å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æçæ¯éå¸¸ä½çï¼ç¹å«å¨å¤çå¤§éçæ°æ®æ¶ï¼æ¥è¯¢å¯ä»¥è¦è±è´¹å åç§çè³å åéï¼è¿å¯¹ç½ç«çæ§è½æ¯éå¸¸è´å½çã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\nmongodb ä½¿ç¨ createindex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateindex()æ¹æ³åºæ¬è¯­æ³æ ¼å¼å¦ä¸æç¤ºï¼\n\n>db.collection.createindex(keys, options)\n\n\nè¯­æ³ä¸­ key å¼ä¸ºä½ è¦åå»ºçç´¢å¼å­æ®µï¼1 ä¸ºæå®æååºåå»ºç´¢å¼ï¼å¦æä½ æ³æéåºæ¥åå»ºç´¢å¼æå®ä¸º -1 å³å¯ã\n\n>db.col.createindex({"title":1})\n\n\ncreateindex() æ¹æ³ä¸­ä½ ä¹å¯ä»¥è®¾ç½®ä½¿ç¨å¤ä¸ªå­æ®µåå»ºç´¢å¼ï¼å³ç³»åæ°æ®åºä¸­ç§°ä½å¤åç´¢å¼ï¼ã\n\n>db.col.createindex({"title":1,"description":-1})\n\n\ncreateindex() æ¥æ¶å¯éåæ°ï¼å¯éåæ°åè¡¨å¦ä¸ï¼\n\nparameter            type            description\nbackground           boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼mongodb çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropdups             boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º falseã\nsparse               boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireafterseconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ ttl è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\n\n# mongodb èåæä½\n\nmongodb ä¸­èå(aggregate)ä¸»è¦ç¨äºå¤çæ°æ®(è¯¸å¦ç»è®¡å¹³åå¼,æ±åç­)ï¼å¹¶è¿åè®¡ç®åçæ°æ®ç»æãæç¹ç±»ä¼¼ sql è¯­å¥ä¸­ç count(*)ã\n\n\n# ç®¡é\n\næ´ä¸ªèåè¿ç®è¿ç¨ç§°ä¸ºç®¡éï¼å®æ¯ç±å¤ä¸ªæ­¥éª¤ç»æï¼æ¯ä¸ªç®¡é\n\n * æ¥åä¸ç³»åææ¡£ï¼åå§æ°æ®ï¼ï¼\n * æ¯ä¸ªæ­¥éª¤å¯¹è¿äºææ¡£è¿è¡ä¸ç³»åè¿ç®ï¼\n * ç»æææ¡£è¾åºç»ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nèåæä½çåºæ¬æ ¼å¼\n\npipeline = [$stage1, $stage1, ..., $stagen];\n\ndb.<éå>.aggregate(pipeline, {options});\n\n\n\n# èåæ­¥éª¤\n\næ­¥éª¤                 ä½ç¨     sql ç­ä»·è¿ç®ç¬¦\n$match             è¿æ»¤     where\n$project           æå½±     as\n$sort              æåº     order by\n$group             åç»     group by\n$skip / $limit     ç»æéå¶   skip / limit\n$lookup            å·¦å¤è¿æ¥   left outer join\n$unwind            å±å¼æ°ç»   n/a\n$graphlookup       å¾æç´¢    n/a\n$facet / $bucket   åé¢æç´¢   n/a\n\nãç¤ºä¾ã\n\n> db.collection.insertmany([{"title":"mongodb overview","description":"mongodb is no sql database","by_user":"collection","tagsr":["mongodb","database","nosql"],"likes":"100"},{"title":"nosql overview","description":"no sql database is very fast","by_user":"collection","tagsr":["mongodb","database","nosql"],"likes":"10"},{"title":"neo4j overview","description":"neo4j is no sql database","by_user":"neo4j","tagsr":["neo4j","database","nosql"],"likes":"750"}])\n> db.collection.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : 1}}}])\n{ "_id" : null, "num_tutorial" : 3 }\n{ "_id" : "neo4j", "num_tutorial" : 1 }\n{ "_id" : "collection", "num_tutorial" : 2 }\n\n\nä¸è¡¨å±ç¤ºäºä¸äºèåçè¡¨è¾¾å¼:\n\nè¡¨è¾¾å¼         æè¿°                        å®ä¾\n$sum        è®¡ç®æ»åã                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$sum : "$likes"}}}])\n$avg        è®¡ç®å¹³åå¼                     db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$avg : "$likes"}}}])\n$min        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå°å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$min : "$likes"}}}])\n$max        è·åéåä¸­ææææ¡£å¯¹åºå¼å¾æå¤§å¼ã         db.mycol.aggregate([{$group : {_id : "$by_user",\n                                      num_tutorial : {$max : "$likes"}}}])\n$push       å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ã          db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$push: "$url"}}}])\n$addtoset   å¨ç»æææ¡£ä¸­æå¥å¼å°ä¸ä¸ªæ°ç»ä¸­ï¼ä½ä¸åå»ºå¯æ¬ã   db.mycol.aggregate([{$group : {_id : "$by_user", url :\n                                      {$addtoset : "$url"}}}])\n$first      æ ¹æ®èµæºææ¡£çæåºè·åç¬¬ä¸ä¸ªææ¡£æ°æ®ã       db.mycol.aggregate([{$group : {_id : "$by_user", first_url :\n                                      {$first : "$url"}}}])\n$last       æ ¹æ®èµæºææ¡£çæåºè·åæåä¸ä¸ªææ¡£æ°æ®       db.mycol.aggregate([{$group : {_id : "$by_user", last_url :\n                                      {$last : "$url"}}}])\n\n\n# åèèµæ\n\n * mongodb å®ç½\n * mongodb github\n * mongodb æç¨',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB ç CRUD æä½",frontmatter:{title:"MongoDB ç CRUD æä½",date:"2020-09-25T21:23:41.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],permalink:"/pages/d69d64/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/02.MongoDB%E7%9A%84CRUD%E6%93%8D%E4%BD%9C.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/02.MongoDBçCRUDæä½.md",key:"v-5f0cd72e",path:"/pages/d69d64/",headers:[{level:2,title:"ä¸ãåºæ¬ CRUD æä½",slug:"ä¸ãåºæ¬-crud-æä½",normalizedTitle:"ä¸ãåºæ¬ crud æä½",charIndex:24},{level:3,title:"Create æä½",slug:"create-æä½",normalizedTitle:"create æä½",charIndex:79},{level:3,title:"Read æä½",slug:"read-æä½",normalizedTitle:"read æä½",charIndex:988},{level:3,title:"Update æä½",slug:"update-æä½",normalizedTitle:"update æä½",charIndex:1051},{level:3,title:"Delete æä½",slug:"delete-æä½",normalizedTitle:"delete æä½",charIndex:3224},{level:2,title:"äºãæ¹éåæä½",slug:"äºãæ¹éåæä½",normalizedTitle:"äºãæ¹éåæä½",charIndex:3414},{level:3,title:"æåºåæ åºçæä½",slug:"æåºåæ åºçæä½",normalizedTitle:"æåºåæ åºçæä½",charIndex:3533},{level:3,title:"bulkWrite() æ¹æ³",slug:"bulkwrite-æ¹æ³",normalizedTitle:"bulkwrite() æ¹æ³",charIndex:3448},{level:3,title:"æ¹éåæä½ç­ç¥",slug:"æ¹éåæä½ç­ç¥",normalizedTitle:"æ¹éåæä½ç­ç¥",charIndex:4681},{level:4,title:"é¢æå collection",slug:"é¢æå-collection",normalizedTitle:"é¢æå collection",charIndex:4746},{level:4,title:"æ åºåæä½",slug:"æ åºåæä½",normalizedTitle:"æ åºåæä½",charIndex:3784},{level:4,title:"é¿ååè°èæµ",slug:"é¿ååè°èæµ",normalizedTitle:"é¿ååè°èæµ",charIndex:5024},{level:2,title:"SQL å MongoDB å¯¹æ¯",slug:"sql-å-mongodb-å¯¹æ¯",normalizedTitle:"sql å mongodb å¯¹æ¯",charIndex:5264},{level:3,title:"æ¯è¯­åæ¦å¿µ",slug:"æ¯è¯­åæ¦å¿µ",normalizedTitle:"æ¯è¯­åæ¦å¿µ",charIndex:5285},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:6123}],headersStr:"ä¸ãåºæ¬ CRUD æä½ Create æä½ Read æä½ Update æä½ Delete æä½ äºãæ¹éåæä½ æåºåæ åºçæä½ bulkWrite() æ¹æ³ æ¹éåæä½ç­ç¥ é¢æå collection æ åºåæä½ é¿ååè°èæµ SQL å MongoDB å¯¹æ¯ æ¯è¯­åæ¦å¿µ åèèµæ",content:"# MongoDB ç CRUD æä½\n\n\n# ä¸ãåºæ¬ CRUD æä½\n\nMongoDB ç CRUD æä½æ¯éå¯¹ document çè¯»åæä½ã\n\n\n# Create æä½\n\nMongoDB æä¾ä»¥ä¸æä½åä¸ä¸ª collection æå¥ document\n\n * db.collection.insertOne()ï¼æå¥ä¸æ¡ document\n * db.collection.insertMany()ï¼æå¥å¤æ¡ document\n\n> æ³¨ï¼ä»¥ä¸æä½é½æ¯åå­æä½ã\n\n\n\næå¥æä½çç¹æ§ï¼\n\n * MongoDB ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * å¦æè¦æå¥ç collection å½åä¸å­å¨ï¼åæå¥æä½ä¼èªå¨åå»º collectionã\n * å¨ MongoDB ä¸­ï¼å­å¨å¨éåä¸­çæ¯ä¸ªææ¡£é½éè¦ä¸ä¸ªå¯ä¸ç _id å­æ®µä½ä¸ºä¸»é®ãå¦ææå¥çææ¡£çç¥ _id å­æ®µï¼å MongoDB é©±å¨ç¨åºä¼èªå¨ä¸º _id å­æ®µçæ ObjectIdã\n * å¯ä»¥ MongoDB åå¥æä½çç¡®è®¤çº§å«æ¥æ§å¶åå¥è¡ä¸ºã\n\nãç¤ºä¾ãæå¥ä¸æ¡ document ç¤ºä¾\n\ndb.inventory.insertOne({\n  item: 'canvas',\n  qty: 100,\n  tags: ['cotton'],\n  size: { h: 28, w: 35.5, uom: 'cm' },\n})\n\n\nãç¤ºä¾ãæå¥å¤æ¡ document ç¤ºä¾\n\ndb.inventory.insertMany([\n  {\n    item: 'journal',\n    qty: 25,\n    tags: ['blank', 'red'],\n    size: { h: 14, w: 21, uom: 'cm' },\n  },\n  {\n    item: 'mat',\n    qty: 85,\n    tags: ['gray'],\n    size: { h: 27.9, w: 35.5, uom: 'cm' },\n  },\n  {\n    item: 'mousepad',\n    qty: 25,\n    tags: ['gel', 'blue'],\n    size: { h: 19, w: 22.85, uom: 'cm' },\n  },\n])\n\n\n\n# Read æä½\n\nMongoDB æä¾ db.collection.find() æ¹æ³æ¥æ£ç´¢ documentã\n\n\n\n\n# Update æä½\n\nMongoDB æä¾ä»¥ä¸æä½æ¥æ´æ° collection ä¸­ç document\n\n * db.collection.updateOne()ï¼æ´æ°ä¸æ¡ document\n * db.collection.updateMany()ï¼æ´æ°å¤æ¡ document\n * db.collection.replaceOne()ï¼æ¿æ¢ä¸æ¡ document\n\nè¯­æ³æ ¼å¼ï¼\n\n * db.collection.updateOne(<filter>, <update>, <options>)\n * db.collection.updateMany(<filter>, <update>, <options>)\n * db.collection.replaceOne(<filter>, <update>, <options>)\n\n\n\nãç¤ºä¾ãæå¥æµè¯æ°æ®\n\ndb.inventory.insertMany([\n  {\n    item: 'canvas',\n    qty: 100,\n    size: { h: 28, w: 35.5, uom: 'cm' },\n    status: 'A',\n  },\n  { item: 'journal', qty: 25, size: { h: 14, w: 21, uom: 'cm' }, status: 'A' },\n  { item: 'mat', qty: 85, size: { h: 27.9, w: 35.5, uom: 'cm' }, status: 'A' },\n  {\n    item: 'mousepad',\n    qty: 25,\n    size: { h: 19, w: 22.85, uom: 'cm' },\n    status: 'P',\n  },\n  {\n    item: 'notebook',\n    qty: 50,\n    size: { h: 8.5, w: 11, uom: 'in' },\n    status: 'P',\n  },\n  { item: 'paper', qty: 100, size: { h: 8.5, w: 11, uom: 'in' }, status: 'D' },\n  {\n    item: 'planner',\n    qty: 75,\n    size: { h: 22.85, w: 30, uom: 'cm' },\n    status: 'D',\n  },\n  {\n    item: 'postcard',\n    qty: 45,\n    size: { h: 10, w: 15.25, uom: 'cm' },\n    status: 'A',\n  },\n  {\n    item: 'sketchbook',\n    qty: 80,\n    size: { h: 14, w: 21, uom: 'cm' },\n    status: 'A',\n  },\n  {\n    item: 'sketch pad',\n    qty: 95,\n    size: { h: 22.85, w: 30.5, uom: 'cm' },\n    status: 'A',\n  },\n])\n\n\nãç¤ºä¾ãæ´æ°ä¸æ¡ document\n\ndb.inventory.updateOne(\n  { item: 'paper' },\n  {\n    $set: { 'size.uom': 'cm', status: 'P' },\n    $currentDate: { lastModified: true },\n  }\n)\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ document\n\ndb.inventory.updateMany(\n  { qty: { $lt: 50 } },\n  {\n    $set: { 'size.uom': 'in', status: 'P' },\n    $currentDate: { lastModified: true },\n  }\n)\n\n\nãç¤ºä¾ãæ¿æ¢ä¸æ¡ document\n\ndb.inventory.replaceOne(\n  { item: 'paper' },\n  {\n    item: 'paper',\n    instock: [\n      { warehouse: 'A', qty: 60 },\n      { warehouse: 'B', qty: 40 },\n    ],\n  }\n)\n\n\næ´æ°æä½çç¹æ§ï¼\n\n * MongoDB ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * ä¸æ¦è®¾ç½®äºï¼å°±æ æ³æ´æ°ææ¿æ¢ _id å­æ®µã\n * é¤ä»¥ä¸æåµå¤ï¼MongoDB ä¼å¨æ§è¡åæä½åä¿çææ¡£å­æ®µçé¡ºåºï¼\n   * _id å­æ®µå§ç»æ¯ææ¡£ä¸­çç¬¬ä¸ä¸ªå­æ®µã\n   * åæ¬éå½åå­æ®µåç§°çæ´æ°å¯è½å¯¼è´ææ¡£ä¸­å­æ®µçéæ°æåºã\n * å¦ææ´æ°æä½ä¸­åå« upsert : true å¹¶ä¸æ²¡æ document å¹éè¿æ»¤å¨ï¼MongoDB ä¼æ°æå¥ä¸ä¸ª documentï¼å¦ææå¹éç documentï¼MongoDB ä¼ä¿®æ¹ææ¿æ¢è¿äº documentã\n\n\n# Delete æä½\n\nMongoDB æä¾ä»¥ä¸æä½æ¥å é¤ collection ä¸­ç document\n\n * db.collection.deleteOne()ï¼å é¤ä¸æ¡ document\n * db.collection.deleteMany()ï¼å é¤å¤æ¡ document\n\n\n\nå é¤æä½çç¹æ§ï¼\n\n * MongoDB ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n\n\n# äºãæ¹éåæä½\n\nMongoDB éè¿ db.collection.bulkWrite() æ¹æ³æ¥æ¯ææ¹éåæä½ï¼åæ¬æ¹éæå¥ãæ´æ°ãå é¤ï¼ã\n\næ­¤å¤ï¼db.collection.insertMany() æ¹æ³æ¯ææ¹éæå¥æä½ã\n\n\n# æåºåæ åºçæä½\n\næ¹éåæä½å¯ä»¥æåºææ åºã\n\n * å¯¹äºæåºåè¡¨ï¼MongoDB ä¸²è¡æ§è¡æä½ãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼MongoDB å°ä¸å¤çåè¡¨ä¸­å©ä½çåæä½ã\n * å¯¹äºæ åºåè¡¨ï¼MongoDB å¯ä»¥å¹¶è¡æ§è¡æä½ï¼ä½æ¯ä¸è½ä¿è¯æ­¤è¡ä¸ºãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼MongoDB å°ç»§ç»­å¤çåè¡¨ä¸­å©ä½çåæä½ã\n\nå¨åçéåä¸æ§è¡æä½çæåºåè¡¨éå¸¸æ¯æ§è¡æ åºåè¡¨è¦æ¢ï¼å ä¸ºå¯¹äºæåºåè¡¨ï¼æ¯ä¸ªæä½å¿é¡»ç­å¾ä¸ä¸ä¸ªæä½å®æã\n\né»è®¤æåµä¸ï¼bulkWrite() æ§è¡æåºæä½ãè¦æå®æ åºåæä½ï¼è¯·å¨éé¡¹ææ¡£ä¸­è®¾ç½® ordered : falseã\n\n\n# bulkWrite() æ¹æ³\n\nbulkWrite() æ¯æä»¥ä¸åæä½ï¼\n\n * insertOne\n * updateOne\n * updateMany\n * replaceOne\n * deleteOne\n * deleteMany\n\nãç¤ºä¾ãæ¹éåæä½ç¤ºä¾\n\ntry {\n  db.characters.bulkWrite([\n    {\n      insertOne: {\n        document: {\n          _id: 4,\n          char: 'Dithras',\n          class: 'barbarian',\n          lvl: 4,\n        },\n      },\n    },\n    {\n      insertOne: {\n        document: {\n          _id: 5,\n          char: 'Taeln',\n          class: 'fighter',\n          lvl: 3,\n        },\n      },\n    },\n    {\n      updateOne: {\n        filter: { char: 'Eldon' },\n        update: { $set: { status: 'Critical Injury' } },\n      },\n    },\n    { deleteOne: { filter: { char: 'Brisbane' } } },\n    {\n      replaceOne: {\n        filter: { char: 'Meldane' },\n        replacement: { char: 'Tanys', class: 'oracle', lvl: 4 },\n      },\n    },\n  ])\n} catch (e) {\n  print(e)\n}\n\n\n\n# æ¹éåæä½ç­ç¥\n\nå¤§éçæå¥æä½ï¼åæ¬åå§æ°æ®æå¥æå¸¸è§æ°æ®å¯¼å¥ï¼å¯è½ä¼å½±ååçéç¾¤çæ§è½ãå¯¹äºæ¹éæå¥ï¼è¯·èèä»¥ä¸ç­ç¥ï¼\n\n# é¢æå collection\n\nå¦æåçéåä¸ºç©ºï¼åè¯¥éååªæä¸ä¸ªåå§ chunkï¼è¯¥ chunk ä½äºåä¸ªåçä¸ãç¶åï¼MongoDB å¿é¡»è±ä¸äºæ¶é´æ¥æ¥æ¶æ°æ®ï¼åå»ºæåå¹¶å°æåçåååå°å¯ç¨çåçãä¸ºäºé¿åè¿ç§æ§è½ææ¬ï¼æ¨å¯ä»¥æç§æåç¾¤éä¸­çæååä¸­çè¯´æé¢æå collectionã\n\n# æ åºåæä½\n\nè¦æé«å¯¹åçéç¾¤çåå¥æ§è½ï¼è¯·ä½¿ç¨ bulkWrite()ï¼å¹¶å°å¯éåæ°é¡ºåºè®¾ç½®ä¸º falseãmongos å¯ä»¥å°è¯åæ¶å°åå¥æä½åéå°å¤ä¸ªåçãå¯¹äºç©ºéåï¼é¦åæç§åçç¾¤éä¸­çåå² chunk ä¸­çè¯´æé¢æå collectionã\n\n# é¿ååè°èæµ\n\nå¦æå¨ä¸æ¬¡æå¥æä½ä¸­ï¼åç key åè°éå¢ï¼é£ä¹ææçæå¥æ°æ®é½ä¼å­å¥ collection çæåä¸ä¸ª chunkï¼ä¹å°±æ¯å­å¥ä¸ä¸ªåçä¸­ãå æ­¤ï¼éç¾¤çæå¥å®¹éå°æ°¸è¿ä¸ä¼è¶è¿è¯¥åä¸ªåççæå¥å®¹éã\n\nå¦ææå¥éå¤§äºåä¸ªåçå¯ä»¥å¤ççæå¥éï¼å¹¶ä¸æ æ³é¿ååè°éå¢çåçé®ï¼é£ä¹è¯·èèå¯¹åºç¨ç¨åºè¿è¡ä»¥ä¸ä¿®æ¹ï¼\n\n * åè½¬åçå¯é¥çäºè¿å¶ä½ãè¿æ ·å¯ä»¥ä¿çä¿¡æ¯ï¼å¹¶é¿åå°æå¥é¡ºåºä¸å¼åºåçå¢å å³èèµ·æ¥ã\n * äº¤æ¢ç¬¬ä¸ä¸ªåæåä¸ä¸ª 16 ä½å­ä»¥âéæºâæå¥ã\n\n\n# SQL å MongoDB å¯¹æ¯\n\n\n# æ¯è¯­åæ¦å¿µ\n\nSQL æ¯è¯­åæ¦å¿µ                     MONGODB æ¯è¯­åæ¦å¿µ\ndatabase                      database\ntable                         collection\nrow                           document æ BSON\ncolumn                        field\nindex                         index\ntable joins                   $lookupãåµå¥å¼ææ¡£\nprimary key                   primary key\n                              MongoDB ä¸­èªå¨è®¾ç½®ä¸»é®ä¸º _id å­æ®µ\naggregation (e.g. group by)   aggregation pipeline\n                              åè SQL to Aggregation Mapping Chart.\nSELECT INTO NEW_TABLE         $out\n                              åè SQL to Aggregation Mapping Chart\nMERGE INTO TABLE              $merge (MongoDB 4.2 å¼å§æ¯æ)\n                              åè SQL to Aggregation Mapping Chart.\nUNION ALL                     $unionWith (MongoDB 4.4 å¼å§æ¯æ)\ntransactions                  transactions\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb ç crud æä½\n\n\n# ä¸ãåºæ¬ crud æä½\n\nmongodb ç crud æä½æ¯éå¯¹ document çè¯»åæä½ã\n\n\n# create æä½\n\nmongodb æä¾ä»¥ä¸æä½åä¸ä¸ª collection æå¥ document\n\n * db.collection.insertone()ï¼æå¥ä¸æ¡ document\n * db.collection.insertmany()ï¼æå¥å¤æ¡ document\n\n> æ³¨ï¼ä»¥ä¸æä½é½æ¯åå­æä½ã\n\n\n\næå¥æä½çç¹æ§ï¼\n\n * mongodb ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * å¦æè¦æå¥ç collection å½åä¸å­å¨ï¼åæå¥æä½ä¼èªå¨åå»º collectionã\n * å¨ mongodb ä¸­ï¼å­å¨å¨éåä¸­çæ¯ä¸ªææ¡£é½éè¦ä¸ä¸ªå¯ä¸ç _id å­æ®µä½ä¸ºä¸»é®ãå¦ææå¥çææ¡£çç¥ _id å­æ®µï¼å mongodb é©±å¨ç¨åºä¼èªå¨ä¸º _id å­æ®µçæ objectidã\n * å¯ä»¥ mongodb åå¥æä½çç¡®è®¤çº§å«æ¥æ§å¶åå¥è¡ä¸ºã\n\nãç¤ºä¾ãæå¥ä¸æ¡ document ç¤ºä¾\n\ndb.inventory.insertone({\n  item: 'canvas',\n  qty: 100,\n  tags: ['cotton'],\n  size: { h: 28, w: 35.5, uom: 'cm' },\n})\n\n\nãç¤ºä¾ãæå¥å¤æ¡ document ç¤ºä¾\n\ndb.inventory.insertmany([\n  {\n    item: 'journal',\n    qty: 25,\n    tags: ['blank', 'red'],\n    size: { h: 14, w: 21, uom: 'cm' },\n  },\n  {\n    item: 'mat',\n    qty: 85,\n    tags: ['gray'],\n    size: { h: 27.9, w: 35.5, uom: 'cm' },\n  },\n  {\n    item: 'mousepad',\n    qty: 25,\n    tags: ['gel', 'blue'],\n    size: { h: 19, w: 22.85, uom: 'cm' },\n  },\n])\n\n\n\n# read æä½\n\nmongodb æä¾ db.collection.find() æ¹æ³æ¥æ£ç´¢ documentã\n\n\n\n\n# update æä½\n\nmongodb æä¾ä»¥ä¸æä½æ¥æ´æ° collection ä¸­ç document\n\n * db.collection.updateone()ï¼æ´æ°ä¸æ¡ document\n * db.collection.updatemany()ï¼æ´æ°å¤æ¡ document\n * db.collection.replaceone()ï¼æ¿æ¢ä¸æ¡ document\n\nè¯­æ³æ ¼å¼ï¼\n\n * db.collection.updateone(<filter>, <update>, <options>)\n * db.collection.updatemany(<filter>, <update>, <options>)\n * db.collection.replaceone(<filter>, <update>, <options>)\n\n\n\nãç¤ºä¾ãæå¥æµè¯æ°æ®\n\ndb.inventory.insertmany([\n  {\n    item: 'canvas',\n    qty: 100,\n    size: { h: 28, w: 35.5, uom: 'cm' },\n    status: 'a',\n  },\n  { item: 'journal', qty: 25, size: { h: 14, w: 21, uom: 'cm' }, status: 'a' },\n  { item: 'mat', qty: 85, size: { h: 27.9, w: 35.5, uom: 'cm' }, status: 'a' },\n  {\n    item: 'mousepad',\n    qty: 25,\n    size: { h: 19, w: 22.85, uom: 'cm' },\n    status: 'p',\n  },\n  {\n    item: 'notebook',\n    qty: 50,\n    size: { h: 8.5, w: 11, uom: 'in' },\n    status: 'p',\n  },\n  { item: 'paper', qty: 100, size: { h: 8.5, w: 11, uom: 'in' }, status: 'd' },\n  {\n    item: 'planner',\n    qty: 75,\n    size: { h: 22.85, w: 30, uom: 'cm' },\n    status: 'd',\n  },\n  {\n    item: 'postcard',\n    qty: 45,\n    size: { h: 10, w: 15.25, uom: 'cm' },\n    status: 'a',\n  },\n  {\n    item: 'sketchbook',\n    qty: 80,\n    size: { h: 14, w: 21, uom: 'cm' },\n    status: 'a',\n  },\n  {\n    item: 'sketch pad',\n    qty: 95,\n    size: { h: 22.85, w: 30.5, uom: 'cm' },\n    status: 'a',\n  },\n])\n\n\nãç¤ºä¾ãæ´æ°ä¸æ¡ document\n\ndb.inventory.updateone(\n  { item: 'paper' },\n  {\n    $set: { 'size.uom': 'cm', status: 'p' },\n    $currentdate: { lastmodified: true },\n  }\n)\n\n\nãç¤ºä¾ãæ´æ°å¤æ¡ document\n\ndb.inventory.updatemany(\n  { qty: { $lt: 50 } },\n  {\n    $set: { 'size.uom': 'in', status: 'p' },\n    $currentdate: { lastmodified: true },\n  }\n)\n\n\nãç¤ºä¾ãæ¿æ¢ä¸æ¡ document\n\ndb.inventory.replaceone(\n  { item: 'paper' },\n  {\n    item: 'paper',\n    instock: [\n      { warehouse: 'a', qty: 60 },\n      { warehouse: 'b', qty: 40 },\n    ],\n  }\n)\n\n\næ´æ°æä½çç¹æ§ï¼\n\n * mongodb ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n * ä¸æ¦è®¾ç½®äºï¼å°±æ æ³æ´æ°ææ¿æ¢ _id å­æ®µã\n * é¤ä»¥ä¸æåµå¤ï¼mongodb ä¼å¨æ§è¡åæä½åä¿çææ¡£å­æ®µçé¡ºåºï¼\n   * _id å­æ®µå§ç»æ¯ææ¡£ä¸­çç¬¬ä¸ä¸ªå­æ®µã\n   * åæ¬éå½åå­æ®µåç§°çæ´æ°å¯è½å¯¼è´ææ¡£ä¸­å­æ®µçéæ°æåºã\n * å¦ææ´æ°æä½ä¸­åå« upsert : true å¹¶ä¸æ²¡æ document å¹éè¿æ»¤å¨ï¼mongodb ä¼æ°æå¥ä¸ä¸ª documentï¼å¦ææå¹éç documentï¼mongodb ä¼ä¿®æ¹ææ¿æ¢è¿äº documentã\n\n\n# delete æä½\n\nmongodb æä¾ä»¥ä¸æä½æ¥å é¤ collection ä¸­ç document\n\n * db.collection.deleteone()ï¼å é¤ä¸æ¡ document\n * db.collection.deletemany()ï¼å é¤å¤æ¡ document\n\n\n\nå é¤æä½çç¹æ§ï¼\n\n * mongodb ä¸­çææåæä½é½æ¯åä¸ªææ¡£çº§å«çåå­æä½ã\n\n\n# äºãæ¹éåæä½\n\nmongodb éè¿ db.collection.bulkwrite() æ¹æ³æ¥æ¯ææ¹éåæä½ï¼åæ¬æ¹éæå¥ãæ´æ°ãå é¤ï¼ã\n\næ­¤å¤ï¼db.collection.insertmany() æ¹æ³æ¯ææ¹éæå¥æä½ã\n\n\n# æåºåæ åºçæä½\n\næ¹éåæä½å¯ä»¥æåºææ åºã\n\n * å¯¹äºæåºåè¡¨ï¼mongodb ä¸²è¡æ§è¡æä½ãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼mongodb å°ä¸å¤çåè¡¨ä¸­å©ä½çåæä½ã\n * å¯¹äºæ åºåè¡¨ï¼mongodb å¯ä»¥å¹¶è¡æ§è¡æä½ï¼ä½æ¯ä¸è½ä¿è¯æ­¤è¡ä¸ºãå¦æå¨åæä½çå¤çè¿ç¨ä¸­åçéè¯¯ï¼mongodb å°ç»§ç»­å¤çåè¡¨ä¸­å©ä½çåæä½ã\n\nå¨åçéåä¸æ§è¡æä½çæåºåè¡¨éå¸¸æ¯æ§è¡æ åºåè¡¨è¦æ¢ï¼å ä¸ºå¯¹äºæåºåè¡¨ï¼æ¯ä¸ªæä½å¿é¡»ç­å¾ä¸ä¸ä¸ªæä½å®æã\n\né»è®¤æåµä¸ï¼bulkwrite() æ§è¡æåºæä½ãè¦æå®æ åºåæä½ï¼è¯·å¨éé¡¹ææ¡£ä¸­è®¾ç½® ordered : falseã\n\n\n# bulkwrite() æ¹æ³\n\nbulkwrite() æ¯æä»¥ä¸åæä½ï¼\n\n * insertone\n * updateone\n * updatemany\n * replaceone\n * deleteone\n * deletemany\n\nãç¤ºä¾ãæ¹éåæä½ç¤ºä¾\n\ntry {\n  db.characters.bulkwrite([\n    {\n      insertone: {\n        document: {\n          _id: 4,\n          char: 'dithras',\n          class: 'barbarian',\n          lvl: 4,\n        },\n      },\n    },\n    {\n      insertone: {\n        document: {\n          _id: 5,\n          char: 'taeln',\n          class: 'fighter',\n          lvl: 3,\n        },\n      },\n    },\n    {\n      updateone: {\n        filter: { char: 'eldon' },\n        update: { $set: { status: 'critical injury' } },\n      },\n    },\n    { deleteone: { filter: { char: 'brisbane' } } },\n    {\n      replaceone: {\n        filter: { char: 'meldane' },\n        replacement: { char: 'tanys', class: 'oracle', lvl: 4 },\n      },\n    },\n  ])\n} catch (e) {\n  print(e)\n}\n\n\n\n# æ¹éåæä½ç­ç¥\n\nå¤§éçæå¥æä½ï¼åæ¬åå§æ°æ®æå¥æå¸¸è§æ°æ®å¯¼å¥ï¼å¯è½ä¼å½±ååçéç¾¤çæ§è½ãå¯¹äºæ¹éæå¥ï¼è¯·èèä»¥ä¸ç­ç¥ï¼\n\n# é¢æå collection\n\nå¦æåçéåä¸ºç©ºï¼åè¯¥éååªæä¸ä¸ªåå§ chunkï¼è¯¥ chunk ä½äºåä¸ªåçä¸ãç¶åï¼mongodb å¿é¡»è±ä¸äºæ¶é´æ¥æ¥æ¶æ°æ®ï¼åå»ºæåå¹¶å°æåçåååå°å¯ç¨çåçãä¸ºäºé¿åè¿ç§æ§è½ææ¬ï¼æ¨å¯ä»¥æç§æåç¾¤éä¸­çæååä¸­çè¯´æé¢æå collectionã\n\n# æ åºåæä½\n\nè¦æé«å¯¹åçéç¾¤çåå¥æ§è½ï¼è¯·ä½¿ç¨ bulkwrite()ï¼å¹¶å°å¯éåæ°é¡ºåºè®¾ç½®ä¸º falseãmongos å¯ä»¥å°è¯åæ¶å°åå¥æä½åéå°å¤ä¸ªåçãå¯¹äºç©ºéåï¼é¦åæç§åçç¾¤éä¸­çåå² chunk ä¸­çè¯´æé¢æå collectionã\n\n# é¿ååè°èæµ\n\nå¦æå¨ä¸æ¬¡æå¥æä½ä¸­ï¼åç key åè°éå¢ï¼é£ä¹ææçæå¥æ°æ®é½ä¼å­å¥ collection çæåä¸ä¸ª chunkï¼ä¹å°±æ¯å­å¥ä¸ä¸ªåçä¸­ãå æ­¤ï¼éç¾¤çæå¥å®¹éå°æ°¸è¿ä¸ä¼è¶è¿è¯¥åä¸ªåççæå¥å®¹éã\n\nå¦ææå¥éå¤§äºåä¸ªåçå¯ä»¥å¤ççæå¥éï¼å¹¶ä¸æ æ³é¿ååè°éå¢çåçé®ï¼é£ä¹è¯·èèå¯¹åºç¨ç¨åºè¿è¡ä»¥ä¸ä¿®æ¹ï¼\n\n * åè½¬åçå¯é¥çäºè¿å¶ä½ãè¿æ ·å¯ä»¥ä¿çä¿¡æ¯ï¼å¹¶é¿åå°æå¥é¡ºåºä¸å¼åºåçå¢å å³èèµ·æ¥ã\n * äº¤æ¢ç¬¬ä¸ä¸ªåæåä¸ä¸ª 16 ä½å­ä»¥âéæºâæå¥ã\n\n\n# sql å mongodb å¯¹æ¯\n\n\n# æ¯è¯­åæ¦å¿µ\n\nsql æ¯è¯­åæ¦å¿µ                     mongodb æ¯è¯­åæ¦å¿µ\ndatabase                      database\ntable                         collection\nrow                           document æ bson\ncolumn                        field\nindex                         index\ntable joins                   $lookupãåµå¥å¼ææ¡£\nprimary key                   primary key\n                              mongodb ä¸­èªå¨è®¾ç½®ä¸»é®ä¸º _id å­æ®µ\naggregation (e.g. group by)   aggregation pipeline\n                              åè sql to aggregation mapping chart.\nselect into new_table         $out\n                              åè sql to aggregation mapping chart\nmerge into table              $merge (mongodb 4.2 å¼å§æ¯æ)\n                              åè sql to aggregation mapping chart.\nunion all                     $unionwith (mongodb 4.4 å¼å§æ¯æ)\ntransactions                  transactions\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB çèåæä½",frontmatter:{title:"MongoDB çèåæä½",date:"2020-09-21T21:22:57.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","èå"],permalink:"/pages/2698b2/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/03.MongoDB%E7%9A%84%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/03.MongoDBçèåæä½.md",key:"v-8fff35f6",path:"/pages/2698b2/",headers:[{level:2,title:"Pipeline",slug:"pipeline",normalizedTitle:"pipeline",charIndex:137},{level:3,title:"Pipeline ç®ä»",slug:"pipeline-ç®ä»",normalizedTitle:"pipeline ç®ä»",charIndex:150},{level:3,title:"Pipeline ä¼å",slug:"pipeline-ä¼å",normalizedTitle:"pipeline ä¼å",charIndex:868},{level:4,title:"æå½±ä¼å",slug:"æå½±ä¼å",normalizedTitle:"æå½±ä¼å",charIndex:883},{level:4,title:"Pipeline ä¸²è¡ä¼å",slug:"pipeline-ä¸²è¡ä¼å",normalizedTitle:"pipeline ä¸²è¡ä¼å",charIndex:933},{level:4,title:"Pipeline å¹¶è¡ä¼å",slug:"pipeline-å¹¶è¡ä¼å",normalizedTitle:"pipeline å¹¶è¡ä¼å",charIndex:2147},{level:5,title:"$sort + $limit",slug:"sort-limit",normalizedTitle:"$sort + $limit",charIndex:2217},{level:5,title:"$limit + $limit",slug:"limit-limit",normalizedTitle:"$limit + $limit",charIndex:2710},{level:5,title:"$skip + $skip",slug:"skip-skip",normalizedTitle:"$skip + $skip",charIndex:2832},{level:5,title:"$match + $match",slug:"match-match",normalizedTitle:"$match + $match",charIndex:2944},{level:5,title:"$lookup + $unwind",slug:"lookup-unwind",normalizedTitle:"$lookup + $unwind",charIndex:3144},{level:3,title:"Pipeline éå¶",slug:"pipeline-éå¶",normalizedTitle:"pipeline éå¶",charIndex:3614},{level:2,title:"Map-Reduce",slug:"map-reduce",normalizedTitle:"map-reduce",charIndex:3691},{level:2,title:"åä¸ç®çèåæ¹æ³",slug:"åä¸ç®çèåæ¹æ³",normalizedTitle:"åä¸ç®çèåæ¹æ³",charIndex:123},{level:2,title:"SQL å MongoDB èåå¯¹æ¯",slug:"sql-å-mongodb-èåå¯¹æ¯",normalizedTitle:"sql å mongodb èåå¯¹æ¯",charIndex:4488},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7444}],headersStr:"Pipeline Pipeline ç®ä» Pipeline ä¼å æå½±ä¼å Pipeline ä¸²è¡ä¼å Pipeline å¹¶è¡ä¼å $sort + $limit $limit + $limit $skip + $skip $match + $match $lookup + $unwind Pipeline éå¶ Map-Reduce åä¸ç®çèåæ¹æ³ SQL å MongoDB èåå¯¹æ¯ åèèµæ",content:"# MongoDB çèåæä½\n\nèåæä½å¤çæ°æ®è®°å½å¹¶è¿åè®¡ç®ç»æãèåæä½å°æ¥èªå¤ä¸ª document çå¼åç»ï¼å¹¶å¯ä»¥å¯¹åç»çæ°æ®æ§è¡åç§æä½ä»¥è¿ååä¸ªç»æã MongoDB æä¾äºä¸ç§æ§è¡èåçæ¹å¼ï¼èåç®¡éï¼map-reduce å½æ°ååä¸ç®çèåæ¹æ³ã\n\n\n# Pipeline\n\n\n# Pipeline ç®ä»\n\nMongoDB çèåæ¡æ¶ä»¥æ°æ®å¤çç®¡éï¼Pipelineï¼çæ¦å¿µä¸ºæ¨¡åã\n\nMongoDB éè¿ db.collection.aggregate() æ¹æ³æ¯æèåæä½ãå¹¶æä¾äº aggregate å½ä»¤æ¥æ§è¡ pipelineã\n\nMongoDB Pipeline ç±å¤ä¸ªé¶æ®µï¼stagesï¼ç»æãæ¯ä¸ªé¶æ®µå¨ document éè¿ pipeline æ¶é½ä¼å¯¹å¶è¿è¡è½¬æ¢ãpipeline é¶æ®µä¸éè¦ä¸ºæ¯ä¸ªè¾å¥ document é½çæä¸ä¸ªè¾åº documentãä¾å¦ï¼æäºé¶æ®µå¯è½ä¼çææ° document æè¿æ»¤ documentã\n\nåä¸ä¸ªé¶æ®µå¯ä»¥å¨ pipeline ä¸­åºç°å¤æ¬¡ï¼ä½ $outã$merge,å $geoNear é¶æ®µé¤å¤ãææå¯ç¨ pipeline é¶æ®µå¯ä»¥åèï¼Aggregation Pipeline Stagesã\n\n\n\n * ç¬¬ä¸é¶æ®µï¼$match é¶æ®µæç¶æå­æ®µè¿æ»¤ documentï¼ç¶åå°ç¶æç­äºâ Aâçé£äº document ä¼ éå°ä¸ä¸é¶æ®µã\n * ç¬¬äºé¶æ®µï¼$group é¶æ®µæ cust_id å­æ®µå¯¹ document è¿è¡åç»ï¼ä»¥è®¡ç®æ¯ä¸ªå¯ä¸ cust_id çéé¢æ»åã\n\næåºæ¬çç®¡éé¶æ®µæä¾è¿æ»¤å¨ï¼å¶æä½ç±»ä¼¼äºæ¥è¯¢å document è½¬æ¢ï¼ä¿®æ¹è¾åº document å½¢å¼ï¼ã\n\nå¶ä»ç®¡éæä½æä¾äºç¨äºæç¹å®å­æ®µå¯¹ document è¿è¡åç»åæåºçå·¥å·ï¼ä»¥åç¨äºæ±æ»æ°ç»ï¼åæ¬ document æ°ç»ï¼åå®¹çå·¥å·ãå¦å¤ï¼ç®¡éé¶æ®µå¯ä»¥å°è¿ç®ç¬¦ç¨äºè¯¸å¦è®¡ç®å¹³åå¼æè¿æ¥å­ç¬¦ä¸²ä¹ç±»çä»»å¡ã\n\nèåç®¡éä¹å¯ä»¥å¨åç collection ä¸æä½ã\n\n\n# Pipeline ä¼å\n\n# æå½±ä¼å\n\nPipeline å¯ä»¥ç¡®å®æ¯å¦ä»éè¦ document ä¸­å¿å¡«å­æ®µå³å¯è·å¾ç»æã\n\n# Pipeline ä¸²è¡ä¼å\n\nï¼$projectã$unsetã$addFieldsã$setï¼ + $match ä¸²è¡ä¼å\n\nå¯¹äºåå«æå½±é¶æ®µï¼$project æ $unset æ $addFields æ $setï¼ï¼ä¸åç»­è·éç $match é¶æ®µç Pipeline ï¼MongoDB ä¼å°ææ $match é¶æ®µä¸­ä¸éè¦å¨æå½±é¶æ®µä¸­è®¡ç®åºçå¼çè¿æ»¤å¨ï¼ç§»å¨ä¸ä¸ªå¨æå½±é¶æ®µä¹åçæ° $match é¶æ®µã\n\nå¦æ Pipeline åå«å¤ä¸ªæå½±é¶æ®µ å / æ $match é¶æ®µï¼å MongoDB å°ä¸ºæ¯ä¸ª $match é¶æ®µæ§è¡æ­¤ä¼åï¼å°æ¯ä¸ª $match è¿æ»¤å¨ç§»å¨å°è¯¥è¿æ»¤å¨ä¸ä¾èµçæææå½±é¶æ®µä¹åã\n\nãç¤ºä¾ãPipeline ä¸²è¡ä¼åç¤ºä¾\n\nä¼ååï¼\n\n{ $addFields: {\n    maxTime: { $max: \"$times\" },\n    minTime: { $min: \"$times\" }\n} },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxTime: 1, minTime: 1,\n    avgTime: { $avg: [\"$maxTime\", \"$minTime\"] }\n} },\n{ $match: {\n    name: \"Joe Schmoe\",\n    maxTime: { $lt: 20 },\n    minTime: { $gt: 5 },\n    avgTime: { $gt: 7 }\n} }\n\n\nä¼ååï¼\n\n{ $match: { name: \"Joe Schmoe\" } },\n{ $addFields: {\n    maxTime: { $max: \"$times\" },\n    minTime: { $min: \"$times\" }\n} },\n{ $match: { maxTime: { $lt: 20 }, minTime: { $gt: 5 } } },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxTime: 1, minTime: 1,\n    avgTime: { $avg: [\"$maxTime\", \"$minTime\"] }\n} },\n{ $match: { avgTime: { $gt: 7 } } }\n\n\nè¯´æï¼\n\n{ name: \"Joe Schmoe\" } ä¸éè¦è®¡ç®ä»»ä½æå½±é¶æ®µçå¼ï¼æä»¥å¯ä»¥æ¾å¨æåé¢ã\n\n{ avgTime: { $gt: 7 } } ä¾èµ $project é¶æ®µç avgTime å­æ®µï¼æä»¥ä¸è½ç§»å¨ã\n\nmaxTime å minTime å­æ®µè¢« $addFields é¶æ®µæä¾èµï¼ä½èªèº«ä¸ä¾èµå¶ä»ï¼æä»¥ä¼æ°å»ºä¸ä¸ª $match é¶æ®µï¼å¹¶å°å¶ç½®äº $project é¶æ®µä¹åã\n\n# Pipeline å¹¶è¡ä¼å\n\nå¦æå¯è½ï¼ä¼åé¶æ®µä¼å° Pipeline é¶æ®µåå¹¶å°å¶åèº«ãéå¸¸ï¼åå¹¶åçå¨ä»»æåºåéæ°æåºä¼åä¹åã\n\n# $sort + $limit\n\nå½ $sort å¨ $limit ä¹åæ¶ï¼å¦ææ²¡æä¸­é´é¶æ®µä¿®æ¹ææ¡£æ°éï¼ä¾å¦ $unwindã$groupï¼ï¼åä¼åç¨åºå¯ä»¥å° $limit åå¹¶å° $sort ä¸­ãå¦ææç®¡éé¶æ®µæ´æ¹äº $sort å $limit é¶æ®µä¹é´çææ¡£æ°ï¼å MongoDB ä¸ä¼å° $limit åå¹¶å° $sort ä¸­ã\n\nãç¤ºä¾ã$sort + $limit\n\nä¼ååï¼\n\n{ $sort : { age : -1 } },\n{ $project : { age : 1, status : 1, name : 1 } },\n{ $limit: 5 }\n\n\nä¼ååï¼\n\n{\n    \"$sort\" : {\n       \"sortKey\" : {\n          \"age\" : -1\n       },\n       \"limit\" : NumberLong(5)\n    }\n},\n{ \"$project\" : {\n         \"age\" : 1,\n         \"status\" : 1,\n         \"name\" : 1\n  }\n}\n\n\n# $limit + $limit\n\nå¦æä¸ä¸ª $limit ç´§éå¦ä¸ä¸ª $limitï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $limit: 100 },\n{ $limit: 10 }\n\n\nä¼ååï¼\n\n{\n  $limit: 10\n}\n\n\n# $skip + $skip\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $skip: 5 },\n{ $skip: 2 }\n\n\nä¼ååï¼\n\n{\n  $skip: 7\n}\n\n\n# $match + $match\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥éè¿ $and åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $match: { year: 2014 } },\n{ $match: { status: \"A\" } }\n\n\nä¼ååï¼\n\n{\n  $match: {\n    $and: [{ year: 2014 }, { status: 'A' }]\n  }\n}\n\n\n# $lookup + $unwind\n\nå¦æä¸ä¸ª $unwind ç´§éå¦ä¸ä¸ª $lookupï¼å¹¶ä¸ $unwind å¨ $lookup ç as å­æ®µä¸è¿è¡æ¶ï¼ä¼åç¨åºå¯ä»¥å° $unwind åå¹¶å° $lookup é¶æ®µãè¿æ ·å¯ä»¥é¿ååå»ºè¾å¤§çä¸­é´ææ¡£ã\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"otherCollection\",\n    as: \"resultingArray\",\n    localField: \"x\",\n    foreignField: \"y\"\n  }\n},\n{ $unwind: \"$resultingArray\"}\n\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"otherCollection\",\n    as: \"resultingArray\",\n    localField: \"x\",\n    foreignField: \"y\",\n    unwinding: { preserveNullAndEmptyArrays: false }\n  }\n}\n\n\n\n# Pipeline éå¶\n\nç»æéä¸­çæ¯ä¸ªææ¡£åå BSON ææ¡£å¤§å°éå¶ï¼å½åä¸º 16 MBï¼\n\nPipeline çåå­éå¶ä¸º 100 MBã\n\n\n# Map-Reduce\n\n> èå pipeline æ¯ map-reduce æä¾æ´å¥½çæ§è½åæ´ä¸è´çæ¥å£ã\n\nMap-reduce æ¯ä¸ç§æ°æ®å¤çèå¼ï¼ç¨äºå°å¤§éæ°æ®æ±æ»ä¸ºæç¨çèåç»æãä¸ºäºæ§è¡ map-reduce æä½ï¼MongoDB æä¾äº mapReduce æ°æ®åºå½ä»¤ã\n\n\n\nå¨ä¸é¢çæä½ä¸­ï¼MongoDB å° map é¶æ®µåºç¨äºæ¯ä¸ªè¾å¥ documentï¼å³ collection ä¸­ä¸æ¥è¯¢æ¡ä»¶å¹éç documentï¼ã map å½æ°åååºå¤ä¸ªé®-å¼å¯¹ãå¯¹äºå·æå¤ä¸ªå¼çé£äºé®ï¼MongoDB åºç¨ reduce é¶æ®µï¼è¯¥é¶æ®µæ¶éå¹¶æ±æ»èåçæ°æ®ãç¶åï¼MongoDB å°ç»æå­å¨å¨ collection ä¸­ãå¯éå°ï¼reduce å½æ°çè¾åºå¯ä»¥éè¿ finalize å½æ°æ¥è¿ä¸æ­¥æ±æ»èåç»æã\n\nMongoDB ä¸­çææ map-reduce å½æ°é½æ¯ JavaScriptï¼å¹¶å¨ mongod è¿ç¨ä¸­è¿è¡ã Map-reduce æä½å°åä¸ª collection ç document ä½ä¸ºè¾å¥ï¼å¹¶ä¸å¯ä»¥å¨å¼å§ map é¶æ®µä¹åæ§è¡ä»»ææåºåéå¶ã mapReduce å¯ä»¥å° map-reduce æä½çç»æä½ä¸º document è¿åï¼ä¹å¯ä»¥å°ç»æåå¥ collectionã\n\n\n# åä¸ç®çèåæ¹æ³\n\nMongoDB æ¯æä¸ä¸åä¸ç®ççèåæä½ï¼\n\n * db.collection.estimatedDocumentCount()\n * db.collection.count()\n * db.collection.distinct()\n\nææè¿äºæä½é½æ±æ»äºåä¸ª collection ä¸­ç documentãå°½ç®¡è¿äºæä½æä¾äºå¯¹å¸¸è§èåè¿ç¨çç®åè®¿é®ï¼ä½æ¯å®ä»¬ç¸æ¯èå pipeline å map-reduceï¼ç¼ºå°çµæ´»æ§åä¸°å¯çåè½æ§ã\n\n\n\n\n# SQL å MongoDB èåå¯¹æ¯\n\nMongoDB pipeline æä¾äºè®¸å¤ç­ä»·äº SQL ä¸­å¸¸è§èåè¯­å¥çæä½ã\n\nä¸è¡¨æ¦è¿°äºå¸¸è§ç SQL èåè¯­å¥æå½æ°å MongoDB èåæä½çæ å°è¡¨ï¼\n\nSQL TERMS, FUNCTIONS, AND CONCEPTS   MONGODB AGGREGATION OPERATORS\nWHERE                                $match\nGROUP BY                             $group\nHAVING                               $match\nSELECT                               $project\nORDER BY                             $sort\nLIMIT                                $limit\nSUM()                                $sum\nCOUNT()                              $sum$sortByCount\nJOIN                                 $lookup\nSELECT INTO NEW_TABLE                $out\nMERGE INTO TABLE                     $merge (Available starting in MongoDB 4.2)\nUNION ALL                            $unionWith (Available starting in MongoDB 4.4)\n\nãç¤ºä¾ã\n\ndb.orders.insertMany([\n  {\n    _id: 1,\n    cust_id: 'Ant O. Knee',\n    ord_date: new Date('2020-03-01'),\n    price: 25,\n    items: [\n      { sku: 'oranges', qty: 5, price: 2.5 },\n      { sku: 'apples', qty: 5, price: 2.5 },\n    ],\n    status: 'A',\n  },\n  {\n    _id: 2,\n    cust_id: 'Ant O. Knee',\n    ord_date: new Date('2020-03-08'),\n    price: 70,\n    items: [\n      { sku: 'oranges', qty: 8, price: 2.5 },\n      { sku: 'chocolates', qty: 5, price: 10 },\n    ],\n    status: 'A',\n  },\n  {\n    _id: 3,\n    cust_id: 'Busby Bee',\n    ord_date: new Date('2020-03-08'),\n    price: 50,\n    items: [\n      { sku: 'oranges', qty: 10, price: 2.5 },\n      { sku: 'pears', qty: 10, price: 2.5 },\n    ],\n    status: 'A',\n  },\n  {\n    _id: 4,\n    cust_id: 'Busby Bee',\n    ord_date: new Date('2020-03-18'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'A',\n  },\n  {\n    _id: 5,\n    cust_id: 'Busby Bee',\n    ord_date: new Date('2020-03-19'),\n    price: 50,\n    items: [{ sku: 'chocolates', qty: 5, price: 10 }],\n    status: 'A',\n  },\n  {\n    _id: 6,\n    cust_id: 'Cam Elot',\n    ord_date: new Date('2020-03-19'),\n    price: 35,\n    items: [\n      { sku: 'carrots', qty: 10, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n    ],\n    status: 'A',\n  },\n  {\n    _id: 7,\n    cust_id: 'Cam Elot',\n    ord_date: new Date('2020-03-20'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'A',\n  },\n  {\n    _id: 8,\n    cust_id: 'Don Quis',\n    ord_date: new Date('2020-03-20'),\n    price: 75,\n    items: [\n      { sku: 'chocolates', qty: 5, price: 10 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n    ],\n    status: 'A',\n  },\n  {\n    _id: 9,\n    cust_id: 'Don Quis',\n    ord_date: new Date('2020-03-20'),\n    price: 55,\n    items: [\n      { sku: 'carrots', qty: 5, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n      { sku: 'oranges', qty: 10, price: 2.5 },\n    ],\n    status: 'A',\n  },\n  {\n    _id: 10,\n    cust_id: 'Don Quis',\n    ord_date: new Date('2020-03-23'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'A',\n  },\n])\n\n\nSQL å MongoDB èåæ¹å¼å¯¹æ¯ï¼\n\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb çèåæä½\n\nèåæä½å¤çæ°æ®è®°å½å¹¶è¿åè®¡ç®ç»æãèåæä½å°æ¥èªå¤ä¸ª document çå¼åç»ï¼å¹¶å¯ä»¥å¯¹åç»çæ°æ®æ§è¡åç§æä½ä»¥è¿ååä¸ªç»æã mongodb æä¾äºä¸ç§æ§è¡èåçæ¹å¼ï¼èåç®¡éï¼map-reduce å½æ°ååä¸ç®çèåæ¹æ³ã\n\n\n# pipeline\n\n\n# pipeline ç®ä»\n\nmongodb çèåæ¡æ¶ä»¥æ°æ®å¤çç®¡éï¼pipelineï¼çæ¦å¿µä¸ºæ¨¡åã\n\nmongodb éè¿ db.collection.aggregate() æ¹æ³æ¯æèåæä½ãå¹¶æä¾äº aggregate å½ä»¤æ¥æ§è¡ pipelineã\n\nmongodb pipeline ç±å¤ä¸ªé¶æ®µï¼stagesï¼ç»æãæ¯ä¸ªé¶æ®µå¨ document éè¿ pipeline æ¶é½ä¼å¯¹å¶è¿è¡è½¬æ¢ãpipeline é¶æ®µä¸éè¦ä¸ºæ¯ä¸ªè¾å¥ document é½çæä¸ä¸ªè¾åº documentãä¾å¦ï¼æäºé¶æ®µå¯è½ä¼çææ° document æè¿æ»¤ documentã\n\nåä¸ä¸ªé¶æ®µå¯ä»¥å¨ pipeline ä¸­åºç°å¤æ¬¡ï¼ä½ $outã$merge,å $geonear é¶æ®µé¤å¤ãææå¯ç¨ pipeline é¶æ®µå¯ä»¥åèï¼aggregation pipeline stagesã\n\n\n\n * ç¬¬ä¸é¶æ®µï¼$match é¶æ®µæç¶æå­æ®µè¿æ»¤ documentï¼ç¶åå°ç¶æç­äºâ aâçé£äº document ä¼ éå°ä¸ä¸é¶æ®µã\n * ç¬¬äºé¶æ®µï¼$group é¶æ®µæ cust_id å­æ®µå¯¹ document è¿è¡åç»ï¼ä»¥è®¡ç®æ¯ä¸ªå¯ä¸ cust_id çéé¢æ»åã\n\næåºæ¬çç®¡éé¶æ®µæä¾è¿æ»¤å¨ï¼å¶æä½ç±»ä¼¼äºæ¥è¯¢å document è½¬æ¢ï¼ä¿®æ¹è¾åº document å½¢å¼ï¼ã\n\nå¶ä»ç®¡éæä½æä¾äºç¨äºæç¹å®å­æ®µå¯¹ document è¿è¡åç»åæåºçå·¥å·ï¼ä»¥åç¨äºæ±æ»æ°ç»ï¼åæ¬ document æ°ç»ï¼åå®¹çå·¥å·ãå¦å¤ï¼ç®¡éé¶æ®µå¯ä»¥å°è¿ç®ç¬¦ç¨äºè¯¸å¦è®¡ç®å¹³åå¼æè¿æ¥å­ç¬¦ä¸²ä¹ç±»çä»»å¡ã\n\nèåç®¡éä¹å¯ä»¥å¨åç collection ä¸æä½ã\n\n\n# pipeline ä¼å\n\n# æå½±ä¼å\n\npipeline å¯ä»¥ç¡®å®æ¯å¦ä»éè¦ document ä¸­å¿å¡«å­æ®µå³å¯è·å¾ç»æã\n\n# pipeline ä¸²è¡ä¼å\n\nï¼$projectã$unsetã$addfieldsã$setï¼ + $match ä¸²è¡ä¼å\n\nå¯¹äºåå«æå½±é¶æ®µï¼$project æ $unset æ $addfields æ $setï¼ï¼ä¸åç»­è·éç $match é¶æ®µç pipeline ï¼mongodb ä¼å°ææ $match é¶æ®µä¸­ä¸éè¦å¨æå½±é¶æ®µä¸­è®¡ç®åºçå¼çè¿æ»¤å¨ï¼ç§»å¨ä¸ä¸ªå¨æå½±é¶æ®µä¹åçæ° $match é¶æ®µã\n\nå¦æ pipeline åå«å¤ä¸ªæå½±é¶æ®µ å / æ $match é¶æ®µï¼å mongodb å°ä¸ºæ¯ä¸ª $match é¶æ®µæ§è¡æ­¤ä¼åï¼å°æ¯ä¸ª $match è¿æ»¤å¨ç§»å¨å°è¯¥è¿æ»¤å¨ä¸ä¾èµçæææå½±é¶æ®µä¹åã\n\nãç¤ºä¾ãpipeline ä¸²è¡ä¼åç¤ºä¾\n\nä¼ååï¼\n\n{ $addfields: {\n    maxtime: { $max: \"$times\" },\n    mintime: { $min: \"$times\" }\n} },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxtime: 1, mintime: 1,\n    avgtime: { $avg: [\"$maxtime\", \"$mintime\"] }\n} },\n{ $match: {\n    name: \"joe schmoe\",\n    maxtime: { $lt: 20 },\n    mintime: { $gt: 5 },\n    avgtime: { $gt: 7 }\n} }\n\n\nä¼ååï¼\n\n{ $match: { name: \"joe schmoe\" } },\n{ $addfields: {\n    maxtime: { $max: \"$times\" },\n    mintime: { $min: \"$times\" }\n} },\n{ $match: { maxtime: { $lt: 20 }, mintime: { $gt: 5 } } },\n{ $project: {\n    _id: 1, name: 1, times: 1, maxtime: 1, mintime: 1,\n    avgtime: { $avg: [\"$maxtime\", \"$mintime\"] }\n} },\n{ $match: { avgtime: { $gt: 7 } } }\n\n\nè¯´æï¼\n\n{ name: \"joe schmoe\" } ä¸éè¦è®¡ç®ä»»ä½æå½±é¶æ®µçå¼ï¼æä»¥å¯ä»¥æ¾å¨æåé¢ã\n\n{ avgtime: { $gt: 7 } } ä¾èµ $project é¶æ®µç avgtime å­æ®µï¼æä»¥ä¸è½ç§»å¨ã\n\nmaxtime å mintime å­æ®µè¢« $addfields é¶æ®µæä¾èµï¼ä½èªèº«ä¸ä¾èµå¶ä»ï¼æä»¥ä¼æ°å»ºä¸ä¸ª $match é¶æ®µï¼å¹¶å°å¶ç½®äº $project é¶æ®µä¹åã\n\n# pipeline å¹¶è¡ä¼å\n\nå¦æå¯è½ï¼ä¼åé¶æ®µä¼å° pipeline é¶æ®µåå¹¶å°å¶åèº«ãéå¸¸ï¼åå¹¶åçå¨ä»»æåºåéæ°æåºä¼åä¹åã\n\n# $sort + $limit\n\nå½ $sort å¨ $limit ä¹åæ¶ï¼å¦ææ²¡æä¸­é´é¶æ®µä¿®æ¹ææ¡£æ°éï¼ä¾å¦ $unwindã$groupï¼ï¼åä¼åç¨åºå¯ä»¥å° $limit åå¹¶å° $sort ä¸­ãå¦ææç®¡éé¶æ®µæ´æ¹äº $sort å $limit é¶æ®µä¹é´çææ¡£æ°ï¼å mongodb ä¸ä¼å° $limit åå¹¶å° $sort ä¸­ã\n\nãç¤ºä¾ã$sort + $limit\n\nä¼ååï¼\n\n{ $sort : { age : -1 } },\n{ $project : { age : 1, status : 1, name : 1 } },\n{ $limit: 5 }\n\n\nä¼ååï¼\n\n{\n    \"$sort\" : {\n       \"sortkey\" : {\n          \"age\" : -1\n       },\n       \"limit\" : numberlong(5)\n    }\n},\n{ \"$project\" : {\n         \"age\" : 1,\n         \"status\" : 1,\n         \"name\" : 1\n  }\n}\n\n\n# $limit + $limit\n\nå¦æä¸ä¸ª $limit ç´§éå¦ä¸ä¸ª $limitï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $limit: 100 },\n{ $limit: 10 }\n\n\nä¼ååï¼\n\n{\n  $limit: 10\n}\n\n\n# $skip + $skip\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $skip: 5 },\n{ $skip: 2 }\n\n\nä¼ååï¼\n\n{\n  $skip: 7\n}\n\n\n# $match + $match\n\nå¦æä¸ä¸ª $skip ç´§éå¦ä¸ä¸ª $skip ï¼é£ä¹å®ä»¬å¯ä»¥éè¿ $and åå¹¶ä¸ºä¸ã\n\nä¼ååï¼\n\n{ $match: { year: 2014 } },\n{ $match: { status: \"a\" } }\n\n\nä¼ååï¼\n\n{\n  $match: {\n    $and: [{ year: 2014 }, { status: 'a' }]\n  }\n}\n\n\n# $lookup + $unwind\n\nå¦æä¸ä¸ª $unwind ç´§éå¦ä¸ä¸ª $lookupï¼å¹¶ä¸ $unwind å¨ $lookup ç as å­æ®µä¸è¿è¡æ¶ï¼ä¼åç¨åºå¯ä»¥å° $unwind åå¹¶å° $lookup é¶æ®µãè¿æ ·å¯ä»¥é¿ååå»ºè¾å¤§çä¸­é´ææ¡£ã\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"othercollection\",\n    as: \"resultingarray\",\n    localfield: \"x\",\n    foreignfield: \"y\"\n  }\n},\n{ $unwind: \"$resultingarray\"}\n\n\nä¼ååï¼\n\n{\n  $lookup: {\n    from: \"othercollection\",\n    as: \"resultingarray\",\n    localfield: \"x\",\n    foreignfield: \"y\",\n    unwinding: { preservenullandemptyarrays: false }\n  }\n}\n\n\n\n# pipeline éå¶\n\nç»æéä¸­çæ¯ä¸ªææ¡£åå bson ææ¡£å¤§å°éå¶ï¼å½åä¸º 16 mbï¼\n\npipeline çåå­éå¶ä¸º 100 mbã\n\n\n# map-reduce\n\n> èå pipeline æ¯ map-reduce æä¾æ´å¥½çæ§è½åæ´ä¸è´çæ¥å£ã\n\nmap-reduce æ¯ä¸ç§æ°æ®å¤çèå¼ï¼ç¨äºå°å¤§éæ°æ®æ±æ»ä¸ºæç¨çèåç»æãä¸ºäºæ§è¡ map-reduce æä½ï¼mongodb æä¾äº mapreduce æ°æ®åºå½ä»¤ã\n\n\n\nå¨ä¸é¢çæä½ä¸­ï¼mongodb å° map é¶æ®µåºç¨äºæ¯ä¸ªè¾å¥ documentï¼å³ collection ä¸­ä¸æ¥è¯¢æ¡ä»¶å¹éç documentï¼ã map å½æ°åååºå¤ä¸ªé®-å¼å¯¹ãå¯¹äºå·æå¤ä¸ªå¼çé£äºé®ï¼mongodb åºç¨ reduce é¶æ®µï¼è¯¥é¶æ®µæ¶éå¹¶æ±æ»èåçæ°æ®ãç¶åï¼mongodb å°ç»æå­å¨å¨ collection ä¸­ãå¯éå°ï¼reduce å½æ°çè¾åºå¯ä»¥éè¿ finalize å½æ°æ¥è¿ä¸æ­¥æ±æ»èåç»æã\n\nmongodb ä¸­çææ map-reduce å½æ°é½æ¯ javascriptï¼å¹¶å¨ mongod è¿ç¨ä¸­è¿è¡ã map-reduce æä½å°åä¸ª collection ç document ä½ä¸ºè¾å¥ï¼å¹¶ä¸å¯ä»¥å¨å¼å§ map é¶æ®µä¹åæ§è¡ä»»ææåºåéå¶ã mapreduce å¯ä»¥å° map-reduce æä½çç»æä½ä¸º document è¿åï¼ä¹å¯ä»¥å°ç»æåå¥ collectionã\n\n\n# åä¸ç®çèåæ¹æ³\n\nmongodb æ¯æä¸ä¸åä¸ç®ççèåæä½ï¼\n\n * db.collection.estimateddocumentcount()\n * db.collection.count()\n * db.collection.distinct()\n\nææè¿äºæä½é½æ±æ»äºåä¸ª collection ä¸­ç documentãå°½ç®¡è¿äºæä½æä¾äºå¯¹å¸¸è§èåè¿ç¨çç®åè®¿é®ï¼ä½æ¯å®ä»¬ç¸æ¯èå pipeline å map-reduceï¼ç¼ºå°çµæ´»æ§åä¸°å¯çåè½æ§ã\n\n\n\n\n# sql å mongodb èåå¯¹æ¯\n\nmongodb pipeline æä¾äºè®¸å¤ç­ä»·äº sql ä¸­å¸¸è§èåè¯­å¥çæä½ã\n\nä¸è¡¨æ¦è¿°äºå¸¸è§ç sql èåè¯­å¥æå½æ°å mongodb èåæä½çæ å°è¡¨ï¼\n\nsql terms, functions, and concepts   mongodb aggregation operators\nwhere                                $match\ngroup by                             $group\nhaving                               $match\nselect                               $project\norder by                             $sort\nlimit                                $limit\nsum()                                $sum\ncount()                              $sum$sortbycount\njoin                                 $lookup\nselect into new_table                $out\nmerge into table                     $merge (available starting in mongodb 4.2)\nunion all                            $unionwith (available starting in mongodb 4.4)\n\nãç¤ºä¾ã\n\ndb.orders.insertmany([\n  {\n    _id: 1,\n    cust_id: 'ant o. knee',\n    ord_date: new date('2020-03-01'),\n    price: 25,\n    items: [\n      { sku: 'oranges', qty: 5, price: 2.5 },\n      { sku: 'apples', qty: 5, price: 2.5 },\n    ],\n    status: 'a',\n  },\n  {\n    _id: 2,\n    cust_id: 'ant o. knee',\n    ord_date: new date('2020-03-08'),\n    price: 70,\n    items: [\n      { sku: 'oranges', qty: 8, price: 2.5 },\n      { sku: 'chocolates', qty: 5, price: 10 },\n    ],\n    status: 'a',\n  },\n  {\n    _id: 3,\n    cust_id: 'busby bee',\n    ord_date: new date('2020-03-08'),\n    price: 50,\n    items: [\n      { sku: 'oranges', qty: 10, price: 2.5 },\n      { sku: 'pears', qty: 10, price: 2.5 },\n    ],\n    status: 'a',\n  },\n  {\n    _id: 4,\n    cust_id: 'busby bee',\n    ord_date: new date('2020-03-18'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'a',\n  },\n  {\n    _id: 5,\n    cust_id: 'busby bee',\n    ord_date: new date('2020-03-19'),\n    price: 50,\n    items: [{ sku: 'chocolates', qty: 5, price: 10 }],\n    status: 'a',\n  },\n  {\n    _id: 6,\n    cust_id: 'cam elot',\n    ord_date: new date('2020-03-19'),\n    price: 35,\n    items: [\n      { sku: 'carrots', qty: 10, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n    ],\n    status: 'a',\n  },\n  {\n    _id: 7,\n    cust_id: 'cam elot',\n    ord_date: new date('2020-03-20'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'a',\n  },\n  {\n    _id: 8,\n    cust_id: 'don quis',\n    ord_date: new date('2020-03-20'),\n    price: 75,\n    items: [\n      { sku: 'chocolates', qty: 5, price: 10 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n    ],\n    status: 'a',\n  },\n  {\n    _id: 9,\n    cust_id: 'don quis',\n    ord_date: new date('2020-03-20'),\n    price: 55,\n    items: [\n      { sku: 'carrots', qty: 5, price: 1.0 },\n      { sku: 'apples', qty: 10, price: 2.5 },\n      { sku: 'oranges', qty: 10, price: 2.5 },\n    ],\n    status: 'a',\n  },\n  {\n    _id: 10,\n    cust_id: 'don quis',\n    ord_date: new date('2020-03-23'),\n    price: 25,\n    items: [{ sku: 'oranges', qty: 10, price: 2.5 }],\n    status: 'a',\n  },\n])\n\n\nsql å mongodb èåæ¹å¼å¯¹æ¯ï¼\n\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB äºå¡",frontmatter:{title:"MongoDB äºå¡",date:"2020-09-20T23:12:17.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","äºå¡"],permalink:"/pages/3287fa/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/04.MongoDB%E4%BA%8B%E5%8A%A1.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/04.MongoDBäºå¡.md",key:"v-0fa53966",path:"/pages/3287fa/",headersStr:null,content:"# MongoDB äºå¡\n\nwriteConcern å¯ä»¥å³å®åæä½å°è¾¾å¤å°ä¸ªèç¹æç®æåã\n\n * é»è®¤ï¼å¤èç¹å¤å¶éä¸åä»»ä½è®¾å®ï¼æä»¥æ¯æå¯è½ä¸¢å¤±æ°æ®ã\n * w: \"majority\"ï¼å¤§é¨åèç¹ç¡®è®¤ï¼å°±è§ä¸ºåæå\n * w: \"all\"ï¼å¨é¨èç¹ç¡®è®¤ï¼æè§ä¸ºåæå\n\njournal åå®ä¹å¦ä½æç®æåãåå¼åæ¬ï¼\n\n * trueï¼åæä½è½å° journal æä»¶ä¸­æç®æåï¼\n * falseï¼åæä½è¾¾å°åå­å³ç®ä½æåã\n\nãç¤ºä¾ãå¨éç¾¤ä¸­ä½¿ç¨ writeConcern åæ°\n\ndb.transaction.insert({ count: 1 }, { writeConcern: { w: 'majoriy' } })\ndb.transaction.insert({ count: 1 }, { writeConcern: { w: '4' } })\ndb.transaction.insert({ count: 1 }, { writeConcern: { w: 'all' } })\n\n\nãç¤ºä¾ãéç½®å»¶è¿èç¹ï¼æ¨¡æç½ç»å»¶è¿\n\nconf=rs.conf()\nconf.memebers[2].slaveDelay=5\nconf.memebers[2].priority=0\nrs.reconfig(conf)\n",normalizedContent:"# mongodb äºå¡\n\nwriteconcern å¯ä»¥å³å®åæä½å°è¾¾å¤å°ä¸ªèç¹æç®æåã\n\n * é»è®¤ï¼å¤èç¹å¤å¶éä¸åä»»ä½è®¾å®ï¼æä»¥æ¯æå¯è½ä¸¢å¤±æ°æ®ã\n * w: \"majority\"ï¼å¤§é¨åèç¹ç¡®è®¤ï¼å°±è§ä¸ºåæå\n * w: \"all\"ï¼å¨é¨èç¹ç¡®è®¤ï¼æè§ä¸ºåæå\n\njournal åå®ä¹å¦ä½æç®æåãåå¼åæ¬ï¼\n\n * trueï¼åæä½è½å° journal æä»¶ä¸­æç®æåï¼\n * falseï¼åæä½è¾¾å°åå­å³ç®ä½æåã\n\nãç¤ºä¾ãå¨éç¾¤ä¸­ä½¿ç¨ writeconcern åæ°\n\ndb.transaction.insert({ count: 1 }, { writeconcern: { w: 'majoriy' } })\ndb.transaction.insert({ count: 1 }, { writeconcern: { w: '4' } })\ndb.transaction.insert({ count: 1 }, { writeconcern: { w: 'all' } })\n\n\nãç¤ºä¾ãéç½®å»¶è¿èç¹ï¼æ¨¡æç½ç»å»¶è¿\n\nconf=rs.conf()\nconf.memebers[2].slavedelay=5\nconf.memebers[2].priority=0\nrs.reconfig(conf)\n",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB å»ºæ¨¡",frontmatter:{title:"MongoDB å»ºæ¨¡",date:"2020-09-09T20:47:14.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","å»ºæ¨¡"],permalink:"/pages/c154c4/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/05.MongoDB%E5%BB%BA%E6%A8%A1.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/05.MongoDBå»ºæ¨¡.md",key:"v-7bb10b88",path:"/pages/c154c4/",headers:[{level:2,title:"MongoDB æ°æ®å»ºæ¨¡å¥é¨",slug:"mongodb-æ°æ®å»ºæ¨¡å¥é¨",normalizedTitle:"mongodb æ°æ®å»ºæ¨¡å¥é¨",charIndex:295},{level:3,title:"ï¼ä¸ï¼å®ä¹æ°æ®é",slug:"ä¸-å®ä¹æ°æ®é",normalizedTitle:"ï¼ä¸ï¼å®ä¹æ°æ®é",charIndex:390},{level:3,title:"ï¼äºï¼æè JSON ç»æ",slug:"äº-æè-json-ç»æ",normalizedTitle:"ï¼äºï¼æè json ç»æ",charIndex:992},{level:3,title:"ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®",slug:"ä¸-ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®",normalizedTitle:"ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®",charIndex:1564},{level:2,title:"æ°æ®æ¨¡åç®ä»",slug:"æ°æ®æ¨¡åç®ä»",normalizedTitle:"æ°æ®æ¨¡åç®ä»",charIndex:2357},{level:3,title:"çµæ´»ç Schema",slug:"çµæ´»ç-schema",normalizedTitle:"çµæ´»ç schema",charIndex:2461},{level:3,title:"Document ç»æ",slug:"document-ç»æ",normalizedTitle:"document ç»æ",charIndex:2865},{level:4,title:"åµå¥å¼æ°æ®æ¨¡å",slug:"åµå¥å¼æ°æ®æ¨¡å",normalizedTitle:"åµå¥å¼æ°æ®æ¨¡å",charIndex:2880},{level:4,title:"å¼ç¨å¼æ°æ®æ¨¡å",slug:"å¼ç¨å¼æ°æ®æ¨¡å",normalizedTitle:"å¼ç¨å¼æ°æ®æ¨¡å",charIndex:3136},{level:3,title:"åå­åæä½",slug:"åå­åæä½",normalizedTitle:"åå­åæä½",charIndex:3580},{level:4,title:"å document çåå­æ§",slug:"å-document-çåå­æ§",normalizedTitle:"å document çåå­æ§",charIndex:3589},{level:4,title:"å¤ document äºå¡",slug:"å¤-document-äºå¡",normalizedTitle:"å¤ document äºå¡",charIndex:3854},{level:3,title:"æ°æ®ä½¿ç¨åæ§è½",slug:"æ°æ®ä½¿ç¨åæ§è½",normalizedTitle:"æ°æ®ä½¿ç¨åæ§è½",charIndex:4229},{level:2,title:"Schema æ ¡éª",slug:"schema-æ ¡éª",normalizedTitle:"schema æ ¡éª",charIndex:4355},{level:3,title:"æå®æ ¡éªè§å",slug:"æå®æ ¡éªè§å",normalizedTitle:"æå®æ ¡éªè§å",charIndex:4369},{level:3,title:"JSON Schema",slug:"json-schema",normalizedTitle:"json schema",charIndex:4693},{level:3,title:"å¶å®æ¥è¯¢è¡¨è¾¾å¼",slug:"å¶å®æ¥è¯¢è¡¨è¾¾å¼",normalizedTitle:"å¶å®æ¥è¯¢è¡¨è¾¾å¼",charIndex:6004},{level:3,title:"è¡ä¸º",slug:"è¡ä¸º",normalizedTitle:"è¡ä¸º",charIndex:6401},{level:4,title:"ç°æç document",slug:"ç°æç-document",normalizedTitle:"ç°æç document",charIndex:6442},{level:4,title:"æ¥åææç»æ æç document",slug:"æ¥åææç»æ æç-document",normalizedTitle:"æ¥åææç»æ æç document",charIndex:7599},{level:4,title:"éå¶",slug:"éå¶",normalizedTitle:"éå¶",charIndex:82},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:8916}],headersStr:"MongoDB æ°æ®å»ºæ¨¡å¥é¨ ï¼ä¸ï¼å®ä¹æ°æ®é ï¼äºï¼æè JSON ç»æ ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ® æ°æ®æ¨¡åç®ä» çµæ´»ç Schema Document ç»æ åµå¥å¼æ°æ®æ¨¡å å¼ç¨å¼æ°æ®æ¨¡å åå­åæä½ å document çåå­æ§ å¤ document äºå¡ æ°æ®ä½¿ç¨åæ§è½ Schema æ ¡éª æå®æ ¡éªè§å JSON Schema å¶å®æ¥è¯¢è¡¨è¾¾å¼ è¡ä¸º ç°æç document æ¥åææç»æ æç document éå¶ åèèµæ",content:"# MongoDB å»ºæ¨¡\n\nMongoDB çæ°æ®æ¨¡å¼æ¯ä¸ç§çµæ´»æ¨¡å¼ï¼å³ç³»åæ°æ®åºè¦æ±ä½ å¨æå¥æ°æ®ä¹åå¿é¡»åå®ä¹å¥½ä¸ä¸ªè¡¨çæ¨¡å¼ç»æï¼è MongoDB çéååå¹¶ä¸éå¶ document ç»æãè¿ç§çµæ´»æ§è®©å¯¹è±¡åæ°æ®åºææ¡£ä¹é´çæ å°åå¾å¾å®¹æãå³ä½¿æ°æ®è®°å½ä¹é´æå¾å¤§çååï¼æ¯ä¸ªææ¡£ä¹å¯ä»¥å¾å¥½çæ å°å°åæ¡ä¸åçè®°å½ã å½ç¶å¨å®éä½¿ç¨ä¸­ï¼åä¸ä¸ªéåä¸­çææ¡£å¾å¾é½æä¸ä¸ªæ¯è¾ç±»ä¼¼çç»æã\n\næ°æ®æ¨¡åè®¾è®¡ä¸­æå·æææ§çæ¯å¨åºç¨ç¨åºéæ±ï¼æ°æ®åºå¼ææ§è½è¦æ±åæ°æ®è¯»åæ¨¡å¼ä¹é´åæè¡¡èéãå½è®¾è®¡æ°æ®æ¨¡åçæ¶åï¼ä¸å®è¦èèåºç¨ç¨åºå¯¹æ°æ®çä½¿ç¨æ¨¡å¼ï¼å¦æ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çå¤©ç¶ç»æã\n\n\n# MongoDB æ°æ®å»ºæ¨¡å¥é¨\n\n> åèï¼https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need\n\n\n# ï¼ä¸ï¼å®ä¹æ°æ®é\n\nå½éè¦å»ºç«æ°æ®å­å¨æ¶ï¼é¦ååºè¯¥æèä»¥ä¸é®é¢ï¼éè¦å­å¨åªäºæ°æ®ï¼è¿äºå­æ®µä¹é´å¦ä½å³èï¼\n\nè¿æ¯ä¸ä¸ªæ°æ®å»ºæ¨¡çè¿ç¨ãç®æ æ¯å°ä¸å¡éæ±æ½è±¡ä¸ºé»è¾æ¨¡åã\n\nåè®¾è¿æ ·ä¸ä¸ªåºæ¯ï¼æä»¬éè¦å»ºç«æ°æ®åºä»¥è·è¸ªç©æåå¶æ°éï¼å¤§å°ï¼æ ç­¾åç­çº§ã\n\nå¦ææ¯å­å¨å¨ RDBMSï¼å¯è½ä»¥ä¸çæ°æ®è¡¨ï¼\n\nNAME       QUANTITY   SIZE          STATUS   TAGS                       RATING\njournal    25         14x21,cm      A        brown, lined               9\nnotebook   50         8.5x11,in     A        college-ruled,perforated   8\npaper      100        8.5x11,in     D        watercolor                 10\nplanner    75         22.85x30,cm   D        2019                       10\npostcard   45         10x,cm        D        double-sided,white         2\n\n\n# ï¼äºï¼æè JSON ç»æ\n\nä»ä¸ä¾ä¸­å¯ä»¥çåºï¼è¡¨ä¼¼ä¹æ¯å­å¨æ°æ®çå¥½å°æ¹ï¼ä½è¯¥æ°æ®éä¸­çå­æ®µéè¦å¤ä¸ªå¼ï¼å¦æå¨åä¸ªåä¸­å»ºæ¨¡ï¼åä¸å®¹ææç´¢ææ¾ç¤ºï¼å¯¹äº ä¾å¦âå¤§å°åæ ç­¾ï¼ã\n\nå¨ SQL æ°æ®åºä¸­ï¼æ¨å¯ä»¥éè¿åå»ºå³ç³»è¡¨æ¥è§£å³æ­¤é®é¢ã\n\nå¨ MongoDB ä¸­ï¼æ°æ®å­å¨ä¸ºææ¡£ï¼documentï¼ã è¿äºææ¡£ä»¥ JSONï¼JavaScript å¯¹è±¡è¡¨ç¤ºæ³ï¼æ ¼å¼å­å¨å¨ MongoDB ä¸­ã JSON ææ¡£æ¯æåµå¥å¼å­æ®µï¼å æ­¤ç¸å³æ°æ®åæ°æ®åè¡¨å¯ä»¥ä¸ææ¡£ä¸èµ·å­å¨ï¼èä¸æ¯ä¸å¤é¨è¡¨ä¸èµ·å­å¨ã\n\nJSON æ ¼å¼ä¸ºé®/å¼å¯¹ã å¨ JSON ææ¡£ä¸­ï¼å­æ®µååå¼ç¨åå·åéï¼å­æ®µååå¼å¯¹ç¨éå·åéï¼å¹¶ä¸å­æ®µéå°è£å¨âå¤§æ¬å·âï¼{}ï¼ä¸­ã\n\nå¦æè¦å¼å§å¯¹ä¸é¢çè¡ä¹ä¸è¿è¡å»ºæ¨¡ï¼ä¾å¦æ­¤è¡ï¼\n\nNAME       QUANTITY   SIZE        STATUS   TAGS                       RATING\nnotebook   50         8.5x11,in   A        college-ruled,perforated   8\n\næ¨å¯ä»¥ä» name å quantity å­æ®µå¼å§ã å¨ JSON ä¸­ï¼è¿äºå­æ®µå¦ä¸æç¤ºï¼\n\n{ \"name\": \"notebook\", \"qty\": 50 }\n\n\n\n# ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®\n\næ¥ä¸æ¥ï¼éè¦ç¡®å®åªäºå­æ®µå¯è½éè¦å¤ä¸ªå¼ãå¯ä»¥èèå°è¿äºå­æ®µä½ä¸ºåµå¥å¼ææ¡£æåµå¥å¼ææ¡£ä¸­ç åè¡¨/æ°ç» å¯¹è±¡ã\n\nä¾å¦ï¼å¨ä¸é¢çç¤ºä¾ä¸­ï¼size å¯è½åå«ä¸ä¸ªå­æ®µï¼\n\n{ \"h\": 11, \"w\": 8.5, \"uom\": \"in\" }\n\n\nAnd some items have multiple ratings, so ratings might be represented as a list of documents containing the field scores:\n\n[{ \"score\": 8 }, { \"score\": 9 }]\n\n\nAnd you might need to handle multiple tags per item. So you might store them in a list too.\n\n[\"college-ruled\", \"perforated\"]\n\n\nFinally, a JSON document that stores an inventory item might look like this:\n\n{\n  \"name\": \"notebook\",\n  \"qty\": 50,\n  \"rating\": [{ \"score\": 8 }, { \"score\": 9 }],\n  \"size\": { \"height\": 11, \"width\": 8.5, \"unit\": \"in\" },\n  \"status\": \"A\",\n  \"tags\": [\"college-ruled\", \"perforated\"]\n}\n\n\nThis looks very different from the tabular data structure you started with in Step 1.\n\n\n# æ°æ®æ¨¡åç®ä»\n\næ°æ®å»ºæ¨¡ä¸­çå³é®æææ¯å¹³è¡¡åºç¨ç¨åºçéæ±ãæ°æ®åºå¼æçæ§è½ä»¥åæ°æ®æ£ç´¢æ¨¡å¼ã å¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼å§ç»éè¦èèæ°æ®çåºç¨ç¨åºä½¿ç¨æåµï¼å³æ°æ®çæ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çåºæç»æã\n\n\n# çµæ´»ç Schema\n\nå¨å³ç³»åæ°æ®åºä¸­ï¼å¿é¡»å¨æå¥æ°æ®ä¹åç¡®å®å¹¶å£°æè¡¨çç»æãè MongoDB ç collection é»è®¤æåµä¸ä¸éè¦å¶ææ¡£å·æç¸åçæ¶æãä¹å°±æ¯è¯´ï¼\n\nåä¸ä¸ª collection ä¸­ç document ä¸éè¦å·æç¸åç field éï¼å¹¶ä¸ field çæ°æ®ç±»åå¯ä»¥å¨éåä¸­çä¸åææ¡£ä¹é´ææä¸åã\n\nè¦æ´æ¹ collection ä¸­ç document ç»æï¼ä¾å¦æ·»å æ° fieldï¼å é¤ç°æ field æå° field å¼æ´æ¹ä¸ºæ°ç±»åï¼åªéè¦å°ææ¡£æ´æ°ä¸ºæ°ç»æå³å¯ã\n\nè¿ç§çµæ´»æ§æå©äºå° document æ å°å°å®ä½æå¯¹è±¡ãæ¯ä¸ª document é½å¯ä»¥å¹éæè¡¨ç¤ºå®ä½çæ°æ®å­æ®µï¼å³ä½¿è¯¥ææ¡£ä¸éåä¸­çå¶ä»ææ¡£æå¾å¤§çä¸åãä½æ¯ï¼å®éä¸ï¼éåä¸­çææ¡£å·æç¸ä¼¼çç»æï¼å¹¶ä¸æ¨å¯ä»¥å¨æ´æ°åæå¥æä½æé´å¯¹ collection å¼ºå¶æ§è¡ document æ ¡éªè§åã\n\n\n# Document ç»æ\n\n# åµå¥å¼æ°æ®æ¨¡å\n\nåµå¥å¼ document éè¿å°ç¸å³æ°æ®å­å¨å¨åä¸ª document ç»æä¸­æ¥æè·æ°æ®ä¹é´çå³ç³»ã MongoDB document å¯ä»¥å° document ç»æåµå¥å°å¦ä¸ä¸ª document ä¸­çå­æ®µææ°ç»ä¸­ãè¿äºéè§èåçæ°æ®æ¨¡ååè®¸åºç¨ç¨åºå¨åä¸ªæ°æ®åºæä½ä¸­æ£ç´¢åæçºµç¸å³æ°æ®ã\n\n\n\nå¯¹äº MongoDB ä¸­çå¾å¤åºæ¯ï¼éè§èåæ°æ®æ¨¡åé½æ¯æä½³çã\n\n> åµå¥å¼ document æå¤§å°éå¶ï¼å¿é¡»å°äº 16 MBã\n> \n> å¦ææ¯è¾å¤§çäºè¿å¶æ°æ®ï¼å¯ä»¥èè GridFSã\n\n# å¼ç¨å¼æ°æ®æ¨¡å\n\nå¼ç¨éè¿åå«ä»ä¸ä¸ª document å°å¦ä¸ä¸ª document çé¾æ¥æå¼ç¨æ¥å­å¨æ°æ®ä¹é´çå³ç³»ã åºç¨ç¨åºå¯ä»¥è§£æè¿äºå¼ç¨ä»¥è®¿é®ç¸å³æ°æ®ã å¹¿ä¹ä¸è®²ï¼è¿äºæ¯è§èåçæ°æ®æ¨¡åã\n\n\n\néå¸¸ï¼å¨ä»¥ä¸åºæ¯ä½¿ç¨å¼ç¨å¼çæ°æ®æ¨¡åï¼\n\n * åµå¥æ¶ä¼å¯¼è´æ°æ®éå¤ï¼ä½æ æ³æä¾è¶³å¤çè¯»åæ§è½ä¼å¿ï¼æ æ³èè¿éå¤çå«ä¹ã\n * ä»£è¡¨æ´å¤æçå¤å¯¹å¤å³ç³»ã\n * ä¸ºå¤§è§æ¨¡åå±æ°æ®éå»ºæ¨¡ã\n\nä¸ºäº join collectionï¼MongoDB æ¯æèå stageï¼\n\n * $lookupï¼MongoDB 3.2 å¼å§æ¯æï¼\n * $graphLookupï¼MongoDB 3.4 å¼å§æ¯æï¼\n\nMongoDB è¿æä¾äºå¼ç¨æ¥æ¯æè·¨éå join æ°æ®ï¼\n\n * å¼ç¨æ°æ®æ¨¡åç¤ºä¾ï¼åèï¼Model One-to-Many Relationships with Document References.\n * æ´å¤æ å½¢æ¨¡åï¼åèï¼Model Tree Structures.\n\n\n# åå­åæä½\n\n# å document çåå­æ§\n\nå¨ MongoDB ä¸­ï¼éå¯¹åä¸ª document çåæä½æ¯åå­æ§çï¼å³ä½¿è¯¥ document ä¸­åµå¥äºå¤ä¸ªå­ documentã å·æåµå¥æ°æ®çéè§èåæ°æ®æ¨¡åå°ææç¸å³æ°æ®åå¹¶å¨ä¸ä¸ª document ä¸­ï¼èä¸æ¯å¨å¤ä¸ª document å collection ä¸­è¿è¡è§èåã è¯¥æ°æ®æ¨¡åæå©äºåå­æä½ã å½åä¸ªåå¥æä½ï¼ä¾å¦ db.collection.updateMany()ï¼ä¿®æ¹å¤ä¸ª document æ¶ï¼æ¯ä¸ª document çç¬ç«ä¿®æ¹æ¯åå­çï¼ä½æ´ä¸ªæä½ä¸æ¯åå­çã\n\n# å¤ document äºå¡\n\nå¯¹äºéè¦å¯¹å¤ä¸ª documentï¼å¨åä¸ªæå¤ä¸ªéåä¸­ï¼è¿è¡è¯»ååå­æ§çæåµï¼MongoDB æ¯æå¤ document äºå¡ã\n\n * å¨çæ¬ 4.0 ä¸­ï¼MongoDB å¨å¯æ¬éä¸æ¯æå¤ document äºå¡ã\n * å¨çæ¬ 4.2 ä¸­ï¼MongoDB å¼å¥äºåå¸å¼äºå¡ï¼å®å¢å äºå¯¹åçç¾¤éä¸å¤ document äºå¡çæ¯æï¼å¹¶åå¹¶äºå¯¹å¯æ¬éä¸å¤ document äºå¡çç°ææ¯æã\n\n> å¨å¤§å¤æ°æåµä¸ï¼å¤ document äºå¡ä¼æ¯å document çåå¥äº§çæ´é«çæ§è½æ¶èï¼å¹¶ä¸å¤ document äºå¡çå¯ç¨æ§ä¸è½æ¿ä»£é«æçç»æè®¾è®¡ã å¨è®¸å¤æåµä¸ï¼éè§èåæ°æ®æ¨¡åï¼åµå¥å¼ document åæ°ç»ï¼ä»æ¯æä½³éæ©ã ä¹å°±æ¯è¯´ï¼åççæ°æ®å»ºæ¨¡ï¼å°æå¤§ç¨åº¦å°åå°å¯¹å¤ document äºå¡çéæ±ã\n\n\n# æ°æ®ä½¿ç¨åæ§è½\n\nå¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼è¯·èèåºç¨ç¨åºå°å¦ä½ä½¿ç¨æ¨çæ°æ®åºã ä¾å¦ï¼å¦ææ¨çåºç¨ç¨åºä»ä½¿ç¨æè¿æå¥ç documentï¼è¯·èèä½¿ç¨ä¸ééåã æèï¼å¦ææ¨çåºç¨ç¨åºä¸»è¦æ¯å¯¹ collection çè¯»åæä½ï¼åæ·»å ç´¢å¼ä»¥æé«æ§è½ã\n\n\n# Schema æ ¡éª\n\n\n# æå®æ ¡éªè§å\n\nå¦æåå»ºæ° collection æ¶è¦æå®æ ¡éªè§åï¼éè¦å¨ä½¿ç¨ db.createCollection() æ¶æå® validator éé¡¹ã\n\nå¦æè¦å° document æ ¡éªæ·»å å°ç°æ collection ä¸­ï¼éè¦ä½¿ç¨å¸¦æ validator éé¡¹ç collMod å½ä»¤ã\n\nMongoDB è¿æä¾ä»¥ä¸ç¸å³éé¡¹ï¼\n\n * validationLevel éé¡¹ï¼ç¨äºç¡®å® MongoDB å¨æ´æ°è¿ç¨ä¸­ï¼å¯¹ç°æ document åºç¨æ ¡éªè§åçä¸¥æ ¼ç¨åº¦ï¼\n * validationAction éé¡¹ï¼ç¨äºç¡®å® MongoDB åç°è¿åæ ¡éªè§åç document æ¶ï¼æ¯éæ©æ¥éå¹¶æç»ï¼è¿æ¯æ¥åæ°æ®ä½å¨æ¥å¿ä¸­åè­¦ï¼ã\n\n\n# JSON Schema\n\nä» 3.6 çæ¬å¼å§ï¼MongoDB å¼å§æ¯æ JSON Schema æ ¡éªã\n\nå¯ä»¥éè¿å¨ validator è¡¨è¾¾å¼ä¸­ä½¿ç¨ $jsonSchema æä½æ¥æå® JSON Schema æ ¡éªã\n\nãç¤ºä¾ã\n\ndb.createCollection('students', {\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['name', 'year', 'major', 'address'],\n      properties: {\n        name: {\n          bsonType: 'string',\n          description: 'must be a string and is required',\n        },\n        year: {\n          bsonType: 'int',\n          minimum: 2017,\n          maximum: 3017,\n          description: 'must be an integer in [ 2017, 3017 ] and is required',\n        },\n        major: {\n          enum: ['Math', 'English', 'Computer Science', 'History', null],\n          description: 'can only be one of the enum values and is required',\n        },\n        gpa: {\n          bsonType: ['double'],\n          description: 'must be a double if the field exists',\n        },\n        address: {\n          bsonType: 'object',\n          required: ['city'],\n          properties: {\n            street: {\n              bsonType: 'string',\n              description: 'must be a string if the field exists',\n            },\n            city: {\n              bsonType: 'string',\n              description: 'must be a string and is required',\n            },\n          },\n        },\n      },\n    },\n  },\n})\n\n\n\n# å¶å®æ¥è¯¢è¡¨è¾¾å¼\n\né¤äºä½¿ç¨ $jsonSchema æ¥è¯¢è¿ç®ç¬¦ç JSON Schema æ ¡éªå¤ï¼MongoDB è¿æ¯æå¶å®æ¥è¯¢è¿ç®ç¬¦çæ ¡éªï¼ä½ä»¥ä¸æåµé¤å¤ï¼\n\n * $near,\n * $nearSphere,\n * $text,\n * $where, and\n * å¸¦æ $function è¡¨è¾¾å¼ç $expr\n\nãç¤ºä¾ãæ¥è¯¢è¡¨è¾¾å¼ä¸­æå®æ ¡éªè§å\n\ndb.createCollection('contacts', {\n  validator: {\n    $or: [\n      { phone: { $type: 'string' } },\n      { email: { $regex: /@mongodb\\.com$/ } },\n      { status: { $in: ['Unknown', 'Incomplete'] } },\n    ],\n  },\n})\n\n\n\n# è¡ä¸º\n\næ ¡éªåçå¨æ´æ°åæå¥æé´ãæ·»å æ ¡éªè§åå° collection æ¶ï¼ä¸ä¼å¯¹ç°æç document è¿è¡æ ¡éªï¼é¤éåçä¿®æ¹æä½ã\n\n# ç°æç document\n\nvalidationLevel éé¡¹ç¡®å® MongoDB è¿è¡è§åæ ¡éªæ¶æ§è¡çæä½ï¼\n\n * å¦æ validationLevel æ¯ strictï¼ä¸¥æ ¼çº§å«ãè¿æ¯ MongoDB é»è®¤çº§å«ï¼ï¼å MongoDB å°æ ¡éªè§ååºç¨äºæææå¥åæ´æ°ã\n * å¦æ validationLevel æ¯ moderateï¼ä¸­ç­çº§å«ï¼ï¼å MongoDB åªå¯¹å·²æ»¡è¶³æ ¡éªæ¡ä»¶çç°æææ¡£çæå¥åæ´æ°æä½è¿è¡æ ¡éªï¼å¯¹ä¸ç¬¦åæ ¡éªæ åçç°æææ¡£çæ´æ°æä½ä¸è¿è¡æ ¡éªã\n\nãç¤ºä¾ã\n\nä¸é¢æ¯ä¸ä¸ªæ­£å¸¸çæå¥æä½ï¼\n\ndb.contacts.insert([\n  {\n    _id: 1,\n    name: 'Anne',\n    phone: '+1 555 123 456',\n    city: 'London',\n    status: 'Complete',\n  },\n  { _id: 2, name: 'Ivan', city: 'Vancouver' },\n])\n\n\nå¨ collection ä¸éç½®ä¸ä¸ªæ ¡éªè§åï¼\n\ndb.runCommand({\n  collMod: 'contacts',\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['phone', 'name'],\n      properties: {\n        phone: {\n          bsonType: 'string',\n          description: 'must be a string and is required',\n        },\n        name: {\n          bsonType: 'string',\n          description: 'must be a string and is required',\n        },\n      },\n    },\n  },\n  validationLevel: 'moderate',\n})\n\n\nå contacts collection ç°å¨æ·»å äºå«ä¸­ç­çº§å«ï¼moderateï¼ validationLevel ç validatorï¼\n\n * å¦æå°è¯æ´æ° _idä¸º 1 çææ¡£ï¼å MongoDB å°åºç¨æ ¡éªè§åï¼å ä¸ºç°æææ¡£ç¬¦åæ¡ä»¶ã\n\n * ç¸åï¼MongoDB ä¸ä¼å°æ ¡éª _id ä¸º 2 çææ¡£ï¼å ä¸ºå®ä¸ç¬¦åæ ¡éªè§åã\n\nå¦æè¦å®å¨ç¦ç¨æ ¡éªï¼å¯ä»¥å° validationLevel ç½®ä¸º offã\n\n# æ¥åææç»æ æç document\n\n * å¦æ validationAction æ¯ Errorï¼é»è®¤ï¼ï¼å MongoDB æç»ä»»ä½è¿åæ ¡éªè§åçæå¥ææ´æ°ã\n * å¦æ validationAction æ¯ Warnï¼MongoDB ä¼è®°å½ææçè¿è§ï¼ä½åè®¸è¿è¡æå¥ææ´æ°ã\n\nãç¤ºä¾ã\n\nåå»ºéåæ¶ï¼éç½® validationAction ä¸º warnã\n\ndb.createCollection('contacts2', {\n  validator: {\n    $jsonSchema: {\n      bsonType: 'object',\n      required: ['phone'],\n      properties: {\n        phone: {\n          bsonType: 'string',\n          description: 'must be a string and is required',\n        },\n        email: {\n          bsonType: 'string',\n          pattern: '@mongodb.com$',\n          description:\n            'must be a string and match the regular expression pattern',\n        },\n        status: {\n          enum: ['Unknown', 'Incomplete'],\n          description: 'can only be one of the enum values',\n        },\n      },\n    },\n  },\n  validationAction: 'warn',\n})\n\n\nå°è¯æå¥ä¸æ¡è¿è§è®°å½\n\n> db.contacts2.insert( { name: \"Amanda\", status: \"Updated\" } )\nWriteResult({ \"nInserted\" : 1 })\n\n\nMongoDB åè®¸è¿æ¡æä½æ§è¡ï¼ä½æ¯æå¡å¨ä¼è®°å½ä¸åè­¦ä¿¡æ¯ã\n\n{\"t\":{\"$date\":\"2020-09-11T16:35:57.754+08:00\"},\"s\":\"W\",  \"c\":\"STORAGE\",  \"id\":20294,   \"ctx\":\"conn14\",\"msg\":\"Document would fail validation\",\"attr\":{\"namespace\":\"test.contacts2\",\"document\":{\"_id\":{\"$oid\":\"5f5b36ed8ea53d62a0b51c4e\"},\"name\":\"Amanda\",\"status\":\"Updated\"}}}\n\n\n# éå¶\n\nä¸è½å¨ adminãlocalãconfig è¿å ä¸ªç¹æ®çæ°æ®åºä¸­æå®æ ¡éªè§åã\n\nä¸è½å¨ system.* collection ä¸­æå®æ ¡éªã\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb å»ºæ¨¡\n\nmongodb çæ°æ®æ¨¡å¼æ¯ä¸ç§çµæ´»æ¨¡å¼ï¼å³ç³»åæ°æ®åºè¦æ±ä½ å¨æå¥æ°æ®ä¹åå¿é¡»åå®ä¹å¥½ä¸ä¸ªè¡¨çæ¨¡å¼ç»æï¼è mongodb çéååå¹¶ä¸éå¶ document ç»æãè¿ç§çµæ´»æ§è®©å¯¹è±¡åæ°æ®åºææ¡£ä¹é´çæ å°åå¾å¾å®¹æãå³ä½¿æ°æ®è®°å½ä¹é´æå¾å¤§çååï¼æ¯ä¸ªææ¡£ä¹å¯ä»¥å¾å¥½çæ å°å°åæ¡ä¸åçè®°å½ã å½ç¶å¨å®éä½¿ç¨ä¸­ï¼åä¸ä¸ªéåä¸­çææ¡£å¾å¾é½æä¸ä¸ªæ¯è¾ç±»ä¼¼çç»æã\n\næ°æ®æ¨¡åè®¾è®¡ä¸­æå·æææ§çæ¯å¨åºç¨ç¨åºéæ±ï¼æ°æ®åºå¼ææ§è½è¦æ±åæ°æ®è¯»åæ¨¡å¼ä¹é´åæè¡¡èéãå½è®¾è®¡æ°æ®æ¨¡åçæ¶åï¼ä¸å®è¦èèåºç¨ç¨åºå¯¹æ°æ®çä½¿ç¨æ¨¡å¼ï¼å¦æ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çå¤©ç¶ç»æã\n\n\n# mongodb æ°æ®å»ºæ¨¡å¥é¨\n\n> åèï¼https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need\n\n\n# ï¼ä¸ï¼å®ä¹æ°æ®é\n\nå½éè¦å»ºç«æ°æ®å­å¨æ¶ï¼é¦ååºè¯¥æèä»¥ä¸é®é¢ï¼éè¦å­å¨åªäºæ°æ®ï¼è¿äºå­æ®µä¹é´å¦ä½å³èï¼\n\nè¿æ¯ä¸ä¸ªæ°æ®å»ºæ¨¡çè¿ç¨ãç®æ æ¯å°ä¸å¡éæ±æ½è±¡ä¸ºé»è¾æ¨¡åã\n\nåè®¾è¿æ ·ä¸ä¸ªåºæ¯ï¼æä»¬éè¦å»ºç«æ°æ®åºä»¥è·è¸ªç©æåå¶æ°éï¼å¤§å°ï¼æ ç­¾åç­çº§ã\n\nå¦ææ¯å­å¨å¨ rdbmsï¼å¯è½ä»¥ä¸çæ°æ®è¡¨ï¼\n\nname       quantity   size          status   tags                       rating\njournal    25         14x21,cm      a        brown, lined               9\nnotebook   50         8.5x11,in     a        college-ruled,perforated   8\npaper      100        8.5x11,in     d        watercolor                 10\nplanner    75         22.85x30,cm   d        2019                       10\npostcard   45         10x,cm        d        double-sided,white         2\n\n\n# ï¼äºï¼æè json ç»æ\n\nä»ä¸ä¾ä¸­å¯ä»¥çåºï¼è¡¨ä¼¼ä¹æ¯å­å¨æ°æ®çå¥½å°æ¹ï¼ä½è¯¥æ°æ®éä¸­çå­æ®µéè¦å¤ä¸ªå¼ï¼å¦æå¨åä¸ªåä¸­å»ºæ¨¡ï¼åä¸å®¹ææç´¢ææ¾ç¤ºï¼å¯¹äº ä¾å¦âå¤§å°åæ ç­¾ï¼ã\n\nå¨ sql æ°æ®åºä¸­ï¼æ¨å¯ä»¥éè¿åå»ºå³ç³»è¡¨æ¥è§£å³æ­¤é®é¢ã\n\nå¨ mongodb ä¸­ï¼æ°æ®å­å¨ä¸ºææ¡£ï¼documentï¼ã è¿äºææ¡£ä»¥ jsonï¼javascript å¯¹è±¡è¡¨ç¤ºæ³ï¼æ ¼å¼å­å¨å¨ mongodb ä¸­ã json ææ¡£æ¯æåµå¥å¼å­æ®µï¼å æ­¤ç¸å³æ°æ®åæ°æ®åè¡¨å¯ä»¥ä¸ææ¡£ä¸èµ·å­å¨ï¼èä¸æ¯ä¸å¤é¨è¡¨ä¸èµ·å­å¨ã\n\njson æ ¼å¼ä¸ºé®/å¼å¯¹ã å¨ json ææ¡£ä¸­ï¼å­æ®µååå¼ç¨åå·åéï¼å­æ®µååå¼å¯¹ç¨éå·åéï¼å¹¶ä¸å­æ®µéå°è£å¨âå¤§æ¬å·âï¼{}ï¼ä¸­ã\n\nå¦æè¦å¼å§å¯¹ä¸é¢çè¡ä¹ä¸è¿è¡å»ºæ¨¡ï¼ä¾å¦æ­¤è¡ï¼\n\nname       quantity   size        status   tags                       rating\nnotebook   50         8.5x11,in   a        college-ruled,perforated   8\n\næ¨å¯ä»¥ä» name å quantity å­æ®µå¼å§ã å¨ json ä¸­ï¼è¿äºå­æ®µå¦ä¸æç¤ºï¼\n\n{ \"name\": \"notebook\", \"qty\": 50 }\n\n\n\n# ï¼ä¸ï¼ç¡®å®åªäºå­æ®µä½ä¸ºåµå¥å¼æ°æ®\n\næ¥ä¸æ¥ï¼éè¦ç¡®å®åªäºå­æ®µå¯è½éè¦å¤ä¸ªå¼ãå¯ä»¥èèå°è¿äºå­æ®µä½ä¸ºåµå¥å¼ææ¡£æåµå¥å¼ææ¡£ä¸­ç åè¡¨/æ°ç» å¯¹è±¡ã\n\nä¾å¦ï¼å¨ä¸é¢çç¤ºä¾ä¸­ï¼size å¯è½åå«ä¸ä¸ªå­æ®µï¼\n\n{ \"h\": 11, \"w\": 8.5, \"uom\": \"in\" }\n\n\nand some items have multiple ratings, so ratings might be represented as a list of documents containing the field scores:\n\n[{ \"score\": 8 }, { \"score\": 9 }]\n\n\nand you might need to handle multiple tags per item. so you might store them in a list too.\n\n[\"college-ruled\", \"perforated\"]\n\n\nfinally, a json document that stores an inventory item might look like this:\n\n{\n  \"name\": \"notebook\",\n  \"qty\": 50,\n  \"rating\": [{ \"score\": 8 }, { \"score\": 9 }],\n  \"size\": { \"height\": 11, \"width\": 8.5, \"unit\": \"in\" },\n  \"status\": \"a\",\n  \"tags\": [\"college-ruled\", \"perforated\"]\n}\n\n\nthis looks very different from the tabular data structure you started with in step 1.\n\n\n# æ°æ®æ¨¡åç®ä»\n\næ°æ®å»ºæ¨¡ä¸­çå³é®æææ¯å¹³è¡¡åºç¨ç¨åºçéæ±ãæ°æ®åºå¼æçæ§è½ä»¥åæ°æ®æ£ç´¢æ¨¡å¼ã å¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼å§ç»éè¦èèæ°æ®çåºç¨ç¨åºä½¿ç¨æåµï¼å³æ°æ®çæ¥è¯¢ï¼æ´æ°åå¤çï¼ä»¥åæ°æ®æ¬èº«çåºæç»æã\n\n\n# çµæ´»ç schema\n\nå¨å³ç³»åæ°æ®åºä¸­ï¼å¿é¡»å¨æå¥æ°æ®ä¹åç¡®å®å¹¶å£°æè¡¨çç»æãè mongodb ç collection é»è®¤æåµä¸ä¸éè¦å¶ææ¡£å·æç¸åçæ¶æãä¹å°±æ¯è¯´ï¼\n\nåä¸ä¸ª collection ä¸­ç document ä¸éè¦å·æç¸åç field éï¼å¹¶ä¸ field çæ°æ®ç±»åå¯ä»¥å¨éåä¸­çä¸åææ¡£ä¹é´ææä¸åã\n\nè¦æ´æ¹ collection ä¸­ç document ç»æï¼ä¾å¦æ·»å æ° fieldï¼å é¤ç°æ field æå° field å¼æ´æ¹ä¸ºæ°ç±»åï¼åªéè¦å°ææ¡£æ´æ°ä¸ºæ°ç»æå³å¯ã\n\nè¿ç§çµæ´»æ§æå©äºå° document æ å°å°å®ä½æå¯¹è±¡ãæ¯ä¸ª document é½å¯ä»¥å¹éæè¡¨ç¤ºå®ä½çæ°æ®å­æ®µï¼å³ä½¿è¯¥ææ¡£ä¸éåä¸­çå¶ä»ææ¡£æå¾å¤§çä¸åãä½æ¯ï¼å®éä¸ï¼éåä¸­çææ¡£å·æç¸ä¼¼çç»æï¼å¹¶ä¸æ¨å¯ä»¥å¨æ´æ°åæå¥æä½æé´å¯¹ collection å¼ºå¶æ§è¡ document æ ¡éªè§åã\n\n\n# document ç»æ\n\n# åµå¥å¼æ°æ®æ¨¡å\n\nåµå¥å¼ document éè¿å°ç¸å³æ°æ®å­å¨å¨åä¸ª document ç»æä¸­æ¥æè·æ°æ®ä¹é´çå³ç³»ã mongodb document å¯ä»¥å° document ç»æåµå¥å°å¦ä¸ä¸ª document ä¸­çå­æ®µææ°ç»ä¸­ãè¿äºéè§èåçæ°æ®æ¨¡ååè®¸åºç¨ç¨åºå¨åä¸ªæ°æ®åºæä½ä¸­æ£ç´¢åæçºµç¸å³æ°æ®ã\n\n\n\nå¯¹äº mongodb ä¸­çå¾å¤åºæ¯ï¼éè§èåæ°æ®æ¨¡åé½æ¯æä½³çã\n\n> åµå¥å¼ document æå¤§å°éå¶ï¼å¿é¡»å°äº 16 mbã\n> \n> å¦ææ¯è¾å¤§çäºè¿å¶æ°æ®ï¼å¯ä»¥èè gridfsã\n\n# å¼ç¨å¼æ°æ®æ¨¡å\n\nå¼ç¨éè¿åå«ä»ä¸ä¸ª document å°å¦ä¸ä¸ª document çé¾æ¥æå¼ç¨æ¥å­å¨æ°æ®ä¹é´çå³ç³»ã åºç¨ç¨åºå¯ä»¥è§£æè¿äºå¼ç¨ä»¥è®¿é®ç¸å³æ°æ®ã å¹¿ä¹ä¸è®²ï¼è¿äºæ¯è§èåçæ°æ®æ¨¡åã\n\n\n\néå¸¸ï¼å¨ä»¥ä¸åºæ¯ä½¿ç¨å¼ç¨å¼çæ°æ®æ¨¡åï¼\n\n * åµå¥æ¶ä¼å¯¼è´æ°æ®éå¤ï¼ä½æ æ³æä¾è¶³å¤çè¯»åæ§è½ä¼å¿ï¼æ æ³èè¿éå¤çå«ä¹ã\n * ä»£è¡¨æ´å¤æçå¤å¯¹å¤å³ç³»ã\n * ä¸ºå¤§è§æ¨¡åå±æ°æ®éå»ºæ¨¡ã\n\nä¸ºäº join collectionï¼mongodb æ¯æèå stageï¼\n\n * $lookupï¼mongodb 3.2 å¼å§æ¯æï¼\n * $graphlookupï¼mongodb 3.4 å¼å§æ¯æï¼\n\nmongodb è¿æä¾äºå¼ç¨æ¥æ¯æè·¨éå join æ°æ®ï¼\n\n * å¼ç¨æ°æ®æ¨¡åç¤ºä¾ï¼åèï¼model one-to-many relationships with document references.\n * æ´å¤æ å½¢æ¨¡åï¼åèï¼model tree structures.\n\n\n# åå­åæä½\n\n# å document çåå­æ§\n\nå¨ mongodb ä¸­ï¼éå¯¹åä¸ª document çåæä½æ¯åå­æ§çï¼å³ä½¿è¯¥ document ä¸­åµå¥äºå¤ä¸ªå­ documentã å·æåµå¥æ°æ®çéè§èåæ°æ®æ¨¡åå°ææç¸å³æ°æ®åå¹¶å¨ä¸ä¸ª document ä¸­ï¼èä¸æ¯å¨å¤ä¸ª document å collection ä¸­è¿è¡è§èåã è¯¥æ°æ®æ¨¡åæå©äºåå­æä½ã å½åä¸ªåå¥æä½ï¼ä¾å¦ db.collection.updatemany()ï¼ä¿®æ¹å¤ä¸ª document æ¶ï¼æ¯ä¸ª document çç¬ç«ä¿®æ¹æ¯åå­çï¼ä½æ´ä¸ªæä½ä¸æ¯åå­çã\n\n# å¤ document äºå¡\n\nå¯¹äºéè¦å¯¹å¤ä¸ª documentï¼å¨åä¸ªæå¤ä¸ªéåä¸­ï¼è¿è¡è¯»ååå­æ§çæåµï¼mongodb æ¯æå¤ document äºå¡ã\n\n * å¨çæ¬ 4.0 ä¸­ï¼mongodb å¨å¯æ¬éä¸æ¯æå¤ document äºå¡ã\n * å¨çæ¬ 4.2 ä¸­ï¼mongodb å¼å¥äºåå¸å¼äºå¡ï¼å®å¢å äºå¯¹åçç¾¤éä¸å¤ document äºå¡çæ¯æï¼å¹¶åå¹¶äºå¯¹å¯æ¬éä¸å¤ document äºå¡çç°ææ¯æã\n\n> å¨å¤§å¤æ°æåµä¸ï¼å¤ document äºå¡ä¼æ¯å document çåå¥äº§çæ´é«çæ§è½æ¶èï¼å¹¶ä¸å¤ document äºå¡çå¯ç¨æ§ä¸è½æ¿ä»£é«æçç»æè®¾è®¡ã å¨è®¸å¤æåµä¸ï¼éè§èåæ°æ®æ¨¡åï¼åµå¥å¼ document åæ°ç»ï¼ä»æ¯æä½³éæ©ã ä¹å°±æ¯è¯´ï¼åççæ°æ®å»ºæ¨¡ï¼å°æå¤§ç¨åº¦å°åå°å¯¹å¤ document äºå¡çéæ±ã\n\n\n# æ°æ®ä½¿ç¨åæ§è½\n\nå¨è®¾è®¡æ°æ®æ¨¡åæ¶ï¼è¯·èèåºç¨ç¨åºå°å¦ä½ä½¿ç¨æ¨çæ°æ®åºã ä¾å¦ï¼å¦ææ¨çåºç¨ç¨åºä»ä½¿ç¨æè¿æå¥ç documentï¼è¯·èèä½¿ç¨ä¸ééåã æèï¼å¦ææ¨çåºç¨ç¨åºä¸»è¦æ¯å¯¹ collection çè¯»åæä½ï¼åæ·»å ç´¢å¼ä»¥æé«æ§è½ã\n\n\n# schema æ ¡éª\n\n\n# æå®æ ¡éªè§å\n\nå¦æåå»ºæ° collection æ¶è¦æå®æ ¡éªè§åï¼éè¦å¨ä½¿ç¨ db.createcollection() æ¶æå® validator éé¡¹ã\n\nå¦æè¦å° document æ ¡éªæ·»å å°ç°æ collection ä¸­ï¼éè¦ä½¿ç¨å¸¦æ validator éé¡¹ç collmod å½ä»¤ã\n\nmongodb è¿æä¾ä»¥ä¸ç¸å³éé¡¹ï¼\n\n * validationlevel éé¡¹ï¼ç¨äºç¡®å® mongodb å¨æ´æ°è¿ç¨ä¸­ï¼å¯¹ç°æ document åºç¨æ ¡éªè§åçä¸¥æ ¼ç¨åº¦ï¼\n * validationaction éé¡¹ï¼ç¨äºç¡®å® mongodb åç°è¿åæ ¡éªè§åç document æ¶ï¼æ¯éæ©æ¥éå¹¶æç»ï¼è¿æ¯æ¥åæ°æ®ä½å¨æ¥å¿ä¸­åè­¦ï¼ã\n\n\n# json schema\n\nä» 3.6 çæ¬å¼å§ï¼mongodb å¼å§æ¯æ json schema æ ¡éªã\n\nå¯ä»¥éè¿å¨ validator è¡¨è¾¾å¼ä¸­ä½¿ç¨ $jsonschema æä½æ¥æå® json schema æ ¡éªã\n\nãç¤ºä¾ã\n\ndb.createcollection('students', {\n  validator: {\n    $jsonschema: {\n      bsontype: 'object',\n      required: ['name', 'year', 'major', 'address'],\n      properties: {\n        name: {\n          bsontype: 'string',\n          description: 'must be a string and is required',\n        },\n        year: {\n          bsontype: 'int',\n          minimum: 2017,\n          maximum: 3017,\n          description: 'must be an integer in [ 2017, 3017 ] and is required',\n        },\n        major: {\n          enum: ['math', 'english', 'computer science', 'history', null],\n          description: 'can only be one of the enum values and is required',\n        },\n        gpa: {\n          bsontype: ['double'],\n          description: 'must be a double if the field exists',\n        },\n        address: {\n          bsontype: 'object',\n          required: ['city'],\n          properties: {\n            street: {\n              bsontype: 'string',\n              description: 'must be a string if the field exists',\n            },\n            city: {\n              bsontype: 'string',\n              description: 'must be a string and is required',\n            },\n          },\n        },\n      },\n    },\n  },\n})\n\n\n\n# å¶å®æ¥è¯¢è¡¨è¾¾å¼\n\né¤äºä½¿ç¨ $jsonschema æ¥è¯¢è¿ç®ç¬¦ç json schema æ ¡éªå¤ï¼mongodb è¿æ¯æå¶å®æ¥è¯¢è¿ç®ç¬¦çæ ¡éªï¼ä½ä»¥ä¸æåµé¤å¤ï¼\n\n * $near,\n * $nearsphere,\n * $text,\n * $where, and\n * å¸¦æ $function è¡¨è¾¾å¼ç $expr\n\nãç¤ºä¾ãæ¥è¯¢è¡¨è¾¾å¼ä¸­æå®æ ¡éªè§å\n\ndb.createcollection('contacts', {\n  validator: {\n    $or: [\n      { phone: { $type: 'string' } },\n      { email: { $regex: /@mongodb\\.com$/ } },\n      { status: { $in: ['unknown', 'incomplete'] } },\n    ],\n  },\n})\n\n\n\n# è¡ä¸º\n\næ ¡éªåçå¨æ´æ°åæå¥æé´ãæ·»å æ ¡éªè§åå° collection æ¶ï¼ä¸ä¼å¯¹ç°æç document è¿è¡æ ¡éªï¼é¤éåçä¿®æ¹æä½ã\n\n# ç°æç document\n\nvalidationlevel éé¡¹ç¡®å® mongodb è¿è¡è§åæ ¡éªæ¶æ§è¡çæä½ï¼\n\n * å¦æ validationlevel æ¯ strictï¼ä¸¥æ ¼çº§å«ãè¿æ¯ mongodb é»è®¤çº§å«ï¼ï¼å mongodb å°æ ¡éªè§ååºç¨äºæææå¥åæ´æ°ã\n * å¦æ validationlevel æ¯ moderateï¼ä¸­ç­çº§å«ï¼ï¼å mongodb åªå¯¹å·²æ»¡è¶³æ ¡éªæ¡ä»¶çç°æææ¡£çæå¥åæ´æ°æä½è¿è¡æ ¡éªï¼å¯¹ä¸ç¬¦åæ ¡éªæ åçç°æææ¡£çæ´æ°æä½ä¸è¿è¡æ ¡éªã\n\nãç¤ºä¾ã\n\nä¸é¢æ¯ä¸ä¸ªæ­£å¸¸çæå¥æä½ï¼\n\ndb.contacts.insert([\n  {\n    _id: 1,\n    name: 'anne',\n    phone: '+1 555 123 456',\n    city: 'london',\n    status: 'complete',\n  },\n  { _id: 2, name: 'ivan', city: 'vancouver' },\n])\n\n\nå¨ collection ä¸éç½®ä¸ä¸ªæ ¡éªè§åï¼\n\ndb.runcommand({\n  collmod: 'contacts',\n  validator: {\n    $jsonschema: {\n      bsontype: 'object',\n      required: ['phone', 'name'],\n      properties: {\n        phone: {\n          bsontype: 'string',\n          description: 'must be a string and is required',\n        },\n        name: {\n          bsontype: 'string',\n          description: 'must be a string and is required',\n        },\n      },\n    },\n  },\n  validationlevel: 'moderate',\n})\n\n\nå contacts collection ç°å¨æ·»å äºå«ä¸­ç­çº§å«ï¼moderateï¼ validationlevel ç validatorï¼\n\n * å¦æå°è¯æ´æ° _idä¸º 1 çææ¡£ï¼å mongodb å°åºç¨æ ¡éªè§åï¼å ä¸ºç°æææ¡£ç¬¦åæ¡ä»¶ã\n\n * ç¸åï¼mongodb ä¸ä¼å°æ ¡éª _id ä¸º 2 çææ¡£ï¼å ä¸ºå®ä¸ç¬¦åæ ¡éªè§åã\n\nå¦æè¦å®å¨ç¦ç¨æ ¡éªï¼å¯ä»¥å° validationlevel ç½®ä¸º offã\n\n# æ¥åææç»æ æç document\n\n * å¦æ validationaction æ¯ errorï¼é»è®¤ï¼ï¼å mongodb æç»ä»»ä½è¿åæ ¡éªè§åçæå¥ææ´æ°ã\n * å¦æ validationaction æ¯ warnï¼mongodb ä¼è®°å½ææçè¿è§ï¼ä½åè®¸è¿è¡æå¥ææ´æ°ã\n\nãç¤ºä¾ã\n\nåå»ºéåæ¶ï¼éç½® validationaction ä¸º warnã\n\ndb.createcollection('contacts2', {\n  validator: {\n    $jsonschema: {\n      bsontype: 'object',\n      required: ['phone'],\n      properties: {\n        phone: {\n          bsontype: 'string',\n          description: 'must be a string and is required',\n        },\n        email: {\n          bsontype: 'string',\n          pattern: '@mongodb.com$',\n          description:\n            'must be a string and match the regular expression pattern',\n        },\n        status: {\n          enum: ['unknown', 'incomplete'],\n          description: 'can only be one of the enum values',\n        },\n      },\n    },\n  },\n  validationaction: 'warn',\n})\n\n\nå°è¯æå¥ä¸æ¡è¿è§è®°å½\n\n> db.contacts2.insert( { name: \"amanda\", status: \"updated\" } )\nwriteresult({ \"ninserted\" : 1 })\n\n\nmongodb åè®¸è¿æ¡æä½æ§è¡ï¼ä½æ¯æå¡å¨ä¼è®°å½ä¸åè­¦ä¿¡æ¯ã\n\n{\"t\":{\"$date\":\"2020-09-11t16:35:57.754+08:00\"},\"s\":\"w\",  \"c\":\"storage\",  \"id\":20294,   \"ctx\":\"conn14\",\"msg\":\"document would fail validation\",\"attr\":{\"namespace\":\"test.contacts2\",\"document\":{\"_id\":{\"$oid\":\"5f5b36ed8ea53d62a0b51c4e\"},\"name\":\"amanda\",\"status\":\"updated\"}}}\n\n\n# éå¶\n\nä¸è½å¨ adminãlocalãconfig è¿å ä¸ªç¹æ®çæ°æ®åºä¸­æå®æ ¡éªè§åã\n\nä¸è½å¨ system.* collection ä¸­æå®æ ¡éªã\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB å»ºæ¨¡ç¤ºä¾",frontmatter:{title:"MongoDB å»ºæ¨¡ç¤ºä¾",date:"2020-09-12T10:43:53.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","å»ºæ¨¡"],permalink:"/pages/646187/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/06.MongoDB%E5%BB%BA%E6%A8%A1%E7%A4%BA%E4%BE%8B.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/06.MongoDBå»ºæ¨¡ç¤ºä¾.md",key:"v-1fb153de",path:"/pages/646187/",headers:[{level:2,title:"å³ç³»åæ¨¡å",slug:"å³ç³»åæ¨¡å",normalizedTitle:"å³ç³»åæ¨¡å",charIndex:19},{level:3,title:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å",slug:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å",charIndex:29},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å-åµå¥å¼ææ¡£æ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",charIndex:45},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å-å­éæ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼",charIndex:466},{level:3,title:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",slug:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",charIndex:3099},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å-åµå¥å¼ææ¡£æ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼",charIndex:3115},{level:4,title:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼",slug:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å-å­éæ¨¡å¼",normalizedTitle:"åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼",charIndex:3788},{level:3,title:"å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",slug:"å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",normalizedTitle:"å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å",charIndex:5670},{level:2,title:"æ å½¢ç»ææ¨¡å",slug:"æ å½¢ç»ææ¨¡å",normalizedTitle:"æ å½¢ç»ææ¨¡å",charIndex:7560},{level:3,title:"å·æç¶èç¹çæ å½¢ç»ææ¨¡å",slug:"å·æç¶èç¹çæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æç¶èç¹çæ å½¢ç»ææ¨¡å",charIndex:7573},{level:3,title:"å·æå­èç¹çæ å½¢ç»ææ¨¡å",slug:"å·æå­èç¹çæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æå­èç¹çæ å½¢ç»ææ¨¡å",charIndex:8181},{level:3,title:"å·æç¥åçæ å½¢ç»ææ¨¡å",slug:"å·æç¥åçæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æç¥åçæ å½¢ç»ææ¨¡å",charIndex:8800},{level:3,title:"å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å",slug:"å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å",charIndex:9685},{level:3,title:"å·æåµå¥éçæ å½¢ç»ææ¨¡å",slug:"å·æåµå¥éçæ å½¢ç»ææ¨¡å",normalizedTitle:"å·æåµå¥éçæ å½¢ç»ææ¨¡å",charIndex:10414},{level:2,title:"è®¾è®¡æ¨¡å¼",slug:"è®¾è®¡æ¨¡å¼",normalizedTitle:"è®¾è®¡æ¨¡å¼",charIndex:11022},{level:3,title:"å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼",slug:"å¤§ææ¡£-å¾å¤å-å¾å¤ç´¢å¼",normalizedTitle:"å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼",charIndex:11031},{level:3,title:"ç®¡çææ¡£ä¸åçæ¬",slug:"ç®¡çææ¡£ä¸åçæ¬",normalizedTitle:"ç®¡çææ¡£ä¸åçæ¬",charIndex:11061},{level:3,title:"ç»è®¡ç½é¡µç¹å»é",slug:"ç»è®¡ç½é¡µç¹å»é",normalizedTitle:"ç»è®¡ç½é¡µç¹å»é",charIndex:11165},{level:3,title:"ç²¾ç¡®ç»è®¡",slug:"ç²¾ç¡®ç»è®¡",normalizedTitle:"ç²¾ç¡®ç»è®¡",charIndex:11250},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:11271}],headersStr:"å³ç³»åæ¨¡å åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼ åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼ åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼ åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼ å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å æ å½¢ç»ææ¨¡å å·æç¶èç¹çæ å½¢ç»ææ¨¡å å·æå­èç¹çæ å½¢ç»ææ¨¡å å·æç¥åçæ å½¢ç»ææ¨¡å å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å å·æåµå¥éçæ å½¢ç»ææ¨¡å è®¾è®¡æ¨¡å¼ å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼ ç®¡çææ¡£ä¸åçæ¬ ç»è®¡ç½é¡µç¹å»é ç²¾ç¡®ç»è®¡ åèèµæ",content:'# MongoDB å»ºæ¨¡ç¤ºä¾\n\n\n# å³ç³»åæ¨¡å\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "Joe Bookreader"\n}\n\n// address document\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 Fake Street",\n   city: "Faketon",\n   state: "MA",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "Joe Bookreader",\n  "address": {\n    "street": "123 Fake Street",\n    "city": "Faketon",\n    "state": "MA",\n    "zip": "12345"\n  }\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nåè®¾ï¼æä¸ä¸ªç¨äºæè¿°çµå½±ä¿¡æ¯ç collection å®ä¹ï¼\n\n{\n  "_id": 1,\n  "title": "The Arrival of a Train",\n  "year": 1896,\n  "runtime": 1,\n  "released": ISODate("01-25-1896"),\n  "poster": "http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg",\n  "plot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...",\n  "fullplot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": ISODate("2015-08-15T10:06:53"),\n  "type": "movie",\n  "directors": ["Auguste LumiÃ¨re", "Louis LumiÃ¨re"],\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "countries": ["France"],\n  "genres": ["Documentary", "Short"],\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numReviews": 59\n    },\n    "lastUpdated": ISODate("2020-01-09T00:02:53")\n  }\n}\n\n\nå¨åºç¨ä¸­ï¼æçåºæ¯åªéè¦æ¾ç¤ºçµå½±çç®åæµè§ä¿¡æ¯ï¼ä¸éè¦æ¾ç¤ºç±»ä¼¼ fullplotãposter è¿æ ·çè¯¦ç»ä¿¡æ¯ãå ä¸ºï¼æä»¬å¯ä»¥èèå°åç»æä¸ä»½ä¸ºäºï¼å¹¶éè¿ id å­æ®µå³èèµ·æ¥ã\n\nç¨äºå±ç¤ºæè¦ä¿¡æ¯ç movie collection\n\n// movie collection\n\n{\n  "_id": 1,\n  "title": "The Arrival of a Train",\n  "year": 1896,\n  "runtime": 1,\n  "released": ISODate("1896-01-25"),\n  "type": "movie",\n  "directors": ["Auguste LumiÃ¨re", "Louis LumiÃ¨re"],\n  "countries": ["France"],\n  "genres": ["Documentary", "Short"]\n}\n\n\nç¨äºå±ç¤ºç»èä¿¡æ¯ç movie_details collection\n\n// movie_details collection\n\n{\n  "_id": 156,\n  "movie_id": 1, // reference to the movie collection\n  "poster": "http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg",\n  "plot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ...",\n  "fullplot": "A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": ISODate("2015-08-15T10:06:53"),\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numReviews": 59\n    },\n    "lastUpdated": ISODate("2020-01-29T00:02:53")\n  }\n}\n\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "Joe Bookreader"\n}\n\n// address documents\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 Fake Street",\n   city: "Faketon",\n   state: "MA",\n   zip: "12345"\n}\n\n{\n   patron_id: "joe",\n   street: "1 Some Other Street",\n   city: "Boston",\n   state: "MA",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "Joe Bookreader",\n  "addresses": [\n    {\n      "street": "123 Fake Street",\n      "city": "Faketon",\n      "state": "MA",\n      "zip": "12345"\n    },\n    {\n      "street": "1 Some Other Street",\n      "city": "Boston",\n      "state": "MA",\n      "zip": "12345"\n    }\n  ]\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nèèä¸ä¸ªçµåç½ç«ç¨äºè¡¨ç¤ºååç collectionï¼\n\n{\n  "_id": 1,\n  "name": "Super Widget",\n  "description": "This is the most useful item in your toolbox.",\n  "price": { "value": NumberDecimal("119.99"), "currency": "USD" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "Kristina",\n      "review_text": "This is indeed an amazing widget.",\n      "published_date": ISODate("2019-02-18")\n    },\n    {\n      "review_id": 785,\n      "review_author": "Trina",\n      "review_text": "Nice product. Slow shipping.",\n      "published_date": ISODate("2019-02-17")\n    },\n    ...{\n      "review_id": 1,\n      "review_author": "Hans",\n      "review_text": "Meh, it\'s okay.",\n      "published_date": ISODate("2017-12-06")\n    }\n  ]\n}\n\n\nè¯è®ºææ¶é´ååºæåã å½ç¨æ·è®¿é®äº§åé¡µé¢æ¶ï¼åºç¨ç¨åºå°å è½½åæ¡æè¿çè¯è®ºãå¯ä»¥å°éååä¸ºä¸¤ä¸ªéåï¼èä¸æ¯ä¸äº§åä¸èµ·å­å¨ææè¯è®ºï¼\n\näº§åéåå­å¨æå³æ¯ä¸ªäº§åçä¿¡æ¯ï¼åæ¬äº§åçåä¸ªææ°è¯è®ºï¼\n\n{\n  "_id": 1,\n  "name": "Super Widget",\n  "description": "This is the most useful item in your toolbox.",\n  "price": { "value": NumberDecimal("119.99"), "currency": "USD" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "Kristina",\n      "review_text": "This is indeed an amazing widget.",\n      "published_date": ISODate("2019-02-18")\n    }\n    ...\n    {\n      "review_id": 776,\n      "review_author": "Pablo",\n      "review_text": "Amazing!",\n      "published_date": ISODate("2019-02-16")\n    }\n  ]\n}\n\n\nreview collection å­å¨ææçè¯è®º\n\n{\n  "review_id": 786,\n  "product_id": 1,\n  "review_author": "Kristina",\n  "review_text": "This is indeed an amazing widget.",\n  "published_date": ISODate("2019-02-18")\n}\n{\n  "review_id": 785,\n  "product_id": 1,\n  "review_author": "Trina",\n  "review_text": "Nice product. Slow shipping.",\n  "published_date": ISODate("2019-02-17")\n}\n...\n{\n  "review_id": 1,\n  "product_id": 1,\n  "review_author": "Hans",\n  "review_text": "Meh, it\'s okay.",\n  "published_date": ISODate("2017-12-06")\n}\n\n\n\n# å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\nèèä»¥ä¸æ å°åºçååä¹¦ç±å³ç³»çç¤ºä¾ã\n\nè¯¥ç¤ºä¾è¯´æäºå¼ç¨å¼ææ¡£çä¼ç¹ï¼ä»¥é¿åéå¤åå¸èä¿¡æ¯ã\n\n{\n   title: "MongoDB: The Definitive Guide",\n   author: [ "Kristina Chodorow", "Mike Dirolf" ],\n   published_date: ISODate("2010-09-24"),\n   pages: 216,\n   language: "English",\n   publisher: {\n              name: "O\'Reilly Media",\n              founded: 1980,\n              location: "CA"\n            }\n}\n\n{\n   title: "50 Tips and Tricks for MongoDB Developer",\n   author: "Kristina Chodorow",\n   published_date: ISODate("2011-05-06"),\n   pages: 68,\n   language: "English",\n   publisher: {\n              name: "O\'Reilly Media",\n              founded: 1980,\n              location: "CA"\n            }\n}\n\n\nä¸ºé¿åéå¤åºçåæ°æ®ï¼å¯ä»¥ä½¿ç¨å¼ç¨åææ¡£ï¼å¹¶å°åºçåä¿¡æ¯ä¸ä¹¦æ¬åå¼ä¿å­ã ä½¿ç¨å¼ç¨æ¶ï¼å³ç³»çå¢é¿å³å®äºå°å¼ç¨å­å¨å¨ä½å¤ã å¦ææ¯ä¸ªåºçåçå¾ä¹¦æ°éå¾å°ä¸å¢é¿æéï¼åææ¶å°å¾ä¹¦åèå­å¨å¨åºçåææ¡£ä¸­å¯è½ä¼å¾æç¨ã å¦åï¼å¦ææ¯ä¸ªåå¸èçä¹¦ç±æ°éä¸åéå¶ï¼åæ­¤æ°æ®æ¨¡åå°å¯¼è´å¯åçï¼ä¸æ­å¢é¿çæ°ç»ï¼å¦ä»¥ä¸ç¤ºä¾æç¤ºï¼\n\n{\n   name: "O\'Reilly Media",\n   founded: 1980,\n   location: "CA",\n   books: [123456789, 234567890, ...]\n}\n\n{\n    _id: 123456789,\n    title: "MongoDB: The Definitive Guide",\n    author: [ "Kristina Chodorow", "Mike Dirolf" ],\n    published_date: ISODate("2010-09-24"),\n    pages: 216,\n    language: "English"\n}\n\n{\n   _id: 234567890,\n   title: "50 Tips and Tricks for MongoDB Developer",\n   author: "Kristina Chodorow",\n   published_date: ISODate("2011-05-06"),\n   pages: 68,\n   language: "English"\n}\n\n\nä¸ºäºé¿åå¯åçï¼å¢é¿çæ°ç»ï¼è¯·å°åè¡èåèå­å¨å¨ä¹¦ç±ææ¡£ä¸­ï¼\n\n{\n   _id: "oreilly",\n   name: "O\'Reilly Media",\n   founded: 1980,\n   location: "CA"\n}\n\n{\n   _id: 123456789,\n   title: "MongoDB: The Definitive Guide",\n   author: [ "Kristina Chodorow", "Mike Dirolf" ],\n   published_date: ISODate("2010-09-24"),\n   pages: 216,\n   language: "English",\n   publisher_id: "oreilly"\n}\n\n{\n   _id: 234567890,\n   title: "50 Tips and Tricks for MongoDB Developer",\n   author: "Kristina Chodorow",\n   published_date: ISODate("2011-05-06"),\n   pages: 68,\n   language: "English",\n   publisher_id: "oreilly"\n}\n\n\n\n# æ å½¢ç»ææ¨¡å\n\n\n\n\n# å·æç¶èç¹çæ å½¢ç»ææ¨¡å\n\nä¸å¾ç»æå¯ä»¥ç¨ç¶å¼ç¨æ¥è¡¨ç¤ºï¼\n\ndb.categories.insertMany([\n  { "_id": "MongoDB", "parent": "Databases" },\n  { "_id": "dbm", "parent": "Databases" },\n  { "_id": "Databases", "parent": "Programming" },\n  { "_id": "Languages", "parent": "Programming" },\n  { "_id": "Programming", "parent": "Books" },\n  { "_id": "Books", "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¶èç¹ï¼\n   \n   db.categories.findOne( { _id: "MongoDB" } ).parent\n   \n\n * å¯ä»¥å¨ç¶å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨ç¶èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createIndex( { parent: 1 } )\n   \n\n * å¯ä»¥éè¿ç¶å­æ®µæ¥è¯¢æ¾å°å¶ç´æ¥å­èç¹ï¼\n   \n   db.categories.find( { parent: "Databases" } )\n   \n\n * æ£ç´¢å­æ ï¼å¯ä»¥åèï¼ $graphLookup.\n\n\n# å·æå­èç¹çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertMany([\n  { "_id": "MongoDB", "children": [] },\n  { "_id": "dbm", "children": [] },\n  { "_id": "Databases", "children": ["MongoDB", "dbm"] },\n  { "_id": "Languages", "children": [] },\n  { "_id": "Programming", "children": ["Databases", "Languages"] },\n  { "_id": "Books", "children": ["Programming"] }\n])\n\n\n * æ£ç´¢èç¹ç childrenï¼\n   \n   db.categories.findOne( { _id: "Databases" } ).children\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨å­èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createIndex( { children: 1 } )\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸­æ¥è¯¢èç¹ï¼ä»¥æ¾å°å¶ç¶èç¹åå¶åå¼èç¹ï¼\n   \n   db.categories.find( { children: "MongoDB" } )\n   \n\n\n# å·æç¥åçæ å½¢ç»ææ¨¡å\n\ndb.categories.insertMany([\n  {\n    "_id": "MongoDB",\n    "ancestors": ["Books", "Programming", "Databases"],\n    "parent": "Databases"\n  },\n  {\n    "_id": "dbm",\n    "ancestors": ["Books", "Programming", "Databases"],\n    "parent": "Databases"\n  },\n  {\n    "_id": "Databases",\n    "ancestors": ["Books", "Programming"],\n    "parent": "Programming"\n  },\n  {\n    "_id": "Languages",\n    "ancestors": ["Books", "Programming"],\n    "parent": "Programming"\n  },\n  { "_id": "Programming", "ancestors": ["Books"], "parent": "Books" },\n  { "_id": "Books", "ancestors": [], "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¥åæè·¯å¾çæ¥è¯¢æ¯å¿«éèç´æ¥çï¼\n   \n   db.categories.findOne({ "_id": "MongoDB" }).ancestors\n   \n\n * å¯ä»¥å¨ ancestors å­æ®µä¸åå»ºç´¢å¼ï¼ä»¥å¯ç¨ç¥åèç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createIndex({ "ancestors": 1 })\n   \n\n * å¯ä»¥éè¿ ancestors å­æ®µæ¥è¯¢æ¥æ¾å¶ææåä»£ï¼\n   \n   db.categories.find({ "ancestors": "Programming" })\n   \n\n\n# å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertMany([\n  { "_id": "Books", "path": null },\n  { "_id": "Programming", "path": ",Books," },\n  { "_id": "Databases", "path": ",Books,Programming," },\n  { "_id": "Languages", "path": ",Books,Programming," },\n  { "_id": "MongoDB", "path": ",Books,Programming,Databases," },\n  { "_id": "dbm", "path": ",Books,Programming,Databases," }\n])\n\n\n * å¯ä»¥æ¥è¯¢ä»¥æ£ç´¢æ´ä¸ªæ ï¼å¹¶æå­æ®µè·¯å¾æåºï¼\n   \n   db.categories.find().sort( { path: 1 } )\n   \n\n * å¯ä»¥å¨ path å­æ®µä¸ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¥æ¥æ¾ Programming çåä»£\n   \n   db.categories.find( { path: /,Programming,/ } )\n   \n\n * å¯ä»¥æ£ç´¢ Books çåä»£ï¼å¶ä¸­ Books ä¹ä½äºå±æ¬¡ç»æçæé«çº§å«ï¼\n   \n   db.categories.find( { path: /^,Books,/ } )\n   \n\n * è¦å¨ path å­æ®µä¸åå»ºç´¢å¼ï¼è¯·ä½¿ç¨ä»¥ä¸è°ç¨ï¼\n   \n   db.categories.createIndex( { path: 1 } )\n   \n\n\n# å·æåµå¥éçæ å½¢ç»ææ¨¡å\n\n\n\ndb.categories.insertMany([\n  { _id: \'Books\', parent: 0, left: 1, right: 12 },\n  { _id: \'Programming\', parent: \'Books\', left: 2, right: 11 },\n  { _id: \'Languages\', parent: \'Programming\', left: 3, right: 4 },\n  { _id: \'Databases\', parent: \'Programming\', left: 5, right: 10 },\n  { _id: \'MongoDB\', parent: \'Databases\', left: 6, right: 7 },\n  { _id: \'dbm\', parent: \'Databases\', left: 8, right: 9 },\n])\n\n\nå¯ä»¥æ¥è¯¢ä»¥æ£ç´¢èç¹çåä»£ï¼\n\nvar databaseCategory = db.categories.findOne({ _id: \'Databases\' })\ndb.categories.find({\n  left: { $gt: databaseCategory.left },\n  right: { $lt: databaseCategory.right },\n})\n\n\n\n# è®¾è®¡æ¨¡å¼\n\n\n# å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼\n\nè§£å³æ¹æ¡æ¯ï¼åè½¬è¡\n\n\n\n\n# ç®¡çææ¡£ä¸åçæ¬\n\nMongoDB ææ¡£æ ¼å¼éå¸¸çµæ´»ï¼å¿å¿ä¼å¸¦æ¥çæ¬ç»´æ¤ä¸çé¾åº¦ã\n\nè§£å³æ¹æ¡æ¯ï¼å¯ä»¥å¢å ä¸ä¸ªçæ¬å·å­æ®µ\n\n * å¿«éè¿æ»¤æä¸éè¦åçº§çææ¡£\n * åçº§æ¶ï¼å¯¹ä¸åçæ¬çææ¡£åä¸åå¤ç\n\n\n# ç»è®¡ç½é¡µç¹å»é\n\nç»è®¡æ°æ®ç²¾ç¡®æ§è¦æ±å¹¶ä¸æ¯ååéè¦ã\n\nè§£å³æ¹æ¡ï¼ç¨è¿ä¼¼è®¡ç®\n\næ¯é 10 æ¬¡åä¸æ¬¡ï¼\n\n{ "$inc": { "views": 1 } }\n\n\n\n# ç²¾ç¡®ç»è®¡\n\nè§£å³æ¹æ¡ï¼ä½¿ç¨é¢èå\n\n\n# åèèµæ\n\n * Data Model Examples and Patterns',normalizedContent:'# mongodb å»ºæ¨¡ç¤ºä¾\n\n\n# å³ç³»åæ¨¡å\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "joe bookreader"\n}\n\n// address document\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 fake street",\n   city: "faketon",\n   state: "ma",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "joe bookreader",\n  "address": {\n    "street": "123 fake street",\n    "city": "faketon",\n    "state": "ma",\n    "zip": "12345"\n  }\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹ä¸å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nåè®¾ï¼æä¸ä¸ªç¨äºæè¿°çµå½±ä¿¡æ¯ç collection å®ä¹ï¼\n\n{\n  "_id": 1,\n  "title": "the arrival of a train",\n  "year": 1896,\n  "runtime": 1,\n  "released": isodate("01-25-1896"),\n  "poster": "http://ia.media-imdb.com/images/m/mv5bmjeyndk5mdyzov5bml5banbnxkftztgwnjixmtewmze@._v1_sx300.jpg",\n  "plot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, ...",\n  "fullplot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, the line dissolves. the doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": isodate("2015-08-15t10:06:53"),\n  "type": "movie",\n  "directors": ["auguste lumiere", "louis lumiere"],\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "countries": ["france"],\n  "genres": ["documentary", "short"],\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numreviews": 59\n    },\n    "lastupdated": isodate("2020-01-09t00:02:53")\n  }\n}\n\n\nå¨åºç¨ä¸­ï¼æçåºæ¯åªéè¦æ¾ç¤ºçµå½±çç®åæµè§ä¿¡æ¯ï¼ä¸éè¦æ¾ç¤ºç±»ä¼¼ fullplotãposter è¿æ ·çè¯¦ç»ä¿¡æ¯ãå ä¸ºï¼æä»¬å¯ä»¥èèå°åç»æä¸ä»½ä¸ºäºï¼å¹¶éè¿ id å­æ®µå³èèµ·æ¥ã\n\nç¨äºå±ç¤ºæè¦ä¿¡æ¯ç movie collection\n\n// movie collection\n\n{\n  "_id": 1,\n  "title": "the arrival of a train",\n  "year": 1896,\n  "runtime": 1,\n  "released": isodate("1896-01-25"),\n  "type": "movie",\n  "directors": ["auguste lumiere", "louis lumiere"],\n  "countries": ["france"],\n  "genres": ["documentary", "short"]\n}\n\n\nç¨äºå±ç¤ºç»èä¿¡æ¯ç movie_details collection\n\n// movie_details collection\n\n{\n  "_id": 156,\n  "movie_id": 1, // reference to the movie collection\n  "poster": "http://ia.media-imdb.com/images/m/mv5bmjeyndk5mdyzov5bml5banbnxkftztgwnjixmtewmze@._v1_sx300.jpg",\n  "plot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, ...",\n  "fullplot": "a group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. when the train stops at the platform, the line dissolves. the doors of the railway-cars open, and people on the platform help passengers to get off.",\n  "lastupdated": isodate("2015-08-15t10:06:53"),\n  "imdb": {\n    "rating": 7.3,\n    "votes": 5043,\n    "id": 12\n  },\n  "tomatoes": {\n    "viewer": {\n      "rating": 3.7,\n      "numreviews": 59\n    },\n    "lastupdated": isodate("2020-01-29t00:02:53")\n  }\n}\n\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - åµå¥å¼ææ¡£æ¨¡å¼\n\n// patron document\n{\n   _id: "joe",\n   name: "joe bookreader"\n}\n\n// address documents\n{\n   patron_id: "joe", // reference to patron document\n   street: "123 fake street",\n   city: "faketon",\n   state: "ma",\n   zip: "12345"\n}\n\n{\n   patron_id: "joe",\n   street: "1 some other street",\n   city: "boston",\n   state: "ma",\n   zip: "12345"\n}\n\n\nåå¹¶ä¸ºï¼\n\n{\n  "_id": "joe",\n  "name": "joe bookreader",\n  "addresses": [\n    {\n      "street": "123 fake street",\n      "city": "faketon",\n      "state": "ma",\n      "zip": "12345"\n    },\n    {\n      "street": "1 some other street",\n      "city": "boston",\n      "state": "ma",\n      "zip": "12345"\n    }\n  ]\n}\n\n\n# åµå¥å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å - å­éæ¨¡å¼\n\nèèä¸ä¸ªçµåç½ç«ç¨äºè¡¨ç¤ºååç collectionï¼\n\n{\n  "_id": 1,\n  "name": "super widget",\n  "description": "this is the most useful item in your toolbox.",\n  "price": { "value": numberdecimal("119.99"), "currency": "usd" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "kristina",\n      "review_text": "this is indeed an amazing widget.",\n      "published_date": isodate("2019-02-18")\n    },\n    {\n      "review_id": 785,\n      "review_author": "trina",\n      "review_text": "nice product. slow shipping.",\n      "published_date": isodate("2019-02-17")\n    },\n    ...{\n      "review_id": 1,\n      "review_author": "hans",\n      "review_text": "meh, it\'s okay.",\n      "published_date": isodate("2017-12-06")\n    }\n  ]\n}\n\n\nè¯è®ºææ¶é´ååºæåã å½ç¨æ·è®¿é®äº§åé¡µé¢æ¶ï¼åºç¨ç¨åºå°å è½½åæ¡æè¿çè¯è®ºãå¯ä»¥å°éååä¸ºä¸¤ä¸ªéåï¼èä¸æ¯ä¸äº§åä¸èµ·å­å¨ææè¯è®ºï¼\n\näº§åéåå­å¨æå³æ¯ä¸ªäº§åçä¿¡æ¯ï¼åæ¬äº§åçåä¸ªææ°è¯è®ºï¼\n\n{\n  "_id": 1,\n  "name": "super widget",\n  "description": "this is the most useful item in your toolbox.",\n  "price": { "value": numberdecimal("119.99"), "currency": "usd" },\n  "reviews": [\n    {\n      "review_id": 786,\n      "review_author": "kristina",\n      "review_text": "this is indeed an amazing widget.",\n      "published_date": isodate("2019-02-18")\n    }\n    ...\n    {\n      "review_id": 776,\n      "review_author": "pablo",\n      "review_text": "amazing!",\n      "published_date": isodate("2019-02-16")\n    }\n  ]\n}\n\n\nreview collection å­å¨ææçè¯è®º\n\n{\n  "review_id": 786,\n  "product_id": 1,\n  "review_author": "kristina",\n  "review_text": "this is indeed an amazing widget.",\n  "published_date": isodate("2019-02-18")\n}\n{\n  "review_id": 785,\n  "product_id": 1,\n  "review_author": "trina",\n  "review_text": "nice product. slow shipping.",\n  "published_date": isodate("2019-02-17")\n}\n...\n{\n  "review_id": 1,\n  "product_id": 1,\n  "review_author": "hans",\n  "review_text": "meh, it\'s okay.",\n  "published_date": isodate("2017-12-06")\n}\n\n\n\n# å¼ç¨å¼ææ¡£ä¸å¯¹å¤å³ç³»æ¨¡å\n\nèèä»¥ä¸æ å°åºçååä¹¦ç±å³ç³»çç¤ºä¾ã\n\nè¯¥ç¤ºä¾è¯´æäºå¼ç¨å¼ææ¡£çä¼ç¹ï¼ä»¥é¿åéå¤åå¸èä¿¡æ¯ã\n\n{\n   title: "mongodb: the definitive guide",\n   author: [ "kristina chodorow", "mike dirolf" ],\n   published_date: isodate("2010-09-24"),\n   pages: 216,\n   language: "english",\n   publisher: {\n              name: "o\'reilly media",\n              founded: 1980,\n              location: "ca"\n            }\n}\n\n{\n   title: "50 tips and tricks for mongodb developer",\n   author: "kristina chodorow",\n   published_date: isodate("2011-05-06"),\n   pages: 68,\n   language: "english",\n   publisher: {\n              name: "o\'reilly media",\n              founded: 1980,\n              location: "ca"\n            }\n}\n\n\nä¸ºé¿åéå¤åºçåæ°æ®ï¼å¯ä»¥ä½¿ç¨å¼ç¨åææ¡£ï¼å¹¶å°åºçåä¿¡æ¯ä¸ä¹¦æ¬åå¼ä¿å­ã ä½¿ç¨å¼ç¨æ¶ï¼å³ç³»çå¢é¿å³å®äºå°å¼ç¨å­å¨å¨ä½å¤ã å¦ææ¯ä¸ªåºçåçå¾ä¹¦æ°éå¾å°ä¸å¢é¿æéï¼åææ¶å°å¾ä¹¦åèå­å¨å¨åºçåææ¡£ä¸­å¯è½ä¼å¾æç¨ã å¦åï¼å¦ææ¯ä¸ªåå¸èçä¹¦ç±æ°éä¸åéå¶ï¼åæ­¤æ°æ®æ¨¡åå°å¯¼è´å¯åçï¼ä¸æ­å¢é¿çæ°ç»ï¼å¦ä»¥ä¸ç¤ºä¾æç¤ºï¼\n\n{\n   name: "o\'reilly media",\n   founded: 1980,\n   location: "ca",\n   books: [123456789, 234567890, ...]\n}\n\n{\n    _id: 123456789,\n    title: "mongodb: the definitive guide",\n    author: [ "kristina chodorow", "mike dirolf" ],\n    published_date: isodate("2010-09-24"),\n    pages: 216,\n    language: "english"\n}\n\n{\n   _id: 234567890,\n   title: "50 tips and tricks for mongodb developer",\n   author: "kristina chodorow",\n   published_date: isodate("2011-05-06"),\n   pages: 68,\n   language: "english"\n}\n\n\nä¸ºäºé¿åå¯åçï¼å¢é¿çæ°ç»ï¼è¯·å°åè¡èåèå­å¨å¨ä¹¦ç±ææ¡£ä¸­ï¼\n\n{\n   _id: "oreilly",\n   name: "o\'reilly media",\n   founded: 1980,\n   location: "ca"\n}\n\n{\n   _id: 123456789,\n   title: "mongodb: the definitive guide",\n   author: [ "kristina chodorow", "mike dirolf" ],\n   published_date: isodate("2010-09-24"),\n   pages: 216,\n   language: "english",\n   publisher_id: "oreilly"\n}\n\n{\n   _id: 234567890,\n   title: "50 tips and tricks for mongodb developer",\n   author: "kristina chodorow",\n   published_date: isodate("2011-05-06"),\n   pages: 68,\n   language: "english",\n   publisher_id: "oreilly"\n}\n\n\n\n# æ å½¢ç»ææ¨¡å\n\n\n\n\n# å·æç¶èç¹çæ å½¢ç»ææ¨¡å\n\nä¸å¾ç»æå¯ä»¥ç¨ç¶å¼ç¨æ¥è¡¨ç¤ºï¼\n\ndb.categories.insertmany([\n  { "_id": "mongodb", "parent": "databases" },\n  { "_id": "dbm", "parent": "databases" },\n  { "_id": "databases", "parent": "programming" },\n  { "_id": "languages", "parent": "programming" },\n  { "_id": "programming", "parent": "books" },\n  { "_id": "books", "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¶èç¹ï¼\n   \n   db.categories.findone( { _id: "mongodb" } ).parent\n   \n\n * å¯ä»¥å¨ç¶å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨ç¶èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createindex( { parent: 1 } )\n   \n\n * å¯ä»¥éè¿ç¶å­æ®µæ¥è¯¢æ¾å°å¶ç´æ¥å­èç¹ï¼\n   \n   db.categories.find( { parent: "databases" } )\n   \n\n * æ£ç´¢å­æ ï¼å¯ä»¥åèï¼ $graphlookup.\n\n\n# å·æå­èç¹çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertmany([\n  { "_id": "mongodb", "children": [] },\n  { "_id": "dbm", "children": [] },\n  { "_id": "databases", "children": ["mongodb", "dbm"] },\n  { "_id": "languages", "children": [] },\n  { "_id": "programming", "children": ["databases", "languages"] },\n  { "_id": "books", "children": ["programming"] }\n])\n\n\n * æ£ç´¢èç¹ç childrenï¼\n   \n   db.categories.findone( { _id: "databases" } ).children\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸åå»ºç´¢å¼ä»¥å¯ç¨å­èç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createindex( { children: 1 } )\n   \n\n * å¯ä»¥å¨ children å­æ®µä¸­æ¥è¯¢èç¹ï¼ä»¥æ¾å°å¶ç¶èç¹åå¶åå¼èç¹ï¼\n   \n   db.categories.find( { children: "mongodb" } )\n   \n\n\n# å·æç¥åçæ å½¢ç»ææ¨¡å\n\ndb.categories.insertmany([\n  {\n    "_id": "mongodb",\n    "ancestors": ["books", "programming", "databases"],\n    "parent": "databases"\n  },\n  {\n    "_id": "dbm",\n    "ancestors": ["books", "programming", "databases"],\n    "parent": "databases"\n  },\n  {\n    "_id": "databases",\n    "ancestors": ["books", "programming"],\n    "parent": "programming"\n  },\n  {\n    "_id": "languages",\n    "ancestors": ["books", "programming"],\n    "parent": "programming"\n  },\n  { "_id": "programming", "ancestors": ["books"], "parent": "books" },\n  { "_id": "books", "ancestors": [], "parent": null }\n])\n\n\n * æ£ç´¢èç¹çç¥åæè·¯å¾çæ¥è¯¢æ¯å¿«éèç´æ¥çï¼\n   \n   db.categories.findone({ "_id": "mongodb" }).ancestors\n   \n\n * å¯ä»¥å¨ ancestors å­æ®µä¸åå»ºç´¢å¼ï¼ä»¥å¯ç¨ç¥åèç¹çå¿«éæç´¢ï¼\n   \n   db.categories.createindex({ "ancestors": 1 })\n   \n\n * å¯ä»¥éè¿ ancestors å­æ®µæ¥è¯¢æ¥æ¾å¶ææåä»£ï¼\n   \n   db.categories.find({ "ancestors": "programming" })\n   \n\n\n# å·æå®ä½åè·¯å¾çæ å½¢ç»ææ¨¡å\n\ndb.categories.insertmany([\n  { "_id": "books", "path": null },\n  { "_id": "programming", "path": ",books," },\n  { "_id": "databases", "path": ",books,programming," },\n  { "_id": "languages", "path": ",books,programming," },\n  { "_id": "mongodb", "path": ",books,programming,databases," },\n  { "_id": "dbm", "path": ",books,programming,databases," }\n])\n\n\n * å¯ä»¥æ¥è¯¢ä»¥æ£ç´¢æ´ä¸ªæ ï¼å¹¶æå­æ®µè·¯å¾æåºï¼\n   \n   db.categories.find().sort( { path: 1 } )\n   \n\n * å¯ä»¥å¨ path å­æ®µä¸ä½¿ç¨æ­£åè¡¨è¾¾å¼æ¥æ¥æ¾ programming çåä»£\n   \n   db.categories.find( { path: /,programming,/ } )\n   \n\n * å¯ä»¥æ£ç´¢ books çåä»£ï¼å¶ä¸­ books ä¹ä½äºå±æ¬¡ç»æçæé«çº§å«ï¼\n   \n   db.categories.find( { path: /^,books,/ } )\n   \n\n * è¦å¨ path å­æ®µä¸åå»ºç´¢å¼ï¼è¯·ä½¿ç¨ä»¥ä¸è°ç¨ï¼\n   \n   db.categories.createindex( { path: 1 } )\n   \n\n\n# å·æåµå¥éçæ å½¢ç»ææ¨¡å\n\n\n\ndb.categories.insertmany([\n  { _id: \'books\', parent: 0, left: 1, right: 12 },\n  { _id: \'programming\', parent: \'books\', left: 2, right: 11 },\n  { _id: \'languages\', parent: \'programming\', left: 3, right: 4 },\n  { _id: \'databases\', parent: \'programming\', left: 5, right: 10 },\n  { _id: \'mongodb\', parent: \'databases\', left: 6, right: 7 },\n  { _id: \'dbm\', parent: \'databases\', left: 8, right: 9 },\n])\n\n\nå¯ä»¥æ¥è¯¢ä»¥æ£ç´¢èç¹çåä»£ï¼\n\nvar databasecategory = db.categories.findone({ _id: \'databases\' })\ndb.categories.find({\n  left: { $gt: databasecategory.left },\n  right: { $lt: databasecategory.right },\n})\n\n\n\n# è®¾è®¡æ¨¡å¼\n\n\n# å¤§ææ¡£ï¼å¾å¤åï¼å¾å¤ç´¢å¼\n\nè§£å³æ¹æ¡æ¯ï¼åè½¬è¡\n\n\n\n\n# ç®¡çææ¡£ä¸åçæ¬\n\nmongodb ææ¡£æ ¼å¼éå¸¸çµæ´»ï¼å¿å¿ä¼å¸¦æ¥çæ¬ç»´æ¤ä¸çé¾åº¦ã\n\nè§£å³æ¹æ¡æ¯ï¼å¯ä»¥å¢å ä¸ä¸ªçæ¬å·å­æ®µ\n\n * å¿«éè¿æ»¤æä¸éè¦åçº§çææ¡£\n * åçº§æ¶ï¼å¯¹ä¸åçæ¬çææ¡£åä¸åå¤ç\n\n\n# ç»è®¡ç½é¡µç¹å»é\n\nç»è®¡æ°æ®ç²¾ç¡®æ§è¦æ±å¹¶ä¸æ¯ååéè¦ã\n\nè§£å³æ¹æ¡ï¼ç¨è¿ä¼¼è®¡ç®\n\næ¯é 10 æ¬¡åä¸æ¬¡ï¼\n\n{ "$inc": { "views": 1 } }\n\n\n\n# ç²¾ç¡®ç»è®¡\n\nè§£å³æ¹æ¡ï¼ä½¿ç¨é¢èå\n\n\n# åèèµæ\n\n * data model examples and patterns',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB ç´¢å¼",frontmatter:{title:"MongoDB ç´¢å¼",date:"2020-09-21T21:22:57.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","ç´¢å¼"],permalink:"/pages/1c75d4/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/07.MongoDB%E7%B4%A2%E5%BC%95.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/07.MongoDBç´¢å¼.md",key:"v-7d04d94d",path:"/pages/1c75d4/",headers:[{level:2,title:"MongoDB ç´¢å¼ç®ä»",slug:"mongodb-ç´¢å¼ç®ä»",normalizedTitle:"mongodb ç´¢å¼ç®ä»",charIndex:17},{level:3,title:"ç´¢å¼çä½ç¨",slug:"ç´¢å¼çä½ç¨",normalizedTitle:"ç´¢å¼çä½ç¨",charIndex:34},{level:3,title:"createIndex() æ¹æ³",slug:"createindex-æ¹æ³",normalizedTitle:"createindex() æ¹æ³",charIndex:284},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1542}],headersStr:"MongoDB ç´¢å¼ç®ä» ç´¢å¼çä½ç¨ createIndex() æ¹æ³ åèèµæ",content:'# MongoDB ç´¢å¼\n\n\n# MongoDB ç´¢å¼ç®ä»\n\n\n# ç´¢å¼çä½ç¨\n\nMongoDB å¨ collection æ°æ®çº§å«ä¸å®ä¹ç´¢å¼ã\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçãå¦ææ²¡æç´¢å¼ï¼MongoDB å¨è¯»åæ°æ®æ¶å¿é¡»æ«æ collection ä¸­çæ¯ä¸ª document å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æ¯éå¸¸ä½æçï¼ç¹å«æ¯å¨å¤çå¤§éçæ°æ®æ¶ãæ¥è¯¢å¯è½è¦è±è´¹å åç§çè³å åéï¼è¿ç§æ§è½å¼éæ¯ä¸å¯æ¥åçã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\n\n\n\n# createIndex() æ¹æ³\n\nMongoDB ä½¿ç¨ createIndex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateIndex() è¯­æ³å¦ä¸ï¼\n\ndb.collection.createIndex( <key and index type specification>, <options> )\n\n\ncreateIndex() å¯éåæ°åè¡¨å¦ä¸ï¼\n\nPARAMETER            TYPE            DESCRIPTION\nbackground           Boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               Boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼MongoDB çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropDups             Boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º false.\nsparse               Boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireAfterSeconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ TTL è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\nãç¤ºä¾ãä½¿ç¨ name ä½ä¸ºç´¢å¼ï¼å¹¶ä¸æç§éåºæåº\n\ndb.collection.createIndex( { name: -1 } )\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾',normalizedContent:'# mongodb ç´¢å¼\n\n\n# mongodb ç´¢å¼ç®ä»\n\n\n# ç´¢å¼çä½ç¨\n\nmongodb å¨ collection æ°æ®çº§å«ä¸å®ä¹ç´¢å¼ã\n\nç´¢å¼éå¸¸è½å¤æå¤§çæé«æ¥è¯¢çæçãå¦ææ²¡æç´¢å¼ï¼mongodb å¨è¯»åæ°æ®æ¶å¿é¡»æ«æ collection ä¸­çæ¯ä¸ª document å¹¶éåé£äºç¬¦åæ¥è¯¢æ¡ä»¶çè®°å½ã\n\nè¿ç§æ«æå¨éåçæ¥è¯¢æ¯éå¸¸ä½æçï¼ç¹å«æ¯å¨å¤çå¤§éçæ°æ®æ¶ãæ¥è¯¢å¯è½è¦è±è´¹å åç§çè³å åéï¼è¿ç§æ§è½å¼éæ¯ä¸å¯æ¥åçã\n\nç´¢å¼æ¯ç¹æ®çæ°æ®ç»æï¼ç´¢å¼å­å¨å¨ä¸ä¸ªæäºéåè¯»åçæ°æ®éåä¸­ï¼ç´¢å¼æ¯å¯¹æ°æ®åºè¡¨ä¸­ä¸åæå¤åçå¼è¿è¡æåºçä¸ç§ç»æã\n\n\n\n\n# createindex() æ¹æ³\n\nmongodb ä½¿ç¨ createindex() æ¹æ³æ¥åå»ºç´¢å¼ã\n\ncreateindex() è¯­æ³å¦ä¸ï¼\n\ndb.collection.createindex( <key and index type specification>, <options> )\n\n\ncreateindex() å¯éåæ°åè¡¨å¦ä¸ï¼\n\nparameter            type            description\nbackground           boolean         å»ºç´¢å¼è¿ç¨ä¼é»å¡å¶å®æ°æ®åºæä½ï¼background å¯æå®ä»¥åå°æ¹å¼åå»ºç´¢å¼ï¼å³å¢å  "background"\n                                     å¯éåæ°ã "background" é»è®¤å¼ä¸ºfalseã\nunique               boolean         å»ºç«çç´¢å¼æ¯å¦å¯ä¸ãæå®ä¸º true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸ºfalse.\nname                 string          ç´¢å¼çåç§°ãå¦ææªæå®ï¼mongodb çéè¿è¿æ¥ç´¢å¼çå­æ®µååæåºé¡ºåºçæä¸ä¸ªç´¢å¼åç§°ã\ndropdups             boolean         **3.0+çæ¬å·²åºå¼ã**å¨å»ºç«å¯ä¸ç´¢å¼æ¶æ¯å¦å é¤éå¤è®°å½,æå® true åå»ºå¯ä¸ç´¢å¼ãé»è®¤å¼ä¸º false.\nsparse               boolean         å¯¹ææ¡£ä¸­ä¸å­å¨çå­æ®µæ°æ®ä¸å¯ç¨ç´¢å¼ï¼è¿ä¸ªåæ°éè¦ç¹å«æ³¨æï¼å¦æè®¾ç½®ä¸º true\n                                     çè¯ï¼å¨ç´¢å¼å­æ®µä¸­ä¸ä¼æ¥è¯¢åºä¸åå«å¯¹åºå­æ®µçææ¡£.ãé»è®¤å¼ä¸º false.\nexpireafterseconds   integer         æå®ä¸ä¸ªä»¥ç§ä¸ºåä½çæ°å¼ï¼å®æ ttl è®¾å®ï¼è®¾å®éåççå­æ¶é´ã\nv                    index version   ç´¢å¼ççæ¬å·ãé»è®¤çç´¢å¼çæ¬åå³äº mongod åå»ºç´¢å¼æ¶è¿è¡ççæ¬ã\nweights              document        ç´¢å¼æéå¼ï¼æ°å¼å¨ 1 å° 99,999 ä¹é´ï¼è¡¨ç¤ºè¯¥ç´¢å¼ç¸å¯¹äºå¶ä»ç´¢å¼å­æ®µçå¾åæéã\ndefault_language     string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°å³å®äºåç¨è¯åè¯å¹²åè¯å¨çè§åçåè¡¨ã é»è®¤ä¸ºè±è¯­\nlanguage_override    string          å¯¹äºææ¬ç´¢å¼ï¼è¯¥åæ°æå®äºåå«å¨ææ¡£ä¸­çå­æ®µåï¼è¯­è¨è¦çé»è®¤ç languageï¼é»è®¤å¼ä¸º language.\n\nãç¤ºä¾ãä½¿ç¨ name ä½ä¸ºç´¢å¼ï¼å¹¶ä¸æç§éåºæåº\n\ndb.collection.createindex( { name: -1 } )\n\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB å¤å¶",frontmatter:{title:"MongoDB å¤å¶",date:"2020-09-20T23:12:17.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","å¤å¶"],permalink:"/pages/e0b65c/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/08.MongoDB%E5%A4%8D%E5%88%B6.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/08.MongoDBå¤å¶.md",key:"v-681aa558",path:"/pages/e0b65c/",headers:[{level:2,title:"å¯æ¬åå¯ç¨æ§",slug:"å¯æ¬åå¯ç¨æ§",normalizedTitle:"å¯æ¬åå¯ç¨æ§",charIndex:17},{level:2,title:"MongoDB å¯æ¬",slug:"mongodb-å¯æ¬",normalizedTitle:"mongodb å¯æ¬",charIndex:214},{level:2,title:"å¼æ­¥å¤å¶",slug:"å¼æ­¥å¤å¶",normalizedTitle:"å¼æ­¥å¤å¶",charIndex:689},{level:3,title:"æ¢æä½",slug:"æ¢æä½",normalizedTitle:"æ¢æä½",charIndex:698},{level:3,title:"å¤å¶å»¶è¿åæµæ§",slug:"å¤å¶å»¶è¿åæµæ§",normalizedTitle:"å¤å¶å»¶è¿åæµæ§",charIndex:970},{level:2,title:"æéè½¬ç§»",slug:"æéè½¬ç§»",normalizedTitle:"æéè½¬ç§»",charIndex:1291},{level:2,title:"è¯»æä½",slug:"è¯»æä½",normalizedTitle:"è¯»æä½",charIndex:1935},{level:3,title:"è¯»ä¼å",slug:"è¯»ä¼å",normalizedTitle:"è¯»ä¼å",charIndex:1943},{level:3,title:"æ°æ®å¯è§æ§",slug:"æ°æ®å¯è§æ§",normalizedTitle:"æ°æ®å¯è§æ§",charIndex:2085},{level:3,title:"éåè¯»å",slug:"éåè¯»å",normalizedTitle:"éåè¯»å",charIndex:1880},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:2645}],headersStr:"å¯æ¬åå¯ç¨æ§ MongoDB å¯æ¬ å¼æ­¥å¤å¶ æ¢æä½ å¤å¶å»¶è¿åæµæ§ æéè½¬ç§» è¯»æä½ è¯»ä¼å æ°æ®å¯è§æ§ éåè¯»å åèèµæ",content:'# MongoDB å¤å¶\n\n\n# å¯æ¬åå¯ç¨æ§\n\nå¯æ¬å¯ä»¥æä¾åä½å¹¶æé«æ°æ®å¯ç¨æ§ãå¨ä¸åæ°æ®åºæå¡å¨ä¸ä½¿ç¨å¤ä¸ªæ°æ®å¯æ¬ï¼å¯ä»¥æä¾ä¸å®ç¨åº¦çå®¹éè½åï¼ä»¥é²æ­¢åä¸ªæ°æ®åºæå¡å¨å®æºæ¶ï¼æ°æ®ä¸¢å¤±ã\n\nå¨æäºæåµä¸ï¼å¯æ¬è¿å¯ä»¥æä¾æ´å¤§çè¯»åååéãå ä¸ºå®¢æ·ç«¯å¯ä»¥å°è¯»åæä½åéå°ä¸åçæå¡å¨ãå¨ä¸åæ°æ®ä¸­å¿ä¸­ç»´æ¤æ°æ®å¯æ¬å¯ä»¥æé«æ°æ®æ¬å°æ§ååå¸å¼åºç¨ç¨åºçå¯ç¨æ§ãæ¨è¿å¯ä»¥ç»´æ¤å¶ä»å¯æ¬ä»¥ç¨äºä¸ç¨ç®çï¼ä¾å¦ç¾é¾æ¢å¤ï¼æ¥åæå¤ä»½ã\n\n\n# MongoDB å¯æ¬\n\nMongoDB ä¸­çå¯æ¬éæ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éç mongod è¿ç¨ãä¸ä¸ªå¯æ¬éåå«å¤ä¸ªæ°æ®æ¿è½½èç¹åä¸ä¸ªä»²è£å¨èç¹ï¼å¯éï¼ãå¨æ°æ®æ¿è½½èç¹ä¸­ï¼åªæä¸ä¸ªæåè¢«è§ä¸ºä¸»è¦èç¹ï¼èå¶ä»èç¹åè¢«è§ä¸ºæ¬¡è¦èç¹ã\n\nä¸»èç¹è´è´£æ¥æ¶ææåæä½ãå¯æ¬éåªè½æä¸ä¸ªä¸»å¯æ¬ï¼è½å¤ä»¥ { w: "majority" } æ¥ç¡®è®¤éç¾¤ä¸­èç¹çåæä½æåæåµï¼å°½ç®¡å¨æäºæåµä¸ï¼å¦ä¸ä¸ª MongoDB å®ä¾å¯è½ä¼ææ¶è®¤ä¸ºèªå·±ä¹æ¯ä¸»è¦çãä¸»èç¹å¨å¶æä½æ¥å¿ï¼å³ oplogï¼ä¸­è®°å½äºå¯¹å¶æ°æ®éçæææ´æ¹ã\n\n\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½åºç¨äºå¶æ°æ®éï¼ä»¥ä¾¿åæ­¥ä¸»èç¹çæ°æ®ãå¦æä¸»èç¹ä¸å¯ç¨ï¼åç¬¦åæ¡ä»¶çä»èç¹å°éä¸¾æ°çä¸»èç¹ã\n\n\n\nå¨æäºæåµä¸ï¼ä¾å¦ï¼æä¸ä¸ªä¸»èç¹åä¸ä¸ªä»èç¹ï¼ä½ç±äºææ¬éå¶ï¼ç¦æ­¢æ·»å å¦ä¸ä¸ªä»èç¹ï¼ï¼æ¨å¯ä»¥éæ©å° mongod å®ä¾ä½ä¸ºä»²è£èç¹æ·»å å°å¯æ¬éãä»²è£èç¹åå éä¸¾ä½ä¸ä¿å­æ°æ®ï¼å³ä¸æä¾æ°æ®åä½ï¼ã\n\n\n\nä»²è£èç¹å°æ°¸è¿æ¯ä»²è£èç¹ãå¨éä¸¾æé´ï¼ä¸»èç¹å¯è½ä¼éçº§æä¸ºæ¬¡èç¹ï¼èæ¬¡èç¹å¯è½ä¼åçº§æä¸ºä¸»èç¹ã\n\n\n# å¼æ­¥å¤å¶\n\n\n# æ¢æä½\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½å¼æ­¥åºç¨äºå¶æ°æ®éãéè¿ä»èç¹åæ­¥ä¸»èç¹çæ°æ®éï¼å³ä½¿ä¸ä¸ªæå¤ä¸ªæåå¤±è´¥ï¼å¯æ¬éï¼MongoDB éç¾¤ï¼ä¹å¯ä»¥ç»§ç»­è¿è¡ã\n\nä» 4.2 çæ¬å¼å§ï¼å¯æ¬éçä»èç¹è®°å½æ¢æä½ï¼æä½æ¶é´æ¯è®¾ç½®çéå¼é¿ï¼çæ¥å¿æ¡ç®ãè¿äºæ¢æä½å¨ REPL ç»ä»¶ä¸ç è¯æ­æ¥å¿ ä¸­è®°å½äºæ¥å¿æ¶æ¯ï¼å¹¶ä½¿ç¨äºææ¬ op: <oplog entry> è±è´¹äº <num>msãè¿äºæ¢æä½æ¥å¿æ¡ç®ä»åå³äºæ¢æä½éå¼ï¼èä¸åå³äºæ¥å¿çº§å«ï¼å¨ç³»ç»çº§å«æç»ä»¶çº§å«ï¼ï¼éç½®çº§å«æè¿è¡ç¼æ¢çéæ ·çãæ¢æ¥å¨ä¸ä¼æè·ç¼æ¢çæä½æ¥å¿æ¡ç®ã\n\n\n# å¤å¶å»¶è¿åæµæ§\n\nå¤å¶å»¶è¿ï¼Replication lagï¼æ¯æå°ä¸»èç¹ä¸çåæä½å¤å¶å°ä»èç¹ä¸æè±è´¹çæ¶é´ãè¾ç­çå»¶è¿æ¶é´æ¯å¯ä»¥æ¥åçï¼ä½æ¯éçå¤å¶å»¶è¿çå¢å ï¼å¯è½ä¼åºç°ä¸¥éçé®é¢ï¼æ¯å¦å¨ä¸»èç¹ä¸çç¼å­ååã\n\nä» MongoDB 4.2 å¼å§ï¼ç®¡çåå¯ä»¥éå¶ä¸»èç¹çåå¥éçï¼ä½¿å¾å¤§å¤æ°å»¶è¿æ¶é´ä¿æå¨å¯éç½®çæå¤§å¼ flowControlTargetLagSeconds ä»¥ä¸ã\n\né»è®¤æåµä¸ï¼æµæ§æ¯å¼å¯çã\n\nå¯ç¨æµæ§åï¼éçå»¶è¿æ¶é´è¶æ¥è¶æ¥è¿ flowControlTargetLagSecondsï¼ä¸»å¯¹è±¡ä¸çåæä½å¿é¡»åè·å¾ä»¤çï¼ç¶åæè½è¿è¡éå®å¹¶æ§è¡åæä½ãéè¿éå¶æ¯ç§ååºçä»¤çæ°éï¼æµæ§æºå¶å°è¯å°å»¶è¿ä¿æå¨ç®æ ä»¥ä¸ã\n\n\n# æéè½¬ç§»\n\nå½ä¸»èç¹ä¸éç¾¤ä¸­çå¶ä»æåéä¿¡çæ¶é´è¶è¿éç½®ç electionTimeoutMillisï¼é»è®¤ä¸º 10 ç§ï¼æ¶ï¼ç¬¦åéä¸¾è¦æ±çä»èç¹å°è¦æ±éä¸¾ï¼å¹¶æåèªå·±ä¸ºæ°çä¸»èç¹ãéç¾¤å°è¯å®æéä¸¾æ°ä¸»èç¹å¹¶æ¢å¤æ­£å¸¸å·¥ä½ã\n\n\n\néä¸¾å®æåï¼å¯æ¬éæ æ³å¤çåå¥æä½ãå¦æå°å¯æ¬ééç½®ä¸ºï¼å¨ä¸»èç¹å¤äºè±æºç¶ææ¶ï¼å¨æ¬¡èç¹ä¸è¿è¡ï¼åå¯æ¬éå¯ä»¥ç»§ç»­æä¾è¯»åæ¥è¯¢ã\n\nåè®¾å¯æ¬éç½®éç¨é»è®¤éç½®ï¼åéç¾¤éæ©æ°èç¹çæ¶é´éå¸¸ä¸åºè¶è¿ 12 ç§ï¼è¿åæ¬ï¼å°ä¸»èç¹æ è®°ä¸ºä¸å¯ç¨å¹¶å®æéä¸¾æéçæ¶é´ãå¯ä»¥éè¿ä¿®æ¹ settings.electionTimeoutMillis éç½®éé¡¹æ¥è°æ´æ­¤æ¶é´ãç½ç»å»¶è¿ç­å ç´ å¯è½ä¼å»¶é¿å®æéä¸¾æéçæ¶é´ï¼è¿èå½±åéç¾¤å¨æ²¡æä¸»èç¹çæåµä¸å¯ä»¥è¿è¡çæ¶é´ãè¿äºå ç´ åå³äºéç¾¤å®éçæåµã\n\nå°é»è®¤ä¸º 10 ç§ç electionTimeoutMillis éé¡¹æ°å¼ç¼©å°ï¼å¯ä»¥æ´å¿«å°æ£æµå°ä¸»è¦æéãä½æ¯ï¼ç±äºç½ç»å»¶è¿ç­å ç´ ï¼éç¾¤å¯è½ä¼æ´é¢ç¹å°è¿è¡éä¸¾ï¼å³ä½¿è¯¥ä¸»èç¹å®éä¸å¤äºå¥åº·ç¶æãè¿å¯è½å¯¼è´ w : 1 åæä½çåæ»æ¬¡æ°å¢å ã\n\nåºç¨ç¨åºçè¿æ¥é»è¾åºåæ¬å¯¹èªå¨æéè½¬ç§»ååç»­éä¸¾çå®¹éå¤çãä» MongoDB 3.6 å¼å§ï¼MongoDB é©±å¨ç¨åºå¯ä»¥æ£æµå°ä¸»èç¹çå¤±èï¼å¹¶å¯ä»¥èªå¨éè¯ä¸æ¬¡æäºåå¥æä½ã\n\nä» MongoDB4.4 å¼å§ï¼MongoDB æä¾éåè¯»åï¼å°å¯éä¸¾çä»èç¹çæè¿è®¿é®çæ°æ®ï¼é¢ç­ä¸ºç¼å­ãé¢ç­ä»èç¹çç¼å­å¯ä»¥å¸®å©å¨éä¸¾åæ´å¿«å°æ¢å¤ã\n\n\n# è¯»æä½\n\n\n# è¯»ä¼å\n\né»è®¤æåµä¸ï¼å®¢æ·ç«¯ä»ä¸»èç¹è¯»åæ°æ®ï¼ä½æ¯ï¼å®¢æ·ç«¯å¯ä»¥æå®è¯»åé¦éé¡¹ï¼ä»¥å°è¯»åæä½åéå°ä»èç¹ã\n\n\n\nå¼æ­¥å¤å¶å°ä»èç¹æå³çåä»èç¹è¯»åæ°æ®å¯è½ä¼è¿åä¸ä¸»èç¹ä¸ä¸è´çæ°æ®ã\n\nåå«è¯»åæä½çå¤ææ¡£äºå¡å¿é¡»ä½¿ç¨è¯»åä¸»èç¹ä¼åãç»å®äºå¡ä¸­çæææä½å¿é¡»è·¯ç±å°åä¸æåã\n\n\n# æ°æ®å¯è§æ§\n\næ ¹æ®è¯»åçå³æ³¨ç¹ï¼å®¢æ·ç«¯å¯ä»¥å¨æä¹ååå¥åæ¥çåå¥ç»æï¼\n\n * ä¸ç®¡åç write concern å¦ä½è®¾ç½®ï¼å¶ä»ä½¿ç¨ "local" æ "available" çè¯»éç½®çå®¢æ·ç«¯é½å¯ä»¥ååå¸å®¢æ·ç«¯ç¡®è®¤åæä½ä¹åçå°åæä½çç»æã\n * ä½¿ç¨ "local" æ "available" è¯»åéç½®çå®¢æ·ç«¯å¯ä»¥è¯»åæ°æ®ï¼è¿äºæ°æ®éåå¯è½ä¼å¨å¯æ¬éæéè½¬ç§»æé´åæ»ã\n\nå¯¹äºå¤ææ¡£äºå¡ä¸­çæä½ï¼å½äºå¡æäº¤æ¶ï¼å¨äºå¡ä¸­è¿è¡çæææ°æ®æ´æ¹é½å°ä¿å­ï¼å¹¶å¨äºå¡å¤é¨å¯è§ãä¹å°±æ¯è¯´ï¼äºå¡å¨åæ»å¶ä»äºå¡æ¶å°ä¸ä¼æäº¤å¶æäºæ´æ¹ãå¨æäº¤äºå¡åï¼äºå¡å¤é¨çä¸å°å¨äºå¡ä¸­è¿è¡çæ°æ®æ´æ¹ã\n\nä½æ¯ï¼å½äºå¡åå¥å¤ä¸ªåçæ¶ï¼å¹¶éææå¤é¨è¯»æä½é½éè¦ç­å¾å·²æäº¤äºå¡çç»æå¨ææåçä¸å¯è§ãä¾å¦ï¼å¦ææäº¤äºä¸ä¸ªäºå¡ï¼å¹¶ä¸å¨åç A ä¸å¯ä»¥çå°å 1ï¼ä½æ¯å¨åç B ä¸è¿çä¸å°å 2ï¼åå¨ "local" è¯»éç½®çº§å«ï¼å¤é¨è¯»åå¯ä»¥è¯»åå 1 çç»æèçä¸å°å 2ã\n\n\n# éåè¯»å\n\nä» MongoDB 4.4 å¼å§ï¼MongoDB æä¾éåè¯»åä»¥é¢ç­å¯éä»èç¹ï¼å³ä¼åçº§å¤§äº 0 çæåï¼çç¼å­ãä½¿ç¨éåè¯»åï¼é»è®¤æåµä¸å·²å¯ç¨ï¼ï¼ä¸»èç¹å¯ä»¥éåå®æ¥æ¶å°çä¸é¨åæä½ï¼å¹¶å°å¶åéç»å¯éæ©çä»èç¹çå­éãå­éçå¤§å°æ¯å¯éç½®çã\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾',normalizedContent:'# mongodb å¤å¶\n\n\n# å¯æ¬åå¯ç¨æ§\n\nå¯æ¬å¯ä»¥æä¾åä½å¹¶æé«æ°æ®å¯ç¨æ§ãå¨ä¸åæ°æ®åºæå¡å¨ä¸ä½¿ç¨å¤ä¸ªæ°æ®å¯æ¬ï¼å¯ä»¥æä¾ä¸å®ç¨åº¦çå®¹éè½åï¼ä»¥é²æ­¢åä¸ªæ°æ®åºæå¡å¨å®æºæ¶ï¼æ°æ®ä¸¢å¤±ã\n\nå¨æäºæåµä¸ï¼å¯æ¬è¿å¯ä»¥æä¾æ´å¤§çè¯»åååéãå ä¸ºå®¢æ·ç«¯å¯ä»¥å°è¯»åæä½åéå°ä¸åçæå¡å¨ãå¨ä¸åæ°æ®ä¸­å¿ä¸­ç»´æ¤æ°æ®å¯æ¬å¯ä»¥æé«æ°æ®æ¬å°æ§ååå¸å¼åºç¨ç¨åºçå¯ç¨æ§ãæ¨è¿å¯ä»¥ç»´æ¤å¶ä»å¯æ¬ä»¥ç¨äºä¸ç¨ç®çï¼ä¾å¦ç¾é¾æ¢å¤ï¼æ¥åæå¤ä»½ã\n\n\n# mongodb å¯æ¬\n\nmongodb ä¸­çå¯æ¬éæ¯ä¸ç»ç»´æ¤ç¸åæ°æ®éç mongod è¿ç¨ãä¸ä¸ªå¯æ¬éåå«å¤ä¸ªæ°æ®æ¿è½½èç¹åä¸ä¸ªä»²è£å¨èç¹ï¼å¯éï¼ãå¨æ°æ®æ¿è½½èç¹ä¸­ï¼åªæä¸ä¸ªæåè¢«è§ä¸ºä¸»è¦èç¹ï¼èå¶ä»èç¹åè¢«è§ä¸ºæ¬¡è¦èç¹ã\n\nä¸»èç¹è´è´£æ¥æ¶ææåæä½ãå¯æ¬éåªè½æä¸ä¸ªä¸»å¯æ¬ï¼è½å¤ä»¥ { w: "majority" } æ¥ç¡®è®¤éç¾¤ä¸­èç¹çåæä½æåæåµï¼å°½ç®¡å¨æäºæåµä¸ï¼å¦ä¸ä¸ª mongodb å®ä¾å¯è½ä¼ææ¶è®¤ä¸ºèªå·±ä¹æ¯ä¸»è¦çãä¸»èç¹å¨å¶æä½æ¥å¿ï¼å³ oplogï¼ä¸­è®°å½äºå¯¹å¶æ°æ®éçæææ´æ¹ã\n\n\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½åºç¨äºå¶æ°æ®éï¼ä»¥ä¾¿åæ­¥ä¸»èç¹çæ°æ®ãå¦æä¸»èç¹ä¸å¯ç¨ï¼åç¬¦åæ¡ä»¶çä»èç¹å°éä¸¾æ°çä¸»èç¹ã\n\n\n\nå¨æäºæåµä¸ï¼ä¾å¦ï¼æä¸ä¸ªä¸»èç¹åä¸ä¸ªä»èç¹ï¼ä½ç±äºææ¬éå¶ï¼ç¦æ­¢æ·»å å¦ä¸ä¸ªä»èç¹ï¼ï¼æ¨å¯ä»¥éæ©å° mongod å®ä¾ä½ä¸ºä»²è£èç¹æ·»å å°å¯æ¬éãä»²è£èç¹åå éä¸¾ä½ä¸ä¿å­æ°æ®ï¼å³ä¸æä¾æ°æ®åä½ï¼ã\n\n\n\nä»²è£èç¹å°æ°¸è¿æ¯ä»²è£èç¹ãå¨éä¸¾æé´ï¼ä¸»èç¹å¯è½ä¼éçº§æä¸ºæ¬¡èç¹ï¼èæ¬¡èç¹å¯è½ä¼åçº§æä¸ºä¸»èç¹ã\n\n\n# å¼æ­¥å¤å¶\n\n\n# æ¢æä½\n\nä»èç¹å¤å¶ä¸»èç¹çæä½æ¥å¿ï¼å¹¶å°æä½å¼æ­¥åºç¨äºå¶æ°æ®éãéè¿ä»èç¹åæ­¥ä¸»èç¹çæ°æ®éï¼å³ä½¿ä¸ä¸ªæå¤ä¸ªæåå¤±è´¥ï¼å¯æ¬éï¼mongodb éç¾¤ï¼ä¹å¯ä»¥ç»§ç»­è¿è¡ã\n\nä» 4.2 çæ¬å¼å§ï¼å¯æ¬éçä»èç¹è®°å½æ¢æä½ï¼æä½æ¶é´æ¯è®¾ç½®çéå¼é¿ï¼çæ¥å¿æ¡ç®ãè¿äºæ¢æä½å¨ repl ç»ä»¶ä¸ç è¯æ­æ¥å¿ ä¸­è®°å½äºæ¥å¿æ¶æ¯ï¼å¹¶ä½¿ç¨äºææ¬ op: <oplog entry> è±è´¹äº <num>msãè¿äºæ¢æä½æ¥å¿æ¡ç®ä»åå³äºæ¢æä½éå¼ï¼èä¸åå³äºæ¥å¿çº§å«ï¼å¨ç³»ç»çº§å«æç»ä»¶çº§å«ï¼ï¼éç½®çº§å«æè¿è¡ç¼æ¢çéæ ·çãæ¢æ¥å¨ä¸ä¼æè·ç¼æ¢çæä½æ¥å¿æ¡ç®ã\n\n\n# å¤å¶å»¶è¿åæµæ§\n\nå¤å¶å»¶è¿ï¼replication lagï¼æ¯æå°ä¸»èç¹ä¸çåæä½å¤å¶å°ä»èç¹ä¸æè±è´¹çæ¶é´ãè¾ç­çå»¶è¿æ¶é´æ¯å¯ä»¥æ¥åçï¼ä½æ¯éçå¤å¶å»¶è¿çå¢å ï¼å¯è½ä¼åºç°ä¸¥éçé®é¢ï¼æ¯å¦å¨ä¸»èç¹ä¸çç¼å­ååã\n\nä» mongodb 4.2 å¼å§ï¼ç®¡çåå¯ä»¥éå¶ä¸»èç¹çåå¥éçï¼ä½¿å¾å¤§å¤æ°å»¶è¿æ¶é´ä¿æå¨å¯éç½®çæå¤§å¼ flowcontroltargetlagseconds ä»¥ä¸ã\n\né»è®¤æåµä¸ï¼æµæ§æ¯å¼å¯çã\n\nå¯ç¨æµæ§åï¼éçå»¶è¿æ¶é´è¶æ¥è¶æ¥è¿ flowcontroltargetlagsecondsï¼ä¸»å¯¹è±¡ä¸çåæä½å¿é¡»åè·å¾ä»¤çï¼ç¶åæè½è¿è¡éå®å¹¶æ§è¡åæä½ãéè¿éå¶æ¯ç§ååºçä»¤çæ°éï¼æµæ§æºå¶å°è¯å°å»¶è¿ä¿æå¨ç®æ ä»¥ä¸ã\n\n\n# æéè½¬ç§»\n\nå½ä¸»èç¹ä¸éç¾¤ä¸­çå¶ä»æåéä¿¡çæ¶é´è¶è¿éç½®ç electiontimeoutmillisï¼é»è®¤ä¸º 10 ç§ï¼æ¶ï¼ç¬¦åéä¸¾è¦æ±çä»èç¹å°è¦æ±éä¸¾ï¼å¹¶æåèªå·±ä¸ºæ°çä¸»èç¹ãéç¾¤å°è¯å®æéä¸¾æ°ä¸»èç¹å¹¶æ¢å¤æ­£å¸¸å·¥ä½ã\n\n\n\néä¸¾å®æåï¼å¯æ¬éæ æ³å¤çåå¥æä½ãå¦æå°å¯æ¬ééç½®ä¸ºï¼å¨ä¸»èç¹å¤äºè±æºç¶ææ¶ï¼å¨æ¬¡èç¹ä¸è¿è¡ï¼åå¯æ¬éå¯ä»¥ç»§ç»­æä¾è¯»åæ¥è¯¢ã\n\nåè®¾å¯æ¬éç½®éç¨é»è®¤éç½®ï¼åéç¾¤éæ©æ°èç¹çæ¶é´éå¸¸ä¸åºè¶è¿ 12 ç§ï¼è¿åæ¬ï¼å°ä¸»èç¹æ è®°ä¸ºä¸å¯ç¨å¹¶å®æéä¸¾æéçæ¶é´ãå¯ä»¥éè¿ä¿®æ¹ settings.electiontimeoutmillis éç½®éé¡¹æ¥è°æ´æ­¤æ¶é´ãç½ç»å»¶è¿ç­å ç´ å¯è½ä¼å»¶é¿å®æéä¸¾æéçæ¶é´ï¼è¿èå½±åéç¾¤å¨æ²¡æä¸»èç¹çæåµä¸å¯ä»¥è¿è¡çæ¶é´ãè¿äºå ç´ åå³äºéç¾¤å®éçæåµã\n\nå°é»è®¤ä¸º 10 ç§ç electiontimeoutmillis éé¡¹æ°å¼ç¼©å°ï¼å¯ä»¥æ´å¿«å°æ£æµå°ä¸»è¦æéãä½æ¯ï¼ç±äºç½ç»å»¶è¿ç­å ç´ ï¼éç¾¤å¯è½ä¼æ´é¢ç¹å°è¿è¡éä¸¾ï¼å³ä½¿è¯¥ä¸»èç¹å®éä¸å¤äºå¥åº·ç¶æãè¿å¯è½å¯¼è´ w : 1 åæä½çåæ»æ¬¡æ°å¢å ã\n\nåºç¨ç¨åºçè¿æ¥é»è¾åºåæ¬å¯¹èªå¨æéè½¬ç§»ååç»­éä¸¾çå®¹éå¤çãä» mongodb 3.6 å¼å§ï¼mongodb é©±å¨ç¨åºå¯ä»¥æ£æµå°ä¸»èç¹çå¤±èï¼å¹¶å¯ä»¥èªå¨éè¯ä¸æ¬¡æäºåå¥æä½ã\n\nä» mongodb4.4 å¼å§ï¼mongodb æä¾éåè¯»åï¼å°å¯éä¸¾çä»èç¹çæè¿è®¿é®çæ°æ®ï¼é¢ç­ä¸ºç¼å­ãé¢ç­ä»èç¹çç¼å­å¯ä»¥å¸®å©å¨éä¸¾åæ´å¿«å°æ¢å¤ã\n\n\n# è¯»æä½\n\n\n# è¯»ä¼å\n\né»è®¤æåµä¸ï¼å®¢æ·ç«¯ä»ä¸»èç¹è¯»åæ°æ®ï¼ä½æ¯ï¼å®¢æ·ç«¯å¯ä»¥æå®è¯»åé¦éé¡¹ï¼ä»¥å°è¯»åæä½åéå°ä»èç¹ã\n\n\n\nå¼æ­¥å¤å¶å°ä»èç¹æå³çåä»èç¹è¯»åæ°æ®å¯è½ä¼è¿åä¸ä¸»èç¹ä¸ä¸è´çæ°æ®ã\n\nåå«è¯»åæä½çå¤ææ¡£äºå¡å¿é¡»ä½¿ç¨è¯»åä¸»èç¹ä¼åãç»å®äºå¡ä¸­çæææä½å¿é¡»è·¯ç±å°åä¸æåã\n\n\n# æ°æ®å¯è§æ§\n\næ ¹æ®è¯»åçå³æ³¨ç¹ï¼å®¢æ·ç«¯å¯ä»¥å¨æä¹ååå¥åæ¥çåå¥ç»æï¼\n\n * ä¸ç®¡åç write concern å¦ä½è®¾ç½®ï¼å¶ä»ä½¿ç¨ "local" æ "available" çè¯»éç½®çå®¢æ·ç«¯é½å¯ä»¥ååå¸å®¢æ·ç«¯ç¡®è®¤åæä½ä¹åçå°åæä½çç»æã\n * ä½¿ç¨ "local" æ "available" è¯»åéç½®çå®¢æ·ç«¯å¯ä»¥è¯»åæ°æ®ï¼è¿äºæ°æ®éåå¯è½ä¼å¨å¯æ¬éæéè½¬ç§»æé´åæ»ã\n\nå¯¹äºå¤ææ¡£äºå¡ä¸­çæä½ï¼å½äºå¡æäº¤æ¶ï¼å¨äºå¡ä¸­è¿è¡çæææ°æ®æ´æ¹é½å°ä¿å­ï¼å¹¶å¨äºå¡å¤é¨å¯è§ãä¹å°±æ¯è¯´ï¼äºå¡å¨åæ»å¶ä»äºå¡æ¶å°ä¸ä¼æäº¤å¶æäºæ´æ¹ãå¨æäº¤äºå¡åï¼äºå¡å¤é¨çä¸å°å¨äºå¡ä¸­è¿è¡çæ°æ®æ´æ¹ã\n\nä½æ¯ï¼å½äºå¡åå¥å¤ä¸ªåçæ¶ï¼å¹¶éææå¤é¨è¯»æä½é½éè¦ç­å¾å·²æäº¤äºå¡çç»æå¨ææåçä¸å¯è§ãä¾å¦ï¼å¦ææäº¤äºä¸ä¸ªäºå¡ï¼å¹¶ä¸å¨åç a ä¸å¯ä»¥çå°å 1ï¼ä½æ¯å¨åç b ä¸è¿çä¸å°å 2ï¼åå¨ "local" è¯»éç½®çº§å«ï¼å¤é¨è¯»åå¯ä»¥è¯»åå 1 çç»æèçä¸å°å 2ã\n\n\n# éåè¯»å\n\nä» mongodb 4.4 å¼å§ï¼mongodb æä¾éåè¯»åä»¥é¢ç­å¯éä»èç¹ï¼å³ä¼åçº§å¤§äº 0 çæåï¼çç¼å­ãä½¿ç¨éåè¯»åï¼é»è®¤æåµä¸å·²å¯ç¨ï¼ï¼ä¸»èç¹å¯ä»¥éåå®æ¥æ¶å°çä¸é¨åæä½ï¼å¹¶å°å¶åéç»å¯éæ©çä»èç¹çå­éãå­éçå¤§å°æ¯å¯éç½®çã\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB åç",frontmatter:{title:"MongoDB åç",date:"2020-09-20T23:12:17.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","åç"],permalink:"/pages/34b182/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/09.MongoDB%E5%88%86%E7%89%87.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/09.MongoDBåç.md",key:"v-5ff0eb5a",path:"/pages/34b182/",headers:[{level:2,title:"åçéç¾¤ç®ä»",slug:"åçéç¾¤ç®ä»",normalizedTitle:"åçéç¾¤ç®ä»",charIndex:17},{level:3,title:"åçéç¾¤ç¹ç¹",slug:"åçéç¾¤ç¹ç¹",normalizedTitle:"åçéç¾¤ç¹ç¹",charIndex:107},{level:3,title:"åçéç¾¤ç»ä»¶",slug:"åçéç¾¤ç»ä»¶",normalizedTitle:"åçéç¾¤ç»ä»¶",charIndex:151},{level:3,title:"åçéç¾¤çåå¸",slug:"åçéç¾¤çåå¸",normalizedTitle:"åçéç¾¤çåå¸",charIndex:361},{level:3,title:"è·¯ç±èç¹ mongos",slug:"è·¯ç±èç¹-mongos",normalizedTitle:"è·¯ç±èç¹ mongos",charIndex:606},{level:2,title:"åç Key",slug:"åç-key",normalizedTitle:"åç key",charIndex:857},{level:2,title:"åçç­ç¥",slug:"åçç­ç¥",normalizedTitle:"åçç­ç¥",charIndex:1606},{level:3,title:"Hash åç",slug:"hash-åç",normalizedTitle:"hash åç",charIndex:1721},{level:3,title:"èå´åç",slug:"èå´åç",normalizedTitle:"èå´åç",charIndex:1729},{level:2,title:"åçéç¾¤ä¸­çåºå",slug:"åçéç¾¤ä¸­çåºå",normalizedTitle:"åçéç¾¤ä¸­çåºå",charIndex:2173},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:2459}],headersStr:"åçéç¾¤ç®ä» åçéç¾¤ç¹ç¹ åçéç¾¤ç»ä»¶ åçéç¾¤çåå¸ è·¯ç±èç¹ mongos åç Key åçç­ç¥ Hash åç èå´åç åçéç¾¤ä¸­çåºå åèèµæ",content:"# MongoDB åç\n\n\n# åçéç¾¤ç®ä»\n\nå½ MongoDB éè¦å­å¨æµ·éæ°æ®æ¶ï¼åèç¹ä¸è¶³ä»¥å­å¨å¨éæ°æ®ï¼ä¸å¯è½æ æ³æä¾ä»¤äººæ»¡æçååéãæä»¥ï¼å¯ä»¥éè¿ MongoDB åçæºå¶æ¥æ¯ææ°´å¹³æ©å±ã\n\n\n# åçéç¾¤ç¹ç¹\n\nå¯¹åºç¨å®å¨éæ\n\næ°æ®èªå¨åè¡¡\n\nå¨ææ©å®¹\n\næä¾ä¸ç§åçæ¹å¼\n\n\n# åçéç¾¤ç»ä»¶\n\nMongoDB åçéç¾¤å«ä»¥ä¸ç»ä»¶ï¼\n\n * shardï¼æ¯ä¸ªåçåå«åçæ°æ®çå­éãæ¯ä¸ªåçé½å¯ä»¥é¨ç½²ä¸ºå¯æ¬éã\n * mongosï¼mongos åå½æ¥è¯¢è·¯ç±å¨ï¼å¨å®¢æ·ç«¯åºç¨ç¨åºååçéç¾¤ä¹é´æä¾æ¥å£ãä» MongoDB 4.4 å¼å§ï¼mongos å¯ä»¥æ¯æ hedged reads ä»¥æå¤§ç¨åº¦å°åå°å»¶è¿ã\n * config serversï¼æä¾éç¾¤åæ°æ®å­å¨ååçæ°æ®åå¸çæ å°ã\n\n\n\n\n# åçéç¾¤çåå¸\n\nMongoDB å¤å¶éä»¥ collection ä¸ºåä½ï¼å°æ°æ®åå¸å¨éç¾¤ä¸­çåä¸ªåçä¸ãæå¤åè®¸ 1024 ä¸ªåçã\n\nMongoDB å¤å¶éçåçä¹é´æ°æ®ä¸éå¤ï¼åªæå½ææåçé½æ­£å¸¸æ¶ï¼æè½å®æ´å·¥ä½ã\n\nMongoDB æ°æ®åºå¯ä»¥åæ¶åå«åçåæªåççéåç collectionãåç collection ä¼åå¸å¨éç¾¤ä¸­åèç¹ä¸ãèæªåçç collection å­å¨å¨ä¸»èç¹ä¸ãæ¯ä¸ªæ°æ®åºé½æå¶èªå·±çä¸»èç¹ã\n\nåçåæªåçç collectionï¼\n\n\n\n\n# è·¯ç±èç¹ mongos\n\nè¦è¿æ¥ MongoDB åçéç¾¤ï¼å¿é¡»è¿æ¥å° mongos è·¯ç±å¨ãè¿åæ¬åçåæªåçç collectionãå®¢æ·ç«¯ä¸åºè¯¥è¿æ¥å°åä¸ªåçèç¹è¿è¡è¯»åæä½ã\n\nè¿æ¥ mongos çæ¹å¼åè¿æ¥ mongod ç¸åï¼ä¾å¦éè¿ mongo shell æ MongoDB é©±å¨ç¨åºã\n\n\n\nè·¯ç±èç¹çä½ç¨ï¼\n\n * æä¾éç¾¤çåä¸å¥å£\n * è½¬ååºç¨ç«¯è¯·æ±\n * éæ©åéæ°æ®èç¹è¿è¡è¯»å\n * åå¹¶å¤ä¸ªæ°æ®èç¹çè¿å\n\nä¸è¬ï¼è·¯ç±èç¹ mongos å»ºè®®è³å° 2 ä¸ªã\n\n\n# åç Key\n\nMongoDB ä½¿ç¨åç Key å¨åä¸ªåçä¹é´åå collection ç documentãåç Key ç± document ä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µç»æã\n\n * ä» MongoDB 4.4 å¼å§ï¼åç collection ä¸­ç document å¯è½ç¼ºå°åç Key å­æ®µãå¨è·¨åçåå¸ææ¡£æ¶ï¼ç¼ºå°åç Key å­æ®µå°è¢«è§ä¸ºå·æç©ºå¼ï¼ä½å¨è·¯ç±æ¥è¯¢æ¶åä¸ä¼ã\n\n * å¨ MongoDB 4.2 åæ´æ©çæ¬ä¸­ï¼åç Key å­æ®µå¿é¡»å¨æ¯ä¸ª document ä¸­å­å¨ä¸ä¸ªåç collectionã\n\nå¨åç collection æ¶éæ©åç Keyã\n\n * ä» MongoDB 4.4 å¼å§ï¼æ¨å¯ä»¥éè¿å¨ç°æ Key ä¸­æ·»å ä¸ä¸ªæå¤ä¸ªåç¼å­æ®µæ¥ä¼å collection çåç Keyã\n * å¨ MongoDB 4.2 åæ´ä½çæ¬ä¸­ï¼æ æ³å¨åçåæ´æ¹åç Key çéæ©ã\n\ndocument çåçé®å¼å³å®äºå¶å¨åä¸ªåçä¸­çåå¸\n\n * ä» MongoDB 4.2 å¼å§ï¼é¤éæ¨çåç Key å­æ®µæ¯ä¸å¯åç_id å­æ®µï¼å¦åæ¨å¯ä»¥æ´æ° document çåçé®å¼ã\n * å¨ MongoDB 4.0 åæ´ä½çæ¬ä¸­ï¼ææ¡£çåç Key å­æ®µå¼æ¯ä¸å¯åçã\n\nåç Key ç´¢å¼ï¼è¦å¯¹å·²å¡«åç collection è¿è¡åçï¼è¯¥ collection å¿é¡»å·æä»¥åç Key å¼å¤´çç´¢å¼ãåçä¸ä¸ªç©º collection æ¶ï¼å¦æè¯¥ collection è¿æ²¡æéå¯¹æå®åç Key çéå½ç´¢å¼ï¼å MongoDB ä¼åå»ºæ¯æç´¢å¼ã\n\nåç Key ç­ç¥ï¼åç Key çéæ©ä¼å½±ååçéç¾¤çæ§è½ï¼æçåå¯ä¼¸ç¼©æ§ãåç Key åå¶åå¤ç´¢å¼çéæ©ä¹ä¼å½±åéç¾¤å¯ä»¥ä½¿ç¨çåçç­ç¥ã\n\nMongoDB ååºå°æ°æ®åçãæ¯ä¸ªååé½æåºäºåç Key çä¸ä¸éã\n\nä¸ºäºå¨æ´ä¸ªéç¾¤ä¸­çææåçä¸å®ç°åçåååå¸ï¼åè¡¡å¨å¨åå°è¿è¡ï¼å¹¶å¨ååçä¸è¿ç§»åã\n\n\n# åçç­ç¥\n\nMongoDB æ¯æä¸¤ç§åçç­ç¥ï¼Hash åçåèå´åçã\n\n\n# Hash åç\n\nHash åçç­ç¥ä¼åè®¡ç®åç Key å­æ®µå¼çåå¸å¼ï¼ç¶åï¼æ ¹æ®åçé®å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n> æ³¨æï¼ä½¿ç¨åå¸ç´¢å¼è§£ææ¥è¯¢æ¶ï¼MongoDB ä¼èªå¨è®¡ç®åå¸å¼ï¼åºç¨ç¨åºä¸éè¦è®¡ç®åå¸ã\n\n\n\nå°½ç®¡åç Key èå´å¯è½æ¯âæ¥è¿âçï¼ä½å®ä»¬çåå¸å¼ä¸å¤ªå¯è½å¨åä¸ chunk ä¸ãåºäº Hash çæ°æ®ååæå©äºæ´ååçæ°æ®åå¸ï¼å°¤å¶æ¯å¨åç Key åè°æ´æ¹çæ°æ®éä¸­ã\n\nä½æ¯ï¼Hash åçæå³çå¯¹åç Key åèå´æ¥è¯¢æ¶ä¸å¤ªå¯è½éå¯¹åä¸ªåçï¼ä»èå¯¼è´æ´å¤çéç¾¤èå´åçå¹¿æ­æä½ã\n\n\n# èå´åç\n\nèå´åçæ ¹æ®åç Key å¼å°æ°æ®ååä¸ºå¤ä¸ªèå´ãç¶åï¼æ ¹æ®åç Key å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n\n\nå¼æ¯è¾è¿ä¼¼çä¸ç³»ååç Key æ´æå¯è½é©»çå¨åä¸ chunk ä¸ãèå´åççæçåå³äºéæ©çåç Keyãåç Key èèä¸å¨å¨ä¼å¯¼è´æ°æ®åå¸ä¸åï¼è¿å¯è½ä¼åå¼±åççæäºä¼å¿æå¯¼è´æ§è½ç¶é¢ã\n\n\n# åçéç¾¤ä¸­çåºå\n\nåºåå¯ä»¥æé«è·¨å¤ä¸ªæ°æ®ä¸­å¿çåçéç¾¤çæ°æ®å±é¨æ§ã\n\nå¨åçéç¾¤ä¸­ï¼å¯ä»¥åºäºåç Key åå»ºåçæ°æ®åºåãå¯ä»¥å°æ¯ä¸ªåºåä¸éç¾¤ä¸­çä¸ä¸ªæå¤ä¸ªåçå³èãåçå¯ä»¥ä¸ä»»ææ°éçåºåå³èãå¨å¹³è¡¡çéç¾¤ä¸­ï¼MongoDB ä»å°åºåè¦çç chunk è¿ç§»å°ä¸è¯¥åºåå³èçåçã\n\næ¯ä¸ªåºåè¦çä¸ä¸ªæå¤ä¸ªåç Key å¼èå´ãåºåè¦ççæ¯ä¸ªèå´å§ç»åæ¬å¶ä¸ä¸è¾¹çã\n\n\n\nå¨å®ä¹è¦è¦ççåºåçæ°èå´æ¶ï¼å¿é¡»ä½¿ç¨åç Key ä¸­åå«çå­æ®µãå¦æä½¿ç¨å¤ååç Keyï¼åèå´å¿é¡»åå«åç Key çåç¼ã\n\néæ©åç Key æ¶ï¼åºèèå°æ¥å¯è½ä½¿ç¨çåºåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾",normalizedContent:"# mongodb åç\n\n\n# åçéç¾¤ç®ä»\n\nå½ mongodb éè¦å­å¨æµ·éæ°æ®æ¶ï¼åèç¹ä¸è¶³ä»¥å­å¨å¨éæ°æ®ï¼ä¸å¯è½æ æ³æä¾ä»¤äººæ»¡æçååéãæä»¥ï¼å¯ä»¥éè¿ mongodb åçæºå¶æ¥æ¯ææ°´å¹³æ©å±ã\n\n\n# åçéç¾¤ç¹ç¹\n\nå¯¹åºç¨å®å¨éæ\n\næ°æ®èªå¨åè¡¡\n\nå¨ææ©å®¹\n\næä¾ä¸ç§åçæ¹å¼\n\n\n# åçéç¾¤ç»ä»¶\n\nmongodb åçéç¾¤å«ä»¥ä¸ç»ä»¶ï¼\n\n * shardï¼æ¯ä¸ªåçåå«åçæ°æ®çå­éãæ¯ä¸ªåçé½å¯ä»¥é¨ç½²ä¸ºå¯æ¬éã\n * mongosï¼mongos åå½æ¥è¯¢è·¯ç±å¨ï¼å¨å®¢æ·ç«¯åºç¨ç¨åºååçéç¾¤ä¹é´æä¾æ¥å£ãä» mongodb 4.4 å¼å§ï¼mongos å¯ä»¥æ¯æ hedged reads ä»¥æå¤§ç¨åº¦å°åå°å»¶è¿ã\n * config serversï¼æä¾éç¾¤åæ°æ®å­å¨ååçæ°æ®åå¸çæ å°ã\n\n\n\n\n# åçéç¾¤çåå¸\n\nmongodb å¤å¶éä»¥ collection ä¸ºåä½ï¼å°æ°æ®åå¸å¨éç¾¤ä¸­çåä¸ªåçä¸ãæå¤åè®¸ 1024 ä¸ªåçã\n\nmongodb å¤å¶éçåçä¹é´æ°æ®ä¸éå¤ï¼åªæå½ææåçé½æ­£å¸¸æ¶ï¼æè½å®æ´å·¥ä½ã\n\nmongodb æ°æ®åºå¯ä»¥åæ¶åå«åçåæªåççéåç collectionãåç collection ä¼åå¸å¨éç¾¤ä¸­åèç¹ä¸ãèæªåçç collection å­å¨å¨ä¸»èç¹ä¸ãæ¯ä¸ªæ°æ®åºé½æå¶èªå·±çä¸»èç¹ã\n\nåçåæªåçç collectionï¼\n\n\n\n\n# è·¯ç±èç¹ mongos\n\nè¦è¿æ¥ mongodb åçéç¾¤ï¼å¿é¡»è¿æ¥å° mongos è·¯ç±å¨ãè¿åæ¬åçåæªåçç collectionãå®¢æ·ç«¯ä¸åºè¯¥è¿æ¥å°åä¸ªåçèç¹è¿è¡è¯»åæä½ã\n\nè¿æ¥ mongos çæ¹å¼åè¿æ¥ mongod ç¸åï¼ä¾å¦éè¿ mongo shell æ mongodb é©±å¨ç¨åºã\n\n\n\nè·¯ç±èç¹çä½ç¨ï¼\n\n * æä¾éç¾¤çåä¸å¥å£\n * è½¬ååºç¨ç«¯è¯·æ±\n * éæ©åéæ°æ®èç¹è¿è¡è¯»å\n * åå¹¶å¤ä¸ªæ°æ®èç¹çè¿å\n\nä¸è¬ï¼è·¯ç±èç¹ mongos å»ºè®®è³å° 2 ä¸ªã\n\n\n# åç key\n\nmongodb ä½¿ç¨åç key å¨åä¸ªåçä¹é´åå collection ç documentãåç key ç± document ä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µç»æã\n\n * ä» mongodb 4.4 å¼å§ï¼åç collection ä¸­ç document å¯è½ç¼ºå°åç key å­æ®µãå¨è·¨åçåå¸ææ¡£æ¶ï¼ç¼ºå°åç key å­æ®µå°è¢«è§ä¸ºå·æç©ºå¼ï¼ä½å¨è·¯ç±æ¥è¯¢æ¶åä¸ä¼ã\n\n * å¨ mongodb 4.2 åæ´æ©çæ¬ä¸­ï¼åç key å­æ®µå¿é¡»å¨æ¯ä¸ª document ä¸­å­å¨ä¸ä¸ªåç collectionã\n\nå¨åç collection æ¶éæ©åç keyã\n\n * ä» mongodb 4.4 å¼å§ï¼æ¨å¯ä»¥éè¿å¨ç°æ key ä¸­æ·»å ä¸ä¸ªæå¤ä¸ªåç¼å­æ®µæ¥ä¼å collection çåç keyã\n * å¨ mongodb 4.2 åæ´ä½çæ¬ä¸­ï¼æ æ³å¨åçåæ´æ¹åç key çéæ©ã\n\ndocument çåçé®å¼å³å®äºå¶å¨åä¸ªåçä¸­çåå¸\n\n * ä» mongodb 4.2 å¼å§ï¼é¤éæ¨çåç key å­æ®µæ¯ä¸å¯åç_id å­æ®µï¼å¦åæ¨å¯ä»¥æ´æ° document çåçé®å¼ã\n * å¨ mongodb 4.0 åæ´ä½çæ¬ä¸­ï¼ææ¡£çåç key å­æ®µå¼æ¯ä¸å¯åçã\n\nåç key ç´¢å¼ï¼è¦å¯¹å·²å¡«åç collection è¿è¡åçï¼è¯¥ collection å¿é¡»å·æä»¥åç key å¼å¤´çç´¢å¼ãåçä¸ä¸ªç©º collection æ¶ï¼å¦æè¯¥ collection è¿æ²¡æéå¯¹æå®åç key çéå½ç´¢å¼ï¼å mongodb ä¼åå»ºæ¯æç´¢å¼ã\n\nåç key ç­ç¥ï¼åç key çéæ©ä¼å½±ååçéç¾¤çæ§è½ï¼æçåå¯ä¼¸ç¼©æ§ãåç key åå¶åå¤ç´¢å¼çéæ©ä¹ä¼å½±åéç¾¤å¯ä»¥ä½¿ç¨çåçç­ç¥ã\n\nmongodb ååºå°æ°æ®åçãæ¯ä¸ªååé½æåºäºåç key çä¸ä¸éã\n\nä¸ºäºå¨æ´ä¸ªéç¾¤ä¸­çææåçä¸å®ç°åçåååå¸ï¼åè¡¡å¨å¨åå°è¿è¡ï¼å¹¶å¨ååçä¸è¿ç§»åã\n\n\n# åçç­ç¥\n\nmongodb æ¯æä¸¤ç§åçç­ç¥ï¼hash åçåèå´åçã\n\n\n# hash åç\n\nhash åçç­ç¥ä¼åè®¡ç®åç key å­æ®µå¼çåå¸å¼ï¼ç¶åï¼æ ¹æ®åçé®å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n> æ³¨æï¼ä½¿ç¨åå¸ç´¢å¼è§£ææ¥è¯¢æ¶ï¼mongodb ä¼èªå¨è®¡ç®åå¸å¼ï¼åºç¨ç¨åºä¸éè¦è®¡ç®åå¸ã\n\n\n\nå°½ç®¡åç key èå´å¯è½æ¯âæ¥è¿âçï¼ä½å®ä»¬çåå¸å¼ä¸å¤ªå¯è½å¨åä¸ chunk ä¸ãåºäº hash çæ°æ®ååæå©äºæ´ååçæ°æ®åå¸ï¼å°¤å¶æ¯å¨åç key åè°æ´æ¹çæ°æ®éä¸­ã\n\nä½æ¯ï¼hash åçæå³çå¯¹åç key åèå´æ¥è¯¢æ¶ä¸å¤ªå¯è½éå¯¹åä¸ªåçï¼ä»èå¯¼è´æ´å¤çéç¾¤èå´åçå¹¿æ­æä½ã\n\n\n# èå´åç\n\nèå´åçæ ¹æ®åç key å¼å°æ°æ®ååä¸ºå¤ä¸ªèå´ãç¶åï¼æ ¹æ®åç key å¼ä¸ºæ¯ä¸ª chunk åéä¸ä¸ªèå´ã\n\n\n\nå¼æ¯è¾è¿ä¼¼çä¸ç³»ååç key æ´æå¯è½é©»çå¨åä¸ chunk ä¸ãèå´åççæçåå³äºéæ©çåç keyãåç key èèä¸å¨å¨ä¼å¯¼è´æ°æ®åå¸ä¸åï¼è¿å¯è½ä¼åå¼±åççæäºä¼å¿æå¯¼è´æ§è½ç¶é¢ã\n\n\n# åçéç¾¤ä¸­çåºå\n\nåºåå¯ä»¥æé«è·¨å¤ä¸ªæ°æ®ä¸­å¿çåçéç¾¤çæ°æ®å±é¨æ§ã\n\nå¨åçéç¾¤ä¸­ï¼å¯ä»¥åºäºåç key åå»ºåçæ°æ®åºåãå¯ä»¥å°æ¯ä¸ªåºåä¸éç¾¤ä¸­çä¸ä¸ªæå¤ä¸ªåçå³èãåçå¯ä»¥ä¸ä»»ææ°éçåºåå³èãå¨å¹³è¡¡çéç¾¤ä¸­ï¼mongodb ä»å°åºåè¦çç chunk è¿ç§»å°ä¸è¯¥åºåå³èçåçã\n\næ¯ä¸ªåºåè¦çä¸ä¸ªæå¤ä¸ªåç key å¼èå´ãåºåè¦ççæ¯ä¸ªèå´å§ç»åæ¬å¶ä¸ä¸è¾¹çã\n\n\n\nå¨å®ä¹è¦è¦ççåºåçæ°èå´æ¶ï¼å¿é¡»ä½¿ç¨åç key ä¸­åå«çå­æ®µãå¦æä½¿ç¨å¤ååç keyï¼åèå´å¿é¡»åå«åç key çåç¼ã\n\néæ©åç key æ¶ï¼åºèèå°æ¥å¯è½ä½¿ç¨çåºåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB è¿ç»´",frontmatter:{title:"MongoDB è¿ç»´",date:"2020-09-09T20:47:14.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB","è¿ç»´"],permalink:"/pages/ce58ab/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/20.MongoDB%E8%BF%90%E7%BB%B4.html",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/20.MongoDBè¿ç»´.md",key:"v-6fc5b52c",path:"/pages/ce58ab/",headers:[{level:2,title:"MongoDB å®è£",slug:"mongodb-å®è£",normalizedTitle:"mongodb å®è£",charIndex:17},{level:3,title:"Windows",slug:"windows",normalizedTitle:"windows",charIndex:32},{level:3,title:"Linux",slug:"linux",normalizedTitle:"linux",charIndex:358},{level:3,title:"è®¾ç½®ç¨æ·åãå¯ç ",slug:"è®¾ç½®ç¨æ·åãå¯ç ",normalizedTitle:"è®¾ç½®ç¨æ·åãå¯ç ",charIndex:1427},{level:2,title:"å¤ä»½åæ¢å¤",slug:"å¤ä»½åæ¢å¤",normalizedTitle:"å¤ä»½åæ¢å¤",charIndex:1794},{level:3,title:"æ°æ®å¤ä»½",slug:"æ°æ®å¤ä»½",normalizedTitle:"æ°æ®å¤ä»½",charIndex:1804},{level:3,title:"æ°æ®æ¢å¤",slug:"æ°æ®æ¢å¤",normalizedTitle:"æ°æ®æ¢å¤",charIndex:3296},{level:2,title:"å¯¼å¥å¯¼åº",slug:"å¯¼å¥å¯¼åº",normalizedTitle:"å¯¼å¥å¯¼åº",charIndex:4859},{level:3,title:"å¯¼å¥æä½",slug:"å¯¼å¥æä½",normalizedTitle:"å¯¼å¥æä½",charIndex:4975},{level:3,title:"å¯¼åºæä½",slug:"å¯¼åºæä½",normalizedTitle:"å¯¼åºæä½",charIndex:6498},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7501}],headersStr:"MongoDB å®è£ Windows Linux è®¾ç½®ç¨æ·åãå¯ç  å¤ä»½åæ¢å¤ æ°æ®å¤ä»½ æ°æ®æ¢å¤ å¯¼å¥å¯¼åº å¯¼å¥æä½ å¯¼åºæä½ åèèµæ",content:'# MongoDB è¿ç»´\n\n\n# MongoDB å®è£\n\n\n# Windows\n\nï¼1ï¼ä¸è½½å¹¶è§£åå°æ¬å°\n\nè¿å¥å®ç½ä¸è½½å°åï¼å®æ¹ä¸è½½å°å ï¼éæ©åéççæ¬ä¸è½½ã\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\nMongoDB å°æ°æ®ç®å½å­å¨å¨ db ç®å½ä¸ãä½æ¯è¿ä¸ªæ°æ®ç®å½ä¸ä¼ä¸»å¨åå»ºï¼æä»¬å¨å®è£å®æåéè¦åå»ºå®ã\n\nä¾å¦ï¼D:\\Tools\\Server\\mongodb\\mongodb-4.4.0\\data\\db\n\nï¼3ï¼è¿è¡ MongoDB æå¡\n\nmongod --dbpath D:\\Tools\\Server\\mongodb\\mongodb-4.4.0\\data\\db\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ MongoDB\n\nå¯ä»¥å¨å½ä»¤çªå£ä¸­è¿è¡ mongo.exe å½ä»¤å³å¯è¿æ¥ä¸ MongoDB\n\nï¼5ï¼éç½® MongoDB æå¡\n\n\n# Linux\n\nï¼1ï¼ä½¿ç¨å®è£åå®è£\n\nå®è£åæä»¬éè¦å®è£åä¸ª Linux å¹³å°ä¾èµåã\n\nRed Hat/CentOSï¼\n\nsudo yum install libcurl openssl\n\n\nUbuntu 18.04 LTS ("Bionic")/Debian 10 "Buster"ï¼\n\nsudo apt-get install libcurl4 openssl\n\n\nUbuntu 16.04 LTS ("Xenial")/Debian 9 "Stretch"ï¼\n\nsudo apt-get install libcurl3 openssl\n\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\né»è®¤æåµä¸ MongoDB å¯å¨åä¼åå§åä»¥ä¸ä¸¤ä¸ªç®å½ï¼\n\n * æ°æ®å­å¨ç®å½ï¼/var/lib/mongodb\n * æ¥å¿æä»¶ç®å½ï¼/var/log/mongodb\n\næä»¬å¨å¯å¨åå¯ä»¥ååå»ºè¿ä¸¤ä¸ªç®å½å¹¶è®¾ç½®å½åç¨æ·æè¯»åæéï¼\n\nsudo mkdir -p /var/lib/mongo\nsudo mkdir -p /var/log/mongodb\nsudo chown `whoami` /var/lib/mongo     # è®¾ç½®æé\nsudo chown `whoami` /var/log/mongodb   # è®¾ç½®æé\n\n\nï¼3ï¼è¿è¡ MongoDB æå¡\n\nmongod --dbpath /var/lib/mongo --logpath /var/log/mongodb/mongod.log --fork\n\n\næå¼ /var/log/mongodb/mongod.log æä»¶çå°ä»¥ä¸ä¿¡æ¯ï¼è¯´æå¯å¨æåã\n\n# tail -10f /var/log/mongodb/mongod.log\n2020-07-09T12:20:17.391+0800 I  NETWORK  [listener] Listening on /tmp/mongodb-27017.sock\n2020-07-09T12:20:17.392+0800 I  NETWORK  [listener] Listening on 127.0.0.1\n2020-07-09T12:20:17.392+0800 I  NETWORK  [listener] waiting for connections on port 27017\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ MongoDB\n\ncd /usr/local/mongodb4/bin\n./mongo\n\n\n> Linux å®è£èæ¬\n\n\n# è®¾ç½®ç¨æ·åãå¯ç \n\n> use admin\nswitched to db admin\n> db.createUser({"user":"root","pwd":"root","roles":[{"role":"userAdminAnyDatabase","db":"admin"}]})\nSuccessfully added user: {\n        "user" : "root",\n        "roles" : [\n                {\n                        "role" : "userAdminAnyDatabase",\n                        "db" : "admin"\n                }\n        ]\n}\n>\n\n\n\n# å¤ä»½åæ¢å¤\n\n\n# æ°æ®å¤ä»½\n\nå¨ Mongodb ä¸­ï¼ä½¿ç¨ mongodump å½ä»¤æ¥å¤ä»½ MongoDB æ°æ®ãè¯¥å½ä»¤å¯ä»¥å¯¼åºæææ°æ®å°æå®ç®å½ä¸­ã\n\nmongodump å½ä»¤å¯ä»¥éè¿åæ°æå®å¯¼åºçæ°æ®éçº§è½¬å­çæå¡å¨ã\n\nmongodump å½ä»¤è¯­æ³å¦ä¸ï¼\n\nmongodump -h dbhost -d dbname -o dbdirectory\n\n\n * -hï¼MongDB æå¨æå¡å¨å°åï¼ä¾å¦ï¼127.0.0.1ï¼å½ç¶ä¹å¯ä»¥æå®ç«¯å£å·ï¼127.0.0.1:27017\n\n * -dï¼éè¦å¤ä»½çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼test\n\n * -oï¼å¤ä»½çæ°æ®å­æ¾ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dumpï¼å½ç¶è¯¥ç®å½éè¦æåå»ºç«ï¼å¨å¤ä»½å®æåï¼ç³»ç»èªå¨å¨ dump ç®å½ä¸å»ºç«ä¸ä¸ª test ç®å½ï¼è¿ä¸ªç®å½éé¢å­æ¾è¯¥æ°æ®åºå®ä¾çå¤ä»½æ°æ®ã\n\nmongodump å½ä»¤å¯éåæ°åè¡¨å¦ä¸æç¤ºï¼\n\nè¯­æ³                                                  æè¿°                    å®ä¾\nmongodump --host HOST_NAME --port PORT_NUMBER       è¯¥å½ä»¤å°å¤ä»½ææ MongoDB æ°æ®   mongodump --host runoob.com --port 27017\nmongodump --dbpath DB_PATH --out BACKUP_DIRECTORY                         mongodump --dbpath /data/db/ --out /data/backup/\nmongodump --collection COLLECTION --db DB_NAME      è¯¥å½ä»¤å°å¤ä»½æå®æ°æ®åºçéåã       mongodump --collection mycol --db test\n\nãç¤ºä¾ãå¤ä»½å¨éæ°æ®\n\n$ mongodump -h 127.0.0.1 --port 27017 -o test2\n...\n2020-09-11T11:55:58.086+0800    done dumping test.company (18801 documents)\n2020-09-11T11:56:00.725+0800    [#############...........]  test.people  559101/1000000  (55.9%)\n2020-09-11T11:56:03.725+0800    [###################.....]  test.people  829496/1000000  (82.9%)\n2020-09-11T11:56:06.725+0800    [#####################...]  test.people  884614/1000000  (88.5%)\n2020-09-11T11:56:08.088+0800    [########################]  test.people  1000000/1000000  (100.0%)\n2020-09-11T11:56:08.350+0800    done dumping test.people (1000000 documents)\n\n\nãç¤ºä¾ãå¤ä»½æå®æ°æ®åº\n\nmongodump -h 127.0.0.1 --port 27017 -d admin -o test3\n\n\n\n# æ°æ®æ¢å¤\n\nmongodb ä½¿ç¨ mongorestore å½ä»¤æ¥æ¢å¤å¤ä»½çæ°æ®ã\n\nmongorestore å½ä»¤è¯­æ³å¦ä¸ï¼\n\n> mongorestore -h <hostname><:port> -d dbname <path>\n\n\n * --host <:port>, -h <:port>ï¼MongoDB æå¨æå¡å¨å°åï¼é»è®¤ä¸ºï¼ localhost:27017\n\n * --db , -d ï¼éè¦æ¢å¤çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼testï¼å½ç¶è¿ä¸ªåç§°ä¹å¯ä»¥åå¤ä»½æ¶åçä¸ä¸æ ·ï¼æ¯å¦ test2\n\n * --dropï¼æ¢å¤çæ¶åï¼åå é¤å½åæ°æ®ï¼ç¶åæ¢å¤å¤ä»½çæ°æ®ãå°±æ¯è¯´ï¼æ¢å¤åï¼å¤ä»½åæ·»å ä¿®æ¹çæ°æ®é½ä¼è¢«å é¤ï¼æç¨å¦ï¼\n\n * <path>ï¼mongorestore æåçä¸ä¸ªåæ°ï¼è®¾ç½®å¤ä»½æ°æ®æå¨ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dump\\testãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ï¼--dir ä¹å¯ä»¥è®¾ç½®å¤ä»½ç®å½ã\n\n * --dirï¼æå®å¤ä»½çç®å½ãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ã\n\nãç¤ºä¾ã\n\n$ mongorestore -h 127.0.0.1 --port 27017 -d test --dir test --drop\n...\n2020-09-11T11:46:16.053+0800    finished restoring test.tweets (966 documents, 0 failures)\n2020-09-11T11:46:18.256+0800    [###.....................]  test.people  164MB/1.03GB  (15.6%)\n2020-09-11T11:46:21.255+0800    [########................]  test.people  364MB/1.03GB  (34.6%)\n2020-09-11T11:46:24.256+0800    [############............]  test.people  558MB/1.03GB  (53.0%)\n2020-09-11T11:46:27.255+0800    [###############.........]  test.people  700MB/1.03GB  (66.5%)\n2020-09-11T11:46:30.257+0800    [###################.....]  test.people  846MB/1.03GB  (80.3%)\n2020-09-11T11:46:33.255+0800    [######################..]  test.people  990MB/1.03GB  (94.0%)\n2020-09-11T11:46:34.542+0800    [########################]  test.people  1.03GB/1.03GB  (100.0%)\n2020-09-11T11:46:34.543+0800    no indexes to restore\n2020-09-11T11:46:34.543+0800    finished restoring test.people (1000000 documents, 0 failures)\n2020-09-11T11:46:34.544+0800    1000966 document(s) restored successfully. 0 document(s) failed to restore.\n\n\n\n# å¯¼å¥å¯¼åº\n\nmongoimport å mongoexport å¹¶ä¸è½å¯é å°ä¿å­ææçå¯ææ¬ BSON æ°æ®ç±»åï¼å ä¸º JSON ä»è½ä»£è¡¨ä¸ç§ BSON æ¯æçå­éç±»åãå æ­¤ï¼æ°æ®ç¨è¿äºå·¥å·å¯¼åºå¯¼å¥æè®¸ä¼ä¸¢å¤±ä¸äºç²¾ç¡®ç¨åº¦ã\n\n\n# å¯¼å¥æä½\n\nå¨ MongoDB ä¸­ï¼ä½¿ç¨ mongoimport æ¥å¯¼å¥æ°æ®ã é»è®¤æåµä¸ï¼mongoimport ä¼å°æ°æ®å¯¼å¥å°æ¬å°ä¸»æºç«¯å£ 27017 ä¸ç MongoDB å®ä¾ä¸­ãè¦å°æ°æ®å¯¼å¥å¨å¶ä»ä¸»æºæç«¯å£ä¸è¿è¡ç MongoDB å®ä¾ä¸­ï¼è¯·éè¿åå« --host å --port éé¡¹æ¥æå®ä¸»æºåæç«¯å£ã ä½¿ç¨ --drop éé¡¹å é¤éåï¼å¦æå·²ç»å­å¨ï¼ã è¿æ ·å¯ä»¥ç¡®ä¿è¯¥éåä»åå«æ¨è¦å¯¼å¥çæ°æ®ã\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoimport -h IP --port ç«¯å£ -u ç¨æ·å -p å¯ç  -d æ°æ®åº -c è¡¨å --type ç±»å --headerline --upsert --drop æä»¶å\n\n\nãç¤ºä¾ãå¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c book --drop test/book.dat\n2020-09-11T10:53:56.359+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:53:56.372+0800    dropping: test.book\n2020-09-11T10:53:56.628+0800    431 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» json æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c student --upsert test/student.json\n2020-09-11T11:02:55.907+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T11:02:56.068+0800    200 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» csv æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type csv --headerline test/product.csv\n2020-09-11T11:07:49.788+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T11:07:51.051+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãå¯¼å¥é¨åè¡¨å­æ®µæ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type json --upsertFields name,price test/product.json\n2020-09-11T11:14:05.410+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T11:14:05.612+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\n\n# å¯¼åºæä½\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoexport -h <IP> --port <ç«¯å£> -u <ç¨æ·å> -p <å¯ç > -d <æ°æ®åº> -c <è¡¨å> -f <å­æ®µ> -q <æ¡ä»¶å¯¼åº> --csv -o <æä»¶å>\n\n\n * -fï¼å¯¼åºæå­æ®µï¼ä»¥éå·åå²ï¼-f name,email,age å¯¼åº name,email,age è¿ä¸ä¸ªå­æ®µ\n * -qï¼å¯ä»¥æ ¹æ¥è¯¢æ¡ä»¶å¯¼åºï¼-q \'{ "uid" : "100" }\' å¯¼åº uid ä¸º 100 çæ°æ®\n * --csvï¼è¡¨ç¤ºå¯¼åºçæä»¶æ ¼å¼ä¸º csv çï¼è¿ä¸ªæ¯è¾æç¨ï¼å ä¸ºå¤§é¨åçå³ç³»åæ°æ®åºé½æ¯æ¯æ csvï¼å¨è¿éæå±åç¹\n\nãç¤ºä¾ãå¯¼åºæ´å¼ è¡¨\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product -o test/product.dat\n2020-09-11T10:44:23.161+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:44:23.177+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨å° json æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type json -o test/product.json\n2020-09-11T10:49:52.735+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:49:52.750+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨ä¸­é¨åå­æ®µå° csv æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type csv -f name,price -o test/product.csv\n2020-09-11T10:47:33.160+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11T10:47:33.176+0800    exported 11 records\n\n\n\n# åèèµæ\n\n * MongoDB å®ç½\n * MongoDB Github\n * MongoDB å®æ¹åè´¹æç¨\n * MongoDB æç¨',normalizedContent:'# mongodb è¿ç»´\n\n\n# mongodb å®è£\n\n\n# windows\n\nï¼1ï¼ä¸è½½å¹¶è§£åå°æ¬å°\n\nè¿å¥å®ç½ä¸è½½å°åï¼å®æ¹ä¸è½½å°å ï¼éæ©åéççæ¬ä¸è½½ã\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\nmongodb å°æ°æ®ç®å½å­å¨å¨ db ç®å½ä¸ãä½æ¯è¿ä¸ªæ°æ®ç®å½ä¸ä¼ä¸»å¨åå»ºï¼æä»¬å¨å®è£å®æåéè¦åå»ºå®ã\n\nä¾å¦ï¼d:\\tools\\server\\mongodb\\mongodb-4.4.0\\data\\db\n\nï¼3ï¼è¿è¡ mongodb æå¡\n\nmongod --dbpath d:\\tools\\server\\mongodb\\mongodb-4.4.0\\data\\db\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ mongodb\n\nå¯ä»¥å¨å½ä»¤çªå£ä¸­è¿è¡ mongo.exe å½ä»¤å³å¯è¿æ¥ä¸ mongodb\n\nï¼5ï¼éç½® mongodb æå¡\n\n\n# linux\n\nï¼1ï¼ä½¿ç¨å®è£åå®è£\n\nå®è£åæä»¬éè¦å®è£åä¸ª linux å¹³å°ä¾èµåã\n\nred hat/centosï¼\n\nsudo yum install libcurl openssl\n\n\nubuntu 18.04 lts ("bionic")/debian 10 "buster"ï¼\n\nsudo apt-get install libcurl4 openssl\n\n\nubuntu 16.04 lts ("xenial")/debian 9 "stretch"ï¼\n\nsudo apt-get install libcurl3 openssl\n\n\nï¼2ï¼åå»ºæ°æ®ç®å½\n\né»è®¤æåµä¸ mongodb å¯å¨åä¼åå§åä»¥ä¸ä¸¤ä¸ªç®å½ï¼\n\n * æ°æ®å­å¨ç®å½ï¼/var/lib/mongodb\n * æ¥å¿æä»¶ç®å½ï¼/var/log/mongodb\n\næä»¬å¨å¯å¨åå¯ä»¥ååå»ºè¿ä¸¤ä¸ªç®å½å¹¶è®¾ç½®å½åç¨æ·æè¯»åæéï¼\n\nsudo mkdir -p /var/lib/mongo\nsudo mkdir -p /var/log/mongodb\nsudo chown `whoami` /var/lib/mongo     # è®¾ç½®æé\nsudo chown `whoami` /var/log/mongodb   # è®¾ç½®æé\n\n\nï¼3ï¼è¿è¡ mongodb æå¡\n\nmongod --dbpath /var/lib/mongo --logpath /var/log/mongodb/mongod.log --fork\n\n\næå¼ /var/log/mongodb/mongod.log æä»¶çå°ä»¥ä¸ä¿¡æ¯ï¼è¯´æå¯å¨æåã\n\n# tail -10f /var/log/mongodb/mongod.log\n2020-07-09t12:20:17.391+0800 i  network  [listener] listening on /tmp/mongodb-27017.sock\n2020-07-09t12:20:17.392+0800 i  network  [listener] listening on 127.0.0.1\n2020-07-09t12:20:17.392+0800 i  network  [listener] waiting for connections on port 27017\n\n\nï¼4ï¼å®¢æ·ç«¯è¿æ¥ mongodb\n\ncd /usr/local/mongodb4/bin\n./mongo\n\n\n> linux å®è£èæ¬\n\n\n# è®¾ç½®ç¨æ·åãå¯ç \n\n> use admin\nswitched to db admin\n> db.createuser({"user":"root","pwd":"root","roles":[{"role":"useradminanydatabase","db":"admin"}]})\nsuccessfully added user: {\n        "user" : "root",\n        "roles" : [\n                {\n                        "role" : "useradminanydatabase",\n                        "db" : "admin"\n                }\n        ]\n}\n>\n\n\n\n# å¤ä»½åæ¢å¤\n\n\n# æ°æ®å¤ä»½\n\nå¨ mongodb ä¸­ï¼ä½¿ç¨ mongodump å½ä»¤æ¥å¤ä»½ mongodb æ°æ®ãè¯¥å½ä»¤å¯ä»¥å¯¼åºæææ°æ®å°æå®ç®å½ä¸­ã\n\nmongodump å½ä»¤å¯ä»¥éè¿åæ°æå®å¯¼åºçæ°æ®éçº§è½¬å­çæå¡å¨ã\n\nmongodump å½ä»¤è¯­æ³å¦ä¸ï¼\n\nmongodump -h dbhost -d dbname -o dbdirectory\n\n\n * -hï¼mongdb æå¨æå¡å¨å°åï¼ä¾å¦ï¼127.0.0.1ï¼å½ç¶ä¹å¯ä»¥æå®ç«¯å£å·ï¼127.0.0.1:27017\n\n * -dï¼éè¦å¤ä»½çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼test\n\n * -oï¼å¤ä»½çæ°æ®å­æ¾ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dumpï¼å½ç¶è¯¥ç®å½éè¦æåå»ºç«ï¼å¨å¤ä»½å®æåï¼ç³»ç»èªå¨å¨ dump ç®å½ä¸å»ºç«ä¸ä¸ª test ç®å½ï¼è¿ä¸ªç®å½éé¢å­æ¾è¯¥æ°æ®åºå®ä¾çå¤ä»½æ°æ®ã\n\nmongodump å½ä»¤å¯éåæ°åè¡¨å¦ä¸æç¤ºï¼\n\nè¯­æ³                                                  æè¿°                    å®ä¾\nmongodump --host host_name --port port_number       è¯¥å½ä»¤å°å¤ä»½ææ mongodb æ°æ®   mongodump --host runoob.com --port 27017\nmongodump --dbpath db_path --out backup_directory                         mongodump --dbpath /data/db/ --out /data/backup/\nmongodump --collection collection --db db_name      è¯¥å½ä»¤å°å¤ä»½æå®æ°æ®åºçéåã       mongodump --collection mycol --db test\n\nãç¤ºä¾ãå¤ä»½å¨éæ°æ®\n\n$ mongodump -h 127.0.0.1 --port 27017 -o test2\n...\n2020-09-11t11:55:58.086+0800    done dumping test.company (18801 documents)\n2020-09-11t11:56:00.725+0800    [#############...........]  test.people  559101/1000000  (55.9%)\n2020-09-11t11:56:03.725+0800    [###################.....]  test.people  829496/1000000  (82.9%)\n2020-09-11t11:56:06.725+0800    [#####################...]  test.people  884614/1000000  (88.5%)\n2020-09-11t11:56:08.088+0800    [########################]  test.people  1000000/1000000  (100.0%)\n2020-09-11t11:56:08.350+0800    done dumping test.people (1000000 documents)\n\n\nãç¤ºä¾ãå¤ä»½æå®æ°æ®åº\n\nmongodump -h 127.0.0.1 --port 27017 -d admin -o test3\n\n\n\n# æ°æ®æ¢å¤\n\nmongodb ä½¿ç¨ mongorestore å½ä»¤æ¥æ¢å¤å¤ä»½çæ°æ®ã\n\nmongorestore å½ä»¤è¯­æ³å¦ä¸ï¼\n\n> mongorestore -h <hostname><:port> -d dbname <path>\n\n\n * --host <:port>, -h <:port>ï¼mongodb æå¨æå¡å¨å°åï¼é»è®¤ä¸ºï¼ localhost:27017\n\n * --db , -d ï¼éè¦æ¢å¤çæ°æ®åºå®ä¾ï¼ä¾å¦ï¼testï¼å½ç¶è¿ä¸ªåç§°ä¹å¯ä»¥åå¤ä»½æ¶åçä¸ä¸æ ·ï¼æ¯å¦ test2\n\n * --dropï¼æ¢å¤çæ¶åï¼åå é¤å½åæ°æ®ï¼ç¶åæ¢å¤å¤ä»½çæ°æ®ãå°±æ¯è¯´ï¼æ¢å¤åï¼å¤ä»½åæ·»å ä¿®æ¹çæ°æ®é½ä¼è¢«å é¤ï¼æç¨å¦ï¼\n\n * <path>ï¼mongorestore æåçä¸ä¸ªåæ°ï¼è®¾ç½®å¤ä»½æ°æ®æå¨ä½ç½®ï¼ä¾å¦ï¼c:\\data\\dump\\testãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ï¼--dir ä¹å¯ä»¥è®¾ç½®å¤ä»½ç®å½ã\n\n * --dirï¼æå®å¤ä»½çç®å½ãä½ ä¸è½åæ¶æå® <path> å --dir éé¡¹ã\n\nãç¤ºä¾ã\n\n$ mongorestore -h 127.0.0.1 --port 27017 -d test --dir test --drop\n...\n2020-09-11t11:46:16.053+0800    finished restoring test.tweets (966 documents, 0 failures)\n2020-09-11t11:46:18.256+0800    [###.....................]  test.people  164mb/1.03gb  (15.6%)\n2020-09-11t11:46:21.255+0800    [########................]  test.people  364mb/1.03gb  (34.6%)\n2020-09-11t11:46:24.256+0800    [############............]  test.people  558mb/1.03gb  (53.0%)\n2020-09-11t11:46:27.255+0800    [###############.........]  test.people  700mb/1.03gb  (66.5%)\n2020-09-11t11:46:30.257+0800    [###################.....]  test.people  846mb/1.03gb  (80.3%)\n2020-09-11t11:46:33.255+0800    [######################..]  test.people  990mb/1.03gb  (94.0%)\n2020-09-11t11:46:34.542+0800    [########################]  test.people  1.03gb/1.03gb  (100.0%)\n2020-09-11t11:46:34.543+0800    no indexes to restore\n2020-09-11t11:46:34.543+0800    finished restoring test.people (1000000 documents, 0 failures)\n2020-09-11t11:46:34.544+0800    1000966 document(s) restored successfully. 0 document(s) failed to restore.\n\n\n\n# å¯¼å¥å¯¼åº\n\nmongoimport å mongoexport å¹¶ä¸è½å¯é å°ä¿å­ææçå¯ææ¬ bson æ°æ®ç±»åï¼å ä¸º json ä»è½ä»£è¡¨ä¸ç§ bson æ¯æçå­éç±»åãå æ­¤ï¼æ°æ®ç¨è¿äºå·¥å·å¯¼åºå¯¼å¥æè®¸ä¼ä¸¢å¤±ä¸äºç²¾ç¡®ç¨åº¦ã\n\n\n# å¯¼å¥æä½\n\nå¨ mongodb ä¸­ï¼ä½¿ç¨ mongoimport æ¥å¯¼å¥æ°æ®ã é»è®¤æåµä¸ï¼mongoimport ä¼å°æ°æ®å¯¼å¥å°æ¬å°ä¸»æºç«¯å£ 27017 ä¸ç mongodb å®ä¾ä¸­ãè¦å°æ°æ®å¯¼å¥å¨å¶ä»ä¸»æºæç«¯å£ä¸è¿è¡ç mongodb å®ä¾ä¸­ï¼è¯·éè¿åå« --host å --port éé¡¹æ¥æå®ä¸»æºåæç«¯å£ã ä½¿ç¨ --drop éé¡¹å é¤éåï¼å¦æå·²ç»å­å¨ï¼ã è¿æ ·å¯ä»¥ç¡®ä¿è¯¥éåä»åå«æ¨è¦å¯¼å¥çæ°æ®ã\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoimport -h ip --port ç«¯å£ -u ç¨æ·å -p å¯ç  -d æ°æ®åº -c è¡¨å --type ç±»å --headerline --upsert --drop æä»¶å\n\n\nãç¤ºä¾ãå¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c book --drop test/book.dat\n2020-09-11t10:53:56.359+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:53:56.372+0800    dropping: test.book\n2020-09-11t10:53:56.628+0800    431 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» json æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c student --upsert test/student.json\n2020-09-11t11:02:55.907+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t11:02:56.068+0800    200 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãä» csv æä»¶ä¸­å¯¼å¥è¡¨æ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type csv --headerline test/product.csv\n2020-09-11t11:07:49.788+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t11:07:51.051+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\nãç¤ºä¾ãå¯¼å¥é¨åè¡¨å­æ®µæ°æ®\n\n$ mongoimport -h 127.0.0.1 --port 27017 -d test -c product --type json --upsertfields name,price test/product.json\n2020-09-11t11:14:05.410+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t11:14:05.612+0800    11 document(s) imported successfully. 0 document(s) failed to import.\n\n\n\n# å¯¼åºæä½\n\nè¯­æ³æ ¼å¼ï¼\n\nmongoexport -h <ip> --port <ç«¯å£> -u <ç¨æ·å> -p <å¯ç > -d <æ°æ®åº> -c <è¡¨å> -f <å­æ®µ> -q <æ¡ä»¶å¯¼åº> --csv -o <æä»¶å>\n\n\n * -fï¼å¯¼åºæå­æ®µï¼ä»¥éå·åå²ï¼-f name,email,age å¯¼åº name,email,age è¿ä¸ä¸ªå­æ®µ\n * -qï¼å¯ä»¥æ ¹æ¥è¯¢æ¡ä»¶å¯¼åºï¼-q \'{ "uid" : "100" }\' å¯¼åº uid ä¸º 100 çæ°æ®\n * --csvï¼è¡¨ç¤ºå¯¼åºçæä»¶æ ¼å¼ä¸º csv çï¼è¿ä¸ªæ¯è¾æç¨ï¼å ä¸ºå¤§é¨åçå³ç³»åæ°æ®åºé½æ¯æ¯æ csvï¼å¨è¿éæå±åç¹\n\nãç¤ºä¾ãå¯¼åºæ´å¼ è¡¨\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product -o test/product.dat\n2020-09-11t10:44:23.161+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:44:23.177+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨å° json æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type json -o test/product.json\n2020-09-11t10:49:52.735+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:49:52.750+0800    exported 11 records\n\n\nãç¤ºä¾ãå¯¼åºè¡¨ä¸­é¨åå­æ®µå° csv æä»¶\n\n$ mongoexport -h 127.0.0.1 --port 27017 -d test -c product --type csv -f name,price -o test/product.csv\n2020-09-11t10:47:33.160+0800    connected to: mongodb://127.0.0.1:27017/\n2020-09-11t10:47:33.176+0800    exported 11 records\n\n\n\n# åèèµæ\n\n * mongodb å®ç½\n * mongodb github\n * mongodb å®æ¹åè´¹æç¨\n * mongodb æç¨',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"MongoDB æç¨",frontmatter:{title:"MongoDB æç¨",date:"2020-09-09T20:47:14.000Z",categories:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],tags:["æ°æ®åº","ææ¡£æ°æ®åº","MongoDB"],permalink:"/pages/86cece/"},regularPath:"/04.%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93/01.MongoDB/",relativePath:"04.ææ¡£æ°æ®åº/01.MongoDB/README.md",key:"v-25853052",path:"/pages/86cece/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:284},{level:3,title:"MongoDB åºç¨æå",slug:"mongodb-åºç¨æå",normalizedTitle:"mongodb åºç¨æå",charIndex:294},{level:3,title:"MongoDB ç CRUD æä½",slug:"mongodb-ç-crud-æä½",normalizedTitle:"mongodb ç crud æä½",charIndex:311},{level:3,title:"MongoDB èåæä½",slug:"mongodb-èåæä½",normalizedTitle:"mongodb èåæä½",charIndex:333},{level:3,title:"MongoDB äºå¡",slug:"mongodb-äºå¡",normalizedTitle:"mongodb äºå¡",charIndex:350},{level:3,title:"MongoDB å»ºæ¨¡",slug:"mongodb-å»ºæ¨¡",normalizedTitle:"mongodb å»ºæ¨¡",charIndex:365},{level:3,title:"MongoDB å»ºæ¨¡ç¤ºä¾",slug:"mongodb-å»ºæ¨¡ç¤ºä¾",normalizedTitle:"mongodb å»ºæ¨¡ç¤ºä¾",charIndex:380},{level:3,title:"MongoDB ç´¢å¼",slug:"mongodb-ç´¢å¼",normalizedTitle:"mongodb ç´¢å¼",charIndex:397},{level:3,title:"MongoDB å¤å¶",slug:"mongodb-å¤å¶",normalizedTitle:"mongodb å¤å¶",charIndex:412},{level:3,title:"MongoDB åç",slug:"mongodb-åç",normalizedTitle:"mongodb åç",charIndex:427},{level:3,title:"MongoDB è¿ç»´",slug:"mongodb-è¿ç»´",normalizedTitle:"mongodb è¿ç»´",charIndex:442},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:457},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:634}],headersStr:"ð åå®¹ MongoDB åºç¨æå MongoDB ç CRUD æä½ MongoDB èåæä½ MongoDB äºå¡ MongoDB å»ºæ¨¡ MongoDB å»ºæ¨¡ç¤ºä¾ MongoDB ç´¢å¼ MongoDB å¤å¶ MongoDB åç MongoDB è¿ç»´ ð èµæ ðª ä¼ é",content:"# MongoDB æç¨\n\n> MongoDB æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> MongoDB æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> MongoDB æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n\n# ð åå®¹\n\n\n# MongoDB åºç¨æå\n\n\n# MongoDB ç CRUD æä½\n\n\n# MongoDB èåæä½\n\n\n# MongoDB äºå¡\n\n\n# MongoDB å»ºæ¨¡\n\n\n# MongoDB å»ºæ¨¡ç¤ºä¾\n\n\n# MongoDB ç´¢å¼\n\n\n# MongoDB å¤å¶\n\n\n# MongoDB åç\n\n\n# MongoDB è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * Introduction to MongoDB\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# mongodb æç¨\n\n> mongodb æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> mongodb æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> mongodb æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n\n# ð åå®¹\n\n\n# mongodb åºç¨æå\n\n\n# mongodb ç crud æä½\n\n\n# mongodb èåæä½\n\n\n# mongodb äºå¡\n\n\n# mongodb å»ºæ¨¡\n\n\n# mongodb å»ºæ¨¡ç¤ºä¾\n\n\n# mongodb ç´¢å¼\n\n\n# mongodb å¤å¶\n\n\n# mongodb åç\n\n\n# mongodb è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * introduction to mongodb\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis é¢è¯æ»ç»",frontmatter:{title:"Redis é¢è¯æ»ç»",date:"2020-07-13T17:03:42.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","é¢è¯"],permalink:"/pages/c3ce07/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/01.Redis%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html",relativePath:"05.KVæ°æ®åº/01.Redis/01.Redisé¢è¯æ»ç».md",key:"v-3470a0b0",path:"/pages/c3ce07/",headers:[{level:2,title:"Redis æ°æ®ç±»å",slug:"redis-æ°æ®ç±»å",normalizedTitle:"redis æ°æ®ç±»å",charIndex:17},{level:2,title:"Redis åå­æ·æ±°",slug:"redis-åå­æ·æ±°",normalizedTitle:"redis åå­æ·æ±°",charIndex:460},{level:2,title:"Redis æä¹å",slug:"redis-æä¹å",normalizedTitle:"redis æä¹å",charIndex:1439},{level:2,title:"Redis äºå¡",slug:"redis-äºå¡",normalizedTitle:"redis äºå¡",charIndex:2113},{level:2,title:"Redis ç®¡é",slug:"redis-ç®¡é",normalizedTitle:"redis ç®¡é",charIndex:2637},{level:2,title:"Redis é«å¹¶å",slug:"redis-é«å¹¶å",normalizedTitle:"redis é«å¹¶å",charIndex:2894},{level:2,title:"Redis å¤å¶",slug:"redis-å¤å¶",normalizedTitle:"redis å¤å¶",charIndex:3785},{level:2,title:"Redis å¨åµ",slug:"redis-å¨åµ",normalizedTitle:"redis å¨åµ",charIndex:4419},{level:2,title:"Redis vs. Memcached",slug:"redis-vs-memcached",normalizedTitle:"redis vs. memcached",charIndex:4847},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5466}],headersStr:"Redis æ°æ®ç±»å Redis åå­æ·æ±° Redis æä¹å Redis äºå¡ Redis ç®¡é Redis é«å¹¶å Redis å¤å¶ Redis å¨åµ Redis vs. Memcached åèèµæ",content:"# Redis é¢è¯æ»ç»\n\n\n# Redis æ°æ®ç±»å\n\nãé®é¢ã\n\n * Redis æåªäºæ°æ®ç±»åï¼\n * Redis çæ°æ®ç±»ååå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis æ°æ®ç±»åååºç¨\n> \n> æ°æ®ç±»åçç¹æ§ååºç¨ç»èç¹è¾å¤ï¼è¯¦æå¯ä»¥åèï¼Redis æ°æ®ç±»å\n\nï¼1ï¼Redis æ¯æäºç§åºæ¬æ°æ®ç±»åï¼\n\n * Stringï¼å¸¸ç¨äº KV ç¼å­\n * Hashï¼å­å¨ç»æåæ°æ®ï¼å¦ï¼äº§åä¿¡æ¯ãç¨æ·ä¿¡æ¯ç­ã\n * Listï¼å­å¨åè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ãæç« è¯è®ºåè¡¨ç­ãå¯ä»¥éè¿ lrange å½ä»¤è¿è¡åé¡µæ¥è¯¢ã\n * Setï¼å­å¨å»éåè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ç­ãå¯ä»¥åºäº set ç©å¿äº¤éãå¹¶éãå·®éçæä½ãä¾å¦ï¼æ±ä¸¤ä¸ªäººçå±åå¥½ååè¡¨ã\n * Sorted Setï¼å­å¨å«è¯åçå»éåè¡¨ï¼å¦ï¼åç§æè¡æ¦ã\n\nï¼2ï¼é¤æ­¤ä»¥å¤ï¼è¿æ BitmapsãHyperLogLogsãGEOãStreams ç­é«çº§æ°æ®ç±»åã\n\n\n# Redis åå­æ·æ±°\n\nãé®é¢ã\n\n * Redis æåªäºåå­æ·æ±°ç­ç¥ï¼\n * è¿äºæ·æ±°ç­ç¥åå«éç¨äºä»ä¹åºæ¯ï¼\n * Redis æåªäºå é¤å¤±æ key çæ¹æ³ï¼\n * å¦ä½è®¾ç½® Redis ä¸­é®çè¿ææ¶é´ï¼\n * å¦æè®©ä½ å®ç°ä¸ä¸ª LRU ç®æ³ï¼æä¹åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\nï¼1ï¼Redis è¿æç­ç¥æ¯ï¼å®æå é¤+æ°æ§å é¤ã\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å®æä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n\nï¼2ï¼Redis åå­æ·æ±°ç­ç¥ï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ Redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\nï¼3ï¼å¦ä½éæ©åå­æ·æ±°ç­ç¥ï¼\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼ä¹å°±æ¯ä¸é¨åæ°æ®è®¿é®é¢çé«ï¼ä¸é¨åæ°æ®è®¿é®é¢çä½ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼ä¹å°±æ¯ææçæ°æ®è®¿é®é¢çé½ç¸åï¼åä½¿ç¨ allkeys-randomã\n * volatile-lru ç­ç¥å volatile-random ç­ç¥éåæä»¬å°ä¸ä¸ª Redis å®ä¾æ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çæ¶åï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª Redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤æä»¬å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\nï¼4ï¼LRU ç®æ³å®ç°æè·¯ï¼å¯ä»¥ç»§æ¿ LinkedHashMapï¼å¹¶è¦å removeEldestEntry æ¹æ³æ¥å®ç°ä¸ä¸ªæç®åç LRUCache\n\n\n# Redis æä¹å\n\nãé®é¢ã\n\n * Redis æå ç§æä¹åæ¹å¼ï¼\n * Redis çä¸åæä¹åæ¹å¼çç¹æ§ååçæ¯ä»ä¹ï¼\n * RDB å AOF åæä»ä¹ä¼ç¼ºç¹ï¼åå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n * Redis æ§è¡æä¹åæ¶ï¼å¯ä»¥å¤çè¯·æ±åï¼\n * AOF æå ç§åæ­¥é¢çï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis æä¹å\n> \n> è¯¦æå¯ä»¥åèï¼Redis æä¹å\n\nï¼1ï¼Redis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼RDB å AOFã\n\nï¼2ï¼RDB å³æä¸æ¶å»çäºè¿å¶æ°æ®å¿«ç§ã\n\nRedis ä¼å¨ææ§çæ RDB æä»¶ã\n\nçæ RDB æµç¨ï¼Redis fork ä¸ä¸ªå­è¿ç¨ï¼è´è´£çæ RDBï¼çæ RDB éç¨ Copy On Write æ¨¡å¼ï¼æ­¤æ¶ï¼å¦ææ¶å°åè¯·æ±ï¼ä¼å¨åå¯æ¬ä¸æä½ï¼ä¸å½±åå·¥ä½ã\n\nRDB åªè½æ¢å¤çæå¿«ç§æ¶å»çæ°æ®ï¼ä¹åçæ°æ®æ æ³æ¢å¤ãçæ RDB çèµæºå¼éé«æãRDB éååå·å¤ã\n\nï¼3ï¼AOF ä¼å°åå½ä»¤ä¸æ­è¿½å å° AOF ææ¬æ¥å¿æ«å°¾ã\n\nAOF ä¸¢æ°æ®æ¯ RDB å°ï¼ä½æä»¶ä¼æ¯ RDB æä»¶å¤§å¾å¤ã\n\nä¸è¬ï¼AOF è®¾ç½® appendfsync åæ­¥é¢çä¸º everysec å³å¯ã\n\nï¼4ï¼RDB or AOF\n\nå»ºè®®åæ¶ä½¿ç¨ RDB å AOFãç¨ AOF æ¥ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼ä½ä¸ºæ°æ®æ¢å¤çç¬¬ä¸éæ©; ç¨ RDB æ¥åä¸åç¨åº¦çå·å¤ï¼å¨ AOF æä»¶é½ä¸¢å¤±ææåä¸å¯ç¨çæ¶åï¼è¿å¯ä»¥ä½¿ç¨ RDB æ¥è¿è¡å¿«éçæ°æ®æ¢å¤ã\n\n\n# Redis äºå¡\n\nãé®é¢ã\n\n * Redis çå¹¶åç«äºé®é¢æ¯ä»ä¹ï¼å¦ä½è§£å³è¿ä¸ªé®é¢ï¼\n * Redis æ¯æäºå¡åï¼\n * Redis äºå¡æ¯ä¸¥æ ¼æä¹çäºå¡åï¼Redis ä¸ºä»ä¹ä¸æ¯æåæ»ã\n * Redis äºå¡å¦ä½å·¥ä½ï¼\n * äºè§£ Redis äºå¡ä¸­ç CAS è¡ä¸ºåï¼\n\nãè§£ç­ã\n\n> Redis çäºå¡ç¹æ§ãåç\n> \n> è¯¦æåèï¼Redis åºç¨æåä¹ äºå¡\n\nRedis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼Redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nRedis ä¸æ¯æåæ»ççç±ï¼\n\n * Redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ Redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\nMULTI ã EXEC ã DISCARD å WATCH æ¯ Redis äºå¡ç¸å³çå½ä»¤ã\n\nRedis æå¤©ç¶è§£å³è¿ä¸ªå¹¶åç«äºé®é¢çç±» CAS ä¹è§éæ¹æ¡ï¼æ¯æ¬¡è¦åä¹åï¼åå¤æ­ä¸ä¸å½åè¿ä¸ª value çæ¶é´æ³æ¯å¦æ¯ç¼å­éç value çæ¶é´æ³è¦æ°ãå¦ææ¯çè¯ï¼é£ä¹å¯ä»¥åï¼å¦åï¼å°±ä¸è½ç¨æ§çæ°æ®è¦çæ°çæ°æ®ã\n\n\n# Redis ç®¡é\n\nãé®é¢ã\n\n * é¤äºäºå¡ï¼è¿æå¶ä»æ¹éæ§è¡ Redis å½ä»¤çæ¹å¼åï¼\n\nãè§£ç­ã\n\nRedis æ¯ä¸ç§åºäº C/S æ¨¡åä»¥åè¯·æ±/ååºåè®®ç TCP æå¡ãRedis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçãä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼Redis Server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# Redis é«å¹¶å\n\nãé®é¢ã\n\n * Redis æ¯åçº¿ç¨æ¨¡åï¼ä¸ºä½ååéè¿å¾é«ï¼\n * Redis ç IO å¤è·¯å¤ç¨åçæ¯ä»ä¹ï¼\n * Redis éç¾¤å¦ä½åçåå¯»åï¼\n * Redis éç¾¤å¦ä½æ©å±ï¼\n * Redis éç¾¤å¦ä½ä¿è¯æ°æ®ä¸è´ï¼\n * Redis éç¾¤å¦ä½è§åï¼ä½ ä»¬å¬å¸ççäº§ç¯å¢ä¸å¦ä½é¨ç½² Redis éç¾¤ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis éç¾¤\n> \n> è¯¦æå¯ä»¥åèï¼Redis éç¾¤\n\nï¼1ï¼åçº¿ç¨\n\nRedis ä¸ºåè¿ç¨åçº¿ç¨æ¨¡å¼ï¼éç¨éåæ¨¡å¼å°å¹¶åè®¿é®åä¸ºä¸²è¡è®¿é®ãRedis åæºååéä¹å¾é«ï¼è½è¾¾å°å ä¸ QPSã\n\nRedis åçº¿ç¨æ¨¡åï¼ä¾ç¶æå¾é«çå¹¶åååï¼åå å¨äºï¼\n\n * Redis è¯»åé½æ¯åå­æä½ã\n * Redis åºäºéé»å¡ç IO å¤è·¯å¤ç¨æºå¶ï¼åæ¶çå¬å¤ä¸ª socketï¼å°äº§çäºä»¶ç socket åå¥åå­éåä¸­ï¼äºä»¶åæ´¾å¨æ ¹æ® socket ä¸çäºä»¶ç±»åæ¥éæ©å¯¹åºçäºä»¶å¤çå¨è¿è¡å¤çã\n * åçº¿ç¨ï¼é¿åäºçº¿ç¨åå»ºãéæ¯ãä¸ä¸æåæ¢çå¼éï¼å¹¶ä¸é¿åäºèµæºç«äºã\n\nï¼2ï¼æ©å±å¹¶åååéãå­å¨å®¹é\n\nRedis çé«æ§è½ï¼æ©å±å¹¶åååéãå­å¨å®¹éï¼éè¿ä¸»ä»æ¶ææ¥å®ç°ã\n\nRedis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ Redis éç¾¤çé«å¯ç¨ãéå¸¸æåµï¼ä¸ä¸»å¤ä»æ¨¡å¼å·²ç»å¯ä»¥æ»¡è¶³å¤§é¨åé¡¹ç®çéè¦ãæ ¹æ®å®éçå¹¶åéï¼å¯ä»¥éè¿å¢å èç¹æ¥æ©å±å¹¶åååã\n\nä¸ä¸»å¤ä»æ¨¡å¼ä¸ï¼ä¸»èç¹è´è´£åæä½ï¼åæºå ä¸ QPSï¼ï¼ä»èç¹è´è´£æ¥è¯¢æä½ï¼åæºåä¸ QPSï¼ã\n\nè¿ä¸æ­¥ï¼å¦æéè¦ç¼å­å¤§éæ°æ®ï¼å°±éè¦ååºï¼shardingï¼ãRedis éç¾¤éè¿ååèæ hash æ§½æ¥åçï¼æ¯ä¸ªä¸»èç¹è´è´£ä¸å®èå´ç hash æ§½ãå½éè¦æ©å±éç¾¤èç¹æ¶ï¼éæ°åé hash æ§½å³å¯ï¼redis-trib ä¼èªå¨è¿ç§»åæ´ hash æ§½ä¸­æå±ç keyã\n\nï¼3ï¼Redis éç¾¤æ°æ®ä¸è´æ§\n\nRedis éç¾¤åºäºå¤å¶ç¹æ§å®ç°èç¹é´çæ°æ®ä¸è´æ§ã\n\n\n# Redis å¤å¶\n\nãé®é¢ã\n\n * Redis å¤å¶çå·¥ä½åçï¼Redis æ§çå¤å¶åæ°çå¤å¶æä½ä¸åï¼\n * Redis ä¸»ä»èç¹é´å¦ä½å¤å¶æ°æ®ï¼\n * Redis çæ°æ®ä¸è´æ§æ¯å¼ºä¸è´æ§åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis å¤å¶\n> \n> è¯¦æå¯ä»¥åèï¼Redis å¤å¶\n\nï¼1ï¼æ§çå¤å¶åºäº SYNC å½ä»¤å®ç°ãåä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ãè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\nï¼2ï¼æ°çå¤å¶åºäº PSYNC å½ä»¤å®ç°ãåæ­¥æä½åä¸ºäºä¸¤åï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ ç¨äºåæ¬¡å¤å¶ï¼\n * é¨åéåæ­¥ï¼partial resychronizationï¼ ç¨äºæ­çº¿åéå¤å¶ã\n   * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n   * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n   * æå¡å¨çè¿è¡ ID\n\nï¼3ï¼Redis éç¾¤ä¸»ä»èç¹å¤å¶çå·¥ä½æµç¨ï¼\n\n * æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n * æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã\n * æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã\n * æ­¥éª¤ 4. èº«ä»½éªè¯ã\n * æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n * æ­¥éª¤ 6. åæ­¥ã\n * æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\n\n# Redis å¨åµ\n\nãé®é¢ã\n\n * Redis å¦ä½å®ç°é«å¯ç¨ï¼\n * Redis å¨åµçåè½ï¼\n * Redis å¨åµçåçï¼\n * Redis å¨åµå¦ä½éä¸¾ Leaderï¼\n * Redis å¦ä½å®ç°æéè½¬ç§»ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> Redis å¨åµ\n> \n> è¯¦æå¯ä»¥åèï¼Redis å¨åµ\n\nï¼1ï¼Redis çé«å¯ç¨æ¯éè¿å¨åµæ¥å®ç°ï¼Raft åè®®ç Redis å®ç°ï¼ãSentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\nç±ä¸ä¸ªæå¤ä¸ª Sentinel å®ä¾ç»æç Sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\n\n# Redis vs. Memcached\n\nãé®é¢ã\n\nRedis å Memcached æä»ä¹åºå«ï¼\n\nåå¸å¼ç¼å­ææ¯éåï¼é Redis è¿æ¯ Memcachedï¼ä¸ºä»ä¹ï¼\n\nRedis å Memcached åèªççº¿ç¨æ¨¡åæ¯ææ ·çï¼\n\nä¸ºä»ä¹åçº¿ç¨ç Redis æ§è½å´ä¸è¾äºå¤çº¿ç¨ç Memcachedï¼\n\nãè§£ç­ã\n\nRedis ä¸ä»ä»æ¯æç®åç k/v ç±»åçæ°æ®ï¼åæ¶è¿æä¾ listï¼setï¼zsetï¼hash ç­æ°æ®ç»æçå­å¨ãmemcache æ¯æç®åçæ°æ®ç±»åï¼Stringã\n\nRedis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n\nRedis æ¯ææ°æ®çæä¹åï¼å¯ä»¥å°åå­ä¸­çæ°æ®ä¿æå¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨,è Memecache ææ°æ®å¨é¨å­å¨åå­ä¹ä¸­\n\nredis çéåº¦æ¯ memcached å¿«å¾å¤\n\nMemcached æ¯å¤çº¿ç¨ï¼éé»å¡ IO å¤ç¨çç½ç»æ¨¡åï¼Redis ä½¿ç¨åçº¿ç¨ç IO å¤ç¨æ¨¡åã\n\n\n\nå¦ææ³è¦æ´è¯¦ç»äºè§£çè¯ï¼å¯ä»¥æ¥çæè¯¾ç½ä¸çè¿ç¯æè®°ï¼éå¸¸æ¨èï¼ ï¼ãèè¸ä¸¤åªè¹çå°æ - Memcached ä¸ Redisãï¼www.imooc.com/article/23549\n\nç»æç­ç¥ï¼ ä½¿ç¨ Redis ç String ç±»ååçäºï¼é½å¯ä»¥ç¨ Memcached æ¿æ¢ï¼ä»¥æ­¤æ¢åæ´å¥½çæ§è½æåï¼ é¤æ­¤ä»¥å¤ï¼ä¼åèè Redisï¼\n\n\n# åèèµæ\n\n * é¢è¯ä¸­å³äº Redis çé®é¢çè¿ç¯å°±å¤äº\n * advanced-java",normalizedContent:"# redis é¢è¯æ»ç»\n\n\n# redis æ°æ®ç±»å\n\nãé®é¢ã\n\n * redis æåªäºæ°æ®ç±»åï¼\n * redis çæ°æ®ç±»ååå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis æ°æ®ç±»åååºç¨\n> \n> æ°æ®ç±»åçç¹æ§ååºç¨ç»èç¹è¾å¤ï¼è¯¦æå¯ä»¥åèï¼redis æ°æ®ç±»å\n\nï¼1ï¼redis æ¯æäºç§åºæ¬æ°æ®ç±»åï¼\n\n * stringï¼å¸¸ç¨äº kv ç¼å­\n * hashï¼å­å¨ç»æåæ°æ®ï¼å¦ï¼äº§åä¿¡æ¯ãç¨æ·ä¿¡æ¯ç­ã\n * listï¼å­å¨åè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ãæç« è¯è®ºåè¡¨ç­ãå¯ä»¥éè¿ lrange å½ä»¤è¿è¡åé¡µæ¥è¯¢ã\n * setï¼å­å¨å»éåè¡¨ï¼å¦ï¼ç²ä¸åè¡¨ç­ãå¯ä»¥åºäº set ç©å¿äº¤éãå¹¶éãå·®éçæä½ãä¾å¦ï¼æ±ä¸¤ä¸ªäººçå±åå¥½ååè¡¨ã\n * sorted setï¼å­å¨å«è¯åçå»éåè¡¨ï¼å¦ï¼åç§æè¡æ¦ã\n\nï¼2ï¼é¤æ­¤ä»¥å¤ï¼è¿æ bitmapsãhyperloglogsãgeoãstreams ç­é«çº§æ°æ®ç±»åã\n\n\n# redis åå­æ·æ±°\n\nãé®é¢ã\n\n * redis æåªäºåå­æ·æ±°ç­ç¥ï¼\n * è¿äºæ·æ±°ç­ç¥åå«éç¨äºä»ä¹åºæ¯ï¼\n * redis æåªäºå é¤å¤±æ key çæ¹æ³ï¼\n * å¦ä½è®¾ç½® redis ä¸­é®çè¿ææ¶é´ï¼\n * å¦æè®©ä½ å®ç°ä¸ä¸ª lru ç®æ³ï¼æä¹åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\nï¼1ï¼redis è¿æç­ç¥æ¯ï¼å®æå é¤+æ°æ§å é¤ã\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å®æä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n\nï¼2ï¼redis åå­æ·æ±°ç­ç¥ï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\nï¼3ï¼å¦ä½éæ©åå­æ·æ±°ç­ç¥ï¼\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼ä¹å°±æ¯ä¸é¨åæ°æ®è®¿é®é¢çé«ï¼ä¸é¨åæ°æ®è®¿é®é¢çä½ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼ä¹å°±æ¯ææçæ°æ®è®¿é®é¢çé½ç¸åï¼åä½¿ç¨ allkeys-randomã\n * volatile-lru ç­ç¥å volatile-random ç­ç¥éåæä»¬å°ä¸ä¸ª redis å®ä¾æ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çæ¶åï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤æä»¬å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\nï¼4ï¼lru ç®æ³å®ç°æè·¯ï¼å¯ä»¥ç»§æ¿ linkedhashmapï¼å¹¶è¦å removeeldestentry æ¹æ³æ¥å®ç°ä¸ä¸ªæç®åç lrucache\n\n\n# redis æä¹å\n\nãé®é¢ã\n\n * redis æå ç§æä¹åæ¹å¼ï¼\n * redis çä¸åæä¹åæ¹å¼çç¹æ§ååçæ¯ä»ä¹ï¼\n * rdb å aof åæä»ä¹ä¼ç¼ºç¹ï¼åå«éç¨äºä»ä¹æ ·çåºæ¯ï¼\n * redis æ§è¡æä¹åæ¶ï¼å¯ä»¥å¤çè¯·æ±åï¼\n * aof æå ç§åæ­¥é¢çï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis æä¹å\n> \n> è¯¦æå¯ä»¥åèï¼redis æä¹å\n\nï¼1ï¼redis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼rdb å aofã\n\nï¼2ï¼rdb å³æä¸æ¶å»çäºè¿å¶æ°æ®å¿«ç§ã\n\nredis ä¼å¨ææ§çæ rdb æä»¶ã\n\nçæ rdb æµç¨ï¼redis fork ä¸ä¸ªå­è¿ç¨ï¼è´è´£çæ rdbï¼çæ rdb éç¨ copy on write æ¨¡å¼ï¼æ­¤æ¶ï¼å¦ææ¶å°åè¯·æ±ï¼ä¼å¨åå¯æ¬ä¸æä½ï¼ä¸å½±åå·¥ä½ã\n\nrdb åªè½æ¢å¤çæå¿«ç§æ¶å»çæ°æ®ï¼ä¹åçæ°æ®æ æ³æ¢å¤ãçæ rdb çèµæºå¼éé«æãrdb éååå·å¤ã\n\nï¼3ï¼aof ä¼å°åå½ä»¤ä¸æ­è¿½å å° aof ææ¬æ¥å¿æ«å°¾ã\n\naof ä¸¢æ°æ®æ¯ rdb å°ï¼ä½æä»¶ä¼æ¯ rdb æä»¶å¤§å¾å¤ã\n\nä¸è¬ï¼aof è®¾ç½® appendfsync åæ­¥é¢çä¸º everysec å³å¯ã\n\nï¼4ï¼rdb or aof\n\nå»ºè®®åæ¶ä½¿ç¨ rdb å aofãç¨ aof æ¥ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼ä½ä¸ºæ°æ®æ¢å¤çç¬¬ä¸éæ©; ç¨ rdb æ¥åä¸åç¨åº¦çå·å¤ï¼å¨ aof æä»¶é½ä¸¢å¤±ææåä¸å¯ç¨çæ¶åï¼è¿å¯ä»¥ä½¿ç¨ rdb æ¥è¿è¡å¿«éçæ°æ®æ¢å¤ã\n\n\n# redis äºå¡\n\nãé®é¢ã\n\n * redis çå¹¶åç«äºé®é¢æ¯ä»ä¹ï¼å¦ä½è§£å³è¿ä¸ªé®é¢ï¼\n * redis æ¯æäºå¡åï¼\n * redis äºå¡æ¯ä¸¥æ ¼æä¹çäºå¡åï¼redis ä¸ºä»ä¹ä¸æ¯æåæ»ã\n * redis äºå¡å¦ä½å·¥ä½ï¼\n * äºè§£ redis äºå¡ä¸­ç cas è¡ä¸ºåï¼\n\nãè§£ç­ã\n\n> redis çäºå¡ç¹æ§ãåç\n> \n> è¯¦æåèï¼redis åºç¨æåä¹ äºå¡\n\nredis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nredis ä¸æ¯æåæ»ççç±ï¼\n\n * redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\nmulti ã exec ã discard å watch æ¯ redis äºå¡ç¸å³çå½ä»¤ã\n\nredis æå¤©ç¶è§£å³è¿ä¸ªå¹¶åç«äºé®é¢çç±» cas ä¹è§éæ¹æ¡ï¼æ¯æ¬¡è¦åä¹åï¼åå¤æ­ä¸ä¸å½åè¿ä¸ª value çæ¶é´æ³æ¯å¦æ¯ç¼å­éç value çæ¶é´æ³è¦æ°ãå¦ææ¯çè¯ï¼é£ä¹å¯ä»¥åï¼å¦åï¼å°±ä¸è½ç¨æ§çæ°æ®è¦çæ°çæ°æ®ã\n\n\n# redis ç®¡é\n\nãé®é¢ã\n\n * é¤äºäºå¡ï¼è¿æå¶ä»æ¹éæ§è¡ redis å½ä»¤çæ¹å¼åï¼\n\nãè§£ç­ã\n\nredis æ¯ä¸ç§åºäº c/s æ¨¡åä»¥åè¯·æ±/ååºåè®®ç tcp æå¡ãredis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçãä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼redis server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# redis é«å¹¶å\n\nãé®é¢ã\n\n * redis æ¯åçº¿ç¨æ¨¡åï¼ä¸ºä½ååéè¿å¾é«ï¼\n * redis ç io å¤è·¯å¤ç¨åçæ¯ä»ä¹ï¼\n * redis éç¾¤å¦ä½åçåå¯»åï¼\n * redis éç¾¤å¦ä½æ©å±ï¼\n * redis éç¾¤å¦ä½ä¿è¯æ°æ®ä¸è´ï¼\n * redis éç¾¤å¦ä½è§åï¼ä½ ä»¬å¬å¸ççäº§ç¯å¢ä¸å¦ä½é¨ç½² redis éç¾¤ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis éç¾¤\n> \n> è¯¦æå¯ä»¥åèï¼redis éç¾¤\n\nï¼1ï¼åçº¿ç¨\n\nredis ä¸ºåè¿ç¨åçº¿ç¨æ¨¡å¼ï¼éç¨éåæ¨¡å¼å°å¹¶åè®¿é®åä¸ºä¸²è¡è®¿é®ãredis åæºååéä¹å¾é«ï¼è½è¾¾å°å ä¸ qpsã\n\nredis åçº¿ç¨æ¨¡åï¼ä¾ç¶æå¾é«çå¹¶åååï¼åå å¨äºï¼\n\n * redis è¯»åé½æ¯åå­æä½ã\n * redis åºäºéé»å¡ç io å¤è·¯å¤ç¨æºå¶ï¼åæ¶çå¬å¤ä¸ª socketï¼å°äº§çäºä»¶ç socket åå¥åå­éåä¸­ï¼äºä»¶åæ´¾å¨æ ¹æ® socket ä¸çäºä»¶ç±»åæ¥éæ©å¯¹åºçäºä»¶å¤çå¨è¿è¡å¤çã\n * åçº¿ç¨ï¼é¿åäºçº¿ç¨åå»ºãéæ¯ãä¸ä¸æåæ¢çå¼éï¼å¹¶ä¸é¿åäºèµæºç«äºã\n\nï¼2ï¼æ©å±å¹¶åååéãå­å¨å®¹é\n\nredis çé«æ§è½ï¼æ©å±å¹¶åååéãå­å¨å®¹éï¼éè¿ä¸»ä»æ¶ææ¥å®ç°ã\n\nredis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ redis éç¾¤çé«å¯ç¨ãéå¸¸æåµï¼ä¸ä¸»å¤ä»æ¨¡å¼å·²ç»å¯ä»¥æ»¡è¶³å¤§é¨åé¡¹ç®çéè¦ãæ ¹æ®å®éçå¹¶åéï¼å¯ä»¥éè¿å¢å èç¹æ¥æ©å±å¹¶åååã\n\nä¸ä¸»å¤ä»æ¨¡å¼ä¸ï¼ä¸»èç¹è´è´£åæä½ï¼åæºå ä¸ qpsï¼ï¼ä»èç¹è´è´£æ¥è¯¢æä½ï¼åæºåä¸ qpsï¼ã\n\nè¿ä¸æ­¥ï¼å¦æéè¦ç¼å­å¤§éæ°æ®ï¼å°±éè¦ååºï¼shardingï¼ãredis éç¾¤éè¿ååèæ hash æ§½æ¥åçï¼æ¯ä¸ªä¸»èç¹è´è´£ä¸å®èå´ç hash æ§½ãå½éè¦æ©å±éç¾¤èç¹æ¶ï¼éæ°åé hash æ§½å³å¯ï¼redis-trib ä¼èªå¨è¿ç§»åæ´ hash æ§½ä¸­æå±ç keyã\n\nï¼3ï¼redis éç¾¤æ°æ®ä¸è´æ§\n\nredis éç¾¤åºäºå¤å¶ç¹æ§å®ç°èç¹é´çæ°æ®ä¸è´æ§ã\n\n\n# redis å¤å¶\n\nãé®é¢ã\n\n * redis å¤å¶çå·¥ä½åçï¼redis æ§çå¤å¶åæ°çå¤å¶æä½ä¸åï¼\n * redis ä¸»ä»èç¹é´å¦ä½å¤å¶æ°æ®ï¼\n * redis çæ°æ®ä¸è´æ§æ¯å¼ºä¸è´æ§åï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis å¤å¶\n> \n> è¯¦æå¯ä»¥åèï¼redis å¤å¶\n\nï¼1ï¼æ§çå¤å¶åºäº sync å½ä»¤å®ç°ãåä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ãè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\nï¼2ï¼æ°çå¤å¶åºäº psync å½ä»¤å®ç°ãåæ­¥æä½åä¸ºäºä¸¤åï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ ç¨äºåæ¬¡å¤å¶ï¼\n * é¨åéåæ­¥ï¼partial resychronizationï¼ ç¨äºæ­çº¿åéå¤å¶ã\n   * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n   * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n   * æå¡å¨çè¿è¡ id\n\nï¼3ï¼redis éç¾¤ä¸»ä»èç¹å¤å¶çå·¥ä½æµç¨ï¼\n\n * æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n * æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« tcp è¿æ¥ã\n * æ­¥éª¤ 3. åé ping æ£æ¥éä¿¡ç¶æã\n * æ­¥éª¤ 4. èº«ä»½éªè¯ã\n * æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n * æ­¥éª¤ 6. åæ­¥ã\n * æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\n\n# redis å¨åµ\n\nãé®é¢ã\n\n * redis å¦ä½å®ç°é«å¯ç¨ï¼\n * redis å¨åµçåè½ï¼\n * redis å¨åµçåçï¼\n * redis å¨åµå¦ä½éä¸¾ leaderï¼\n * redis å¦ä½å®ç°æéè½¬ç§»ï¼\n\n----------------------------------------\n\nãè§£ç­ã\n\n> redis å¨åµ\n> \n> è¯¦æå¯ä»¥åèï¼redis å¨åµ\n\nï¼1ï¼redis çé«å¯ç¨æ¯éè¿å¨åµæ¥å®ç°ï¼raft åè®®ç redis å®ç°ï¼ãsentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\nç±ä¸ä¸ªæå¤ä¸ª sentinel å®ä¾ç»æç sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\n\n# redis vs. memcached\n\nãé®é¢ã\n\nredis å memcached æä»ä¹åºå«ï¼\n\nåå¸å¼ç¼å­ææ¯éåï¼é redis è¿æ¯ memcachedï¼ä¸ºä»ä¹ï¼\n\nredis å memcached åèªççº¿ç¨æ¨¡åæ¯ææ ·çï¼\n\nä¸ºä»ä¹åçº¿ç¨ç redis æ§è½å´ä¸è¾äºå¤çº¿ç¨ç memcachedï¼\n\nãè§£ç­ã\n\nredis ä¸ä»ä»æ¯æç®åç k/v ç±»åçæ°æ®ï¼åæ¶è¿æä¾ listï¼setï¼zsetï¼hash ç­æ°æ®ç»æçå­å¨ãmemcache æ¯æç®åçæ°æ®ç±»åï¼stringã\n\nredis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n\nredis æ¯ææ°æ®çæä¹åï¼å¯ä»¥å°åå­ä¸­çæ°æ®ä¿æå¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨,è memecache ææ°æ®å¨é¨å­å¨åå­ä¹ä¸­\n\nredis çéåº¦æ¯ memcached å¿«å¾å¤\n\nmemcached æ¯å¤çº¿ç¨ï¼éé»å¡ io å¤ç¨çç½ç»æ¨¡åï¼redis ä½¿ç¨åçº¿ç¨ç io å¤ç¨æ¨¡åã\n\n\n\nå¦ææ³è¦æ´è¯¦ç»äºè§£çè¯ï¼å¯ä»¥æ¥çæè¯¾ç½ä¸çè¿ç¯æè®°ï¼éå¸¸æ¨èï¼ ï¼ãèè¸ä¸¤åªè¹çå°æ - memcached ä¸ redisãï¼www.imooc.com/article/23549\n\nç»æç­ç¥ï¼ ä½¿ç¨ redis ç string ç±»ååçäºï¼é½å¯ä»¥ç¨ memcached æ¿æ¢ï¼ä»¥æ­¤æ¢åæ´å¥½çæ§è½æåï¼ é¤æ­¤ä»¥å¤ï¼ä¼åèè redisï¼\n\n\n# åèèµæ\n\n * é¢è¯ä¸­å³äº redis çé®é¢çè¿ç¯å°±å¤äº\n * advanced-java",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis åºç¨æå",frontmatter:{title:"Redis åºç¨æå",date:"2020-01-30T21:48:57.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis"],permalink:"/pages/5cd883/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/02.Redis%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97.html",relativePath:"05.KVæ°æ®åº/01.Redis/02.Redisåºç¨æå.md",key:"v-2755550e",path:"/pages/5cd883/",headers:[{level:2,title:"ä¸ãRedis ç®ä»",slug:"ä¸ãredis-ç®ä»",normalizedTitle:"ä¸ãredis ç®ä»",charIndex:17},{level:3,title:"Redis ä½¿ç¨åºæ¯",slug:"redis-ä½¿ç¨åºæ¯",normalizedTitle:"redis ä½¿ç¨åºæ¯",charIndex:138},{level:3,title:"Redis çä¼å¿",slug:"redis-çä¼å¿",normalizedTitle:"redis çä¼å¿",charIndex:495},{level:3,title:"Redis ä¸ Memcached",slug:"redis-ä¸-memcached",normalizedTitle:"redis ä¸ memcached",charIndex:815},{level:3,title:"Redis ä¸ºä»ä¹å¿«",slug:"redis-ä¸ºä»ä¹å¿«",normalizedTitle:"redis ä¸ºä»ä¹å¿«",charIndex:1348},{level:2,title:"äºãRedis æ°æ®ç±»å",slug:"äºãredis-æ°æ®ç±»å",normalizedTitle:"äºãredis æ°æ®ç±»å",charIndex:1709},{level:2,title:"ä¸ãRedis åå­æ·æ±°",slug:"ä¸ãredis-åå­æ·æ±°",normalizedTitle:"ä¸ãredis åå­æ·æ±°",charIndex:1838},{level:3,title:"åå­æ·æ±°è¦ç¹",slug:"åå­æ·æ±°è¦ç¹",normalizedTitle:"åå­æ·æ±°è¦ç¹",charIndex:1855},{level:3,title:"ä¸»é®è¿ææ¶é´",slug:"ä¸»é®è¿ææ¶é´",normalizedTitle:"ä¸»é®è¿ææ¶é´",charIndex:2309},{level:3,title:"æ·æ±°ç­ç¥",slug:"æ·æ±°ç­ç¥",normalizedTitle:"æ·æ±°ç­ç¥",charIndex:183},{level:3,title:"å¦ä½éæ©æ·æ±°ç­ç¥",slug:"å¦ä½éæ©æ·æ±°ç­ç¥",normalizedTitle:"å¦ä½éæ©æ·æ±°ç­ç¥",charIndex:3112},{level:3,title:"åé¨å®ç°",slug:"åé¨å®ç°",normalizedTitle:"åé¨å®ç°",charIndex:3440},{level:2,title:"åãRedis æä¹å",slug:"åãredis-æä¹å",normalizedTitle:"åãredis æä¹å",charIndex:3654},{level:2,title:"äºãRedis äºä»¶",slug:"äºãredis-äºä»¶",normalizedTitle:"äºãredis äºä»¶",charIndex:3955},{level:3,title:"æä»¶äºä»¶",slug:"æä»¶äºä»¶",normalizedTitle:"æä»¶äºä»¶",charIndex:4003},{level:3,title:"æ¶é´äºä»¶",slug:"æ¶é´äºä»¶",normalizedTitle:"æ¶é´äºä»¶",charIndex:4135},{level:3,title:"äºä»¶çè°åº¦ä¸æ§è¡",slug:"äºä»¶çè°åº¦ä¸æ§è¡",normalizedTitle:"äºä»¶çè°åº¦ä¸æ§è¡",charIndex:4662},{level:2,title:"å­ãRedis äºå¡",slug:"å­ãredis-äºå¡",normalizedTitle:"å­ãredis äºå¡",charIndex:5564},{level:3,title:"MULTI",slug:"multi",normalizedTitle:"multi",charIndex:646},{level:3,title:"EXEC",slug:"exec",normalizedTitle:"exec",charIndex:654},{level:3,title:"DISCARD",slug:"discard",normalizedTitle:"discard",charIndex:5663},{level:3,title:"WATCH",slug:"watch",normalizedTitle:"watch",charIndex:5673},{level:4,title:"åæ¶ WATCH çåºæ¯",slug:"åæ¶-watch-çåºæ¯",normalizedTitle:"åæ¶ watch çåºæ¯",charIndex:6982},{level:4,title:"ä½¿ç¨ WATCH åå»ºåå­æä½",slug:"ä½¿ç¨-watch-åå»ºåå­æä½",normalizedTitle:"ä½¿ç¨ watch åå»ºåå­æä½",charIndex:7220},{level:3,title:"Rollback",slug:"rollback",normalizedTitle:"rollback",charIndex:7393},{level:2,title:"ä¸ãRedis ç®¡é",slug:"ä¸ãredis-ç®¡é",normalizedTitle:"ä¸ãredis ç®¡é",charIndex:7516},{level:2,title:"å«ãRedis åå¸ä¸è®¢é",slug:"å«ãredis-åå¸ä¸è®¢é",normalizedTitle:"å«ãredis åå¸ä¸è®¢é",charIndex:8174},{level:2,title:"ä¹ãRedis å¤å¶",slug:"ä¹ãredis-å¤å¶",normalizedTitle:"ä¹ãredis å¤å¶",charIndex:8819},{level:3,title:"æ§çå¤å¶",slug:"æ§çå¤å¶",normalizedTitle:"æ§çå¤å¶",charIndex:8906},{level:3,title:"æ°çå¤å¶",slug:"æ°çå¤å¶",normalizedTitle:"æ°çå¤å¶",charIndex:9152},{level:3,title:"é¨åéåæ­¥",slug:"é¨åéåæ­¥",normalizedTitle:"é¨åéåæ­¥",charIndex:9207},{level:3,title:"PSYNC å½ä»¤",slug:"psync-å½ä»¤",normalizedTitle:"psync å½ä»¤",charIndex:9180},{level:3,title:"å¿è·³æ£æµ",slug:"å¿è·³æ£æµ",normalizedTitle:"å¿è·³æ£æµ",charIndex:9673},{level:2,title:"åãRedis å¨åµ",slug:"åãredis-å¨åµ",normalizedTitle:"åãredis å¨åµ",charIndex:9816},{level:2,title:"åä¸ãRedis éç¾¤",slug:"åä¸ãredis-éç¾¤",normalizedTitle:"åä¸ãredis éç¾¤",charIndex:9916},{level:2,title:"åäºãRedis Client",slug:"åäºãredis-client",normalizedTitle:"åäºãredis client",charIndex:10376},{level:2,title:"æ©å±éè¯»",slug:"æ©å±éè¯»",normalizedTitle:"æ©å±éè¯»",charIndex:10645},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:10696}],headersStr:"ä¸ãRedis ç®ä» Redis ä½¿ç¨åºæ¯ Redis çä¼å¿ Redis ä¸ Memcached Redis ä¸ºä»ä¹å¿« äºãRedis æ°æ®ç±»å ä¸ãRedis åå­æ·æ±° åå­æ·æ±°è¦ç¹ ä¸»é®è¿ææ¶é´ æ·æ±°ç­ç¥ å¦ä½éæ©æ·æ±°ç­ç¥ åé¨å®ç° åãRedis æä¹å äºãRedis äºä»¶ æä»¶äºä»¶ æ¶é´äºä»¶ äºä»¶çè°åº¦ä¸æ§è¡ å­ãRedis äºå¡ MULTI EXEC DISCARD WATCH åæ¶ WATCH çåºæ¯ ä½¿ç¨ WATCH åå»ºåå­æä½ Rollback ä¸ãRedis ç®¡é å«ãRedis åå¸ä¸è®¢é ä¹ãRedis å¤å¶ æ§çå¤å¶ æ°çå¤å¶ é¨åéåæ­¥ PSYNC å½ä»¤ å¿è·³æ£æµ åãRedis å¨åµ åä¸ãRedis éç¾¤ åäºãRedis Client æ©å±éè¯» åèèµæ",content:'# Redis åºç¨æå\n\n\n# ä¸ãRedis ç®ä»\n\n> Redis æ¯éåº¦éå¸¸å¿«çéå³ç³»åï¼NoSQLï¼åå­é®å¼æ°æ®åºï¼å¯ä»¥å­å¨é®åäºç§ä¸åç±»åçå¼ä¹é´çæ å°ã\n> \n> é®çç±»ååªè½ä¸ºå­ç¬¦ä¸²ï¼å¼æ¯æçäºç§ç±»åæ°æ®ç±»åä¸ºï¼å­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n\n\n# Redis ä½¿ç¨åºæ¯\n\n * ç¼å­ - å°ç­ç¹æ°æ®æ¾å°åå­ä¸­ï¼è®¾ç½®åå­çæå¤§ä½¿ç¨éä»¥åè¿ææ·æ±°ç­ç¥æ¥ä¿è¯ç¼å­çå½ä¸­çã\n * è®¡æ°å¨ - Redis è¿ç§åå­æ°æ®åºè½æ¯æè®¡æ°å¨é¢ç¹çè¯»åæä½ã\n * åºç¨éæµ - éå¶ä¸ä¸ªç½ç«è®¿é®æµéã\n * æ¶æ¯éå - ä½¿ç¨ List æ°æ®ç±»åï¼å®æ¯ååé¾è¡¨ã\n * æ¥æ¾è¡¨ - ä½¿ç¨ HASH æ°æ®ç±»åã\n * äº¤éè¿ç® - ä½¿ç¨ SET ç±»åï¼ä¾å¦æ±ä¸¤ä¸ªç¨æ·çå±åå¥½åã\n * æè¡æ¦ - ä½¿ç¨ ZSET æ°æ®ç±»åã\n * åå¸å¼ Session - å¤ä¸ªåºç¨æå¡å¨ç Session é½å­å¨å° Redis ä¸­æ¥ä¿è¯ Session çä¸è´æ§ã\n * åå¸å¼é - é¤äºå¯ä»¥ä½¿ç¨ SETNX å®ç°åå¸å¼éä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å®æ¹æä¾ç RedLock åå¸å¼éå®ç°ã\n\n\n# Redis çä¼å¿\n\n * æ§è½æé« â Redis è½è¯»çéåº¦æ¯ 110000 æ¬¡/s,åçéåº¦æ¯ 81000 æ¬¡/sã\n * ä¸°å¯çæ°æ®ç±»å - æ¯æå­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n * åå­ - Redis çæææä½é½æ¯åå­æ§çãåä¸ªæä½æ¯åå­æ§çãå¤ä¸ªæä½ä¹æ¯æäºå¡ï¼å³åå­æ§ï¼éè¿ MULTI å EXEC æä»¤åèµ·æ¥ã\n * æä¹å - Redis æ¯ææ°æ®çæä¹åãå¯ä»¥å°åå­ä¸­çæ°æ®ä¿å­å¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨ã\n * å¤ä»½ - Redis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n * ä¸°å¯çç¹æ§ - Redis è¿æ¯æåå¸è®¢é, éç¥, key è¿æç­ç­ç¹æ§ã\n\n\n# Redis ä¸ Memcached\n\nRedis ä¸ Memcached å ä¸ºé½å¯ä»¥ç¨äºç¼å­ï¼æä»¥å¸¸å¸¸è¢«æ¿æ¥åæ¯è¾ï¼äºèä¸»è¦æä»¥ä¸åºå«ï¼\n\næ°æ®ç±»å\n\n * Memcached ä»æ¯æå­ç¬¦ä¸²ç±»åï¼\n * è Redis æ¯æäºç§ä¸åç§ç±»çæ°æ®ç±»åï¼ä½¿å¾å®å¯ä»¥æ´çµæ´»å°è§£å³é®é¢ã\n\næ°æ®æä¹å\n\n * Memcached ä¸æ¯ææä¹åï¼\n * Redis æ¯æä¸¤ç§æä¹åç­ç¥ï¼RDB å¿«ç§å AOF æ¥å¿ã\n\nåå¸å¼\n\n * Memcached ä¸æ¯æåå¸å¼ï¼åªè½éè¿å¨å®¢æ·ç«¯ä½¿ç¨åä¸è´æ§åå¸è¿æ ·çåå¸å¼ç®æ³æ¥å®ç°åå¸å¼å­å¨ï¼è¿ç§æ¹å¼å¨å­å¨åæ¥è¯¢æ¶é½éè¦åå¨å®¢æ·ç«¯è®¡ç®ä¸æ¬¡æ°æ®æå¨çèç¹ã\n * Redis Cluster å®ç°äºåå¸å¼çæ¯æã\n\nåå­ç®¡çæºå¶\n\n * Memcached å°åå­åå²æç¹å®é¿åº¦çåæ¥å­å¨æ°æ®ï¼ä»¥å®å¨è§£å³åå­ç¢ççé®é¢ï¼ä½æ¯è¿ç§æ¹å¼ä¼ä½¿å¾åå­çå©ç¨çä¸é«ï¼ä¾å¦åçå¤§å°ä¸º 128 bytesï¼åªå­å¨ 100 bytes çæ°æ®ï¼é£ä¹å©ä¸ç 28 bytes å°±æµªè´¹æäºã\n * å¨ Redis ä¸­ï¼å¹¶ä¸æ¯æææ°æ®é½ä¸ç´å­å¨å¨åå­ä¸­ï¼å¯ä»¥å°ä¸äºå¾ä¹æ²¡ç¨ç value äº¤æ¢å°ç£çãè Memcached çæ°æ®åä¼ä¸ç´å¨åå­ä¸­ã\n\n\n# Redis ä¸ºä»ä¹å¿«\n\nRedis åæº QPS è½è¾¾å° 100000ã\n\nRedis æ¯åçº¿ç¨æ¨¡åï¼Redis 6.0 å·²ç»æ¯æå¤çº¿ç¨æ¨¡åï¼ï¼ä¸ºä»ä¹è¿è½æè¿ä¹é«çå¹¶åï¼\n\n * Redis å®å¨åºäºåå­æä½ã\n * Redis æ°æ®ç»æç®åã\n * éç¨åçº¿ç¨ï¼é¿åçº¿ç¨ä¸ä¸æåæ¢åç«äºã\n * ä½¿ç¨ I/O å¤è·¯å¤ç¨æ¨¡åï¼éé»å¡ I/Oï¼ã\n\n> I/O å¤è·¯å¤ç¨\n> \n> I/O å¤è·¯å¤ç¨æ¨¡åæ¯å©ç¨ selectãpollãepoll å¯ä»¥åæ¶çå¯å¤ä¸ªæµç I/O äºä»¶çè½åï¼å¨ç©ºé²çæ¶åï¼ä¼æå½åçº¿ç¨é»å¡æï¼å½æä¸ä¸ªæå¤ä¸ªæµæ I/O äºä»¶æ¶ï¼å°±ä»é»å¡æä¸­å¤éï¼äºæ¯ç¨åºå°±ä¼è½®è¯¢ä¸éææçæµï¼epoll æ¯åªè½®è¯¢é£äºçæ­£ååºäºäºä»¶çæµï¼ï¼å¹¶ä¸åªä¾æ¬¡é¡ºåºçå¤çå°±ç»ªçæµï¼è¿ç§åæ³å°±é¿åäºå¤§éçæ ç¨æä½ã\n\n\n# äºãRedis æ°æ®ç±»å\n\nRedis åºæ¬æ°æ®ç±»åï¼STRINGãHASHãLISTãSETãZSET\n\nRedis é«çº§æ°æ®ç±»åï¼BitMapãHyperLogLogãGEO\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis æ°æ®ç±»åååºç¨\n\n\n# ä¸ãRedis åå­æ·æ±°\n\n\n# åå­æ·æ±°è¦ç¹\n\n * æå¤§ç¼å­ - Redis åè®¸éè¿ maxmemory åæ°æ¥è®¾ç½®åå­æå¤§å¼ã\n\n * å¤±ææ¶é´ - ä½ä¸ºä¸ç§å®ææ¸çæ ææ°æ®çéè¦æºå¶ï¼å¨ Redis æä¾çè¯¸å¤å½ä»¤ä¸­ï¼EXPIREãEXPIREATãPEXPIREãPEXPIREAT ä»¥å SETEX å PSETEX åå¯ä»¥ç¨æ¥è®¾ç½®ä¸æ¡é®å¼å¯¹çå¤±ææ¶é´ãèä¸æ¡é®å¼å¯¹ä¸æ¦è¢«å³èäºå¤±ææ¶é´å°±ä¼å¨å°æåèªå¨å é¤ï¼æèè¯´åå¾æ æ³è®¿é®æ´ä¸ºåç¡®ï¼ã\n\n * æ·æ±°ç­ç¥ - éçä¸æ­çå Redis ä¸­ä¿å­æ°æ®ï¼å½åå­å©ä½ç©ºé´æ æ³æ»¡è¶³æ·»å çæ°æ®æ¶ï¼Redis åå°±ä¼æ½è¡æ°æ®æ·æ±°ç­ç¥ï¼æ¸é¤ä¸é¨ååå®¹ç¶åä¿è¯æ°çæ°æ®å¯ä»¥ä¿å­å°åå­ä¸­ãåå­æ·æ±°æºå¶æ¯ä¸ºäºæ´å¥½çä½¿ç¨åå­ï¼ç¨ä¸å®å¾ miss æ¥æ¢ååå­çå©ç¨çï¼ä¿è¯ Redis ç¼å­ä¸­ä¿å­çé½æ¯ç­ç¹æ°æ®ã\n\n * éç²¾åç LRU - å®éä¸ Redis å®ç°ç LRU å¹¶ä¸æ¯å¯é ç LRUï¼ä¹å°±æ¯åä¹ä¸æä»¬ä½¿ç¨ LRU ç®æ³æ·æ±°é®ï¼ä½æ¯å®éä¸è¢«æ·æ±°çé®å¹¶ä¸ä¸å®æ¯çæ­£çæä¹æ²¡ç¨çã\n\n\n# ä¸»é®è¿ææ¶é´\n\nRedis å¯ä»¥ä¸ºæ¯ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼å½é®è¿ææ¶ï¼ä¼èªå¨å é¤è¯¥é®ã\n\nå¯¹äºæ£åè¡¨è¿ç§å®¹å¨ï¼åªè½ä¸ºæ´ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼æ´ä¸ªæ£åè¡¨ï¼ï¼èä¸è½ä¸ºé®éé¢çåä¸ªåç´ è®¾ç½®è¿ææ¶é´ã\n\nå¯ä»¥ä½¿ç¨ EXPIRE æ EXPIREAT æ¥ä¸º key è®¾ç½®è¿ææ¶é´ã\n\n> ð æ³¨æï¼å½ EXPIRE çæ¶é´å¦æè®¾ç½®çæ¯è´æ°ï¼EXPIREAT è®¾ç½®çæ¶é´æ³æ¯è¿ææ¶é´ï¼å°ç´æ¥å é¤ keyã\n\nç¤ºä¾ï¼\n\nredis> SET mykey "Hello"\n"OK"\nredis> EXPIRE mykey 10\n(integer) 1\nredis> TTL mykey\n(integer) 10\nredis> SET mykey "Hello World"\n"OK"\nredis> TTL mykey\n(integer) -1\nredis>\n\n\n\n# æ·æ±°ç­ç¥\n\nåå­æ·æ±°åªæ¯ Redis æä¾çä¸ä¸ªåè½ï¼ä¸ºäºæ´å¥½å°å®ç°è¿ä¸ªåè½ï¼å¿é¡»ä¸ºä¸åçåºç¨åºæ¯æä¾ä¸åçç­ç¥ï¼åå­æ·æ±°ç­ç¥è®²çæ¯ä¸ºå®ç°åå­æ·æ±°æä»¬å·ä½æä¹åï¼è¦è§£å³çé®é¢åæ¬æ·æ±°é®ç©ºé´å¦ä½éæ©ï¼å¨é®ç©ºé´ä¸­æ·æ±°é®å¦ä½éæ©ï¼\n\nRedis æä¾äºä¸é¢å ç§åå­æ·æ±°ç­ç¥ä¾ç¨æ·éï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ Redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\n\n# å¦ä½éæ©æ·æ±°ç­ç¥\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼å­å¨ç­ç¹æ°æ®ï¼é¨åæ°æ®è®¿é®é¢çé«ï¼é¨åæ°æ®è®¿é®é¢çä½ï¼ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼æ°æ®è®¿é®é¢çå¤§è´ç¸åï¼ï¼åä½¿ç¨ allkeys-randomã\n * å¦æå¸æä½¿ç¨ä¸åç TTL å¼å Redis æç¤ºåªäº key æ´éåè¢«æ·æ±°ï¼è¯·ä½¿ç¨ volatile-ttlã\n * volatile-lru å volatile-random éåæ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çåºæ¯ï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª Redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\n\n# åé¨å®ç°\n\nRedis å é¤å¤±æä¸»é®çæ¹æ³ä¸»è¦æä¸¤ç§ï¼\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å¨ææ§å°ä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n * ä¸»å¨å é¤ï¼å½åå·²ç¨åå­è¶è¿ maxmemory éå®æ¶ï¼è§¦åä¸»å¨æ¸çç­ç¥ï¼è¯¥ç­ç¥ç±å¯å¨åæ°çéç½®å³å®ä¸»é®å·ä½çå¤±ææ¶é´å¨é¨é½ç»´æ¤å¨ expires è¿ä¸ªå­å¸è¡¨ä¸­ã\n\n\n# åãRedis æä¹å\n\nRedis æ¯åå­åæ°æ®åºï¼ä¸ºäºä¿è¯æ°æ®å¨å®æºåä¸ä¼ä¸¢å¤±ï¼éè¦å°åå­ä¸­çæ°æ®æä¹åå°ç¡¬çä¸ã\n\nRedis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼RDB å AOFã\n\n * RDB - RDB å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ Redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼RDB æä»¶ï¼ä¸­ã\n * AOF - AOF(Append Only File) æ¯ä»¥ææ¬æ¥å¿å½¢å¼å°ææåå½ä»¤è¿½å å° AOF æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯çæ¶åä¼éæ°è½½å¥åæ§è¡è¿äºå½ä»¤æ¥æ¢å¤åå§çæ°æ®ãAOF éåä½ä¸º ç­å¤ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis æä¹å\n\n\n# äºãRedis äºä»¶\n\nRedis æå¡å¨æ¯ä¸ä¸ªäºä»¶é©±å¨ç¨åºï¼æå¡å¨éè¦å¤çä¸¤ç±»äºä»¶ï¼\n\n * æä»¶äºä»¶ï¼file eventï¼ - Redis æå¡å¨éè¿å¥æ¥å­ï¼Socketï¼ä¸å®¢æ·ç«¯æèå¶å®æå¡å¨è¿è¡éä¿¡ï¼æä»¶äºä»¶å°±æ¯å¯¹å¥æ¥å­æä½çæ½è±¡ãæå¡å¨ä¸å®¢æ·ç«¯ï¼æå¶ä»çæå¡å¨ï¼çéä¿¡ä¼äº§çæä»¶äºä»¶ï¼èæå¡å¨éè¿çå¬å¹¶å¤çè¿äºäºä»¶æ¥å®æä¸ç³»åç½ç»éä¿¡æä½ã\n * æ¶é´äºä»¶ï¼time eventï¼ - Redis æå¡å¨æä¸äºæä½éè¦å¨ç»å®çæ¶é´ç¹æ§è¡ï¼æ¶é´äºä»¶æ¯å¯¹è¿ç±»å®æ¶æä½çæ½è±¡ã\n\n\n# æä»¶äºä»¶\n\nRedis åºäº Reactor æ¨¡å¼å¼åäºèªå·±çç½ç»æ¶é´å¤çå¨ã\n\n * Redis æä»¶äºä»¶å¤çå¨ä½¿ç¨ I/O å¤è·¯å¤ç¨ç¨åºæ¥åæ¶çå¬å¤ä¸ªå¥æ¥å­ï¼å¹¶æ ¹æ®å¥æ¥å­ç®åæ§è¡çä»»å¡æ¥ä¸ºå¥æ¥å­å³èä¸åçäºä»¶å¤çå¨ã\n * å½è¢«çå¬çå¥æ¥å­åå¤å¥½æ§è¡è¿æ¥åºç­ãè¯»åãåå¥ãå³é­æä½æ¶ï¼ä¸æä½ç¸å¯¹åºçæä»¶äºä»¶å°±ä¼äº§çï¼è¿æ¶æä»¶äºä»¶å¤çå¨å°±ä¼è°ç¨å¥æ¥å­ä¹åå³èå¥½çäºä»¶å¤çå¨æ¥å¤çè¿äºäºä»¶ã\n\nè½ç¶æä»¶äºä»¶å¤çå¨ä»¥åçº¿ç¨æ¹å¼è¿è¡ï¼ä½éè¿ä½¿ç¨ I/O å¤è·¯å¤ç¨ç¨åºæ¥çå¬å¤ä¸ªå¥æ¥å­ï¼æä»¶äºä»¶å¤çå¨å®ç°äºé«æ§è½çç½ç»éä¿¡æ¨¡åã\n\næä»¶äºä»¶å¤çå¨æåä¸ªç»æé¨åï¼å¥æ¥å­ãI/O å¤è·¯å¤ç¨ç¨åºãæä»¶äºä»¶åæ´¾å¨ãäºä»¶å¤çå¨ã\n\n\n\n\n# æ¶é´äºä»¶\n\næ¶é´äºä»¶ååä¸ºï¼\n\n * å®æ¶äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºå¨æå®çæ¶é´ä¹åæ§è¡ä¸æ¬¡ï¼\n * å¨ææ§äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºæ¯éæå®æ¶é´å°±æ§è¡ä¸æ¬¡ã\n\nRedis å°æææ¶é´äºä»¶é½æ¾å¨ä¸ä¸ªæ åºé¾è¡¨ä¸­ï¼æ¯å½æ¶é´äºä»¶æ§è¡å¨è¿è¡æ¶ï¼éè¿éåæ´ä¸ªé¾è¡¨æ¥æ¾åºå·²å°è¾¾çæ¶é´äºä»¶ï¼å¹¶è°ç¨ååºçäºä»¶å¤çå¨ã\n\n\n# äºä»¶çè°åº¦ä¸æ§è¡\n\næå¡å¨éè¦ä¸æ­çå¬æä»¶äºä»¶çå¥æ¥å­æè½å¾å°å¾å¤ççæä»¶äºä»¶ï¼ä½æ¯ä¸è½ä¸ç´çå¬ï¼å¦åæ¶é´äºä»¶æ æ³å¨è§å®çæ¶é´åæ§è¡ï¼å æ­¤çå¬æ¶é´åºè¯¥æ ¹æ®è·ç¦»ç°å¨æè¿çæ¶é´äºä»¶æ¥å³å®ã\n\näºä»¶è°åº¦ä¸æ§è¡ç± aeProcessEvents å½æ°è´è´£ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef aeProcessEvents():\n\n    ## è·åå°è¾¾æ¶é´ç¦»å½åæ¶é´ææ¥è¿çæ¶é´äºä»¶\n    time_event = aeSearchNearestTimer()\n\n    ## è®¡ç®ææ¥è¿çæ¶é´äºä»¶è·ç¦»å°è¾¾è¿æå¤å°æ¯«ç§\n    remaind_ms = time_event.when - unix_ts_now()\n\n    ## å¦æäºä»¶å·²å°è¾¾ï¼é£ä¹ remaind_ms çå¼å¯è½ä¸ºè´æ°ï¼å°å®è®¾ä¸º 0\n    if remaind_ms < 0:\n        remaind_ms = 0\n\n    ## æ ¹æ® remaind_ms çå¼ï¼åå»º timeval\n    timeval = create_timeval_with_ms(remaind_ms)\n\n    ## é»å¡å¹¶ç­å¾æä»¶äºä»¶äº§çï¼æå¤§é»å¡æ¶é´ç±ä¼ å¥ç timeval å³å®\n    aeApiPoll(timeval)\n\n    ## å¤çææå·²äº§ççæä»¶äºä»¶\n    procesFileEvents()\n\n    ## å¤çææå·²å°è¾¾çæ¶é´äºä»¶\n    processTimeEvents()\n\n\nå° aeProcessEvents å½æ°ç½®äºä¸ä¸ªå¾ªç¯éé¢ï¼å ä¸åå§ååæ¸çå½æ°ï¼å°±ææäº Redis æå¡å¨çä¸»å½æ°ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef main():\n\n    ## åå§åæå¡å¨\n    init_server()\n\n    ## ä¸ç´å¤çäºä»¶ï¼ç´å°æå¡å¨å³é­ä¸ºæ­¢\n    while server_is_not_shutdown():\n        aeProcessEvents()\n\n    ## æå¡å¨å³é­ï¼æ§è¡æ¸çæä½\n    clean_server()\n\n\nä»äºä»¶å¤ççè§åº¦æ¥çï¼æå¡å¨è¿è¡æµç¨å¦ä¸ï¼\n\n\n\n\n# å­ãRedis äºå¡\n\n> Redis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼Redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nMULTI ã EXEC ã DISCARD å WATCH æ¯ Redis äºå¡ç¸å³çå½ä»¤ã\n\näºå¡å¯ä»¥ä¸æ¬¡æ§è¡å¤ä¸ªå½ä»¤ï¼ å¹¶ä¸æä»¥ä¸ä¸¤ä¸ªéè¦çä¿è¯ï¼\n\n * äºå¡æ¯ä¸ä¸ªåç¬çéç¦»æä½ï¼äºå¡ä¸­çææå½ä»¤é½ä¼åºååãæé¡ºåºå°æ§è¡ãäºå¡å¨æ§è¡çè¿ç¨ä¸­ï¼ä¸ä¼è¢«å¶ä»å®¢æ·ç«¯åéæ¥çå½ä»¤è¯·æ±æææ­ã\n * äºå¡æ¯ä¸ä¸ªåå­æä½ï¼äºå¡ä¸­çå½ä»¤è¦ä¹å¨é¨è¢«æ§è¡ï¼è¦ä¹å¨é¨é½ä¸æ§è¡ã\n\n\n# MULTI\n\nMULTI å½ä»¤ç¨äºå¼å¯ä¸ä¸ªäºå¡ï¼å®æ»æ¯è¿å OK ã\n\nMULTI æ§è¡ä¹åï¼ å®¢æ·ç«¯å¯ä»¥ç»§ç»­åæå¡å¨åéä»»æå¤æ¡å½ä»¤ï¼ è¿äºå½ä»¤ä¸ä¼ç«å³è¢«æ§è¡ï¼ èæ¯è¢«æ¾å°ä¸ä¸ªéåä¸­ï¼ å½ EXEC å½ä»¤è¢«è°ç¨æ¶ï¼ ææéåä¸­çå½ä»¤æä¼è¢«æ§è¡ã\n\nä»¥ä¸æ¯ä¸ä¸ªäºå¡ä¾å­ï¼ å®åå­å°å¢å äº foo å bar ä¸¤ä¸ªé®çå¼ï¼\n\n> MULTI\nOK\n> INCR foo\nQUEUED\n> INCR bar\nQUEUED\n> EXEC\n1) (integer) 1\n2) (integer) 1\n\n\n\n# EXEC\n\nEXEC å½ä»¤è´è´£è§¦åå¹¶æ§è¡äºå¡ä¸­çææå½ä»¤ã\n\n * å¦æå®¢æ·ç«¯å¨ä½¿ç¨ MULTI å¼å¯äºä¸ä¸ªäºå¡ä¹åï¼å´å ä¸ºæ­çº¿èæ²¡ææåæ§è¡ EXEC ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¸ä¼è¢«æ§è¡ã\n * å¦ä¸æ¹é¢ï¼å¦æå®¢æ·ç«¯æåå¨å¼å¯äºå¡ä¹åæ§è¡ EXEC ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¼è¢«æ§è¡ã\n\n\n# DISCARD\n\nå½æ§è¡ DISCARD å½ä»¤æ¶ï¼ äºå¡ä¼è¢«æ¾å¼ï¼ äºå¡éåä¼è¢«æ¸ç©ºï¼ å¹¶ä¸å®¢æ·ç«¯ä¼ä»äºå¡ç¶æä¸­éåºã\n\nç¤ºä¾ï¼\n\n> SET foo 1\nOK\n> MULTI\nOK\n> INCR foo\nQUEUED\n> DISCARD\nOK\n> GET foo\n"1"\n\n\n\n# WATCH\n\nWATCH å½ä»¤å¯ä»¥ä¸º Redis äºå¡æä¾ check-and-set ï¼CASï¼è¡ä¸ºã\n\nè¢« WATCH çé®ä¼è¢«çè§ï¼å¹¶ä¼åè§è¿äºé®æ¯å¦è¢«æ¹å¨è¿äºã å¦ææè³å°ä¸ä¸ªè¢«çè§çé®å¨ EXEC æ§è¡ä¹åè¢«ä¿®æ¹äºï¼ é£ä¹æ´ä¸ªäºå¡é½ä¼è¢«åæ¶ï¼ EXEC è¿å nil-reply æ¥è¡¨ç¤ºäºå¡å·²ç»å¤±è´¥ã\n\nWATCH mykey\nval = GET mykey\nval = val + 1\nMULTI\nSET mykey $val\nEXEC\n\n\nä½¿ç¨ä¸é¢çä»£ç ï¼ å¦æå¨ WATCH æ§è¡ä¹åï¼ EXEC æ§è¡ä¹åï¼ æå¶ä»å®¢æ·ç«¯ä¿®æ¹äº mykey çå¼ï¼ é£ä¹å½åå®¢æ·ç«¯çäºå¡å°±ä¼å¤±è´¥ã ç¨åºéè¦åçï¼ å°±æ¯ä¸æ­éè¯è¿ä¸ªæä½ï¼ ç´å°æ²¡æåçç¢°æä¸ºæ­¢ã\n\nè¿ç§å½¢å¼çéè¢«ç§°ä½ä¹è§éï¼ å®æ¯ä¸ç§éå¸¸å¼ºå¤§çéæºå¶ã å¹¶ä¸å ä¸ºå¤§å¤æ°æåµä¸ï¼ ä¸åçå®¢æ·ç«¯ä¼è®¿é®ä¸åçé®ï¼ ç¢°æçæåµä¸è¬é½å¾å°ï¼ æä»¥éå¸¸å¹¶ä¸éè¦è¿è¡éè¯ã\n\nWATCH ä½¿å¾ EXEC å½ä»¤éè¦ææ¡ä»¶å°æ§è¡ï¼äºå¡åªè½å¨ææè¢«çè§é®é½æ²¡æè¢«ä¿®æ¹çåæä¸æ§è¡ï¼å¦æè¿ä¸ªåæä¸è½æ»¡è¶³çè¯ï¼äºå¡å°±ä¸ä¼è¢«æ§è¡ã\n\nWATCH å½ä»¤å¯ä»¥è¢«è°ç¨å¤æ¬¡ãå¯¹é®ççè§ä» WATCH æ§è¡ä¹åå¼å§çæï¼ç´å°è°ç¨ EXEC ä¸ºæ­¢ã\n\nç¨æ·è¿å¯ä»¥å¨åä¸ª WATCH å½ä»¤ä¸­çè§ä»»æå¤ä¸ªé®ï¼ä¾å¦ï¼\n\nredis> WATCH key1 key2 key3\nOK\n\n\n# åæ¶ WATCH çåºæ¯\n\nå½ EXEC è¢«è°ç¨æ¶ï¼ ä¸ç®¡äºå¡æ¯å¦æåæ§è¡ï¼ å¯¹ææé®ççè§é½ä¼è¢«åæ¶ã\n\nå¦å¤ï¼ å½å®¢æ·ç«¯æ­å¼è¿æ¥æ¶ï¼ è¯¥å®¢æ·ç«¯å¯¹é®ççè§ä¹ä¼è¢«åæ¶ã\n\nä½¿ç¨æ åæ°ç UNWATCH å½ä»¤å¯ä»¥æå¨åæ¶å¯¹ææé®ççè§ã å¯¹äºä¸äºéè¦æ¹å¨å¤ä¸ªé®çäºå¡ï¼ ææ¶åç¨åºéè¦åæ¶å¯¹å¤ä¸ªé®è¿è¡å éï¼ ç¶åæ£æ¥è¿äºé®çå½åå¼æ¯å¦ç¬¦åç¨åºçè¦æ±ã å½å¼è¾¾ä¸å°è¦æ±æ¶ï¼ å°±å¯ä»¥ä½¿ç¨ UNWATCH å½ä»¤æ¥åæ¶ç®åå¯¹é®ççè§ï¼ ä¸­éæ¾å¼è¿ä¸ªäºå¡ï¼ å¹¶ç­å¾äºå¡çä¸æ¬¡å°è¯ã\n\n# ä½¿ç¨ WATCH åå»ºåå­æä½\n\nWATCH å¯ä»¥ç¨äºåå»º Redis æ²¡æåç½®çåå­æä½ã\n\nä¸¾ä¸ªä¾å­ï¼ä»¥ä¸ä»£ç å®ç°äºååç ZPOP å½ä»¤ï¼å®å¯ä»¥åå­å°å¼¹åºæåºéåä¸­åå¼ï¼scoreï¼æå°çåç´ ï¼\n\nWATCH zset\nelement = ZRANGE zset 0 0\nMULTI\nZREM zset element\nEXEC\n\n\n\n# Rollback\n\nRedis ä¸æ¯æåæ»ãRedis ä¸æ¯æåæ»ççç±ï¼\n\n * Redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ Redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\n\n# ä¸ãRedis ç®¡é\n\nRedis æ¯ä¸ç§åºäº C/S æ¨¡åä»¥åè¯·æ±/ååºåè®®ç TCP æå¡ãRedis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçã\n\nå¨éè¦æ¹éæ§è¡ Redis å½ä»¤æ¶ï¼å¦æä¸æ¡ä¸æ¡æ§è¡ï¼æ¾ç¶å¾ä½æãä¸ºäºåå°éä¿¡æ¬¡æ°å¹¶éä½å»¶è¿ï¼å¯ä»¥ä½¿ç¨ Redis ç®¡éåè½ãRedis çç®¡éï¼pipelineï¼åè½æ²¡ææä¾å½ä»¤è¡æ¯æï¼ä½æ¯å¨åç§è¯­è¨çæ¬çå®¢æ·ç«¯ä¸­é½æç¸åºçå®ç°ã\n\nä»¥ Jedis ä¸ºä¾ï¼\n\nPipeline pipe = conn.pipelined();\npipe.multi();\npipe.hset("login:", token, user);\npipe.zadd("recent:", timestamp, token);\nif (item != null) {\n    pipe.zadd("viewed:" + token, timestamp, item);\n    pipe.zremrangeByRank("viewed:" + token, 0, -26);\n    pipe.zincrby("viewed:", -1, item);\n}\npipe.exec();\n\n\n> ð æ³¨æï¼ä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼Redis Server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# å«ãRedis åå¸ä¸è®¢é\n\nRedis æä¾äº 5 ä¸ªåå¸ä¸è®¢éå½ä»¤ï¼\n\nå½ä»¤             æè¿°\nSUBSCRIBE      SUBSCRIBE channel [channel ...]âè®¢éæå®é¢éã\nUNSUBSCRIBE    UNSUBSCRIBE [channel [channel ...]]âåæ¶è®¢éæå®é¢éã\nPUBLISH        PUBLISH channel messageâåéä¿¡æ¯å°æå®çé¢éã\nPSUBSCRIBE     PSUBSCRIBE pattern [pattern ...]âè®¢éç¬¦åæå®æ¨¡å¼çé¢éã\nPUNSUBSCRIBE   PUNSUBSCRIBE [pattern [pattern ...]]âåæ¶è®¢éç¬¦åæå®æ¨¡å¼çé¢éã\n\nè®¢éèè®¢éäºé¢éä¹åï¼åå¸èåé¢éåéå­ç¬¦ä¸²æ¶æ¯ä¼è¢«ææè®¢éèæ¥æ¶å°ã\n\næä¸ªå®¢æ·ç«¯ä½¿ç¨ SUBSCRIBE è®¢éä¸ä¸ªé¢éï¼å¶å®å®¢æ·ç«¯å¯ä»¥ä½¿ç¨ PUBLISH åè¿ä¸ªé¢éåéæ¶æ¯ã\n\nåå¸ä¸è®¢éæ¨¡å¼åè§å¯èæ¨¡å¼æä»¥ä¸ä¸åï¼\n\n * è§å¯èæ¨¡å¼ä¸­ï¼è§å¯èåä¸»é¢é½ç¥éå¯¹æ¹çå­å¨ï¼èå¨åå¸ä¸è®¢éæ¨¡å¼ä¸­ï¼åå¸èä¸è®¢éèä¸ç¥éå¯¹æ¹çå­å¨ï¼å®ä»¬ä¹é´éè¿é¢éè¿è¡éä¿¡ã\n * è§å¯èæ¨¡å¼æ¯åæ­¥çï¼å½äºä»¶è§¦åæ¶ï¼ä¸»é¢ä¼å»è°ç¨è§å¯èçæ¹æ³ï¼èåå¸ä¸è®¢éæ¨¡å¼æ¯å¼æ­¥çï¼\n\n----------------------------------------\n\nåå²çº¿ä»¥ä¸ä¸º Redis éç¾¤åè½ç¹æ§\n\n\n# ä¹ãRedis å¤å¶\n\n> å³ç³»åæ°æ®åºéå¸¸ä¼ä½¿ç¨ä¸ä¸ªä¸»æå¡å¨åå¤ä¸ªä»æå¡å¨åéæ´æ°ï¼å¹¶ä½¿ç¨ä»æå¡å¨æ¥å¤çææè¯»è¯·æ±ï¼Redis ä¹éç¨äºåæ ·çæ¹å¼æ¥å®ç°å¤å¶ç¹æ§ã\n\n\n# æ§çå¤å¶\n\nRedis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº SYNC å½ä»¤å®ç°ã\n\nRedis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\nè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\n\n# æ°çå¤å¶\n\nRedis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº PSYNC å½ä»¤å®ç°ãPSYNC å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ã\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ SYNC å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥æä¸ä¸ªç»æé¨åï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ ID\n\n\n# PSYNC å½ä»¤\n\nä»æå¡å¨åè¦å¤å¶çä¸»æå¡å¨åé PSYNC <runid> <offset> å½ä»¤\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ã\n\n\n# å¿è·³æ£æµ\n\nä¸»æå¡å¨éè¿åä»æå¡ä¼ æ­å½ä»¤æ¥æ´æ°ä»æå¡å¨ç¶æï¼ä¿æä¸»ä»æ°æ®ä¸è´ã\n\nä»æå¡å¨éè¿åä¸»æå¡å¨åéå½ä»¤ REPLCONF ACK <replication_offset> æ¥è¿è¡å¿è·³æ£æµï¼ä»¥åå½ä»¤ä¸¢å¤±æ£æµã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis å¤å¶\n\n\n# åãRedis å¨åµ\n\nSentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼Redis å¨åµ\n\n\n# åä¸ãRedis éç¾¤\n\nåçæ¯å°æ°æ®ååä¸ºå¤ä¸ªé¨åçæ¹æ³ï¼å¯ä»¥å°æ°æ®å­å¨å°å¤å°æºå¨éé¢ï¼ä¹å¯ä»¥ä»å¤å°æºå¨éé¢è·åæ°æ®ï¼è¿ç§æ¹æ³å¨è§£å³æäºé®é¢æ¶å¯ä»¥è·å¾çº¿æ§çº§å«çæ§è½æåã\n\nåè®¾æ 4 ä¸ª Reids å®ä¾ R0ï¼R1ï¼R2ï¼R3ï¼è¿æå¾å¤è¡¨ç¤ºç¨æ·çé® user:1ï¼user:2ï¼... ç­ç­ï¼æä¸åçæ¹å¼æ¥éæ©ä¸ä¸ªæå®çé®å­å¨å¨åªä¸ªå®ä¾ä¸­ãæç®åçæ¹å¼æ¯èå´åçï¼ä¾å¦ç¨æ· id ä» 0~1000 çå­å¨å°å®ä¾ R0 ä¸­ï¼ç¨æ· id ä» 1001~2000 çå­å¨å°å®ä¾ R1 ä¸­ï¼ç­ç­ãä½æ¯è¿æ ·éè¦ç»´æ¤ä¸å¼ æ å°èå´è¡¨ï¼ç»´æ¤æä½ä»£ä»·å¾é«ãè¿æä¸ç§æ¹å¼æ¯åå¸åçï¼ä½¿ç¨ CRC32 åå¸å½æ°å°é®è½¬æ¢ä¸ºä¸ä¸ªæ°å­ï¼åå¯¹å®ä¾æ°éæ±æ¨¡å°±è½ç¥éåºè¯¥å­å¨çå®ä¾ã\n\nä¸»è¦æä¸ç§åçæ¹å¼ï¼\n\n * å®¢æ·ç«¯åçï¼å®¢æ·ç«¯ä½¿ç¨ä¸è´æ§åå¸ç­ç®æ³å³å®é®åºå½åå¸å°åªä¸ªèç¹ã\n * ä»£çåçï¼å°å®¢æ·ç«¯è¯·æ±åéå°ä»£çä¸ï¼ç±ä»£çè½¬åè¯·æ±å°æ­£ç¡®çèç¹ä¸ã\n * æå¡å¨åçï¼Redis Clusterï¼å®æ¹ç Redis éç¾¤è§£å³æ¹æ¡ï¼ã\n\n\n# åäºãRedis Client\n\nRedis ç¤¾åºä¸­æå¤ç§ç¼ç¨è¯­è¨çå®¢æ·ç«¯ï¼å¯ä»¥å¨è¿éæ¥æ¾åéçå®¢æ·ç«¯ï¼Redis å®æ¹ç½åçå®¢æ·ç«¯æ¸å\n\nredis å®æ¹æ¨èç Java Redis Clientï¼\n\n * jedis - ææµè¡ç Redis Java å®¢æ·ç«¯\n * redisson - é¢å¤æä¾äºå¾å¤çåå¸å¼æå¡ç¹æ§ï¼å¦ï¼åå¸å¼éãåå¸å¼ Java å¸¸ç¨å¯¹è±¡ï¼BitSetãBlockingQueueãCountDownLatch ç­ï¼\n * lettuce - Spring Boot 2.0 é»è®¤ Redis å®¢æ·ç«¯\n\n\n# æ©å±éè¯»\n\n> ð¡ Redis å¸¸ç¨äºåå¸å¼ç¼å­ï¼æå³ç¼å­çç¹æ§ååçè¯·åèï¼ç¼å­åºæ¬åç\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯',normalizedContent:'# redis åºç¨æå\n\n\n# ä¸ãredis ç®ä»\n\n> redis æ¯éåº¦éå¸¸å¿«çéå³ç³»åï¼nosqlï¼åå­é®å¼æ°æ®åºï¼å¯ä»¥å­å¨é®åäºç§ä¸åç±»åçå¼ä¹é´çæ å°ã\n> \n> é®çç±»ååªè½ä¸ºå­ç¬¦ä¸²ï¼å¼æ¯æçäºç§ç±»åæ°æ®ç±»åä¸ºï¼å­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n\n\n# redis ä½¿ç¨åºæ¯\n\n * ç¼å­ - å°ç­ç¹æ°æ®æ¾å°åå­ä¸­ï¼è®¾ç½®åå­çæå¤§ä½¿ç¨éä»¥åè¿ææ·æ±°ç­ç¥æ¥ä¿è¯ç¼å­çå½ä¸­çã\n * è®¡æ°å¨ - redis è¿ç§åå­æ°æ®åºè½æ¯æè®¡æ°å¨é¢ç¹çè¯»åæä½ã\n * åºç¨éæµ - éå¶ä¸ä¸ªç½ç«è®¿é®æµéã\n * æ¶æ¯éå - ä½¿ç¨ list æ°æ®ç±»åï¼å®æ¯ååé¾è¡¨ã\n * æ¥æ¾è¡¨ - ä½¿ç¨ hash æ°æ®ç±»åã\n * äº¤éè¿ç® - ä½¿ç¨ set ç±»åï¼ä¾å¦æ±ä¸¤ä¸ªç¨æ·çå±åå¥½åã\n * æè¡æ¦ - ä½¿ç¨ zset æ°æ®ç±»åã\n * åå¸å¼ session - å¤ä¸ªåºç¨æå¡å¨ç session é½å­å¨å° redis ä¸­æ¥ä¿è¯ session çä¸è´æ§ã\n * åå¸å¼é - é¤äºå¯ä»¥ä½¿ç¨ setnx å®ç°åå¸å¼éä¹å¤ï¼è¿å¯ä»¥ä½¿ç¨å®æ¹æä¾ç redlock åå¸å¼éå®ç°ã\n\n\n# redis çä¼å¿\n\n * æ§è½æé« â redis è½è¯»çéåº¦æ¯ 110000 æ¬¡/s,åçéåº¦æ¯ 81000 æ¬¡/sã\n * ä¸°å¯çæ°æ®ç±»å - æ¯æå­ç¬¦ä¸²ãåè¡¨ãéåãæåºéåãæ£åè¡¨ã\n * åå­ - redis çæææä½é½æ¯åå­æ§çãåä¸ªæä½æ¯åå­æ§çãå¤ä¸ªæä½ä¹æ¯æäºå¡ï¼å³åå­æ§ï¼éè¿ multi å exec æä»¤åèµ·æ¥ã\n * æä¹å - redis æ¯ææ°æ®çæä¹åãå¯ä»¥å°åå­ä¸­çæ°æ®ä¿å­å¨ç£çä¸­ï¼éå¯çæ¶åå¯ä»¥åæ¬¡å è½½è¿è¡ä½¿ç¨ã\n * å¤ä»½ - redis æ¯ææ°æ®çå¤ä»½ï¼å³ master-slave æ¨¡å¼çæ°æ®å¤ä»½ã\n * ä¸°å¯çç¹æ§ - redis è¿æ¯æåå¸è®¢é, éç¥, key è¿æç­ç­ç¹æ§ã\n\n\n# redis ä¸ memcached\n\nredis ä¸ memcached å ä¸ºé½å¯ä»¥ç¨äºç¼å­ï¼æä»¥å¸¸å¸¸è¢«æ¿æ¥åæ¯è¾ï¼äºèä¸»è¦æä»¥ä¸åºå«ï¼\n\næ°æ®ç±»å\n\n * memcached ä»æ¯æå­ç¬¦ä¸²ç±»åï¼\n * è redis æ¯æäºç§ä¸åç§ç±»çæ°æ®ç±»åï¼ä½¿å¾å®å¯ä»¥æ´çµæ´»å°è§£å³é®é¢ã\n\næ°æ®æä¹å\n\n * memcached ä¸æ¯ææä¹åï¼\n * redis æ¯æä¸¤ç§æä¹åç­ç¥ï¼rdb å¿«ç§å aof æ¥å¿ã\n\nåå¸å¼\n\n * memcached ä¸æ¯æåå¸å¼ï¼åªè½éè¿å¨å®¢æ·ç«¯ä½¿ç¨åä¸è´æ§åå¸è¿æ ·çåå¸å¼ç®æ³æ¥å®ç°åå¸å¼å­å¨ï¼è¿ç§æ¹å¼å¨å­å¨åæ¥è¯¢æ¶é½éè¦åå¨å®¢æ·ç«¯è®¡ç®ä¸æ¬¡æ°æ®æå¨çèç¹ã\n * redis cluster å®ç°äºåå¸å¼çæ¯æã\n\nåå­ç®¡çæºå¶\n\n * memcached å°åå­åå²æç¹å®é¿åº¦çåæ¥å­å¨æ°æ®ï¼ä»¥å®å¨è§£å³åå­ç¢ççé®é¢ï¼ä½æ¯è¿ç§æ¹å¼ä¼ä½¿å¾åå­çå©ç¨çä¸é«ï¼ä¾å¦åçå¤§å°ä¸º 128 bytesï¼åªå­å¨ 100 bytes çæ°æ®ï¼é£ä¹å©ä¸ç 28 bytes å°±æµªè´¹æäºã\n * å¨ redis ä¸­ï¼å¹¶ä¸æ¯æææ°æ®é½ä¸ç´å­å¨å¨åå­ä¸­ï¼å¯ä»¥å°ä¸äºå¾ä¹æ²¡ç¨ç value äº¤æ¢å°ç£çãè memcached çæ°æ®åä¼ä¸ç´å¨åå­ä¸­ã\n\n\n# redis ä¸ºä»ä¹å¿«\n\nredis åæº qps è½è¾¾å° 100000ã\n\nredis æ¯åçº¿ç¨æ¨¡åï¼redis 6.0 å·²ç»æ¯æå¤çº¿ç¨æ¨¡åï¼ï¼ä¸ºä»ä¹è¿è½æè¿ä¹é«çå¹¶åï¼\n\n * redis å®å¨åºäºåå­æä½ã\n * redis æ°æ®ç»æç®åã\n * éç¨åçº¿ç¨ï¼é¿åçº¿ç¨ä¸ä¸æåæ¢åç«äºã\n * ä½¿ç¨ i/o å¤è·¯å¤ç¨æ¨¡åï¼éé»å¡ i/oï¼ã\n\n> i/o å¤è·¯å¤ç¨\n> \n> i/o å¤è·¯å¤ç¨æ¨¡åæ¯å©ç¨ selectãpollãepoll å¯ä»¥åæ¶çå¯å¤ä¸ªæµç i/o äºä»¶çè½åï¼å¨ç©ºé²çæ¶åï¼ä¼æå½åçº¿ç¨é»å¡æï¼å½æä¸ä¸ªæå¤ä¸ªæµæ i/o äºä»¶æ¶ï¼å°±ä»é»å¡æä¸­å¤éï¼äºæ¯ç¨åºå°±ä¼è½®è¯¢ä¸éææçæµï¼epoll æ¯åªè½®è¯¢é£äºçæ­£ååºäºäºä»¶çæµï¼ï¼å¹¶ä¸åªä¾æ¬¡é¡ºåºçå¤çå°±ç»ªçæµï¼è¿ç§åæ³å°±é¿åäºå¤§éçæ ç¨æä½ã\n\n\n# äºãredis æ°æ®ç±»å\n\nredis åºæ¬æ°æ®ç±»åï¼stringãhashãlistãsetãzset\n\nredis é«çº§æ°æ®ç±»åï¼bitmapãhyperloglogãgeo\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis æ°æ®ç±»åååºç¨\n\n\n# ä¸ãredis åå­æ·æ±°\n\n\n# åå­æ·æ±°è¦ç¹\n\n * æå¤§ç¼å­ - redis åè®¸éè¿ maxmemory åæ°æ¥è®¾ç½®åå­æå¤§å¼ã\n\n * å¤±ææ¶é´ - ä½ä¸ºä¸ç§å®ææ¸çæ ææ°æ®çéè¦æºå¶ï¼å¨ redis æä¾çè¯¸å¤å½ä»¤ä¸­ï¼expireãexpireatãpexpireãpexpireat ä»¥å setex å psetex åå¯ä»¥ç¨æ¥è®¾ç½®ä¸æ¡é®å¼å¯¹çå¤±ææ¶é´ãèä¸æ¡é®å¼å¯¹ä¸æ¦è¢«å³èäºå¤±ææ¶é´å°±ä¼å¨å°æåèªå¨å é¤ï¼æèè¯´åå¾æ æ³è®¿é®æ´ä¸ºåç¡®ï¼ã\n\n * æ·æ±°ç­ç¥ - éçä¸æ­çå redis ä¸­ä¿å­æ°æ®ï¼å½åå­å©ä½ç©ºé´æ æ³æ»¡è¶³æ·»å çæ°æ®æ¶ï¼redis åå°±ä¼æ½è¡æ°æ®æ·æ±°ç­ç¥ï¼æ¸é¤ä¸é¨ååå®¹ç¶åä¿è¯æ°çæ°æ®å¯ä»¥ä¿å­å°åå­ä¸­ãåå­æ·æ±°æºå¶æ¯ä¸ºäºæ´å¥½çä½¿ç¨åå­ï¼ç¨ä¸å®å¾ miss æ¥æ¢ååå­çå©ç¨çï¼ä¿è¯ redis ç¼å­ä¸­ä¿å­çé½æ¯ç­ç¹æ°æ®ã\n\n * éç²¾åç lru - å®éä¸ redis å®ç°ç lru å¹¶ä¸æ¯å¯é ç lruï¼ä¹å°±æ¯åä¹ä¸æä»¬ä½¿ç¨ lru ç®æ³æ·æ±°é®ï¼ä½æ¯å®éä¸è¢«æ·æ±°çé®å¹¶ä¸ä¸å®æ¯çæ­£çæä¹æ²¡ç¨çã\n\n\n# ä¸»é®è¿ææ¶é´\n\nredis å¯ä»¥ä¸ºæ¯ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼å½é®è¿ææ¶ï¼ä¼èªå¨å é¤è¯¥é®ã\n\nå¯¹äºæ£åè¡¨è¿ç§å®¹å¨ï¼åªè½ä¸ºæ´ä¸ªé®è®¾ç½®è¿ææ¶é´ï¼æ´ä¸ªæ£åè¡¨ï¼ï¼èä¸è½ä¸ºé®éé¢çåä¸ªåç´ è®¾ç½®è¿ææ¶é´ã\n\nå¯ä»¥ä½¿ç¨ expire æ expireat æ¥ä¸º key è®¾ç½®è¿ææ¶é´ã\n\n> ð æ³¨æï¼å½ expire çæ¶é´å¦æè®¾ç½®çæ¯è´æ°ï¼expireat è®¾ç½®çæ¶é´æ³æ¯è¿ææ¶é´ï¼å°ç´æ¥å é¤ keyã\n\nç¤ºä¾ï¼\n\nredis> set mykey "hello"\n"ok"\nredis> expire mykey 10\n(integer) 1\nredis> ttl mykey\n(integer) 10\nredis> set mykey "hello world"\n"ok"\nredis> ttl mykey\n(integer) -1\nredis>\n\n\n\n# æ·æ±°ç­ç¥\n\nåå­æ·æ±°åªæ¯ redis æä¾çä¸ä¸ªåè½ï¼ä¸ºäºæ´å¥½å°å®ç°è¿ä¸ªåè½ï¼å¿é¡»ä¸ºä¸åçåºç¨åºæ¯æä¾ä¸åçç­ç¥ï¼åå­æ·æ±°ç­ç¥è®²çæ¯ä¸ºå®ç°åå­æ·æ±°æä»¬å·ä½æä¹åï¼è¦è§£å³çé®é¢åæ¬æ·æ±°é®ç©ºé´å¦ä½éæ©ï¼å¨é®ç©ºé´ä¸­æ·æ±°é®å¦ä½éæ©ï¼\n\nredis æä¾äºä¸é¢å ç§åå­æ·æ±°ç­ç¥ä¾ç¨æ·éï¼\n\n * noeviction - å½åå­ä½¿ç¨è¾¾å°éå¼çæ¶åï¼ææå¼èµ·ç³è¯·åå­çå½ä»¤ä¼æ¥éãè¿æ¯ redis é»è®¤çç­ç¥ã\n * allkeys-lru - å¨ä¸»é®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * allkeys-random - å¨ä¸»é®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-lru - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼ä¼åç§»é¤æè¿æªä½¿ç¨ç keyã\n * volatile-random - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼éæºç§»é¤æä¸ª keyã\n * volatile-ttl - å¨è®¾ç½®äºè¿ææ¶é´çé®ç©ºé´ä¸­ï¼å·ææ´æ©è¿ææ¶é´ç key ä¼åç§»é¤ã\n\n\n# å¦ä½éæ©æ·æ±°ç­ç¥\n\n * å¦ææ°æ®åç°å¹ç­åå¸ï¼å­å¨ç­ç¹æ°æ®ï¼é¨åæ°æ®è®¿é®é¢çé«ï¼é¨åæ°æ®è®¿é®é¢çä½ï¼ï¼åä½¿ç¨ allkeys-lruã\n * å¦ææ°æ®åç°å¹³ç­åå¸ï¼æ°æ®è®¿é®é¢çå¤§è´ç¸åï¼ï¼åä½¿ç¨ allkeys-randomã\n * å¦æå¸æä½¿ç¨ä¸åç ttl å¼å redis æç¤ºåªäº key æ´éåè¢«æ·æ±°ï¼è¯·ä½¿ç¨ volatile-ttlã\n * volatile-lru å volatile-random éåæ¢åºç¨äºç¼å­åååºç¨äºæä¹åå­å¨çåºæ¯ï¼ç¶èæä»¬ä¹å¯ä»¥éè¿ä½¿ç¨ä¸¤ä¸ª redis å®ä¾æ¥è¾¾å°ç¸åçææã\n * å° key è®¾ç½®è¿ææ¶é´å®éä¸ä¼æ¶èæ´å¤çåå­ï¼å æ­¤å»ºè®®ä½¿ç¨ allkeys-lru ç­ç¥ä»èæ´ææççä½¿ç¨åå­ã\n\n\n# åé¨å®ç°\n\nredis å é¤å¤±æä¸»é®çæ¹æ³ä¸»è¦æä¸¤ç§ï¼\n\n * æ¶ææ¹æ³ï¼passive wayï¼ï¼å¨ä¸»é®è¢«è®¿é®æ¶å¦æåç°å®å·²ç»å¤±æï¼é£ä¹å°±å é¤å®ã\n * ä¸»å¨æ¹æ³ï¼active wayï¼ï¼å¨ææ§å°ä»è®¾ç½®äºå¤±ææ¶é´çä¸»é®ä¸­éæ©ä¸é¨åå¤±æçä¸»é®å é¤ã\n * ä¸»å¨å é¤ï¼å½åå·²ç¨åå­è¶è¿ maxmemory éå®æ¶ï¼è§¦åä¸»å¨æ¸çç­ç¥ï¼è¯¥ç­ç¥ç±å¯å¨åæ°çéç½®å³å®ä¸»é®å·ä½çå¤±ææ¶é´å¨é¨é½ç»´æ¤å¨ expires è¿ä¸ªå­å¸è¡¨ä¸­ã\n\n\n# åãredis æä¹å\n\nredis æ¯åå­åæ°æ®åºï¼ä¸ºäºä¿è¯æ°æ®å¨å®æºåä¸ä¼ä¸¢å¤±ï¼éè¦å°åå­ä¸­çæ°æ®æä¹åå°ç¡¬çä¸ã\n\nredis æ¯æä¸¤ç§æä¹åæ¹å¼ï¼rdb å aofã\n\n * rdb - rdb å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼rdb æä»¶ï¼ä¸­ã\n * aof - aof(append only file) æ¯ä»¥ææ¬æ¥å¿å½¢å¼å°ææåå½ä»¤è¿½å å° aof æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯çæ¶åä¼éæ°è½½å¥åæ§è¡è¿äºå½ä»¤æ¥æ¢å¤åå§çæ°æ®ãaof éåä½ä¸º ç­å¤ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis æä¹å\n\n\n# äºãredis äºä»¶\n\nredis æå¡å¨æ¯ä¸ä¸ªäºä»¶é©±å¨ç¨åºï¼æå¡å¨éè¦å¤çä¸¤ç±»äºä»¶ï¼\n\n * æä»¶äºä»¶ï¼file eventï¼ - redis æå¡å¨éè¿å¥æ¥å­ï¼socketï¼ä¸å®¢æ·ç«¯æèå¶å®æå¡å¨è¿è¡éä¿¡ï¼æä»¶äºä»¶å°±æ¯å¯¹å¥æ¥å­æä½çæ½è±¡ãæå¡å¨ä¸å®¢æ·ç«¯ï¼æå¶ä»çæå¡å¨ï¼çéä¿¡ä¼äº§çæä»¶äºä»¶ï¼èæå¡å¨éè¿çå¬å¹¶å¤çè¿äºäºä»¶æ¥å®æä¸ç³»åç½ç»éä¿¡æä½ã\n * æ¶é´äºä»¶ï¼time eventï¼ - redis æå¡å¨æä¸äºæä½éè¦å¨ç»å®çæ¶é´ç¹æ§è¡ï¼æ¶é´äºä»¶æ¯å¯¹è¿ç±»å®æ¶æä½çæ½è±¡ã\n\n\n# æä»¶äºä»¶\n\nredis åºäº reactor æ¨¡å¼å¼åäºèªå·±çç½ç»æ¶é´å¤çå¨ã\n\n * redis æä»¶äºä»¶å¤çå¨ä½¿ç¨ i/o å¤è·¯å¤ç¨ç¨åºæ¥åæ¶çå¬å¤ä¸ªå¥æ¥å­ï¼å¹¶æ ¹æ®å¥æ¥å­ç®åæ§è¡çä»»å¡æ¥ä¸ºå¥æ¥å­å³èä¸åçäºä»¶å¤çå¨ã\n * å½è¢«çå¬çå¥æ¥å­åå¤å¥½æ§è¡è¿æ¥åºç­ãè¯»åãåå¥ãå³é­æä½æ¶ï¼ä¸æä½ç¸å¯¹åºçæä»¶äºä»¶å°±ä¼äº§çï¼è¿æ¶æä»¶äºä»¶å¤çå¨å°±ä¼è°ç¨å¥æ¥å­ä¹åå³èå¥½çäºä»¶å¤çå¨æ¥å¤çè¿äºäºä»¶ã\n\nè½ç¶æä»¶äºä»¶å¤çå¨ä»¥åçº¿ç¨æ¹å¼è¿è¡ï¼ä½éè¿ä½¿ç¨ i/o å¤è·¯å¤ç¨ç¨åºæ¥çå¬å¤ä¸ªå¥æ¥å­ï¼æä»¶äºä»¶å¤çå¨å®ç°äºé«æ§è½çç½ç»éä¿¡æ¨¡åã\n\næä»¶äºä»¶å¤çå¨æåä¸ªç»æé¨åï¼å¥æ¥å­ãi/o å¤è·¯å¤ç¨ç¨åºãæä»¶äºä»¶åæ´¾å¨ãäºä»¶å¤çå¨ã\n\n\n\n\n# æ¶é´äºä»¶\n\næ¶é´äºä»¶ååä¸ºï¼\n\n * å®æ¶äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºå¨æå®çæ¶é´ä¹åæ§è¡ä¸æ¬¡ï¼\n * å¨ææ§äºä»¶ï¼æ¯è®©ä¸æ®µç¨åºæ¯éæå®æ¶é´å°±æ§è¡ä¸æ¬¡ã\n\nredis å°æææ¶é´äºä»¶é½æ¾å¨ä¸ä¸ªæ åºé¾è¡¨ä¸­ï¼æ¯å½æ¶é´äºä»¶æ§è¡å¨è¿è¡æ¶ï¼éè¿éåæ´ä¸ªé¾è¡¨æ¥æ¾åºå·²å°è¾¾çæ¶é´äºä»¶ï¼å¹¶è°ç¨ååºçäºä»¶å¤çå¨ã\n\n\n# äºä»¶çè°åº¦ä¸æ§è¡\n\næå¡å¨éè¦ä¸æ­çå¬æä»¶äºä»¶çå¥æ¥å­æè½å¾å°å¾å¤ççæä»¶äºä»¶ï¼ä½æ¯ä¸è½ä¸ç´çå¬ï¼å¦åæ¶é´äºä»¶æ æ³å¨è§å®çæ¶é´åæ§è¡ï¼å æ­¤çå¬æ¶é´åºè¯¥æ ¹æ®è·ç¦»ç°å¨æè¿çæ¶é´äºä»¶æ¥å³å®ã\n\näºä»¶è°åº¦ä¸æ§è¡ç± aeprocessevents å½æ°è´è´£ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef aeprocessevents():\n\n    ## è·åå°è¾¾æ¶é´ç¦»å½åæ¶é´ææ¥è¿çæ¶é´äºä»¶\n    time_event = aesearchnearesttimer()\n\n    ## è®¡ç®ææ¥è¿çæ¶é´äºä»¶è·ç¦»å°è¾¾è¿æå¤å°æ¯«ç§\n    remaind_ms = time_event.when - unix_ts_now()\n\n    ## å¦æäºä»¶å·²å°è¾¾ï¼é£ä¹ remaind_ms çå¼å¯è½ä¸ºè´æ°ï¼å°å®è®¾ä¸º 0\n    if remaind_ms < 0:\n        remaind_ms = 0\n\n    ## æ ¹æ® remaind_ms çå¼ï¼åå»º timeval\n    timeval = create_timeval_with_ms(remaind_ms)\n\n    ## é»å¡å¹¶ç­å¾æä»¶äºä»¶äº§çï¼æå¤§é»å¡æ¶é´ç±ä¼ å¥ç timeval å³å®\n    aeapipoll(timeval)\n\n    ## å¤çææå·²äº§ççæä»¶äºä»¶\n    procesfileevents()\n\n    ## å¤çææå·²å°è¾¾çæ¶é´äºä»¶\n    processtimeevents()\n\n\nå° aeprocessevents å½æ°ç½®äºä¸ä¸ªå¾ªç¯éé¢ï¼å ä¸åå§ååæ¸çå½æ°ï¼å°±ææäº redis æå¡å¨çä¸»å½æ°ï¼ä¼ªä»£ç å¦ä¸ï¼\n\ndef main():\n\n    ## åå§åæå¡å¨\n    init_server()\n\n    ## ä¸ç´å¤çäºä»¶ï¼ç´å°æå¡å¨å³é­ä¸ºæ­¢\n    while server_is_not_shutdown():\n        aeprocessevents()\n\n    ## æå¡å¨å³é­ï¼æ§è¡æ¸çæä½\n    clean_server()\n\n\nä»äºä»¶å¤ççè§åº¦æ¥çï¼æå¡å¨è¿è¡æµç¨å¦ä¸ï¼\n\n\n\n\n# å­ãredis äºå¡\n\n> redis æä¾çä¸æ¯ä¸¥æ ¼çäºå¡ï¼redis åªä¿è¯ä¸²è¡æ§è¡å½ä»¤ï¼å¹¶ä¸è½ä¿è¯å¨é¨æ§è¡ï¼ä½æ¯æ§è¡å½ä»¤å¤±è´¥æ¶å¹¶ä¸ä¼åæ»ï¼èæ¯ä¼ç»§ç»­æ§è¡ä¸å»ã\n\nmulti ã exec ã discard å watch æ¯ redis äºå¡ç¸å³çå½ä»¤ã\n\näºå¡å¯ä»¥ä¸æ¬¡æ§è¡å¤ä¸ªå½ä»¤ï¼ å¹¶ä¸æä»¥ä¸ä¸¤ä¸ªéè¦çä¿è¯ï¼\n\n * äºå¡æ¯ä¸ä¸ªåç¬çéç¦»æä½ï¼äºå¡ä¸­çææå½ä»¤é½ä¼åºååãæé¡ºåºå°æ§è¡ãäºå¡å¨æ§è¡çè¿ç¨ä¸­ï¼ä¸ä¼è¢«å¶ä»å®¢æ·ç«¯åéæ¥çå½ä»¤è¯·æ±æææ­ã\n * äºå¡æ¯ä¸ä¸ªåå­æä½ï¼äºå¡ä¸­çå½ä»¤è¦ä¹å¨é¨è¢«æ§è¡ï¼è¦ä¹å¨é¨é½ä¸æ§è¡ã\n\n\n# multi\n\nmulti å½ä»¤ç¨äºå¼å¯ä¸ä¸ªäºå¡ï¼å®æ»æ¯è¿å ok ã\n\nmulti æ§è¡ä¹åï¼ å®¢æ·ç«¯å¯ä»¥ç»§ç»­åæå¡å¨åéä»»æå¤æ¡å½ä»¤ï¼ è¿äºå½ä»¤ä¸ä¼ç«å³è¢«æ§è¡ï¼ èæ¯è¢«æ¾å°ä¸ä¸ªéåä¸­ï¼ å½ exec å½ä»¤è¢«è°ç¨æ¶ï¼ ææéåä¸­çå½ä»¤æä¼è¢«æ§è¡ã\n\nä»¥ä¸æ¯ä¸ä¸ªäºå¡ä¾å­ï¼ å®åå­å°å¢å äº foo å bar ä¸¤ä¸ªé®çå¼ï¼\n\n> multi\nok\n> incr foo\nqueued\n> incr bar\nqueued\n> exec\n1) (integer) 1\n2) (integer) 1\n\n\n\n# exec\n\nexec å½ä»¤è´è´£è§¦åå¹¶æ§è¡äºå¡ä¸­çææå½ä»¤ã\n\n * å¦æå®¢æ·ç«¯å¨ä½¿ç¨ multi å¼å¯äºä¸ä¸ªäºå¡ä¹åï¼å´å ä¸ºæ­çº¿èæ²¡ææåæ§è¡ exec ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¸ä¼è¢«æ§è¡ã\n * å¦ä¸æ¹é¢ï¼å¦æå®¢æ·ç«¯æåå¨å¼å¯äºå¡ä¹åæ§è¡ exec ï¼é£ä¹äºå¡ä¸­çææå½ä»¤é½ä¼è¢«æ§è¡ã\n\n\n# discard\n\nå½æ§è¡ discard å½ä»¤æ¶ï¼ äºå¡ä¼è¢«æ¾å¼ï¼ äºå¡éåä¼è¢«æ¸ç©ºï¼ å¹¶ä¸å®¢æ·ç«¯ä¼ä»äºå¡ç¶æä¸­éåºã\n\nç¤ºä¾ï¼\n\n> set foo 1\nok\n> multi\nok\n> incr foo\nqueued\n> discard\nok\n> get foo\n"1"\n\n\n\n# watch\n\nwatch å½ä»¤å¯ä»¥ä¸º redis äºå¡æä¾ check-and-set ï¼casï¼è¡ä¸ºã\n\nè¢« watch çé®ä¼è¢«çè§ï¼å¹¶ä¼åè§è¿äºé®æ¯å¦è¢«æ¹å¨è¿äºã å¦ææè³å°ä¸ä¸ªè¢«çè§çé®å¨ exec æ§è¡ä¹åè¢«ä¿®æ¹äºï¼ é£ä¹æ´ä¸ªäºå¡é½ä¼è¢«åæ¶ï¼ exec è¿å nil-reply æ¥è¡¨ç¤ºäºå¡å·²ç»å¤±è´¥ã\n\nwatch mykey\nval = get mykey\nval = val + 1\nmulti\nset mykey $val\nexec\n\n\nä½¿ç¨ä¸é¢çä»£ç ï¼ å¦æå¨ watch æ§è¡ä¹åï¼ exec æ§è¡ä¹åï¼ æå¶ä»å®¢æ·ç«¯ä¿®æ¹äº mykey çå¼ï¼ é£ä¹å½åå®¢æ·ç«¯çäºå¡å°±ä¼å¤±è´¥ã ç¨åºéè¦åçï¼ å°±æ¯ä¸æ­éè¯è¿ä¸ªæä½ï¼ ç´å°æ²¡æåçç¢°æä¸ºæ­¢ã\n\nè¿ç§å½¢å¼çéè¢«ç§°ä½ä¹è§éï¼ å®æ¯ä¸ç§éå¸¸å¼ºå¤§çéæºå¶ã å¹¶ä¸å ä¸ºå¤§å¤æ°æåµä¸ï¼ ä¸åçå®¢æ·ç«¯ä¼è®¿é®ä¸åçé®ï¼ ç¢°æçæåµä¸è¬é½å¾å°ï¼ æä»¥éå¸¸å¹¶ä¸éè¦è¿è¡éè¯ã\n\nwatch ä½¿å¾ exec å½ä»¤éè¦ææ¡ä»¶å°æ§è¡ï¼äºå¡åªè½å¨ææè¢«çè§é®é½æ²¡æè¢«ä¿®æ¹çåæä¸æ§è¡ï¼å¦æè¿ä¸ªåæä¸è½æ»¡è¶³çè¯ï¼äºå¡å°±ä¸ä¼è¢«æ§è¡ã\n\nwatch å½ä»¤å¯ä»¥è¢«è°ç¨å¤æ¬¡ãå¯¹é®ççè§ä» watch æ§è¡ä¹åå¼å§çæï¼ç´å°è°ç¨ exec ä¸ºæ­¢ã\n\nç¨æ·è¿å¯ä»¥å¨åä¸ª watch å½ä»¤ä¸­çè§ä»»æå¤ä¸ªé®ï¼ä¾å¦ï¼\n\nredis> watch key1 key2 key3\nok\n\n\n# åæ¶ watch çåºæ¯\n\nå½ exec è¢«è°ç¨æ¶ï¼ ä¸ç®¡äºå¡æ¯å¦æåæ§è¡ï¼ å¯¹ææé®ççè§é½ä¼è¢«åæ¶ã\n\nå¦å¤ï¼ å½å®¢æ·ç«¯æ­å¼è¿æ¥æ¶ï¼ è¯¥å®¢æ·ç«¯å¯¹é®ççè§ä¹ä¼è¢«åæ¶ã\n\nä½¿ç¨æ åæ°ç unwatch å½ä»¤å¯ä»¥æå¨åæ¶å¯¹ææé®ççè§ã å¯¹äºä¸äºéè¦æ¹å¨å¤ä¸ªé®çäºå¡ï¼ ææ¶åç¨åºéè¦åæ¶å¯¹å¤ä¸ªé®è¿è¡å éï¼ ç¶åæ£æ¥è¿äºé®çå½åå¼æ¯å¦ç¬¦åç¨åºçè¦æ±ã å½å¼è¾¾ä¸å°è¦æ±æ¶ï¼ å°±å¯ä»¥ä½¿ç¨ unwatch å½ä»¤æ¥åæ¶ç®åå¯¹é®ççè§ï¼ ä¸­éæ¾å¼è¿ä¸ªäºå¡ï¼ å¹¶ç­å¾äºå¡çä¸æ¬¡å°è¯ã\n\n# ä½¿ç¨ watch åå»ºåå­æä½\n\nwatch å¯ä»¥ç¨äºåå»º redis æ²¡æåç½®çåå­æä½ã\n\nä¸¾ä¸ªä¾å­ï¼ä»¥ä¸ä»£ç å®ç°äºååç zpop å½ä»¤ï¼å®å¯ä»¥åå­å°å¼¹åºæåºéåä¸­åå¼ï¼scoreï¼æå°çåç´ ï¼\n\nwatch zset\nelement = zrange zset 0 0\nmulti\nzrem zset element\nexec\n\n\n\n# rollback\n\nredis ä¸æ¯æåæ»ãredis ä¸æ¯æåæ»ççç±ï¼\n\n * redis å½ä»¤åªä¼å ä¸ºéè¯¯çè¯­æ³èå¤±è´¥ï¼ææ¯å½ä»¤ç¨å¨äºéè¯¯ç±»åçé®ä¸é¢ã\n * å ä¸ºä¸éè¦å¯¹åæ»è¿è¡æ¯æï¼æä»¥ redis çåé¨å¯ä»¥ä¿æç®åä¸å¿«éã\n\n\n# ä¸ãredis ç®¡é\n\nredis æ¯ä¸ç§åºäº c/s æ¨¡åä»¥åè¯·æ±/ååºåè®®ç tcp æå¡ãredis æ¯æç®¡éææ¯ãç®¡éææ¯åè®¸è¯·æ±ä»¥å¼æ­¥æ¹å¼åéï¼å³æ§è¯·æ±çåºç­è¿æªè¿åçæåµä¸ï¼åè®¸åéæ°è¯·æ±ãè¿ç§æ¹å¼å¯ä»¥å¤§å¤§æé«ä¼ è¾æçã\n\nå¨éè¦æ¹éæ§è¡ redis å½ä»¤æ¶ï¼å¦æä¸æ¡ä¸æ¡æ§è¡ï¼æ¾ç¶å¾ä½æãä¸ºäºåå°éä¿¡æ¬¡æ°å¹¶éä½å»¶è¿ï¼å¯ä»¥ä½¿ç¨ redis ç®¡éåè½ãredis çç®¡éï¼pipelineï¼åè½æ²¡ææä¾å½ä»¤è¡æ¯æï¼ä½æ¯å¨åç§è¯­è¨çæ¬çå®¢æ·ç«¯ä¸­é½æç¸åºçå®ç°ã\n\nä»¥ jedis ä¸ºä¾ï¼\n\npipeline pipe = conn.pipelined();\npipe.multi();\npipe.hset("login:", token, user);\npipe.zadd("recent:", timestamp, token);\nif (item != null) {\n    pipe.zadd("viewed:" + token, timestamp, item);\n    pipe.zremrangebyrank("viewed:" + token, 0, -26);\n    pipe.zincrby("viewed:", -1, item);\n}\npipe.exec();\n\n\n> ð æ³¨æï¼ä½¿ç¨ç®¡éåéå½ä»¤æ¶ï¼redis server ä¼å°é¨åè¯·æ±æ¾å°ç¼å­éåä¸­ï¼å ç¨åå­ï¼ï¼æ§è¡å®æ¯åä¸æ¬¡æ§åéç»æãå¦æéè¦åéå¤§éçå½ä»¤ï¼ä¼å ç¨å¤§éçåå­ï¼å æ­¤åºè¯¥æç§åçæ°éåæ¹æ¬¡çå¤çã\n\n\n# å«ãredis åå¸ä¸è®¢é\n\nredis æä¾äº 5 ä¸ªåå¸ä¸è®¢éå½ä»¤ï¼\n\nå½ä»¤             æè¿°\nsubscribe      subscribe channel [channel ...]âè®¢éæå®é¢éã\nunsubscribe    unsubscribe [channel [channel ...]]âåæ¶è®¢éæå®é¢éã\npublish        publish channel messageâåéä¿¡æ¯å°æå®çé¢éã\npsubscribe     psubscribe pattern [pattern ...]âè®¢éç¬¦åæå®æ¨¡å¼çé¢éã\npunsubscribe   punsubscribe [pattern [pattern ...]]âåæ¶è®¢éç¬¦åæå®æ¨¡å¼çé¢éã\n\nè®¢éèè®¢éäºé¢éä¹åï¼åå¸èåé¢éåéå­ç¬¦ä¸²æ¶æ¯ä¼è¢«ææè®¢éèæ¥æ¶å°ã\n\næä¸ªå®¢æ·ç«¯ä½¿ç¨ subscribe è®¢éä¸ä¸ªé¢éï¼å¶å®å®¢æ·ç«¯å¯ä»¥ä½¿ç¨ publish åè¿ä¸ªé¢éåéæ¶æ¯ã\n\nåå¸ä¸è®¢éæ¨¡å¼åè§å¯èæ¨¡å¼æä»¥ä¸ä¸åï¼\n\n * è§å¯èæ¨¡å¼ä¸­ï¼è§å¯èåä¸»é¢é½ç¥éå¯¹æ¹çå­å¨ï¼èå¨åå¸ä¸è®¢éæ¨¡å¼ä¸­ï¼åå¸èä¸è®¢éèä¸ç¥éå¯¹æ¹çå­å¨ï¼å®ä»¬ä¹é´éè¿é¢éè¿è¡éä¿¡ã\n * è§å¯èæ¨¡å¼æ¯åæ­¥çï¼å½äºä»¶è§¦åæ¶ï¼ä¸»é¢ä¼å»è°ç¨è§å¯èçæ¹æ³ï¼èåå¸ä¸è®¢éæ¨¡å¼æ¯å¼æ­¥çï¼\n\n----------------------------------------\n\nåå²çº¿ä»¥ä¸ä¸º redis éç¾¤åè½ç¹æ§\n\n\n# ä¹ãredis å¤å¶\n\n> å³ç³»åæ°æ®åºéå¸¸ä¼ä½¿ç¨ä¸ä¸ªä¸»æå¡å¨åå¤ä¸ªä»æå¡å¨åéæ´æ°ï¼å¹¶ä½¿ç¨ä»æå¡å¨æ¥å¤çææè¯»è¯·æ±ï¼redis ä¹éç¨äºåæ ·çæ¹å¼æ¥å®ç°å¤å¶ç¹æ§ã\n\n\n# æ§çå¤å¶\n\nredis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº sync å½ä»¤å®ç°ã\n\nredis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\nè¿ç§æ¹å¼å­å¨ç¼ºé·ï¼ä¸è½é«æå¤çæ­çº¿éè¿åçå¤å¶æåµã\n\n\n# æ°çå¤å¶\n\nredis 2.8 çæ¬ä»¥åçå¤å¶åè½åºäº psync å½ä»¤å®ç°ãpsync å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ã\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ sync å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥æä¸ä¸ªç»æé¨åï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ id\n\n\n# psync å½ä»¤\n\nä»æå¡å¨åè¦å¤å¶çä¸»æå¡å¨åé psync <runid> <offset> å½ä»¤\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ã\n\n\n# å¿è·³æ£æµ\n\nä¸»æå¡å¨éè¿åä»æå¡ä¼ æ­å½ä»¤æ¥æ´æ°ä»æå¡å¨ç¶æï¼ä¿æä¸»ä»æ°æ®ä¸è´ã\n\nä»æå¡å¨éè¿åä¸»æå¡å¨åéå½ä»¤ replconf ack <replication_offset> æ¥è¿è¡å¿è·³æ£æµï¼ä»¥åå½ä»¤ä¸¢å¤±æ£æµã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis å¤å¶\n\n\n# åãredis å¨åµ\n\nsentinelï¼å¨åµï¼å¯ä»¥çå¬ä¸»æå¡å¨ï¼å¹¶å¨ä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨ä»ä»æå¡å¨ä¸­éä¸¾åºæ°çä¸»æå¡å¨ã\n\n> ð¡ æ´è¯¦ç»çç¹æ§ååçè¯´æè¯·åèï¼redis å¨åµ\n\n\n# åä¸ãredis éç¾¤\n\nåçæ¯å°æ°æ®ååä¸ºå¤ä¸ªé¨åçæ¹æ³ï¼å¯ä»¥å°æ°æ®å­å¨å°å¤å°æºå¨éé¢ï¼ä¹å¯ä»¥ä»å¤å°æºå¨éé¢è·åæ°æ®ï¼è¿ç§æ¹æ³å¨è§£å³æäºé®é¢æ¶å¯ä»¥è·å¾çº¿æ§çº§å«çæ§è½æåã\n\nåè®¾æ 4 ä¸ª reids å®ä¾ r0ï¼r1ï¼r2ï¼r3ï¼è¿æå¾å¤è¡¨ç¤ºç¨æ·çé® user:1ï¼user:2ï¼... ç­ç­ï¼æä¸åçæ¹å¼æ¥éæ©ä¸ä¸ªæå®çé®å­å¨å¨åªä¸ªå®ä¾ä¸­ãæç®åçæ¹å¼æ¯èå´åçï¼ä¾å¦ç¨æ· id ä» 0~1000 çå­å¨å°å®ä¾ r0 ä¸­ï¼ç¨æ· id ä» 1001~2000 çå­å¨å°å®ä¾ r1 ä¸­ï¼ç­ç­ãä½æ¯è¿æ ·éè¦ç»´æ¤ä¸å¼ æ å°èå´è¡¨ï¼ç»´æ¤æä½ä»£ä»·å¾é«ãè¿æä¸ç§æ¹å¼æ¯åå¸åçï¼ä½¿ç¨ crc32 åå¸å½æ°å°é®è½¬æ¢ä¸ºä¸ä¸ªæ°å­ï¼åå¯¹å®ä¾æ°éæ±æ¨¡å°±è½ç¥éåºè¯¥å­å¨çå®ä¾ã\n\nä¸»è¦æä¸ç§åçæ¹å¼ï¼\n\n * å®¢æ·ç«¯åçï¼å®¢æ·ç«¯ä½¿ç¨ä¸è´æ§åå¸ç­ç®æ³å³å®é®åºå½åå¸å°åªä¸ªèç¹ã\n * ä»£çåçï¼å°å®¢æ·ç«¯è¯·æ±åéå°ä»£çä¸ï¼ç±ä»£çè½¬åè¯·æ±å°æ­£ç¡®çèç¹ä¸ã\n * æå¡å¨åçï¼redis clusterï¼å®æ¹ç redis éç¾¤è§£å³æ¹æ¡ï¼ã\n\n\n# åäºãredis client\n\nredis ç¤¾åºä¸­æå¤ç§ç¼ç¨è¯­è¨çå®¢æ·ç«¯ï¼å¯ä»¥å¨è¿éæ¥æ¾åéçå®¢æ·ç«¯ï¼redis å®æ¹ç½åçå®¢æ·ç«¯æ¸å\n\nredis å®æ¹æ¨èç java redis clientï¼\n\n * jedis - ææµè¡ç redis java å®¢æ·ç«¯\n * redisson - é¢å¤æä¾äºå¾å¤çåå¸å¼æå¡ç¹æ§ï¼å¦ï¼åå¸å¼éãåå¸å¼ java å¸¸ç¨å¯¹è±¡ï¼bitsetãblockingqueueãcountdownlatch ç­ï¼\n * lettuce - spring boot 2.0 é»è®¤ redis å®¢æ·ç«¯\n\n\n# æ©å±éè¯»\n\n> ð¡ redis å¸¸ç¨äºåå¸å¼ç¼å­ï¼æå³ç¼å­çç¹æ§ååçè¯·åèï¼ç¼å­åºæ¬åç\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis æ°æ®ç±»åååºç¨",frontmatter:{title:"Redis æ°æ®ç±»åååºç¨",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","æ°æ®ç±»å"],permalink:"/pages/5d2de2/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/03.Redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BA%94%E7%94%A8.html",relativePath:"05.KVæ°æ®åº/01.Redis/03.Redisæ°æ®ç±»åååºç¨.md",key:"v-00448410",path:"/pages/5d2de2/",headers:[{level:2,title:"ä¸ãRedis åºæ¬æ°æ®ç±»å",slug:"ä¸ãredis-åºæ¬æ°æ®ç±»å",normalizedTitle:"ä¸ãredis åºæ¬æ°æ®ç±»å",charIndex:113},{level:3,title:"STRING",slug:"string",normalizedTitle:"string",charIndex:157},{level:3,title:"HASH",slug:"hash",normalizedTitle:"hash",charIndex:495},{level:3,title:"LIST",slug:"list",normalizedTitle:"list",charIndex:243},{level:3,title:"SET",slug:"set",normalizedTitle:"set",charIndex:352},{level:3,title:"ZSET",slug:"zset",normalizedTitle:"zset",charIndex:596},{level:3,title:"éç¨å½ä»¤",slug:"éç¨å½ä»¤",normalizedTitle:"éç¨å½ä»¤",charIndex:3993},{level:4,title:"æåº",slug:"æåº",normalizedTitle:"æåº",charIndex:3238},{level:4,title:"é®çè¿ææ¶é´",slug:"é®çè¿ææ¶é´",normalizedTitle:"é®çè¿ææ¶é´",charIndex:4860},{level:2,title:"äºãRedis é«çº§æ°æ®ç±»å",slug:"äºãredis-é«çº§æ°æ®ç±»å",normalizedTitle:"äºãredis é«çº§æ°æ®ç±»å",charIndex:5580},{level:3,title:"BitMap",slug:"bitmap",normalizedTitle:"bitmap",charIndex:5599},{level:4,title:"BitMap å½ä»¤",slug:"bitmap-å½ä»¤",normalizedTitle:"bitmap å½ä»¤",charIndex:5882},{level:4,title:"BitMap ç¤ºä¾",slug:"bitmap-ç¤ºä¾",normalizedTitle:"bitmap ç¤ºä¾",charIndex:6057},{level:4,title:"BitMap åºç¨",slug:"bitmap-åºç¨",normalizedTitle:"bitmap åºç¨",charIndex:6318},{level:3,title:"HyperLogLog",slug:"hyperloglog",normalizedTitle:"hyperloglog",charIndex:6761},{level:4,title:"HyperLogLog å½ä»¤",slug:"hyperloglog-å½ä»¤",normalizedTitle:"hyperloglog å½ä»¤",charIndex:6875},{level:3,title:"GEO",slug:"geo",normalizedTitle:"geo",charIndex:7530},{level:4,title:"GEO å½ä»¤",slug:"geo-å½ä»¤",normalizedTitle:"geo å½ä»¤",charIndex:7580},{level:2,title:"ä¸ãRedis æ°æ®ç±»ååºç¨",slug:"ä¸ãredis-æ°æ®ç±»ååºç¨",normalizedTitle:"ä¸ãredis æ°æ®ç±»ååºç¨",charIndex:7805},{level:3,title:"æ¡ä¾-æåæ¬¢è¿æç« ",slug:"æ¡ä¾-æåæ¬¢è¿æç« ",normalizedTitle:"æ¡ä¾-æåæ¬¢è¿æç« ",charIndex:7824},{level:4,title:"å¯¹æç« è¿è¡æç¥¨",slug:"å¯¹æç« è¿è¡æç¥¨",normalizedTitle:"å¯¹æç« è¿è¡æç¥¨",charIndex:7860},{level:4,title:"åå¸å¹¶è·åæç« ",slug:"åå¸å¹¶è·åæç« ",normalizedTitle:"åå¸å¹¶è·åæç« ",charIndex:9134},{level:4,title:"å¯¹æç« è¿è¡åç»",slug:"å¯¹æç« è¿è¡åç»",normalizedTitle:"å¯¹æç« è¿è¡åç»",charIndex:11015},{level:3,title:"æ¡ä¾-ç®¡çä»¤ç",slug:"æ¡ä¾-ç®¡çä»¤ç",normalizedTitle:"æ¡ä¾-ç®¡çä»¤ç",charIndex:12271},{level:4,title:"æ¥è¯¢ä»¤ç",slug:"æ¥è¯¢ä»¤ç",normalizedTitle:"æ¥è¯¢ä»¤ç",charIndex:12376},{level:4,title:"æ´æ°ä»¤ç",slug:"æ´æ°ä»¤ç",normalizedTitle:"æ´æ°ä»¤ç",charIndex:12519},{level:4,title:"æ¸çä»¤ç",slug:"æ¸çä»¤ç",normalizedTitle:"æ¸çä»¤ç",charIndex:13293},{level:3,title:"æ¡ä¾-è´­ç©è½¦",slug:"æ¡ä¾-è´­ç©è½¦",normalizedTitle:"æ¡ä¾-è´­ç©è½¦",charIndex:14906},{level:4,title:"å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå",slug:"å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå",normalizedTitle:"å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå",charIndex:14968},{level:4,title:"æ¸ç©ºè´­ç©è½¦",slug:"æ¸ç©ºè´­ç©è½¦",normalizedTitle:"æ¸ç©ºè´­ç©è½¦",charIndex:15303},{level:3,title:"æ¡ä¾-é¡µé¢ç¼å­",slug:"æ¡ä¾-é¡µé¢ç¼å­",normalizedTitle:"æ¡ä¾-é¡µé¢ç¼å­",charIndex:16243},{level:3,title:"æ¡ä¾-æ°æ®è¡ç¼å­",slug:"æ¡ä¾-æ°æ®è¡ç¼å­",normalizedTitle:"æ¡ä¾-æ°æ®è¡ç¼å­",charIndex:16981},{level:3,title:"æ¡ä¾-ç½é¡µåæ",slug:"æ¡ä¾-ç½é¡µåæ",normalizedTitle:"æ¡ä¾-ç½é¡µåæ",charIndex:18993},{level:3,title:"æ¡ä¾-è®°å½æ¥å¿",slug:"æ¡ä¾-è®°å½æ¥å¿",normalizedTitle:"æ¡ä¾-è®°å½æ¥å¿",charIndex:20077},{level:3,title:"æ¡ä¾-ç»è®¡æ°æ®",slug:"æ¡ä¾-ç»è®¡æ°æ®",normalizedTitle:"æ¡ä¾-ç»è®¡æ°æ®",charIndex:20450},{level:3,title:"æ¡ä¾-æ¥æ¾ IP æå±å°",slug:"æ¡ä¾-æ¥æ¾-ip-æå±å°",normalizedTitle:"æ¡ä¾-æ¥æ¾ ip æå±å°",charIndex:21534},{level:4,title:"è½½å¥ IP æ°æ®",slug:"è½½å¥-ip-æ°æ®",normalizedTitle:"è½½å¥ ip æ°æ®",charIndex:21583},{level:4,title:"æ¥æ¾ IP æå±åå¸",slug:"æ¥æ¾-ip-æå±åå¸",normalizedTitle:"æ¥æ¾ ip æå±åå¸",charIndex:24645},{level:3,title:"æ¡ä¾-æå¡çåç°ä¸éç½®",slug:"æ¡ä¾-æå¡çåç°ä¸éç½®",normalizedTitle:"æ¡ä¾-æå¡çåç°ä¸éç½®",charIndex:25228},{level:3,title:"æ¡ä¾-èªå¨è¡¥å¨",slug:"æ¡ä¾-èªå¨è¡¥å¨",normalizedTitle:"æ¡ä¾-èªå¨è¡¥å¨",charIndex:25244},{level:3,title:"æ¡ä¾-å¹¿åå®å",slug:"æ¡ä¾-å¹¿åå®å",normalizedTitle:"æ¡ä¾-å¹¿åå®å",charIndex:25594},{level:3,title:"æ¡ä¾-èä½æç´¢",slug:"æ¡ä¾-èä½æç´¢",normalizedTitle:"æ¡ä¾-èä½æç´¢",charIndex:25606},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:27112}],headersStr:"ä¸ãRedis åºæ¬æ°æ®ç±»å STRING HASH LIST SET ZSET éç¨å½ä»¤ æåº é®çè¿ææ¶é´ äºãRedis é«çº§æ°æ®ç±»å BitMap BitMap å½ä»¤ BitMap ç¤ºä¾ BitMap åºç¨ HyperLogLog HyperLogLog å½ä»¤ GEO GEO å½ä»¤ ä¸ãRedis æ°æ®ç±»ååºç¨ æ¡ä¾-æåæ¬¢è¿æç«  å¯¹æç« è¿è¡æç¥¨ åå¸å¹¶è·åæç«  å¯¹æç« è¿è¡åç» æ¡ä¾-ç®¡çä»¤ç æ¥è¯¢ä»¤ç æ´æ°ä»¤ç æ¸çä»¤ç æ¡ä¾-è´­ç©è½¦ å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå æ¸ç©ºè´­ç©è½¦ æ¡ä¾-é¡µé¢ç¼å­ æ¡ä¾-æ°æ®è¡ç¼å­ æ¡ä¾-ç½é¡µåæ æ¡ä¾-è®°å½æ¥å¿ æ¡ä¾-ç»è®¡æ°æ® æ¡ä¾-æ¥æ¾ IP æå±å° è½½å¥ IP æ°æ® æ¥æ¾ IP æå±åå¸ æ¡ä¾-æå¡çåç°ä¸éç½® æ¡ä¾-èªå¨è¡¥å¨ æ¡ä¾-å¹¿åå®å æ¡ä¾-èä½æç´¢ åèèµæ",content:'# Redis æ°æ®ç±»åååºç¨\n\n> Redis æä¾äºå¤ç§æ°æ®ç±»åï¼æ¯ç§æ°æ®ç±»åæä¸°å¯çå½ä»¤æ¯æã\n> \n> ä½¿ç¨ Redis ï¼ä¸ä»è¦äºè§£å¶æ°æ®ç±»åçç¹æ§ï¼è¿éè¦æ ¹æ®ä¸å¡åºæ¯ï¼çµæ´»çãé«æçä½¿ç¨å¶æ°æ®ç±»åæ¥å»ºæ¨¡ã\n\n\n# ä¸ãRedis åºæ¬æ°æ®ç±»å\n\n\n\næ°æ®ç±»å     å¯ä»¥å­å¨çå¼        æä½\nSTRING   å­ç¬¦ä¸²ãæ´æ°æèæµ®ç¹æ°   å¯¹æ´ä¸ªå­ç¬¦ä¸²æèå­ç¬¦ä¸²çå¶ä¸­ä¸é¨åæ§è¡æä½\n                       å¯¹æ´æ°åæµ®ç¹æ°æ§è¡èªå¢æèèªåæä½\nLIST     åè¡¨            ä»ä¸¤ç«¯åå¥æèå¼¹åºåç´ \n                       è¯»ååä¸ªæèå¤ä¸ªåç´ \n                       è¿è¡ä¿®åªï¼åªä¿çä¸ä¸ªèå´åçåç´ \nSET      æ åºéå          æ·»å ãè·åãç§»é¤åä¸ªåç´ \n                       æ£æ¥ä¸ä¸ªåç´ æ¯å¦å­å¨äºéåä¸­\n                       è®¡ç®äº¤éãå¹¶éãå·®é\n                       ä»éåéé¢éæºè·ååç´ \nHASH     åå«é®å¼å¯¹çæ åºæ£åè¡¨   æ·»å ãè·åãç§»é¤åä¸ªé®å¼å¯¹\n                       è·åææé®å¼å¯¹\n                       æ£æ¥æä¸ªé®æ¯å¦å­å¨\nZSET     æåºéå          æ·»å ãè·åãå é¤åç´ \n                       æ ¹æ®åå¼èå´æèæåæ¥è·ååç´ \n                       è®¡ç®ä¸ä¸ªé®çæå\n\n> What Redis data structures look like\n\n\n# STRING\n\n\n**éç¨åºæ¯ï¼ç¼å­ãè®¡æ°å¨ãå±äº« Session**\n\nå½ä»¤ï¼\n\nå½ä»¤     è¡ä¸º\nGET    è·åå­å¨å¨ç»å®é®ä¸­çå¼ã\nSET    è®¾ç½®å­å¨å¨ç»å®é®ä¸­çå¼ã\nDEL    å é¤å­å¨å¨ç»å®é®ä¸­çå¼ï¼è¿ä¸ªå½ä»¤å¯ä»¥ç¨äºææç±»åï¼ã\nINCR   ä¸ºé® key å¨å­çæ°å­å¼å ä¸\nDECR   ä¸ºé® key å¨å­çæ°å­å¼åä¸\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis String ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> set hello world\nOK\n127.0.0.1:6379> get hello\n"world"\n127.0.0.1:6379> del hello\n(integer) 1\n127.0.0.1:6379> get hello\n(nil)\n\n\n\n# HASH\n\n\n**éç¨åºæ¯ï¼å­å¨ç»æåæ°æ®**ï¼å¦ä¸ä¸ªå¯¹è±¡ï¼ç¨æ·ä¿¡æ¯ãäº§åä¿¡æ¯ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤        è¡ä¸º\nHSET      å¨æ£åéé¢å³èèµ·ç»å®çé®å¼å¯¹ã\nHGET      è·åæå®æ£åé®çå¼ã\nHGETALL   è·åæ£ååå«çææé®å¼å¯¹ã\nHDEL      å¦æç»å®é®å­å¨äºæ£åéé¢ï¼é£ä¹ç§»é¤è¿ä¸ªé®ã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis Hash ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key2 value2\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 0\n127.0.0.1:6379> hset hash-key sub-key3 value2\n(integer) 0\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n3) "sub-key2"\n4) "value2"\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 1\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 0\n127.0.0.1:6379> hget hash-key sub-key1\n"value1"\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n\n\n\n# LIST\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨åè¡¨åæ°æ®**ãå¦ï¼ç²ä¸åè¡¨ãåååè¡¨ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤       è¡ä¸º\nLPUSH    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nRPUSH    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nLPOP     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nRPOP     ä»åè¡¨çå³ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nLRANGE   è·ååè¡¨å¨ç»å®èå´ä¸çææå¼ã\nLINDEX   è·ååè¡¨å¨ç»å®ä½ç½®ä¸çåä¸ªåç´ ã\nLREM     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nLTRIM    åªä¿çæå®åºé´åçåç´ ï¼å é¤å¶ä»åç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis List ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> rpush list-key item\n(integer) 1\n127.0.0.1:6379> rpush list-key item2\n(integer) 2\n127.0.0.1:6379> rpush list-key item\n(integer) 3\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item"\n2) "item2"\n3) "item"\n127.0.0.1:6379> lindex list-key 1\n"item2"\n127.0.0.1:6379> lpop list-key\n"item"\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item2"\n2) "item"\n\n\n\n# SET\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨å»éçåè¡¨åæ°æ®**ã\n\nå½ä»¤ï¼\n\nå½ä»¤          è¡ä¸º\nSADD        å°ç»å®åç´ æ·»å å°éåã\nSMEMBERS    è¿åéååå«çææåç´ ã\nSISMEMBER   æ£æ¥ç»å®åç´ æ¯å¦å­å¨äºéåä¸­ã\nSREM        å¦æç»å®çåç´ å­å¨äºéåä¸­ï¼é£ä¹ç§»é¤è¿ä¸ªåç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis Set ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> sadd set-key item\n(integer) 1\n127.0.0.1:6379> sadd set-key item2\n(integer) 1\n127.0.0.1:6379> sadd set-key item3\n(integer) 1\n127.0.0.1:6379> sadd set-key item\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item2"\n3) "item3"\n127.0.0.1:6379> sismember set-key item4\n(integer) 0\n127.0.0.1:6379> sismember set-key item\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item3"\n\n\n\n# ZSET\n\n\n\néç¨åºæ¯ï¼ç±äºå¯ä»¥è®¾ç½® scoreï¼ä¸ä¸éå¤ãéåç¨äºå­å¨åç§æè¡æ°æ®ï¼å¦ï¼æè¯åæåºçæåºååéåãææ¶é´æåºçæåºæç« éåã\n\nå½ä»¤ï¼\n\nå½ä»¤              è¡ä¸º\nZADD            å°ä¸ä¸ªå¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢ã\nZRANGE          æ ¹æ®åç´ å¨æåºæåä¸­æå¤çä½ç½®ï¼ä»æåºéåéé¢è·åå¤ä¸ªåç´ ã\nZRANGEBYSCORE   è·åæåºéåå¨ç»å®åå¼èå´åçææåç´ ã\nZREM            å¦æç»å®æåå­å¨äºæåºéåï¼é£ä¹ç§»é¤è¿ä¸ªæåã\n\n> æ´å¤å½ä»¤è¯·åèï¼Redis ZSet ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> zadd zset-key 728 member1\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 0\n\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member1"\n2) "728"\n3) "member0"\n4) "982"\n\n127.0.0.1:6379> zrangebyscore zset-key 0 800 withscores\n1) "member1"\n2) "728"\n\n127.0.0.1:6379> zrem zset-key member1\n(integer) 1\n127.0.0.1:6379> zrem zset-key member1\n(integer) 0\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member0"\n2) "982"\n\n\n\n# éç¨å½ä»¤\n\n# æåº\n\nRedis ç SORT å½ä»¤å¯ä»¥å¯¹ LISTãSETãZSET è¿è¡æåºã\n\nå½ä»¤     æè¿°\nSORT   SORT source-key [BY pattern] [LIMIT offset count] [GET\n       pattern [GET pattern ...]] [ASC | DESC] [ALPHA] [STORE\n       dest-key]âæ ¹æ®ç»å®éé¡¹ï¼å¯¹è¾å¥ LISTãSETãZSET è¿è¡æåºï¼ç¶åè¿åæå­å¨æåºçç»æã\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> RPUSH \'sort-input\' 23 15 110 7\n(integer) 4\n127.0.0.1:6379[15]> SORT \'sort-input\'\n1) "7"\n2) "15"\n3) "23"\n4) "110"\n127.0.0.1:6379[15]> SORT \'sort-input\' alpha\n1) "110"\n2) "15"\n3) "23"\n4) "7"\n127.0.0.1:6379[15]> HSET \'d-7\' \'field\' 5\n(integer) 1\n127.0.0.1:6379[15]> HSET \'d-15\' \'field\' 1\n(integer) 1\n127.0.0.1:6379[15]> HSET \'d-23\' \'field\' 9\n(integer) 1\n127.0.0.1:6379[15]> HSET \'d-110\' \'field\' 3\n(integer) 1\n127.0.0.1:6379[15]> SORT \'sort-input\' by \'d-*->field\'\n1) "15"\n2) "110"\n3) "7"\n4) "23"\n127.0.0.1:6379[15]> SORT \'sort-input\' by \'d-*->field\' get \'d-*->field\'\n1) "1"\n2) "3"\n3) "5"\n4) "9"\n\n\n# é®çè¿ææ¶é´\n\nRedis ç EXPIRE å½ä»¤å¯ä»¥æå®ä¸ä¸ªé®çè¿ææ¶é´ï¼å½è¾¾å°è¿ææ¶é´åï¼Redis ä¼èªå¨å é¤è¯¥é®ã\n\nå½ä»¤          æè¿°\nPERSIST     PERSIST key-nameâç§»é¤é®çè¿ææ¶é´\nTTL         TTL key-nameâæ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\nEXPIRE      EXPIRE key-name secondsâè®©ç»å®é®å¨æå®çç§æ°ä¹åè¿æ\nEXPIREAT    EXPIREAT key-name timestampâå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç UNIX æ¶é´æ³\nPTTL        PTTL key-nameâæ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ Redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\nPEXPIRE     PEXPIRE key-name millisecondsâè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ Redis\n            2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\nPEXPIREAT   PEXPIREAT key-name timestamp-millisecondsâå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç UNIX\n            æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ Redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> SET key value\nOK\n127.0.0.1:6379[15]> GET key\n"value"\n127.0.0.1:6379[15]> EXPIRE key 2\n(integer) 1\n127.0.0.1:6379[15]> GET key\n(nil)\n\n\n\n# äºãRedis é«çº§æ°æ®ç±»å\n\n\n# BitMap\n\nBitMap å³ä½å¾ãBitMap ä¸æ¯ä¸ä¸ªçå®çæ°æ®ç»æãèæ¯ STRING ç±»åä¸çä¸ç»é¢å bit æä½çéåãç±äº STRING æ¯äºè¿å¶å®å¨ç blobï¼å¹¶ä¸å®ä»¬çæå¤§é¿åº¦æ¯ 512mï¼æä»¥ BitMap è½æå¤§è®¾ç½® $$2^{32}$$ ä¸ªä¸åç bitã\n\nBitmaps çæå¤§ä¼ç¹å°±æ¯å­å¨ä¿¡æ¯æ¶å¯ä»¥èçå¤§éçç©ºé´ãä¾å¦å¨ä¸ä¸ªç³»ç»ä¸­ï¼ä¸åçç¨æ·è¢«ä¸ä¸ªå¢é¿çç¨æ· ID è¡¨ç¤ºã40 äº¿ï¼$$2^{32}$$ = $$410241024*1024$$ â 40 äº¿ï¼ç¨æ·åªéè¦ 512M åå­å°±è½è®°ä½æç§ä¿¡æ¯ï¼ä¾å¦ç¨æ·æ¯å¦ç»å½è¿ã\n\n# BitMap å½ä»¤\n\n * SETBIT - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è®¾ç½®ææ¸é¤æå®åç§»éä¸çä½(bit)ã\n * GETBIT - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è·åæå®åç§»éä¸çä½(bit)ã\n * BITCOUNT - è®¡ç®ç»å®å­ç¬¦ä¸²ä¸­ï¼è¢«è®¾ç½®ä¸º 1 çæ¯ç¹ä½çæ°éã\n * BITPOS\n * BITOP\n * BITFIELD\n\n# BitMap ç¤ºä¾\n\n# å¯¹ä¸å­å¨ç key æèä¸å­å¨ç offset è¿è¡ GETBITï¼ è¿å 0\n\nredis> EXISTS bit\n(integer) 0\n\nredis> GETBIT bit 10086\n(integer) 0\n\n\n# å¯¹å·²å­å¨ç offset è¿è¡ GETBIT\n\nredis> SETBIT bit 10086 1\n(integer) 0\n\nredis> GETBIT bit 10086\n(integer) 1\n\nredis> BITCOUNT bit\n(integer) 1\n\n\n# BitMap åºç¨\n\nBitmap å¯¹äºä¸äºç¹å®ç±»åçè®¡ç®éå¸¸ææãä¾å¦ï¼ä½¿ç¨ bitmap å®ç°ç¨æ·ä¸çº¿æ¬¡æ°ç»è®¡ã\n\nåè®¾ç°å¨æä»¬å¸æè®°å½èªå·±ç½ç«ä¸çç¨æ·çä¸çº¿é¢çï¼æ¯å¦è¯´ï¼è®¡ç®ç¨æ· A ä¸çº¿äºå¤å°å¤©ï¼ç¨æ· B ä¸çº¿äºå¤å°å¤©ï¼è¯¸å¦æ­¤ç±»ï¼ä»¥æ­¤ä½ä¸ºæ°æ®ï¼ä»èå³å®è®©åªäºç¨æ·åå  beta æµè¯ç­æ´»å¨ ââ è¿ä¸ªæ¨¡å¼å¯ä»¥ä½¿ç¨ SETBIT key offset value å [BITCOUNT key start] [end] æ¥å®ç°ã\n\næ¯å¦è¯´ï¼æ¯å½ç¨æ·å¨æä¸å¤©ä¸çº¿çæ¶åï¼æä»¬å°±ä½¿ç¨ SETBIT key offset value ï¼ä»¥ç¨æ·åä½ä¸º keyï¼å°é£å¤©æä»£è¡¨çç½ç«çä¸çº¿æ¥ä½ä¸º offset åæ°ï¼å¹¶å°è¿ä¸ª offset ä¸çä¸ºè®¾ç½®ä¸º 1 ã\n\n> æ´è¯¦ç»çå®ç°å¯ä»¥åèï¼\n> \n> ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n> \n> Fast, easy, realtime metrics using Redis bitmaps\n\n\n# HyperLogLog\n\nHyperLogLog æ¯ç¨äºè®¡ç®å¯ä¸äºç©çæ¦çæ°æ®ç»æï¼ä»ææ¯ä¸è®²ï¼è¿è¢«ç§°ä¸ºä¼°è®¡éåçåºæ°ï¼ãå¦æç»è®¡å¯ä¸é¡¹ï¼é¡¹ç®è¶å¤ï¼éè¦çåå­å°±è¶å¤ãå ä¸ºéè¦è®°ä½è¿å»å·²ç»çè¿çé¡¹ï¼ä»èé¿åå¤æ¬¡ç»è®¡è¿äºé¡¹ã\n\n# HyperLogLog å½ä»¤\n\n * PFADD - å°ä»»ææ°éçåç´ æ·»å å°æå®ç HyperLogLog éé¢ã\n * PFCOUNT - è¿å HyperLogLog åå«çå¯ä¸åç´ çè¿ä¼¼æ°éã\n * PFMERGE - å°å¤ä¸ª HyperLogLog åå¹¶ï¼mergeï¼ä¸ºä¸ä¸ª HyperLogLog ï¼ åå¹¶åç HyperLogLog çåºæ°æ¥è¿äºææè¾å¥ HyperLogLog çå¯è§éåï¼observed setï¼çå¹¶éãåå¹¶å¾åºç HyperLogLog ä¼è¢«å¨å­å¨ destkey é®éé¢ï¼ å¦æè¯¥é®å¹¶ä¸å­å¨ï¼ é£ä¹å½ä»¤å¨æ§è¡ä¹åï¼ ä¼åä¸ºè¯¥é®åå»ºä¸ä¸ªç©ºç HyperLogLog ã\n\nç¤ºä¾ï¼\n\nredis> PFADD  databases  "Redis"  "MongoDB"  "MySQL"\n(integer) 1\n\nredis> PFCOUNT  databases\n(integer) 3\n\nredis> PFADD  databases  "Redis"    # Redis å·²ç»å­å¨ï¼ä¸å¿å¯¹ä¼°è®¡æ°éè¿è¡æ´æ°\n(integer) 0\n\nredis> PFCOUNT  databases    # åç´ ä¼°è®¡æ°éæ²¡æåå\n(integer) 3\n\nredis> PFADD  databases  "PostgreSQL"    # æ·»å ä¸ä¸ªä¸å­å¨çåç´ \n(integer) 1\n\nredis> PFCOUNT  databases    # ä¼°è®¡æ°éå¢ä¸\n4\n\n\n\n# GEO\n\nè¿ä¸ªåè½å¯ä»¥å°ç¨æ·ç»å®çå°çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ä¿¡æ¯å¨å­èµ·æ¥ï¼å¹¶å¯¹è¿äºä¿¡æ¯è¿è¡æä½ã\n\n# GEO å½ä»¤\n\n * GEOADD - å°æå®çå°çç©ºé´ä½ç½®ï¼çº¬åº¦ãç»åº¦ãåç§°ï¼æ·»å å°æå®ç key ä¸­ã\n * GEOPOS - ä» key éè¿åææç»å®ä½ç½®åç´ çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ã\n * GEODIST - è¿åä¸¤ä¸ªç»å®ä½ç½®ä¹é´çè·ç¦»ã\n * GEOHASH - åä¸ä¸ªæå¤ä¸ªä½ç½®åç´ çæ å Geohash å¼ï¼å®å¯ä»¥å¨http://geohash.org/ä½¿ç¨ã\n * GEORADIUS\n * GEORADIUSBYMEMBER\n\n\n# ä¸ãRedis æ°æ®ç±»ååºç¨\n\n\n# æ¡ä¾-æåæ¬¢è¿æç« \n\néåºæåæ¬¢è¿æç« ï¼éè¦æ¯æå¯¹æç« è¿è¡è¯åã\n\n# å¯¹æç« è¿è¡æç¥¨\n\nï¼1ï¼ä½¿ç¨ HASH å­å¨æç« \n\nä½¿ç¨ HASH ç±»åå­å¨æç« ä¿¡æ¯ãå¶ä¸­ï¼key æ¯æç«  IDï¼field æ¯æç« çå±æ§ keyï¼value æ¯å±æ§å¯¹åºå¼ã\n\n\n\næä½ï¼\n\n * å­å¨æç« ä¿¡æ¯ - ä½¿ç¨ HSET æ HMGET å½ä»¤\n * æ¥è¯¢æç« ä¿¡æ¯ - ä½¿ç¨ HGETALL å½ä»¤\n * æ·»å æç¥¨ - ä½¿ç¨ HINCRBY å½ä»¤\n\nï¼2ï¼ä½¿ç¨ ZSET éå¯¹ä¸åç»´åº¦éåæåº\n\nä½¿ç¨ ZSET ç±»ååå«å­å¨æç§æ¶é´æåºåæç§è¯åæåºçæç«  ID éåã\n\n\n\næä½ï¼\n\n * æ·»å è®°å½ - ä½¿ç¨ ZADD å½ä»¤\n * æ·»å åæ° - ä½¿ç¨ ZINCRBY å½ä»¤\n * ååºå¤ç¯æç«  - ä½¿ç¨ ZREVRANGE å½ä»¤\n\nï¼3ï¼ä¸ºäºé²æ­¢éå¤æç¥¨ï¼ä½¿ç¨ SET ç±»åè®°å½æ¯ç¯æç«  ID å¯¹åºçæç¥¨éåã\n\n\n\næä½ï¼\n\n * æ·»å æç¥¨è - ä½¿ç¨ SADD å½ä»¤\n * è®¾ç½®æææ - ä½¿ç¨ EXPIRE å½ä»¤\n\nï¼4ï¼åè®¾ user:115423 ç» article:100408 æç¥¨ï¼åå«éè¦é«æ´æ°è¯åæåºéåä»¥åæç¥¨éåã\n\n\n\nå½éè¦å¯¹ä¸ç¯æç« æç¥¨æ¶ï¼ç¨åºéè¦ç¨ ZSCORE å½ä»¤æ£æ¥è®°å½æç« åå¸æ¶é´çæåºéåï¼å¤æ­æç« çåå¸æ¶é´æ¯å¦è¶è¿æç¥¨æææï¼æ¯å¦ï¼ä¸ææï¼ã\n\n    public void articleVote(Jedis conn, String user, String article) {\n        // è®¡ç®æç« çæç¥¨æªæ­¢æ¶é´ã\n        long cutoff = (System.currentTimeMillis() / 1000) - ONE_WEEK_IN_SECONDS;\n\n        // æ£æ¥æ¯å¦è¿å¯ä»¥å¯¹æç« è¿è¡æç¥¨\n        // ï¼è½ç¶ä½¿ç¨æ£åä¹å¯ä»¥è·åæç« çåå¸æ¶é´ï¼\n        // ä½æåºéåè¿åçæç« åå¸æ¶é´ä¸ºæµ®ç¹æ°ï¼\n        // å¯ä»¥ä¸è¿è¡è½¬æ¢ç´æ¥ä½¿ç¨ï¼ã\n        if (conn.zscore("time:", article) < cutoff) {\n            return;\n        }\n\n        // ä»article:idæ è¯ç¬¦ï¼identifierï¼éé¢ååºæç« çIDã\n        String articleId = article.substring(article.indexOf(\':\') + 1);\n\n        // å¦æç¨æ·æ¯ç¬¬ä¸æ¬¡ä¸ºè¿ç¯æç« æç¥¨ï¼é£ä¹å¢å è¿ç¯æç« çæç¥¨æ°éåè¯åã\n        if (conn.sadd("voted:" + articleId, user) == 1) {\n            conn.zincrby("score:", VOTE_SCORE, article);\n            conn.hincrBy(article, "votes", 1);\n        }\n    }\n\n\n# åå¸å¹¶è·åæç« \n\nåå¸æç« ï¼\n\n * æ·»å æç«  - ä½¿ç¨ INCR å½ä»¤è®¡ç®æ°çæç«  IDï¼å¡«åæç« ä¿¡æ¯ï¼ç¶åç¨ HSET å½ä»¤æ HMSET å½ä»¤åå¥å° HASH ç»æä¸­ã\n * å°æç« ä½è ID æ·»å å°æç¥¨åå - ä½¿ç¨ SADD å½ä»¤æ·»å å°ä»£è¡¨æç¥¨ååç SET ç»æä¸­ã\n * è®¾ç½®æç¥¨æææ - ä½¿ç¨ EXPIRE å½ä»¤è®¾ç½®æç¥¨æææã\n\n    public String postArticle(Jedis conn, String user, String title, String link) {\n        // çæä¸ä¸ªæ°çæç« IDã\n        String articleId = String.valueOf(conn.incr("article:"));\n\n        String voted = "voted:" + articleId;\n        // å°åå¸æç« çç¨æ·æ·»å å°æç« çå·²æç¥¨ç¨æ·ååéé¢ï¼\n        conn.sadd(voted, user);\n        // ç¶åå°è¿ä¸ªååçè¿ææ¶é´è®¾ç½®ä¸ºä¸å¨ï¼ç¬¬3ç« å°å¯¹è¿ææ¶é´ä½æ´è¯¦ç»çä»ç»ï¼ã\n        conn.expire(voted, ONE_WEEK_IN_SECONDS);\n\n        long now = System.currentTimeMillis() / 1000;\n        String article = "article:" + articleId;\n        // å°æç« ä¿¡æ¯å­å¨å°ä¸ä¸ªæ£åéé¢ã\n        HashMap<String, String> articleData = new HashMap<String, String>();\n        articleData.put("title", title);\n        articleData.put("link", link);\n        articleData.put("user", user);\n        articleData.put("now", String.valueOf(now));\n        articleData.put("votes", "1");\n        conn.hmset(article, articleData);\n\n        // å°æç« æ·»å å°æ ¹æ®åå¸æ¶é´æåºçæåºéååæ ¹æ®è¯åæåºçæåºéåéé¢ã\n        conn.zadd("score:", now + VOTE_SCORE, article);\n        conn.zadd("time:", now, article);\n\n        return articleId;\n    }\n\n\nåé¡µæ¥è¯¢æåæ¬¢è¿æç« ï¼\n\nä½¿ç¨ ZINTERSTORE å½ä»¤æ ¹æ®é¡µç ãæ¯é¡µè®°å½æ°ãæåºå·ï¼æ ¹æ®è¯åå¼ä»å¤§å°å°åé¡µæ¥åºæç«  ID åè¡¨ã\n\n    public List<Map<String, String>> getArticles(Jedis conn, int page, String order) {\n        // è®¾ç½®è·åæç« çèµ·å§ç´¢å¼åç»æç´¢å¼ã\n        int start = (page - 1) * ARTICLES_PER_PAGE;\n        int end = start + ARTICLES_PER_PAGE - 1;\n\n        // è·åå¤ä¸ªæç« IDã\n        Set<String> ids = conn.zrevrange(order, start, end);\n        List<Map<String, String>> articles = new ArrayList<>();\n        // æ ¹æ®æç« IDè·åæç« çè¯¦ç»ä¿¡æ¯ã\n        for (String id : ids) {\n            Map<String, String> articleData = conn.hgetAll(id);\n            articleData.put("id", id);\n            articles.add(articleData);\n        }\n\n        return articles;\n    }\n\n\n# å¯¹æç« è¿è¡åç»\n\nå¦ææç« éè¦åç»ï¼åè½éè¦åä¸ºä¸¤åï¼\n\n * è®°å½æç« å±äºåªä¸ªç¾¤ç»\n * è´è´£ååºç¾¤ç»éçæç« \n\nå°æç« æ·»å ãå é¤ç¾¤ç»ï¼\n\n    public void addRemoveGroups(Jedis conn, String articleId, String[] toAdd, String[] toRemove) {\n        // æå»ºå­å¨æç« ä¿¡æ¯çé®åã\n        String article = "article:" + articleId;\n        // å°æç« æ·»å å°å®æå±çç¾¤ç»éé¢ã\n        for (String group : toAdd) {\n            conn.sadd("group:" + group, article);\n        }\n        // ä»ç¾¤ç»éé¢ç§»é¤æç« ã\n        for (String group : toRemove) {\n            conn.srem("group:" + group, article);\n        }\n    }\n\n\nååºç¾¤ç»éçæç« ï¼\n\n\n\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« è¯åçæåºéåæ§è¡ ZINTERSTORE å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« è¯åæåºçç¾¤ç»æç« ã\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« åå¸æ¶é´çæåºéåæ§è¡ ZINTERSTORE å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« åå¸æ¶é´æåºçç¾¤ç»æç« ã\n\n    public List<Map<String, String>> getGroupArticles(Jedis conn, String group, int page, String order) {\n        // ä¸ºæ¯ä¸ªç¾¤ç»çæ¯ç§æåé¡ºåºé½åå»ºä¸ä¸ªé®ã\n        String key = order + group;\n        // æ£æ¥æ¯å¦æå·²ç¼å­çæåºç»æï¼å¦ææ²¡æçè¯å°±ç°å¨è¿è¡æåºã\n        if (!conn.exists(key)) {\n            // æ ¹æ®è¯åæèåå¸æ¶é´ï¼å¯¹ç¾¤ç»æç« è¿è¡æåºã\n            ZParams params = new ZParams().aggregate(ZParams.Aggregate.MAX);\n            conn.zinterstore(key, params, "group:" + group, order);\n            // è®©Rediså¨60ç§éä¹åèªå¨å é¤è¿ä¸ªæåºéåã\n            conn.expire(key, 60);\n        }\n        // è°ç¨ä¹åå®ä¹çgetArticleså½æ°æ¥è¿è¡åé¡µå¹¶è·åæç« æ°æ®ã\n        return getArticles(conn, page, key);\n    }\n\n\n\n# æ¡ä¾-ç®¡çä»¤ç\n\nç½ç«ä¸è¬ä¼ä»¥ CookieãSessionãä»¤çè¿ç±»ä¿¡æ¯å­å¨ç¨æ·èº«ä»½ä¿¡æ¯ã\n\nå¯ä»¥å° Cookie/Session/ä»¤ç åç¨æ·çæ å°å³ç³»å­å¨å¨ HASH ç»æã\n\nä¸é¢ä»¥ä»¤çæ¥ä¸¾ä¾ã\n\n# æ¥è¯¢ä»¤ç\n\n    public String checkToken(Jedis conn, String token) {\n        // å°è¯è·åå¹¶è¿åä»¤çå¯¹åºçç¨æ·ã\n        return conn.hget("login:", token);\n    }\n\n\n# æ´æ°ä»¤ç\n\n * ç¨æ·æ¯æ¬¡è®¿é®é¡µé¢ï¼å¯ä»¥è®°å½ä¸ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª ZSET ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æ¯å¦æ´»è·ï¼ç»§èå¯ä»¥å¨ææ§æ¸çæèçä»¤çï¼ç»è®¡å½åå¨çº¿ç¨æ·æ°ç­è¡ä¸ºã\n * ç¨æ·å¦ææ­£å¨æµè§ååï¼å¯ä»¥è®°å½å°ç¨æ·æè¿æµè§è¿çååæåºéåä¸­ï¼éåå¯ä»¥éå®æ°éï¼è¶è¿æ°éè¿è¡è£åªï¼ï¼å­å¥å°ä¸ä¸ª ZSET ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æè¿å¯è½æå´è¶£çååï¼ä»¥ä¾¿æ¨èååã\n\n    public void updateToken(Jedis conn, String token, String user, String item) {\n        // è·åå½åæ¶é´æ³ã\n        long timestamp = System.currentTimeMillis() / 1000;\n        // ç»´æä»¤çä¸å·²ç»å½ç¨æ·ä¹é´çæ å°ã\n        conn.hset("login:", token, user);\n        // è®°å½ä»¤çæåä¸æ¬¡åºç°çæ¶é´ã\n        conn.zadd("recent:", timestamp, token);\n        if (item != null) {\n            // è®°å½ç¨æ·æµè§è¿çååã\n            conn.zadd("viewed:" + token, timestamp, item);\n            // ç§»é¤æ§çè®°å½ï¼åªä¿çç¨æ·æè¿æµè§è¿ç25ä¸ªååã\n            conn.zremrangeByRank("viewed:" + token, 0, -26);\n            conn.zincrby("viewed:", -1, item);\n        }\n    }\n\n\n# æ¸çä»¤ç\n\nä¸ä¸èæå°ï¼æ´æ°ä»¤çæ¶ï¼å°ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª ZSET ç»æä¸­ãæä»¥å¯ä»¥éè¿æåºå¾ç¥åªäºä»¤çæèãå¦ææ²¡ææ¸çæä½ï¼æ´æ°ä»¤çå ç¨çåå­ä¼ä¸æ­è¨èï¼ç´å°å¯¼è´æºå¨å®æºã\n\næ¯å¦ï¼æå¤åè®¸å­å¨ 1000 ä¸æ¡ä»¤çä¿¡æ¯ï¼å¨ææ§æ£æ¥ï¼ä¸æ¦åç°è®°å½æ°è¶åº 1000 ä¸æ¡ï¼å° ZSET ä»æ°å°èæåºï¼å°è¶åº 1000 ä¸æ¡çè®°å½æ¸é¤ã\n\npublic static class CleanSessionsThread extends Thread {\n\n    private Jedis conn;\n\n    private int limit;\n\n    private volatile boolean quit;\n\n    public CleanSessionsThread(int limit) {\n        this.conn = new Jedis("localhost");\n        this.conn.select(15);\n        this.limit = limit;\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @Override\n    public void run() {\n        while (!quit) {\n            // æ¾åºç®åå·²æä»¤ççæ°éã\n            long size = conn.zcard("recent:");\n            // ä»¤çæ°éæªè¶è¿éå¶ï¼ä¼ç å¹¶å¨ä¹åéæ°æ£æ¥ã\n            if (size <= limit) {\n                try {\n                    sleep(1000);\n                } catch (InterruptedException ie) {\n                    Thread.currentThread().interrupt();\n                }\n                continue;\n            }\n\n            // è·åéè¦ç§»é¤çä»¤çIDã\n            long endIndex = Math.min(size - limit, 100);\n            Set<String> tokenSet = conn.zrange("recent:", 0, endIndex - 1);\n            String[] tokens = tokenSet.toArray(new String[tokenSet.size()]);\n\n            // ä¸ºé£äºå°è¦è¢«å é¤çä»¤çæå»ºé®åã\n            ArrayList<String> sessionKeys = new ArrayList<String>();\n            for (String token : tokens) {\n                sessionKeys.add("viewed:" + token);\n            }\n\n            // ç§»é¤ææ§çé£äºä»¤çã\n            conn.del(sessionKeys.toArray(new String[sessionKeys.size()]));\n            conn.hdel("login:", tokens);\n            conn.zrem("recent:", tokens);\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-è´­ç©è½¦\n\nå¯ä»¥ä½¿ç¨ HASH ç»ææ¥å®ç°è´­ç©è½¦åè½ã\n\næ¯ä¸ªç¨æ·çè´­ç©è½¦ï¼å­å¨äºåå ID åååæ°éçæ å°ã\n\n# å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå\n\n    public void addToCart(Jedis conn, String session, String item, int count) {\n        if (count <= 0) {\n            // ä»è´­ç©è½¦éé¢ç§»é¤æå®çååã\n            conn.hdel("cart:" + session, item);\n        } else {\n            // å°æå®çååæ·»å å°è´­ç©è½¦ã\n            conn.hset("cart:" + session, item, String.valueOf(count));\n        }\n    }\n\n\n# æ¸ç©ºè´­ç©è½¦\n\nå¨ æ¸çä»¤ç çåºç¡ä¸ï¼æ¸ç©ºä¼è¯æ¶ï¼é¡ºä¾¿å°è´­ç©è½¦ç¼å­ä¸å¹¶æ¸çã\n\n   while (!quit) {\n        long size = conn.zcard("recent:");\n        if (size <= limit) {\n            try {\n                sleep(1000);\n            } catch (InterruptedException ie) {\n                Thread.currentThread().interrupt();\n            }\n            continue;\n        }\n\n        long endIndex = Math.min(size - limit, 100);\n        Set<String> sessionSet = conn.zrange("recent:", 0, endIndex - 1);\n        String[] sessions = sessionSet.toArray(new String[sessionSet.size()]);\n\n        ArrayList<String> sessionKeys = new ArrayList<String>();\n        for (String sess : sessions) {\n            sessionKeys.add("viewed:" + sess);\n            // æ°å¢å çè¿è¡ä»£ç ç¨äºå é¤æ§ä¼è¯å¯¹åºç¨æ·çè´­ç©è½¦ã\n            sessionKeys.add("cart:" + sess);\n        }\n\n        conn.del(sessionKeys.toArray(new String[sessionKeys.size()]));\n        conn.hdel("login:", sessions);\n        conn.zrem("recent:", sessions);\n    }\n\n\n\n# æ¡ä¾-é¡µé¢ç¼å­\n\nå¤§é¨åç½é¡µåå®¹å¹¶ä¸ä¼ç»å¸¸æ¹åï¼ä½æ¯è®¿é®æ¶ï¼åå°éè¦å¨æè®¡ç®ï¼è¿å¯è½èæ¶è¾å¤ï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ STRING ç»æå­å¨é¡µé¢ç¼å­ï¼\n\n    public String cacheRequest(Jedis conn, String request, Callback callback) {\n        // å¯¹äºä¸è½è¢«ç¼å­çè¯·æ±ï¼ç´æ¥è°ç¨åè°å½æ°ã\n        if (!canCache(conn, request)) {\n            return callback != null ? callback.call(request) : null;\n        }\n\n        // å°è¯·æ±è½¬æ¢æä¸ä¸ªç®åçå­ç¬¦ä¸²é®ï¼æ¹ä¾¿ä¹åè¿è¡æ¥æ¾ã\n        String pageKey = "cache:" + hashRequest(request);\n        // å°è¯æ¥æ¾è¢«ç¼å­çé¡µé¢ã\n        String content = conn.get(pageKey);\n\n        if (content == null && callback != null) {\n            // å¦æé¡µé¢è¿æ²¡æè¢«ç¼å­ï¼é£ä¹çæé¡µé¢ã\n            content = callback.call(request);\n            // å°æ°çæçé¡µé¢æ¾å°ç¼å­éé¢ã\n            conn.setex(pageKey, 300, content);\n        }\n\n        // è¿åé¡µé¢ã\n        return content;\n    }\n\n\n\n# æ¡ä¾-æ°æ®è¡ç¼å­\n\nçµåç½ç«å¯è½ä¼æä¿éãç¹åãæ½å¥ç­æ´»å¨ï¼è¿äºæ´»å¨é¡µé¢åªéè¦ä»æ°æ®åºä¸­å è½½å è¡æ°æ®ï¼å¦ï¼ç¨æ·ä¿¡æ¯ãååä¿¡æ¯ã\n\nå¯ä»¥ä½¿ç¨ STRING ç»ææ¥ç¼å­è¿äºæ°æ®ï¼ä½¿ç¨ JSON å­å¨ç»æåçä¿¡æ¯ã\n\næ­¤å¤ï¼éè¦æä¸¤ä¸ª ZSET ç»ææ¥è®°å½æ´æ°ç¼å­çæ¶æºï¼\n\n * ç¬¬ä¸ä¸ªä¸ºè°åº¦æåºéåï¼\n * ç¬¬äºä¸ªä¸ºå»¶æ¶æåºéåã\n\nè®°å½ç¼å­æ¶æºï¼\n\n    public void scheduleRowCache(Jedis conn, String rowId, int delay) {\n        // åè®¾ç½®æ°æ®è¡çå»¶è¿å¼ã\n        conn.zadd("delay:", delay, rowId);\n        // ç«å³ç¼å­æ°æ®è¡ã\n        conn.zadd("schedule:", System.currentTimeMillis() / 1000, rowId);\n    }\n\n\nå®æ¶æ´æ°æ°æ®è¡ç¼å­ï¼\n\npublic class CacheRowsThread extends Thread {\n\n    private Jedis conn;\n\n    private boolean quit;\n\n    public CacheRowsThread() {\n        this.conn = new Jedis("localhost");\n        this.conn.select(15);\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @Override\n    public void run() {\n        Gson gson = new Gson();\n        while (!quit) {\n            // å°è¯è·åä¸ä¸ä¸ªéè¦è¢«ç¼å­çæ°æ®è¡ä»¥åè¯¥è¡çè°åº¦æ¶é´æ³ï¼\n            // å½ä»¤ä¼è¿åä¸ä¸ªåå«é¶ä¸ªæä¸ä¸ªåç»ï¼tupleï¼çåè¡¨ã\n            Set<Tuple> range = conn.zrangeWithScores("schedule:", 0, 0);\n            Tuple next = range.size() > 0 ? range.iterator().next() : null;\n            long now = System.currentTimeMillis() / 1000;\n            if (next == null || next.getScore() > now) {\n                try {\n                    // ææ¶æ²¡æè¡éè¦è¢«ç¼å­ï¼ä¼ç 50æ¯«ç§åéè¯ã\n                    sleep(50);\n                } catch (InterruptedException ie) {\n                    Thread.currentThread().interrupt();\n                }\n                continue;\n            }\n\n            String rowId = next.getElement();\n            // è·åä¸ä¸æ¬¡è°åº¦åçå»¶è¿æ¶é´ã\n            double delay = conn.zscore("delay:", rowId);\n            if (delay <= 0) {\n                // ä¸å¿åç¼å­è¿ä¸ªè¡ï¼å°å®ä»ç¼å­ä¸­ç§»é¤ã\n                conn.zrem("delay:", rowId);\n                conn.zrem("schedule:", rowId);\n                conn.del("inv:" + rowId);\n                continue;\n            }\n\n            // è¯»åæ°æ®è¡ã\n            Inventory row = Inventory.get(rowId);\n            // æ´æ°è°åº¦æ¶é´å¹¶è®¾ç½®ç¼å­å¼ã\n            conn.zadd("schedule:", now + delay, rowId);\n            conn.set("inv:" + rowId, gson.toJson(row));\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-ç½é¡µåæ\n\nç½ç«å¯ä»¥ééç¨æ·çè®¿é®ãäº¤äºãè´­ä¹°è¡ä¸ºï¼ååæç¨æ·ä¹ æ¯ãåå¥½ï¼ä»èå¤æ­å¸åºè¡æåæ½å¨åæºç­ã\n\né£ä¹ï¼ç®åçï¼å¦ä½è®°å½ç¨æ·å¨ä¸å®æ¶é´åè®¿é®çååé¡µé¢å¢ï¼\n\nåè æ´æ°ä»¤ç ä»£ç ç¤ºä¾ï¼è®°å½ç¨æ·è®¿é®ä¸åååçæµè§æ¬¡æ°ï¼å¹¶æåºã\n\nå¤æ­é¡µé¢æ¯å¦éè¦ç¼å­ï¼æ ¹æ®è¯åå¤æ­ååé¡µé¢æ¯å¦ç­é¨ï¼\n\n    public boolean canCache(Jedis conn, String request) {\n        try {\n            URL url = new URL(request);\n            HashMap<String, String> params = new HashMap<>();\n            if (url.getQuery() != null) {\n                for (String param : url.getQuery().split("&")) {\n                    String[] pair = param.split("=", 2);\n                    params.put(pair[0], pair.length == 2 ? pair[1] : null);\n                }\n            }\n\n            // å°è¯ä»é¡µé¢éé¢ååºååIDã\n            String itemId = extractItemId(params);\n            // æ£æ¥è¿ä¸ªé¡µé¢è½å¦è¢«ç¼å­ä»¥åè¿ä¸ªé¡µé¢æ¯å¦ä¸ºååé¡µé¢ã\n            if (itemId == null || isDynamic(params)) {\n                return false;\n            }\n            // åå¾ååçæµè§æ¬¡æ°æåã\n            Long rank = conn.zrank("viewed:", itemId);\n            // æ ¹æ®ååçæµè§æ¬¡æ°æåæ¥å¤æ­æ¯å¦éè¦ç¼å­è¿ä¸ªé¡µé¢ã\n            return rank != null && rank < 10000;\n        } catch (MalformedURLException mue) {\n            return false;\n        }\n    }\n\n\n\n# æ¡ä¾-è®°å½æ¥å¿\n\nå¯ç¨ä½¿ç¨ LIST ç»æå­å¨æ¥å¿æ°æ®ã\n\n    public void logRecent(Jedis conn, String name, String message, String severity) {\n        String destination = "recent:" + name + \':\' + severity;\n        Pipeline pipe = conn.pipelined();\n        pipe.lpush(destination, TIMESTAMP.format(new Date()) + \' \' + message);\n        pipe.ltrim(destination, 0, 99);\n        pipe.sync();\n    }\n\n\n\n# æ¡ä¾-ç»è®¡æ°æ®\n\næ´æ°è®¡æ°å¨ï¼\n\n    public static final int[] PRECISION = new int[] { 1, 5, 60, 300, 3600, 18000, 86400 };\n\n    public void updateCounter(Jedis conn, String name, int count, long now) {\n        Transaction trans = conn.multi();\n        for (int prec : PRECISION) {\n            long pnow = (now / prec) * prec;\n            String hash = String.valueOf(prec) + \':\' + name;\n            trans.zadd("known:", 0, hash);\n            trans.hincrBy("count:" + hash, String.valueOf(pnow), count);\n        }\n        trans.exec();\n    }\n\n\næ¥çè®¡æ°å¨æ°æ®ï¼\n\n    public List<Pair<Integer>> getCounter(\n        Jedis conn, String name, int precision) {\n        String hash = String.valueOf(precision) + \':\' + name;\n        Map<String, String> data = conn.hgetAll("count:" + hash);\n        List<Pair<Integer>> results = new ArrayList<>();\n        for (Map.Entry<String, String> entry : data.entrySet()) {\n            results.add(new Pair<>(\n                entry.getKey(),\n                Integer.parseInt(entry.getValue())));\n        }\n        Collections.sort(results);\n        return results;\n    }\n\n\n\n# æ¡ä¾-æ¥æ¾ IP æå±å°\n\nRedis å®ç°ç IP æå±å°æ¥æ¾æ¯å³ç³»åæ°æ®å®ç°æ¹å¼æ´å¿«ã\n\n# è½½å¥ IP æ°æ®\n\nIP å°åè½¬ä¸ºæ´æ°å¼ï¼\n\n    public int ipToScore(String ipAddress) {\n        int score = 0;\n        for (String v : ipAddress.split("\\\\.")) {\n            score = score * 256 + Integer.parseInt(v, 10);\n        }\n        return score;\n    }\n\n\nåå»º IP å°åä¸åå¸ ID ä¹é´çæ å°ï¼\n\n    public void importIpsToRedis(Jedis conn, File file) {\n        FileReader reader = null;\n        try {\n            // è½½å¥ csv æä»¶æ°æ®\n            reader = new FileReader(file);\n            CSVFormat csvFormat = CSVFormat.DEFAULT.withRecordSeparator("\\n");\n            CSVParser csvParser = csvFormat.parse(reader);\n            int count = 0;\n            List<CSVRecord> records = csvParser.getRecords();\n            for (CSVRecord line : records) {\n                String startIp = line.get(0);\n                if (startIp.toLowerCase().indexOf(\'i\') != -1) {\n                    continue;\n                }\n                // å° IP å°åè½¬ä¸ºæ´æ°å¼\n                int score = 0;\n                if (startIp.indexOf(\'.\') != -1) {\n                    score = ipToScore(startIp);\n                } else {\n                    try {\n                        score = Integer.parseInt(startIp, 10);\n                    } catch (NumberFormatException nfe) {\n                        // ç¥è¿æä»¶çç¬¬ä¸è¡ä»¥åæ ¼å¼ä¸æ­£ç¡®çæ¡ç®\n                        continue;\n                    }\n                }\n\n                // æå»ºå¯ä¸çåå¸ ID\n                String cityId = line.get(2) + \'_\' + count;\n                // å°åå¸ ID åå¶å¯¹åºç IP å°åæ´æ°å¼æ·»å å° ZSET\n                conn.zadd("ip2cityid:", score, cityId);\n                count++;\n            }\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (Exception e) {\n                // ignore\n            }\n        }\n    }\n\n\nå­å¨åå¸ä¿¡æ¯ï¼\n\n    public void importCitiesToRedis(Jedis conn, File file) {\n        Gson gson = new Gson();\n        FileReader reader = null;\n        try {\n            // å è½½ csv ä¿¡æ¯\n            reader = new FileReader(file);\n            CSVFormat csvFormat = CSVFormat.DEFAULT.withRecordSeparator("\\n");\n            CSVParser parser = new CSVParser(reader, csvFormat);\n            // String[] line;\n            List<CSVRecord> records = parser.getRecords();\n            for (CSVRecord record : records) {\n\n                if (record.size() < 4 || !Character.isDigit(record.get(0).charAt(0))) {\n                    continue;\n                }\n\n                // å°åå¸å°çä¿¡æ¯è½¬ä¸º json ç»æï¼å­å¥ HASH ç»æä¸­\n                String cityId = record.get(0);\n                String country = record.get(1);\n                String region = record.get(2);\n                String city = record.get(3);\n                String json = gson.toJson(new String[] { city, region, country });\n                conn.hset("cityid2city:", cityId, json);\n            }\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (Exception e) {\n                // ignore\n            }\n        }\n    }\n\n\n# æ¥æ¾ IP æå±åå¸\n\næä½æ­¥éª¤ï¼\n\n 1. å°è¦æ¥æ¾ç IP å°åè½¬ä¸ºæ´æ°å¼ï¼\n 2. æ¥æ¾ææåå¼å°äºç­äºè¦æ¥æ¾ç IP å°åçå°åï¼ååºå¶ä¸­æå¤§åå¼çé£ä¸ªè®°å½ï¼\n 3. ç¨æ¾å°çè®°å½æå¯¹åºçåå¸ ID å»æ£ç´¢åå¸ä¿¡æ¯ã\n\n    public String[] findCityByIp(Jedis conn, String ipAddress) {\n        int score = ipToScore(ipAddress);\n        Set<String> results = conn.zrevrangeByScore("ip2cityid:", score, 0, 0, 1);\n        if (results.size() == 0) {\n            return null;\n        }\n\n        String cityId = results.iterator().next();\n        cityId = cityId.substring(0, cityId.indexOf(\'_\'));\n        return new Gson().fromJson(conn.hget("cityid2city:", cityId), String[].class);\n    }\n\n\n\n# æ¡ä¾-æå¡çåç°ä¸éç½®\n\n\n# æ¡ä¾-èªå¨è¡¥å¨\n\néæ±ï¼æ ¹æ®ç¨æ·è¾å¥ï¼èªå¨è¡¥å¨ä¿¡æ¯ï¼å¦ï¼èç³»äººãåååç­ã\n\n * å¸ååºæ¯ä¸ï¼ç¤¾äº¤ç½ç«åå°è®°å½ç¨æ·æè¿èç³»è¿ç 100 ä¸ªå¥½åï¼å½ç¨æ·æ¥æ¾å¥½åæ¶ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨å§åã\n * å¸ååºæ¯äºï¼çµåç½ç«åå°è®°å½ç¨æ·æè¿æµè§è¿ç 10 ä»¶ååï¼å½ç¨æ·æ¥æ¾ååæ¯ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨åååç§°ã\n\næ°æ®æ¨¡åï¼ä½¿ç¨ Redis ç LIST ç±»åå­å¨æè¿èç³»äººåè¡¨ã\n\næå»ºèªå¨è¡¥å¨åè¡¨éå¸¸æä»¥ä¸æä½ï¼\n\n * å¦ææå®èç³»äººå·²ç»å­å¨äºæè¿èç³»äººåè¡¨éï¼é£ä¹ä»åè¡¨éç§»é¤ä»ãå¯¹åº LREM å½ä»¤ã\n * å°æå®èç³»äººæ·»å å°æè¿èç³»äººåè¡¨çæåé¢ãå¯¹åº LPUSH å½ä»¤ã\n * æ·»å æä½å®æåï¼å¦æèç³»äººåè¡¨ä¸­çæ°éè¶è¿ 100 ä¸ªï¼è¿è¡è£åªæä½ãå¯¹åº LTRIM å½ä»¤ã\n\n\n# æ¡ä¾-å¹¿åå®å\n\n\n# æ¡ä¾-èä½æç´¢\n\néæ±ï¼å¨ä¸ä¸ªæèç½ç«ä¸ï¼æ±èèæèªå·±çæè½æ¸åï¼ç¨äººå¬å¸çèä½æå¿è¦çæè½æ¸åãç¨äººå¬å¸éè¦æ¥è¯¢æ»¡è¶³èªå·±èä½è¦æ±çæ±èèï¼æ±èèéè¦æ¥è¯¢èªå·±å¯ä»¥æéç®åçèä½ã\n\nå³é®æ°æ®æ¨¡åï¼ä½¿ç¨ SET ç±»åå­å¨æ±èèçæè½åè¡¨ï¼ä½¿ç¨ SET ç±»åå­å¨èä½çæè½åè¡¨ã\n\nå³é®æä½ï¼ä½¿ç¨ SDIFF å½ä»¤å¯¹æ¯ä¸¤ä¸ª SET çå·®å¼ï¼è¿å empty è¡¨ç¤ºå¹éè¦æ±ã\n\nredis cli ç¤ºä¾ï¼\n\n# -----------------------------------------------------------\n# Redis èä½æç´¢æ°æ®æ¨¡åç¤ºä¾\n# -----------------------------------------------------------\n\n# ï¼1ï¼èä½æè½è¡¨ï¼ä½¿ç¨ set å­å¨\n# job:001 èä½æ·»å  4 ç§æè½\nSADD job:001 skill:001\nSADD job:001 skill:002\nSADD job:001 skill:003\nSADD job:001 skill:004\n\n# job:002 èä½æ·»å  3 ç§æè½\nSADD job:002 skill:001\nSADD job:002 skill:002\nSADD job:002 skill:003\n\n# job:003 èä½æ·»å  2 ç§æè½\nSADD job:003 skill:001\nSADD job:003 skill:003\n\n# æ¥ç\nSMEMBERS job:001\nSMEMBERS job:002\nSMEMBERS job:003\n\n# ï¼2ï¼æ±èèæè½è¡¨ï¼ä½¿ç¨ set å­å¨\nSADD interviewee:001 skill:001\nSADD interviewee:001 skill:003\n\nSADD interviewee:002 skill:001\nSADD interviewee:002 skill:002\nSADD interviewee:002 skill:003\nSADD interviewee:002 skill:004\nSADD interviewee:002 skill:005\n\n# æ¥ç\nSMEMBERS interviewee:001\nSMEMBERS interviewee:002\n\n# ï¼3ï¼æ±èèéåæ¥æ¾èªå·±ç¬¦åè¦æ±çèä½ï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nSDIFF job:001 interviewee:001\nSDIFF job:002 interviewee:001\nSDIFF job:003 interviewee:001\n\nSDIFF job:001 interviewee:002\nSDIFF job:002 interviewee:002\nSDIFF job:003 interviewee:002\n\n# ï¼4ï¼ç¨äººå¬å¸æ ¹æ®éåæ¥æ¾ç¬¦åèªå·±èä½è¦æ±çæ±èèï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nSDIFF interviewee:001 job:001\nSDIFF interviewee:002 job:001\n\nSDIFF interviewee:001 job:002\nSDIFF interviewee:002 job:002\n\nSDIFF interviewee:001 job:003\nSDIFF interviewee:002 job:003\n\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n   * Fast, easy, realtime metrics using Redis bitmaps',normalizedContent:'# redis æ°æ®ç±»åååºç¨\n\n> redis æä¾äºå¤ç§æ°æ®ç±»åï¼æ¯ç§æ°æ®ç±»åæä¸°å¯çå½ä»¤æ¯æã\n> \n> ä½¿ç¨ redis ï¼ä¸ä»è¦äºè§£å¶æ°æ®ç±»åçç¹æ§ï¼è¿éè¦æ ¹æ®ä¸å¡åºæ¯ï¼çµæ´»çãé«æçä½¿ç¨å¶æ°æ®ç±»åæ¥å»ºæ¨¡ã\n\n\n# ä¸ãredis åºæ¬æ°æ®ç±»å\n\n\n\næ°æ®ç±»å     å¯ä»¥å­å¨çå¼        æä½\nstring   å­ç¬¦ä¸²ãæ´æ°æèæµ®ç¹æ°   å¯¹æ´ä¸ªå­ç¬¦ä¸²æèå­ç¬¦ä¸²çå¶ä¸­ä¸é¨åæ§è¡æä½\n                       å¯¹æ´æ°åæµ®ç¹æ°æ§è¡èªå¢æèèªåæä½\nlist     åè¡¨            ä»ä¸¤ç«¯åå¥æèå¼¹åºåç´ \n                       è¯»ååä¸ªæèå¤ä¸ªåç´ \n                       è¿è¡ä¿®åªï¼åªä¿çä¸ä¸ªèå´åçåç´ \nset      æ åºéå          æ·»å ãè·åãç§»é¤åä¸ªåç´ \n                       æ£æ¥ä¸ä¸ªåç´ æ¯å¦å­å¨äºéåä¸­\n                       è®¡ç®äº¤éãå¹¶éãå·®é\n                       ä»éåéé¢éæºè·ååç´ \nhash     åå«é®å¼å¯¹çæ åºæ£åè¡¨   æ·»å ãè·åãç§»é¤åä¸ªé®å¼å¯¹\n                       è·åææé®å¼å¯¹\n                       æ£æ¥æä¸ªé®æ¯å¦å­å¨\nzset     æåºéå          æ·»å ãè·åãå é¤åç´ \n                       æ ¹æ®åå¼èå´æèæåæ¥è·ååç´ \n                       è®¡ç®ä¸ä¸ªé®çæå\n\n> what redis data structures look like\n\n\n# string\n\n\n**éç¨åºæ¯ï¼ç¼å­ãè®¡æ°å¨ãå±äº« session**\n\nå½ä»¤ï¼\n\nå½ä»¤     è¡ä¸º\nget    è·åå­å¨å¨ç»å®é®ä¸­çå¼ã\nset    è®¾ç½®å­å¨å¨ç»å®é®ä¸­çå¼ã\ndel    å é¤å­å¨å¨ç»å®é®ä¸­çå¼ï¼è¿ä¸ªå½ä»¤å¯ä»¥ç¨äºææç±»åï¼ã\nincr   ä¸ºé® key å¨å­çæ°å­å¼å ä¸\ndecr   ä¸ºé® key å¨å­çæ°å­å¼åä¸\n\n> æ´å¤å½ä»¤è¯·åèï¼redis string ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> set hello world\nok\n127.0.0.1:6379> get hello\n"world"\n127.0.0.1:6379> del hello\n(integer) 1\n127.0.0.1:6379> get hello\n(nil)\n\n\n\n# hash\n\n\n**éç¨åºæ¯ï¼å­å¨ç»æåæ°æ®**ï¼å¦ä¸ä¸ªå¯¹è±¡ï¼ç¨æ·ä¿¡æ¯ãäº§åä¿¡æ¯ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤        è¡ä¸º\nhset      å¨æ£åéé¢å³èèµ·ç»å®çé®å¼å¯¹ã\nhget      è·åæå®æ£åé®çå¼ã\nhgetall   è·åæ£ååå«çææé®å¼å¯¹ã\nhdel      å¦æç»å®é®å­å¨äºæ£åéé¢ï¼é£ä¹ç§»é¤è¿ä¸ªé®ã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis hash ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key2 value2\n(integer) 1\n127.0.0.1:6379> hset hash-key sub-key1 value1\n(integer) 0\n127.0.0.1:6379> hset hash-key sub-key3 value2\n(integer) 0\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n3) "sub-key2"\n4) "value2"\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 1\n127.0.0.1:6379> hdel hash-key sub-key2\n(integer) 0\n127.0.0.1:6379> hget hash-key sub-key1\n"value1"\n127.0.0.1:6379> hgetall hash-key\n1) "sub-key1"\n2) "value1"\n\n\n\n# list\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨åè¡¨åæ°æ®**ãå¦ï¼ç²ä¸åè¡¨ãåååè¡¨ç­ã\n\nå½ä»¤ï¼\n\nå½ä»¤       è¡ä¸º\nlpush    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nrpush    å°ç»å®å¼æ¨å¥åè¡¨çå³ç«¯ã\nlpop     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nrpop     ä»åè¡¨çå³ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nlrange   è·ååè¡¨å¨ç»å®èå´ä¸çææå¼ã\nlindex   è·ååè¡¨å¨ç»å®ä½ç½®ä¸çåä¸ªåç´ ã\nlrem     ä»åè¡¨çå·¦ç«¯å¼¹åºä¸ä¸ªå¼ï¼å¹¶è¿åè¢«å¼¹åºçå¼ã\nltrim    åªä¿çæå®åºé´åçåç´ ï¼å é¤å¶ä»åç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis list ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> rpush list-key item\n(integer) 1\n127.0.0.1:6379> rpush list-key item2\n(integer) 2\n127.0.0.1:6379> rpush list-key item\n(integer) 3\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item"\n2) "item2"\n3) "item"\n127.0.0.1:6379> lindex list-key 1\n"item2"\n127.0.0.1:6379> lpop list-key\n"item"\n127.0.0.1:6379> lrange list-key 0 -1\n1) "item2"\n2) "item"\n\n\n\n# set\n\n\n**éç¨åºæ¯ï¼ç¨äºå­å¨å»éçåè¡¨åæ°æ®**ã\n\nå½ä»¤ï¼\n\nå½ä»¤          è¡ä¸º\nsadd        å°ç»å®åç´ æ·»å å°éåã\nsmembers    è¿åéååå«çææåç´ ã\nsismember   æ£æ¥ç»å®åç´ æ¯å¦å­å¨äºéåä¸­ã\nsrem        å¦æç»å®çåç´ å­å¨äºéåä¸­ï¼é£ä¹ç§»é¤è¿ä¸ªåç´ ã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis set ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> sadd set-key item\n(integer) 1\n127.0.0.1:6379> sadd set-key item2\n(integer) 1\n127.0.0.1:6379> sadd set-key item3\n(integer) 1\n127.0.0.1:6379> sadd set-key item\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item2"\n3) "item3"\n127.0.0.1:6379> sismember set-key item4\n(integer) 0\n127.0.0.1:6379> sismember set-key item\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 1\n127.0.0.1:6379> srem set-key item2\n(integer) 0\n127.0.0.1:6379> smembers set-key\n1) "item"\n2) "item3"\n\n\n\n# zset\n\n\n\néç¨åºæ¯ï¼ç±äºå¯ä»¥è®¾ç½® scoreï¼ä¸ä¸éå¤ãéåç¨äºå­å¨åç§æè¡æ°æ®ï¼å¦ï¼æè¯åæåºçæåºååéåãææ¶é´æåºçæåºæç« éåã\n\nå½ä»¤ï¼\n\nå½ä»¤              è¡ä¸º\nzadd            å°ä¸ä¸ªå¸¦æç»å®åå¼çæåæ·»å å°æåºéåéé¢ã\nzrange          æ ¹æ®åç´ å¨æåºæåä¸­æå¤çä½ç½®ï¼ä»æåºéåéé¢è·åå¤ä¸ªåç´ ã\nzrangebyscore   è·åæåºéåå¨ç»å®åå¼èå´åçææåç´ ã\nzrem            å¦æç»å®æåå­å¨äºæåºéåï¼é£ä¹ç§»é¤è¿ä¸ªæåã\n\n> æ´å¤å½ä»¤è¯·åèï¼redis zset ç±»åå½ä»¤\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379> zadd zset-key 728 member1\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 1\n127.0.0.1:6379> zadd zset-key 982 member0\n(integer) 0\n\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member1"\n2) "728"\n3) "member0"\n4) "982"\n\n127.0.0.1:6379> zrangebyscore zset-key 0 800 withscores\n1) "member1"\n2) "728"\n\n127.0.0.1:6379> zrem zset-key member1\n(integer) 1\n127.0.0.1:6379> zrem zset-key member1\n(integer) 0\n127.0.0.1:6379> zrange zset-key 0 -1 withscores\n1) "member0"\n2) "982"\n\n\n\n# éç¨å½ä»¤\n\n# æåº\n\nredis ç sort å½ä»¤å¯ä»¥å¯¹ listãsetãzset è¿è¡æåºã\n\nå½ä»¤     æè¿°\nsort   sort source-key [by pattern] [limit offset count] [get\n       pattern [get pattern ...]] [asc | desc] [alpha] [store\n       dest-key]âæ ¹æ®ç»å®éé¡¹ï¼å¯¹è¾å¥ listãsetãzset è¿è¡æåºï¼ç¶åè¿åæå­å¨æåºçç»æã\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> rpush \'sort-input\' 23 15 110 7\n(integer) 4\n127.0.0.1:6379[15]> sort \'sort-input\'\n1) "7"\n2) "15"\n3) "23"\n4) "110"\n127.0.0.1:6379[15]> sort \'sort-input\' alpha\n1) "110"\n2) "15"\n3) "23"\n4) "7"\n127.0.0.1:6379[15]> hset \'d-7\' \'field\' 5\n(integer) 1\n127.0.0.1:6379[15]> hset \'d-15\' \'field\' 1\n(integer) 1\n127.0.0.1:6379[15]> hset \'d-23\' \'field\' 9\n(integer) 1\n127.0.0.1:6379[15]> hset \'d-110\' \'field\' 3\n(integer) 1\n127.0.0.1:6379[15]> sort \'sort-input\' by \'d-*->field\'\n1) "15"\n2) "110"\n3) "7"\n4) "23"\n127.0.0.1:6379[15]> sort \'sort-input\' by \'d-*->field\' get \'d-*->field\'\n1) "1"\n2) "3"\n3) "5"\n4) "9"\n\n\n# é®çè¿ææ¶é´\n\nredis ç expire å½ä»¤å¯ä»¥æå®ä¸ä¸ªé®çè¿ææ¶é´ï¼å½è¾¾å°è¿ææ¶é´åï¼redis ä¼èªå¨å é¤è¯¥é®ã\n\nå½ä»¤          æè¿°\npersist     persist key-nameâç§»é¤é®çè¿ææ¶é´\nttl         ttl key-nameâæ¥çç»å®é®è·ç¦»è¿æè¿æå¤å°ç§\nexpire      expire key-name secondsâè®©ç»å®é®å¨æå®çç§æ°ä¹åè¿æ\nexpireat    expireat key-name timestampâå°ç»å®é®çè¿ææ¶é´è®¾ç½®ä¸ºç»å®ç unix æ¶é´æ³\npttl        pttl key-nameâæ¥çç»å®é®è·ç¦»è¿ææ¶é´è¿æå¤å°æ¯«ç§ï¼è¿ä¸ªå½ä»¤å¨ redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\npexpire     pexpire key-name millisecondsâè®©ç»å®é®å¨æå®çæ¯«ç§æ°ä¹åè¿æï¼è¿ä¸ªå½ä»¤å¨ redis\n            2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\npexpireat   pexpireat key-name timestamp-millisecondsâå°ä¸ä¸ªæ¯«ç§çº§ç²¾åº¦ç unix\n            æ¶é´æ³è®¾ç½®ä¸ºç»å®é®çè¿ææ¶é´ï¼è¿ä¸ªå½ä»¤å¨ redis 2.6 æä»¥ä¸çæ¬å¯ç¨ï¼\n\nç¤ºä¾ï¼\n\n127.0.0.1:6379[15]> set key value\nok\n127.0.0.1:6379[15]> get key\n"value"\n127.0.0.1:6379[15]> expire key 2\n(integer) 1\n127.0.0.1:6379[15]> get key\n(nil)\n\n\n\n# äºãredis é«çº§æ°æ®ç±»å\n\n\n# bitmap\n\nbitmap å³ä½å¾ãbitmap ä¸æ¯ä¸ä¸ªçå®çæ°æ®ç»æãèæ¯ string ç±»åä¸çä¸ç»é¢å bit æä½çéåãç±äº string æ¯äºè¿å¶å®å¨ç blobï¼å¹¶ä¸å®ä»¬çæå¤§é¿åº¦æ¯ 512mï¼æä»¥ bitmap è½æå¤§è®¾ç½® $$2^{32}$$ ä¸ªä¸åç bitã\n\nbitmaps çæå¤§ä¼ç¹å°±æ¯å­å¨ä¿¡æ¯æ¶å¯ä»¥èçå¤§éçç©ºé´ãä¾å¦å¨ä¸ä¸ªç³»ç»ä¸­ï¼ä¸åçç¨æ·è¢«ä¸ä¸ªå¢é¿çç¨æ· id è¡¨ç¤ºã40 äº¿ï¼$$2^{32}$$ = $$410241024*1024$$ â 40 äº¿ï¼ç¨æ·åªéè¦ 512m åå­å°±è½è®°ä½æç§ä¿¡æ¯ï¼ä¾å¦ç¨æ·æ¯å¦ç»å½è¿ã\n\n# bitmap å½ä»¤\n\n * setbit - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è®¾ç½®ææ¸é¤æå®åç§»éä¸çä½(bit)ã\n * getbit - å¯¹ key æå¨å­çå­ç¬¦ä¸²å¼ï¼è·åæå®åç§»éä¸çä½(bit)ã\n * bitcount - è®¡ç®ç»å®å­ç¬¦ä¸²ä¸­ï¼è¢«è®¾ç½®ä¸º 1 çæ¯ç¹ä½çæ°éã\n * bitpos\n * bitop\n * bitfield\n\n# bitmap ç¤ºä¾\n\n# å¯¹ä¸å­å¨ç key æèä¸å­å¨ç offset è¿è¡ getbitï¼ è¿å 0\n\nredis> exists bit\n(integer) 0\n\nredis> getbit bit 10086\n(integer) 0\n\n\n# å¯¹å·²å­å¨ç offset è¿è¡ getbit\n\nredis> setbit bit 10086 1\n(integer) 0\n\nredis> getbit bit 10086\n(integer) 1\n\nredis> bitcount bit\n(integer) 1\n\n\n# bitmap åºç¨\n\nbitmap å¯¹äºä¸äºç¹å®ç±»åçè®¡ç®éå¸¸ææãä¾å¦ï¼ä½¿ç¨ bitmap å®ç°ç¨æ·ä¸çº¿æ¬¡æ°ç»è®¡ã\n\nåè®¾ç°å¨æä»¬å¸æè®°å½èªå·±ç½ç«ä¸çç¨æ·çä¸çº¿é¢çï¼æ¯å¦è¯´ï¼è®¡ç®ç¨æ· a ä¸çº¿äºå¤å°å¤©ï¼ç¨æ· b ä¸çº¿äºå¤å°å¤©ï¼è¯¸å¦æ­¤ç±»ï¼ä»¥æ­¤ä½ä¸ºæ°æ®ï¼ä»èå³å®è®©åªäºç¨æ·åå  beta æµè¯ç­æ´»å¨ ââ è¿ä¸ªæ¨¡å¼å¯ä»¥ä½¿ç¨ setbit key offset value å [bitcount key start] [end] æ¥å®ç°ã\n\næ¯å¦è¯´ï¼æ¯å½ç¨æ·å¨æä¸å¤©ä¸çº¿çæ¶åï¼æä»¬å°±ä½¿ç¨ setbit key offset value ï¼ä»¥ç¨æ·åä½ä¸º keyï¼å°é£å¤©æä»£è¡¨çç½ç«çä¸çº¿æ¥ä½ä¸º offset åæ°ï¼å¹¶å°è¿ä¸ª offset ä¸çä¸ºè®¾ç½®ä¸º 1 ã\n\n> æ´è¯¦ç»çå®ç°å¯ä»¥åèï¼\n> \n> ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n> \n> fast, easy, realtime metrics using redis bitmaps\n\n\n# hyperloglog\n\nhyperloglog æ¯ç¨äºè®¡ç®å¯ä¸äºç©çæ¦çæ°æ®ç»æï¼ä»ææ¯ä¸è®²ï¼è¿è¢«ç§°ä¸ºä¼°è®¡éåçåºæ°ï¼ãå¦æç»è®¡å¯ä¸é¡¹ï¼é¡¹ç®è¶å¤ï¼éè¦çåå­å°±è¶å¤ãå ä¸ºéè¦è®°ä½è¿å»å·²ç»çè¿çé¡¹ï¼ä»èé¿åå¤æ¬¡ç»è®¡è¿äºé¡¹ã\n\n# hyperloglog å½ä»¤\n\n * pfadd - å°ä»»ææ°éçåç´ æ·»å å°æå®ç hyperloglog éé¢ã\n * pfcount - è¿å hyperloglog åå«çå¯ä¸åç´ çè¿ä¼¼æ°éã\n * pfmerge - å°å¤ä¸ª hyperloglog åå¹¶ï¼mergeï¼ä¸ºä¸ä¸ª hyperloglog ï¼ åå¹¶åç hyperloglog çåºæ°æ¥è¿äºææè¾å¥ hyperloglog çå¯è§éåï¼observed setï¼çå¹¶éãåå¹¶å¾åºç hyperloglog ä¼è¢«å¨å­å¨ destkey é®éé¢ï¼ å¦æè¯¥é®å¹¶ä¸å­å¨ï¼ é£ä¹å½ä»¤å¨æ§è¡ä¹åï¼ ä¼åä¸ºè¯¥é®åå»ºä¸ä¸ªç©ºç hyperloglog ã\n\nç¤ºä¾ï¼\n\nredis> pfadd  databases  "redis"  "mongodb"  "mysql"\n(integer) 1\n\nredis> pfcount  databases\n(integer) 3\n\nredis> pfadd  databases  "redis"    # redis å·²ç»å­å¨ï¼ä¸å¿å¯¹ä¼°è®¡æ°éè¿è¡æ´æ°\n(integer) 0\n\nredis> pfcount  databases    # åç´ ä¼°è®¡æ°éæ²¡æåå\n(integer) 3\n\nredis> pfadd  databases  "postgresql"    # æ·»å ä¸ä¸ªä¸å­å¨çåç´ \n(integer) 1\n\nredis> pfcount  databases    # ä¼°è®¡æ°éå¢ä¸\n4\n\n\n\n# geo\n\nè¿ä¸ªåè½å¯ä»¥å°ç¨æ·ç»å®çå°çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ä¿¡æ¯å¨å­èµ·æ¥ï¼å¹¶å¯¹è¿äºä¿¡æ¯è¿è¡æä½ã\n\n# geo å½ä»¤\n\n * geoadd - å°æå®çå°çç©ºé´ä½ç½®ï¼çº¬åº¦ãç»åº¦ãåç§°ï¼æ·»å å°æå®ç key ä¸­ã\n * geopos - ä» key éè¿åææç»å®ä½ç½®åç´ çä½ç½®ï¼ç»åº¦åçº¬åº¦ï¼ã\n * geodist - è¿åä¸¤ä¸ªç»å®ä½ç½®ä¹é´çè·ç¦»ã\n * geohash - åä¸ä¸ªæå¤ä¸ªä½ç½®åç´ çæ å geohash å¼ï¼å®å¯ä»¥å¨http://geohash.org/ä½¿ç¨ã\n * georadius\n * georadiusbymember\n\n\n# ä¸ãredis æ°æ®ç±»ååºç¨\n\n\n# æ¡ä¾-æåæ¬¢è¿æç« \n\néåºæåæ¬¢è¿æç« ï¼éè¦æ¯æå¯¹æç« è¿è¡è¯åã\n\n# å¯¹æç« è¿è¡æç¥¨\n\nï¼1ï¼ä½¿ç¨ hash å­å¨æç« \n\nä½¿ç¨ hash ç±»åå­å¨æç« ä¿¡æ¯ãå¶ä¸­ï¼key æ¯æç«  idï¼field æ¯æç« çå±æ§ keyï¼value æ¯å±æ§å¯¹åºå¼ã\n\n\n\næä½ï¼\n\n * å­å¨æç« ä¿¡æ¯ - ä½¿ç¨ hset æ hmget å½ä»¤\n * æ¥è¯¢æç« ä¿¡æ¯ - ä½¿ç¨ hgetall å½ä»¤\n * æ·»å æç¥¨ - ä½¿ç¨ hincrby å½ä»¤\n\nï¼2ï¼ä½¿ç¨ zset éå¯¹ä¸åç»´åº¦éåæåº\n\nä½¿ç¨ zset ç±»ååå«å­å¨æç§æ¶é´æåºåæç§è¯åæåºçæç«  id éåã\n\n\n\næä½ï¼\n\n * æ·»å è®°å½ - ä½¿ç¨ zadd å½ä»¤\n * æ·»å åæ° - ä½¿ç¨ zincrby å½ä»¤\n * ååºå¤ç¯æç«  - ä½¿ç¨ zrevrange å½ä»¤\n\nï¼3ï¼ä¸ºäºé²æ­¢éå¤æç¥¨ï¼ä½¿ç¨ set ç±»åè®°å½æ¯ç¯æç«  id å¯¹åºçæç¥¨éåã\n\n\n\næä½ï¼\n\n * æ·»å æç¥¨è - ä½¿ç¨ sadd å½ä»¤\n * è®¾ç½®æææ - ä½¿ç¨ expire å½ä»¤\n\nï¼4ï¼åè®¾ user:115423 ç» article:100408 æç¥¨ï¼åå«éè¦é«æ´æ°è¯åæåºéåä»¥åæç¥¨éåã\n\n\n\nå½éè¦å¯¹ä¸ç¯æç« æç¥¨æ¶ï¼ç¨åºéè¦ç¨ zscore å½ä»¤æ£æ¥è®°å½æç« åå¸æ¶é´çæåºéåï¼å¤æ­æç« çåå¸æ¶é´æ¯å¦è¶è¿æç¥¨æææï¼æ¯å¦ï¼ä¸ææï¼ã\n\n    public void articlevote(jedis conn, string user, string article) {\n        // è®¡ç®æç« çæç¥¨æªæ­¢æ¶é´ã\n        long cutoff = (system.currenttimemillis() / 1000) - one_week_in_seconds;\n\n        // æ£æ¥æ¯å¦è¿å¯ä»¥å¯¹æç« è¿è¡æç¥¨\n        // ï¼è½ç¶ä½¿ç¨æ£åä¹å¯ä»¥è·åæç« çåå¸æ¶é´ï¼\n        // ä½æåºéåè¿åçæç« åå¸æ¶é´ä¸ºæµ®ç¹æ°ï¼\n        // å¯ä»¥ä¸è¿è¡è½¬æ¢ç´æ¥ä½¿ç¨ï¼ã\n        if (conn.zscore("time:", article) < cutoff) {\n            return;\n        }\n\n        // ä»article:idæ è¯ç¬¦ï¼identifierï¼éé¢ååºæç« çidã\n        string articleid = article.substring(article.indexof(\':\') + 1);\n\n        // å¦æç¨æ·æ¯ç¬¬ä¸æ¬¡ä¸ºè¿ç¯æç« æç¥¨ï¼é£ä¹å¢å è¿ç¯æç« çæç¥¨æ°éåè¯åã\n        if (conn.sadd("voted:" + articleid, user) == 1) {\n            conn.zincrby("score:", vote_score, article);\n            conn.hincrby(article, "votes", 1);\n        }\n    }\n\n\n# åå¸å¹¶è·åæç« \n\nåå¸æç« ï¼\n\n * æ·»å æç«  - ä½¿ç¨ incr å½ä»¤è®¡ç®æ°çæç«  idï¼å¡«åæç« ä¿¡æ¯ï¼ç¶åç¨ hset å½ä»¤æ hmset å½ä»¤åå¥å° hash ç»æä¸­ã\n * å°æç« ä½è id æ·»å å°æç¥¨åå - ä½¿ç¨ sadd å½ä»¤æ·»å å°ä»£è¡¨æç¥¨ååç set ç»æä¸­ã\n * è®¾ç½®æç¥¨æææ - ä½¿ç¨ expire å½ä»¤è®¾ç½®æç¥¨æææã\n\n    public string postarticle(jedis conn, string user, string title, string link) {\n        // çæä¸ä¸ªæ°çæç« idã\n        string articleid = string.valueof(conn.incr("article:"));\n\n        string voted = "voted:" + articleid;\n        // å°åå¸æç« çç¨æ·æ·»å å°æç« çå·²æç¥¨ç¨æ·ååéé¢ï¼\n        conn.sadd(voted, user);\n        // ç¶åå°è¿ä¸ªååçè¿ææ¶é´è®¾ç½®ä¸ºä¸å¨ï¼ç¬¬3ç« å°å¯¹è¿ææ¶é´ä½æ´è¯¦ç»çä»ç»ï¼ã\n        conn.expire(voted, one_week_in_seconds);\n\n        long now = system.currenttimemillis() / 1000;\n        string article = "article:" + articleid;\n        // å°æç« ä¿¡æ¯å­å¨å°ä¸ä¸ªæ£åéé¢ã\n        hashmap<string, string> articledata = new hashmap<string, string>();\n        articledata.put("title", title);\n        articledata.put("link", link);\n        articledata.put("user", user);\n        articledata.put("now", string.valueof(now));\n        articledata.put("votes", "1");\n        conn.hmset(article, articledata);\n\n        // å°æç« æ·»å å°æ ¹æ®åå¸æ¶é´æåºçæåºéååæ ¹æ®è¯åæåºçæåºéåéé¢ã\n        conn.zadd("score:", now + vote_score, article);\n        conn.zadd("time:", now, article);\n\n        return articleid;\n    }\n\n\nåé¡µæ¥è¯¢æåæ¬¢è¿æç« ï¼\n\nä½¿ç¨ zinterstore å½ä»¤æ ¹æ®é¡µç ãæ¯é¡µè®°å½æ°ãæåºå·ï¼æ ¹æ®è¯åå¼ä»å¤§å°å°åé¡µæ¥åºæç«  id åè¡¨ã\n\n    public list<map<string, string>> getarticles(jedis conn, int page, string order) {\n        // è®¾ç½®è·åæç« çèµ·å§ç´¢å¼åç»æç´¢å¼ã\n        int start = (page - 1) * articles_per_page;\n        int end = start + articles_per_page - 1;\n\n        // è·åå¤ä¸ªæç« idã\n        set<string> ids = conn.zrevrange(order, start, end);\n        list<map<string, string>> articles = new arraylist<>();\n        // æ ¹æ®æç« idè·åæç« çè¯¦ç»ä¿¡æ¯ã\n        for (string id : ids) {\n            map<string, string> articledata = conn.hgetall(id);\n            articledata.put("id", id);\n            articles.add(articledata);\n        }\n\n        return articles;\n    }\n\n\n# å¯¹æç« è¿è¡åç»\n\nå¦ææç« éè¦åç»ï¼åè½éè¦åä¸ºä¸¤åï¼\n\n * è®°å½æç« å±äºåªä¸ªç¾¤ç»\n * è´è´£ååºç¾¤ç»éçæç« \n\nå°æç« æ·»å ãå é¤ç¾¤ç»ï¼\n\n    public void addremovegroups(jedis conn, string articleid, string[] toadd, string[] toremove) {\n        // æå»ºå­å¨æç« ä¿¡æ¯çé®åã\n        string article = "article:" + articleid;\n        // å°æç« æ·»å å°å®æå±çç¾¤ç»éé¢ã\n        for (string group : toadd) {\n            conn.sadd("group:" + group, article);\n        }\n        // ä»ç¾¤ç»éé¢ç§»é¤æç« ã\n        for (string group : toremove) {\n            conn.srem("group:" + group, article);\n        }\n    }\n\n\nååºç¾¤ç»éçæç« ï¼\n\n\n\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« è¯åçæåºéåæ§è¡ zinterstore å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« è¯åæåºçç¾¤ç»æç« ã\n * éè¿å¯¹å­å¨ç¾¤ç»æç« çéååå­å¨æç« åå¸æ¶é´çæåºéåæ§è¡ zinterstore å½ä»¤ï¼å¯ä»¥å¾å°æç§æç« åå¸æ¶é´æåºçç¾¤ç»æç« ã\n\n    public list<map<string, string>> getgrouparticles(jedis conn, string group, int page, string order) {\n        // ä¸ºæ¯ä¸ªç¾¤ç»çæ¯ç§æåé¡ºåºé½åå»ºä¸ä¸ªé®ã\n        string key = order + group;\n        // æ£æ¥æ¯å¦æå·²ç¼å­çæåºç»æï¼å¦ææ²¡æçè¯å°±ç°å¨è¿è¡æåºã\n        if (!conn.exists(key)) {\n            // æ ¹æ®è¯åæèåå¸æ¶é´ï¼å¯¹ç¾¤ç»æç« è¿è¡æåºã\n            zparams params = new zparams().aggregate(zparams.aggregate.max);\n            conn.zinterstore(key, params, "group:" + group, order);\n            // è®©rediså¨60ç§éä¹åèªå¨å é¤è¿ä¸ªæåºéåã\n            conn.expire(key, 60);\n        }\n        // è°ç¨ä¹åå®ä¹çgetarticleså½æ°æ¥è¿è¡åé¡µå¹¶è·åæç« æ°æ®ã\n        return getarticles(conn, page, key);\n    }\n\n\n\n# æ¡ä¾-ç®¡çä»¤ç\n\nç½ç«ä¸è¬ä¼ä»¥ cookieãsessionãä»¤çè¿ç±»ä¿¡æ¯å­å¨ç¨æ·èº«ä»½ä¿¡æ¯ã\n\nå¯ä»¥å° cookie/session/ä»¤ç åç¨æ·çæ å°å³ç³»å­å¨å¨ hash ç»æã\n\nä¸é¢ä»¥ä»¤çæ¥ä¸¾ä¾ã\n\n# æ¥è¯¢ä»¤ç\n\n    public string checktoken(jedis conn, string token) {\n        // å°è¯è·åå¹¶è¿åä»¤çå¯¹åºçç¨æ·ã\n        return conn.hget("login:", token);\n    }\n\n\n# æ´æ°ä»¤ç\n\n * ç¨æ·æ¯æ¬¡è®¿é®é¡µé¢ï¼å¯ä»¥è®°å½ä¸ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª zset ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æ¯å¦æ´»è·ï¼ç»§èå¯ä»¥å¨ææ§æ¸çæèçä»¤çï¼ç»è®¡å½åå¨çº¿ç¨æ·æ°ç­è¡ä¸ºã\n * ç¨æ·å¦ææ­£å¨æµè§ååï¼å¯ä»¥è®°å½å°ç¨æ·æè¿æµè§è¿çååæåºéåä¸­ï¼éåå¯ä»¥éå®æ°éï¼è¶è¿æ°éè¿è¡è£åªï¼ï¼å­å¥å°ä¸ä¸ª zset ç»æä¸­ï¼ä»¥ä¾¿åæç¨æ·æè¿å¯è½æå´è¶£çååï¼ä»¥ä¾¿æ¨èååã\n\n    public void updatetoken(jedis conn, string token, string user, string item) {\n        // è·åå½åæ¶é´æ³ã\n        long timestamp = system.currenttimemillis() / 1000;\n        // ç»´æä»¤çä¸å·²ç»å½ç¨æ·ä¹é´çæ å°ã\n        conn.hset("login:", token, user);\n        // è®°å½ä»¤çæåä¸æ¬¡åºç°çæ¶é´ã\n        conn.zadd("recent:", timestamp, token);\n        if (item != null) {\n            // è®°å½ç¨æ·æµè§è¿çååã\n            conn.zadd("viewed:" + token, timestamp, item);\n            // ç§»é¤æ§çè®°å½ï¼åªä¿çç¨æ·æè¿æµè§è¿ç25ä¸ªååã\n            conn.zremrangebyrank("viewed:" + token, 0, -26);\n            conn.zincrby("viewed:", -1, item);\n        }\n    }\n\n\n# æ¸çä»¤ç\n\nä¸ä¸èæå°ï¼æ´æ°ä»¤çæ¶ï¼å°ä»¤çåå½åæ¶é´æ³çæ å°å³ç³»ï¼å­å¥ä¸ä¸ª zset ç»æä¸­ãæä»¥å¯ä»¥éè¿æåºå¾ç¥åªäºä»¤çæèãå¦ææ²¡ææ¸çæä½ï¼æ´æ°ä»¤çå ç¨çåå­ä¼ä¸æ­è¨èï¼ç´å°å¯¼è´æºå¨å®æºã\n\næ¯å¦ï¼æå¤åè®¸å­å¨ 1000 ä¸æ¡ä»¤çä¿¡æ¯ï¼å¨ææ§æ£æ¥ï¼ä¸æ¦åç°è®°å½æ°è¶åº 1000 ä¸æ¡ï¼å° zset ä»æ°å°èæåºï¼å°è¶åº 1000 ä¸æ¡çè®°å½æ¸é¤ã\n\npublic static class cleansessionsthread extends thread {\n\n    private jedis conn;\n\n    private int limit;\n\n    private volatile boolean quit;\n\n    public cleansessionsthread(int limit) {\n        this.conn = new jedis("localhost");\n        this.conn.select(15);\n        this.limit = limit;\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @override\n    public void run() {\n        while (!quit) {\n            // æ¾åºç®åå·²æä»¤ççæ°éã\n            long size = conn.zcard("recent:");\n            // ä»¤çæ°éæªè¶è¿éå¶ï¼ä¼ç å¹¶å¨ä¹åéæ°æ£æ¥ã\n            if (size <= limit) {\n                try {\n                    sleep(1000);\n                } catch (interruptedexception ie) {\n                    thread.currentthread().interrupt();\n                }\n                continue;\n            }\n\n            // è·åéè¦ç§»é¤çä»¤çidã\n            long endindex = math.min(size - limit, 100);\n            set<string> tokenset = conn.zrange("recent:", 0, endindex - 1);\n            string[] tokens = tokenset.toarray(new string[tokenset.size()]);\n\n            // ä¸ºé£äºå°è¦è¢«å é¤çä»¤çæå»ºé®åã\n            arraylist<string> sessionkeys = new arraylist<string>();\n            for (string token : tokens) {\n                sessionkeys.add("viewed:" + token);\n            }\n\n            // ç§»é¤ææ§çé£äºä»¤çã\n            conn.del(sessionkeys.toarray(new string[sessionkeys.size()]));\n            conn.hdel("login:", tokens);\n            conn.zrem("recent:", tokens);\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-è´­ç©è½¦\n\nå¯ä»¥ä½¿ç¨ hash ç»ææ¥å®ç°è´­ç©è½¦åè½ã\n\næ¯ä¸ªç¨æ·çè´­ç©è½¦ï¼å­å¨äºåå id åååæ°éçæ å°ã\n\n# å¨è´­ç©è½¦ä¸­æ·»å ãå é¤åå\n\n    public void addtocart(jedis conn, string session, string item, int count) {\n        if (count <= 0) {\n            // ä»è´­ç©è½¦éé¢ç§»é¤æå®çååã\n            conn.hdel("cart:" + session, item);\n        } else {\n            // å°æå®çååæ·»å å°è´­ç©è½¦ã\n            conn.hset("cart:" + session, item, string.valueof(count));\n        }\n    }\n\n\n# æ¸ç©ºè´­ç©è½¦\n\nå¨ æ¸çä»¤ç çåºç¡ä¸ï¼æ¸ç©ºä¼è¯æ¶ï¼é¡ºä¾¿å°è´­ç©è½¦ç¼å­ä¸å¹¶æ¸çã\n\n   while (!quit) {\n        long size = conn.zcard("recent:");\n        if (size <= limit) {\n            try {\n                sleep(1000);\n            } catch (interruptedexception ie) {\n                thread.currentthread().interrupt();\n            }\n            continue;\n        }\n\n        long endindex = math.min(size - limit, 100);\n        set<string> sessionset = conn.zrange("recent:", 0, endindex - 1);\n        string[] sessions = sessionset.toarray(new string[sessionset.size()]);\n\n        arraylist<string> sessionkeys = new arraylist<string>();\n        for (string sess : sessions) {\n            sessionkeys.add("viewed:" + sess);\n            // æ°å¢å çè¿è¡ä»£ç ç¨äºå é¤æ§ä¼è¯å¯¹åºç¨æ·çè´­ç©è½¦ã\n            sessionkeys.add("cart:" + sess);\n        }\n\n        conn.del(sessionkeys.toarray(new string[sessionkeys.size()]));\n        conn.hdel("login:", sessions);\n        conn.zrem("recent:", sessions);\n    }\n\n\n\n# æ¡ä¾-é¡µé¢ç¼å­\n\nå¤§é¨åç½é¡µåå®¹å¹¶ä¸ä¼ç»å¸¸æ¹åï¼ä½æ¯è®¿é®æ¶ï¼åå°éè¦å¨æè®¡ç®ï¼è¿å¯è½èæ¶è¾å¤ï¼æ­¤æ¶å¯ä»¥ä½¿ç¨ string ç»æå­å¨é¡µé¢ç¼å­ï¼\n\n    public string cacherequest(jedis conn, string request, callback callback) {\n        // å¯¹äºä¸è½è¢«ç¼å­çè¯·æ±ï¼ç´æ¥è°ç¨åè°å½æ°ã\n        if (!cancache(conn, request)) {\n            return callback != null ? callback.call(request) : null;\n        }\n\n        // å°è¯·æ±è½¬æ¢æä¸ä¸ªç®åçå­ç¬¦ä¸²é®ï¼æ¹ä¾¿ä¹åè¿è¡æ¥æ¾ã\n        string pagekey = "cache:" + hashrequest(request);\n        // å°è¯æ¥æ¾è¢«ç¼å­çé¡µé¢ã\n        string content = conn.get(pagekey);\n\n        if (content == null && callback != null) {\n            // å¦æé¡µé¢è¿æ²¡æè¢«ç¼å­ï¼é£ä¹çæé¡µé¢ã\n            content = callback.call(request);\n            // å°æ°çæçé¡µé¢æ¾å°ç¼å­éé¢ã\n            conn.setex(pagekey, 300, content);\n        }\n\n        // è¿åé¡µé¢ã\n        return content;\n    }\n\n\n\n# æ¡ä¾-æ°æ®è¡ç¼å­\n\nçµåç½ç«å¯è½ä¼æä¿éãç¹åãæ½å¥ç­æ´»å¨ï¼è¿äºæ´»å¨é¡µé¢åªéè¦ä»æ°æ®åºä¸­å è½½å è¡æ°æ®ï¼å¦ï¼ç¨æ·ä¿¡æ¯ãååä¿¡æ¯ã\n\nå¯ä»¥ä½¿ç¨ string ç»ææ¥ç¼å­è¿äºæ°æ®ï¼ä½¿ç¨ json å­å¨ç»æåçä¿¡æ¯ã\n\næ­¤å¤ï¼éè¦æä¸¤ä¸ª zset ç»ææ¥è®°å½æ´æ°ç¼å­çæ¶æºï¼\n\n * ç¬¬ä¸ä¸ªä¸ºè°åº¦æåºéåï¼\n * ç¬¬äºä¸ªä¸ºå»¶æ¶æåºéåã\n\nè®°å½ç¼å­æ¶æºï¼\n\n    public void schedulerowcache(jedis conn, string rowid, int delay) {\n        // åè®¾ç½®æ°æ®è¡çå»¶è¿å¼ã\n        conn.zadd("delay:", delay, rowid);\n        // ç«å³ç¼å­æ°æ®è¡ã\n        conn.zadd("schedule:", system.currenttimemillis() / 1000, rowid);\n    }\n\n\nå®æ¶æ´æ°æ°æ®è¡ç¼å­ï¼\n\npublic class cacherowsthread extends thread {\n\n    private jedis conn;\n\n    private boolean quit;\n\n    public cacherowsthread() {\n        this.conn = new jedis("localhost");\n        this.conn.select(15);\n    }\n\n    public void quit() {\n        quit = true;\n    }\n\n    @override\n    public void run() {\n        gson gson = new gson();\n        while (!quit) {\n            // å°è¯è·åä¸ä¸ä¸ªéè¦è¢«ç¼å­çæ°æ®è¡ä»¥åè¯¥è¡çè°åº¦æ¶é´æ³ï¼\n            // å½ä»¤ä¼è¿åä¸ä¸ªåå«é¶ä¸ªæä¸ä¸ªåç»ï¼tupleï¼çåè¡¨ã\n            set<tuple> range = conn.zrangewithscores("schedule:", 0, 0);\n            tuple next = range.size() > 0 ? range.iterator().next() : null;\n            long now = system.currenttimemillis() / 1000;\n            if (next == null || next.getscore() > now) {\n                try {\n                    // ææ¶æ²¡æè¡éè¦è¢«ç¼å­ï¼ä¼ç 50æ¯«ç§åéè¯ã\n                    sleep(50);\n                } catch (interruptedexception ie) {\n                    thread.currentthread().interrupt();\n                }\n                continue;\n            }\n\n            string rowid = next.getelement();\n            // è·åä¸ä¸æ¬¡è°åº¦åçå»¶è¿æ¶é´ã\n            double delay = conn.zscore("delay:", rowid);\n            if (delay <= 0) {\n                // ä¸å¿åç¼å­è¿ä¸ªè¡ï¼å°å®ä»ç¼å­ä¸­ç§»é¤ã\n                conn.zrem("delay:", rowid);\n                conn.zrem("schedule:", rowid);\n                conn.del("inv:" + rowid);\n                continue;\n            }\n\n            // è¯»åæ°æ®è¡ã\n            inventory row = inventory.get(rowid);\n            // æ´æ°è°åº¦æ¶é´å¹¶è®¾ç½®ç¼å­å¼ã\n            conn.zadd("schedule:", now + delay, rowid);\n            conn.set("inv:" + rowid, gson.tojson(row));\n        }\n    }\n\n}\n\n\n\n# æ¡ä¾-ç½é¡µåæ\n\nç½ç«å¯ä»¥ééç¨æ·çè®¿é®ãäº¤äºãè´­ä¹°è¡ä¸ºï¼ååæç¨æ·ä¹ æ¯ãåå¥½ï¼ä»èå¤æ­å¸åºè¡æåæ½å¨åæºç­ã\n\né£ä¹ï¼ç®åçï¼å¦ä½è®°å½ç¨æ·å¨ä¸å®æ¶é´åè®¿é®çååé¡µé¢å¢ï¼\n\nåè æ´æ°ä»¤ç ä»£ç ç¤ºä¾ï¼è®°å½ç¨æ·è®¿é®ä¸åååçæµè§æ¬¡æ°ï¼å¹¶æåºã\n\nå¤æ­é¡µé¢æ¯å¦éè¦ç¼å­ï¼æ ¹æ®è¯åå¤æ­ååé¡µé¢æ¯å¦ç­é¨ï¼\n\n    public boolean cancache(jedis conn, string request) {\n        try {\n            url url = new url(request);\n            hashmap<string, string> params = new hashmap<>();\n            if (url.getquery() != null) {\n                for (string param : url.getquery().split("&")) {\n                    string[] pair = param.split("=", 2);\n                    params.put(pair[0], pair.length == 2 ? pair[1] : null);\n                }\n            }\n\n            // å°è¯ä»é¡µé¢éé¢ååºååidã\n            string itemid = extractitemid(params);\n            // æ£æ¥è¿ä¸ªé¡µé¢è½å¦è¢«ç¼å­ä»¥åè¿ä¸ªé¡µé¢æ¯å¦ä¸ºååé¡µé¢ã\n            if (itemid == null || isdynamic(params)) {\n                return false;\n            }\n            // åå¾ååçæµè§æ¬¡æ°æåã\n            long rank = conn.zrank("viewed:", itemid);\n            // æ ¹æ®ååçæµè§æ¬¡æ°æåæ¥å¤æ­æ¯å¦éè¦ç¼å­è¿ä¸ªé¡µé¢ã\n            return rank != null && rank < 10000;\n        } catch (malformedurlexception mue) {\n            return false;\n        }\n    }\n\n\n\n# æ¡ä¾-è®°å½æ¥å¿\n\nå¯ç¨ä½¿ç¨ list ç»æå­å¨æ¥å¿æ°æ®ã\n\n    public void logrecent(jedis conn, string name, string message, string severity) {\n        string destination = "recent:" + name + \':\' + severity;\n        pipeline pipe = conn.pipelined();\n        pipe.lpush(destination, timestamp.format(new date()) + \' \' + message);\n        pipe.ltrim(destination, 0, 99);\n        pipe.sync();\n    }\n\n\n\n# æ¡ä¾-ç»è®¡æ°æ®\n\næ´æ°è®¡æ°å¨ï¼\n\n    public static final int[] precision = new int[] { 1, 5, 60, 300, 3600, 18000, 86400 };\n\n    public void updatecounter(jedis conn, string name, int count, long now) {\n        transaction trans = conn.multi();\n        for (int prec : precision) {\n            long pnow = (now / prec) * prec;\n            string hash = string.valueof(prec) + \':\' + name;\n            trans.zadd("known:", 0, hash);\n            trans.hincrby("count:" + hash, string.valueof(pnow), count);\n        }\n        trans.exec();\n    }\n\n\næ¥çè®¡æ°å¨æ°æ®ï¼\n\n    public list<pair<integer>> getcounter(\n        jedis conn, string name, int precision) {\n        string hash = string.valueof(precision) + \':\' + name;\n        map<string, string> data = conn.hgetall("count:" + hash);\n        list<pair<integer>> results = new arraylist<>();\n        for (map.entry<string, string> entry : data.entryset()) {\n            results.add(new pair<>(\n                entry.getkey(),\n                integer.parseint(entry.getvalue())));\n        }\n        collections.sort(results);\n        return results;\n    }\n\n\n\n# æ¡ä¾-æ¥æ¾ ip æå±å°\n\nredis å®ç°ç ip æå±å°æ¥æ¾æ¯å³ç³»åæ°æ®å®ç°æ¹å¼æ´å¿«ã\n\n# è½½å¥ ip æ°æ®\n\nip å°åè½¬ä¸ºæ´æ°å¼ï¼\n\n    public int iptoscore(string ipaddress) {\n        int score = 0;\n        for (string v : ipaddress.split("\\\\.")) {\n            score = score * 256 + integer.parseint(v, 10);\n        }\n        return score;\n    }\n\n\nåå»º ip å°åä¸åå¸ id ä¹é´çæ å°ï¼\n\n    public void importipstoredis(jedis conn, file file) {\n        filereader reader = null;\n        try {\n            // è½½å¥ csv æä»¶æ°æ®\n            reader = new filereader(file);\n            csvformat csvformat = csvformat.default.withrecordseparator("\\n");\n            csvparser csvparser = csvformat.parse(reader);\n            int count = 0;\n            list<csvrecord> records = csvparser.getrecords();\n            for (csvrecord line : records) {\n                string startip = line.get(0);\n                if (startip.tolowercase().indexof(\'i\') != -1) {\n                    continue;\n                }\n                // å° ip å°åè½¬ä¸ºæ´æ°å¼\n                int score = 0;\n                if (startip.indexof(\'.\') != -1) {\n                    score = iptoscore(startip);\n                } else {\n                    try {\n                        score = integer.parseint(startip, 10);\n                    } catch (numberformatexception nfe) {\n                        // ç¥è¿æä»¶çç¬¬ä¸è¡ä»¥åæ ¼å¼ä¸æ­£ç¡®çæ¡ç®\n                        continue;\n                    }\n                }\n\n                // æå»ºå¯ä¸çåå¸ id\n                string cityid = line.get(2) + \'_\' + count;\n                // å°åå¸ id åå¶å¯¹åºç ip å°åæ´æ°å¼æ·»å å° zset\n                conn.zadd("ip2cityid:", score, cityid);\n                count++;\n            }\n        } catch (exception e) {\n            throw new runtimeexception(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (exception e) {\n                // ignore\n            }\n        }\n    }\n\n\nå­å¨åå¸ä¿¡æ¯ï¼\n\n    public void importcitiestoredis(jedis conn, file file) {\n        gson gson = new gson();\n        filereader reader = null;\n        try {\n            // å è½½ csv ä¿¡æ¯\n            reader = new filereader(file);\n            csvformat csvformat = csvformat.default.withrecordseparator("\\n");\n            csvparser parser = new csvparser(reader, csvformat);\n            // string[] line;\n            list<csvrecord> records = parser.getrecords();\n            for (csvrecord record : records) {\n\n                if (record.size() < 4 || !character.isdigit(record.get(0).charat(0))) {\n                    continue;\n                }\n\n                // å°åå¸å°çä¿¡æ¯è½¬ä¸º json ç»æï¼å­å¥ hash ç»æä¸­\n                string cityid = record.get(0);\n                string country = record.get(1);\n                string region = record.get(2);\n                string city = record.get(3);\n                string json = gson.tojson(new string[] { city, region, country });\n                conn.hset("cityid2city:", cityid, json);\n            }\n        } catch (exception e) {\n            throw new runtimeexception(e);\n        } finally {\n            try {\n                reader.close();\n            } catch (exception e) {\n                // ignore\n            }\n        }\n    }\n\n\n# æ¥æ¾ ip æå±åå¸\n\næä½æ­¥éª¤ï¼\n\n 1. å°è¦æ¥æ¾ç ip å°åè½¬ä¸ºæ´æ°å¼ï¼\n 2. æ¥æ¾ææåå¼å°äºç­äºè¦æ¥æ¾ç ip å°åçå°åï¼ååºå¶ä¸­æå¤§åå¼çé£ä¸ªè®°å½ï¼\n 3. ç¨æ¾å°çè®°å½æå¯¹åºçåå¸ id å»æ£ç´¢åå¸ä¿¡æ¯ã\n\n    public string[] findcitybyip(jedis conn, string ipaddress) {\n        int score = iptoscore(ipaddress);\n        set<string> results = conn.zrevrangebyscore("ip2cityid:", score, 0, 0, 1);\n        if (results.size() == 0) {\n            return null;\n        }\n\n        string cityid = results.iterator().next();\n        cityid = cityid.substring(0, cityid.indexof(\'_\'));\n        return new gson().fromjson(conn.hget("cityid2city:", cityid), string[].class);\n    }\n\n\n\n# æ¡ä¾-æå¡çåç°ä¸éç½®\n\n\n# æ¡ä¾-èªå¨è¡¥å¨\n\néæ±ï¼æ ¹æ®ç¨æ·è¾å¥ï¼èªå¨è¡¥å¨ä¿¡æ¯ï¼å¦ï¼èç³»äººãåååç­ã\n\n * å¸ååºæ¯ä¸ï¼ç¤¾äº¤ç½ç«åå°è®°å½ç¨æ·æè¿èç³»è¿ç 100 ä¸ªå¥½åï¼å½ç¨æ·æ¥æ¾å¥½åæ¶ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨å§åã\n * å¸ååºæ¯äºï¼çµåç½ç«åå°è®°å½ç¨æ·æè¿æµè§è¿ç 10 ä»¶ååï¼å½ç¨æ·æ¥æ¾ååæ¯ï¼æ ¹æ®è¾å¥çå³é®å­èªå¨è¡¥å¨åååç§°ã\n\næ°æ®æ¨¡åï¼ä½¿ç¨ redis ç list ç±»åå­å¨æè¿èç³»äººåè¡¨ã\n\næå»ºèªå¨è¡¥å¨åè¡¨éå¸¸æä»¥ä¸æä½ï¼\n\n * å¦ææå®èç³»äººå·²ç»å­å¨äºæè¿èç³»äººåè¡¨éï¼é£ä¹ä»åè¡¨éç§»é¤ä»ãå¯¹åº lrem å½ä»¤ã\n * å°æå®èç³»äººæ·»å å°æè¿èç³»äººåè¡¨çæåé¢ãå¯¹åº lpush å½ä»¤ã\n * æ·»å æä½å®æåï¼å¦æèç³»äººåè¡¨ä¸­çæ°éè¶è¿ 100 ä¸ªï¼è¿è¡è£åªæä½ãå¯¹åº ltrim å½ä»¤ã\n\n\n# æ¡ä¾-å¹¿åå®å\n\n\n# æ¡ä¾-èä½æç´¢\n\néæ±ï¼å¨ä¸ä¸ªæèç½ç«ä¸ï¼æ±èèæèªå·±çæè½æ¸åï¼ç¨äººå¬å¸çèä½æå¿è¦çæè½æ¸åãç¨äººå¬å¸éè¦æ¥è¯¢æ»¡è¶³èªå·±èä½è¦æ±çæ±èèï¼æ±èèéè¦æ¥è¯¢èªå·±å¯ä»¥æéç®åçèä½ã\n\nå³é®æ°æ®æ¨¡åï¼ä½¿ç¨ set ç±»åå­å¨æ±èèçæè½åè¡¨ï¼ä½¿ç¨ set ç±»åå­å¨èä½çæè½åè¡¨ã\n\nå³é®æä½ï¼ä½¿ç¨ sdiff å½ä»¤å¯¹æ¯ä¸¤ä¸ª set çå·®å¼ï¼è¿å empty è¡¨ç¤ºå¹éè¦æ±ã\n\nredis cli ç¤ºä¾ï¼\n\n# -----------------------------------------------------------\n# redis èä½æç´¢æ°æ®æ¨¡åç¤ºä¾\n# -----------------------------------------------------------\n\n# ï¼1ï¼èä½æè½è¡¨ï¼ä½¿ç¨ set å­å¨\n# job:001 èä½æ·»å  4 ç§æè½\nsadd job:001 skill:001\nsadd job:001 skill:002\nsadd job:001 skill:003\nsadd job:001 skill:004\n\n# job:002 èä½æ·»å  3 ç§æè½\nsadd job:002 skill:001\nsadd job:002 skill:002\nsadd job:002 skill:003\n\n# job:003 èä½æ·»å  2 ç§æè½\nsadd job:003 skill:001\nsadd job:003 skill:003\n\n# æ¥ç\nsmembers job:001\nsmembers job:002\nsmembers job:003\n\n# ï¼2ï¼æ±èèæè½è¡¨ï¼ä½¿ç¨ set å­å¨\nsadd interviewee:001 skill:001\nsadd interviewee:001 skill:003\n\nsadd interviewee:002 skill:001\nsadd interviewee:002 skill:002\nsadd interviewee:002 skill:003\nsadd interviewee:002 skill:004\nsadd interviewee:002 skill:005\n\n# æ¥ç\nsmembers interviewee:001\nsmembers interviewee:002\n\n# ï¼3ï¼æ±èèéåæ¥æ¾èªå·±ç¬¦åè¦æ±çèä½ï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nsdiff job:001 interviewee:001\nsdiff job:002 interviewee:001\nsdiff job:003 interviewee:001\n\nsdiff job:001 interviewee:002\nsdiff job:002 interviewee:002\nsdiff job:003 interviewee:002\n\n# ï¼4ï¼ç¨äººå¬å¸æ ¹æ®éåæ¥æ¾ç¬¦åèªå·±èä½è¦æ±çæ±èèï¼è¿åç»æä¸º empty è¡¨ç¤ºè¦æ±çæè½å¨é¨å½ä¸­ï¼\n# æ¯è¾èä½æè½æ¸ååæ±èèæè½æ¸åçå·®å¼\nsdiff interviewee:001 job:001\nsdiff interviewee:002 job:001\n\nsdiff interviewee:001 job:002\nsdiff interviewee:002 job:002\n\nsdiff interviewee:001 job:003\nsdiff interviewee:002 job:003\n\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * ä¸çå°±æç³»åä¹ è¯¦è§£ redis ç bitmap å¨äº¿çº§é¡¹ç®ä¸­çåºç¨\n   * fast, easy, realtime metrics using redis bitmaps',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis æä¹å",frontmatter:{title:"Redis æä¹å",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","æä¹å"],permalink:"/pages/d61faa/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/04.Redis%E6%8C%81%E4%B9%85%E5%8C%96.html",relativePath:"05.KVæ°æ®åº/01.Redis/04.Redisæä¹å.md",key:"v-55c42fdf",path:"/pages/d61faa/",headers:[{level:2,title:"ä¸ãRDB",slug:"ä¸ãrdb",normalizedTitle:"ä¸ãrdb",charIndex:493},{level:3,title:"RDB ç®ä»",slug:"rdb-ç®ä»",normalizedTitle:"rdb ç®ä»",charIndex:503},{level:4,title:"RDB çä¼ç¹",slug:"rdb-çä¼ç¹",normalizedTitle:"rdb çä¼ç¹",charIndex:721},{level:4,title:"RDB çç¼ºç¹",slug:"rdb-çç¼ºç¹",normalizedTitle:"rdb çç¼ºç¹",charIndex:951},{level:3,title:"RDB çåå»º",slug:"rdb-çåå»º",normalizedTitle:"rdb çåå»º",charIndex:1358},{level:4,title:"èªå¨é´éä¿å­",slug:"èªå¨é´éä¿å­",normalizedTitle:"èªå¨é´éä¿å­",charIndex:1625},{level:3,title:"RDB çè½½å¥",slug:"rdb-çè½½å¥",normalizedTitle:"rdb çè½½å¥",charIndex:1950},{level:3,title:"RDB çæä»¶ç»æ",slug:"rdb-çæä»¶ç»æ",normalizedTitle:"rdb çæä»¶ç»æ",charIndex:2173},{level:3,title:"RDB çéç½®",slug:"rdb-çéç½®",normalizedTitle:"rdb çéç½®",charIndex:2329},{level:2,title:"äºãAOF",slug:"äºãaof",normalizedTitle:"äºãaof",charIndex:2773},{level:3,title:"AOF ç®ä»",slug:"aof-ç®ä»",normalizedTitle:"aof ç®ä»",charIndex:2783},{level:4,title:"AOF çä¼ç¹",slug:"aof-çä¼ç¹",normalizedTitle:"aof çä¼ç¹",charIndex:3e3},{level:4,title:"AOF çç¼ºç¹",slug:"aof-çç¼ºç¹",normalizedTitle:"aof çç¼ºç¹",charIndex:3773},{level:3,title:"AOF çåå»º",slug:"aof-çåå»º",normalizedTitle:"aof çåå»º",charIndex:4011},{level:3,title:"AOF çè½½å¥",slug:"aof-çè½½å¥",normalizedTitle:"aof çè½½å¥",charIndex:4613},{level:3,title:"AOF çéå",slug:"aof-çéå",normalizedTitle:"aof çéå",charIndex:4886},{level:4,title:"AOF åå°éå",slug:"aof-åå°éå",normalizedTitle:"aof åå°éå",charIndex:5227},{level:3,title:"AOF çéç½®",slug:"aof-çéç½®",normalizedTitle:"aof çéç½®",charIndex:5884},{level:2,title:"ä¸ãRDB å AOF",slug:"ä¸ãrdb-å-aof",normalizedTitle:"ä¸ãrdb å aof",charIndex:6556},{level:3,title:"å¦ä½éæ©æä¹å",slug:"å¦ä½éæ©æä¹å",normalizedTitle:"å¦ä½éæ©æä¹å",charIndex:6655},{level:3,title:"RDB åæ¢ä¸º AOF",slug:"rdb-åæ¢ä¸º-aof",normalizedTitle:"rdb åæ¢ä¸º aof",charIndex:6886},{level:3,title:"AOF å RDB çç¸äºä½ç¨",slug:"aof-å-rdb-çç¸äºä½ç¨",normalizedTitle:"aof å rdb çç¸äºä½ç¨",charIndex:7350},{level:2,title:"åãRedis å¤ä»½",slug:"åãredis-å¤ä»½",normalizedTitle:"åãredis å¤ä»½",charIndex:7567},{level:3,title:"å¤ä»½è¿ç¨",slug:"å¤ä»½è¿ç¨",normalizedTitle:"å¤ä»½è¿ç¨",charIndex:7626},{level:3,title:"å®¹ç¾å¤ä»½",slug:"å®¹ç¾å¤ä»½",normalizedTitle:"å®¹ç¾å¤ä»½",charIndex:7864},{level:2,title:"äºãè¦ç¹æ»ç»",slug:"äºãè¦ç¹æ»ç»",normalizedTitle:"äºãè¦ç¹æ»ç»",charIndex:7970},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7983}],headersStr:"ä¸ãRDB RDB ç®ä» RDB çä¼ç¹ RDB çç¼ºç¹ RDB çåå»º èªå¨é´éä¿å­ RDB çè½½å¥ RDB çæä»¶ç»æ RDB çéç½® äºãAOF AOF ç®ä» AOF çä¼ç¹ AOF çç¼ºç¹ AOF çåå»º AOF çè½½å¥ AOF çéå AOF åå°éå AOF çéç½® ä¸ãRDB å AOF å¦ä½éæ©æä¹å RDB åæ¢ä¸º AOF AOF å RDB çç¸äºä½ç¨ åãRedis å¤ä»½ å¤ä»½è¿ç¨ å®¹ç¾å¤ä»½ äºãè¦ç¹æ»ç» åèèµæ",content:"# Redis æä¹å\n\n> Redis æ¯ææä¹åï¼å³ææ°æ®å­å¨å°ç¡¬çä¸­ã\n> \n> Redis æä¾äºä¸¤ç§æä¹åæ¹å¼ï¼\n> \n>  * RDB å¿«ç§ï¼snapshotï¼ - å°å­å¨äºæä¸æ¶å»çæææ°æ®é½åå¥å°ç¡¬çä¸­ã\n>  * åªè¿½å æä»¶ï¼append-only fileï¼AOFï¼ - å®ä¼å¨æ§è¡åå½ä»¤æ¶ï¼å°è¢«æ§è¡çåå½ä»¤å¤å¶å°ç¡¬çä¸­ã\n> \n> è¿ä¸¤ç§æä¹åæ¹å¼æ¢å¯ä»¥åæ¶ä½¿ç¨ï¼ä¹å¯ä»¥åç¬ä½¿ç¨ã\n> \n> å°åå­ä¸­çæ°æ®å­å¨å°ç¡¬ççä¸ä¸ªä¸»è¦åå æ¯ä¸ºäºå¨ä¹åéç¨æ°æ®ï¼æèæ¯ä¸ºäºé²æ­¢ç³»ç»æéèå°æ°æ®å¤ä»½å°ä¸ä¸ªè¿ç¨ä½ç½®ãå¦å¤ï¼å­å¨å¨ Redis éé¢çæ°æ®æå¯è½æ¯ç»è¿é¿æ¶é´è®¡ç®å¾åºçï¼æèæç¨åºæ­£å¨ä½¿ç¨ Redis å­å¨çæ°æ®è¿è¡è®¡ç®ï¼æä»¥ç¨æ·ä¼å¸æèªå·±å¯ä»¥å°è¿äºæ°æ®å­å¨èµ·æ¥ä»¥ä¾¿ä¹åä½¿ç¨ï¼è¿æ ·å°±ä¸å¿éæ°è®¡ç®äºã\n> \n> Redis æä¾äºä¸¤ç§æä¹æ¹å¼ï¼RDB å AOFãä½ å¯ä»¥åæ¶å¼å¯ä¸¤ç§æä¹åæ¹å¼ãå¨è¿ç§æåµä¸, å½ redis éå¯çæ¶åä¼ä¼åè½½å¥ AOF æä»¶æ¥æ¢å¤åå§çæ°æ®ï¼å ä¸ºå¨éå¸¸æåµä¸ AOF æä»¶ä¿å­çæ°æ®éè¦æ¯ RDB æä»¶ä¿å­çæ°æ®éè¦å®æ´ã\n\n\n# ä¸ãRDB\n\n\n# RDB ç®ä»\n\nRDB å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ Redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼RDB æä»¶ï¼ä¸­ã\n\nåå»º RDB åï¼ç¨æ·å¯ä»¥å¯¹ RDB è¿è¡å¤ä»½ï¼å¯ä»¥å° RDB å¤å¶å°å¶ä»æå¡å¨ä»èåå»ºå·æç¸åæ°æ®çæå¡å¨å¯æ¬ï¼è¿å¯ä»¥å¨éå¯æå¡å¨æ¶ä½¿ç¨ãä¸å¥è¯æ¥è¯´ï¼RDB éåä½ä¸º å·å¤ã\n\nRDB æ¢å¯ä»¥æå¨æ§è¡ï¼ä¹å¯ä»¥æ ¹æ®æå¡å¨éç½®éé¡¹å®ææ§è¡ãè¯¥åè½å¯ä»¥å°æä¸ªæ¶é´ç¹çæ°æ®åºç¶æä¿å­å°ä¸ä¸ª RDB æä»¶ä¸­ã\n\n# RDB çä¼ç¹\n\n * RDB æä»¶éå¸¸ç´§åï¼éåä½ä¸ºå·å¤ãæ¯å¦ä½ å¯ä»¥å¨æ¯ä¸ªå°æ¶æ¥ä¿å­ä¸ä¸è¿å» 24 å°æ¶åçæ°æ®ï¼åæ¶æ¯å¤©ä¿å­è¿å» 30 å¤©çæ°æ®ï¼è¿æ ·å³ä½¿åºäºé®é¢ä½ ä¹å¯ä»¥æ ¹æ®éæ±æ¢å¤å°ä¸åçæ¬çæ°æ®éã\n * å¿«ç§å¨ä¿å­ RDB æä»¶æ¶ç¶è¿ç¨å¯ä¸éè¦åçå°±æ¯ fork åºä¸ä¸ªå­è¿ç¨ï¼æ¥ä¸æ¥çå·¥ä½å¨é¨ç±å­è¿ç¨æ¥åï¼ç¶è¿ç¨ä¸éè¦ååå¶ä» IO æä½ï¼æä»¥å¿«ç§æä¹åæ¹å¼å¯ä»¥æå¤§å Redis çæ§è½ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼RDB æ¯ AOF æ´å¿«ã\n\n# RDB çç¼ºç¹\n\n * å¦æç³»ç»åçæéï¼å°ä¼ä¸¢å¤±æåä¸æ¬¡åå»ºå¿«ç§ä¹åçæ°æ®ãå¦æä½ å¸æå¨ Redis æå¤åæ­¢å·¥ä½ï¼ä¾å¦çµæºä¸­æ­ï¼çæåµä¸ä¸¢å¤±çæ°æ®æå°çè¯ï¼é£ä¹ å¿«ç§ä¸éåä½ ãè½ç¶ä½ å¯ä»¥éç½®ä¸åç save æ¶é´ç¹(ä¾å¦æ¯é 5 åéå¹¶ä¸å¯¹æ°æ®éæ 100 ä¸ªåçæä½)ï¼æ¯ Redis è¦å®æ´çä¿å­æ´ä¸ªæ°æ®éæ¯ä¸ä¸ªæ¯è¾ç¹éçå·¥ä½ï¼ä½ éå¸¸ä¼æ¯é 5 åéæèæ´ä¹åä¸æ¬¡å®æ´çä¿å­ï¼ä¸ä¸å¨ Redis æå¤å®æºï¼ä½ å¯è½ä¼ä¸¢å¤±å åéçæ°æ®ã\n * å¦ææ°æ®éå¾å¤§ï¼ä¿å­å¿«ç§çæ¶é´ä¼å¾é¿ãå¿«ç§éè¦ç»å¸¸ fork å­è¿ç¨æ¥ä¿å­æ°æ®éå°ç¡¬çä¸ãå½æ°æ®éæ¯è¾å¤§çæ¶åï¼fork çè¿ç¨æ¯éå¸¸èæ¶çï¼å¯è½ä¼å¯¼è´ Redis å¨ä¸äºæ¯«ç§çº§åä¸è½ååºå®¢æ·ç«¯çè¯·æ±ãå¦ææ°æ®éå·¨å¤§å¹¶ä¸ CPU æ§è½ä¸æ¯å¾å¥½çæåµä¸ï¼è¿ç§æåµä¼æç»­ 1 ç§ãAOF ä¹éè¦ forkï¼ä½æ¯ä½ å¯ä»¥è°èéåæ¥å¿æä»¶çé¢çæ¥æé«æ°æ®éçèä¹åº¦ã\n\n\n# RDB çåå»º\n\næä¸¤ä¸ª Redis å½ä»¤å¯ä»¥ç¨äºçæ RDB æä»¶ï¼SAVE å BGSAVEã\n\n * SAVE å½ä»¤ä¼é»å¡ Redis æå¡å¨è¿ç¨ï¼ç´å° RDB åå»ºå®æä¸ºæ­¢ï¼å¨é»å¡æé´ï¼æå¡å¨ä¸è½ååºä»»ä½å½ä»¤è¯·æ±ã\n * BGSAVE å½ä»¤ä¼æ´¾çåºï¼forkï¼ä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£åå»º RDB æä»¶ï¼æå¡å¨è¿ç¨ï¼ç¶è¿ç¨ï¼ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n> ð æ³¨æï¼BGSAVE å½ä»¤æ§è¡æé´ï¼SAVEãBGSAVEãBGREWRITEAOF ä¸ä¸ªå½ä»¤ä¼è¢«æç»ï¼ä»¥åä¸å½åç BGSAVE æä½äº§çç«ææ¡ä»¶ï¼éä½æ§è½ã\n\n# èªå¨é´éä¿å­\n\nRedis åè®¸ç¨æ·éè¿è®¾ç½®æå¡å¨éç½®ç save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ BGSAVE å½ä»¤ã\n\nç¨æ·å¯ä»¥éè¿ save éé¡¹è®¾ç½®å¤ä¸ªä¿å­æ¡ä»¶ï¼ä½åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼æå¡å¨å°±ä¼æ§è¡ BGSAVE å½ä»¤ã\n\nä¸¾ä¾æ¥è¯´ï¼redis.conf ä¸­è®¾ç½®äºå¦ä¸éç½®ï¼\n\nsave 900 1       -- 900 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 1 æ¬¡ä¿®æ¹\nsave 300 10      -- 300 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10 æ¬¡ä¿®æ¹\nsave 60 10000    -- 60 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10000 æ¬¡ä¿®æ¹\n\n\nåªè¦æ»¡è¶³ä»¥ä¸ä»»ææ¡ä»¶ï¼Redis æå¡å°±ä¼æ§è¡ BGSAVE å½ä»¤ã\n\n\n# RDB çè½½å¥\n\nRDB æä»¶çè½½å¥å·¥ä½æ¯å¨æå¡å¨å¯å¨æ¶èªå¨æ§è¡çï¼Redis å¹¶æ²¡æä¸é¨ç¨äºè½½å¥ RDB æä»¶çå½ä»¤ã\n\næå¡å¨è½½å¥ RDB æä»¶æé´ï¼ä¼ä¸ç´å¤äºé»å¡ç¶æï¼ç´å°è½½å¥å®æä¸ºæ­¢ã\n\n> ð æ³¨æï¼å ä¸º AOF éå¸¸æ´æ°é¢çæ¯ RDB é«ï¼æä»¥ä¸¢å¤±æ°æ®ç¸å¯¹æ´å°ãåºäºè¿ä¸ªåå ï¼Redis æä»¥ä¸é»è®¤è¡ä¸ºï¼\n> \n>  * åªæå¨å³é­ AOF åè½çæåµä¸ï¼æä¼ä½¿ç¨ RDB è¿åæ°æ®ï¼å¦åä¼åä½¿ç¨ AOF æä»¶æ¥è¿åæ°æ®ã\n\n\n# RDB çæä»¶ç»æ\n\nRDB æä»¶æ¯ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼ç±å¤ä¸ªé¨åç»æã\n\nå¯¹äºä¸åç±»åï¼STRINGãHASHãLISTãSETãSORTED SETï¼çé®å¼å¯¹ï¼RDB æä»¶ä¼ä½¿ç¨ä¸åçæ¹å¼æ¥ä¿å­å®ä»¬ã\n\n\n\nRedis æ¬èº«æä¾äºä¸ä¸ª RDB æä»¶æ£æ¥å·¥å· redis-check-dumpã\n\n\n# RDB çéç½®\n\nRedis RDB é»è®¤éç½®å¦ä¸ï¼\n\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\n\n\nRedis çéç½®æä»¶ redis.conf ä¸­ä¸ RDB æå³çéé¡¹ï¼\n\n * save - Redis ä¼æ ¹æ® save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ BGSAVE å½ä»¤ã\n\n * stop-writes-on-bgsave-error - å½ BGSAVE å½ä»¤åºç°éè¯¯æ¶åæ­¢å RDB æä»¶\n\n * rdbcompression - RDB æä»¶å¼å¯åç¼©åè½ã\n\n * rdbchecksum - å¯¹ RDB æä»¶è¿è¡æ ¡éªã\n\n * dbfilename - RDB æä»¶åã\n\n * dir - RDB æä»¶å AOF æä»¶çå­å¨è·¯å¾ã\n\n\n# äºãAOF\n\n\n# AOF ç®ä»\n\nAOF(Append Only File) æ¯ä»¥ ææ¬æ¥å¿å½¢å¼ å° ææåå½ä»¤ä»¥ Redis å½ä»¤è¯·æ±åè®®æ ¼å¼è¿½å å° AOF æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯æ¶ï¼ä¼éæ°è½½å¥åæ§è¡ AOF æä»¶ä¸­çå½ä»¤ï¼å°±å¯ä»¥æ¢å¤åå§çæ°æ®ãAOF éåä½ä¸º ç­å¤ã\n\nAOF å¯ä»¥éè¿ appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\nå½ä»¤è¯·æ±ä¼åä¿å­å° AOF ç¼å²åºä¸­ï¼ä¹ååå®æåå¥å¹¶åæ­¥å° AOF æä»¶ã\n\n# AOF çä¼ç¹\n\n * å¦æç³»ç»åçæéï¼AOF ä¸¢å¤±æ°æ®æ¯ RDB å°ãä½ å¯ä»¥ä½¿ç¨ä¸åç fsync ç­ç¥ï¼æ  fsyncï¼æ¯ç§ fsyncï¼æ¯æ¬¡åçæ¶å fsyncãä½¿ç¨é»è®¤çæ¯ç§ fsync ç­ç¥ï¼Redis çæ§è½ä¾ç¶å¾å¥½(fsync æ¯ç±åå°çº¿ç¨è¿è¡å¤çç,ä¸»çº¿ç¨ä¼å°½åå¤çå®¢æ·ç«¯è¯·æ±)ï¼ä¸æ¦åºç°æéï¼ä½ æå¤ä¸¢å¤± 1 ç§çæ°æ®ã\n * AOF æä»¶å¯ä¿®å¤ - AOF æä»¶æ¯ä¸ä¸ªåªè¿è¡è¿½å çæ¥å¿æä»¶ï¼æä»¥ä¸éè¦åå¥ seekï¼å³ä½¿ç±äºæäºåå (ç£çç©ºé´å·²æ»¡ï¼åçè¿ç¨ä¸­å®æºç­ç­)æªæ§è¡å®æ´çåå¥å½ä»¤ï¼ä½ ä¹ä¹å¯ä½¿ç¨ redis-check-aof å·¥å·ä¿®å¤è¿äºé®é¢ã\n * AOF æä»¶å¯åç¼©ãRedis å¯ä»¥å¨ AOF æä»¶ä½ç§¯åå¾è¿å¤§æ¶ï¼èªå¨å°å¨åå°å¯¹ AOF è¿è¡éåï¼éååçæ° AOF æä»¶åå«äºæ¢å¤å½åæ°æ®éæéçæå°å½ä»¤éåãæ´ä¸ªéåæä½æ¯ç»å¯¹å®å¨çï¼å ä¸º Redis å¨åå»ºæ° AOF æä»¶çè¿ç¨ä¸­ï¼ä¼ç»§ç»­å°å½ä»¤è¿½å å°ç°æç AOF æä»¶éé¢ï¼å³ä½¿éåè¿ç¨ä¸­åçåæºï¼ç°æç AOF æä»¶ä¹ä¸ä¼ä¸¢å¤±ãèä¸æ¦æ° AOF æä»¶åå»ºå®æ¯ï¼Redis å°±ä¼ä»æ§ AOF æä»¶åæ¢å°æ° AOF æä»¶ï¼å¹¶å¼å§å¯¹æ° AOF æä»¶è¿è¡è¿½å æä½ã\n * AOF æä»¶å¯è¯» - AOF æä»¶æåºå°ä¿å­äºå¯¹æ°æ®åºæ§è¡çææåå¥æä½ï¼è¿äºåå¥æä½ä»¥ Redis å½ä»¤çæ ¼å¼ä¿å­ãå æ­¤ AOF æä»¶çåå®¹éå¸¸å®¹æè¢«äººè¯»æï¼å¯¹æä»¶è¿è¡åæï¼parseï¼ä¹å¾è½»æ¾ã å¯¼åºï¼exportï¼ AOF æä»¶ä¹éå¸¸ç®åãä¸¾ä¸ªä¾å­ï¼å¦æä½ ä¸å°å¿æ§è¡äº FLUSHALL å½ä»¤ï¼ä½åªè¦ AOF æä»¶æªè¢«éåï¼é£ä¹åªè¦åæ­¢æå¡å¨ï¼ç§»é¤ AOF æä»¶æ«å°¾ç FLUSHALL å½ä»¤ï¼å¹¶éå¯ Redis ï¼å°±å¯ä»¥å°æ°æ®éæ¢å¤å° FLUSHALL æ§è¡ä¹åçç¶æã\n\n# AOF çç¼ºç¹\n\n * AOF æä»¶ä½ç§¯ä¸è¬æ¯ RDB å¤§ - å¯¹äºç¸åçæ°æ®éæ¥è¯´ï¼AOF æä»¶çä½ç§¯éå¸¸è¦å¤§äº RDB æä»¶çä½ç§¯ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼AOF æ¯ RDB æ¢ã - æ ¹æ®æä½¿ç¨ç fsync ç­ç¥ï¼AOF çéåº¦å¯è½ä¼æ¢äºå¿«ç§ãå¨ä¸è¬æåµä¸ï¼æ¯ç§ fsync çæ§è½ä¾ç¶éå¸¸é«ï¼èå³é­ fsync å¯ä»¥è®© AOF çéåº¦åå¿«ç§ä¸æ ·å¿«ï¼å³ä½¿å¨é«è´è·ä¹ä¸ä¹æ¯å¦æ­¤ãä¸è¿å¨å¤çå·¨å¤§çåå¥è½½å¥æ¶ï¼å¿«ç§å¯ä»¥æä¾æ´æä¿è¯çæå¤§å»¶è¿æ¶é´ï¼latencyï¼ã\n\n\n# AOF çåå»º\n\nRedis å½ä»¤è¯·æ±ä¼åä¿å­å° AOF ç¼å²åºï¼åå®æåå¥å¹¶åæ­¥å° AOF æä»¶ã\n\nAOF çå®ç°å¯ä»¥åä¸ºå½ä»¤è¿½å ï¼appendï¼ãæä»¶åå¥ãæä»¶åæ­¥ï¼syncï¼ä¸ä¸ªæ­¥éª¤ã\n\n * å½ä»¤è¿½å  - å½ Redis æå¡å¨å¼å¯ AOF åè½æ¶ï¼æå¡å¨å¨æ§è¡å®ä¸ä¸ªåå½ä»¤åï¼ä¼ä»¥ Redis å½ä»¤åè®®æ ¼å¼å°è¢«æ§è¡çåå½ä»¤è¿½å å° AOF ç¼å²åºçæ«å°¾ã\n * æä»¶åå¥åæä»¶åæ­¥ - Redis çæå¡å¨è¿ç¨å°±æ¯ä¸ä¸ªäºä»¶å¾ªç¯ï¼è¿ä¸ªå¾ªç¯ä¸­çæä»¶äºä»¶è´è´£æ¥æ¶å®¢æ·ç«¯çå½ä»¤è¯·æ±ï¼ä»¥ååå®¢æ·ç«¯åéå½ä»¤åå¤ãèæ¶é´äºä»¶åè´è´£æ§è¡å®æ¶è¿è¡çå½æ°ãå ä¸ºæå¡å¨å¨å¤çæä»¶äºä»¶æ¶å¯è½ä¼æ§è¡åå½ä»¤ï¼è¿äºåå½ä»¤ä¼è¢«è¿½å å° AOF ç¼å²åºï¼æå¡å¨æ¯æ¬¡ç»æäºä»¶å¾ªç¯åï¼é½ä¼æ ¹æ® appendfsync éé¡¹æ¥å¤æ­ AOF ç¼å²åºåå®¹æ¯å¦éè¦åå¥ååæ­¥å° AOF æä»¶ä¸­ã\n\nappendfsync ä¸åéé¡¹å³å®äºä¸åçæä¹åè¡ä¸ºï¼\n\n * always - å°ç¼å²åºææåå®¹åå¥å¹¶åæ­¥å° AOF æä»¶ã\n * everysec - å°ç¼å²åºææåå®¹åå¥å° AOF æä»¶ï¼å¦æä¸æ¬¡åæ­¥ AOF æä»¶çæ¶é´è·ç¦»ç°å¨è¶è¿ä¸ç§éï¼é£ä¹åæ¬¡å¯¹ AOF æä»¶è¿è¡åæ­¥ï¼è¿ä¸ªåæ­¥æä½æ¯æä¸ä¸ªçº¿ç¨ä¸é¨è´è´£æ§è¡çã\n * no - å°ç¼å²åºææåå®¹åå¥å° AOF æä»¶ï¼ä½å¹¶ä¸å¯¹ AOF æä»¶è¿è¡åæ­¥ï¼ä½æ¶åæ­¥ç±æä½ç³»ç»å³å®ã\n\n\n# AOF çè½½å¥\n\nå ä¸º AOF æä»¶ä¸­åå«äºéå»ºæ°æ®åºæéçææåå½ä»¤ï¼æä»¥æå¡å¨åªè¦è½½å¥å¹¶æ§è¡ä¸é AOF æä»¶ä¸­ä¿å­çåå½ä»¤ï¼å°±å¯ä»¥è¿åæå¡å¨å³é­åçæ°æ®åºç¶æã\n\nAOF è½½å¥è¿ç¨å¦ä¸ï¼\n\n 1. æå¡å¨å¯å¨è½½å¥ç¨åºã\n 2. åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯ãå ä¸º Redis å½ä»¤åªè½å¨å®¢æ·ç«¯ä¸ä¸æä¸­æ§è¡ï¼æä»¥éè¦åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯æ¥è½½å¥ãæ§è¡ AOF æä»¶ä¸­è®°å½çå½ä»¤ã\n 3. ä» AOF æä»¶ä¸­åæå¹¶è¯»åä¸æ¡åå½ä»¤ã\n 4. ä½¿ç¨ä¼ªå®¢æ·ç«¯æ§è¡åå½ä»¤ã\n 5. å¾ªç¯æ§è¡æ­¥éª¤ 3ã4ï¼ç´å°ææåå½ä»¤é½è¢«å¤çå®æ¯ä¸ºæ­¢ã\n 6. è½½å¥å®æ¯ã\n\n\n\n\n# AOF çéå\n\néç Redis ä¸æ­è¿è¡ï¼AOF çä½ç§¯ä¹ä¼ä¸æ­å¢é¿ï¼è¿å°å¯¼è´ä¸¤ä¸ªé®é¢ï¼\n\n * AOF èå°½ç£çå¯ç¨ç©ºé´ã\n * Redis éå¯åéè¦æ§è¡ AOF æä»¶è®°å½çææåå½ä»¤æ¥è¿åæ°æ®éï¼å¦æ AOF è¿å¤§ï¼åè¿åæä½æ§è¡çæ¶é´å°±ä¼éå¸¸é¿ã\n\nä¸ºäºè§£å³ AOF ä½ç§¯è¨èé®é¢ï¼Redis æä¾äº AOF éååè½ï¼æ¥å¯¹ AOF æä»¶è¿è¡åç¼©ãAOF éåå¯ä»¥äº§çä¸ä¸ªæ°ç AOF æä»¶ï¼è¿ä¸ªæ°ç AOF æä»¶ååæ¥ç AOF æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ï¼ä½ä½ç§¯æ´å°ã\n\nAOF éåå¹¶éè¯»åååæç°æ AOF æä»¶çåå®¹ï¼èæ¯ç´æ¥ä»æ°æ®åºä¸­è¯»åå½åçæ°æ®åºç¶æãå³ä¾æ¬¡è¯»åæ°æ®åºä¸­çæ¯ä¸ªé®å¼å¯¹ï¼ç¶åç¨ä¸æ¡å½ä»¤å»è®°å½è¯¥é®å¼å¯¹ï¼ä»¥æ­¤ä»£æ¿ä¹åå¯è½å­å¨åä½çå½ä»¤ã\n\n# AOF åå°éå\n\nä½ä¸ºä¸ç§è¾å©æ§åè½ï¼æ¾ç¶ Redis å¹¶ä¸æ³å¨ AOF éåæ¶é»å¡ Redis æå¡æ¥æ¶å¶ä»å½ä»¤ãå æ­¤ï¼Redis å³å®éè¿ BGREWRITEAOF å½ä»¤åå»ºä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£å¯¹ AOF æä»¶è¿è¡éåï¼è¿ä¸ BGSAVE åçç±»ä¼¼ã\n\n * å¨æ§è¡ BGREWRITEAOF å½ä»¤æ¶ï¼Redis æå¡å¨ä¼ç»´æ¤ä¸ä¸ª AOF éåç¼å²åºãå½ AOF éåå­è¿ç¨å¼å§å·¥ä½åï¼Redis æ¯æ§è¡å®ä¸ä¸ªåå½ä»¤ï¼ä¼åæ¶å°è¿ä¸ªå½ä»¤åéç» AOF ç¼å²åºå AOF éåç¼å²åºã\n * ç±äºå½¼æ­¤ä¸æ¯å¨åä¸ä¸ªè¿ç¨ä¸­å·¥ä½ï¼AOF éåä¸å½±å AOF åå¥ååæ­¥ãå½å­è¿ç¨å®æåå»ºæ° AOF æä»¶çå·¥ä½ä¹åï¼æå¡å¨ä¼å°éåç¼å²åºä¸­çææåå®¹è¿½å å°æ° AOF æä»¶çæ«å°¾ï¼ä½¿å¾æ°æ§ä¸¤ä¸ª AOF æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ã\n * æåï¼æå¡å¨ç¨æ°ç AOF æä»¶æ¿æ¢å°±ç AOF æä»¶ï¼ä»¥æ­¤æ¥å®æ AOF éåæä½ã\n\n\n\nå¯ä»¥éè¿è®¾ç½® auto-aof-rewrite-percentage å auto-aof-rewrite-min-sizeï¼ä½¿å¾ Redis å¨æ»¡è¶³æ¡ä»¶æ¶ï¼èªå¨æ§è¡ BGREWRITEAOFã\n\nåè®¾éç½®å¦ä¸ï¼\n\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\nè¡¨æï¼å½ AOF å¤§äº 64MBï¼ä¸ AOF ä½ç§¯æ¯ä¸ä¸æ¬¡éååçä½ç§¯å¤§äºè³å° 100% æ¶ï¼æ§è¡ BGREWRITEAOFã\n\n\n# AOF çéç½®\n\nAOF çé»è®¤éç½®ï¼\n\nappendonly no\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\nAOF æä¹åéè¿å¨ redis.conf ä¸­ç appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\n * appendonly - å¼å¯ AOF åè½ã\n * appendfilename - AOF æä»¶åã\n * appendfsync - ç¨äºè®¾ç½®åæ­¥é¢çï¼å®æä»¥ä¸å¯éé¡¹ï¼\n   * always - æ¯ä¸ª Redis åå½ä»¤é½è¦åæ­¥åå¥ç¡¬çãè¿æ ·åä¼ä¸¥ééä½ Redis çéåº¦ã\n   * everysec - æ¯ç§æ§è¡ä¸æ¬¡åæ­¥ï¼æ¾ç¤ºå°å°å¤ä¸ªåå½ä»¤åæ­¥å°ç¡¬çãä¸ºäºå¼é¡¾æ°æ®å®å¨ååå¥æ§è½ï¼æ¨èä½¿ç¨ appendfsync everysec éé¡¹ãRedis æ¯ç§åæ­¥ä¸æ¬¡ AOF æä»¶æ¶çæ§è½åä¸ä½¿ç¨ä»»ä½æä¹åç¹æ§æ¶çæ§è½ç¸å·®æ å ã\n   * no - è®©æä½ç³»ç»æ¥å³å®åºè¯¥ä½æ¶è¿è¡åæ­¥ã\n * no-appendfsync-on-rewrite - AOF éåæ¶ä¸æ¯æè¿½å å½ä»¤ã\n * auto-aof-rewrite-percentage - AOF éåç¾åæ¯ã\n * auto-aof-rewrite-min-size - AOF éåæä»¶çæå°å¤§å°ã\n * dir - RDB æä»¶å AOF æä»¶çå­å¨è·¯å¾ã\n\n\n# ä¸ãRDB å AOF\n\n> å½ Redis å¯å¨æ¶ï¼ å¦æ RDB å AOF åè½é½å¼å¯äºï¼é£ä¹ç¨åºä¼ä¼åä½¿ç¨ AOF æä»¶æ¥æ¢å¤æ°æ®éï¼å ä¸º AOF æä»¶æä¿å­çæ°æ®éå¸¸æ¯æå®æ´çã\n\n\n# å¦ä½éæ©æä¹å\n\n * å¦æä¸å³å¿æ°æ®ä¸¢å¤±ï¼å¯ä»¥ä¸æä¹åã\n * å¦æå¯ä»¥æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ RDBã\n * å¦æä¸è½æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åæ¶ä½¿ç¨ RDB å AOFã\n\næå¾å¤ç¨æ·é½åªä½¿ç¨ AOF æä¹åï¼ ä½å¹¶ä¸æ¨èè¿ç§æ¹å¼ï¼ å ä¸ºå®æ¶çæ RDB å¿«ç§ï¼snapshotï¼éå¸¸ä¾¿äºè¿è¡æ°æ®åºå¤ä»½ï¼å¹¶ä¸å¿«ç§æ¢å¤æ°æ®éçéåº¦ä¹è¦æ¯ AOF æ¢å¤çéåº¦è¦å¿«ï¼é¤æ­¤ä¹å¤ï¼ä½¿ç¨å¿«ç§è¿å¯ä»¥é¿åä¹åæå°ç AOF ç¨åºç bug ã\n\n\n# RDB åæ¢ä¸º AOF\n\nå¨ Redis 2.2 æä»¥ä¸çæ¬ï¼å¯ä»¥å¨ä¸éå¯çæåµä¸ï¼ä» RDB åæ¢ä¸º AOF ï¼\n\n * ä¸ºææ°ç dump.rdb æä»¶åå»ºä¸ä¸ªå¤ä»½ã\n * å°å¤ä»½æ¾å°ä¸ä¸ªå®å¨çå°æ¹ã\n * æ§è¡ä»¥ä¸ä¸¤æ¡å½ä»¤:\n * redis-cli config set appendonly yes\n * redis-cli config set save\n * ç¡®ä¿åå½ä»¤ä¼è¢«æ­£ç¡®å°è¿½å å° AOF æä»¶çæ«å°¾ã\n * æ§è¡çç¬¬ä¸æ¡å½ä»¤å¼å¯äº AOF åè½ï¼ Redis ä¼é»å¡ç´å°åå§ AOF æä»¶åå»ºå®æä¸ºæ­¢ï¼ ä¹å Redis ä¼ç»§ç»­å¤çå½ä»¤è¯·æ±ï¼ å¹¶å¼å§å°åå¥å½ä»¤è¿½å å° AOF æä»¶æ«å°¾ã\n\næ§è¡çç¬¬äºæ¡å½ä»¤ç¨äºå³é­å¿«ç§åè½ã è¿ä¸æ­¥æ¯å¯éçï¼ å¦æä½ æ¿æçè¯ï¼ ä¹å¯ä»¥åæ¶ä½¿ç¨å¿«ç§å AOF è¿ä¸¤ç§æä¹ååè½ã\n\n> ð éè¦ï¼å«å¿äºå¨ redis.conf ä¸­æå¼ AOF åè½ï¼å¦åçè¯ï¼æå¡å¨éå¯ä¹åï¼ä¹åéè¿ CONFIG SET è®¾ç½®çéç½®å°±ä¼è¢«éå¿ï¼ç¨åºä¼æåæ¥çéç½®æ¥å¯å¨æå¡å¨ã\n\n\n# AOF å RDB çç¸äºä½ç¨\n\nBGSAVE å BGREWRITEAOF å½ä»¤ä¸å¯ä»¥åæ¶æ§è¡ãè¿æ¯ä¸ºäºé¿åä¸¤ä¸ª Redis åå°è¿ç¨åæ¶å¯¹ç£çè¿è¡å¤§éç I/O æä½ã\n\nå¦æ BGSAVE æ­£å¨æ§è¡ï¼å¹¶ä¸ç¨æ·æ¾ç¤ºå°è°ç¨ BGREWRITEAOF å½ä»¤ï¼é£ä¹æå¡å¨å°åç¨æ·åå¤ä¸ä¸ª OK ç¶æï¼å¹¶åç¥ç¨æ·ï¼BGREWRITEAOF å·²ç»è¢«é¢å®æ§è¡ãä¸æ¦ BGSAVE æ§è¡å®æ¯ï¼ BGREWRITEAOF å°±ä¼æ­£å¼å¼å§ã\n\n\n# åãRedis å¤ä»½\n\nåºè¯¥ç¡®ä¿ Redis æ°æ®æå®æ´çå¤ä»½ã\n\nå¤ä»½ Redis æ°æ®å»ºè®®éç¨ RDBã\n\n\n# å¤ä»½è¿ç¨\n\n 1. åå»ºä¸ä¸ªå®æä»»å¡ï¼cron jobï¼ï¼æ¯å°æ¶å°ä¸ä¸ª RDB æä»¶å¤ä»½å°ä¸ä¸ªæä»¶å¤¹ï¼å¹¶ä¸æ¯å¤©å°ä¸ä¸ª RDB æä»¶å¤ä»½å°å¦ä¸ä¸ªæä»¶å¤¹ã\n 2. ç¡®ä¿å¿«ç§çå¤ä»½é½å¸¦æç¸åºçæ¥æåæ¶é´ä¿¡æ¯ï¼æ¯æ¬¡æ§è¡å®æä»»å¡èæ¬æ¶ï¼ä½¿ç¨ find å½ä»¤æ¥å é¤è¿æçå¿«ç§ï¼æ¯å¦è¯´ï¼ä½ å¯ä»¥ä¿çæè¿ 48 å°æ¶åçæ¯å°æ¶å¿«ç§ï¼è¿å¯ä»¥ä¿çæè¿ä¸ä¸¤ä¸ªæçæ¯æ¥å¿«ç§ã\n 3. è³å°æ¯å¤©ä¸æ¬¡ï¼å° RDB å¤ä»½å°ä½ çæ°æ®ä¸­å¿ä¹å¤ï¼æèè³å°æ¯å¤ä»½å°ä½ è¿è¡ Redis æå¡å¨çç©çæºå¨ä¹å¤ã\n\n\n# å®¹ç¾å¤ä»½\n\nRedis çå®¹ç¾å¤ä»½åºæ¬ä¸å°±æ¯å¯¹æ°æ®è¿è¡å¤ä»½ï¼å¹¶å°è¿äºå¤ä»½ä¼ éå°å¤ä¸ªä¸åçå¤é¨æ°æ®ä¸­å¿ã\n\nå®¹ç¾å¤ä»½å¯ä»¥å¨ Redis è¿è¡å¹¶äº§çå¿«ç§çä¸»æ°æ®ä¸­å¿åçä¸¥éçé®é¢æ¶ï¼ä»ç¶è®©æ°æ®å¤äºå®å¨ç¶æã\n\n\n# äºãè¦ç¹æ»ç»\n\n\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè",normalizedContent:"# redis æä¹å\n\n> redis æ¯ææä¹åï¼å³ææ°æ®å­å¨å°ç¡¬çä¸­ã\n> \n> redis æä¾äºä¸¤ç§æä¹åæ¹å¼ï¼\n> \n>  * rdb å¿«ç§ï¼snapshotï¼ - å°å­å¨äºæä¸æ¶å»çæææ°æ®é½åå¥å°ç¡¬çä¸­ã\n>  * åªè¿½å æä»¶ï¼append-only fileï¼aofï¼ - å®ä¼å¨æ§è¡åå½ä»¤æ¶ï¼å°è¢«æ§è¡çåå½ä»¤å¤å¶å°ç¡¬çä¸­ã\n> \n> è¿ä¸¤ç§æä¹åæ¹å¼æ¢å¯ä»¥åæ¶ä½¿ç¨ï¼ä¹å¯ä»¥åç¬ä½¿ç¨ã\n> \n> å°åå­ä¸­çæ°æ®å­å¨å°ç¡¬ççä¸ä¸ªä¸»è¦åå æ¯ä¸ºäºå¨ä¹åéç¨æ°æ®ï¼æèæ¯ä¸ºäºé²æ­¢ç³»ç»æéèå°æ°æ®å¤ä»½å°ä¸ä¸ªè¿ç¨ä½ç½®ãå¦å¤ï¼å­å¨å¨ redis éé¢çæ°æ®æå¯è½æ¯ç»è¿é¿æ¶é´è®¡ç®å¾åºçï¼æèæç¨åºæ­£å¨ä½¿ç¨ redis å­å¨çæ°æ®è¿è¡è®¡ç®ï¼æä»¥ç¨æ·ä¼å¸æèªå·±å¯ä»¥å°è¿äºæ°æ®å­å¨èµ·æ¥ä»¥ä¾¿ä¹åä½¿ç¨ï¼è¿æ ·å°±ä¸å¿éæ°è®¡ç®äºã\n> \n> redis æä¾äºä¸¤ç§æä¹æ¹å¼ï¼rdb å aofãä½ å¯ä»¥åæ¶å¼å¯ä¸¤ç§æä¹åæ¹å¼ãå¨è¿ç§æåµä¸, å½ redis éå¯çæ¶åä¼ä¼åè½½å¥ aof æä»¶æ¥æ¢å¤åå§çæ°æ®ï¼å ä¸ºå¨éå¸¸æåµä¸ aof æä»¶ä¿å­çæ°æ®éè¦æ¯ rdb æä»¶ä¿å­çæ°æ®éè¦å®æ´ã\n\n\n# ä¸ãrdb\n\n\n# rdb ç®ä»\n\nrdb å³å¿«ç§æ¹å¼ï¼å®å°æä¸ªæ¶é´ç¹çææ redis æ°æ®ä¿å­å°ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼rdb æä»¶ï¼ä¸­ã\n\nåå»º rdb åï¼ç¨æ·å¯ä»¥å¯¹ rdb è¿è¡å¤ä»½ï¼å¯ä»¥å° rdb å¤å¶å°å¶ä»æå¡å¨ä»èåå»ºå·æç¸åæ°æ®çæå¡å¨å¯æ¬ï¼è¿å¯ä»¥å¨éå¯æå¡å¨æ¶ä½¿ç¨ãä¸å¥è¯æ¥è¯´ï¼rdb éåä½ä¸º å·å¤ã\n\nrdb æ¢å¯ä»¥æå¨æ§è¡ï¼ä¹å¯ä»¥æ ¹æ®æå¡å¨éç½®éé¡¹å®ææ§è¡ãè¯¥åè½å¯ä»¥å°æä¸ªæ¶é´ç¹çæ°æ®åºç¶æä¿å­å°ä¸ä¸ª rdb æä»¶ä¸­ã\n\n# rdb çä¼ç¹\n\n * rdb æä»¶éå¸¸ç´§åï¼éåä½ä¸ºå·å¤ãæ¯å¦ä½ å¯ä»¥å¨æ¯ä¸ªå°æ¶æ¥ä¿å­ä¸ä¸è¿å» 24 å°æ¶åçæ°æ®ï¼åæ¶æ¯å¤©ä¿å­è¿å» 30 å¤©çæ°æ®ï¼è¿æ ·å³ä½¿åºäºé®é¢ä½ ä¹å¯ä»¥æ ¹æ®éæ±æ¢å¤å°ä¸åçæ¬çæ°æ®éã\n * å¿«ç§å¨ä¿å­ rdb æä»¶æ¶ç¶è¿ç¨å¯ä¸éè¦åçå°±æ¯ fork åºä¸ä¸ªå­è¿ç¨ï¼æ¥ä¸æ¥çå·¥ä½å¨é¨ç±å­è¿ç¨æ¥åï¼ç¶è¿ç¨ä¸éè¦ååå¶ä» io æä½ï¼æä»¥å¿«ç§æä¹åæ¹å¼å¯ä»¥æå¤§å redis çæ§è½ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼rdb æ¯ aof æ´å¿«ã\n\n# rdb çç¼ºç¹\n\n * å¦æç³»ç»åçæéï¼å°ä¼ä¸¢å¤±æåä¸æ¬¡åå»ºå¿«ç§ä¹åçæ°æ®ãå¦æä½ å¸æå¨ redis æå¤åæ­¢å·¥ä½ï¼ä¾å¦çµæºä¸­æ­ï¼çæåµä¸ä¸¢å¤±çæ°æ®æå°çè¯ï¼é£ä¹ å¿«ç§ä¸éåä½ ãè½ç¶ä½ å¯ä»¥éç½®ä¸åç save æ¶é´ç¹(ä¾å¦æ¯é 5 åéå¹¶ä¸å¯¹æ°æ®éæ 100 ä¸ªåçæä½)ï¼æ¯ redis è¦å®æ´çä¿å­æ´ä¸ªæ°æ®éæ¯ä¸ä¸ªæ¯è¾ç¹éçå·¥ä½ï¼ä½ éå¸¸ä¼æ¯é 5 åéæèæ´ä¹åä¸æ¬¡å®æ´çä¿å­ï¼ä¸ä¸å¨ redis æå¤å®æºï¼ä½ å¯è½ä¼ä¸¢å¤±å åéçæ°æ®ã\n * å¦ææ°æ®éå¾å¤§ï¼ä¿å­å¿«ç§çæ¶é´ä¼å¾é¿ãå¿«ç§éè¦ç»å¸¸ fork å­è¿ç¨æ¥ä¿å­æ°æ®éå°ç¡¬çä¸ãå½æ°æ®éæ¯è¾å¤§çæ¶åï¼fork çè¿ç¨æ¯éå¸¸èæ¶çï¼å¯è½ä¼å¯¼è´ redis å¨ä¸äºæ¯«ç§çº§åä¸è½ååºå®¢æ·ç«¯çè¯·æ±ãå¦ææ°æ®éå·¨å¤§å¹¶ä¸ cpu æ§è½ä¸æ¯å¾å¥½çæåµä¸ï¼è¿ç§æåµä¼æç»­ 1 ç§ãaof ä¹éè¦ forkï¼ä½æ¯ä½ å¯ä»¥è°èéåæ¥å¿æä»¶çé¢çæ¥æé«æ°æ®éçèä¹åº¦ã\n\n\n# rdb çåå»º\n\næä¸¤ä¸ª redis å½ä»¤å¯ä»¥ç¨äºçæ rdb æä»¶ï¼save å bgsaveã\n\n * save å½ä»¤ä¼é»å¡ redis æå¡å¨è¿ç¨ï¼ç´å° rdb åå»ºå®æä¸ºæ­¢ï¼å¨é»å¡æé´ï¼æå¡å¨ä¸è½ååºä»»ä½å½ä»¤è¯·æ±ã\n * bgsave å½ä»¤ä¼æ´¾çåºï¼forkï¼ä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£åå»º rdb æä»¶ï¼æå¡å¨è¿ç¨ï¼ç¶è¿ç¨ï¼ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n> ð æ³¨æï¼bgsave å½ä»¤æ§è¡æé´ï¼saveãbgsaveãbgrewriteaof ä¸ä¸ªå½ä»¤ä¼è¢«æç»ï¼ä»¥åä¸å½åç bgsave æä½äº§çç«ææ¡ä»¶ï¼éä½æ§è½ã\n\n# èªå¨é´éä¿å­\n\nredis åè®¸ç¨æ·éè¿è®¾ç½®æå¡å¨éç½®ç save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ bgsave å½ä»¤ã\n\nç¨æ·å¯ä»¥éè¿ save éé¡¹è®¾ç½®å¤ä¸ªä¿å­æ¡ä»¶ï¼ä½åªè¦å¶ä¸­ä»»æä¸ä¸ªæ¡ä»¶è¢«æ»¡è¶³ï¼æå¡å¨å°±ä¼æ§è¡ bgsave å½ä»¤ã\n\nä¸¾ä¾æ¥è¯´ï¼redis.conf ä¸­è®¾ç½®äºå¦ä¸éç½®ï¼\n\nsave 900 1       -- 900 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 1 æ¬¡ä¿®æ¹\nsave 300 10      -- 300 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10 æ¬¡ä¿®æ¹\nsave 60 10000    -- 60 ç§åï¼è³å°å¯¹æ°æ®åºè¿è¡äº 10000 æ¬¡ä¿®æ¹\n\n\nåªè¦æ»¡è¶³ä»¥ä¸ä»»ææ¡ä»¶ï¼redis æå¡å°±ä¼æ§è¡ bgsave å½ä»¤ã\n\n\n# rdb çè½½å¥\n\nrdb æä»¶çè½½å¥å·¥ä½æ¯å¨æå¡å¨å¯å¨æ¶èªå¨æ§è¡çï¼redis å¹¶æ²¡æä¸é¨ç¨äºè½½å¥ rdb æä»¶çå½ä»¤ã\n\næå¡å¨è½½å¥ rdb æä»¶æé´ï¼ä¼ä¸ç´å¤äºé»å¡ç¶æï¼ç´å°è½½å¥å®æä¸ºæ­¢ã\n\n> ð æ³¨æï¼å ä¸º aof éå¸¸æ´æ°é¢çæ¯ rdb é«ï¼æä»¥ä¸¢å¤±æ°æ®ç¸å¯¹æ´å°ãåºäºè¿ä¸ªåå ï¼redis æä»¥ä¸é»è®¤è¡ä¸ºï¼\n> \n>  * åªæå¨å³é­ aof åè½çæåµä¸ï¼æä¼ä½¿ç¨ rdb è¿åæ°æ®ï¼å¦åä¼åä½¿ç¨ aof æä»¶æ¥è¿åæ°æ®ã\n\n\n# rdb çæä»¶ç»æ\n\nrdb æä»¶æ¯ä¸ä¸ªç»è¿åç¼©çäºè¿å¶æä»¶ï¼ç±å¤ä¸ªé¨åç»æã\n\nå¯¹äºä¸åç±»åï¼stringãhashãlistãsetãsorted setï¼çé®å¼å¯¹ï¼rdb æä»¶ä¼ä½¿ç¨ä¸åçæ¹å¼æ¥ä¿å­å®ä»¬ã\n\n\n\nredis æ¬èº«æä¾äºä¸ä¸ª rdb æä»¶æ£æ¥å·¥å· redis-check-dumpã\n\n\n# rdb çéç½®\n\nredis rdb é»è®¤éç½®å¦ä¸ï¼\n\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\n\n\nredis çéç½®æä»¶ redis.conf ä¸­ä¸ rdb æå³çéé¡¹ï¼\n\n * save - redis ä¼æ ¹æ® save éé¡¹ï¼è®©æå¡å¨æ¯éä¸æ®µæ¶é´èªå¨æ§è¡ä¸æ¬¡ bgsave å½ä»¤ã\n\n * stop-writes-on-bgsave-error - å½ bgsave å½ä»¤åºç°éè¯¯æ¶åæ­¢å rdb æä»¶\n\n * rdbcompression - rdb æä»¶å¼å¯åç¼©åè½ã\n\n * rdbchecksum - å¯¹ rdb æä»¶è¿è¡æ ¡éªã\n\n * dbfilename - rdb æä»¶åã\n\n * dir - rdb æä»¶å aof æä»¶çå­å¨è·¯å¾ã\n\n\n# äºãaof\n\n\n# aof ç®ä»\n\naof(append only file) æ¯ä»¥ ææ¬æ¥å¿å½¢å¼ å° ææåå½ä»¤ä»¥ redis å½ä»¤è¯·æ±åè®®æ ¼å¼è¿½å å° aof æä»¶çæ«å°¾ï¼ä»¥æ­¤æ¥è®°å½æ°æ®çååãå½æå¡å¨éå¯æ¶ï¼ä¼éæ°è½½å¥åæ§è¡ aof æä»¶ä¸­çå½ä»¤ï¼å°±å¯ä»¥æ¢å¤åå§çæ°æ®ãaof éåä½ä¸º ç­å¤ã\n\naof å¯ä»¥éè¿ appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\nå½ä»¤è¯·æ±ä¼åä¿å­å° aof ç¼å²åºä¸­ï¼ä¹ååå®æåå¥å¹¶åæ­¥å° aof æä»¶ã\n\n# aof çä¼ç¹\n\n * å¦æç³»ç»åçæéï¼aof ä¸¢å¤±æ°æ®æ¯ rdb å°ãä½ å¯ä»¥ä½¿ç¨ä¸åç fsync ç­ç¥ï¼æ  fsyncï¼æ¯ç§ fsyncï¼æ¯æ¬¡åçæ¶å fsyncãä½¿ç¨é»è®¤çæ¯ç§ fsync ç­ç¥ï¼redis çæ§è½ä¾ç¶å¾å¥½(fsync æ¯ç±åå°çº¿ç¨è¿è¡å¤çç,ä¸»çº¿ç¨ä¼å°½åå¤çå®¢æ·ç«¯è¯·æ±)ï¼ä¸æ¦åºç°æéï¼ä½ æå¤ä¸¢å¤± 1 ç§çæ°æ®ã\n * aof æä»¶å¯ä¿®å¤ - aof æä»¶æ¯ä¸ä¸ªåªè¿è¡è¿½å çæ¥å¿æä»¶ï¼æä»¥ä¸éè¦åå¥ seekï¼å³ä½¿ç±äºæäºåå (ç£çç©ºé´å·²æ»¡ï¼åçè¿ç¨ä¸­å®æºç­ç­)æªæ§è¡å®æ´çåå¥å½ä»¤ï¼ä½ ä¹ä¹å¯ä½¿ç¨ redis-check-aof å·¥å·ä¿®å¤è¿äºé®é¢ã\n * aof æä»¶å¯åç¼©ãredis å¯ä»¥å¨ aof æä»¶ä½ç§¯åå¾è¿å¤§æ¶ï¼èªå¨å°å¨åå°å¯¹ aof è¿è¡éåï¼éååçæ° aof æä»¶åå«äºæ¢å¤å½åæ°æ®éæéçæå°å½ä»¤éåãæ´ä¸ªéåæä½æ¯ç»å¯¹å®å¨çï¼å ä¸º redis å¨åå»ºæ° aof æä»¶çè¿ç¨ä¸­ï¼ä¼ç»§ç»­å°å½ä»¤è¿½å å°ç°æç aof æä»¶éé¢ï¼å³ä½¿éåè¿ç¨ä¸­åçåæºï¼ç°æç aof æä»¶ä¹ä¸ä¼ä¸¢å¤±ãèä¸æ¦æ° aof æä»¶åå»ºå®æ¯ï¼redis å°±ä¼ä»æ§ aof æä»¶åæ¢å°æ° aof æä»¶ï¼å¹¶å¼å§å¯¹æ° aof æä»¶è¿è¡è¿½å æä½ã\n * aof æä»¶å¯è¯» - aof æä»¶æåºå°ä¿å­äºå¯¹æ°æ®åºæ§è¡çææåå¥æä½ï¼è¿äºåå¥æä½ä»¥ redis å½ä»¤çæ ¼å¼ä¿å­ãå æ­¤ aof æä»¶çåå®¹éå¸¸å®¹æè¢«äººè¯»æï¼å¯¹æä»¶è¿è¡åæï¼parseï¼ä¹å¾è½»æ¾ã å¯¼åºï¼exportï¼ aof æä»¶ä¹éå¸¸ç®åãä¸¾ä¸ªä¾å­ï¼å¦æä½ ä¸å°å¿æ§è¡äº flushall å½ä»¤ï¼ä½åªè¦ aof æä»¶æªè¢«éåï¼é£ä¹åªè¦åæ­¢æå¡å¨ï¼ç§»é¤ aof æä»¶æ«å°¾ç flushall å½ä»¤ï¼å¹¶éå¯ redis ï¼å°±å¯ä»¥å°æ°æ®éæ¢å¤å° flushall æ§è¡ä¹åçç¶æã\n\n# aof çç¼ºç¹\n\n * aof æä»¶ä½ç§¯ä¸è¬æ¯ rdb å¤§ - å¯¹äºç¸åçæ°æ®éæ¥è¯´ï¼aof æä»¶çä½ç§¯éå¸¸è¦å¤§äº rdb æä»¶çä½ç§¯ã\n * æ¢å¤å¤§æ°æ®éæ¶ï¼aof æ¯ rdb æ¢ã - æ ¹æ®æä½¿ç¨ç fsync ç­ç¥ï¼aof çéåº¦å¯è½ä¼æ¢äºå¿«ç§ãå¨ä¸è¬æåµä¸ï¼æ¯ç§ fsync çæ§è½ä¾ç¶éå¸¸é«ï¼èå³é­ fsync å¯ä»¥è®© aof çéåº¦åå¿«ç§ä¸æ ·å¿«ï¼å³ä½¿å¨é«è´è·ä¹ä¸ä¹æ¯å¦æ­¤ãä¸è¿å¨å¤çå·¨å¤§çåå¥è½½å¥æ¶ï¼å¿«ç§å¯ä»¥æä¾æ´æä¿è¯çæå¤§å»¶è¿æ¶é´ï¼latencyï¼ã\n\n\n# aof çåå»º\n\nredis å½ä»¤è¯·æ±ä¼åä¿å­å° aof ç¼å²åºï¼åå®æåå¥å¹¶åæ­¥å° aof æä»¶ã\n\naof çå®ç°å¯ä»¥åä¸ºå½ä»¤è¿½å ï¼appendï¼ãæä»¶åå¥ãæä»¶åæ­¥ï¼syncï¼ä¸ä¸ªæ­¥éª¤ã\n\n * å½ä»¤è¿½å  - å½ redis æå¡å¨å¼å¯ aof åè½æ¶ï¼æå¡å¨å¨æ§è¡å®ä¸ä¸ªåå½ä»¤åï¼ä¼ä»¥ redis å½ä»¤åè®®æ ¼å¼å°è¢«æ§è¡çåå½ä»¤è¿½å å° aof ç¼å²åºçæ«å°¾ã\n * æä»¶åå¥åæä»¶åæ­¥ - redis çæå¡å¨è¿ç¨å°±æ¯ä¸ä¸ªäºä»¶å¾ªç¯ï¼è¿ä¸ªå¾ªç¯ä¸­çæä»¶äºä»¶è´è´£æ¥æ¶å®¢æ·ç«¯çå½ä»¤è¯·æ±ï¼ä»¥ååå®¢æ·ç«¯åéå½ä»¤åå¤ãèæ¶é´äºä»¶åè´è´£æ§è¡å®æ¶è¿è¡çå½æ°ãå ä¸ºæå¡å¨å¨å¤çæä»¶äºä»¶æ¶å¯è½ä¼æ§è¡åå½ä»¤ï¼è¿äºåå½ä»¤ä¼è¢«è¿½å å° aof ç¼å²åºï¼æå¡å¨æ¯æ¬¡ç»æäºä»¶å¾ªç¯åï¼é½ä¼æ ¹æ® appendfsync éé¡¹æ¥å¤æ­ aof ç¼å²åºåå®¹æ¯å¦éè¦åå¥ååæ­¥å° aof æä»¶ä¸­ã\n\nappendfsync ä¸åéé¡¹å³å®äºä¸åçæä¹åè¡ä¸ºï¼\n\n * always - å°ç¼å²åºææåå®¹åå¥å¹¶åæ­¥å° aof æä»¶ã\n * everysec - å°ç¼å²åºææåå®¹åå¥å° aof æä»¶ï¼å¦æä¸æ¬¡åæ­¥ aof æä»¶çæ¶é´è·ç¦»ç°å¨è¶è¿ä¸ç§éï¼é£ä¹åæ¬¡å¯¹ aof æä»¶è¿è¡åæ­¥ï¼è¿ä¸ªåæ­¥æä½æ¯æä¸ä¸ªçº¿ç¨ä¸é¨è´è´£æ§è¡çã\n * no - å°ç¼å²åºææåå®¹åå¥å° aof æä»¶ï¼ä½å¹¶ä¸å¯¹ aof æä»¶è¿è¡åæ­¥ï¼ä½æ¶åæ­¥ç±æä½ç³»ç»å³å®ã\n\n\n# aof çè½½å¥\n\nå ä¸º aof æä»¶ä¸­åå«äºéå»ºæ°æ®åºæéçææåå½ä»¤ï¼æä»¥æå¡å¨åªè¦è½½å¥å¹¶æ§è¡ä¸é aof æä»¶ä¸­ä¿å­çåå½ä»¤ï¼å°±å¯ä»¥è¿åæå¡å¨å³é­åçæ°æ®åºç¶æã\n\naof è½½å¥è¿ç¨å¦ä¸ï¼\n\n 1. æå¡å¨å¯å¨è½½å¥ç¨åºã\n 2. åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯ãå ä¸º redis å½ä»¤åªè½å¨å®¢æ·ç«¯ä¸ä¸æä¸­æ§è¡ï¼æä»¥éè¦åå»ºä¸ä¸ªä¼ªå®¢æ·ç«¯æ¥è½½å¥ãæ§è¡ aof æä»¶ä¸­è®°å½çå½ä»¤ã\n 3. ä» aof æä»¶ä¸­åæå¹¶è¯»åä¸æ¡åå½ä»¤ã\n 4. ä½¿ç¨ä¼ªå®¢æ·ç«¯æ§è¡åå½ä»¤ã\n 5. å¾ªç¯æ§è¡æ­¥éª¤ 3ã4ï¼ç´å°ææåå½ä»¤é½è¢«å¤çå®æ¯ä¸ºæ­¢ã\n 6. è½½å¥å®æ¯ã\n\n\n\n\n# aof çéå\n\néç redis ä¸æ­è¿è¡ï¼aof çä½ç§¯ä¹ä¼ä¸æ­å¢é¿ï¼è¿å°å¯¼è´ä¸¤ä¸ªé®é¢ï¼\n\n * aof èå°½ç£çå¯ç¨ç©ºé´ã\n * redis éå¯åéè¦æ§è¡ aof æä»¶è®°å½çææåå½ä»¤æ¥è¿åæ°æ®éï¼å¦æ aof è¿å¤§ï¼åè¿åæä½æ§è¡çæ¶é´å°±ä¼éå¸¸é¿ã\n\nä¸ºäºè§£å³ aof ä½ç§¯è¨èé®é¢ï¼redis æä¾äº aof éååè½ï¼æ¥å¯¹ aof æä»¶è¿è¡åç¼©ãaof éåå¯ä»¥äº§çä¸ä¸ªæ°ç aof æä»¶ï¼è¿ä¸ªæ°ç aof æä»¶ååæ¥ç aof æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ï¼ä½ä½ç§¯æ´å°ã\n\naof éåå¹¶éè¯»åååæç°æ aof æä»¶çåå®¹ï¼èæ¯ç´æ¥ä»æ°æ®åºä¸­è¯»åå½åçæ°æ®åºç¶æãå³ä¾æ¬¡è¯»åæ°æ®åºä¸­çæ¯ä¸ªé®å¼å¯¹ï¼ç¶åç¨ä¸æ¡å½ä»¤å»è®°å½è¯¥é®å¼å¯¹ï¼ä»¥æ­¤ä»£æ¿ä¹åå¯è½å­å¨åä½çå½ä»¤ã\n\n# aof åå°éå\n\nä½ä¸ºä¸ç§è¾å©æ§åè½ï¼æ¾ç¶ redis å¹¶ä¸æ³å¨ aof éåæ¶é»å¡ redis æå¡æ¥æ¶å¶ä»å½ä»¤ãå æ­¤ï¼redis å³å®éè¿ bgrewriteaof å½ä»¤åå»ºä¸ä¸ªå­è¿ç¨ï¼ç¶åç±å­è¿ç¨è´è´£å¯¹ aof æä»¶è¿è¡éåï¼è¿ä¸ bgsave åçç±»ä¼¼ã\n\n * å¨æ§è¡ bgrewriteaof å½ä»¤æ¶ï¼redis æå¡å¨ä¼ç»´æ¤ä¸ä¸ª aof éåç¼å²åºãå½ aof éåå­è¿ç¨å¼å§å·¥ä½åï¼redis æ¯æ§è¡å®ä¸ä¸ªåå½ä»¤ï¼ä¼åæ¶å°è¿ä¸ªå½ä»¤åéç» aof ç¼å²åºå aof éåç¼å²åºã\n * ç±äºå½¼æ­¤ä¸æ¯å¨åä¸ä¸ªè¿ç¨ä¸­å·¥ä½ï¼aof éåä¸å½±å aof åå¥ååæ­¥ãå½å­è¿ç¨å®æåå»ºæ° aof æä»¶çå·¥ä½ä¹åï¼æå¡å¨ä¼å°éåç¼å²åºä¸­çææåå®¹è¿½å å°æ° aof æä»¶çæ«å°¾ï¼ä½¿å¾æ°æ§ä¸¤ä¸ª aof æä»¶æä¿å­çæ°æ®åºç¶æä¸è´ã\n * æåï¼æå¡å¨ç¨æ°ç aof æä»¶æ¿æ¢å°±ç aof æä»¶ï¼ä»¥æ­¤æ¥å®æ aof éåæä½ã\n\n\n\nå¯ä»¥éè¿è®¾ç½® auto-aof-rewrite-percentage å auto-aof-rewrite-min-sizeï¼ä½¿å¾ redis å¨æ»¡è¶³æ¡ä»¶æ¶ï¼èªå¨æ§è¡ bgrewriteaofã\n\nåè®¾éç½®å¦ä¸ï¼\n\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\nè¡¨æï¼å½ aof å¤§äº 64mbï¼ä¸ aof ä½ç§¯æ¯ä¸ä¸æ¬¡éååçä½ç§¯å¤§äºè³å° 100% æ¶ï¼æ§è¡ bgrewriteaofã\n\n\n# aof çéç½®\n\naof çé»è®¤éç½®ï¼\n\nappendonly no\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\n\n\naof æä¹åéè¿å¨ redis.conf ä¸­ç appendonly yes éç½®éé¡¹æ¥å¼å¯ã\n\n * appendonly - å¼å¯ aof åè½ã\n * appendfilename - aof æä»¶åã\n * appendfsync - ç¨äºè®¾ç½®åæ­¥é¢çï¼å®æä»¥ä¸å¯éé¡¹ï¼\n   * always - æ¯ä¸ª redis åå½ä»¤é½è¦åæ­¥åå¥ç¡¬çãè¿æ ·åä¼ä¸¥ééä½ redis çéåº¦ã\n   * everysec - æ¯ç§æ§è¡ä¸æ¬¡åæ­¥ï¼æ¾ç¤ºå°å°å¤ä¸ªåå½ä»¤åæ­¥å°ç¡¬çãä¸ºäºå¼é¡¾æ°æ®å®å¨ååå¥æ§è½ï¼æ¨èä½¿ç¨ appendfsync everysec éé¡¹ãredis æ¯ç§åæ­¥ä¸æ¬¡ aof æä»¶æ¶çæ§è½åä¸ä½¿ç¨ä»»ä½æä¹åç¹æ§æ¶çæ§è½ç¸å·®æ å ã\n   * no - è®©æä½ç³»ç»æ¥å³å®åºè¯¥ä½æ¶è¿è¡åæ­¥ã\n * no-appendfsync-on-rewrite - aof éåæ¶ä¸æ¯æè¿½å å½ä»¤ã\n * auto-aof-rewrite-percentage - aof éåç¾åæ¯ã\n * auto-aof-rewrite-min-size - aof éåæä»¶çæå°å¤§å°ã\n * dir - rdb æä»¶å aof æä»¶çå­å¨è·¯å¾ã\n\n\n# ä¸ãrdb å aof\n\n> å½ redis å¯å¨æ¶ï¼ å¦æ rdb å aof åè½é½å¼å¯äºï¼é£ä¹ç¨åºä¼ä¼åä½¿ç¨ aof æä»¶æ¥æ¢å¤æ°æ®éï¼å ä¸º aof æä»¶æä¿å­çæ°æ®éå¸¸æ¯æå®æ´çã\n\n\n# å¦ä½éæ©æä¹å\n\n * å¦æä¸å³å¿æ°æ®ä¸¢å¤±ï¼å¯ä»¥ä¸æä¹åã\n * å¦æå¯ä»¥æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åªä½¿ç¨ rdbã\n * å¦æä¸è½æ¿åæ°åéä»¥åçæ°æ®ä¸¢å¤±ï¼å¯ä»¥åæ¶ä½¿ç¨ rdb å aofã\n\næå¾å¤ç¨æ·é½åªä½¿ç¨ aof æä¹åï¼ ä½å¹¶ä¸æ¨èè¿ç§æ¹å¼ï¼ å ä¸ºå®æ¶çæ rdb å¿«ç§ï¼snapshotï¼éå¸¸ä¾¿äºè¿è¡æ°æ®åºå¤ä»½ï¼å¹¶ä¸å¿«ç§æ¢å¤æ°æ®éçéåº¦ä¹è¦æ¯ aof æ¢å¤çéåº¦è¦å¿«ï¼é¤æ­¤ä¹å¤ï¼ä½¿ç¨å¿«ç§è¿å¯ä»¥é¿åä¹åæå°ç aof ç¨åºç bug ã\n\n\n# rdb åæ¢ä¸º aof\n\nå¨ redis 2.2 æä»¥ä¸çæ¬ï¼å¯ä»¥å¨ä¸éå¯çæåµä¸ï¼ä» rdb åæ¢ä¸º aof ï¼\n\n * ä¸ºææ°ç dump.rdb æä»¶åå»ºä¸ä¸ªå¤ä»½ã\n * å°å¤ä»½æ¾å°ä¸ä¸ªå®å¨çå°æ¹ã\n * æ§è¡ä»¥ä¸ä¸¤æ¡å½ä»¤:\n * redis-cli config set appendonly yes\n * redis-cli config set save\n * ç¡®ä¿åå½ä»¤ä¼è¢«æ­£ç¡®å°è¿½å å° aof æä»¶çæ«å°¾ã\n * æ§è¡çç¬¬ä¸æ¡å½ä»¤å¼å¯äº aof åè½ï¼ redis ä¼é»å¡ç´å°åå§ aof æä»¶åå»ºå®æä¸ºæ­¢ï¼ ä¹å redis ä¼ç»§ç»­å¤çå½ä»¤è¯·æ±ï¼ å¹¶å¼å§å°åå¥å½ä»¤è¿½å å° aof æä»¶æ«å°¾ã\n\næ§è¡çç¬¬äºæ¡å½ä»¤ç¨äºå³é­å¿«ç§åè½ã è¿ä¸æ­¥æ¯å¯éçï¼ å¦æä½ æ¿æçè¯ï¼ ä¹å¯ä»¥åæ¶ä½¿ç¨å¿«ç§å aof è¿ä¸¤ç§æä¹ååè½ã\n\n> ð éè¦ï¼å«å¿äºå¨ redis.conf ä¸­æå¼ aof åè½ï¼å¦åçè¯ï¼æå¡å¨éå¯ä¹åï¼ä¹åéè¿ config set è®¾ç½®çéç½®å°±ä¼è¢«éå¿ï¼ç¨åºä¼æåæ¥çéç½®æ¥å¯å¨æå¡å¨ã\n\n\n# aof å rdb çç¸äºä½ç¨\n\nbgsave å bgrewriteaof å½ä»¤ä¸å¯ä»¥åæ¶æ§è¡ãè¿æ¯ä¸ºäºé¿åä¸¤ä¸ª redis åå°è¿ç¨åæ¶å¯¹ç£çè¿è¡å¤§éç i/o æä½ã\n\nå¦æ bgsave æ­£å¨æ§è¡ï¼å¹¶ä¸ç¨æ·æ¾ç¤ºå°è°ç¨ bgrewriteaof å½ä»¤ï¼é£ä¹æå¡å¨å°åç¨æ·åå¤ä¸ä¸ª ok ç¶æï¼å¹¶åç¥ç¨æ·ï¼bgrewriteaof å·²ç»è¢«é¢å®æ§è¡ãä¸æ¦ bgsave æ§è¡å®æ¯ï¼ bgrewriteaof å°±ä¼æ­£å¼å¼å§ã\n\n\n# åãredis å¤ä»½\n\nåºè¯¥ç¡®ä¿ redis æ°æ®æå®æ´çå¤ä»½ã\n\nå¤ä»½ redis æ°æ®å»ºè®®éç¨ rdbã\n\n\n# å¤ä»½è¿ç¨\n\n 1. åå»ºä¸ä¸ªå®æä»»å¡ï¼cron jobï¼ï¼æ¯å°æ¶å°ä¸ä¸ª rdb æä»¶å¤ä»½å°ä¸ä¸ªæä»¶å¤¹ï¼å¹¶ä¸æ¯å¤©å°ä¸ä¸ª rdb æä»¶å¤ä»½å°å¦ä¸ä¸ªæä»¶å¤¹ã\n 2. ç¡®ä¿å¿«ç§çå¤ä»½é½å¸¦æç¸åºçæ¥æåæ¶é´ä¿¡æ¯ï¼æ¯æ¬¡æ§è¡å®æä»»å¡èæ¬æ¶ï¼ä½¿ç¨ find å½ä»¤æ¥å é¤è¿æçå¿«ç§ï¼æ¯å¦è¯´ï¼ä½ å¯ä»¥ä¿çæè¿ 48 å°æ¶åçæ¯å°æ¶å¿«ç§ï¼è¿å¯ä»¥ä¿çæè¿ä¸ä¸¤ä¸ªæçæ¯æ¥å¿«ç§ã\n 3. è³å°æ¯å¤©ä¸æ¬¡ï¼å° rdb å¤ä»½å°ä½ çæ°æ®ä¸­å¿ä¹å¤ï¼æèè³å°æ¯å¤ä»½å°ä½ è¿è¡ redis æå¡å¨çç©çæºå¨ä¹å¤ã\n\n\n# å®¹ç¾å¤ä»½\n\nredis çå®¹ç¾å¤ä»½åºæ¬ä¸å°±æ¯å¯¹æ°æ®è¿è¡å¤ä»½ï¼å¹¶å°è¿äºå¤ä»½ä¼ éå°å¤ä¸ªä¸åçå¤é¨æ°æ®ä¸­å¿ã\n\nå®¹ç¾å¤ä»½å¯ä»¥å¨ redis è¿è¡å¹¶äº§çå¿«ç§çä¸»æ°æ®ä¸­å¿åçä¸¥éçé®é¢æ¶ï¼ä»ç¶è®©æ°æ®å¤äºå®å¨ç¶æã\n\n\n# äºãè¦ç¹æ»ç»\n\n\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis å¤å¶",frontmatter:{title:"Redis å¤å¶",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","å¤å¶"],permalink:"/pages/0de16b/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/05.Redis%E5%A4%8D%E5%88%B6.html",relativePath:"05.KVæ°æ®åº/01.Redis/05.Rediså¤å¶.md",key:"v-0dcd3e72",path:"/pages/0de16b/",headers:[{level:2,title:"ä¸ãå¤å¶ç®ä»",slug:"ä¸ãå¤å¶ç®ä»",normalizedTitle:"ä¸ãå¤å¶ç®ä»",charIndex:190},{level:2,title:"äºãæ§çå¤å¶",slug:"äºãæ§çå¤å¶",normalizedTitle:"äºãæ§çå¤å¶",charIndex:698},{level:3,title:"åæ­¥",slug:"åæ­¥",normalizedTitle:"åæ­¥",charIndex:172},{level:3,title:"å½ä»¤ä¼ æ­",slug:"å½ä»¤ä¼ æ­",normalizedTitle:"å½ä»¤ä¼ æ­",charIndex:758},{level:3,title:"æ§çå¤å¶çç¼ºé·",slug:"æ§çå¤å¶çç¼ºé·",normalizedTitle:"æ§çå¤å¶çç¼ºé·",charIndex:1265},{level:2,title:"ä¸ãæ°çå¤å¶",slug:"ä¸ãæ°çå¤å¶",normalizedTitle:"ä¸ãæ°çå¤å¶",charIndex:1650},{level:3,title:"é¨åéåæ­¥",slug:"é¨åéåæ­¥",normalizedTitle:"é¨åéåæ­¥",charIndex:169},{level:4,title:"å¤å¶åç§»é",slug:"å¤å¶åç§»é",normalizedTitle:"å¤å¶åç§»é",charIndex:1954},{level:4,title:"å¤å¶ç§¯åç¼å²åº",slug:"å¤å¶ç§¯åç¼å²åº",normalizedTitle:"å¤å¶ç§¯åç¼å²åº",charIndex:1988},{level:4,title:"æå¡å¨çè¿è¡ ID",slug:"æå¡å¨çè¿è¡-id",normalizedTitle:"æå¡å¨çè¿è¡ id",charIndex:2020},{level:3,title:"PSYNC å½ä»¤",slug:"psync-å½ä»¤",normalizedTitle:"psync å½ä»¤",charIndex:1684},{level:2,title:"åãå¿è·³æ£æµ",slug:"åãå¿è·³æ£æµ",normalizedTitle:"åãå¿è·³æ£æµ",charIndex:3306},{level:3,title:"æ£æµä¸»ä»è¿æ¥ç¶æ",slug:"æ£æµä¸»ä»è¿æ¥ç¶æ",normalizedTitle:"æ£æµä¸»ä»è¿æ¥ç¶æ",charIndex:3514},{level:3,title:"è¾å©å®ç° min-slaves éé¡¹",slug:"è¾å©å®ç°-min-slaves-éé¡¹",normalizedTitle:"è¾å©å®ç° min-slaves éé¡¹",charIndex:3479},{level:3,title:"æ£æµå½ä»¤ä¸¢å¤±",slug:"æ£æµå½ä»¤ä¸¢å¤±",normalizedTitle:"æ£æµå½ä»¤ä¸¢å¤±",charIndex:3502},{level:2,title:"äºãå¤å¶çæµç¨",slug:"äºãå¤å¶çæµç¨",normalizedTitle:"äºãå¤å¶çæµç¨",charIndex:4112},{level:3,title:"æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨",slug:"æ­¥éª¤-1-è®¾ç½®ä¸»ä»æå¡å¨",normalizedTitle:"æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨",charIndex:4204},{level:3,title:"æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã",slug:"æ­¥éª¤-2-ä¸»ä»æå¡å¨å»ºç«-tcp-è¿æ¥ã",normalizedTitle:"æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« tcp è¿æ¥ã",charIndex:4439},{level:3,title:"æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã",slug:"æ­¥éª¤-3-åé-ping-æ£æ¥éä¿¡ç¶æã",normalizedTitle:"æ­¥éª¤ 3. åé ping æ£æ¥éä¿¡ç¶æã",charIndex:4465},{level:3,title:"æ­¥éª¤ 4. èº«ä»½éªè¯ã",slug:"æ­¥éª¤-4-èº«ä»½éªè¯ã",normalizedTitle:"æ­¥éª¤ 4. èº«ä»½éªè¯ã",charIndex:4491},{level:3,title:"æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã",slug:"æ­¥éª¤-5-åéç«¯å£ä¿¡æ¯ã",normalizedTitle:"æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã",charIndex:4868},{level:3,title:"æ­¥éª¤ 6. åæ­¥ã",slug:"æ­¥éª¤-6-åæ­¥ã",normalizedTitle:"æ­¥éª¤ 6. åæ­¥ã",charIndex:4952},{level:3,title:"æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã",slug:"æ­¥éª¤-7-å½ä»¤ä¼ æ­ã",normalizedTitle:"æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã",charIndex:4980},{level:2,title:"å­ãå¤å¶çéç½®é¡¹",slug:"å­ãå¤å¶çéç½®é¡¹",normalizedTitle:"å­ãå¤å¶çéç½®é¡¹",charIndex:5129},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:5878}],headersStr:"ä¸ãå¤å¶ç®ä» äºãæ§çå¤å¶ åæ­¥ å½ä»¤ä¼ æ­ æ§çå¤å¶çç¼ºé· ä¸ãæ°çå¤å¶ é¨åéåæ­¥ å¤å¶åç§»é å¤å¶ç§¯åç¼å²åº æå¡å¨çè¿è¡ ID PSYNC å½ä»¤ åãå¿è·³æ£æµ æ£æµä¸»ä»è¿æ¥ç¶æ è¾å©å®ç° min-slaves éé¡¹ æ£æµå½ä»¤ä¸¢å¤± äºãå¤å¶çæµç¨ æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨ æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã æ­¥éª¤ 4. èº«ä»½éªè¯ã æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã æ­¥éª¤ 6. åæ­¥ã æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã å­ãå¤å¶çéç½®é¡¹ åèèµæ",content:"# Redis å¤å¶\n\n> å¨ Redis ä¸­ï¼å¯ä»¥éè¿æ§è¡ SLAVEOF å½ä»¤æè®¾ç½® slaveof éé¡¹ï¼è®©ä¸ä¸ªæå¡å¨å»å¤å¶ï¼replicateï¼å¦ä¸ä¸ªæå¡å¨ï¼å¶ä¸­ï¼åèå«ä¸»æå¡å¨ï¼masterï¼ï¼åèå«ä»æå¡å¨ï¼slaveï¼ã\n> \n> Redis 2.8 ä»¥åçå¤å¶ä¸è½é«æå¤çæ­çº¿åéå¤å¶çæåµï¼è Redis 2.8 æ°æ·»çé¨åéåæ­¥å¯ä»¥è§£å³è¿ä¸ªé®é¢ã\n\n\n\n\n# ä¸ãå¤å¶ç®ä»\n\nRedis éè¿ slaveof host port å½ä»¤æ¥è®©ä¸ä¸ªæå¡å¨æä¸ºå¦ä¸ä¸ªæå¡å¨çä»æå¡å¨ã\n\nä¸ä¸ªä¸»æå¡å¨å¯ä»¥æå¤ä¸ªä»æå¡å¨ãä¸ä»ä¸»æå¡å¨å¯ä»¥æä»æå¡å¨ï¼ä»æå¡å¨ä¹å¯ä»¥æèªå·±çä»æå¡å¨ï¼ å¤ä¸ªä»æå¡å¨ä¹é´å¯ä»¥ææä¸ä¸ªä¸»ä»é¾ã\n\nä¸ä¸ªä»æå¡å¨åªè½æä¸ä¸ªä¸»æå¡å¨ï¼å¹¶ä¸ä¸æ¯æä¸»ä¸»å¤å¶ã\n\nå¯ä»¥éè¿å¤å¶åè½æ¥è®©ä¸»æå¡å¨åäºæ§è¡æä¹åæä½ï¼ åªè¦å³é­ä¸»æå¡å¨çæä¹ååè½ï¼ ç¶åç±ä»æå¡å¨å»æ§è¡æä¹åæä½å³å¯ã\n\nå¨ä½¿ç¨ Redis å¤å¶åè½æ¶çè®¾ç½®ä¸­ï¼å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå½ä¸å¯ç¨æ¶ï¼ä¾å¦ç±äºéå¸¸æ¢çç£çæ§è½èå¯¼è´çå»¶è¿é®é¢ï¼åºè¯¥éç½®å®ä¾æ¥é¿åéç½®åèªå¨éå¯ã\n\nä» Redis 2.6 å¼å§ï¼ ä»æå¡å¨æ¯æåªè¯»æ¨¡å¼ï¼ å¹¶ä¸è¯¥æ¨¡å¼ä¸ºä»æå¡å¨çé»è®¤æ¨¡å¼ã\n\n * åªè¯»æ¨¡å¼ç± redis.conf æä»¶ä¸­ç slave-read-only éé¡¹æ§å¶ï¼ ä¹å¯ä»¥éè¿ CONFIG SET parameter value å½ä»¤æ¥å¼å¯æå³é­è¿ä¸ªæ¨¡å¼ã\n * åªè¯»ä»æå¡å¨ä¼æç»æ§è¡ä»»ä½åå½ä»¤ï¼ æä»¥ä¸ä¼åºç°å ä¸ºæä½å¤±è¯¯èå°æ°æ®ä¸å°å¿åå¥å°äºä»æå¡å¨çæåµã\n\n\n# äºãæ§çå¤å¶\n\n> Redis 2.8 çæ¬ä»¥åå®ç°æ¹å¼ï¼SYNC å½ä»¤\n\nRedis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\n\n# åæ­¥\n\nSYNC å½ä»¤çæ§è¡æ­¥éª¤ï¼\n\n 1. ä»æå¡å¨åä¸»æå¡å¨åé SYNC å½ä»¤ã\n 2. æ¶å° SYNC å½ä»¤çä¸»æå¡å¨æ§è¡ BGSAVE å½ä»¤ï¼å¨åå°çæä¸ä¸ª RDB æä»¶ï¼å¹¶ä½¿ç¨ä¸ä¸ªç¼å²åºè®°å½ä»ç°å¨å¼å§æ§è¡çææåå½ä»¤ã\n 3. ä¸»æå¡å¨æ§è¡ BGSAVE å®æ¯åï¼ä¸»æå¡å¨ä¼å°çæç RDB æä»¶åéç»ä»æå¡å¨ãä»æå¡å¨æ¥æ¶å¹¶è½½å¥ RDB æä»¶ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n 4. ä¸»æå¡å¨å°è®°å½å¨ç¼å²åºä¸­çææåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨æ§è¡è¿äºåå½ä»¤ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n\n\n\n\n# å½ä»¤ä¼ æ­\n\nåæ­¥æä½å®æåï¼ä¸»ä»æ°æ®åºçæ°æ®åºç¶æå°è¾¾å°ä¸è´ãæ¯å½ä¸»æå¡å¨æ§è¡å®¢æ·ç«¯åéçåå½ä»¤æ¶ï¼ä¸»ä»æ°æ®åºç¶æä¸åä¸è´ãéè¦å°åå½ä»¤åéç»ä»æå¡å¨æ§è¡ï¼ä½¿å¾äºèçæ°æ®åºç¶æéæ°è¾¾å°ä¸è´ã\n\n\n# æ§çå¤å¶çç¼ºé·\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨çå¤å¶å­å¨ä¸¤ç§æåµï¼\n\n * åæ¬¡å¤å¶ - ä»æå¡å¨ä»¥åæ²¡æå¤å¶è¿å°è¦å¤å¶çä¸»æå¡å¨ã\n * æ­çº¿åéå¤å¶ - å¤äºå½ä»¤ä¼ æ­é¶æ®µçä¸»ä»æå¡å¨å ä¸ºç½ç»åå èä¸­æ­äºå¤å¶ï¼å½ä»æå¡å¨éè¿èªå¨éè¿éæ°è¿ä¸äºä¸»æå¡å¨åï¼ç»§ç»­å¤å¶ä¸»æå¡å¨ã\n\nå¯¹äºåæ¬¡å¤å¶ï¼æ§çå¤å¶åè½å¯ç¨å¾å¥½å®æä»»å¡ï¼ä½æ¯å¯¹äºæ­çº¿åéå¤å¶ï¼ç±äºæ¯æ¬¡ä»»ç¶éè¦çæ RDB å¹¶ä¼ è¾ï¼æçå¾ä½ã\n\n> ð æ³¨æï¼SYNC å½ä»¤æ¯ä¸ä¸ªéå¸¸èè´¹èµæºçæä½ã\n> \n>  * ä¸»æå¡å¨æ§è¡ BGSAVE å½ä»¤çæ RDB æä»¶ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»æå¡å¨å¤§éç CPUãåå­åç£ç I/O èµæºã\n>  * ä¸»æå¡å¨ä¼ è¾ RDB æä»¶ç»ä»æå¡å¨ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»ä»æå¡å¨å¤§éçç½ç»èµæºï¼å¹¶å¯¹ä¸»æå¡å¨ååºæ¶å»¶äº§çå½±åã\n>  * ä»æå¡å¨è½½å¥ RDB æä»¶æé´ï¼ä¼é»å¡å¶ä»å½ä»¤è¯·æ±ã\n\n\n# ä¸ãæ°çå¤å¶\n\n> Redis 2.8 çæ¬ä»¥åçæ°å®ç°æ¹å¼ï¼ä½¿ç¨ PSYNC å½ä»¤æ¿ä»£ SYNC å½ä»¤ã\n\nPSYNC å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ SYNC å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥åè½å®ç°ç±ä¸ä¸ªé¨åææï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ ID\n\n# å¤å¶åç§»é\n\nä¸»æå¡å¨åä»æå¡å¨ä¼åå«ç»´æ¤ä¸ä¸ªå¤å¶åç§»éã\n\n * å¦æä¸»ä»æå¡å¨çå¤å¶åç§»éç¸åï¼åè¯´æäºèçæ°æ®åºç¶æä¸è´ï¼\n * åä¹ï¼åè¯´æäºèçæ°æ®åºç¶æä¸ä¸è´ã\n\n\n\n# å¤å¶ç§¯åç¼å²åº\n\nå¤å¶ç§¯åç¼å²åºæ¯ä¸»æå¡å¨ç»´æ¤çä¸ä¸ªåºå®é¿åº¦çåè¿ååºï¼FIFOï¼éåï¼é»è®¤å¤§å°ä¸º 1MBã\n\nå¤å¶ç§¯åç¼å²åºä¼ä¿å­ä¸é¨åæè¿ä¼ æ­çåå½ä»¤ï¼å¹¶ä¸å¤å¶ç§¯åç¼å²åºä¼ä¸ºéåä¸­çæ¯ä¸ªå­èè®°å½ç¸åºçå¤å¶åç§»éã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸»æå¡æ¶ï¼ä»æå¡å¨ä¼éè¿ PSYNC å½ä»¤å°èªå·±çå¤å¶åç§»é offset åéç»ä¸»æå¡å¨ï¼ä¸»æå¡å¨ä¼æ ¹æ®è¿ä¸ªå¤å¶åç§»éæ¥å³å®å¯¹ä»æå¡å¨æ§è¡ä½ç§åæ­¥æä½ã\n\n * å¦æ offset ä¹åçæ°æ®ä»ç¶å¨å¤å¶ç§¯åç¼å²åºï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡é¨åéåæ­¥æä½ã\n * åä¹ï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n> ð æ³¨æï¼åçè°æ´å¤å¶ç§¯åç¼å²åºçå¤§å°\n> \n>  * Redis å¤å¶ç§¯åç¼å²åºé»è®¤å¤§å°ä¸º 1MBã\n> \n>  * å¤å¶ç§¯åç¼å²åºçæå°å¤§å°å¯ä»¥æ ¹æ®å¬å¼ second * write_size_per_second ä¼°ç®ã\n\n# æå¡å¨çè¿è¡ ID\n\n * æ¯ä¸ª Redis æå¡å¨ï¼é½æè¿è¡ IDï¼ç¨äºå¯ä¸è¯å«èº«ä»½ã\n * è¿è¡ ID å¨æå¡å¨å¯å¨æ¶èªå¨çæï¼ç± 40 ä¸ªéæºçåå­è¿å¶å­ç¬¦ç»æãä¾å¦ï¼132e358005e29741f8d7b0a42d666aace286edda\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨è¿è¡åæ¬¡å¤å¶æ¶ï¼ä¸»æå¡å¨ä¼å°èªå·±çè¿è¡ ID ä¼ éç»ä»æå¡å¨ï¼ä»æå¡å¨ä¼å°è¿ä¸ªè¿è¡ ID ä¿å­ä¸æ¥ã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸ä¸ªä¸»æå¡å¨æ¶ï¼ä»æå¡å¨ä¼åéä¹åä¿å­çè¿è¡ IDï¼\n\n * å¦æä¿å­çè¿è¡ ID åå½åä¸»æå¡å¨çè¿è¡ ID ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çå°±æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å¯ä»¥ç»§ç»­å°è¯æ§è¡é¨åéåæ­¥æä½ï¼\n * åä¹ï¼è¥è¿è¡ ID ä¸ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çä¸æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å°å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n\n# PSYNC å½ä»¤\n\näºè§£äºé¨åéåæ­¥çå®ç°ï¼PSYNC çå®ç°å°±å¾å®¹æçè§£äºï¼å®çåºæ¬å·¥ä½åçå¤§è´å¦ä¸ï¼\n\nå½ä»æå¡æ¥æ¶å° SLAVEOF å½ä»¤æ¶ï¼åå¤æ­ä»æå¡å¨ä»¥åæ¯å¦æ§è¡è¿å¤å¶æä½ã\n\n * å¦ææ²¡æå¤å¶è¿ä»»ä½ä¸»æå¡å¨ï¼åè¦å¤å¶çä¸»æå¡å¨åé PSYNC ? -1 å½ä»¤ï¼ä¸»å¨è¯·æ±è¿è¡å®æ´éåæ­¥ã\n * åä¹ï¼åè¦å¤å¶çä¸»æå¡å¨åé PSYNC <runid> <offset> å½ä»¤ã\n   * runid æ¯ä¸ä¸æ¬¡å¤å¶çä¸»æå¡å¨çè¿è¡ IDã\n   * offset æ¯å¤å¶åç§»éã\n\næ¥æ¶å° PSYNC <runid> <offset> å½ä»¤çä¸»æå¡ä¼è¿è¡åæï¼\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ï¼å¨ 2.8 çæ¬ä¹åå°±æ¯ç´æ¥è¿è¡å®å¨éæ°åæ­¥ï¼ã\n\n\n\n\n# åãå¿è·³æ£æµ\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡å¨åéå½ä»¤ï¼\n\nREPLCONF ACK <replication_offset>\n\n\nå¶ä¸­ï¼replication_offset æ¯ä»æå¡å¨å½åçå¤å¶åç§»éã\n\nåé REPLCONF ACK å½ä»¤å¯¹äºä¸»ä»æå¡å¨æä¸ä¸ªä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slaves éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# æ£æµä¸»ä»è¿æ¥ç¶æ\n\nå¯ä»¥éè¿åéåæ¥æ¶ REPLCONF ACK å½ä»¤æ¥æ£æ¥ä¸»ä»æå¡å¨ä¹é´çç½ç»è¿æ¥æ¯å¦æ­£å¸¸ï¼å¦æä¸»æå¡å¨è¶è¿ä¸ç§æ²¡ææ¶å°ä»æå¡å¨åæ¥ç REPLCONF ACK å½ä»¤ï¼é£ä¹ä¸»æå¡å¨å°±ç¥éä¸»ä»æå¡å¨ä¹é´çè¿æ¥åºç°é®é¢äºã\n\nå¯ä»¥éè¿åä¸»æå¡å¨åé INFO replication å½ä»¤ï¼å¨ååºçä»æå¡å¨åè¡¨ç lag ä¸æ ä¸­ï¼å¯ä»¥çå°ä»æå¡å¨åä¸»æå¡å¨åé REPLCONF ACK å½ä»¤å·²ç»è¿å»å¤å°ç§ã\n\n\n# è¾å©å®ç° min-slaves éé¡¹\n\nRedis ç min-slaves-to-write å min-slaves-max-lag ä¸¤ä¸ªéé¡¹å¯ä»¥é²æ­¢ä¸»æå¡å¨å¨ä¸å®å¨çæåµä¸æ§è¡åå½ä»¤ã\n\nãç¤ºä¾ãmin-slaves éç½®é¡¹\n\nmin-slaves-to-write 3\nmin-slaves-max-lag 10\n\n\nä»¥ä¸éç½®è¡¨ç¤ºï¼ä»æå¡å¨å°äº 3 ä¸ªï¼æä¸ä¸ªä»æå¡å¨çå»¶è¿ï¼lagï¼é½å¤§äºç­äº 10 ç§æ¶ï¼ä¸»æå¡å¨å°æç»æ§è¡åå½ä»¤ã\n\n\n# æ£æµå½ä»¤ä¸¢å¤±\n\nå¦æå ä¸ºç½ç»æéï¼ä¸»æå¡ä¼ æ­ç»ä»æå¡å¨çåå½ä»¤ä¸¢å¤±ï¼é£ä¹ä»æå¡å¨å®æ¶åä¸»æå¡å¨åé REPLCONF ACK å½ä»¤æ¶ï¼ä¸»æå¡å¨å°åè§ä»æå¡å¨çå¤å¶åç§»éå°äºèªå·±çãç¶åï¼ä¸»æå¡å¨å°±ä¼æ ¹æ®ä»æå¡å¨æäº¤çå¤å¶åç§»éï¼å¨å¤å¶ç§¯åç¼å²åºä¸­æ¾å°ä»æå¡å¨ç¼ºå°çæ°æ®ï¼å¹¶å°è¿äºæ°æ®éæ°åéç»ä»æå¡å¨ã\n\n\n# äºãå¤å¶çæµç¨\n\néè¿åä»æå¡å¨åéå¦ä¸ SLAVEOF å½ä»¤ï¼å¯ä»¥è®©ä¸ä¸ªä»æå¡å¨å»å¤å¶ä¸ä¸ªä¸»æå¡å¨ã\n\nSLAVEOF <master_ip> <master_port>\n\n\n\n# æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n\néç½®ä¸ä¸ªä»æå¡å¨éå¸¸ç®åï¼ åªè¦å¨éç½®æä»¶ä¸­å¢å ä»¥ä¸çè¿ä¸è¡å°±å¯ä»¥äºï¼\n\nslaveof 127.0.0.1 6379\n\n\nå½ç¶ï¼ ä½ éè¦å°ä»£ç ä¸­ç 127.0.0.1 å 6379 æ¿æ¢æä½ çä¸»æå¡å¨ç IP åç«¯å£å·ã\n\nå¦å¤ä¸ç§æ¹æ³æ¯è°ç¨ SLAVEOF host port å½ä»¤ï¼ è¾å¥ä¸»æå¡å¨ç IP åç«¯å£ï¼ ç¶ååæ­¥å°±ä¼å¼å§ï¼\n\n127.0.0.1:6379> SLAVEOF 127.0.0.1 10086\nOK\n\n\n\n# æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« TCP è¿æ¥ã\n\n\n# æ­¥éª¤ 3. åé PING æ£æ¥éä¿¡ç¶æã\n\n\n# æ­¥éª¤ 4. èº«ä»½éªè¯ã\n\nå¦æä¸»æå¡å¨æ²¡æè®¾ç½® requirepass ï¼ä»æå¡å¨æ²¡æè®¾ç½® masterauthï¼åä¸è¿è¡èº«ä»½éªè¯ï¼åä¹ï¼åéè¦è¿è¡èº«ä»½éªè¯ãå¦æèº«ä»½éªè¯å¤±è´¥ï¼åæ¾å¼æ§è¡å¤å¶å·¥ä½ã\n\nå¦æä¸»æå¡å¨éè¿ requirepass éé¡¹è®¾ç½®äºå¯ç ï¼ é£ä¹ä¸ºäºè®©ä»æå¡å¨çåæ­¥æä½å¯ä»¥é¡ºå©è¿è¡ï¼ æä»¬ä¹å¿é¡»ä¸ºä»æå¡å¨è¿è¡ç¸åºçèº«ä»½éªè¯è®¾ç½®ã\n\nå¯¹äºä¸ä¸ªæ­£å¨è¿è¡çæå¡å¨ï¼ å¯ä»¥ä½¿ç¨å®¢æ·ç«¯è¾å¥ä»¥ä¸å½ä»¤ï¼\n\nconfig set masterauth <password>\n\n\nè¦æ°¸ä¹å°è®¾ç½®è¿ä¸ªå¯ç ï¼ é£ä¹å¯ä»¥å°å®å å¥å°éç½®æä»¶ä¸­ï¼\n\nmasterauth <password>\n\n\nå¦å¤è¿æå ä¸ªéé¡¹ï¼ å®ä»¬åä¸»æå¡å¨æ§è¡é¨åéåæ­¥æ¶æä½¿ç¨çå¤å¶æµç¼å²åºæå³ï¼ è¯¦ç»çä¿¡æ¯å¯ä»¥åè Redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n\nä»æå¡å¨æ§è¡ REPLCONF listening-port <port-number> ï¼åä¸»æå¡å¨åéä»æå¡å¨ççå¬ç«¯å£å·ã\n\n\n# æ­¥éª¤ 6. åæ­¥ã\n\nåæå·²ä»ç»ï¼æ­¤å¤ä¸èµè¿°ã\n\n\n# æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡åéå½ä»¤ï¼\n\nREPLCONF ACK <replication_coffset>\n\n\nå½ä»¤çä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slave éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# å­ãå¤å¶çéç½®é¡¹\n\nä» Redis 2.8 å¼å§ï¼ ä¸ºäºä¿è¯æ°æ®çå®å¨æ§ï¼ å¯ä»¥éè¿éç½®ï¼ è®©ä¸»æå¡å¨åªå¨æè³å° N ä¸ªå½åå·²è¿æ¥ä»æå¡å¨çæåµä¸ï¼ ææ§è¡åå½ä»¤ã\n\nä¸è¿ï¼ å ä¸º Redis ä½¿ç¨å¼æ­¥å¤å¶ï¼ æä»¥ä¸»æå¡å¨åéçåæ°æ®å¹¶ä¸ä¸å®ä¼è¢«ä»æå¡å¨æ¥æ¶å°ï¼ å æ­¤ï¼ æ°æ®ä¸¢å¤±çå¯è½æ§ä»ç¶æ¯å­å¨çã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çè¿ä½åçï¼\n\n * ä»æå¡å¨ä»¥æ¯ç§ä¸æ¬¡çé¢ç PING ä¸»æå¡å¨ä¸æ¬¡ï¼ å¹¶æ¥åå¤å¶æµçå¤çæåµã\n * ä¸»æå¡å¨ä¼è®°å½åä¸ªä»æå¡å¨æåä¸æ¬¡åå®åé PING çæ¶é´ã\n * ç¨æ·å¯ä»¥éè¿éç½®ï¼ æå®ç½ç»å»¶è¿çæå¤§å¼ min-slaves-max-lag ï¼ ä»¥åæ§è¡åæä½æéçè³å°ä»æå¡å¨æ°é min-slaves-to-write ã\n\nå¦æè³å°æ min-slaves-to-write ä¸ªä»æå¡å¨ï¼ å¹¶ä¸è¿äºæå¡å¨çå»¶è¿å¼é½å°äº min-slaves-max-lagç§ï¼ é£ä¹ä¸»æå¡å¨å°±ä¼æ§è¡å®¢æ·ç«¯è¯·æ±çåæä½ã\n\nä½ å¯ä»¥å°è¿ä¸ªç¹æ§çä½ CAP çè®ºä¸­ç C çæ¡ä»¶æ¾å®½çæ¬ï¼ å°½ç®¡ä¸è½ä¿è¯åæä½çæä¹æ§ï¼ ä½èµ·ç ä¸¢å¤±æ°æ®ççªå£ä¼è¢«ä¸¥æ ¼éå¶å¨æå®çç§æ°ä¸­ã\n\nå¦ä¸æ¹é¢ï¼ å¦ææ¡ä»¶è¾¾ä¸å° min-slaves-to-write å min-slaves-max-lag ææå®çæ¡ä»¶ï¼ é£ä¹åæä½å°±ä¸ä¼è¢«æ§è¡ï¼ ä¸»æå¡å¨ä¼åè¯·æ±æ§è¡åæä½çå®¢æ·ç«¯è¿åä¸ä¸ªéè¯¯ã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çä¸¤ä¸ªéé¡¹åå®ä»¬æéçåæ°ï¼\n\n * min-slaves-to-write <number of slaves>\n * min-slaves-max-lag <number of seconds>\n\nè¯¦ç»çä¿¡æ¯å¯ä»¥åè Redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè",normalizedContent:"# redis å¤å¶\n\n> å¨ redis ä¸­ï¼å¯ä»¥éè¿æ§è¡ slaveof å½ä»¤æè®¾ç½® slaveof éé¡¹ï¼è®©ä¸ä¸ªæå¡å¨å»å¤å¶ï¼replicateï¼å¦ä¸ä¸ªæå¡å¨ï¼å¶ä¸­ï¼åèå«ä¸»æå¡å¨ï¼masterï¼ï¼åèå«ä»æå¡å¨ï¼slaveï¼ã\n> \n> redis 2.8 ä»¥åçå¤å¶ä¸è½é«æå¤çæ­çº¿åéå¤å¶çæåµï¼è redis 2.8 æ°æ·»çé¨åéåæ­¥å¯ä»¥è§£å³è¿ä¸ªé®é¢ã\n\n\n\n\n# ä¸ãå¤å¶ç®ä»\n\nredis éè¿ slaveof host port å½ä»¤æ¥è®©ä¸ä¸ªæå¡å¨æä¸ºå¦ä¸ä¸ªæå¡å¨çä»æå¡å¨ã\n\nä¸ä¸ªä¸»æå¡å¨å¯ä»¥æå¤ä¸ªä»æå¡å¨ãä¸ä»ä¸»æå¡å¨å¯ä»¥æä»æå¡å¨ï¼ä»æå¡å¨ä¹å¯ä»¥æèªå·±çä»æå¡å¨ï¼ å¤ä¸ªä»æå¡å¨ä¹é´å¯ä»¥ææä¸ä¸ªä¸»ä»é¾ã\n\nä¸ä¸ªä»æå¡å¨åªè½æä¸ä¸ªä¸»æå¡å¨ï¼å¹¶ä¸ä¸æ¯æä¸»ä¸»å¤å¶ã\n\nå¯ä»¥éè¿å¤å¶åè½æ¥è®©ä¸»æå¡å¨åäºæ§è¡æä¹åæä½ï¼ åªè¦å³é­ä¸»æå¡å¨çæä¹ååè½ï¼ ç¶åç±ä»æå¡å¨å»æ§è¡æä¹åæä½å³å¯ã\n\nå¨ä½¿ç¨ redis å¤å¶åè½æ¶çè®¾ç½®ä¸­ï¼å¼ºçå»ºè®®å¨ master åå¨ slave ä¸­å¯ç¨æä¹åãå½ä¸å¯ç¨æ¶ï¼ä¾å¦ç±äºéå¸¸æ¢çç£çæ§è½èå¯¼è´çå»¶è¿é®é¢ï¼åºè¯¥éç½®å®ä¾æ¥é¿åéç½®åèªå¨éå¯ã\n\nä» redis 2.6 å¼å§ï¼ ä»æå¡å¨æ¯æåªè¯»æ¨¡å¼ï¼ å¹¶ä¸è¯¥æ¨¡å¼ä¸ºä»æå¡å¨çé»è®¤æ¨¡å¼ã\n\n * åªè¯»æ¨¡å¼ç± redis.conf æä»¶ä¸­ç slave-read-only éé¡¹æ§å¶ï¼ ä¹å¯ä»¥éè¿ config set parameter value å½ä»¤æ¥å¼å¯æå³é­è¿ä¸ªæ¨¡å¼ã\n * åªè¯»ä»æå¡å¨ä¼æç»æ§è¡ä»»ä½åå½ä»¤ï¼ æä»¥ä¸ä¼åºç°å ä¸ºæä½å¤±è¯¯èå°æ°æ®ä¸å°å¿åå¥å°äºä»æå¡å¨çæåµã\n\n\n# äºãæ§çå¤å¶\n\n> redis 2.8 çæ¬ä»¥åå®ç°æ¹å¼ï¼sync å½ä»¤\n\nredis çå¤å¶åè½åä¸ºåæ­¥ï¼syncï¼åå½ä»¤ä¼ æ­ï¼command propagateï¼ä¸¤ä¸ªæä½ï¼\n\n * åæ­¥ï¼syncï¼ - ç¨äºå°ä»æå¡å¨çæ°æ®åºç¶ææ´æ°è³ä¸»æå¡å¨å½åçæ°æ®åºç¶æã\n * å½ä»¤ä¼ æ­ï¼command propagateï¼ - å½ä¸»æå¡å¨çæ°æ®åºç¶æè¢«ä¿®æ¹ï¼å¯¼è´ä¸»ä»æ°æ®åºç¶æä¸ä¸è´æ¶ï¼è®©ä¸»ä»æå¡å¨çæ°æ®åºéæ°åå°ä¸è´ç¶æã\n\n\n# åæ­¥\n\nsync å½ä»¤çæ§è¡æ­¥éª¤ï¼\n\n 1. ä»æå¡å¨åä¸»æå¡å¨åé sync å½ä»¤ã\n 2. æ¶å° sync å½ä»¤çä¸»æå¡å¨æ§è¡ bgsave å½ä»¤ï¼å¨åå°çæä¸ä¸ª rdb æä»¶ï¼å¹¶ä½¿ç¨ä¸ä¸ªç¼å²åºè®°å½ä»ç°å¨å¼å§æ§è¡çææåå½ä»¤ã\n 3. ä¸»æå¡å¨æ§è¡ bgsave å®æ¯åï¼ä¸»æå¡å¨ä¼å°çæç rdb æä»¶åéç»ä»æå¡å¨ãä»æå¡å¨æ¥æ¶å¹¶è½½å¥ rdb æä»¶ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n 4. ä¸»æå¡å¨å°è®°å½å¨ç¼å²åºä¸­çææåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨æ§è¡è¿äºåå½ä»¤ï¼æ´æ°èªå·±çæ°æ®åºç¶æã\n\n\n\n\n# å½ä»¤ä¼ æ­\n\nåæ­¥æä½å®æåï¼ä¸»ä»æ°æ®åºçæ°æ®åºç¶æå°è¾¾å°ä¸è´ãæ¯å½ä¸»æå¡å¨æ§è¡å®¢æ·ç«¯åéçåå½ä»¤æ¶ï¼ä¸»ä»æ°æ®åºç¶æä¸åä¸è´ãéè¦å°åå½ä»¤åéç»ä»æå¡å¨æ§è¡ï¼ä½¿å¾äºèçæ°æ®åºç¶æéæ°è¾¾å°ä¸è´ã\n\n\n# æ§çå¤å¶çç¼ºé·\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨çå¤å¶å­å¨ä¸¤ç§æåµï¼\n\n * åæ¬¡å¤å¶ - ä»æå¡å¨ä»¥åæ²¡æå¤å¶è¿å°è¦å¤å¶çä¸»æå¡å¨ã\n * æ­çº¿åéå¤å¶ - å¤äºå½ä»¤ä¼ æ­é¶æ®µçä¸»ä»æå¡å¨å ä¸ºç½ç»åå èä¸­æ­äºå¤å¶ï¼å½ä»æå¡å¨éè¿èªå¨éè¿éæ°è¿ä¸äºä¸»æå¡å¨åï¼ç»§ç»­å¤å¶ä¸»æå¡å¨ã\n\nå¯¹äºåæ¬¡å¤å¶ï¼æ§çå¤å¶åè½å¯ç¨å¾å¥½å®æä»»å¡ï¼ä½æ¯å¯¹äºæ­çº¿åéå¤å¶ï¼ç±äºæ¯æ¬¡ä»»ç¶éè¦çæ rdb å¹¶ä¼ è¾ï¼æçå¾ä½ã\n\n> ð æ³¨æï¼sync å½ä»¤æ¯ä¸ä¸ªéå¸¸èè´¹èµæºçæä½ã\n> \n>  * ä¸»æå¡å¨æ§è¡ bgsave å½ä»¤çæ rdb æä»¶ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»æå¡å¨å¤§éç cpuãåå­åç£ç i/o èµæºã\n>  * ä¸»æå¡å¨ä¼ è¾ rdb æä»¶ç»ä»æå¡å¨ï¼è¿ä¸ªæä½ä¼èè´¹ä¸»ä»æå¡å¨å¤§éçç½ç»èµæºï¼å¹¶å¯¹ä¸»æå¡å¨ååºæ¶å»¶äº§çå½±åã\n>  * ä»æå¡å¨è½½å¥ rdb æä»¶æé´ï¼ä¼é»å¡å¶ä»å½ä»¤è¯·æ±ã\n\n\n# ä¸ãæ°çå¤å¶\n\n> redis 2.8 çæ¬ä»¥åçæ°å®ç°æ¹å¼ï¼ä½¿ç¨ psync å½ä»¤æ¿ä»£ sync å½ä»¤ã\n\npsync å½ä»¤å·æå®æ´éåæ­¥åé¨åéåæ­¥ä¸¤ç§æ¨¡å¼ï¼\n\n * å®æ´éåæ­¥ï¼full resychronizationï¼ - ç¨äºåæ¬¡å¤å¶ãæ§è¡æ­¥éª¤ä¸ sync å½ä»¤åºæ¬ä¸è´ã\n * é¨åéåæ­¥ï¼partial resychronizationï¼ - ç¨äºæ­çº¿åéå¤å¶ãå¦ææ¡ä»¶åè®¸ï¼ä¸»æå¡å¨å¯ä»¥å°ä¸»ä»æå¡å¨è¿æ¥æ­å¼æé´æ§è¡çåå½ä»¤åéç»ä»æå¡å¨ï¼ä»æå¡å¨åªéæ¥æ¶å¹¶æ§è¡è¿äºåå½ä»¤ï¼å³å¯å°ä¸»ä»æå¡å¨çæ°æ®åºç¶æä¿æä¸è´ã\n\n\n# é¨åéåæ­¥\n\né¨åéåæ­¥åè½å®ç°ç±ä¸ä¸ªé¨åææï¼\n\n * ä¸»ä»æå¡å¨çå¤å¶åç§»éï¼replication offsetï¼\n * ä¸»æå¡å¨çå¤å¶ç§¯åç¼å²åºï¼replication backlogï¼\n * æå¡å¨çè¿è¡ id\n\n# å¤å¶åç§»é\n\nä¸»æå¡å¨åä»æå¡å¨ä¼åå«ç»´æ¤ä¸ä¸ªå¤å¶åç§»éã\n\n * å¦æä¸»ä»æå¡å¨çå¤å¶åç§»éç¸åï¼åè¯´æäºèçæ°æ®åºç¶æä¸è´ï¼\n * åä¹ï¼åè¯´æäºèçæ°æ®åºç¶æä¸ä¸è´ã\n\n\n\n# å¤å¶ç§¯åç¼å²åº\n\nå¤å¶ç§¯åç¼å²åºæ¯ä¸»æå¡å¨ç»´æ¤çä¸ä¸ªåºå®é¿åº¦çåè¿ååºï¼fifoï¼éåï¼é»è®¤å¤§å°ä¸º 1mbã\n\nå¤å¶ç§¯åç¼å²åºä¼ä¿å­ä¸é¨åæè¿ä¼ æ­çåå½ä»¤ï¼å¹¶ä¸å¤å¶ç§¯åç¼å²åºä¼ä¸ºéåä¸­çæ¯ä¸ªå­èè®°å½ç¸åºçå¤å¶åç§»éã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸»æå¡æ¶ï¼ä»æå¡å¨ä¼éè¿ psync å½ä»¤å°èªå·±çå¤å¶åç§»é offset åéç»ä¸»æå¡å¨ï¼ä¸»æå¡å¨ä¼æ ¹æ®è¿ä¸ªå¤å¶åç§»éæ¥å³å®å¯¹ä»æå¡å¨æ§è¡ä½ç§åæ­¥æä½ã\n\n * å¦æ offset ä¹åçæ°æ®ä»ç¶å¨å¤å¶ç§¯åç¼å²åºï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡é¨åéåæ­¥æä½ã\n * åä¹ï¼åä¸»æå¡å¨å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n> ð æ³¨æï¼åçè°æ´å¤å¶ç§¯åç¼å²åºçå¤§å°\n> \n>  * redis å¤å¶ç§¯åç¼å²åºé»è®¤å¤§å°ä¸º 1mbã\n> \n>  * å¤å¶ç§¯åç¼å²åºçæå°å¤§å°å¯ä»¥æ ¹æ®å¬å¼ second * write_size_per_second ä¼°ç®ã\n\n# æå¡å¨çè¿è¡ id\n\n * æ¯ä¸ª redis æå¡å¨ï¼é½æè¿è¡ idï¼ç¨äºå¯ä¸è¯å«èº«ä»½ã\n * è¿è¡ id å¨æå¡å¨å¯å¨æ¶èªå¨çæï¼ç± 40 ä¸ªéæºçåå­è¿å¶å­ç¬¦ç»æãä¾å¦ï¼132e358005e29741f8d7b0a42d666aace286edda\n\nä»æå¡å¨å¯¹ä¸»æå¡å¨è¿è¡åæ¬¡å¤å¶æ¶ï¼ä¸»æå¡å¨ä¼å°èªå·±çè¿è¡ id ä¼ éç»ä»æå¡å¨ï¼ä»æå¡å¨ä¼å°è¿ä¸ªè¿è¡ id ä¿å­ä¸æ¥ã\n\nå½ä»æå¡å¨æ­çº¿éè¿ä¸ä¸ªä¸»æå¡å¨æ¶ï¼ä»æå¡å¨ä¼åéä¹åä¿å­çè¿è¡ idï¼\n\n * å¦æä¿å­çè¿è¡ id åå½åä¸»æå¡å¨çè¿è¡ id ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çå°±æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å¯ä»¥ç»§ç»­å°è¯æ§è¡é¨åéåæ­¥æä½ï¼\n * åä¹ï¼è¥è¿è¡ id ä¸ä¸è´ï¼åè¯´æä»æå¡å¨æ­çº¿ä¹åè¿æ¥çä¸æ¯è¿ä¸ªä¸»æå¡å¨ï¼ä¸»æå¡å¨å°å¯¹ä»æå¡å¨æ§è¡å®æ´éåæ­¥æä½ã\n\n\n# psync å½ä»¤\n\näºè§£äºé¨åéåæ­¥çå®ç°ï¼psync çå®ç°å°±å¾å®¹æçè§£äºï¼å®çåºæ¬å·¥ä½åçå¤§è´å¦ä¸ï¼\n\nå½ä»æå¡æ¥æ¶å° slaveof å½ä»¤æ¶ï¼åå¤æ­ä»æå¡å¨ä»¥åæ¯å¦æ§è¡è¿å¤å¶æä½ã\n\n * å¦ææ²¡æå¤å¶è¿ä»»ä½ä¸»æå¡å¨ï¼åè¦å¤å¶çä¸»æå¡å¨åé psync ? -1 å½ä»¤ï¼ä¸»å¨è¯·æ±è¿è¡å®æ´éåæ­¥ã\n * åä¹ï¼åè¦å¤å¶çä¸»æå¡å¨åé psync <runid> <offset> å½ä»¤ã\n   * runid æ¯ä¸ä¸æ¬¡å¤å¶çä¸»æå¡å¨çè¿è¡ idã\n   * offset æ¯å¤å¶åç§»éã\n\næ¥æ¶å° psync <runid> <offset> å½ä»¤çä¸»æå¡ä¼è¿è¡åæï¼\n\n * åå¦ä¸»ä»æå¡å¨ç master run id ç¸åï¼å¹¶ä¸æå®çåç§»éï¼offsetï¼å¨åå­ç¼å²åºä¸­è¿ææï¼å¤å¶å°±ä¼ä»ä¸æ¬¡ä¸­æ­çç¹å¼å§ç»§ç»­ã\n * å¦æå¶ä¸­ä¸ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼å°±ä¼è¿è¡å®å¨éæ°åæ­¥ï¼å¨ 2.8 çæ¬ä¹åå°±æ¯ç´æ¥è¿è¡å®å¨éæ°åæ­¥ï¼ã\n\n\n\n\n# åãå¿è·³æ£æµ\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡å¨åéå½ä»¤ï¼\n\nreplconf ack <replication_offset>\n\n\nå¶ä¸­ï¼replication_offset æ¯ä»æå¡å¨å½åçå¤å¶åç§»éã\n\nåé replconf ack å½ä»¤å¯¹äºä¸»ä»æå¡å¨æä¸ä¸ªä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slaves éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# æ£æµä¸»ä»è¿æ¥ç¶æ\n\nå¯ä»¥éè¿åéåæ¥æ¶ replconf ack å½ä»¤æ¥æ£æ¥ä¸»ä»æå¡å¨ä¹é´çç½ç»è¿æ¥æ¯å¦æ­£å¸¸ï¼å¦æä¸»æå¡å¨è¶è¿ä¸ç§æ²¡ææ¶å°ä»æå¡å¨åæ¥ç replconf ack å½ä»¤ï¼é£ä¹ä¸»æå¡å¨å°±ç¥éä¸»ä»æå¡å¨ä¹é´çè¿æ¥åºç°é®é¢äºã\n\nå¯ä»¥éè¿åä¸»æå¡å¨åé info replication å½ä»¤ï¼å¨ååºçä»æå¡å¨åè¡¨ç lag ä¸æ ä¸­ï¼å¯ä»¥çå°ä»æå¡å¨åä¸»æå¡å¨åé replconf ack å½ä»¤å·²ç»è¿å»å¤å°ç§ã\n\n\n# è¾å©å®ç° min-slaves éé¡¹\n\nredis ç min-slaves-to-write å min-slaves-max-lag ä¸¤ä¸ªéé¡¹å¯ä»¥é²æ­¢ä¸»æå¡å¨å¨ä¸å®å¨çæåµä¸æ§è¡åå½ä»¤ã\n\nãç¤ºä¾ãmin-slaves éç½®é¡¹\n\nmin-slaves-to-write 3\nmin-slaves-max-lag 10\n\n\nä»¥ä¸éç½®è¡¨ç¤ºï¼ä»æå¡å¨å°äº 3 ä¸ªï¼æä¸ä¸ªä»æå¡å¨çå»¶è¿ï¼lagï¼é½å¤§äºç­äº 10 ç§æ¶ï¼ä¸»æå¡å¨å°æç»æ§è¡åå½ä»¤ã\n\n\n# æ£æµå½ä»¤ä¸¢å¤±\n\nå¦æå ä¸ºç½ç»æéï¼ä¸»æå¡ä¼ æ­ç»ä»æå¡å¨çåå½ä»¤ä¸¢å¤±ï¼é£ä¹ä»æå¡å¨å®æ¶åä¸»æå¡å¨åé replconf ack å½ä»¤æ¶ï¼ä¸»æå¡å¨å°åè§ä»æå¡å¨çå¤å¶åç§»éå°äºèªå·±çãç¶åï¼ä¸»æå¡å¨å°±ä¼æ ¹æ®ä»æå¡å¨æäº¤çå¤å¶åç§»éï¼å¨å¤å¶ç§¯åç¼å²åºä¸­æ¾å°ä»æå¡å¨ç¼ºå°çæ°æ®ï¼å¹¶å°è¿äºæ°æ®éæ°åéç»ä»æå¡å¨ã\n\n\n# äºãå¤å¶çæµç¨\n\néè¿åä»æå¡å¨åéå¦ä¸ slaveof å½ä»¤ï¼å¯ä»¥è®©ä¸ä¸ªä»æå¡å¨å»å¤å¶ä¸ä¸ªä¸»æå¡å¨ã\n\nslaveof <master_ip> <master_port>\n\n\n\n# æ­¥éª¤ 1. è®¾ç½®ä¸»ä»æå¡å¨\n\néç½®ä¸ä¸ªä»æå¡å¨éå¸¸ç®åï¼ åªè¦å¨éç½®æä»¶ä¸­å¢å ä»¥ä¸çè¿ä¸è¡å°±å¯ä»¥äºï¼\n\nslaveof 127.0.0.1 6379\n\n\nå½ç¶ï¼ ä½ éè¦å°ä»£ç ä¸­ç 127.0.0.1 å 6379 æ¿æ¢æä½ çä¸»æå¡å¨ç ip åç«¯å£å·ã\n\nå¦å¤ä¸ç§æ¹æ³æ¯è°ç¨ slaveof host port å½ä»¤ï¼ è¾å¥ä¸»æå¡å¨ç ip åç«¯å£ï¼ ç¶ååæ­¥å°±ä¼å¼å§ï¼\n\n127.0.0.1:6379> slaveof 127.0.0.1 10086\nok\n\n\n\n# æ­¥éª¤ 2. ä¸»ä»æå¡å¨å»ºç« tcp è¿æ¥ã\n\n\n# æ­¥éª¤ 3. åé ping æ£æ¥éä¿¡ç¶æã\n\n\n# æ­¥éª¤ 4. èº«ä»½éªè¯ã\n\nå¦æä¸»æå¡å¨æ²¡æè®¾ç½® requirepass ï¼ä»æå¡å¨æ²¡æè®¾ç½® masterauthï¼åä¸è¿è¡èº«ä»½éªè¯ï¼åä¹ï¼åéè¦è¿è¡èº«ä»½éªè¯ãå¦æèº«ä»½éªè¯å¤±è´¥ï¼åæ¾å¼æ§è¡å¤å¶å·¥ä½ã\n\nå¦æä¸»æå¡å¨éè¿ requirepass éé¡¹è®¾ç½®äºå¯ç ï¼ é£ä¹ä¸ºäºè®©ä»æå¡å¨çåæ­¥æä½å¯ä»¥é¡ºå©è¿è¡ï¼ æä»¬ä¹å¿é¡»ä¸ºä»æå¡å¨è¿è¡ç¸åºçèº«ä»½éªè¯è®¾ç½®ã\n\nå¯¹äºä¸ä¸ªæ­£å¨è¿è¡çæå¡å¨ï¼ å¯ä»¥ä½¿ç¨å®¢æ·ç«¯è¾å¥ä»¥ä¸å½ä»¤ï¼\n\nconfig set masterauth <password>\n\n\nè¦æ°¸ä¹å°è®¾ç½®è¿ä¸ªå¯ç ï¼ é£ä¹å¯ä»¥å°å®å å¥å°éç½®æä»¶ä¸­ï¼\n\nmasterauth <password>\n\n\nå¦å¤è¿æå ä¸ªéé¡¹ï¼ å®ä»¬åä¸»æå¡å¨æ§è¡é¨åéåæ­¥æ¶æä½¿ç¨çå¤å¶æµç¼å²åºæå³ï¼ è¯¦ç»çä¿¡æ¯å¯ä»¥åè redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# æ­¥éª¤ 5. åéç«¯å£ä¿¡æ¯ã\n\nä»æå¡å¨æ§è¡ replconf listening-port <port-number> ï¼åä¸»æå¡å¨åéä»æå¡å¨ççå¬ç«¯å£å·ã\n\n\n# æ­¥éª¤ 6. åæ­¥ã\n\nåæå·²ä»ç»ï¼æ­¤å¤ä¸èµè¿°ã\n\n\n# æ­¥éª¤ 7. å½ä»¤ä¼ æ­ã\n\nå¨å½ä»¤ä¼ æ­é¶æ®µï¼ä»æå¡å¨é»è®¤ä¼ä»¥æ¯ç§ä¸æ¬¡çé¢çï¼åä¸»æå¡åéå½ä»¤ï¼\n\nreplconf ack <replication_coffset>\n\n\nå½ä»¤çä½ç¨ï¼\n\n * æ£æµä¸»ä»æå¡å¨çç½ç»è¿æ¥ç¶æã\n * è¾å©å®ç° min-slave éé¡¹ã\n * æ£æµå½ä»¤ä¸¢å¤±ã\n\n\n# å­ãå¤å¶çéç½®é¡¹\n\nä» redis 2.8 å¼å§ï¼ ä¸ºäºä¿è¯æ°æ®çå®å¨æ§ï¼ å¯ä»¥éè¿éç½®ï¼ è®©ä¸»æå¡å¨åªå¨æè³å° n ä¸ªå½åå·²è¿æ¥ä»æå¡å¨çæåµä¸ï¼ ææ§è¡åå½ä»¤ã\n\nä¸è¿ï¼ å ä¸º redis ä½¿ç¨å¼æ­¥å¤å¶ï¼ æä»¥ä¸»æå¡å¨åéçåæ°æ®å¹¶ä¸ä¸å®ä¼è¢«ä»æå¡å¨æ¥æ¶å°ï¼ å æ­¤ï¼ æ°æ®ä¸¢å¤±çå¯è½æ§ä»ç¶æ¯å­å¨çã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çè¿ä½åçï¼\n\n * ä»æå¡å¨ä»¥æ¯ç§ä¸æ¬¡çé¢ç ping ä¸»æå¡å¨ä¸æ¬¡ï¼ å¹¶æ¥åå¤å¶æµçå¤çæåµã\n * ä¸»æå¡å¨ä¼è®°å½åä¸ªä»æå¡å¨æåä¸æ¬¡åå®åé ping çæ¶é´ã\n * ç¨æ·å¯ä»¥éè¿éç½®ï¼ æå®ç½ç»å»¶è¿çæå¤§å¼ min-slaves-max-lag ï¼ ä»¥åæ§è¡åæä½æéçè³å°ä»æå¡å¨æ°é min-slaves-to-write ã\n\nå¦æè³å°æ min-slaves-to-write ä¸ªä»æå¡å¨ï¼ å¹¶ä¸è¿äºæå¡å¨çå»¶è¿å¼é½å°äº min-slaves-max-lagç§ï¼ é£ä¹ä¸»æå¡å¨å°±ä¼æ§è¡å®¢æ·ç«¯è¯·æ±çåæä½ã\n\nä½ å¯ä»¥å°è¿ä¸ªç¹æ§çä½ cap çè®ºä¸­ç c çæ¡ä»¶æ¾å®½çæ¬ï¼ å°½ç®¡ä¸è½ä¿è¯åæä½çæä¹æ§ï¼ ä½èµ·ç ä¸¢å¤±æ°æ®ççªå£ä¼è¢«ä¸¥æ ¼éå¶å¨æå®çç§æ°ä¸­ã\n\nå¦ä¸æ¹é¢ï¼ å¦ææ¡ä»¶è¾¾ä¸å° min-slaves-to-write å min-slaves-max-lag ææå®çæ¡ä»¶ï¼ é£ä¹åæä½å°±ä¸ä¼è¢«æ§è¡ï¼ ä¸»æå¡å¨ä¼åè¯·æ±æ§è¡åæä½çå®¢æ·ç«¯è¿åä¸ä¸ªéè¯¯ã\n\nä»¥ä¸æ¯è¿ä¸ªç¹æ§çä¸¤ä¸ªéé¡¹åå®ä»¬æéçåæ°ï¼\n\n * min-slaves-to-write <number of slaves>\n * min-slaves-max-lag <number of seconds>\n\nè¯¦ç»çä¿¡æ¯å¯ä»¥åè redis æºç ä¸­éå¸¦ç redis.conf ç¤ºä¾æä»¶ã\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis å¨åµ",frontmatter:{title:"Redis å¨åµ",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","å¨åµ"],permalink:"/pages/5e23fc/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/06.Redis%E5%93%A8%E5%85%B5.html",relativePath:"05.KVæ°æ®åº/01.Redis/06.Rediså¨åµ.md",key:"v-d5c8af24",path:"/pages/5e23fc/",headers:[{level:2,title:"ä¸ãå¨åµç®ä»",slug:"ä¸ãå¨åµç®ä»",normalizedTitle:"ä¸ãå¨åµç®ä»",charIndex:107},{level:2,title:"äºãå¯å¨å¨åµ",slug:"äºãå¯å¨å¨åµ",normalizedTitle:"äºãå¯å¨å¨åµ",charIndex:711},{level:2,title:"ä¸ãçæ§",slug:"ä¸ãçæ§",normalizedTitle:"ä¸ãçæ§",charIndex:1312},{level:3,title:"æ£æµæå¡å¨ç¶æ",slug:"æ£æµæå¡å¨ç¶æ",normalizedTitle:"æ£æµæå¡å¨ç¶æ",charIndex:1321},{level:3,title:"è·åæå¡å¨ä¿¡æ¯",slug:"è·åæå¡å¨ä¿¡æ¯",normalizedTitle:"è·åæå¡å¨ä¿¡æ¯",charIndex:1813},{level:2,title:"åãéç¥",slug:"åãéç¥",normalizedTitle:"åãéç¥",charIndex:2153},{level:3,title:"åæå¡å¨åéæ¶æ¯",slug:"åæå¡å¨åéæ¶æ¯",normalizedTitle:"åæå¡å¨åéæ¶æ¯",charIndex:2265},{level:3,title:"æ¥æ¶æå¡å¨çæ¶æ¯",slug:"æ¥æ¶æå¡å¨çæ¶æ¯",normalizedTitle:"æ¥æ¶æå¡å¨çæ¶æ¯",charIndex:2479},{level:2,title:"äºãéä¸¾ Leader",slug:"äºãéä¸¾-leader",normalizedTitle:"äºãéä¸¾ leader",charIndex:2648},{level:2,title:"å­ãæéè½¬ç§»",slug:"å­ãæéè½¬ç§»",normalizedTitle:"å­ãæéè½¬ç§»",charIndex:3808},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:4486}],headersStr:"ä¸ãå¨åµç®ä» äºãå¯å¨å¨åµ ä¸ãçæ§ æ£æµæå¡å¨ç¶æ è·åæå¡å¨ä¿¡æ¯ åãéç¥ åæå¡å¨åéæ¶æ¯ æ¥æ¶æå¡å¨çæ¶æ¯ äºãéä¸¾ Leader å­ãæéè½¬ç§» åèèµæ",content:'# Redis å¨åµ\n\n> Redis å¨åµï¼Sentinelï¼æ¯ Redis çé«å¯ç¨æ§ï¼Hight Availabilityï¼è§£å³æ¹æ¡ã\n> \n> Redis å¨åµæ¯ Raft ç®æ³ çå·ä½å®ç°ã\n\n\n\n\n# ä¸ãå¨åµç®ä»\n\nRedis å¨åµï¼Sentinelï¼æ¯ Redis çé«å¯ç¨æ§ï¼Hight Availabilityï¼è§£å³æ¹æ¡ï¼ç±ä¸ä¸ªæå¤ä¸ª Sentinel å®ä¾ç»æç Sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\nSentinel çä¸»è¦åè½å¦ä¸ï¼\n\n * çæ§ï¼Monitoringï¼ - Sentinel ä¸æ­æ£æ¥ä¸»ä»æå¡å¨æ¯å¦æ­£å¸¸å¨å·¥ä½ã\n * éç¥ï¼Notificationï¼ - Sentinel å¯ä»¥éè¿ä¸ä¸ª api æ¥éç¥ç³»ç»ç®¡çåæèå¦å¤çåºç¨ç¨åºï¼è¢«çæ§ç Redis å®ä¾æä¸äºé®é¢ã\n * èªå¨æéè½¬ç§»ï¼Automatic Failoverï¼ - å¦æä¸ä¸ªä¸»æå¡å¨ä¸çº¿ï¼Sentinel ä¼å¼å§èªå¨æéè½¬ç§»ï¼æä¸ä¸ªä»èç¹æåä¸ºä¸»èç¹ï¼å¹¶éæ°éç½®å¶ä»çä»èç¹ä½¿ç¨æ°çä¸»èç¹ï¼ä½¿ç¨ Redis æå¡çåºç¨ç¨åºå¨è¿æ¥çæ¶åä¹è¢«éç¥æ°çå°åã\n * éç½®æä¾èï¼Configuration providerï¼ - Sentinel ç»å®¢æ·ç«¯çæå¡åç°æä¾æ¥æºï¼å¯¹äºä¸ä¸ªç»å®çæå¡ï¼å®¢æ·ç«¯è¿æ¥å° Sentinels æ¥å¯»æ¾å½åä¸»èç¹çå°åãå½æéè½¬ç§»åççæ¶åï¼Sentinel å°æ¥åæ°çå°åã\n\n\n# äºãå¯å¨å¨åµ\n\nå¯å¨ä¸ä¸ª Sentinel å¯ä»¥ä½¿ç¨ä¸é¢ä»»æä¸æ¡å½ä»¤ï¼ä¸¤æ¡å½ä»¤ææå®å¨ç¸åã\n\nredis-sentinel /path/to/sentinel.conf\nredis-server /path/to/sentinel.conf --sentinel\n\n\nå½ä¸ä¸ª Sentinel å¯å¨æ¶ï¼å®éè¦æ§è¡ä»¥ä¸æ­¥éª¤ï¼\n\n 1. åå§åæå¡å¨ã\n 2. ä½¿ç¨ Sentinel ä¸ç¨ä»£ç ã\n 3. åå§å Sentinel ç¶æã\n 4. åå§å Sentinel çä¸»æå¡å¨åè¡¨ã\n 5. åå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ã\n\nSentinel æ¬è´¨ä¸æ¯ä¸ä¸ªè¿è¡å¨ç¹æ®ç¶æ¨¡å¼ä¸ç Redis æå¡å¨ã\n\nSentinel æ¨¡å¼ä¸ Redis æå¡å¨åªæ¯æ PINGãSENTINELãINFOãSUBSCRIBEãUNSUBSCRIBEãPSUBSCRIBEãPUNSUBSCRIBE ä¸ä¸ªå½ä»¤ã\n\nåå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ï¼Sentinel å°æä¸ºä¸»æå¡å¨çå®¢æ·ç«¯ï¼å®å¯ä»¥åä¸»æå¡å¨åéå½ä»¤ï¼å¹¶ä»å½ä»¤åå¤ä¸­è·åç¸å³çä¿¡æ¯ãå¯¹äºæ¯ä¸ªè¢« Sentinel çè§çä¸»æå¡å¨ï¼Sentinel ä¼åå»ºä¸¤ä¸ªè¿åä¸»æå¡å¨çå¼æ­¥ç½ç»ï¼\n\n * å½ä»¤è¿æ¥ï¼ä¸é¨ç¨äºåä¸»æå¡å¨åéå½ä»¤ï¼å¹¶æ¥åå½ä»¤åå¤ã\n * è®¢éè¿æ¥ï¼ä¸é¨ç¨äºè®¢éä¸»æå¡å¨ç __sentinel__:hello é¢éã\n\n\n# ä¸ãçæ§\n\n\n# æ£æµæå¡å¨ç¶æ\n\n> Sentinel å Redis æå¡å¨åé PING å½ä»¤ï¼æ£æ¥å¶ç¶æã\n\né»è®¤æåµä¸ï¼æ¯ä¸ª Sentinel èç¹ä¼ä»¥ æ¯ç§ä¸æ¬¡ çé¢çå¯¹ Redis èç¹å å¶å® ç Sentinel èç¹åé PING å½ä»¤ï¼å¹¶éè¿èç¹ç åå¤ æ¥å¤æ­èç¹æ¯å¦å¨çº¿ã\n\n * ä¸»è§ä¸çº¿ï¼ä¸»è§ä¸çº¿ éç¨äºææ ä¸»èç¹ å ä»èç¹ãå¦æå¨ down-after-milliseconds æ¯«ç§åï¼Sentinel æ²¡ææ¶å° ç®æ èç¹ çææåå¤ï¼åä¼å¤å® è¯¥èç¹ ä¸º ä¸»è§ä¸çº¿ã\n * å®¢è§ä¸çº¿ï¼å®¢è§ä¸çº¿ åªéç¨äº ä¸»èç¹ãå½ Sentinel å°ä¸ä¸ªä¸»æå¡å¨å¤æ­ä¸ºä¸»ç®¡ä¸çº¿åï¼ä¸ºäºç¡®è®¤è¿ä¸ªä¸»æå¡å¨æ¯å¦ççä¸çº¿ï¼ä¼ååæ ·çè§è¿ä¸ä¸»æå¡å¨çå¶ä» Sentinel è¯¢é®ï¼çå®ä»¬æ¯å¦ä¹è®¤ä¸ºä¸»æå¡å¨å·²ç»ä¸çº¿ãå½è¶³å¤æ°éç Sentinel è®¤ä¸ºä¸»æå¡å¨å·²ä¸çº¿ï¼å°±å¤å®å¶ä¸ºå®¢è§ä¸çº¿ï¼å¹¶å¯¹å¶æ§è¡æéè½¬ç§»æä½ã\n   * Sentinel èç¹éè¿ sentinel is-master-down-by-addr å½ä»¤ï¼åå¶å® Sentinel èç¹è¯¢é®å¯¹è¯¥èç¹ç ç¶æå¤æ­ã\n\n\n# è·åæå¡å¨ä¿¡æ¯\n\n> Sentinel åä¸»æå¡å¨åé INFO å½ä»¤ï¼è·åä¸»æå¡å¨åå®çä»æå¡å¨ä¿¡æ¯ã\n\n * è·åä¸»æå¡å¨ä¿¡æ¯ - Sentinel é»è®¤ä¼ä»¥æ¯åç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤è¿æ¥åè¢«çè§çä¸»æå¡å¨åé INFO å½ä»¤ï¼å¹¶éè¿åæ INFO å½ä»¤çåå¤æ¥è·åä¸»æå¡å¨çå½åä¿¡æ¯ã\n   * ä¸»æå¡èªèº«ä¿¡æ¯ï¼åæ¬ run_id åè®°å½çæå¡å¨è¿è¡ IDï¼ä»¥å role åè®°å½çæå¡å¨è§è²\n   * ä¸»æå¡çä»æå¡å¨ä¿¡æ¯ï¼åæ¬ IP å°ååç«¯å£å·\n * è·åä»æå¡å¨ä¿¡æ¯ - å½ Sentinel åç°ä¸»æå¡å¨ææ°çä»æå¡å¨åºç°æ¶ï¼Sentinel é¤äºä¼ä¸ºè¿ä¸ªæ°çä»æå¡å¨åå»ºç¸åºçå®ä¾ç»æä¹å¤ï¼Sentinel è¿ä¼åå»ºè¿æ¥å°ä»æå¡å¨çå½ä»¤è¿æ¥åè®¢éè¿æ¥ã\n\n\n# åãéç¥\n\nå¯¹äºæ¯ä¸ªä¸ Sentinel è¿æ¥çæå¡å¨ï¼Sentinel æ¢ä¼åæå¡å¨ç __sentinel__:hello é¢éåéæ¶æ¯ï¼ä¹ä¼è®¢éæå¡å¨ç __sentinel__:hello é¢éçæ¶æ¯ã\n\n\n\n\n# åæå¡å¨åéæ¶æ¯\n\nå¨é»è®¤æåµä¸ï¼Sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤åææè¢«çè§çä¸»æå¡å¨åä»æå¡å¨åéä»¥ä¸æ ¼å¼çå½ä»¤ã\n\nPUBLISH __sentinel__:hello "<s_ip>,<s_port>,<s_runid>,<s_epoch>,<m_name>,<m_ip>,<m_port>,<m_epoch>"\n\n\nè¿æ¡å½ä»¤åæå¡å¨ç __sentinel__:hello é¢éåéä¸æ¡æ¶æ¯ã\n\n\n# æ¥æ¶æå¡å¨çæ¶æ¯\n\nå½ Sentinel ä¸ä¸ä¸ªä¸»æå¡å¨æä»æå¡å¨å»ºç«èµ·è®¢éè¿æ¥åï¼Sentinel å°±ä¼éè¿è®¢éè¿æ¥ï¼åæå¡å¨åéä»¥ä¸å½ä»¤ï¼SUBSCRIBE __sentinel__:helloã\n\nSentinel å¯¹ __sentinel__:hello é¢éçè®¢éä¼ä¸ç´æç»­å° Sentinel ä¸æå¡å¨æ­å¼è¿æ¥ä¸ºæ­¢ã\n\n\n# äºãéä¸¾ Leader\n\n> Redis Sentinel ç³»ç»éä¸¾ Leader çç®æ³æ¯ Raft çå®ç°ã\n> \n> Raft æ¯ä¸ç§å±è¯æ§ç®æ³ï¼æ³äºè§£å¶åçï¼å¯ä»¥åè æ·±å¥åæå±è¯æ§ç®æ³ Raftã\n\nå½ä¸ä¸ªä¸»æå¡å¨è¢«å¤æ­ä¸ºå®¢è§ä¸çº¿æ¶ï¼çè§è¿ä¸ªä¸çº¿ä¸»æå¡å¨çåä¸ª Sentinel ä¼è¿è¡ååï¼éä¸¾åºä¸ä¸ªé¢å¤´ç Sentinelï¼å¹¶ç±é¢å¤´ Sentinel å¯¹ä¸çº¿ä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ã\n\nææå¨çº¿ Sentinel é½æèµæ ¼è¢«éä¸º Leaderã\n\næ¯ä¸ª Sentinel èç¹é½éè¦ å®ææ§è¡ ä»¥ä¸ä»»å¡ï¼\n\nï¼1ï¼æ¯ä¸ª Sentinel ä»¥ æ¯ç§é ä¸æ¬¡çé¢çï¼åå®æç¥ç ä¸»æå¡å¨ãä»æå¡å¨ ä»¥åå¶ä» Sentinel å®ä¾ åéä¸ä¸ª PING å½ä»¤ã\n\n\n\nï¼2ï¼å¦æä¸ä¸ª å®ä¾ï¼instanceï¼è·ç¦» æåä¸æ¬¡ ææåå¤ PING å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds ææå®çå¼ï¼é£ä¹è¿ä¸ªå®ä¾ä¼è¢« Sentinel æ è®°ä¸º ä¸»è§ä¸çº¿ã\n\n\n\nï¼3ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼é£ä¹æ­£å¨ çè§ è¿ä¸ª ä¸»æå¡å¨ çææ Sentinel èç¹ï¼è¦ä»¥ æ¯ç§ä¸æ¬¡ çé¢çç¡®è®¤ ä¸»æå¡å¨ çç¡®è¿å¥äº ä¸»è§ä¸çº¿ ç¶æã\n\n\n\nï¼4ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼å¹¶ä¸æ è¶³å¤æ°é ç Sentinelï¼è³å°è¦è¾¾å° éç½®æä»¶ æå®çæ°éï¼å¨æå®ç æ¶é´èå´ ååæè¿ä¸å¤æ­ï¼é£ä¹è¿ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º å®¢è§ä¸çº¿ã\n\n\n\nï¼5ï¼å¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª Sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çï¼åå®å·²ç¥çææ ä¸»æå¡å¨ å ä»æå¡å¨ åé INFO å½ä»¤ãå½ä¸ä¸ª ä¸»æå¡å¨ è¢« Sentinel æ è®°ä¸º å®¢è§ä¸çº¿ æ¶ï¼Sentinel å ä¸çº¿ä¸»æå¡å¨ çææ ä»æå¡å¨ åé INFO å½ä»¤çé¢çï¼ä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸º æ¯ç§ä¸æ¬¡ã\n\n\n\nï¼6ï¼Sentinel åå¶ä» Sentinel åå ä¸»èç¹ çç¶æï¼å¦æ ä¸»èç¹ å¤äº SDOWN ç¶æï¼åæç¥¨èªå¨éåºæ°ç ä¸»èç¹ãå°å©ä½ç ä»èç¹ æå æ°çä¸»èç¹ è¿è¡ æ°æ®å¤å¶ã\n\n\n\nï¼7ï¼å½æ²¡æè¶³å¤æ°éç Sentinel åæ ä¸»æå¡å¨ ä¸çº¿æ¶ï¼ ä¸»æå¡å¨ ç å®¢è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ãå½ ä¸»æå¡å¨ éæ°å Sentinel ç PING å½ä»¤è¿å ææåå¤ æ¶ï¼ä¸»æå¡å¨ ç ä¸»è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ã\n\n\n\n> æ³¨æï¼ä¸ä¸ªææç PING åå¤å¯ä»¥æ¯ï¼+PONGã-LOADING æè -MASTERDOWNãå¦æ æå¡å¨ è¿åé¤ä»¥ä¸ä¸ç§åå¤ä¹å¤çå¶ä»åå¤ï¼åæèå¨ æå®æ¶é´ åæ²¡æåå¤ PING å½ä»¤ï¼ é£ä¹ Sentinel è®¤ä¸ºæå¡å¨è¿åçåå¤ æ æï¼non-validï¼ã\n\n\n# å­ãæéè½¬ç§»\n\nå¨éä¸¾äº§çåº Sentinel Leader åï¼Sentinel Leader å°å¯¹å·²ä¸çº¿çä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ãæä½å«ä»¥ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nï¼ä¸ï¼éåºæ°çä¸»æå¡å¨\n\næéè½¬ç§»ç¬¬ä¸æ­¥ï¼æ¯ Sentinel Leader å¨å·²ä¸çº¿ä¸»æå¡å±ä¸çææä»æå¡å¨ä¸­ï¼æéä¸ä¸ªç¶æè¯å¥½ãæ°æ®å®æ´çä»æå¡å¨ãç¶åï¼åè¿ä¸ªä»æå¡å¨åé SLAVEOF no one å½ä»¤ï¼å°å¶è½¬æ¢ä¸ºä¸»æå¡å¨ã\n\nSentinel Leader å¦ä½éåºæ°çä¸»æå¡å¨ï¼\n\n * å é¤åè¡¨ä¸­ææå¤äºä¸çº¿ææ­çº¿ç¶æçä»æå¡å¨ã\n * å é¤åè¡¨ä¸­æææè¿äºç§æ²¡æåå¤è¿ Sentinel Leader ç INFO å½ä»¤çä»æå¡å¨ã\n * å é¤ææä¸å·²ä¸çº¿ä¸»æå¡å¨è¿æ¥æ­å¼è¶è¿ down-after-milliseconds * 10 æ¯«ç§çä»æå¡å¨ï¼down-after-milliseconds æå®äºå¤æ­ä¸»æå¡å¨ä¸çº¿æéçæ¶é´ï¼ã\n * ä¹åï¼ Sentinel Leader åéåºä¼åçº§æé«çä»æå¡å¨ï¼å¦æä¼åçº§ä¸æ ·é«ï¼åéæ©å¤å¶åç§»éæå¤§çä»æå¡å¨ï¼å¦æç»æè¿ä¸å¯ä¸ï¼åéåºè¿è¡ ID æå°çä»æå¡å¨ã\n\nï¼äºï¼ä¿®æ¹ä»æå¡å¨çå¤å¶ç®æ \n\néåºæ°çä¸»æå¡å¨åï¼Sentinel Leader ä¼åææä»æå¡å¨åé SLAVEOF å½ä»¤ï¼è®©å®ä»¬å»å¤å¶æ°çä¸»æå¡å¨ã\n\nï¼ä¸ï¼å°æ§çä¸»æå¡å¨åä¸ºä»æå¡å¨\n\nSentinel Leader å°æ§çä¸»æå¡å¨æ è®°ä¸ºä»æå¡å¨ãå½æ§çä¸»æå¡å¨éæ°ä¸çº¿ï¼Sentinel ä¼åå®åé SLAVEOF å½ä»¤ï¼è®©å¶æä¸ºä»æå¡å¨ã\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * æ¸è¿å¼è§£æ Redis æºç  - å¨åµ sentinel\n   * æ·±å¥åæ Redis ç³»å(äº) - Redis å¨åµæ¨¡å¼ä¸é«å¯ç¨éç¾¤',normalizedContent:'# redis å¨åµ\n\n> redis å¨åµï¼sentinelï¼æ¯ redis çé«å¯ç¨æ§ï¼hight availabilityï¼è§£å³æ¹æ¡ã\n> \n> redis å¨åµæ¯ raft ç®æ³ çå·ä½å®ç°ã\n\n\n\n\n# ä¸ãå¨åµç®ä»\n\nredis å¨åµï¼sentinelï¼æ¯ redis çé«å¯ç¨æ§ï¼hight availabilityï¼è§£å³æ¹æ¡ï¼ç±ä¸ä¸ªæå¤ä¸ª sentinel å®ä¾ç»æç sentinel ç³»ç»å¯ä»¥çè§ä»»æå¤ä¸ªä¸»æå¡å¨ï¼ä»¥åè¿äºä¸»æå¡å¨çææä»æå¡å¨ï¼å¹¶å¨è¢«çè§çä¸»æå¡å¨è¿å¥ä¸çº¿ç¶ææ¶ï¼èªå¨å°ä¸çº¿ä¸»æå¡å¨çæä¸ªä»æå¡å¨åçº§ä¸ºæ°çä¸»æå¡å¨ï¼ç¶åç±æ°çä¸»æå¡å¨ä»£æ¿å·²ä¸çº¿çä¸»æå¡å¨ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n\nsentinel çä¸»è¦åè½å¦ä¸ï¼\n\n * çæ§ï¼monitoringï¼ - sentinel ä¸æ­æ£æ¥ä¸»ä»æå¡å¨æ¯å¦æ­£å¸¸å¨å·¥ä½ã\n * éç¥ï¼notificationï¼ - sentinel å¯ä»¥éè¿ä¸ä¸ª api æ¥éç¥ç³»ç»ç®¡çåæèå¦å¤çåºç¨ç¨åºï¼è¢«çæ§ç redis å®ä¾æä¸äºé®é¢ã\n * èªå¨æéè½¬ç§»ï¼automatic failoverï¼ - å¦æä¸ä¸ªä¸»æå¡å¨ä¸çº¿ï¼sentinel ä¼å¼å§èªå¨æéè½¬ç§»ï¼æä¸ä¸ªä»èç¹æåä¸ºä¸»èç¹ï¼å¹¶éæ°éç½®å¶ä»çä»èç¹ä½¿ç¨æ°çä¸»èç¹ï¼ä½¿ç¨ redis æå¡çåºç¨ç¨åºå¨è¿æ¥çæ¶åä¹è¢«éç¥æ°çå°åã\n * éç½®æä¾èï¼configuration providerï¼ - sentinel ç»å®¢æ·ç«¯çæå¡åç°æä¾æ¥æºï¼å¯¹äºä¸ä¸ªç»å®çæå¡ï¼å®¢æ·ç«¯è¿æ¥å° sentinels æ¥å¯»æ¾å½åä¸»èç¹çå°åãå½æéè½¬ç§»åççæ¶åï¼sentinel å°æ¥åæ°çå°åã\n\n\n# äºãå¯å¨å¨åµ\n\nå¯å¨ä¸ä¸ª sentinel å¯ä»¥ä½¿ç¨ä¸é¢ä»»æä¸æ¡å½ä»¤ï¼ä¸¤æ¡å½ä»¤ææå®å¨ç¸åã\n\nredis-sentinel /path/to/sentinel.conf\nredis-server /path/to/sentinel.conf --sentinel\n\n\nå½ä¸ä¸ª sentinel å¯å¨æ¶ï¼å®éè¦æ§è¡ä»¥ä¸æ­¥éª¤ï¼\n\n 1. åå§åæå¡å¨ã\n 2. ä½¿ç¨ sentinel ä¸ç¨ä»£ç ã\n 3. åå§å sentinel ç¶æã\n 4. åå§å sentinel çä¸»æå¡å¨åè¡¨ã\n 5. åå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ã\n\nsentinel æ¬è´¨ä¸æ¯ä¸ä¸ªè¿è¡å¨ç¹æ®ç¶æ¨¡å¼ä¸ç redis æå¡å¨ã\n\nsentinel æ¨¡å¼ä¸ redis æå¡å¨åªæ¯æ pingãsentinelãinfoãsubscribeãunsubscribeãpsubscribeãpunsubscribe ä¸ä¸ªå½ä»¤ã\n\nåå»ºè¿åè¢«çè§çä¸»æå¡å¨çç½ç»è¿æ¥ï¼sentinel å°æä¸ºä¸»æå¡å¨çå®¢æ·ç«¯ï¼å®å¯ä»¥åä¸»æå¡å¨åéå½ä»¤ï¼å¹¶ä»å½ä»¤åå¤ä¸­è·åç¸å³çä¿¡æ¯ãå¯¹äºæ¯ä¸ªè¢« sentinel çè§çä¸»æå¡å¨ï¼sentinel ä¼åå»ºä¸¤ä¸ªè¿åä¸»æå¡å¨çå¼æ­¥ç½ç»ï¼\n\n * å½ä»¤è¿æ¥ï¼ä¸é¨ç¨äºåä¸»æå¡å¨åéå½ä»¤ï¼å¹¶æ¥åå½ä»¤åå¤ã\n * è®¢éè¿æ¥ï¼ä¸é¨ç¨äºè®¢éä¸»æå¡å¨ç __sentinel__:hello é¢éã\n\n\n# ä¸ãçæ§\n\n\n# æ£æµæå¡å¨ç¶æ\n\n> sentinel å redis æå¡å¨åé ping å½ä»¤ï¼æ£æ¥å¶ç¶æã\n\né»è®¤æåµä¸ï¼æ¯ä¸ª sentinel èç¹ä¼ä»¥ æ¯ç§ä¸æ¬¡ çé¢çå¯¹ redis èç¹å å¶å® ç sentinel èç¹åé ping å½ä»¤ï¼å¹¶éè¿èç¹ç åå¤ æ¥å¤æ­èç¹æ¯å¦å¨çº¿ã\n\n * ä¸»è§ä¸çº¿ï¼ä¸»è§ä¸çº¿ éç¨äºææ ä¸»èç¹ å ä»èç¹ãå¦æå¨ down-after-milliseconds æ¯«ç§åï¼sentinel æ²¡ææ¶å° ç®æ èç¹ çææåå¤ï¼åä¼å¤å® è¯¥èç¹ ä¸º ä¸»è§ä¸çº¿ã\n * å®¢è§ä¸çº¿ï¼å®¢è§ä¸çº¿ åªéç¨äº ä¸»èç¹ãå½ sentinel å°ä¸ä¸ªä¸»æå¡å¨å¤æ­ä¸ºä¸»ç®¡ä¸çº¿åï¼ä¸ºäºç¡®è®¤è¿ä¸ªä¸»æå¡å¨æ¯å¦ççä¸çº¿ï¼ä¼ååæ ·çè§è¿ä¸ä¸»æå¡å¨çå¶ä» sentinel è¯¢é®ï¼çå®ä»¬æ¯å¦ä¹è®¤ä¸ºä¸»æå¡å¨å·²ç»ä¸çº¿ãå½è¶³å¤æ°éç sentinel è®¤ä¸ºä¸»æå¡å¨å·²ä¸çº¿ï¼å°±å¤å®å¶ä¸ºå®¢è§ä¸çº¿ï¼å¹¶å¯¹å¶æ§è¡æéè½¬ç§»æä½ã\n   * sentinel èç¹éè¿ sentinel is-master-down-by-addr å½ä»¤ï¼åå¶å® sentinel èç¹è¯¢é®å¯¹è¯¥èç¹ç ç¶æå¤æ­ã\n\n\n# è·åæå¡å¨ä¿¡æ¯\n\n> sentinel åä¸»æå¡å¨åé info å½ä»¤ï¼è·åä¸»æå¡å¨åå®çä»æå¡å¨ä¿¡æ¯ã\n\n * è·åä¸»æå¡å¨ä¿¡æ¯ - sentinel é»è®¤ä¼ä»¥æ¯åç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤è¿æ¥åè¢«çè§çä¸»æå¡å¨åé info å½ä»¤ï¼å¹¶éè¿åæ info å½ä»¤çåå¤æ¥è·åä¸»æå¡å¨çå½åä¿¡æ¯ã\n   * ä¸»æå¡èªèº«ä¿¡æ¯ï¼åæ¬ run_id åè®°å½çæå¡å¨è¿è¡ idï¼ä»¥å role åè®°å½çæå¡å¨è§è²\n   * ä¸»æå¡çä»æå¡å¨ä¿¡æ¯ï¼åæ¬ ip å°ååç«¯å£å·\n * è·åä»æå¡å¨ä¿¡æ¯ - å½ sentinel åç°ä¸»æå¡å¨ææ°çä»æå¡å¨åºç°æ¶ï¼sentinel é¤äºä¼ä¸ºè¿ä¸ªæ°çä»æå¡å¨åå»ºç¸åºçå®ä¾ç»æä¹å¤ï¼sentinel è¿ä¼åå»ºè¿æ¥å°ä»æå¡å¨çå½ä»¤è¿æ¥åè®¢éè¿æ¥ã\n\n\n# åãéç¥\n\nå¯¹äºæ¯ä¸ªä¸ sentinel è¿æ¥çæå¡å¨ï¼sentinel æ¢ä¼åæå¡å¨ç __sentinel__:hello é¢éåéæ¶æ¯ï¼ä¹ä¼è®¢éæå¡å¨ç __sentinel__:hello é¢éçæ¶æ¯ã\n\n\n\n\n# åæå¡å¨åéæ¶æ¯\n\nå¨é»è®¤æåµä¸ï¼sentinel ä¼ä»¥æ¯ä¸¤ç§ä¸æ¬¡çé¢çï¼éè¿å½ä»¤åææè¢«çè§çä¸»æå¡å¨åä»æå¡å¨åéä»¥ä¸æ ¼å¼çå½ä»¤ã\n\npublish __sentinel__:hello "<s_ip>,<s_port>,<s_runid>,<s_epoch>,<m_name>,<m_ip>,<m_port>,<m_epoch>"\n\n\nè¿æ¡å½ä»¤åæå¡å¨ç __sentinel__:hello é¢éåéä¸æ¡æ¶æ¯ã\n\n\n# æ¥æ¶æå¡å¨çæ¶æ¯\n\nå½ sentinel ä¸ä¸ä¸ªä¸»æå¡å¨æä»æå¡å¨å»ºç«èµ·è®¢éè¿æ¥åï¼sentinel å°±ä¼éè¿è®¢éè¿æ¥ï¼åæå¡å¨åéä»¥ä¸å½ä»¤ï¼subscribe __sentinel__:helloã\n\nsentinel å¯¹ __sentinel__:hello é¢éçè®¢éä¼ä¸ç´æç»­å° sentinel ä¸æå¡å¨æ­å¼è¿æ¥ä¸ºæ­¢ã\n\n\n# äºãéä¸¾ leader\n\n> redis sentinel ç³»ç»éä¸¾ leader çç®æ³æ¯ raft çå®ç°ã\n> \n> raft æ¯ä¸ç§å±è¯æ§ç®æ³ï¼æ³äºè§£å¶åçï¼å¯ä»¥åè æ·±å¥åæå±è¯æ§ç®æ³ raftã\n\nå½ä¸ä¸ªä¸»æå¡å¨è¢«å¤æ­ä¸ºå®¢è§ä¸çº¿æ¶ï¼çè§è¿ä¸ªä¸çº¿ä¸»æå¡å¨çåä¸ª sentinel ä¼è¿è¡ååï¼éä¸¾åºä¸ä¸ªé¢å¤´ç sentinelï¼å¹¶ç±é¢å¤´ sentinel å¯¹ä¸çº¿ä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ã\n\nææå¨çº¿ sentinel é½æèµæ ¼è¢«éä¸º leaderã\n\næ¯ä¸ª sentinel èç¹é½éè¦ å®ææ§è¡ ä»¥ä¸ä»»å¡ï¼\n\nï¼1ï¼æ¯ä¸ª sentinel ä»¥ æ¯ç§é ä¸æ¬¡çé¢çï¼åå®æç¥ç ä¸»æå¡å¨ãä»æå¡å¨ ä»¥åå¶ä» sentinel å®ä¾ åéä¸ä¸ª ping å½ä»¤ã\n\n\n\nï¼2ï¼å¦æä¸ä¸ª å®ä¾ï¼instanceï¼è·ç¦» æåä¸æ¬¡ ææåå¤ ping å½ä»¤çæ¶é´è¶è¿ down-after-milliseconds ææå®çå¼ï¼é£ä¹è¿ä¸ªå®ä¾ä¼è¢« sentinel æ è®°ä¸º ä¸»è§ä¸çº¿ã\n\n\n\nï¼3ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼é£ä¹æ­£å¨ çè§ è¿ä¸ª ä¸»æå¡å¨ çææ sentinel èç¹ï¼è¦ä»¥ æ¯ç§ä¸æ¬¡ çé¢çç¡®è®¤ ä¸»æå¡å¨ çç¡®è¿å¥äº ä¸»è§ä¸çº¿ ç¶æã\n\n\n\nï¼4ï¼å¦æä¸ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º ä¸»è§ä¸çº¿ï¼å¹¶ä¸æ è¶³å¤æ°é ç sentinelï¼è³å°è¦è¾¾å° éç½®æä»¶ æå®çæ°éï¼å¨æå®ç æ¶é´èå´ ååæè¿ä¸å¤æ­ï¼é£ä¹è¿ä¸ª ä¸»æå¡å¨ è¢«æ è®°ä¸º å®¢è§ä¸çº¿ã\n\n\n\nï¼5ï¼å¨ä¸è¬æåµä¸ï¼ æ¯ä¸ª sentinel ä¼ä»¥æ¯ 10 ç§ä¸æ¬¡çé¢çï¼åå®å·²ç¥çææ ä¸»æå¡å¨ å ä»æå¡å¨ åé info å½ä»¤ãå½ä¸ä¸ª ä¸»æå¡å¨ è¢« sentinel æ è®°ä¸º å®¢è§ä¸çº¿ æ¶ï¼sentinel å ä¸çº¿ä¸»æå¡å¨ çææ ä»æå¡å¨ åé info å½ä»¤çé¢çï¼ä¼ä» 10 ç§ä¸æ¬¡æ¹ä¸º æ¯ç§ä¸æ¬¡ã\n\n\n\nï¼6ï¼sentinel åå¶ä» sentinel åå ä¸»èç¹ çç¶æï¼å¦æ ä¸»èç¹ å¤äº sdown ç¶æï¼åæç¥¨èªå¨éåºæ°ç ä¸»èç¹ãå°å©ä½ç ä»èç¹ æå æ°çä¸»èç¹ è¿è¡ æ°æ®å¤å¶ã\n\n\n\nï¼7ï¼å½æ²¡æè¶³å¤æ°éç sentinel åæ ä¸»æå¡å¨ ä¸çº¿æ¶ï¼ ä¸»æå¡å¨ ç å®¢è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ãå½ ä¸»æå¡å¨ éæ°å sentinel ç ping å½ä»¤è¿å ææåå¤ æ¶ï¼ä¸»æå¡å¨ ç ä¸»è§ä¸çº¿ç¶æ å°±ä¼è¢«ç§»é¤ã\n\n\n\n> æ³¨æï¼ä¸ä¸ªææç ping åå¤å¯ä»¥æ¯ï¼+pongã-loading æè -masterdownãå¦æ æå¡å¨ è¿åé¤ä»¥ä¸ä¸ç§åå¤ä¹å¤çå¶ä»åå¤ï¼åæèå¨ æå®æ¶é´ åæ²¡æåå¤ ping å½ä»¤ï¼ é£ä¹ sentinel è®¤ä¸ºæå¡å¨è¿åçåå¤ æ æï¼non-validï¼ã\n\n\n# å­ãæéè½¬ç§»\n\nå¨éä¸¾äº§çåº sentinel leader åï¼sentinel leader å°å¯¹å·²ä¸çº¿çä¸»æå¡å¨æ§è¡æéè½¬ç§»æä½ãæä½å«ä»¥ä¸ä¸ä¸ªæ­¥éª¤ï¼\n\nï¼ä¸ï¼éåºæ°çä¸»æå¡å¨\n\næéè½¬ç§»ç¬¬ä¸æ­¥ï¼æ¯ sentinel leader å¨å·²ä¸çº¿ä¸»æå¡å±ä¸çææä»æå¡å¨ä¸­ï¼æéä¸ä¸ªç¶æè¯å¥½ãæ°æ®å®æ´çä»æå¡å¨ãç¶åï¼åè¿ä¸ªä»æå¡å¨åé slaveof no one å½ä»¤ï¼å°å¶è½¬æ¢ä¸ºä¸»æå¡å¨ã\n\nsentinel leader å¦ä½éåºæ°çä¸»æå¡å¨ï¼\n\n * å é¤åè¡¨ä¸­ææå¤äºä¸çº¿ææ­çº¿ç¶æçä»æå¡å¨ã\n * å é¤åè¡¨ä¸­æææè¿äºç§æ²¡æåå¤è¿ sentinel leader ç info å½ä»¤çä»æå¡å¨ã\n * å é¤ææä¸å·²ä¸çº¿ä¸»æå¡å¨è¿æ¥æ­å¼è¶è¿ down-after-milliseconds * 10 æ¯«ç§çä»æå¡å¨ï¼down-after-milliseconds æå®äºå¤æ­ä¸»æå¡å¨ä¸çº¿æéçæ¶é´ï¼ã\n * ä¹åï¼ sentinel leader åéåºä¼åçº§æé«çä»æå¡å¨ï¼å¦æä¼åçº§ä¸æ ·é«ï¼åéæ©å¤å¶åç§»éæå¤§çä»æå¡å¨ï¼å¦æç»æè¿ä¸å¯ä¸ï¼åéåºè¿è¡ id æå°çä»æå¡å¨ã\n\nï¼äºï¼ä¿®æ¹ä»æå¡å¨çå¤å¶ç®æ \n\néåºæ°çä¸»æå¡å¨åï¼sentinel leader ä¼åææä»æå¡å¨åé slaveof å½ä»¤ï¼è®©å®ä»¬å»å¤å¶æ°çä¸»æå¡å¨ã\n\nï¼ä¸ï¼å°æ§çä¸»æå¡å¨åä¸ºä»æå¡å¨\n\nsentinel leader å°æ§çä¸»æå¡å¨æ è®°ä¸ºä»æå¡å¨ãå½æ§çä¸»æå¡å¨éæ°ä¸çº¿ï¼sentinel ä¼åå®åé slaveof å½ä»¤ï¼è®©å¶æä¸ºä»æå¡å¨ã\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * æ¸è¿å¼è§£æ redis æºç  - å¨åµ sentinel\n   * æ·±å¥åæ redis ç³»å(äº) - redis å¨åµæ¨¡å¼ä¸é«å¯ç¨éç¾¤',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis éç¾¤",frontmatter:{title:"Redis éç¾¤",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","éç¾¤"],permalink:"/pages/6b0eb1/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/07.Redis%E9%9B%86%E7%BE%A4.html",relativePath:"05.KVæ°æ®åº/01.Redis/07.Rediséç¾¤.md",key:"v-033ee0db",path:"/pages/6b0eb1/",headers:[{level:2,title:"1. Redis Cluster ååº",slug:"_1-redis-cluster-ååº",normalizedTitle:"1. redis cluster ååº",charIndex:320},{level:3,title:"1.1. éç¾¤èç¹",slug:"_1-1-éç¾¤èç¹",normalizedTitle:"1.1. éç¾¤èç¹",charIndex:344},{level:3,title:"1.2. åé Hash æ§½",slug:"_1-2-åé-hash-æ§½",normalizedTitle:"1.2. åé hash æ§½",charIndex:639},{level:3,title:"1.3. å¯»å",slug:"_1-3-å¯»å",normalizedTitle:"1.3. å¯»å",charIndex:1104},{level:4,title:"1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½",slug:"_1-3-1-è®¡ç®é®å±äºåªä¸ªæ§½",normalizedTitle:"1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½",charIndex:1274},{level:4,title:"1.3.2. MOVED éè¯¯",slug:"_1-3-2-moved-éè¯¯",normalizedTitle:"1.3.2. moved éè¯¯",charIndex:1470},{level:3,title:"1.4. éæ°ååº",slug:"_1-4-éæ°ååº",normalizedTitle:"1.4. éæ°ååº",charIndex:1631},{level:3,title:"1.5. ASK éè¯¯",slug:"_1-5-ask-éè¯¯",normalizedTitle:"1.5. ask éè¯¯",charIndex:1888},{level:2,title:"2. Redis Cluster æéè½¬ç§»",slug:"_2-redis-cluster-æéè½¬ç§»",normalizedTitle:"2. redis cluster æéè½¬ç§»",charIndex:2129},{level:3,title:"2.1. å¤å¶",slug:"_2-1-å¤å¶",normalizedTitle:"2.1. å¤å¶",charIndex:2155},{level:3,title:"2.2. æéæ£æµ",slug:"_2-2-æéæ£æµ",normalizedTitle:"2.2. æéæ£æµ",charIndex:2192},{level:3,title:"2.3. æéè½¬ç§»",slug:"_2-3-æéè½¬ç§»",normalizedTitle:"2.3. æéè½¬ç§»",charIndex:2332},{level:3,title:"2.4. éä¸¾æ°çä¸»èç¹",slug:"_2-4-éä¸¾æ°çä¸»èç¹",normalizedTitle:"2.4. éä¸¾æ°çä¸»èç¹",charIndex:2502},{level:2,title:"3. Redis Cluster éä¿¡",slug:"_3-redis-cluster-éä¿¡",normalizedTitle:"3. redis cluster éä¿¡",charIndex:2549},{level:2,title:"4. Redis Cluster åºç¨",slug:"_4-redis-cluster-åºç¨",normalizedTitle:"4. redis cluster åºç¨",charIndex:2998},{level:3,title:"4.1. éç¾¤åè½éå¶",slug:"_4-1-éç¾¤åè½éå¶",normalizedTitle:"4.1. éç¾¤åè½éå¶",charIndex:3022},{level:3,title:"4.2. éç¾¤è§æ¨¡éå¶",slug:"_4-2-éç¾¤è§æ¨¡éå¶",normalizedTitle:"4.2. éç¾¤è§æ¨¡éå¶",charIndex:3464},{level:3,title:"4.3. éç¾¤éç½®",slug:"_4-3-éç¾¤éç½®",normalizedTitle:"4.3. éç¾¤éç½®",charIndex:3887},{level:2,title:"5. å¶ä» Redis éç¾¤æ¹æ¡",slug:"_5-å¶ä»-redis-éç¾¤æ¹æ¡",normalizedTitle:"5. å¶ä» redis éç¾¤æ¹æ¡",charIndex:4968},{level:3,title:"5.1. å®¢æ·ç«¯ååºæ¹æ¡",slug:"_5-1-å®¢æ·ç«¯ååºæ¹æ¡",normalizedTitle:"5.1. å®¢æ·ç«¯ååºæ¹æ¡",charIndex:5088},{level:3,title:"5.2. ä»£çååºæ¹æ¡",slug:"_5-2-ä»£çååºæ¹æ¡",normalizedTitle:"5.2. ä»£çååºæ¹æ¡",charIndex:5523},{level:4,title:"5.2.1. Twemproxy",slug:"_5-2-1-twemproxy",normalizedTitle:"5.2.1. twemproxy",charIndex:5718},{level:4,title:"5.2.2. Codis",slug:"_5-2-2-codis",normalizedTitle:"5.2.2. codis",charIndex:6004},{level:3,title:"5.3. æ¥è¯¢è·¯ç±æ¹æ¡",slug:"_5-3-æ¥è¯¢è·¯ç±æ¹æ¡",normalizedTitle:"5.3. æ¥è¯¢è·¯ç±æ¹æ¡",charIndex:6322},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:6766}],headersStr:"1. Redis Cluster ååº 1.1. éç¾¤èç¹ 1.2. åé Hash æ§½ 1.3. å¯»å 1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½ 1.3.2. MOVED éè¯¯ 1.4. éæ°ååº 1.5. ASK éè¯¯ 2. Redis Cluster æéè½¬ç§» 2.1. å¤å¶ 2.2. æéæ£æµ 2.3. æéè½¬ç§» 2.4. éä¸¾æ°çä¸»èç¹ 3. Redis Cluster éä¿¡ 4. Redis Cluster åºç¨ 4.1. éç¾¤åè½éå¶ 4.2. éç¾¤è§æ¨¡éå¶ 4.3. éç¾¤éç½® 5. å¶ä» Redis éç¾¤æ¹æ¡ 5.1. å®¢æ·ç«¯ååºæ¹æ¡ 5.2. ä»£çååºæ¹æ¡ 5.2.1. Twemproxy 5.2.2. Codis 5.3. æ¥è¯¢è·¯ç±æ¹æ¡ 6. åèèµæ",content:"# Redis éç¾¤\n\n> Redis éç¾¤ï¼Redis Clusterï¼ æ¯ Redis å®æ¹æä¾çåå¸å¼æ°æ®åºæ¹æ¡ã\n> \n> æ¢ç¶æ¯åå¸å¼ï¼èªç¶å·å¤åå¸å¼ç³»ç»çåºæ¬ç¹æ§ï¼å¯æ©å±ãé«å¯ç¨ãä¸è´æ§ã\n> \n>  * Redis éç¾¤éè¿åå hash æ§½æ¥ååºï¼è¿è¡æ°æ®åäº«ã\n>  * Redis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ Redis éç¾¤çé«å¯ç¨ã\n>  * æ ¹æ® CAP çè®ºï¼ConsistencyãAvailabilityãPartition tolerance ä¸èä¸å¯å¼å¾ï¼è Redis éç¾¤çéæ©æ¯ APãRedis éç¾¤èç¹é´éç¨å¼æ­¥éä¿¡æ¹å¼ï¼ä¸ä¿è¯å¼ºä¸è´æ§ï¼å°½åè¾¾å°æç»ä¸è´æ§ã\n\n\n\n\n# 1. Redis Cluster ååº\n\n\n# 1.1. éç¾¤èç¹\n\nRedis éç¾¤ç±å¤ä¸ªèç¹ç»æï¼èç¹åå¯å¨æ¶ï¼å½¼æ­¤æ¯ç¸äºç¬ç«çãèç¹éè¿æ¡æï¼ CLUSTER MEET å½ä»¤ï¼æ¥å°å¶ä»èç¹æ·»å å°èªå·±æå¤çéç¾¤ä¸­ã\n\nåä¸ä¸ªèç¹åé CLUSTER MEET å½ä»¤ï¼å¯ä»¥è®©å½åèç¹ä¸æå® IPãPORT çèç¹è¿è¡æ¡æï¼æ¡ææåæ¶ï¼å½åèç¹ä¼å°æå®èç¹å å¥æå¨éç¾¤ã\n\néç¾¤èç¹ä¿å­é®å¼å¯¹ä»¥åè¿ææ¶é´çæ¹å¼ä¸åæº Redis æå¡å®å¨ç¸åã\n\nRedis éç¾¤èç¹åä¸ºä¸»èç¹ï¼masterï¼åä»èç¹ï¼slaveï¼ï¼å¶ä¸­ä¸»èç¹ç¨äºå¤çæ§½ï¼èä»èç¹åç¨äºå¤å¶æä¸ªä¸»èç¹ï¼å¹¶å¨è¢«å¤å¶çä¸»èç¹ä¸çº¿æ¶ï¼ä»£æ¿ä¸çº¿ä¸»èç¹ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n# 1.2. åé Hash æ§½\n\nåå¸å¼å­å¨éè¦è§£å³çé¦è¦é®é¢æ¯æ æ´ä¸ªæ°æ®é æç§ ååºè§å æ å°å° å¤ä¸ªèç¹ çé®é¢ï¼å³æ æ°æ®é ååå° å¤ä¸ªèç¹ ä¸ï¼æ¯ä¸ªèç¹è´è´£ æ´ä½æ°æ® çä¸ä¸ª å­éã\n\nRedis éç¾¤éè¿åå hash æ§½æ¥å°æ°æ®ååºãRedis éç¾¤éè¿ååºçæ¹å¼æ¥ä¿å­æ°æ®åºçé®å¼å¯¹ï¼éç¾¤çæ´ä¸ªæ°æ®åºè¢«åä¸º 16384 ä¸ªåå¸æ§½ï¼slotï¼ï¼æ°æ®åºä¸­çæ¯ä¸ªé®é½å±äºè¿ 16384 ä¸ªæ§½çå¶ä¸­ä¸ä¸ªï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å¯ä»¥å¤ç 0 ä¸ªææå¤ 16384 ä¸ªæ§½ãå¦ææ°æ®åºä¸­æä»»ä½ä¸ä¸ªæ§½æ²¡æå¾å°å¤çï¼é£ä¹éç¾¤å¤äºä¸çº¿ç¶æã\n\néè¿åèç¹åé CLUSTER ADDSLOTS å½ä»¤ï¼å¯ä»¥å°ä¸ä¸ªæå¤ä¸ªæ§½ææ´¾ç»èç¹è´è´£ã\n\n> CLUSTER ADDSLOTS 1 2 3\nOK\n\n\néç¾¤ä¸­çæ¯ä¸ªèç¹è´è´£ä¸é¨ååå¸æ§½ï¼æ¯å¦éç¾¤ä¸­æï¼ä¸ªèç¹ï¼åï¼\n\n * èç¹ï¼¡å­å¨çåå¸æ§½èå´æ¯ï¼0 â 5500\n * èç¹ï¼¢å­å¨çåå¸æ§½èå´æ¯ï¼5501 â 11000\n * èç¹ï¼£å­å¨çåå¸æ§½èå´æ¯ï¼11001 â 16384\n\n\n# 1.3. å¯»å\n\nå½å®¢æ·ç«¯åèç¹åéä¸æ°æ®åºé®æå³çå½ä»¤æ¶ï¼æ¥åå½ä»¤çèç¹ä¼è®¡ç®åºå½ä»¤è¦å¤ççæ°æ®åºå±äºåªä¸ªæ§½ï¼å¹¶æ£æ¥è¿ä¸ªæ§½æ¯å¦ææ´¾ç»äºèªå·±ï¼\n\n * å¦æé®æå¨çæ§½æ­£å¥½ææ´¾ç»äºå½åèç¹ï¼é£ä¹å½åèç¹ç´æ¥æ§è¡å½ä»¤ã\n * å¦æé®æå¨çæ§½æ²¡æææ´¾ç»å½åèç¹ï¼é£ä¹èç¹ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª MOVED éè¯¯ï¼æå¼å®¢æ·ç«¯éå®åè³æ­£ç¡®çèç¹ã\n\n# 1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½\n\nå³å®ä¸ä¸ª key åºè¯¥åéå°é£ä¸ªæ§½çç®æ³æ¯ï¼è®¡ç®è¯¥ key ç CRC16 ç»æåæ¨¡ 16834ã\n\nHASH_SLOT = CRC16(KEY) mod 16384\n\n\nå½èç¹è®¡ç®åº key æå±çæ§½ä¸º i ä¹åï¼èç¹ä¼æ ¹æ®ä»¥ä¸æ¡ä»¶å¤æ­æ§½æ¯å¦ç±èªå·±è´è´£ï¼\n\nclusterState.slots[i] == clusterState.myself\n\n\n# 1.3.2. MOVED éè¯¯\n\nå½èç¹åç°é®æå¨çæ§½å¹¶éèªå·±è´è´£å¤ççæ¶åï¼èç¹å°±ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª MOVED éè¯¯ï¼æå¼å®¢æ·ç«¯è½¬åæ­£å¨è´è´£æ§½çèç¹ã\n\nMOVED éè¯¯çæ ¼å¼ä¸ºï¼\n\nMOVED <slot> <ip>:<port>\n\n\n> ä¸ªäººçè§£ï¼MOVED è¿ç§æä½æç¹ç±»ä¼¼ HTTP åè®®ä¸­çéå®åã\n\n\n# 1.4. éæ°ååº\n\nRedis éç¾¤çéæ°ååºæä½å¯ä»¥å°ä»»ææ°éçå·²ç»ææ´¾ç»æä¸ªèç¹ï¼æºèç¹ï¼çæ§½æ¹ä¸ºææ´¾ç»å¦ä¸ä¸ªèç¹ï¼ç®æ èç¹ï¼ï¼å¹¶ä¸ç¸å³æ§½æå±çé®å¼å¯¹ä¹ä¼ä»æºèç¹è¢«ç§»å¨å°ç®æ èç¹ã\n\néæ°ååºæä½å¯ä»¥å¨çº¿è¿è¡ï¼å¨éæ°ååºçè¿ç¨ä¸­ï¼éç¾¤ä¸éè¦ä¸çº¿ï¼å¹¶ä¸æºèç¹åç®æ èç¹é½å¯ä»¥ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\nRedis éç¾¤çéæ°ååºæä½ç± Redis éç¾¤ç®¡çè½¯ä»¶ redis-trib è´è´£æ§è¡çï¼redis-trib éè¿åæºèç¹åç®æ èç¹åéå½ä»¤æ¥è¿è¡éæ°ååºæä½ã\n\néæ°ååºçå®ç°åçå¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 1.5. ASK éè¯¯\n\nASK éè¯¯ä¸ MOVED çåºå«å¨äºï¼ASK éè¯¯åªæ¯ä¸¤ä¸ªèç¹å¨è¿ç§»æ§½çè¿ç¨ä¸­ä½¿ç¨çä¸ç§ä¸´æ¶æªæ½ï¼å¨å®¢æ·ç«¯æ¶å°å³äºæ§½ X ç ASK éè¯¯ä¹åï¼å®¢æ·ç«¯åªä¼å¨æ¥ä¸æ¥çä¸æ¬¡å½ä»¤è¯·æ±ä¸­å°å³äºæ§½ X çå½ä»¤è¯·æ±åéè³ ASK éè¯¯ææç¤ºçèç¹ï¼ä½è¿ç§è½¬åä¸ä¼å¯¹å®¢æ·ç«¯ä»ååéå³äºæ§½ X çå½ä»¤è¯·æ±äº§çä»»ä½å½±åï¼å®¢æ·ç«¯ä»ç¶ä¼å°å³äºæ§½ X çå½ä»¤è¯·æ±åéè³ç®åè´è´£å¤çæ§½ X çèç¹ï¼é¤é ASK éè¯¯åæ¬¡åºç°ã\n\nå¤æ­ ASK éè¯¯çè¿ç¨å¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 2. Redis Cluster æéè½¬ç§»\n\n\n# 2.1. å¤å¶\n\nRedis å¤å¶æºå¶å¯ä»¥åèï¼Redis å¤å¶\n\n\n# 2.2. æéæ£æµ\n\néç¾¤ä¸­æ¯ä¸ªèç¹é½ä¼å®æåéç¾¤ä¸­çå¶ä»èç¹åé PING æ¶æ¯ï¼ä»¥æ­¤æ¥æ£æµå¯¹æ¹æ¯å¦å¨çº¿ã\n\nèç¹çç¶æä¿¡æ¯å¯ä»¥åä¸ºï¼\n\n * å¨çº¿ç¶æï¼\n\n * ä¸çº¿ç¶æï¼FAILï¼;\n\n * çä¼¼ä¸çº¿ç¶æï¼PFAILï¼ï¼å³å¨è§å®çæ¶é´åï¼æ²¡æåºç­ PING æ¶æ¯ï¼\n\n\n# 2.3. æéè½¬ç§»\n\n 1. ä¸çº¿ä¸»èç¹çææä»èç¹ä¸­ï¼ä¼æä¸ä¸ªä»èç¹è¢«éä¸­ã\n 2. è¢«éä¸­çä»èç¹ä¼æ§è¡ SLAVEOF no one å½ä»¤ï¼æä¸ºæ°çä¸»èç¹ã\n 3. æ°çä¸»èç¹ä¼æ¤éææå¯¹å·²ä¸çº¿ä¸»èç¹çæ§½ææ´¾ï¼å¹¶å°è¿äºæ§½å¨é¨ææ´¾ç»èªå·±ã\n 4. æ°çä¸»èç¹åéç¾¤å¹¿æ­ä¸æ¡ PONG æ¶æ¯ï¼åç¥å¶ä»èç¹è¿ä¸ªä»èç¹å·²åæä¸»èç¹ã\n\n\n# 2.4. éä¸¾æ°çä¸»èç¹\n\nRedis éç¾¤éä¸¾æ°çä¸»èç¹æµç¨åºäºå±è¯ç®æ³ï¼Raft\n\n\n# 3. Redis Cluster éä¿¡\n\néç¾¤ä¸­çèç¹éè¿åéåæ¥æ¶æ¶æ¯æ¥è¿è¡éä¿¡ã\n\nRedis éç¾¤èç¹åéçæ¶æ¯ä¸»è¦æä»¥ä¸äºç§ï¼\n\n * MEET - è¯·æ±æ¥æ¶æ¹å å¥åéæ¹æå¨çéç¾¤ã\n * PING - éç¾¤ä¸­æ¯ä¸ªèç¹æ¯éä¸æ®µæ¶é´ï¼é»è®¤ä¸ºä¸ç§ï¼ä»å·²ç¥èç¹åè¡¨ä¸­éæºéåºäºä¸ªèç¹ï¼ç¶åå¯¹è¿äºä¸ªèç¹ä¸­æä¹æ²¡èç³»çèç¹åé PING æ¶æ¯ï¼ä»¥æ­¤æ£æµè¢«éä¸­çèç¹æ¯å¦å¨çº¿ã\n * PONG - å½æ¥æ¶æ¹æ¶å°åéæ¹åæ¥ç MEET æ¶æ¯æ PING æ¶æ¯æ¶ï¼ä¼è¿åä¸æ¡ PONG æ¶æ¯ä½ä¸ºåºç­ã\n * FAIL - å½ä¸ä¸ªä¸»èç¹ A å¤æ­å¦ä¸ä¸ªä¸»èç¹ B å·²ç»è¿å¥ FAIL ç¶ææ¶ï¼èç¹ A ä¼åéç¾¤å¹¿æ­ä¸æ¡å³äºèç¹ B ç FAIL æ¶æ¯ï¼æææ¶å°è¿æ¡æ¶æ¯çèç¹é½ä¼ç«å³å°èç¹ B æ è®°ä¸ºå·²ä¸çº¿ã\n * PUBLISH - å½èç¹æ¶å°ä¸ä¸ª PUBLISH å½ä»¤æ¶ï¼èç¹ä¼æ§è¡è¿ä¸ªå½ä»¤ï¼å¹¶åéç¾¤å¹¿æ­ä¸æ¡ PUBLISH æ¶æ¯ï¼æææ¥åå°è¿æ¡æ¶æ¯çèç¹é½ä¼æ§è¡ç¸åç PUBLISH å½ä»¤ã\n\n\n# 4. Redis Cluster åºç¨\n\n\n# 4.1. éç¾¤åè½éå¶\n\nRedis éç¾¤ç¸å¯¹ åæºï¼å­å¨ä¸äºåè½éå¶ï¼éè¦ å¼åäººå æåäºè§£ï¼å¨ä½¿ç¨æ¶åå¥½è§é¿ã\n\n * key æ¹éæä½ æ¯ææéï¼ç±»ä¼¼ msetãmget æä½ï¼ç®ååªæ¯æå¯¹å·æç¸å slot å¼ç key æ§è¡ æ¹éæä½ãå¯¹äº æ å°ä¸ºä¸å slot å¼ç key ç±äºæ§è¡ mgetãmget ç­æä½å¯è½å­å¨äºå¤ä¸ªèç¹ä¸ï¼å æ­¤ä¸è¢«æ¯æã\n\n * key äºå¡æä½ æ¯ææéï¼åªæ¯æ å¤ key å¨ åä¸èç¹ä¸ ç äºå¡æä½ï¼å½å¤ä¸ª key åå¸å¨ ä¸å çèç¹ä¸æ¶ æ æ³ ä½¿ç¨äºå¡åè½ã\n\n * key ä½ä¸º æ°æ®ååº çæå°ç²åº¦ï¼ä¸è½å°ä¸ä¸ª å¤§çé®å¼ å¯¹è±¡å¦ hashãlist ç­æ å°å° ä¸åçèç¹ã\n\n * ä¸æ¯æ å¤æ°æ®åºç©ºé´ï¼åæº ä¸ç Redis å¯ä»¥æ¯æ 16 ä¸ªæ°æ®åºï¼db0 ~ db15ï¼ï¼éç¾¤æ¨¡å¼ ä¸åªè½ä½¿ç¨ ä¸ä¸ª æ°æ®åºç©ºé´ï¼å³ db0ã\n\n * å¤å¶ç»æ åªæ¯æä¸å±ï¼ä»èç¹ åªè½å¤å¶ ä¸»èç¹ï¼ä¸æ¯æ åµå¥æ ç¶å¤å¶ ç»æã\n\n\n# 4.2. éç¾¤è§æ¨¡éå¶\n\nRedis Cluster çä¼ç¹æ¯æäºä½¿ç¨ãååºãä¸»ä»å¤å¶ãå¼¹æ§æ©å®¹è¿äºåè½é½å¯ä»¥åå°èªå¨åï¼éè¿ç®åçé¨ç½²å°±å¯ä»¥è·å¾ä¸ä¸ªå¤§å®¹éãé«å¯é ãé«å¯ç¨ç Redis éç¾¤ï¼å¹¶ä¸å¯¹äºåºç¨æ¥è¯´ï¼è¿ä¹äºæ¯éæçã\n\næä»¥ï¼Redis Cluster éå¸¸éåæå»ºä¸­å°è§æ¨¡ Redis éç¾¤ï¼è¿éçä¸­å°è§æ¨¡æçæ¯ï¼å¤§æ¦å ä¸ªå°å åä¸ªèç¹è¿æ ·è§æ¨¡ç Redis éç¾¤ã\n\nä½æ¯ Redis Cluster ä¸å¤ªéåæå»ºè¶å¤§è§æ¨¡éç¾¤ï¼ä¸»è¦åå æ¯ï¼å®éç¨äºå»ä¸­å¿åçè®¾è®¡ã\n\nRedis çæ¯ä¸ªèç¹ä¸ï¼é½ä¿å­äºæææ§½åèç¹çæ å°å³ç³»è¡¨ï¼å®¢æ·ç«¯å¯ä»¥è®¿é®ä»»æä¸ä¸ªèç¹ï¼åéè¿éå®åå½ä»¤ï¼æ¾å°æ°æ®æå¨çé£ä¸ªèç¹ãé£ä¹ï¼è¿ä¸ªæ å°å³ç³»è¡¨æ¯å¦ä½æ´æ°çå¢ï¼Redis Cluster éç¨äºä¸ç§å»ä¸­å¿åçæµè¨ (Gossip) åè®®æ¥ä¼ æ­éç¾¤éç½®çååã\n\nGossip åè®®çä¼ç¹æ¯å»ä¸­å¿åï¼ç¼ºç¹æ¯ä¼ æ­éåº¦æ¢ï¼å¹¶ä¸æ¯éç¾¤è§æ¨¡è¶å¤§ï¼ä¼ æ­çè¶æ¢ã\n\n\n# 4.3. éç¾¤éç½®\n\næä»¬åé¢ä¼é¨ç½²ä¸ä¸ª Redis éç¾¤ä½ä¸ºä¾å­ï¼å¨é£ä¹åï¼åä»ç»ä¸ä¸éç¾¤å¨ redis.conf ä¸­çåæ°ã\n\n * cluster-enabled <yes/no> - å¦æéç½®âyesâåå¼å¯éç¾¤åè½ï¼æ­¤ redis å®ä¾ä½ä¸ºéç¾¤çä¸ä¸ªèç¹ï¼å¦åï¼å®æ¯ä¸ä¸ªæ®éçåä¸ç redis å®ä¾ã\n * cluster-config-file <filename> - æ³¨æï¼è½ç¶æ­¤éç½®çåå­å«âéç¾¤éç½®æä»¶âï¼ä½æ¯æ­¤éç½®æä»¶ä¸è½äººå·¥ç¼è¾ï¼å®æ¯éç¾¤èç¹èªå¨ç»´æ¤çæä»¶ï¼ä¸»è¦ç¨äºè®°å½éç¾¤ä¸­æåªäºèç¹ãä»ä»¬çç¶æä»¥åä¸äºæä¹ååæ°ç­ï¼æ¹ä¾¿å¨éå¯æ¶æ¢å¤è¿äºç¶æãéå¸¸æ¯å¨æ¶å°è¯·æ±ä¹åè¿ä¸ªæä»¶å°±ä¼è¢«æ´æ°ã\n * cluster-node-timeout <milliseconds> - è¿æ¯éç¾¤ä¸­çèç¹è½å¤å¤±èçæå¤§æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼è¯¥èç¹å°±ä¼è¢«è®¤ä¸ºæéãå¦æä¸»èç¹è¶è¿è¿ä¸ªæ¶é´è¿æ¯ä¸å¯è¾¾ï¼åç¨å®çä»èç¹å°å¯å¨æéè¿ç§»ï¼åçº§æä¸»èç¹ãæ³¨æï¼ä»»ä½ä¸ä¸ªèç¹å¨è¿ä¸ªæ¶é´ä¹åå¦æè¿æ¯æ²¡æè¿ä¸å¤§é¨åçä¸»èç¹ï¼åæ­¤èç¹å°åæ­¢æ¥æ¶ä»»ä½è¯·æ±ã\n * cluster-slave-validity-factor <factor> - å¦æè®¾ç½®æï¼ï¼åæ è®ºä»èç¹ä¸ä¸»èç¹å¤±èå¤ä¹ï¼ä»èç¹é½ä¼å°è¯åçº§æä¸»èç¹ãå¦æè®¾ç½®ææ­£æ°ï¼å cluster-node-timeout ä¹ä»¥ cluster-slave-validity-factor å¾å°çæ¶é´ï¼æ¯ä»èç¹ä¸ä¸»èç¹å¤±èåï¼æ­¤ä»èç¹æ°æ®ææçæé¿æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼ä»èç¹ä¸ä¼å¯å¨æéè¿ç§»ãåè®¾ cluster-node-timeout=5ï¼cluster-slave-validity-factor=10ï¼åå¦æä»èç¹è·ä¸»èç¹å¤±èè¶è¿ 50 ç§ï¼æ­¤ä»èç¹ä¸è½æä¸ºä¸»èç¹ãæ³¨æï¼å¦ææ­¤åæ°éç½®ä¸ºé 0ï¼å°å¯è½åºç°ç±äºæä¸»èç¹å¤±èå´æ²¡æä»èç¹è½é¡¶ä¸çæåµï¼ä»èå¯¼è´éç¾¤ä¸è½æ­£å¸¸å·¥ä½ï¼å¨è¿ç§æåµä¸ï¼åªæç­å°åæ¥çä¸»èç¹éæ°åå½å°éç¾¤ï¼éç¾¤ææ¢å¤è¿ä½ã\n * cluster-migration-barrier <count> - ä¸»èç¹éè¦çæå°ä»èç¹æ°ï¼åªæè¾¾å°è¿ä¸ªæ°ï¼ä¸»èç¹å¤±è´¥æ¶ï¼å®ä»èç¹æä¼è¿è¡è¿ç§»ãæ´è¯¦ç»ä»ç»å¯ä»¥çæ¬æç¨åé¢å³äºå¯æ¬è¿ç§»å°é¨åã\n * cluster-require-full-coverage <yes/no> - å¨é¨å key æå¨çèç¹ä¸å¯ç¨æ¶ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºâyesâ(é»è®¤å¼), åæ´ä¸ªéç¾¤åæ­¢æ¥åæä½ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºânoâï¼åéç¾¤ä¾ç¶ä¸ºå¯è¾¾èç¹ä¸ç key æä¾è¯»æä½ã\n\n\n# 5. å¶ä» Redis éç¾¤æ¹æ¡\n\nRedis Cluster ä¸å¤ªéåç¨äºå¤§è§æ¨¡éç¾¤ï¼æä»¥ï¼å¦æè¦æå»ºè¶å¤§ Redis éç¾¤ï¼éè¦éæ©æ¿ä»£æ¹æ¡ãä¸è¬æä¸ç§æ¹æ¡ç±»åï¼\n\n * å®¢æ·ç«¯ååºæ¹æ¡\n * ä»£çååºæ¹æ¡\n * æ¥è¯¢è·¯ç±æ¹æ¡\n\n\n# 5.1. å®¢æ·ç«¯ååºæ¹æ¡\n\nå®¢æ·ç«¯ å°±å·²ç»å³å®æ°æ®ä¼è¢« å­å¨ å°åªä¸ª Redis èç¹æèä»åªä¸ª Redis èç¹ è¯»åæ°æ®ãå¶ä¸»è¦ææ³æ¯éç¨ åå¸ç®æ³ å° Redis æ°æ®ç key è¿è¡æ£åï¼éè¿ hash å½æ°ï¼ç¹å®ç keyä¼ æ å° å°ç¹å®ç Redis èç¹ä¸ã\n\nå®¢æ·ç«¯ååºæ¹æ¡ çä»£è¡¨ä¸º Redis Shardingï¼Redis Sharding æ¯ Redis Cluster åºæ¥ä¹åï¼ä¸çæ®éä½¿ç¨ç Redis å¤å®ä¾éç¾¤ æ¹æ³ãJava ç Redis å®¢æ·ç«¯é©±å¨åº Jedisï¼æ¯æ Redis Sharding åè½ï¼å³ ShardedJedis ä»¥å ç»åç¼å­æ±  ç ShardedJedisPoolã\n\n * ä¼ç¹ï¼ä¸ä½¿ç¨ ç¬¬ä¸æ¹ä¸­é´ä»¶ï¼ååºé»è¾ å¯æ§ï¼éç½® ç®åï¼èç¹ä¹é´æ å³èï¼å®¹æ çº¿æ§æ©å±ï¼çµæ´»æ§å¼ºã\n\n * ç¼ºç¹ï¼å®¢æ·ç«¯ æ æ³ å¨æå¢å  æå¡èç¹ï¼å®¢æ·ç«¯éè¦èªè¡ç»´æ¤ ååé»è¾ï¼å®¢æ·ç«¯ä¹é´ æ è¿æ¥å±äº«ï¼ä¼é æ è¿æ¥æµªè´¹ã\n\n\n# 5.2. ä»£çååºæ¹æ¡\n\nå®¢æ·ç«¯ åéè¯·æ±å°ä¸ä¸ª ä»£çç»ä»¶ï¼ä»£ç è§£æ å®¢æ·ç«¯ çæ°æ®ï¼å¹¶å°è¯·æ±è½¬åè³æ­£ç¡®çèç¹ï¼æåå°ç»æåå¤ç»å®¢æ·ç«¯ã\n\n * ä¼ç¹ï¼ç®å å®¢æ·ç«¯ çåå¸å¼é»è¾ï¼å®¢æ·ç«¯ éææ¥å¥ï¼åæ¢ææ¬ä½ï¼ä»£çç è½¬å å å­å¨ åç¦»ã\n * ç¼ºç¹ï¼å¤äºä¸å± ä»£çå±ï¼å éäº æ¶æé¨ç½²å¤æåº¦ å æ§è½æèã\n\nä»£çååº ä¸»æµå®ç°çææ¹æ¡æ Twemproxy å Codisã\n\n# 5.2.1. Twemproxy\n\nTwemproxy ä¹å« nutcrakerï¼æ¯ Twitter å¼æºçä¸ä¸ª Redis å Memcache ç ä¸­é´ä»£çæå¡å¨ ç¨åºã\n\nTwemproxy ä½ä¸º ä»£çï¼å¯æ¥åæ¥èªå¤ä¸ªç¨åºçè®¿é®ï¼æç§ è·¯ç±è§åï¼è½¬åç»åå°çåä¸ª Redis æå¡å¨ï¼ååè·¯è¿åãTwemproxy å­å¨ åç¹æé é®é¢ï¼éè¦ç»å Lvs å Keepalived å é«å¯ç¨æ¹æ¡ã\n\n * ä¼ç¹ï¼åºç¨èå´å¹¿ï¼ç¨³å®æ§è¾é«ï¼ä¸­é´ä»£çå± é«å¯ç¨ã\n * ç¼ºç¹ï¼æ æ³å¹³æ»å° æ°´å¹³æ©å®¹/ç¼©å®¹ï¼æ  å¯è§åç®¡ççé¢ï¼è¿ç»´ä¸åå¥½ï¼åºç°æéï¼ä¸è½ èªå¨è½¬ç§»ã\n\n# 5.2.2. Codis\n\nCodis æ¯ä¸ä¸ª åå¸å¼ Redis è§£å³æ¹æ¡ï¼å¯¹äºä¸å±åºç¨æ¥è¯´ï¼è¿æ¥ Codis-Proxy åç´æ¥è¿æ¥ åçç Redis-Server æ²¡æçåºå«ãCodis åºå±ä¼ å¤çè¯·æ±çè½¬åï¼ä¸åæºçè¿è¡ æ°æ®è¿ç§» ç­å·¥ä½ãCodis éç¨äºæ ç¶æç ä»£çå±ï¼å¯¹äº å®¢æ·ç«¯ æ¥è¯´ï¼ä¸åé½æ¯éæçã\n\n * ä¼ç¹ï¼å®ç°äºä¸å± Proxy ååºå± Redis ç é«å¯ç¨ï¼æ°æ®ååº å èªå¨å¹³è¡¡ï¼æä¾ å½ä»¤è¡æ¥å£ å RESTful APIï¼æä¾ çæ§ å ç®¡ç çé¢ï¼å¯ä»¥å¨æ æ·»å  å å é¤ Redis èç¹ã\n\n * ç¼ºç¹ï¼é¨ç½²æ¶æ å éç½® å¤æï¼ä¸æ¯æ è·¨æºæ¿ å å¤ç§æ·ï¼ä¸æ¯æ é´æç®¡çã\n\n\n# 5.3. æ¥è¯¢è·¯ç±æ¹æ¡\n\nå®¢æ·ç«¯éæºå° è¯·æ±ä»»æä¸ä¸ª Redis å®ä¾ï¼ç¶åç± Redis å°è¯·æ± è½¬å ç» æ­£ç¡® ç Redis èç¹ãRedis Cluster å®ç°äºä¸ç§ æ··åå½¢å¼ ç æ¥è¯¢è·¯ç±ï¼ä½å¹¶ä¸æ¯ ç´æ¥ å°è¯·æ±ä»ä¸ä¸ª Redis èç¹ è½¬å å°å¦ä¸ä¸ª Redis èç¹ï¼èæ¯å¨ å®¢æ·ç«¯ çå¸®å©ä¸ç´æ¥ éå®åï¼ redirectedï¼å°æ­£ç¡®ç Redis èç¹ã\n\n * ä¼ç¹ï¼å»ä¸­å¿åï¼æ°æ®æç§ æ§½ å­å¨åå¸å¨å¤ä¸ª Redis å®ä¾ä¸ï¼å¯ä»¥å¹³æ»çè¿è¡èç¹ æ©å®¹/ç¼©å®¹ï¼æ¯æ é«å¯ç¨ å èªå¨æéè½¬ç§»ï¼è¿ç»´ææ¬ä½ã\n\n * ç¼ºç¹ï¼éåº¦ä¾èµ Redis-trib å·¥å·ï¼ç¼ºä¹ çæ§ç®¡çï¼éè¦ä¾èµ Smart Client (ç»´æ¤è¿æ¥ï¼ç¼å­è·¯ç±è¡¨ï¼MultiOp å Pipeline æ¯æ)ãFailover èç¹ç æ£æµè¿æ¢ï¼ä¸å¦æ ä¸­å¿èç¹ çéç¾¤åæ¶ï¼å¦ ZooKeeperï¼ãGossip æ¶æ¯éç¨å¹¿æ­æ¹å¼ï¼éç¾¤è§æ¨¡è¶å¤§ï¼å¼éè¶å¤§ãæ æ³æ ¹æ®ç»è®¡åºå å·ç­æ°æ®ã\n\n\n# 6. åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¸­é´ä»¶\n   * Twemproxy\n   * Codis\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * åç«¯å­å¨å®æè¯¾\n * æç« \n   * Redis éç¾¤æç¨\n   * Redis éç¾¤çåçåæ­å»º\n   * æ·±å¥åæ Redis ç³»å(ä¸) - Redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£",normalizedContent:"# redis éç¾¤\n\n> redis éç¾¤ï¼redis clusterï¼ æ¯ redis å®æ¹æä¾çåå¸å¼æ°æ®åºæ¹æ¡ã\n> \n> æ¢ç¶æ¯åå¸å¼ï¼èªç¶å·å¤åå¸å¼ç³»ç»çåºæ¬ç¹æ§ï¼å¯æ©å±ãé«å¯ç¨ãä¸è´æ§ã\n> \n>  * redis éç¾¤éè¿åå hash æ§½æ¥ååºï¼è¿è¡æ°æ®åäº«ã\n>  * redis éç¾¤éç¨ä¸»ä»æ¨¡åï¼æä¾å¤å¶åæéè½¬ç§»åè½ï¼æ¥ä¿è¯ redis éç¾¤çé«å¯ç¨ã\n>  * æ ¹æ® cap çè®ºï¼consistencyãavailabilityãpartition tolerance ä¸èä¸å¯å¼å¾ï¼è redis éç¾¤çéæ©æ¯ apãredis éç¾¤èç¹é´éç¨å¼æ­¥éä¿¡æ¹å¼ï¼ä¸ä¿è¯å¼ºä¸è´æ§ï¼å°½åè¾¾å°æç»ä¸è´æ§ã\n\n\n\n\n# 1. redis cluster ååº\n\n\n# 1.1. éç¾¤èç¹\n\nredis éç¾¤ç±å¤ä¸ªèç¹ç»æï¼èç¹åå¯å¨æ¶ï¼å½¼æ­¤æ¯ç¸äºç¬ç«çãèç¹éè¿æ¡æï¼ cluster meet å½ä»¤ï¼æ¥å°å¶ä»èç¹æ·»å å°èªå·±æå¤çéç¾¤ä¸­ã\n\nåä¸ä¸ªèç¹åé cluster meet å½ä»¤ï¼å¯ä»¥è®©å½åèç¹ä¸æå® ipãport çèç¹è¿è¡æ¡æï¼æ¡ææåæ¶ï¼å½åèç¹ä¼å°æå®èç¹å å¥æå¨éç¾¤ã\n\néç¾¤èç¹ä¿å­é®å¼å¯¹ä»¥åè¿ææ¶é´çæ¹å¼ä¸åæº redis æå¡å®å¨ç¸åã\n\nredis éç¾¤èç¹åä¸ºä¸»èç¹ï¼masterï¼åä»èç¹ï¼slaveï¼ï¼å¶ä¸­ä¸»èç¹ç¨äºå¤çæ§½ï¼èä»èç¹åç¨äºå¤å¶æä¸ªä¸»èç¹ï¼å¹¶å¨è¢«å¤å¶çä¸»èç¹ä¸çº¿æ¶ï¼ä»£æ¿ä¸çº¿ä¸»èç¹ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\n\n# 1.2. åé hash æ§½\n\nåå¸å¼å­å¨éè¦è§£å³çé¦è¦é®é¢æ¯æ æ´ä¸ªæ°æ®é æç§ ååºè§å æ å°å° å¤ä¸ªèç¹ çé®é¢ï¼å³æ æ°æ®é ååå° å¤ä¸ªèç¹ ä¸ï¼æ¯ä¸ªèç¹è´è´£ æ´ä½æ°æ® çä¸ä¸ª å­éã\n\nredis éç¾¤éè¿åå hash æ§½æ¥å°æ°æ®ååºãredis éç¾¤éè¿ååºçæ¹å¼æ¥ä¿å­æ°æ®åºçé®å¼å¯¹ï¼éç¾¤çæ´ä¸ªæ°æ®åºè¢«åä¸º 16384 ä¸ªåå¸æ§½ï¼slotï¼ï¼æ°æ®åºä¸­çæ¯ä¸ªé®é½å±äºè¿ 16384 ä¸ªæ§½çå¶ä¸­ä¸ä¸ªï¼éç¾¤ä¸­çæ¯ä¸ªèç¹å¯ä»¥å¤ç 0 ä¸ªææå¤ 16384 ä¸ªæ§½ãå¦ææ°æ®åºä¸­æä»»ä½ä¸ä¸ªæ§½æ²¡æå¾å°å¤çï¼é£ä¹éç¾¤å¤äºä¸çº¿ç¶æã\n\néè¿åèç¹åé cluster addslots å½ä»¤ï¼å¯ä»¥å°ä¸ä¸ªæå¤ä¸ªæ§½ææ´¾ç»èç¹è´è´£ã\n\n> cluster addslots 1 2 3\nok\n\n\néç¾¤ä¸­çæ¯ä¸ªèç¹è´è´£ä¸é¨ååå¸æ§½ï¼æ¯å¦éç¾¤ä¸­æï¼ä¸ªèç¹ï¼åï¼\n\n * èç¹ï½å­å¨çåå¸æ§½èå´æ¯ï¼0 â 5500\n * èç¹ï½å­å¨çåå¸æ§½èå´æ¯ï¼5501 â 11000\n * èç¹ï½å­å¨çåå¸æ§½èå´æ¯ï¼11001 â 16384\n\n\n# 1.3. å¯»å\n\nå½å®¢æ·ç«¯åèç¹åéä¸æ°æ®åºé®æå³çå½ä»¤æ¶ï¼æ¥åå½ä»¤çèç¹ä¼è®¡ç®åºå½ä»¤è¦å¤ççæ°æ®åºå±äºåªä¸ªæ§½ï¼å¹¶æ£æ¥è¿ä¸ªæ§½æ¯å¦ææ´¾ç»äºèªå·±ï¼\n\n * å¦æé®æå¨çæ§½æ­£å¥½ææ´¾ç»äºå½åèç¹ï¼é£ä¹å½åèç¹ç´æ¥æ§è¡å½ä»¤ã\n * å¦æé®æå¨çæ§½æ²¡æææ´¾ç»å½åèç¹ï¼é£ä¹èç¹ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª moved éè¯¯ï¼æå¼å®¢æ·ç«¯éå®åè³æ­£ç¡®çèç¹ã\n\n# 1.3.1. è®¡ç®é®å±äºåªä¸ªæ§½\n\nå³å®ä¸ä¸ª key åºè¯¥åéå°é£ä¸ªæ§½çç®æ³æ¯ï¼è®¡ç®è¯¥ key ç crc16 ç»æåæ¨¡ 16834ã\n\nhash_slot = crc16(key) mod 16384\n\n\nå½èç¹è®¡ç®åº key æå±çæ§½ä¸º i ä¹åï¼èç¹ä¼æ ¹æ®ä»¥ä¸æ¡ä»¶å¤æ­æ§½æ¯å¦ç±èªå·±è´è´£ï¼\n\nclusterstate.slots[i] == clusterstate.myself\n\n\n# 1.3.2. moved éè¯¯\n\nå½èç¹åç°é®æå¨çæ§½å¹¶éèªå·±è´è´£å¤ççæ¶åï¼èç¹å°±ä¼åå®¢æ·ç«¯è¿åä¸ä¸ª moved éè¯¯ï¼æå¼å®¢æ·ç«¯è½¬åæ­£å¨è´è´£æ§½çèç¹ã\n\nmoved éè¯¯çæ ¼å¼ä¸ºï¼\n\nmoved <slot> <ip>:<port>\n\n\n> ä¸ªäººçè§£ï¼moved è¿ç§æä½æç¹ç±»ä¼¼ http åè®®ä¸­çéå®åã\n\n\n# 1.4. éæ°ååº\n\nredis éç¾¤çéæ°ååºæä½å¯ä»¥å°ä»»ææ°éçå·²ç»ææ´¾ç»æä¸ªèç¹ï¼æºèç¹ï¼çæ§½æ¹ä¸ºææ´¾ç»å¦ä¸ä¸ªèç¹ï¼ç®æ èç¹ï¼ï¼å¹¶ä¸ç¸å³æ§½æå±çé®å¼å¯¹ä¹ä¼ä»æºèç¹è¢«ç§»å¨å°ç®æ èç¹ã\n\néæ°ååºæä½å¯ä»¥å¨çº¿è¿è¡ï¼å¨éæ°ååºçè¿ç¨ä¸­ï¼éç¾¤ä¸éè¦ä¸çº¿ï¼å¹¶ä¸æºèç¹åç®æ èç¹é½å¯ä»¥ç»§ç»­å¤çå½ä»¤è¯·æ±ã\n\nredis éç¾¤çéæ°ååºæä½ç± redis éç¾¤ç®¡çè½¯ä»¶ redis-trib è´è´£æ§è¡çï¼redis-trib éè¿åæºèç¹åç®æ èç¹åéå½ä»¤æ¥è¿è¡éæ°ååºæä½ã\n\néæ°ååºçå®ç°åçå¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 1.5. ask éè¯¯\n\nask éè¯¯ä¸ moved çåºå«å¨äºï¼ask éè¯¯åªæ¯ä¸¤ä¸ªèç¹å¨è¿ç§»æ§½çè¿ç¨ä¸­ä½¿ç¨çä¸ç§ä¸´æ¶æªæ½ï¼å¨å®¢æ·ç«¯æ¶å°å³äºæ§½ x ç ask éè¯¯ä¹åï¼å®¢æ·ç«¯åªä¼å¨æ¥ä¸æ¥çä¸æ¬¡å½ä»¤è¯·æ±ä¸­å°å³äºæ§½ x çå½ä»¤è¯·æ±åéè³ ask éè¯¯ææç¤ºçèç¹ï¼ä½è¿ç§è½¬åä¸ä¼å¯¹å®¢æ·ç«¯ä»ååéå³äºæ§½ x çå½ä»¤è¯·æ±äº§çä»»ä½å½±åï¼å®¢æ·ç«¯ä»ç¶ä¼å°å³äºæ§½ x çå½ä»¤è¯·æ±åéè³ç®åè´è´£å¤çæ§½ x çèç¹ï¼é¤é ask éè¯¯åæ¬¡åºç°ã\n\nå¤æ­ ask éè¯¯çè¿ç¨å¦ä¸å¾æç¤ºï¼\n\n\n\n\n# 2. redis cluster æéè½¬ç§»\n\n\n# 2.1. å¤å¶\n\nredis å¤å¶æºå¶å¯ä»¥åèï¼redis å¤å¶\n\n\n# 2.2. æéæ£æµ\n\néç¾¤ä¸­æ¯ä¸ªèç¹é½ä¼å®æåéç¾¤ä¸­çå¶ä»èç¹åé ping æ¶æ¯ï¼ä»¥æ­¤æ¥æ£æµå¯¹æ¹æ¯å¦å¨çº¿ã\n\nèç¹çç¶æä¿¡æ¯å¯ä»¥åä¸ºï¼\n\n * å¨çº¿ç¶æï¼\n\n * ä¸çº¿ç¶æï¼failï¼;\n\n * çä¼¼ä¸çº¿ç¶æï¼pfailï¼ï¼å³å¨è§å®çæ¶é´åï¼æ²¡æåºç­ ping æ¶æ¯ï¼\n\n\n# 2.3. æéè½¬ç§»\n\n 1. ä¸çº¿ä¸»èç¹çææä»èç¹ä¸­ï¼ä¼æä¸ä¸ªä»èç¹è¢«éä¸­ã\n 2. è¢«éä¸­çä»èç¹ä¼æ§è¡ slaveof no one å½ä»¤ï¼æä¸ºæ°çä¸»èç¹ã\n 3. æ°çä¸»èç¹ä¼æ¤éææå¯¹å·²ä¸çº¿ä¸»èç¹çæ§½ææ´¾ï¼å¹¶å°è¿äºæ§½å¨é¨ææ´¾ç»èªå·±ã\n 4. æ°çä¸»èç¹åéç¾¤å¹¿æ­ä¸æ¡ pong æ¶æ¯ï¼åç¥å¶ä»èç¹è¿ä¸ªä»èç¹å·²åæä¸»èç¹ã\n\n\n# 2.4. éä¸¾æ°çä¸»èç¹\n\nredis éç¾¤éä¸¾æ°çä¸»èç¹æµç¨åºäºå±è¯ç®æ³ï¼raft\n\n\n# 3. redis cluster éä¿¡\n\néç¾¤ä¸­çèç¹éè¿åéåæ¥æ¶æ¶æ¯æ¥è¿è¡éä¿¡ã\n\nredis éç¾¤èç¹åéçæ¶æ¯ä¸»è¦æä»¥ä¸äºç§ï¼\n\n * meet - è¯·æ±æ¥æ¶æ¹å å¥åéæ¹æå¨çéç¾¤ã\n * ping - éç¾¤ä¸­æ¯ä¸ªèç¹æ¯éä¸æ®µæ¶é´ï¼é»è®¤ä¸ºä¸ç§ï¼ä»å·²ç¥èç¹åè¡¨ä¸­éæºéåºäºä¸ªèç¹ï¼ç¶åå¯¹è¿äºä¸ªèç¹ä¸­æä¹æ²¡èç³»çèç¹åé ping æ¶æ¯ï¼ä»¥æ­¤æ£æµè¢«éä¸­çèç¹æ¯å¦å¨çº¿ã\n * pong - å½æ¥æ¶æ¹æ¶å°åéæ¹åæ¥ç meet æ¶æ¯æ ping æ¶æ¯æ¶ï¼ä¼è¿åä¸æ¡ pong æ¶æ¯ä½ä¸ºåºç­ã\n * fail - å½ä¸ä¸ªä¸»èç¹ a å¤æ­å¦ä¸ä¸ªä¸»èç¹ b å·²ç»è¿å¥ fail ç¶ææ¶ï¼èç¹ a ä¼åéç¾¤å¹¿æ­ä¸æ¡å³äºèç¹ b ç fail æ¶æ¯ï¼æææ¶å°è¿æ¡æ¶æ¯çèç¹é½ä¼ç«å³å°èç¹ b æ è®°ä¸ºå·²ä¸çº¿ã\n * publish - å½èç¹æ¶å°ä¸ä¸ª publish å½ä»¤æ¶ï¼èç¹ä¼æ§è¡è¿ä¸ªå½ä»¤ï¼å¹¶åéç¾¤å¹¿æ­ä¸æ¡ publish æ¶æ¯ï¼æææ¥åå°è¿æ¡æ¶æ¯çèç¹é½ä¼æ§è¡ç¸åç publish å½ä»¤ã\n\n\n# 4. redis cluster åºç¨\n\n\n# 4.1. éç¾¤åè½éå¶\n\nredis éç¾¤ç¸å¯¹ åæºï¼å­å¨ä¸äºåè½éå¶ï¼éè¦ å¼åäººå æåäºè§£ï¼å¨ä½¿ç¨æ¶åå¥½è§é¿ã\n\n * key æ¹éæä½ æ¯ææéï¼ç±»ä¼¼ msetãmget æä½ï¼ç®ååªæ¯æå¯¹å·æç¸å slot å¼ç key æ§è¡ æ¹éæä½ãå¯¹äº æ å°ä¸ºä¸å slot å¼ç key ç±äºæ§è¡ mgetãmget ç­æä½å¯è½å­å¨äºå¤ä¸ªèç¹ä¸ï¼å æ­¤ä¸è¢«æ¯æã\n\n * key äºå¡æä½ æ¯ææéï¼åªæ¯æ å¤ key å¨ åä¸èç¹ä¸ ç äºå¡æä½ï¼å½å¤ä¸ª key åå¸å¨ ä¸å çèç¹ä¸æ¶ æ æ³ ä½¿ç¨äºå¡åè½ã\n\n * key ä½ä¸º æ°æ®ååº çæå°ç²åº¦ï¼ä¸è½å°ä¸ä¸ª å¤§çé®å¼ å¯¹è±¡å¦ hashãlist ç­æ å°å° ä¸åçèç¹ã\n\n * ä¸æ¯æ å¤æ°æ®åºç©ºé´ï¼åæº ä¸ç redis å¯ä»¥æ¯æ 16 ä¸ªæ°æ®åºï¼db0 ~ db15ï¼ï¼éç¾¤æ¨¡å¼ ä¸åªè½ä½¿ç¨ ä¸ä¸ª æ°æ®åºç©ºé´ï¼å³ db0ã\n\n * å¤å¶ç»æ åªæ¯æä¸å±ï¼ä»èç¹ åªè½å¤å¶ ä¸»èç¹ï¼ä¸æ¯æ åµå¥æ ç¶å¤å¶ ç»æã\n\n\n# 4.2. éç¾¤è§æ¨¡éå¶\n\nredis cluster çä¼ç¹æ¯æäºä½¿ç¨ãååºãä¸»ä»å¤å¶ãå¼¹æ§æ©å®¹è¿äºåè½é½å¯ä»¥åå°èªå¨åï¼éè¿ç®åçé¨ç½²å°±å¯ä»¥è·å¾ä¸ä¸ªå¤§å®¹éãé«å¯é ãé«å¯ç¨ç redis éç¾¤ï¼å¹¶ä¸å¯¹äºåºç¨æ¥è¯´ï¼è¿ä¹äºæ¯éæçã\n\næä»¥ï¼redis cluster éå¸¸éåæå»ºä¸­å°è§æ¨¡ redis éç¾¤ï¼è¿éçä¸­å°è§æ¨¡æçæ¯ï¼å¤§æ¦å ä¸ªå°å åä¸ªèç¹è¿æ ·è§æ¨¡ç redis éç¾¤ã\n\nä½æ¯ redis cluster ä¸å¤ªéåæå»ºè¶å¤§è§æ¨¡éç¾¤ï¼ä¸»è¦åå æ¯ï¼å®éç¨äºå»ä¸­å¿åçè®¾è®¡ã\n\nredis çæ¯ä¸ªèç¹ä¸ï¼é½ä¿å­äºæææ§½åèç¹çæ å°å³ç³»è¡¨ï¼å®¢æ·ç«¯å¯ä»¥è®¿é®ä»»æä¸ä¸ªèç¹ï¼åéè¿éå®åå½ä»¤ï¼æ¾å°æ°æ®æå¨çé£ä¸ªèç¹ãé£ä¹ï¼è¿ä¸ªæ å°å³ç³»è¡¨æ¯å¦ä½æ´æ°çå¢ï¼redis cluster éç¨äºä¸ç§å»ä¸­å¿åçæµè¨ (gossip) åè®®æ¥ä¼ æ­éç¾¤éç½®çååã\n\ngossip åè®®çä¼ç¹æ¯å»ä¸­å¿åï¼ç¼ºç¹æ¯ä¼ æ­éåº¦æ¢ï¼å¹¶ä¸æ¯éç¾¤è§æ¨¡è¶å¤§ï¼ä¼ æ­çè¶æ¢ã\n\n\n# 4.3. éç¾¤éç½®\n\næä»¬åé¢ä¼é¨ç½²ä¸ä¸ª redis éç¾¤ä½ä¸ºä¾å­ï¼å¨é£ä¹åï¼åä»ç»ä¸ä¸éç¾¤å¨ redis.conf ä¸­çåæ°ã\n\n * cluster-enabled <yes/no> - å¦æéç½®âyesâåå¼å¯éç¾¤åè½ï¼æ­¤ redis å®ä¾ä½ä¸ºéç¾¤çä¸ä¸ªèç¹ï¼å¦åï¼å®æ¯ä¸ä¸ªæ®éçåä¸ç redis å®ä¾ã\n * cluster-config-file <filename> - æ³¨æï¼è½ç¶æ­¤éç½®çåå­å«âéç¾¤éç½®æä»¶âï¼ä½æ¯æ­¤éç½®æä»¶ä¸è½äººå·¥ç¼è¾ï¼å®æ¯éç¾¤èç¹èªå¨ç»´æ¤çæä»¶ï¼ä¸»è¦ç¨äºè®°å½éç¾¤ä¸­æåªäºèç¹ãä»ä»¬çç¶æä»¥åä¸äºæä¹ååæ°ç­ï¼æ¹ä¾¿å¨éå¯æ¶æ¢å¤è¿äºç¶æãéå¸¸æ¯å¨æ¶å°è¯·æ±ä¹åè¿ä¸ªæä»¶å°±ä¼è¢«æ´æ°ã\n * cluster-node-timeout <milliseconds> - è¿æ¯éç¾¤ä¸­çèç¹è½å¤å¤±èçæå¤§æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼è¯¥èç¹å°±ä¼è¢«è®¤ä¸ºæéãå¦æä¸»èç¹è¶è¿è¿ä¸ªæ¶é´è¿æ¯ä¸å¯è¾¾ï¼åç¨å®çä»èç¹å°å¯å¨æéè¿ç§»ï¼åçº§æä¸»èç¹ãæ³¨æï¼ä»»ä½ä¸ä¸ªèç¹å¨è¿ä¸ªæ¶é´ä¹åå¦æè¿æ¯æ²¡æè¿ä¸å¤§é¨åçä¸»èç¹ï¼åæ­¤èç¹å°åæ­¢æ¥æ¶ä»»ä½è¯·æ±ã\n * cluster-slave-validity-factor <factor> - å¦æè®¾ç½®æï¼ï¼åæ è®ºä»èç¹ä¸ä¸»èç¹å¤±èå¤ä¹ï¼ä»èç¹é½ä¼å°è¯åçº§æä¸»èç¹ãå¦æè®¾ç½®ææ­£æ°ï¼å cluster-node-timeout ä¹ä»¥ cluster-slave-validity-factor å¾å°çæ¶é´ï¼æ¯ä»èç¹ä¸ä¸»èç¹å¤±èåï¼æ­¤ä»èç¹æ°æ®ææçæé¿æ¶é´ï¼è¶è¿è¿ä¸ªæ¶é´ï¼ä»èç¹ä¸ä¼å¯å¨æéè¿ç§»ãåè®¾ cluster-node-timeout=5ï¼cluster-slave-validity-factor=10ï¼åå¦æä»èç¹è·ä¸»èç¹å¤±èè¶è¿ 50 ç§ï¼æ­¤ä»èç¹ä¸è½æä¸ºä¸»èç¹ãæ³¨æï¼å¦ææ­¤åæ°éç½®ä¸ºé 0ï¼å°å¯è½åºç°ç±äºæä¸»èç¹å¤±èå´æ²¡æä»èç¹è½é¡¶ä¸çæåµï¼ä»èå¯¼è´éç¾¤ä¸è½æ­£å¸¸å·¥ä½ï¼å¨è¿ç§æåµä¸ï¼åªæç­å°åæ¥çä¸»èç¹éæ°åå½å°éç¾¤ï¼éç¾¤ææ¢å¤è¿ä½ã\n * cluster-migration-barrier <count> - ä¸»èç¹éè¦çæå°ä»èç¹æ°ï¼åªæè¾¾å°è¿ä¸ªæ°ï¼ä¸»èç¹å¤±è´¥æ¶ï¼å®ä»èç¹æä¼è¿è¡è¿ç§»ãæ´è¯¦ç»ä»ç»å¯ä»¥çæ¬æç¨åé¢å³äºå¯æ¬è¿ç§»å°é¨åã\n * cluster-require-full-coverage <yes/no> - å¨é¨å key æå¨çèç¹ä¸å¯ç¨æ¶ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºâyesâ(é»è®¤å¼), åæ´ä¸ªéç¾¤åæ­¢æ¥åæä½ï¼å¦ææ­¤åæ°è®¾ç½®ä¸ºânoâï¼åéç¾¤ä¾ç¶ä¸ºå¯è¾¾èç¹ä¸ç key æä¾è¯»æä½ã\n\n\n# 5. å¶ä» redis éç¾¤æ¹æ¡\n\nredis cluster ä¸å¤ªéåç¨äºå¤§è§æ¨¡éç¾¤ï¼æä»¥ï¼å¦æè¦æå»ºè¶å¤§ redis éç¾¤ï¼éè¦éæ©æ¿ä»£æ¹æ¡ãä¸è¬æä¸ç§æ¹æ¡ç±»åï¼\n\n * å®¢æ·ç«¯ååºæ¹æ¡\n * ä»£çååºæ¹æ¡\n * æ¥è¯¢è·¯ç±æ¹æ¡\n\n\n# 5.1. å®¢æ·ç«¯ååºæ¹æ¡\n\nå®¢æ·ç«¯ å°±å·²ç»å³å®æ°æ®ä¼è¢« å­å¨ å°åªä¸ª redis èç¹æèä»åªä¸ª redis èç¹ è¯»åæ°æ®ãå¶ä¸»è¦ææ³æ¯éç¨ åå¸ç®æ³ å° redis æ°æ®ç key è¿è¡æ£åï¼éè¿ hash å½æ°ï¼ç¹å®ç keyä¼ æ å° å°ç¹å®ç redis èç¹ä¸ã\n\nå®¢æ·ç«¯ååºæ¹æ¡ çä»£è¡¨ä¸º redis shardingï¼redis sharding æ¯ redis cluster åºæ¥ä¹åï¼ä¸çæ®éä½¿ç¨ç redis å¤å®ä¾éç¾¤ æ¹æ³ãjava ç redis å®¢æ·ç«¯é©±å¨åº jedisï¼æ¯æ redis sharding åè½ï¼å³ shardedjedis ä»¥å ç»åç¼å­æ±  ç shardedjedispoolã\n\n * ä¼ç¹ï¼ä¸ä½¿ç¨ ç¬¬ä¸æ¹ä¸­é´ä»¶ï¼ååºé»è¾ å¯æ§ï¼éç½® ç®åï¼èç¹ä¹é´æ å³èï¼å®¹æ çº¿æ§æ©å±ï¼çµæ´»æ§å¼ºã\n\n * ç¼ºç¹ï¼å®¢æ·ç«¯ æ æ³ å¨æå¢å  æå¡èç¹ï¼å®¢æ·ç«¯éè¦èªè¡ç»´æ¤ ååé»è¾ï¼å®¢æ·ç«¯ä¹é´ æ è¿æ¥å±äº«ï¼ä¼é æ è¿æ¥æµªè´¹ã\n\n\n# 5.2. ä»£çååºæ¹æ¡\n\nå®¢æ·ç«¯ åéè¯·æ±å°ä¸ä¸ª ä»£çç»ä»¶ï¼ä»£ç è§£æ å®¢æ·ç«¯ çæ°æ®ï¼å¹¶å°è¯·æ±è½¬åè³æ­£ç¡®çèç¹ï¼æåå°ç»æåå¤ç»å®¢æ·ç«¯ã\n\n * ä¼ç¹ï¼ç®å å®¢æ·ç«¯ çåå¸å¼é»è¾ï¼å®¢æ·ç«¯ éææ¥å¥ï¼åæ¢ææ¬ä½ï¼ä»£çç è½¬å å å­å¨ åç¦»ã\n * ç¼ºç¹ï¼å¤äºä¸å± ä»£çå±ï¼å éäº æ¶æé¨ç½²å¤æåº¦ å æ§è½æèã\n\nä»£çååº ä¸»æµå®ç°çææ¹æ¡æ twemproxy å codisã\n\n# 5.2.1. twemproxy\n\ntwemproxy ä¹å« nutcrakerï¼æ¯ twitter å¼æºçä¸ä¸ª redis å memcache ç ä¸­é´ä»£çæå¡å¨ ç¨åºã\n\ntwemproxy ä½ä¸º ä»£çï¼å¯æ¥åæ¥èªå¤ä¸ªç¨åºçè®¿é®ï¼æç§ è·¯ç±è§åï¼è½¬åç»åå°çåä¸ª redis æå¡å¨ï¼ååè·¯è¿åãtwemproxy å­å¨ åç¹æé é®é¢ï¼éè¦ç»å lvs å keepalived å é«å¯ç¨æ¹æ¡ã\n\n * ä¼ç¹ï¼åºç¨èå´å¹¿ï¼ç¨³å®æ§è¾é«ï¼ä¸­é´ä»£çå± é«å¯ç¨ã\n * ç¼ºç¹ï¼æ æ³å¹³æ»å° æ°´å¹³æ©å®¹/ç¼©å®¹ï¼æ  å¯è§åç®¡ççé¢ï¼è¿ç»´ä¸åå¥½ï¼åºç°æéï¼ä¸è½ èªå¨è½¬ç§»ã\n\n# 5.2.2. codis\n\ncodis æ¯ä¸ä¸ª åå¸å¼ redis è§£å³æ¹æ¡ï¼å¯¹äºä¸å±åºç¨æ¥è¯´ï¼è¿æ¥ codis-proxy åç´æ¥è¿æ¥ åçç redis-server æ²¡æçåºå«ãcodis åºå±ä¼ å¤çè¯·æ±çè½¬åï¼ä¸åæºçè¿è¡ æ°æ®è¿ç§» ç­å·¥ä½ãcodis éç¨äºæ ç¶æç ä»£çå±ï¼å¯¹äº å®¢æ·ç«¯ æ¥è¯´ï¼ä¸åé½æ¯éæçã\n\n * ä¼ç¹ï¼å®ç°äºä¸å± proxy ååºå± redis ç é«å¯ç¨ï¼æ°æ®ååº å èªå¨å¹³è¡¡ï¼æä¾ å½ä»¤è¡æ¥å£ å restful apiï¼æä¾ çæ§ å ç®¡ç çé¢ï¼å¯ä»¥å¨æ æ·»å  å å é¤ redis èç¹ã\n\n * ç¼ºç¹ï¼é¨ç½²æ¶æ å éç½® å¤æï¼ä¸æ¯æ è·¨æºæ¿ å å¤ç§æ·ï¼ä¸æ¯æ é´æç®¡çã\n\n\n# 5.3. æ¥è¯¢è·¯ç±æ¹æ¡\n\nå®¢æ·ç«¯éæºå° è¯·æ±ä»»æä¸ä¸ª redis å®ä¾ï¼ç¶åç± redis å°è¯·æ± è½¬å ç» æ­£ç¡® ç redis èç¹ãredis cluster å®ç°äºä¸ç§ æ··åå½¢å¼ ç æ¥è¯¢è·¯ç±ï¼ä½å¹¶ä¸æ¯ ç´æ¥ å°è¯·æ±ä»ä¸ä¸ª redis èç¹ è½¬å å°å¦ä¸ä¸ª redis èç¹ï¼èæ¯å¨ å®¢æ·ç«¯ çå¸®å©ä¸ç´æ¥ éå®åï¼ redirectedï¼å°æ­£ç¡®ç redis èç¹ã\n\n * ä¼ç¹ï¼å»ä¸­å¿åï¼æ°æ®æç§ æ§½ å­å¨åå¸å¨å¤ä¸ª redis å®ä¾ä¸ï¼å¯ä»¥å¹³æ»çè¿è¡èç¹ æ©å®¹/ç¼©å®¹ï¼æ¯æ é«å¯ç¨ å èªå¨æéè½¬ç§»ï¼è¿ç»´ææ¬ä½ã\n\n * ç¼ºç¹ï¼éåº¦ä¾èµ redis-trib å·¥å·ï¼ç¼ºä¹ çæ§ç®¡çï¼éè¦ä¾èµ smart client (ç»´æ¤è¿æ¥ï¼ç¼å­è·¯ç±è¡¨ï¼multiop å pipeline æ¯æ)ãfailover èç¹ç æ£æµè¿æ¢ï¼ä¸å¦æ ä¸­å¿èç¹ çéç¾¤åæ¶ï¼å¦ zookeeperï¼ãgossip æ¶æ¯éç¨å¹¿æ­æ¹å¼ï¼éç¾¤è§æ¨¡è¶å¤§ï¼å¼éè¶å¤§ãæ æ³æ ¹æ®ç»è®¡åºå å·ç­æ°æ®ã\n\n\n# 6. åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¸­é´ä»¶\n   * twemproxy\n   * codis\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * åç«¯å­å¨å®æè¯¾\n * æç« \n   * redis éç¾¤æç¨\n   * redis éç¾¤çåçåæ­å»º\n   * æ·±å¥åæ redis ç³»å(ä¸) - redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis å®æ",frontmatter:{title:"Redis å®æ",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis"],permalink:"/pages/199c5a/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/08.Redis%E5%AE%9E%E6%88%98.html",relativePath:"05.KVæ°æ®åº/01.Redis/08.Rediså®æ.md",key:"v-4092c244",path:"/pages/199c5a/",headers:[{level:2,title:"ä¸ãåºç¨åºæ¯",slug:"ä¸ãåºç¨åºæ¯",normalizedTitle:"ä¸ãåºç¨åºæ¯",charIndex:15},{level:3,title:"ç¼å­",slug:"ç¼å­",normalizedTitle:"ç¼å­",charIndex:58},{level:3,title:"BitMap å BloomFilter",slug:"bitmap-å-bloomfilter",normalizedTitle:"bitmap å bloomfilter",charIndex:175},{level:3,title:"åå¸å¼é",slug:"åå¸å¼é",normalizedTitle:"åå¸å¼é",charIndex:384},{level:2,title:"äºãæå·§",slug:"äºãæå·§",normalizedTitle:"äºãæå·§",charIndex:597},{level:3,title:"keys å scan",slug:"keys-å-scan",normalizedTitle:"keys å scan",charIndex:638},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1023}],headersStr:"ä¸ãåºç¨åºæ¯ ç¼å­ BitMap å BloomFilter åå¸å¼é äºãæå·§ keys å scan åèèµæ",content:"# Redis å®æ\n\n\n# ä¸ãåºç¨åºæ¯\n\nRedis å¯ä»¥åºç¨äºå¾å¤åºæ¯ï¼è¿éåä¸¾å ä¸ªç»å¸çåºç¨åºæ¯ã\n\n\n# ç¼å­\n\nç¼å­æ¯ Redis æå¸¸è§çåºç¨åºæ¯ã\n\nRedis æå¤ç§æ°æ®ç±»åï¼ä»¥åä¸°å¯çæä½å½ä»¤ï¼å¹¶ä¸æçé«æ§è½ãé«å¯ç¨çç¹æ§ï¼éå¸¸éåç¨äºåå¸å¼ç¼å­ã\n\n> ç¼å­åºç¨çåºæ¬åçï¼è¯·åè ç¼å­åºæ¬åç ç¬¬å ~ ç¬¬å­èåå®¹ã\n\n\n# BitMap å BloomFilter\n\nRedis é¤äº 5 ç§åºæ¬æ°æ®ç±»åå¤ï¼è¿æ¯æ BitMap å BloomFilterï¼å³å¸éè¿æ»¤å¨ï¼å¯ä»¥éè¿ Redis Module æ¯æï¼ã\n\nBitMap å BloomFilter é½å¯ä»¥ç¨äºè§£å³ç¼å­ç©¿éé®é¢ãè¦ç¹å¨äºï¼è¿æ»¤ä¸äºä¸å¯è½å­å¨çæ°æ®ã\n\n> ä»ä¹æ¯ç¼å­ç©¿éï¼å¯ä»¥åèï¼ç¼å­åºæ¬åç\n\nå°æ°æ®éå¯ä»¥ç¨ BitMapï¼å¤§æ°æ®éå¯ä»¥ç¨å¸éè¿æ»¤å¨ã\n\n\n# åå¸å¼é\n\nä½¿ç¨ Redis ä½ä¸ºåå¸å¼éï¼åºæ¬è¦ç¹å¦ä¸ï¼\n\n * äºæ¥æ§ - ä½¿ç¨ setnx æ¢å éã\n * é¿åæ°¸è¿ä¸éæ¾é - ä½¿ç¨ expire å ä¸ä¸ªè¿ææ¶é´ï¼é¿åä¸ç´ä¸éæ¾éï¼å¯¼è´é»å¡ã\n * åå­æ§ - setnx å expire å¿é¡»åå¹¶ä¸ºä¸ä¸ªåå­æä»¤ï¼é¿å setnx åï¼æºå¨å´©æºï¼æ²¡æ¥å¾åè®¾ç½® expireï¼ä»èå¯¼è´éæ°¸ä¸éæ¾ã\n\n> æ´å¤åå¸å¼éçå®ç°æ¹å¼åç»èï¼è¯·åèï¼åå¸å¼éåºæ¬åç\n\n\n# äºãæå·§\n\næ ¹æ® Redis çç¹æ§ï¼å¨å®éåºç¨ä¸­ï¼å­å¨ä¸äºåºç¨å°æå·§ã\n\n\n# keys å scan\n\nä½¿ç¨ keys æä»¤å¯ä»¥æ«åºæå®æ¨¡å¼ç key åè¡¨ã\n\nå¦æè¿ä¸ª redis æ­£å¨ç»çº¿ä¸çä¸å¡æä¾æå¡ï¼é£ä½¿ç¨ keys æä»¤ä¼æä»ä¹é®é¢ï¼\n\né¦åï¼Redis æ¯åçº¿ç¨çãkeys æä»¤ä¼å¯¼è´çº¿ç¨é»å¡ä¸æ®µæ¶é´ï¼çº¿ä¸æå¡ä¼åé¡¿ï¼ç´å°æä»¤æ§è¡å®æ¯ï¼æå¡æè½æ¢å¤ã\n\nè¿ä¸ªæ¶åå¯ä»¥ä½¿ç¨ scan æä»¤ï¼scan æä»¤å¯ä»¥æ é»å¡çæååºæå®æ¨¡å¼ç key åè¡¨ï¼ä½æ¯ä¼æä¸å®çéå¤æ¦çï¼å¨å®¢æ·ç«¯åä¸æ¬¡å»éå°±å¯ä»¥äºï¼ä½æ¯æ´ä½æè±è´¹çæ¶é´ä¼æ¯ç´æ¥ç¨ keys æä»¤é¿ã\n\nä¸è¿ï¼å¢éå¼è¿­ä»£å½ä»¤ä¹ä¸æ¯æ²¡æç¼ºç¹çï¼ ä¸¾ä¸ªä¾å­ï¼ ä½¿ç¨ SMEMBERS å½ä»¤å¯ä»¥è¿åéåé®å½ååå«çææåç´ ï¼ ä½æ¯å¯¹äº SCAN è¿ç±»å¢éå¼è¿­ä»£å½ä»¤æ¥è¯´ï¼ å ä¸ºå¨å¯¹é®è¿è¡å¢éå¼è¿­ä»£çè¿ç¨ä¸­ï¼ é®å¯è½ä¼è¢«ä¿®æ¹ï¼ æä»¥å¢éå¼è¿­ä»£å½ä»¤åªè½å¯¹è¢«è¿åçåç´ æä¾æéçä¿è¯ ã\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- Redis åºç¡",normalizedContent:"# redis å®æ\n\n\n# ä¸ãåºç¨åºæ¯\n\nredis å¯ä»¥åºç¨äºå¾å¤åºæ¯ï¼è¿éåä¸¾å ä¸ªç»å¸çåºç¨åºæ¯ã\n\n\n# ç¼å­\n\nç¼å­æ¯ redis æå¸¸è§çåºç¨åºæ¯ã\n\nredis æå¤ç§æ°æ®ç±»åï¼ä»¥åä¸°å¯çæä½å½ä»¤ï¼å¹¶ä¸æçé«æ§è½ãé«å¯ç¨çç¹æ§ï¼éå¸¸éåç¨äºåå¸å¼ç¼å­ã\n\n> ç¼å­åºç¨çåºæ¬åçï¼è¯·åè ç¼å­åºæ¬åç ç¬¬å ~ ç¬¬å­èåå®¹ã\n\n\n# bitmap å bloomfilter\n\nredis é¤äº 5 ç§åºæ¬æ°æ®ç±»åå¤ï¼è¿æ¯æ bitmap å bloomfilterï¼å³å¸éè¿æ»¤å¨ï¼å¯ä»¥éè¿ redis module æ¯æï¼ã\n\nbitmap å bloomfilter é½å¯ä»¥ç¨äºè§£å³ç¼å­ç©¿éé®é¢ãè¦ç¹å¨äºï¼è¿æ»¤ä¸äºä¸å¯è½å­å¨çæ°æ®ã\n\n> ä»ä¹æ¯ç¼å­ç©¿éï¼å¯ä»¥åèï¼ç¼å­åºæ¬åç\n\nå°æ°æ®éå¯ä»¥ç¨ bitmapï¼å¤§æ°æ®éå¯ä»¥ç¨å¸éè¿æ»¤å¨ã\n\n\n# åå¸å¼é\n\nä½¿ç¨ redis ä½ä¸ºåå¸å¼éï¼åºæ¬è¦ç¹å¦ä¸ï¼\n\n * äºæ¥æ§ - ä½¿ç¨ setnx æ¢å éã\n * é¿åæ°¸è¿ä¸éæ¾é - ä½¿ç¨ expire å ä¸ä¸ªè¿ææ¶é´ï¼é¿åä¸ç´ä¸éæ¾éï¼å¯¼è´é»å¡ã\n * åå­æ§ - setnx å expire å¿é¡»åå¹¶ä¸ºä¸ä¸ªåå­æä»¤ï¼é¿å setnx åï¼æºå¨å´©æºï¼æ²¡æ¥å¾åè®¾ç½® expireï¼ä»èå¯¼è´éæ°¸ä¸éæ¾ã\n\n> æ´å¤åå¸å¼éçå®ç°æ¹å¼åç»èï¼è¯·åèï¼åå¸å¼éåºæ¬åç\n\n\n# äºãæå·§\n\næ ¹æ® redis çç¹æ§ï¼å¨å®éåºç¨ä¸­ï¼å­å¨ä¸äºåºç¨å°æå·§ã\n\n\n# keys å scan\n\nä½¿ç¨ keys æä»¤å¯ä»¥æ«åºæå®æ¨¡å¼ç key åè¡¨ã\n\nå¦æè¿ä¸ª redis æ­£å¨ç»çº¿ä¸çä¸å¡æä¾æå¡ï¼é£ä½¿ç¨ keys æä»¤ä¼æä»ä¹é®é¢ï¼\n\né¦åï¼redis æ¯åçº¿ç¨çãkeys æä»¤ä¼å¯¼è´çº¿ç¨é»å¡ä¸æ®µæ¶é´ï¼çº¿ä¸æå¡ä¼åé¡¿ï¼ç´å°æä»¤æ§è¡å®æ¯ï¼æå¡æè½æ¢å¤ã\n\nè¿ä¸ªæ¶åå¯ä»¥ä½¿ç¨ scan æä»¤ï¼scan æä»¤å¯ä»¥æ é»å¡çæååºæå®æ¨¡å¼ç key åè¡¨ï¼ä½æ¯ä¼æä¸å®çéå¤æ¦çï¼å¨å®¢æ·ç«¯åä¸æ¬¡å»éå°±å¯ä»¥äºï¼ä½æ¯æ´ä½æè±è´¹çæ¶é´ä¼æ¯ç´æ¥ç¨ keys æä»¤é¿ã\n\nä¸è¿ï¼å¢éå¼è¿­ä»£å½ä»¤ä¹ä¸æ¯æ²¡æç¼ºç¹çï¼ ä¸¾ä¸ªä¾å­ï¼ ä½¿ç¨ smembers å½ä»¤å¯ä»¥è¿åéåé®å½ååå«çææåç´ ï¼ ä½æ¯å¯¹äº scan è¿ç±»å¢éå¼è¿­ä»£å½ä»¤æ¥è¯´ï¼ å ä¸ºå¨å¯¹é®è¿è¡å¢éå¼è¿­ä»£çè¿ç¨ä¸­ï¼ é®å¯è½ä¼è¢«ä¿®æ¹ï¼ æä»¥å¢éå¼è¿­ä»£å½ä»¤åªè½å¯¹è¢«è¿åçåç´ æä¾æéçä¿è¯ ã\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- redis åºç¡",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis è¿ç»´",frontmatter:{title:"Redis è¿ç»´",date:"2020-06-24T10:45:38.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis","è¿ç»´"],permalink:"/pages/8f1824/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/20.Redis%E8%BF%90%E7%BB%B4.html",relativePath:"05.KVæ°æ®åº/01.Redis/20.Redisè¿ç»´.md",key:"v-d49f587c",path:"/pages/8f1824/",headers:[{level:2,title:"ä¸ãRedis å®è£",slug:"ä¸ãredis-å®è£",normalizedTitle:"ä¸ãredis å®è£",charIndex:90},{level:3,title:"Window ä¸å®è£",slug:"window-ä¸å®è£",normalizedTitle:"window ä¸å®è£",charIndex:105},{level:3,title:"Linux ä¸å®è£",slug:"linux-ä¸å®è£",normalizedTitle:"linux ä¸å®è£",charIndex:521},{level:3,title:"Ubuntu ä¸å®è£",slug:"ubuntu-ä¸å®è£",normalizedTitle:"ubuntu ä¸å®è£",charIndex:926},{level:3,title:"å¼æºå¯å¨",slug:"å¼æºå¯å¨",normalizedTitle:"å¼æºå¯å¨",charIndex:1028},{level:3,title:"å¼æ¾é²ç«å¢ç«¯å£",slug:"å¼æ¾é²ç«å¢ç«¯å£",normalizedTitle:"å¼æ¾é²ç«å¢ç«¯å£",charIndex:1116},{level:3,title:"Redis å®è£èæ¬",slug:"redis-å®è£èæ¬",normalizedTitle:"redis å®è£èæ¬",charIndex:1262},{level:2,title:"äºãRedis åæºä½¿ç¨åéç½®",slug:"äºãredis-åæºä½¿ç¨åéç½®",normalizedTitle:"äºãredis åæºä½¿ç¨åéç½®",charIndex:1797},{level:3,title:"å¯å¨ Redis",slug:"å¯å¨-redis",normalizedTitle:"å¯å¨ redis",charIndex:806},{level:3,title:"Redis å¸¸è§éç½®",slug:"redis-å¸¸è§éç½®",normalizedTitle:"redis å¸¸è§éç½®",charIndex:2110},{level:3,title:"è®¾ä¸ºå®æ¤è¿ç¨",slug:"è®¾ä¸ºå®æ¤è¿ç¨",normalizedTitle:"è®¾ä¸ºå®æ¤è¿ç¨",charIndex:2475},{level:4,title:"è¿ç¨è®¿é®",slug:"è¿ç¨è®¿é®",normalizedTitle:"è¿ç¨è®¿é®",charIndex:2547},{level:4,title:"è®¾ç½®å¯ç ",slug:"è®¾ç½®å¯ç ",normalizedTitle:"è®¾ç½®å¯ç ",charIndex:2623},{level:4,title:"éç½®åæ°è¡¨",slug:"éç½®åæ°è¡¨",normalizedTitle:"éç½®åæ°è¡¨",charIndex:2708},{level:3,title:"ååæµè¯",slug:"ååæµè¯",normalizedTitle:"ååæµè¯",charIndex:8470},{level:2,title:"ä¸ãRedis éç¾¤ä½¿ç¨åéç½®",slug:"ä¸ãredis-éç¾¤ä½¿ç¨åéç½®",normalizedTitle:"ä¸ãredis éç¾¤ä½¿ç¨åéç½®",charIndex:8900},{level:3,title:"éç¾¤è§å",slug:"éç¾¤è§å",normalizedTitle:"éç¾¤è§å",charIndex:8940},{level:3,title:"é¨ç½²éç¾¤",slug:"é¨ç½²éç¾¤",normalizedTitle:"é¨ç½²éç¾¤",charIndex:9380},{level:3,title:"é¨ç½²å¨åµ",slug:"é¨ç½²å¨åµ",normalizedTitle:"é¨ç½²å¨åµ",charIndex:14391},{level:3,title:"æ©å®¹",slug:"æ©å®¹",normalizedTitle:"æ©å®¹",charIndex:15521},{level:2,title:"åãRedis å½ä»¤",slug:"åãredis-å½ä»¤",normalizedTitle:"åãredis å½ä»¤",charIndex:20733},{level:3,title:"éç¨å½ä»¤",slug:"éç¨å½ä»¤",normalizedTitle:"éç¨å½ä»¤",charIndex:20748},{level:3,title:"éç¾¤å½ä»¤",slug:"éç¾¤å½ä»¤",normalizedTitle:"éç¾¤å½ä»¤",charIndex:20874},{level:4,title:"éæ°åç",slug:"éæ°åç",normalizedTitle:"éæ°åç",charIndex:21940},{level:2,title:"äºãå®¢æ·ç«¯",slug:"äºãå®¢æ·ç«¯",normalizedTitle:"äºãå®¢æ·ç«¯",charIndex:22085},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:22121}],headersStr:"ä¸ãRedis å®è£ Window ä¸å®è£ Linux ä¸å®è£ Ubuntu ä¸å®è£ å¼æºå¯å¨ å¼æ¾é²ç«å¢ç«¯å£ Redis å®è£èæ¬ äºãRedis åæºä½¿ç¨åéç½® å¯å¨ Redis Redis å¸¸è§éç½® è®¾ä¸ºå®æ¤è¿ç¨ è¿ç¨è®¿é® è®¾ç½®å¯ç  éç½®åæ°è¡¨ ååæµè¯ ä¸ãRedis éç¾¤ä½¿ç¨åéç½® éç¾¤è§å é¨ç½²éç¾¤ é¨ç½²å¨åµ æ©å®¹ åãRedis å½ä»¤ éç¨å½ä»¤ éç¾¤å½ä»¤ éæ°åç äºãå®¢æ·ç«¯ åèèµæ",content:'# Redis è¿ç»´\n\n> Redis æ¯ä¸ä¸ªé«æ§è½ç key-value æ°æ®åºã\n> \n> SET æä½æ¯ç§é 110000 æ¬¡ï¼GET æä½æ¯ç§é 81000 æ¬¡ã\n\n\n# ä¸ãRedis å®è£\n\n\n# Window ä¸å®è£\n\nä¸è½½å°åï¼https://github.com/MSOpenTech/redis/releasesã\n\nRedis æ¯æ 32 ä½å 64 ä½ãè¿ä¸ªéè¦æ ¹æ®ä½ ç³»ç»å¹³å°çå®éæåµéæ©ï¼è¿éæä»¬ä¸è½½ Redis-x64-xxx.zipåç¼©åå° C çï¼è§£ååï¼å°æä»¶å¤¹éæ°å½åä¸º redisã\n\næå¼ä¸ä¸ª cmd çªå£ ä½¿ç¨ cd å½ä»¤åæ¢ç®å½å° C:\\redis è¿è¡ redis-server.exe redis.windows.conf ã\n\nå¦ææ³æ¹ä¾¿çè¯ï¼å¯ä»¥æ redis çè·¯å¾å å°ç³»ç»çç¯å¢åééï¼è¿æ ·å°±çå¾åè¾è·¯å¾äºï¼åé¢çé£ä¸ª redis.windows.conf å¯ä»¥çç¥ï¼å¦æçç¥ï¼ä¼å¯ç¨é»è®¤çã\n\nè¿æ¶åå¦å¯ä¸ä¸ª cmd çªå£ï¼åæ¥çä¸è¦å³é­ï¼ä¸ç¶å°±æ æ³è®¿é®æå¡ç«¯äºã\n\nåæ¢å° redis ç®å½ä¸è¿è¡ redis-cli.exe -h 127.0.0.1 -p 6379 ã\n\n\n# Linux ä¸å®è£\n\nä¸è½½å°åï¼ http://redis.io/downloadï¼ä¸è½½ææ°ææ¡£çæ¬ã\n\nä¸è½½ãè§£åãç¼è¯ Redis\n\nwget http://download.redis.io/releases/redis-5.0.4.tar.gz\ntar xzf redis-5.0.4.tar.gz\ncd redis-5.0.4\nmake\n\n\nä¸ºäºç¼è¯ Redis æºç ï¼ä½ éè¦ gcc-c++å tclãå¦æä½ çç³»ç»æ¯ CentOSï¼å¯ä»¥ç´æ¥æ§è¡å½ä»¤ï¼yum install -y gcc-c++ tcl æ¥å®è£ã\n\nè¿å¥å°è§£ååç src ç®å½ï¼éè¿å¦ä¸å½ä»¤å¯å¨ Redis:\n\nsrc/redis-server\n\n\næ¨å¯ä»¥ä½¿ç¨åç½®çå®¢æ·ç«¯ä¸ Redis è¿è¡äº¤äº:\n\n$ src/redis-cli\nredis> set foo bar\nOK\nredis> get foo\n"bar"\n\n\n\n# Ubuntu ä¸å®è£\n\nå¨ Ubuntu ç³»ç»å®è£ Redis å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤:\n\nsudo apt-get update\nsudo apt-get install redis-server\n\n\n\n# å¼æºå¯å¨\n\n * å¼æºå¯å¨éç½®ï¼echo "/usr/local/bin/redis-server /etc/redis.conf" >> /etc/rc.local\n\n\n# å¼æ¾é²ç«å¢ç«¯å£\n\n * æ·»å è§åï¼iptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT\n * ä¿å­è§åï¼service iptables save\n * éå¯ iptablesï¼service iptables restart\n\n\n# Redis å®è£èæ¬\n\n> CentOS7 ç¯å¢å®è£èæ¬ï¼è½¯ä»¶è¿ç»´éç½®èæ¬éå\n\nå®è£è¯´æ\n\n * éç¨ç¼è¯æ¹å¼å®è£ Redis, å¹¶å°å¶æ³¨åä¸º systemd æå¡\n * å®è£è·¯å¾ä¸ºï¼/usr/local/redis\n * é»è®¤ä¸è½½å®è£ 5.0.4 çæ¬ï¼ç«¯å£å·ä¸ºï¼6379ï¼å¯ç ä¸ºç©º\n\nä½¿ç¨æ¹æ³\n\n * é»è®¤å®è£ - æ§è¡ä»¥ä¸ä»»æå½ä»¤å³å¯ï¼\n\ncurl -o- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\nwget -qO- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\n\n\n * èªå®ä¹å®è£ - ä¸è½½èæ¬å°æ¬å°ï¼å¹¶æç§ä»¥ä¸æ ¼å¼æ§è¡ï¼\n\nsh redis-install.sh [version] [port] [password]\n\n\nåæ°è¯´æï¼\n\n * version - redis çæ¬å·\n * port - redis æå¡ç«¯å£å·\n * password - è®¿é®å¯ç \n\n\n# äºãRedis åæºä½¿ç¨åéç½®\n\n\n# å¯å¨ Redis\n\nå¯å¨ redis æå¡\n\ncd /usr/local/redis/src\n./redis-server\n\n\nå¯å¨ redis å®¢æ·ç«¯\n\ncd /usr/local/redis/src\n./redis-cli\n\n\næ¥ç redis æ¯å¦å¯å¨\n\nredis-cli\n\n\nä»¥ä¸å½ä»¤å°æå¼ä»¥ä¸ç»ç«¯ï¼\n\nredis 127.0.0.1:6379>\n\n\n127.0.0.1 æ¯æ¬æº IP ï¼6379 æ¯ redis æå¡ç«¯å£ãç°å¨æä»¬è¾å¥ PING å½ä»¤ã\n\nredis 127.0.0.1:6379> ping\nPONG\n\n\nä»¥ä¸è¯´ææä»¬å·²ç»æåå¯å¨äº redisã\n\n\n# Redis å¸¸è§éç½®\n\n> Redis é»è®¤çéç½®æä»¶æ¯æ ¹ç®å½ä¸ç redis.conf æä»¶ã\n> \n> å¦æéè¦æå®ç¹å®æä»¶ä½ä¸ºéç½®æä»¶ï¼éè¦ä½¿ç¨å½ä»¤ï¼ ./redis-server -c xxx.conf\n> \n> æ¯æ¬¡ä¿®æ¹éç½®åï¼éè¦éå¯æè½çæã\n> \n> Redis å®æ¹é»è®¤éç½®ï¼\n> \n>  * èªæè¿°ææ¡£ redis.conf for Redis 2.8\n>  * èªæè¿°ææ¡£ redis.conf for Redis 2.6.\n>  * èªæè¿°ææ¡£ redis.conf for Redis 2.4.\n> \n> èª Redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é Redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ãèª Redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é Redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ã\n\n\n# è®¾ä¸ºå®æ¤è¿ç¨\n\nRedis é»è®¤ä»¥éå®æ¤è¿ç¨æ¹å¼å¯å¨ï¼èéå¸¸æä»¬ä¼å° Redis è®¾ä¸ºå®æ¤è¿ç¨å¯å¨æ¹å¼ï¼éç½®ï¼daemonize yes\n\n# è¿ç¨è®¿é®\n\nRedis é»è®¤ç»å® 127.0.0.1ï¼è¿æ ·å°±åªè½æ¬æºæè½è®¿é®ï¼è¥è¦ Redis åè®¸è¿ç¨è®¿é®ï¼éè¦éç½®ï¼bind 0.0.0.0\n\n# è®¾ç½®å¯ç \n\nRedis é»è®¤è®¿é®ä¸éè¦å¯ç ï¼å¦æéè¦è®¾ç½®å¯ç ï¼éè¦å¦ä¸éç½®ï¼\n\n * protected-mode yes\n * requirepass <å¯ç >\n\n# éç½®åæ°è¡¨\n\néç½®é¡¹                                                         è¯´æ\ndaemonize no                                                Redis é»è®¤ä¸æ¯ä»¥å®æ¤è¿ç¨çæ¹å¼è¿è¡ï¼å¯ä»¥éè¿è¯¥éç½®é¡¹ä¿®æ¹ï¼ä½¿ç¨ yes å¯ç¨å®æ¤è¿ç¨ï¼Windows\n                                                            ä¸æ¯æå®æ¤çº¿ç¨çéç½®ä¸º no ï¼\npidfile /var/run/redis.pid                                  å½ Redis ä»¥å®æ¤è¿ç¨æ¹å¼è¿è¡æ¶ï¼Redis é»è®¤ä¼æ pid åå¥ /var/run/redis.pid\n                                                            æä»¶ï¼å¯ä»¥éè¿ pidfile æå®\nport 6379                                                   æå® Redis çå¬ç«¯å£ï¼é»è®¤ç«¯å£ä¸º 6379ï¼ä½èå¨èªå·±çä¸ç¯åæä¸­è§£éäºä¸ºä»ä¹éç¨ 6379 ä½ä¸ºé»è®¤ç«¯å£ï¼å ä¸º\n                                                            6379 å¨ææºæé®ä¸ MERZ å¯¹åºçå·ç ï¼è MERZ åèªæå¤§å©æ­å¥³ Alessia Merz çåå­\nbind 127.0.0.1                                              ç»å®çä¸»æºå°å\ntimeout 300                                                 å½å®¢æ·ç«¯é²ç½®å¤é¿æ¶é´åå³é­è¿æ¥ï¼å¦ææå®ä¸º 0ï¼è¡¨ç¤ºå³é­è¯¥åè½\nloglevel notice                                             æå®æ¥å¿è®°å½çº§å«ï¼Redis æ»å±æ¯æåä¸ªçº§å«ï¼debugãverboseãnoticeãwarningï¼é»è®¤ä¸º\n                                                            notice\nlogfile stdout                                              æ¥å¿è®°å½æ¹å¼ï¼é»è®¤ä¸ºæ åè¾åºï¼å¦æéç½® Redis\n                                                            ä¸ºå®æ¤è¿ç¨æ¹å¼è¿è¡ï¼èè¿éåéç½®ä¸ºæ¥å¿è®°å½æ¹å¼ä¸ºæ åè¾åºï¼åæ¥å¿å°ä¼åéç» /dev/null\ndatabases 16                                                è®¾ç½®æ°æ®åºçæ°éï¼é»è®¤æ°æ®åºä¸º 0ï¼å¯ä»¥ä½¿ç¨ SELECT å½ä»¤å¨è¿æ¥ä¸æå®æ°æ®åº id\nsave <seconds> <changes> Redis é»è®¤éç½®æä»¶ä¸­æä¾äºä¸ä¸ªæ¡ä»¶ï¼save 900      æå®å¨å¤é¿æ¶é´åï¼æå¤å°æ¬¡æ´æ°æä½ï¼å°±å°æ°æ®åæ­¥å°æ°æ®æä»¶ï¼å¯ä»¥å¤ä¸ªæ¡ä»¶éå\n1ãsave 300 10ãsave 60 10000 åå«è¡¨ç¤º 900 ç§ï¼15 åéï¼åæ 1 ä¸ªæ´æ¹ï¼300\nç§ï¼5 åéï¼åæ 10 ä¸ªæ´æ¹ä»¥å 60 ç§åæ 10000 ä¸ªæ´æ¹ã\nrdbcompression yes                                          æå®å­å¨è³æ¬å°æ°æ®åºæ¶æ¯å¦åç¼©æ°æ®ï¼é»è®¤ä¸º yesï¼Redis éç¨ LZF åç¼©ï¼å¦æä¸ºäºèç CPU\n                                                            æ¶é´ï¼å¯ä»¥å³é­è¯¥éé¡¹ï¼ä½ä¼å¯¼è´æ°æ®åºæä»¶åçå·¨å¤§\ndbfilename dump.rdb                                         æå®æ¬å°æ°æ®åºæä»¶åï¼é»è®¤å¼ä¸º dump.rdb\ndir ./                                                      æå®æ¬å°æ°æ®åºå­æ¾ç®å½\nslaveof <masterip> <masterport>                             è®¾ç½®å½æ¬æºä¸º slav æå¡æ¶ï¼è®¾ç½® master æå¡ç IP å°ååç«¯å£ï¼å¨ Redis å¯å¨æ¶ï¼å®ä¼èªå¨ä»\n                                                            master è¿è¡æ°æ®åæ­¥\nmasterauth <master-password>                                å½ master æå¡è®¾ç½®äºå¯ç ä¿æ¤æ¶ï¼slav æå¡è¿æ¥ master çå¯ç \nrequirepass foobared                                        è®¾ç½® Redis è¿æ¥å¯ç ï¼å¦æéç½®äºè¿æ¥å¯ç ï¼å®¢æ·ç«¯å¨è¿æ¥ Redis æ¶éè¦éè¿ AUTH <password>\n                                                            å½ä»¤æä¾å¯ç ï¼é»è®¤å³é­\nmaxclients 128                                              è®¾ç½®åä¸æ¶é´æå¤§å®¢æ·ç«¯è¿æ¥æ°ï¼é»è®¤æ éå¶ï¼Redis å¯ä»¥åæ¶æå¼çå®¢æ·ç«¯è¿æ¥æ°ä¸º Redis\n                                                            è¿ç¨å¯ä»¥æå¼çæå¤§æä»¶æè¿°ç¬¦æ°ï¼å¦æè®¾ç½® maxclients 0ï¼è¡¨ç¤ºä¸ä½éå¶ãå½å®¢æ·ç«¯è¿æ¥æ°å°è¾¾éå¶æ¶ï¼Redis\n                                                            ä¼å³é­æ°çè¿æ¥å¹¶åå®¢æ·ç«¯è¿å max number of clients reached éè¯¯ä¿¡æ¯\nmaxmemory <bytes>                                           æå® Redis æå¤§åå­éå¶ï¼Redis å¨å¯å¨æ¶ä¼ææ°æ®å è½½å°åå­ä¸­ï¼è¾¾å°æå¤§åå­åï¼Redis\n                                                            ä¼åå°è¯æ¸é¤å·²å°ææå³å°å°æç Keyï¼å½æ­¤æ¹æ³å¤ç\n                                                            åï¼ä»ç¶å°è¾¾æå¤§åå­è®¾ç½®ï¼å°æ æ³åè¿è¡åå¥æä½ï¼ä½ä»ç¶å¯ä»¥è¿è¡è¯»åæä½ãRedis æ°ç vm æºå¶ï¼ä¼æ Key\n                                                            å­æ¾åå­ï¼Value ä¼å­æ¾å¨ swap åº\nappendonly no                                               æå®æ¯å¦å¨æ¯æ¬¡æ´æ°æä½åè¿è¡æ¥å¿è®°å½ï¼Redis\n                                                            å¨é»è®¤æåµä¸æ¯å¼æ­¥çææ°æ®åå¥ç£çï¼å¦æä¸å¼å¯ï¼å¯è½ä¼å¨æ­çµæ¶å¯¼è´ä¸æ®µæ¶é´åçæ°æ®ä¸¢å¤±ãå ä¸º redis\n                                                            æ¬èº«åæ­¥æ°æ®æä»¶æ¯æä¸é¢ save æ¡ä»¶æ¥åæ­¥çï¼æä»¥æçæ°æ®ä¼å¨ä¸æ®µæ¶é´ååªå­å¨äºåå­ä¸­ãé»è®¤ä¸º no\nappendfilename appendonly.aof                               æå®æ´æ°æ¥å¿æä»¶åï¼é»è®¤ä¸º appendonly.aof\nappendfsync everysec                                        æå®æ´æ°æ¥å¿æ¡ä»¶ï¼å±æ 3\n                                                            ä¸ªå¯éå¼ï¼noï¼è¡¨ç¤ºç­æä½ç³»ç»è¿è¡æ°æ®ç¼å­åæ­¥å°ç£çï¼å¿«ï¼alwaysï¼è¡¨ç¤ºæ¯æ¬¡æ´æ°æä½åæå¨è°ç¨ fsync()\n                                                            å°æ°æ®åå°ç£çï¼æ¢ï¼å®å¨ï¼everysecï¼è¡¨ç¤ºæ¯ç§åæ­¥ä¸æ¬¡ï¼æä¸­ï¼é»è®¤å¼ï¼\nvm-enabled no                                               æå®æ¯å¦å¯ç¨èæåå­æºå¶ï¼é»è®¤å¼ä¸º noï¼ç®åçä»ç»ä¸ä¸ï¼VM æºå¶å°æ°æ®åé¡µå­æ¾ï¼ç± Redis\n                                                            å°è®¿é®éè¾å°çé¡µå³å·æ°æ® swap å°ç£çä¸ï¼è®¿é®å¤çé¡µé¢ç±ç£çèªå¨æ¢åºå°åå­ä¸­ï¼å¨åé¢çæç« æä¼ä»ç»åæ Redis\n                                                            ç VM æºå¶ï¼\nvm-swap-file /tmp/redis.swap                                èæåå­æä»¶è·¯å¾ï¼é»è®¤å¼ä¸º /tmp/redis.swapï¼ä¸å¯å¤ä¸ª Redis å®ä¾å±äº«\nvm-max-memory 0                                             å°ææå¤§äº vm-max-memory çæ°æ®å­å¥èæåå­ï¼æ è®º vm-max-memory\n                                                            è®¾ç½®å¤å°ï¼ææç´¢å¼æ°æ®é½æ¯åå­å­å¨ç(Redis çç´¢å¼æ°æ® å°±æ¯ keys)ï¼ä¹å°±æ¯è¯´ï¼å½ vm-max-memory\n                                                            è®¾ç½®ä¸º 0 çæ¶åï¼å¶å®æ¯ææ value é½å­å¨äºç£çãé»è®¤å¼ä¸º 0\nvm-page-size 32                                             Redis swap æä»¶åæäºå¾å¤ç pageï¼ä¸ä¸ªå¯¹è±¡å¯ä»¥ä¿å­å¨å¤ä¸ª page ä¸é¢ï¼ä½ä¸ä¸ª page\n                                                            ä¸ä¸è½è¢«å¤ä¸ªå¯¹è±¡å±äº«ï¼vm-page-size æ¯è¦æ ¹æ®å­å¨ç æ°æ®å¤§å°æ¥è®¾å®çï¼ä½èå»ºè®®å¦æå­å¨å¾å¤å°å¯¹è±¡ï¼page\n                                                            å¤§å°æå¥½è®¾ç½®ä¸º 32 æè 64bytesï¼å¦æå­å¨å¾å¤§å¤§å¯¹è±¡ï¼åå¯ä»¥ä½¿ç¨æ´å¤§ç pageï¼å¦æä¸ç¡®å®ï¼å°±ä½¿ç¨é»è®¤å¼\nvm-pages 134217728                                          è®¾ç½® swap æä»¶ä¸­ç page æ°éï¼ç±äºé¡µè¡¨ï¼ä¸ç§è¡¨ç¤ºé¡µé¢ç©ºé²æä½¿ç¨ç\n                                                            bitmapï¼æ¯å¨æ¾å¨åå­ä¸­çï¼ï¼å¨ç£çä¸æ¯ 8 ä¸ª pages å°æ¶è 1byte çåå­ã\nvm-max-threads 4                                            è®¾ç½®è®¿é® swap æä»¶ççº¿ç¨æ°,æå¥½ä¸è¦è¶è¿æºå¨çæ ¸æ°,å¦æè®¾ç½®ä¸º 0,é£ä¹ææå¯¹ swap\n                                                            æä»¶çæä½é½æ¯ä¸²è¡çï¼å¯è½ä¼é ææ¯è¾é¿æ¶é´çå»¶è¿ãé»è®¤å¼ä¸º 4\nglueoutputbuf yes                                           è®¾ç½®å¨åå®¢æ·ç«¯åºç­æ¶ï¼æ¯å¦æè¾å°çååå¹¶ä¸ºä¸ä¸ªååéï¼é»è®¤ä¸ºå¼å¯\nhash-max-zipmap-entries 64 hash-max-zipmap-value 512        æå®å¨è¶è¿ä¸å®çæ°éæèæå¤§çåç´ è¶è¿æä¸ä¸´çå¼æ¶ï¼éç¨ä¸ç§ç¹æ®çåå¸ç®æ³\nactiverehashing yes                                         æå®æ¯å¦æ¿æ´»éç½®åå¸ï¼é»è®¤ä¸ºå¼å¯ï¼åé¢å¨ä»ç» Redis çåå¸ç®æ³æ¶å·ä½ä»ç»ï¼\ninclude /path/to/local.conf                                 æå®åå«å¶å®çéç½®æä»¶ï¼å¯ä»¥å¨åä¸ä¸»æºä¸å¤ä¸ª Redis\n                                                            å®ä¾ä¹é´ä½¿ç¨åä¸ä»½éç½®æä»¶ï¼èåæ¶åä¸ªå®ä¾åæ¥æèªå·±çç¹å®éç½®æä»¶\n\n\n# ååæµè¯\n\n> åèå®æ¹ææ¡£ï¼How fast is Redis?\n\nRedis èªå¸¦äºä¸ä¸ªæ§è½æµè¯å·¥å·ï¼redis-benchmark\n\nï¼1ï¼åºæ¬æµè¯\n\nredis-benchmark -q -n 100000\n\n\n * -q è¡¨ç¤ºéé»ï¼quietï¼æ§è¡\n * -n 100000 è¯·æ± 10 ä¸æ¬¡\n\nï¼2ï¼æµè¯æå®è¯»åæä»¤\n\n$ redis-benchmark -t set,lpush -n 100000 -q\nSET: 74239.05 requests per second\nLPUSH: 79239.30 requests per second\n\n\nï¼3ï¼æµè¯ pipeline æ¨¡å¼ä¸æå®è¯»åæä»¤\n\nredis-benchmark -n 1000000 -t set,get -P 16 -q\nSET: 403063.28 requests per second\nGET: 508388.41 requests per second\n\n\n\n# ä¸ãRedis éç¾¤ä½¿ç¨åéç½®\n\nRedis 3.0 åæ¯æéç¾¤æ¨¡å¼ã\n\n\n# éç¾¤è§å\n\nRedis éç¾¤ä¸è¬ç± å¤ä¸ªèç¹ ç»æï¼èç¹æ°éè³å°ä¸º 6 ä¸ªï¼æè½ä¿è¯ç»æ å®æ´é«å¯ç¨ çéç¾¤ã\n\n\n\nçæ³æåµå½ç¶æ¯ææèç¹åèªå¨ä¸åçæºå¨ä¸ï¼é¦åäºèµæºï¼æ¬äººå¨é¨ç½² Redis éç¾¤æ¶ï¼åªå¾å° 3 å°æå¡å¨ãæä»¥ï¼æè®¡åæ¯å°æå¡å¨é¨ç½² 2 ä¸ª Redis èç¹ã\n\nãç¤ºä¾ãæç®é«å¯ç¨ Redis éç¾¤è§å\n\næºå¨éç½®ï¼16G åå­ + 8 æ ¸ CPU + 1T ç£ç\n\nRedis è¿ç¨åé 10 G åå­ãä¸è¬çº¿ä¸çäº§ç¯å¢ï¼Redis çåå­å°½éä¸è¦è¶è¿ 10gï¼è¶è¿ 10g å¯è½ä¼æé®é¢ã\n\néç¾¤ææï¼ä¸ä¸»ä¸ä»ï¼ä¸å¨åµï¼æ¯ä¸ªå¨åµçå¬ææä¸»èç¹ã\n\nä¼°ç®æ§è½ï¼\n\n * å®¹éï¼ä¸ä¸»ï¼å ç¨ 30 G åå­ï¼æä»¥æå¤§å­å¨å®¹éä¸º 30 Gãåè®¾æ¯æ¡æ°æ®è®°å½å¹³å å¤§å°ä¸º 10 Kï¼åæå¤§è½å­å¨ 300 ä¸æ¡æ°æ®ã\n * ååéï¼åæºä¸è¬ TPS/QPS ä¸º äºä¸å°å«ä¸å·¦å³ãåè®¾ä¸ºäºä¸ï¼é£ä¹ä¸ä¸»ä¸ä»æ¶æçè®ºä¸è½è¾¾å° TPS 15 ä¸ï¼QPS 30 ä¸ã\n\n\n# é¨ç½²éç¾¤\n\n> Redis éç¾¤èç¹çå®è£ä¸åèç¹æå¡ç¸åï¼å·®å¼ä»å¨äºé¨ç½²æ¹å¼ã\n> \n> æ³¨æï¼ä¸ºäºæ¼ç¤ºæ¹ä¾¿ï¼æ¬ç¤ºä¾å°ææ Redis éç¾¤èç¹é½é¨ç½²å¨ä¸å°æºå¨ä¸ï¼å®éçäº§ç¯å¢ä¸­ï¼åºæ¬é½ä¼å°èç¹é¨ç½²å¨ä¸åæºå¨ä¸ãè¦æ±æ´é«çï¼å¯è½è¿è¦èèå¤æºæ¿é¨ç½²ã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼Redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ Redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº Redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º Redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/7001\nsudo mkdir -p /usr/local/redis/conf/7002\nsudo mkdir -p /usr/local/redis/conf/7003\nsudo mkdir -p /usr/local/redis/conf/7004\nsudo mkdir -p /usr/local/redis/conf/7005\nsudo mkdir -p /usr/local/redis/conf/7006\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\n# ç«¯å£å·\nport 7001\n# ç»å®çä¸»æºç«¯å£ï¼0.0.0.0 è¡¨ç¤ºåè®¸è¿ç¨è®¿é®ï¼\nbind 0.0.0.0\n# ä»¥å®æ¤è¿ç¨æ¹å¼å¯å¨\ndaemonize yes\n\n# å¼å¯éç¾¤æ¨¡å¼\ncluster-enabled yes\n# éç¾¤çéç½®ï¼éç½®æä»¶é¦æ¬¡å¯å¨èªå¨çæ\ncluster-config-file /usr/local/redis/conf/7001/7001.conf\n# è¯·æ±è¶æ¶æ¶é´ï¼è®¾ç½® 10 ç§\ncluster-node-timeout 10000\n\n# å¼å¯ AOF æä¹å\nappendonly yes\n# æ°æ®å­æ¾ç®å½\ndir /usr/local/redis/conf/7001\n# è¿ç¨æä»¶\npidfile /usr/local/redis/conf/7001/7001.pid\n# æ¥å¿æä»¶\nlogfile /usr/local/redis/conf/7001/7001.log\n\n\nï¼3ï¼æ¹éå¯å¨ Redis èç¹\n\nRedis ç utils/create-cluster ç®å½ä¸èªå¸¦äºä¸ä¸ªåä¸º create-cluster çèæ¬å·¥å·ï¼å¯ä»¥å©ç¨å®æ¥æ°å»ºãå¯å¨ãåæ­¢ãéå¯ Redis èç¹ã\n\nèæ¬ä¸­æå ä¸ªå³é®åæ°ï¼\n\n * PORT=30000 - åå§ç«¯å£å·\n * TIMEOUT=2000 - è¶æ¶æ¶é´\n * NODES=6 - èç¹æ°\n * REPLICAS=1 - å¤ä»½æ°\n\nèæ¬ä¸­çæ¯ä¸ªå½ä»¤é¡¹ä¼æ ¹æ®åå§ç«¯å£å·ï¼ä»¥åè®¾ç½®çèç¹æ°ï¼éåçå»æ§è¡æä½ã\n\nç±äºåé¢çè§åä¸­ï¼èç¹ç«¯å£æ¯ä» 7001 ~ 7006ï¼æä»¥éè¦å° PORT åéè®¾ä¸º 7000ã\n\nèæ¬ä¸­å¯å¨æ¯ä¸ª Redis èç¹æ¯éè¿æå®å½ä»¤è¡åæ°æ¥éç½®å±æ§ãæä»¥ï¼æä»¬éè¦æ¹ä¸ä¸ï¼\n\nPORT=7000\nTIMEOUT=2000\nNODES=6\nENDPORT=$((PORT+NODES))\n\n# ...\n\nif [ "$1" == "start" ]\nthen\n    while [ $((PORT < ENDPORT)) != "0" ]; do\n        PORT=$((PORT+1))\n        echo "Starting $PORT"\n        /usr/local/redis/src/redis-server /usr/local/redis/conf/${PORT}/redis.conf\n    done\n    exit 0\nfi\n\n\nå¥½äºï¼å¨æ¯å°æå¡å¨ä¸ï¼é½æ§è¡ ./create-cluster start æ¥å¯å¨èç¹ã\n\nç¶åï¼éè¿ ps å½ä»¤æ¥ç¡®è®¤ Redis è¿ç¨æ¯å¦å·²ç»å·¥ä½ï¼\n\n# root @ dbClusterDev01 in /usr/local/redis/conf [11:07:55]\n$ ps -ef | grep redis\nroot      4604     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7001 [cluster]\nroot      4609     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7002 [cluster]\nroot      4614     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7003 [cluster]\nroot      4619     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7004 [cluster]\nroot      4624     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7005 [cluster]\nroot      4629     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7006 [cluster]\n\n\nï¼4ï¼å¯å¨éç¾¤\n\néè¿ redis-cli --cluster create å½ä»¤å¯ä»¥èªå¨éç½®éç¾¤ï¼å¦ä¸ï¼\n\n./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.2:7003 127.0.0.2:7004 127.0.0.3:7005 127.0.0.3:7006 --cluster-replicas 1\n\n\nredis-cluster ä¼æ ¹æ®è®¾ç½®çèç¹æ°åå¯æ¬æ°èªå¨åçï¼åé Hash èææ§½ slotï¼ï¼å¦ææ»¡æï¼è¾å¥ yes ï¼ç´æ¥å¼å§åçã\n\n>>> Performing hash slots allocation on 6 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nAdding replica 127.0.0.2:7004 to 127.0.0.1:7001\nAdding replica 127.0.0.3:7006 to 127.0.0.2:7003\nAdding replica 127.0.0.1:7002 to 127.0.0.3:7005\nM: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\nS: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\nM: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.2:7003\n   slots:[5461-10922] (5462 slots) master\nS: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.2:7004\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\nM: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.3:7005\n   slots:[10923-16383] (5461 slots) master\nS: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.3:7006\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\nCan I set the above configuration? (type \'yes\' to accept): yes\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n....\n>>> Performing Cluster Check (using node 127.0.0.1:7001)\nM: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.1:7006\n   slots: (0 slots) slave\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\nM: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.1:7003\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nM: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.1:7005\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nS: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.1:7004\n   slots: (0 slots) slave\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\nS: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   slots: (0 slots) slave\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n\n\nï¼5ï¼æ¥å¸¸ç»´æ¤æä½\n\n * å³é­éç¾¤ - ./create-cluster stop\n * æ£æ¥éç¾¤æ¯å¦å¥åº·ï¼æå®ä»»æèç¹å³å¯ï¼ï¼./redis-cli --cluster check <ip:port>\n * å°è¯ä¿®å¤éç¾¤èç¹ï¼./redis-cli --cluster fix <ip:port>\n\n\n# é¨ç½²å¨åµ\n\nredis-cluster å®ç°äº Redis çåçãå¤å¶ã\n\nä½ redis-cluster æ²¡æè§£å³æéè½¬ç§»é®é¢ï¼ä¸æ¦ä»»æåçç Master èç¹å®æºãç½ç»ä¸éï¼å°±ä¼å¯¼è´ redis-cluster çéç¾¤ä¸è½å·¥ä½ãä¸ºäºè§£å³é«å¯ç¨çé®é¢ï¼Redis æä¾äº Redis å¨åµæ¥çæ§ Redis èç¹ç¶æï¼å¹¶ä¸ä¼å¨ Master å®æºæ¶ï¼åèµ·éä¸¾ï¼å°è¿ä¸ª Master çä¸ä¸ª Slave èç¹éä¸¾ä¸º Masterã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼Redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ Redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº Redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º Redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/27001\nsudo mkdir -p /usr/local/redis/conf/27002\nsudo mkdir -p /usr/local/redis/conf/27003\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\nport 27001\ndaemonize yes\nsentinel monitor redis-master 172.22.6.3 7001 2\nsentinel down-after-milliseconds redis-master 5000\nsentinel failover-timeout redis-master 900000\nsentinel parallel-syncs redis-master 1\n#sentinel auth-pass redis-master 123456\nlogfile /usr/local/redis/conf/27001/27001.log\n\n\nï¼3ï¼æ¹éå¯å¨å¨åµèç¹\n\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27001/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27002/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27003/sentinel.conf\n\n\n\n# æ©å®¹\n\nï¼1ï¼æ¥çä¿¡æ¯\n\nè¿å¥ä»»æèç¹\n\n./redis-cli -h 172.22.6.3 -p 7001\n\n\ncluster info æ¥çéç¾¤èç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594528179000 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594528179000 1 connected 0-5460\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594528178000 4 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594528179852 5 connected\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594528178000 2 connected 5461-10922\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594528178000 3 connected 10923-16383\n\n\ncluster info æ¥çéç¾¤ä¿¡æ¯\n\n172.22.6.3:7001> cluster info\ncluster_state:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:6\ncluster_size:3\ncluster_current_epoch:6\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:3406\ncluster_stats_messages_pong_sent:3569\ncluster_stats_messages_publish_sent:5035\ncluster_stats_messages_sent:12010\ncluster_stats_messages_ping_received:3564\ncluster_stats_messages_pong_received:3406\ncluster_stats_messages_meet_received:5\ncluster_stats_messages_publish_received:5033\ncluster_stats_messages_received:12008\n\n\nï¼2ï¼æ·»å èç¹å°éç¾¤\n\nå°å·²å¯å¨çèç¹å®ä¾æ·»å å°éç¾¤ä¸­\n\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7008\n\n\næ·»å ä¸»èç¹\n\næ·»å ä¸ç»ä¸»èç¹\n\n./redis-cli --cluster add-node 172.22.6.3:7007 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7008 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7009 172.22.6.3:7001\n\n\næ¥çèç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529342575 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529340000 1 connected 0-5460\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529342000 0 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529341573 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529343577 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529342000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529341000 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529340000 4 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529340000 7 connected\n\n\nå¯ä»¥åç°ï¼æ°å å¥çä¸ä¸ªä¸»èç¹ï¼è¿æ²¡æåéåå¸æ§½ï¼æä»¥ï¼ææ¶è¿æ æ³è®¿é®ã\n\næ·»å ä»èç¹\n\n--slaveï¼è®¾ç½®è¯¥åæ°ï¼åæ°èç¹ä»¥ slave çè§è²å å¥éç¾¤\n--master-idï¼è¿ä¸ªåæ°éè¦è®¾ç½®äº--slave æè½çæï¼--master-id ç¨æ¥æå®æ°èç¹ç master èç¹ãå¦æä¸è®¾ç½®è¯¥åæ°ï¼åä¼éæºä¸ºèç¹éæ© master èç¹ã\n\nè¯­æ³\n\nredis-cli --cluster add-node  æ°èç¹IPå°åï¼ç«¯å£    å­å¨èç¹IPï¼ç«¯å£ --cluster-slave ï¼ä»èç¹ï¼ --cluster-master-id ï¼masterèç¹çIDï¼\nredis-cli --cluster add-node   10.42.141.119:6379  10.42.166.105:6379  --cluster-slave   --cluster-master-id  dfa238fff8a7a49230cff7eb74f573f5645c8ec5\n\n\nç¤ºä¾\n\n./redis-cli --cluster add-node 172.22.6.3:7010 172.22.6.3:7007 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7011 172.22.6.3:7008 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7012 172.22.6.3:7009 --cluster-slave\n\n\næ¥çç¶æ\n\n172.22.6.3:7001> cluster nodes\nef5c1b9ce4cc795dc12b2c1e8736a572647b4c3e 172.22.6.3:7011@17011 slave 79d4fffc2cec210556c3b4c44e63ab506e87eda3 0 1594529492043 7 connected\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529491943 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529488000 1 connected 0-5460\n5140d1129ed850df59c51cf818c4eb74545d9959 172.22.6.3:7010@17010 slave e5ba78fe629115977a74fbbe1478caf8868d6d55 0 1594529488000 0 connected\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529488000 8 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529490000 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529489939 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529491000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529490942 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529491000 4 connected\n02e9f57b5b45c350dc57acf1c8efa8db136db7b7 172.22.6.3:7012@17012 master - 0 1594529489000 0 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529489000 7 connected\n\n\nåéåå¸æ§½\n\næ§è¡ ./redis-cli --cluster rebalance 172.22.6.3:7001 --cluster-threshold 1 --cluster-use-empty-masters\n\nåæ°è¯´æï¼\n\nrebalanceï¼è¡¨æè®© Redis èªå¨æ ¹æ®èç¹æ°è¿è¡åè¡¡åå¸æ§½åéã\n\n--cluster-use-empty-mastersï¼è¡¨æ\n\n\n\næ§è¡ç»æåï¼æ¥çç¶æï¼\n\n\n\n\n# åãRedis å½ä»¤\n\n\n# éç¨å½ä»¤\n\n> å½ä»¤è¯¦ç»ç¨æ³ï¼è¯·åè Redis å½ä»¤å®æ¹ææ¡£\n> \n> æ¬è¿ä¸¤å¼  cheat sheet å¾ï¼ååï¼https://www.cheatography.com/tasjaevan/cheat-sheets/redis/\n\n\n\n\n\n\n# éç¾¤å½ä»¤\n\n * éç¾¤\n   * cluster info - æå°éç¾¤çä¿¡æ¯\n   * cluster nodes - ååºéç¾¤å½åå·²ç¥çææèç¹ï¼ nodeï¼ï¼ä»¥åè¿äºèç¹çç¸å³ä¿¡æ¯ã\n * èç¹\n   * cluster meet <ip> <port> - å° ip å port ææå®çèç¹æ·»å å°éç¾¤å½ä¸­ï¼è®©å®æä¸ºéç¾¤çä¸ä»½å­ã\n   * cluster forget <node_id> - ä»éç¾¤ä¸­ç§»é¤ node_id æå®çèç¹ã\n   * cluster replicate <node_id> - å°å½åèç¹è®¾ç½®ä¸º node_id æå®çèç¹çä»èç¹ã\n   * cluster saveconfig - å°èç¹çéç½®æä»¶ä¿å­å°ç¡¬çéé¢ã\n * æ§½(slot)\n   * cluster addslots <slot> [slot ...] - å°ä¸ä¸ªæå¤ä¸ªæ§½ï¼ slotï¼ææ´¾ï¼ assignï¼ç»å½åèç¹ã\n   * cluster delslots <slot> [slot ...] - ç§»é¤ä¸ä¸ªæå¤ä¸ªæ§½å¯¹å½åèç¹çææ´¾ã\n   * cluster flushslots - ç§»é¤ææ´¾ç»å½åèç¹çæææ§½ï¼è®©å½åèç¹åæä¸ä¸ªæ²¡æææ´¾ä»»ä½æ§½çèç¹ã\n   * cluster setslot <slot> node <node_id> - å°æ§½ slot ææ´¾ç» node_id æå®çèç¹ï¼å¦ææ§½å·²ç»ææ´¾ç»å¦ä¸ä¸ªèç¹ï¼é£ä¹åè®©å¦ä¸ä¸ªèç¹å é¤è¯¥æ§½>ï¼ç¶ååè¿è¡ææ´¾ã\n   * cluster setslot <slot> migrating <node_id> - å°æ¬èç¹çæ§½ slot è¿ç§»å° node_id æå®çèç¹ä¸­ã\n   * cluster setslot <slot> importing <node_id> - ä» node_id æå®çèç¹ä¸­å¯¼å¥æ§½ slot å°æ¬èç¹ã\n   * cluster setslot <slot> stable - åæ¶å¯¹æ§½ slot çå¯¼å¥ï¼ importï¼æèè¿ç§»ï¼ migrateï¼ã\n * é®\n   * cluster keyslot <key> - è®¡ç®é® key åºè¯¥è¢«æ¾ç½®å¨åªä¸ªæ§½ä¸ã\n   * cluster countkeysinslot <slot> - è¿åæ§½ slot ç®ååå«çé®å¼å¯¹æ°éã\n   * cluster getkeysinslot <slot> <count> - è¿å count ä¸ª slot æ§½ä¸­çé®ã\n\n# éæ°åç\n\næ·»å èç¹ï¼./redis-cli --cluster add-node 192.168.1.136:7007 192.168.1.136:7001 --cluster-slave\n\nredis-cli --cluster reshard 172.22.6.3 7001\n\n\n# äºãå®¢æ·ç«¯\n\næ¨èä½¿ç¨ RedisDesktopManager\n\n\n# åèèµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * æ·±å¥åæ Redis ç³»å(ä¸) - Redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£',normalizedContent:'# redis è¿ç»´\n\n> redis æ¯ä¸ä¸ªé«æ§è½ç key-value æ°æ®åºã\n> \n> set æä½æ¯ç§é 110000 æ¬¡ï¼get æä½æ¯ç§é 81000 æ¬¡ã\n\n\n# ä¸ãredis å®è£\n\n\n# window ä¸å®è£\n\nä¸è½½å°åï¼https://github.com/msopentech/redis/releasesã\n\nredis æ¯æ 32 ä½å 64 ä½ãè¿ä¸ªéè¦æ ¹æ®ä½ ç³»ç»å¹³å°çå®éæåµéæ©ï¼è¿éæä»¬ä¸è½½ redis-x64-xxx.zipåç¼©åå° c çï¼è§£ååï¼å°æä»¶å¤¹éæ°å½åä¸º redisã\n\næå¼ä¸ä¸ª cmd çªå£ ä½¿ç¨ cd å½ä»¤åæ¢ç®å½å° c:\\redis è¿è¡ redis-server.exe redis.windows.conf ã\n\nå¦ææ³æ¹ä¾¿çè¯ï¼å¯ä»¥æ redis çè·¯å¾å å°ç³»ç»çç¯å¢åééï¼è¿æ ·å°±çå¾åè¾è·¯å¾äºï¼åé¢çé£ä¸ª redis.windows.conf å¯ä»¥çç¥ï¼å¦æçç¥ï¼ä¼å¯ç¨é»è®¤çã\n\nè¿æ¶åå¦å¯ä¸ä¸ª cmd çªå£ï¼åæ¥çä¸è¦å³é­ï¼ä¸ç¶å°±æ æ³è®¿é®æå¡ç«¯äºã\n\nåæ¢å° redis ç®å½ä¸è¿è¡ redis-cli.exe -h 127.0.0.1 -p 6379 ã\n\n\n# linux ä¸å®è£\n\nä¸è½½å°åï¼ http://redis.io/downloadï¼ä¸è½½ææ°ææ¡£çæ¬ã\n\nä¸è½½ãè§£åãç¼è¯ redis\n\nwget http://download.redis.io/releases/redis-5.0.4.tar.gz\ntar xzf redis-5.0.4.tar.gz\ncd redis-5.0.4\nmake\n\n\nä¸ºäºç¼è¯ redis æºç ï¼ä½ éè¦ gcc-c++å tclãå¦æä½ çç³»ç»æ¯ centosï¼å¯ä»¥ç´æ¥æ§è¡å½ä»¤ï¼yum install -y gcc-c++ tcl æ¥å®è£ã\n\nè¿å¥å°è§£ååç src ç®å½ï¼éè¿å¦ä¸å½ä»¤å¯å¨ redis:\n\nsrc/redis-server\n\n\næ¨å¯ä»¥ä½¿ç¨åç½®çå®¢æ·ç«¯ä¸ redis è¿è¡äº¤äº:\n\n$ src/redis-cli\nredis> set foo bar\nok\nredis> get foo\n"bar"\n\n\n\n# ubuntu ä¸å®è£\n\nå¨ ubuntu ç³»ç»å®è£ redis å¯ä»¥ä½¿ç¨ä»¥ä¸å½ä»¤:\n\nsudo apt-get update\nsudo apt-get install redis-server\n\n\n\n# å¼æºå¯å¨\n\n * å¼æºå¯å¨éç½®ï¼echo "/usr/local/bin/redis-server /etc/redis.conf" >> /etc/rc.local\n\n\n# å¼æ¾é²ç«å¢ç«¯å£\n\n * æ·»å è§åï¼iptables -i input -p tcp -m tcp --dport 6379 -j accept\n * ä¿å­è§åï¼service iptables save\n * éå¯ iptablesï¼service iptables restart\n\n\n# redis å®è£èæ¬\n\n> centos7 ç¯å¢å®è£èæ¬ï¼è½¯ä»¶è¿ç»´éç½®èæ¬éå\n\nå®è£è¯´æ\n\n * éç¨ç¼è¯æ¹å¼å®è£ redis, å¹¶å°å¶æ³¨åä¸º systemd æå¡\n * å®è£è·¯å¾ä¸ºï¼/usr/local/redis\n * é»è®¤ä¸è½½å®è£ 5.0.4 çæ¬ï¼ç«¯å£å·ä¸ºï¼6379ï¼å¯ç ä¸ºç©º\n\nä½¿ç¨æ¹æ³\n\n * é»è®¤å®è£ - æ§è¡ä»¥ä¸ä»»æå½ä»¤å³å¯ï¼\n\ncurl -o- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\nwget -qo- https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh | bash\n\n\n * èªå®ä¹å®è£ - ä¸è½½èæ¬å°æ¬å°ï¼å¹¶æç§ä»¥ä¸æ ¼å¼æ§è¡ï¼\n\nsh redis-install.sh [version] [port] [password]\n\n\nåæ°è¯´æï¼\n\n * version - redis çæ¬å·\n * port - redis æå¡ç«¯å£å·\n * password - è®¿é®å¯ç \n\n\n# äºãredis åæºä½¿ç¨åéç½®\n\n\n# å¯å¨ redis\n\nå¯å¨ redis æå¡\n\ncd /usr/local/redis/src\n./redis-server\n\n\nå¯å¨ redis å®¢æ·ç«¯\n\ncd /usr/local/redis/src\n./redis-cli\n\n\næ¥ç redis æ¯å¦å¯å¨\n\nredis-cli\n\n\nä»¥ä¸å½ä»¤å°æå¼ä»¥ä¸ç»ç«¯ï¼\n\nredis 127.0.0.1:6379>\n\n\n127.0.0.1 æ¯æ¬æº ip ï¼6379 æ¯ redis æå¡ç«¯å£ãç°å¨æä»¬è¾å¥ ping å½ä»¤ã\n\nredis 127.0.0.1:6379> ping\npong\n\n\nä»¥ä¸è¯´ææä»¬å·²ç»æåå¯å¨äº redisã\n\n\n# redis å¸¸è§éç½®\n\n> redis é»è®¤çéç½®æä»¶æ¯æ ¹ç®å½ä¸ç redis.conf æä»¶ã\n> \n> å¦æéè¦æå®ç¹å®æä»¶ä½ä¸ºéç½®æä»¶ï¼éè¦ä½¿ç¨å½ä»¤ï¼ ./redis-server -c xxx.conf\n> \n> æ¯æ¬¡ä¿®æ¹éç½®åï¼éè¦éå¯æè½çæã\n> \n> redis å®æ¹é»è®¤éç½®ï¼\n> \n>  * èªæè¿°ææ¡£ redis.conf for redis 2.8\n>  * èªæè¿°ææ¡£ redis.conf for redis 2.6.\n>  * èªæè¿°ææ¡£ redis.conf for redis 2.4.\n> \n> èª redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ãèª redis2.6 èµ·å°±å¯ä»¥ç´æ¥éè¿å½ä»¤è¡ä¼ é redis éç½®åæ°ãè¿ç§æ¹æ³å¯ä»¥ç¨äºæµè¯ã\n\n\n# è®¾ä¸ºå®æ¤è¿ç¨\n\nredis é»è®¤ä»¥éå®æ¤è¿ç¨æ¹å¼å¯å¨ï¼èéå¸¸æä»¬ä¼å° redis è®¾ä¸ºå®æ¤è¿ç¨å¯å¨æ¹å¼ï¼éç½®ï¼daemonize yes\n\n# è¿ç¨è®¿é®\n\nredis é»è®¤ç»å® 127.0.0.1ï¼è¿æ ·å°±åªè½æ¬æºæè½è®¿é®ï¼è¥è¦ redis åè®¸è¿ç¨è®¿é®ï¼éè¦éç½®ï¼bind 0.0.0.0\n\n# è®¾ç½®å¯ç \n\nredis é»è®¤è®¿é®ä¸éè¦å¯ç ï¼å¦æéè¦è®¾ç½®å¯ç ï¼éè¦å¦ä¸éç½®ï¼\n\n * protected-mode yes\n * requirepass <å¯ç >\n\n# éç½®åæ°è¡¨\n\néç½®é¡¹                                                         è¯´æ\ndaemonize no                                                redis é»è®¤ä¸æ¯ä»¥å®æ¤è¿ç¨çæ¹å¼è¿è¡ï¼å¯ä»¥éè¿è¯¥éç½®é¡¹ä¿®æ¹ï¼ä½¿ç¨ yes å¯ç¨å®æ¤è¿ç¨ï¼windows\n                                                            ä¸æ¯æå®æ¤çº¿ç¨çéç½®ä¸º no ï¼\npidfile /var/run/redis.pid                                  å½ redis ä»¥å®æ¤è¿ç¨æ¹å¼è¿è¡æ¶ï¼redis é»è®¤ä¼æ pid åå¥ /var/run/redis.pid\n                                                            æä»¶ï¼å¯ä»¥éè¿ pidfile æå®\nport 6379                                                   æå® redis çå¬ç«¯å£ï¼é»è®¤ç«¯å£ä¸º 6379ï¼ä½èå¨èªå·±çä¸ç¯åæä¸­è§£éäºä¸ºä»ä¹éç¨ 6379 ä½ä¸ºé»è®¤ç«¯å£ï¼å ä¸º\n                                                            6379 å¨ææºæé®ä¸ merz å¯¹åºçå·ç ï¼è merz åèªæå¤§å©æ­å¥³ alessia merz çåå­\nbind 127.0.0.1                                              ç»å®çä¸»æºå°å\ntimeout 300                                                 å½å®¢æ·ç«¯é²ç½®å¤é¿æ¶é´åå³é­è¿æ¥ï¼å¦ææå®ä¸º 0ï¼è¡¨ç¤ºå³é­è¯¥åè½\nloglevel notice                                             æå®æ¥å¿è®°å½çº§å«ï¼redis æ»å±æ¯æåä¸ªçº§å«ï¼debugãverboseãnoticeãwarningï¼é»è®¤ä¸º\n                                                            notice\nlogfile stdout                                              æ¥å¿è®°å½æ¹å¼ï¼é»è®¤ä¸ºæ åè¾åºï¼å¦æéç½® redis\n                                                            ä¸ºå®æ¤è¿ç¨æ¹å¼è¿è¡ï¼èè¿éåéç½®ä¸ºæ¥å¿è®°å½æ¹å¼ä¸ºæ åè¾åºï¼åæ¥å¿å°ä¼åéç» /dev/null\ndatabases 16                                                è®¾ç½®æ°æ®åºçæ°éï¼é»è®¤æ°æ®åºä¸º 0ï¼å¯ä»¥ä½¿ç¨ select å½ä»¤å¨è¿æ¥ä¸æå®æ°æ®åº id\nsave <seconds> <changes> redis é»è®¤éç½®æä»¶ä¸­æä¾äºä¸ä¸ªæ¡ä»¶ï¼save 900      æå®å¨å¤é¿æ¶é´åï¼æå¤å°æ¬¡æ´æ°æä½ï¼å°±å°æ°æ®åæ­¥å°æ°æ®æä»¶ï¼å¯ä»¥å¤ä¸ªæ¡ä»¶éå\n1ãsave 300 10ãsave 60 10000 åå«è¡¨ç¤º 900 ç§ï¼15 åéï¼åæ 1 ä¸ªæ´æ¹ï¼300\nç§ï¼5 åéï¼åæ 10 ä¸ªæ´æ¹ä»¥å 60 ç§åæ 10000 ä¸ªæ´æ¹ã\nrdbcompression yes                                          æå®å­å¨è³æ¬å°æ°æ®åºæ¶æ¯å¦åç¼©æ°æ®ï¼é»è®¤ä¸º yesï¼redis éç¨ lzf åç¼©ï¼å¦æä¸ºäºèç cpu\n                                                            æ¶é´ï¼å¯ä»¥å³é­è¯¥éé¡¹ï¼ä½ä¼å¯¼è´æ°æ®åºæä»¶åçå·¨å¤§\ndbfilename dump.rdb                                         æå®æ¬å°æ°æ®åºæä»¶åï¼é»è®¤å¼ä¸º dump.rdb\ndir ./                                                      æå®æ¬å°æ°æ®åºå­æ¾ç®å½\nslaveof <masterip> <masterport>                             è®¾ç½®å½æ¬æºä¸º slav æå¡æ¶ï¼è®¾ç½® master æå¡ç ip å°ååç«¯å£ï¼å¨ redis å¯å¨æ¶ï¼å®ä¼èªå¨ä»\n                                                            master è¿è¡æ°æ®åæ­¥\nmasterauth <master-password>                                å½ master æå¡è®¾ç½®äºå¯ç ä¿æ¤æ¶ï¼slav æå¡è¿æ¥ master çå¯ç \nrequirepass foobared                                        è®¾ç½® redis è¿æ¥å¯ç ï¼å¦æéç½®äºè¿æ¥å¯ç ï¼å®¢æ·ç«¯å¨è¿æ¥ redis æ¶éè¦éè¿ auth <password>\n                                                            å½ä»¤æä¾å¯ç ï¼é»è®¤å³é­\nmaxclients 128                                              è®¾ç½®åä¸æ¶é´æå¤§å®¢æ·ç«¯è¿æ¥æ°ï¼é»è®¤æ éå¶ï¼redis å¯ä»¥åæ¶æå¼çå®¢æ·ç«¯è¿æ¥æ°ä¸º redis\n                                                            è¿ç¨å¯ä»¥æå¼çæå¤§æä»¶æè¿°ç¬¦æ°ï¼å¦æè®¾ç½® maxclients 0ï¼è¡¨ç¤ºä¸ä½éå¶ãå½å®¢æ·ç«¯è¿æ¥æ°å°è¾¾éå¶æ¶ï¼redis\n                                                            ä¼å³é­æ°çè¿æ¥å¹¶åå®¢æ·ç«¯è¿å max number of clients reached éè¯¯ä¿¡æ¯\nmaxmemory <bytes>                                           æå® redis æå¤§åå­éå¶ï¼redis å¨å¯å¨æ¶ä¼ææ°æ®å è½½å°åå­ä¸­ï¼è¾¾å°æå¤§åå­åï¼redis\n                                                            ä¼åå°è¯æ¸é¤å·²å°ææå³å°å°æç keyï¼å½æ­¤æ¹æ³å¤ç\n                                                            åï¼ä»ç¶å°è¾¾æå¤§åå­è®¾ç½®ï¼å°æ æ³åè¿è¡åå¥æä½ï¼ä½ä»ç¶å¯ä»¥è¿è¡è¯»åæä½ãredis æ°ç vm æºå¶ï¼ä¼æ key\n                                                            å­æ¾åå­ï¼value ä¼å­æ¾å¨ swap åº\nappendonly no                                               æå®æ¯å¦å¨æ¯æ¬¡æ´æ°æä½åè¿è¡æ¥å¿è®°å½ï¼redis\n                                                            å¨é»è®¤æåµä¸æ¯å¼æ­¥çææ°æ®åå¥ç£çï¼å¦æä¸å¼å¯ï¼å¯è½ä¼å¨æ­çµæ¶å¯¼è´ä¸æ®µæ¶é´åçæ°æ®ä¸¢å¤±ãå ä¸º redis\n                                                            æ¬èº«åæ­¥æ°æ®æä»¶æ¯æä¸é¢ save æ¡ä»¶æ¥åæ­¥çï¼æä»¥æçæ°æ®ä¼å¨ä¸æ®µæ¶é´ååªå­å¨äºåå­ä¸­ãé»è®¤ä¸º no\nappendfilename appendonly.aof                               æå®æ´æ°æ¥å¿æä»¶åï¼é»è®¤ä¸º appendonly.aof\nappendfsync everysec                                        æå®æ´æ°æ¥å¿æ¡ä»¶ï¼å±æ 3\n                                                            ä¸ªå¯éå¼ï¼noï¼è¡¨ç¤ºç­æä½ç³»ç»è¿è¡æ°æ®ç¼å­åæ­¥å°ç£çï¼å¿«ï¼alwaysï¼è¡¨ç¤ºæ¯æ¬¡æ´æ°æä½åæå¨è°ç¨ fsync()\n                                                            å°æ°æ®åå°ç£çï¼æ¢ï¼å®å¨ï¼everysecï¼è¡¨ç¤ºæ¯ç§åæ­¥ä¸æ¬¡ï¼æä¸­ï¼é»è®¤å¼ï¼\nvm-enabled no                                               æå®æ¯å¦å¯ç¨èæåå­æºå¶ï¼é»è®¤å¼ä¸º noï¼ç®åçä»ç»ä¸ä¸ï¼vm æºå¶å°æ°æ®åé¡µå­æ¾ï¼ç± redis\n                                                            å°è®¿é®éè¾å°çé¡µå³å·æ°æ® swap å°ç£çä¸ï¼è®¿é®å¤çé¡µé¢ç±ç£çèªå¨æ¢åºå°åå­ä¸­ï¼å¨åé¢çæç« æä¼ä»ç»åæ redis\n                                                            ç vm æºå¶ï¼\nvm-swap-file /tmp/redis.swap                                èæåå­æä»¶è·¯å¾ï¼é»è®¤å¼ä¸º /tmp/redis.swapï¼ä¸å¯å¤ä¸ª redis å®ä¾å±äº«\nvm-max-memory 0                                             å°ææå¤§äº vm-max-memory çæ°æ®å­å¥èæåå­ï¼æ è®º vm-max-memory\n                                                            è®¾ç½®å¤å°ï¼ææç´¢å¼æ°æ®é½æ¯åå­å­å¨ç(redis çç´¢å¼æ°æ® å°±æ¯ keys)ï¼ä¹å°±æ¯è¯´ï¼å½ vm-max-memory\n                                                            è®¾ç½®ä¸º 0 çæ¶åï¼å¶å®æ¯ææ value é½å­å¨äºç£çãé»è®¤å¼ä¸º 0\nvm-page-size 32                                             redis swap æä»¶åæäºå¾å¤ç pageï¼ä¸ä¸ªå¯¹è±¡å¯ä»¥ä¿å­å¨å¤ä¸ª page ä¸é¢ï¼ä½ä¸ä¸ª page\n                                                            ä¸ä¸è½è¢«å¤ä¸ªå¯¹è±¡å±äº«ï¼vm-page-size æ¯è¦æ ¹æ®å­å¨ç æ°æ®å¤§å°æ¥è®¾å®çï¼ä½èå»ºè®®å¦æå­å¨å¾å¤å°å¯¹è±¡ï¼page\n                                                            å¤§å°æå¥½è®¾ç½®ä¸º 32 æè 64bytesï¼å¦æå­å¨å¾å¤§å¤§å¯¹è±¡ï¼åå¯ä»¥ä½¿ç¨æ´å¤§ç pageï¼å¦æä¸ç¡®å®ï¼å°±ä½¿ç¨é»è®¤å¼\nvm-pages 134217728                                          è®¾ç½® swap æä»¶ä¸­ç page æ°éï¼ç±äºé¡µè¡¨ï¼ä¸ç§è¡¨ç¤ºé¡µé¢ç©ºé²æä½¿ç¨ç\n                                                            bitmapï¼æ¯å¨æ¾å¨åå­ä¸­çï¼ï¼å¨ç£çä¸æ¯ 8 ä¸ª pages å°æ¶è 1byte çåå­ã\nvm-max-threads 4                                            è®¾ç½®è®¿é® swap æä»¶ççº¿ç¨æ°,æå¥½ä¸è¦è¶è¿æºå¨çæ ¸æ°,å¦æè®¾ç½®ä¸º 0,é£ä¹ææå¯¹ swap\n                                                            æä»¶çæä½é½æ¯ä¸²è¡çï¼å¯è½ä¼é ææ¯è¾é¿æ¶é´çå»¶è¿ãé»è®¤å¼ä¸º 4\nglueoutputbuf yes                                           è®¾ç½®å¨åå®¢æ·ç«¯åºç­æ¶ï¼æ¯å¦æè¾å°çååå¹¶ä¸ºä¸ä¸ªååéï¼é»è®¤ä¸ºå¼å¯\nhash-max-zipmap-entries 64 hash-max-zipmap-value 512        æå®å¨è¶è¿ä¸å®çæ°éæèæå¤§çåç´ è¶è¿æä¸ä¸´çå¼æ¶ï¼éç¨ä¸ç§ç¹æ®çåå¸ç®æ³\nactiverehashing yes                                         æå®æ¯å¦æ¿æ´»éç½®åå¸ï¼é»è®¤ä¸ºå¼å¯ï¼åé¢å¨ä»ç» redis çåå¸ç®æ³æ¶å·ä½ä»ç»ï¼\ninclude /path/to/local.conf                                 æå®åå«å¶å®çéç½®æä»¶ï¼å¯ä»¥å¨åä¸ä¸»æºä¸å¤ä¸ª redis\n                                                            å®ä¾ä¹é´ä½¿ç¨åä¸ä»½éç½®æä»¶ï¼èåæ¶åä¸ªå®ä¾åæ¥æèªå·±çç¹å®éç½®æä»¶\n\n\n# ååæµè¯\n\n> åèå®æ¹ææ¡£ï¼how fast is redis?\n\nredis èªå¸¦äºä¸ä¸ªæ§è½æµè¯å·¥å·ï¼redis-benchmark\n\nï¼1ï¼åºæ¬æµè¯\n\nredis-benchmark -q -n 100000\n\n\n * -q è¡¨ç¤ºéé»ï¼quietï¼æ§è¡\n * -n 100000 è¯·æ± 10 ä¸æ¬¡\n\nï¼2ï¼æµè¯æå®è¯»åæä»¤\n\n$ redis-benchmark -t set,lpush -n 100000 -q\nset: 74239.05 requests per second\nlpush: 79239.30 requests per second\n\n\nï¼3ï¼æµè¯ pipeline æ¨¡å¼ä¸æå®è¯»åæä»¤\n\nredis-benchmark -n 1000000 -t set,get -p 16 -q\nset: 403063.28 requests per second\nget: 508388.41 requests per second\n\n\n\n# ä¸ãredis éç¾¤ä½¿ç¨åéç½®\n\nredis 3.0 åæ¯æéç¾¤æ¨¡å¼ã\n\n\n# éç¾¤è§å\n\nredis éç¾¤ä¸è¬ç± å¤ä¸ªèç¹ ç»æï¼èç¹æ°éè³å°ä¸º 6 ä¸ªï¼æè½ä¿è¯ç»æ å®æ´é«å¯ç¨ çéç¾¤ã\n\n\n\nçæ³æåµå½ç¶æ¯ææèç¹åèªå¨ä¸åçæºå¨ä¸ï¼é¦åäºèµæºï¼æ¬äººå¨é¨ç½² redis éç¾¤æ¶ï¼åªå¾å° 3 å°æå¡å¨ãæä»¥ï¼æè®¡åæ¯å°æå¡å¨é¨ç½² 2 ä¸ª redis èç¹ã\n\nãç¤ºä¾ãæç®é«å¯ç¨ redis éç¾¤è§å\n\næºå¨éç½®ï¼16g åå­ + 8 æ ¸ cpu + 1t ç£ç\n\nredis è¿ç¨åé 10 g åå­ãä¸è¬çº¿ä¸çäº§ç¯å¢ï¼redis çåå­å°½éä¸è¦è¶è¿ 10gï¼è¶è¿ 10g å¯è½ä¼æé®é¢ã\n\néç¾¤ææï¼ä¸ä¸»ä¸ä»ï¼ä¸å¨åµï¼æ¯ä¸ªå¨åµçå¬ææä¸»èç¹ã\n\nä¼°ç®æ§è½ï¼\n\n * å®¹éï¼ä¸ä¸»ï¼å ç¨ 30 g åå­ï¼æä»¥æå¤§å­å¨å®¹éä¸º 30 gãåè®¾æ¯æ¡æ°æ®è®°å½å¹³å å¤§å°ä¸º 10 kï¼åæå¤§è½å­å¨ 300 ä¸æ¡æ°æ®ã\n * ååéï¼åæºä¸è¬ tps/qps ä¸º äºä¸å°å«ä¸å·¦å³ãåè®¾ä¸ºäºä¸ï¼é£ä¹ä¸ä¸»ä¸ä»æ¶æçè®ºä¸è½è¾¾å° tps 15 ä¸ï¼qps 30 ä¸ã\n\n\n# é¨ç½²éç¾¤\n\n> redis éç¾¤èç¹çå®è£ä¸åèç¹æå¡ç¸åï¼å·®å¼ä»å¨äºé¨ç½²æ¹å¼ã\n> \n> æ³¨æï¼ä¸ºäºæ¼ç¤ºæ¹ä¾¿ï¼æ¬ç¤ºä¾å°ææ redis éç¾¤èç¹é½é¨ç½²å¨ä¸å°æºå¨ä¸ï¼å®éçäº§ç¯å¢ä¸­ï¼åºæ¬é½ä¼å°èç¹é¨ç½²å¨ä¸åæºå¨ä¸ãè¦æ±æ´é«çï¼å¯è½è¿è¦èèå¤æºæ¿é¨ç½²ã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/7001\nsudo mkdir -p /usr/local/redis/conf/7002\nsudo mkdir -p /usr/local/redis/conf/7003\nsudo mkdir -p /usr/local/redis/conf/7004\nsudo mkdir -p /usr/local/redis/conf/7005\nsudo mkdir -p /usr/local/redis/conf/7006\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\n# ç«¯å£å·\nport 7001\n# ç»å®çä¸»æºç«¯å£ï¼0.0.0.0 è¡¨ç¤ºåè®¸è¿ç¨è®¿é®ï¼\nbind 0.0.0.0\n# ä»¥å®æ¤è¿ç¨æ¹å¼å¯å¨\ndaemonize yes\n\n# å¼å¯éç¾¤æ¨¡å¼\ncluster-enabled yes\n# éç¾¤çéç½®ï¼éç½®æä»¶é¦æ¬¡å¯å¨èªå¨çæ\ncluster-config-file /usr/local/redis/conf/7001/7001.conf\n# è¯·æ±è¶æ¶æ¶é´ï¼è®¾ç½® 10 ç§\ncluster-node-timeout 10000\n\n# å¼å¯ aof æä¹å\nappendonly yes\n# æ°æ®å­æ¾ç®å½\ndir /usr/local/redis/conf/7001\n# è¿ç¨æä»¶\npidfile /usr/local/redis/conf/7001/7001.pid\n# æ¥å¿æä»¶\nlogfile /usr/local/redis/conf/7001/7001.log\n\n\nï¼3ï¼æ¹éå¯å¨ redis èç¹\n\nredis ç utils/create-cluster ç®å½ä¸èªå¸¦äºä¸ä¸ªåä¸º create-cluster çèæ¬å·¥å·ï¼å¯ä»¥å©ç¨å®æ¥æ°å»ºãå¯å¨ãåæ­¢ãéå¯ redis èç¹ã\n\nèæ¬ä¸­æå ä¸ªå³é®åæ°ï¼\n\n * port=30000 - åå§ç«¯å£å·\n * timeout=2000 - è¶æ¶æ¶é´\n * nodes=6 - èç¹æ°\n * replicas=1 - å¤ä»½æ°\n\nèæ¬ä¸­çæ¯ä¸ªå½ä»¤é¡¹ä¼æ ¹æ®åå§ç«¯å£å·ï¼ä»¥åè®¾ç½®çèç¹æ°ï¼éåçå»æ§è¡æä½ã\n\nç±äºåé¢çè§åä¸­ï¼èç¹ç«¯å£æ¯ä» 7001 ~ 7006ï¼æä»¥éè¦å° port åéè®¾ä¸º 7000ã\n\nèæ¬ä¸­å¯å¨æ¯ä¸ª redis èç¹æ¯éè¿æå®å½ä»¤è¡åæ°æ¥éç½®å±æ§ãæä»¥ï¼æä»¬éè¦æ¹ä¸ä¸ï¼\n\nport=7000\ntimeout=2000\nnodes=6\nendport=$((port+nodes))\n\n# ...\n\nif [ "$1" == "start" ]\nthen\n    while [ $((port < endport)) != "0" ]; do\n        port=$((port+1))\n        echo "starting $port"\n        /usr/local/redis/src/redis-server /usr/local/redis/conf/${port}/redis.conf\n    done\n    exit 0\nfi\n\n\nå¥½äºï¼å¨æ¯å°æå¡å¨ä¸ï¼é½æ§è¡ ./create-cluster start æ¥å¯å¨èç¹ã\n\nç¶åï¼éè¿ ps å½ä»¤æ¥ç¡®è®¤ redis è¿ç¨æ¯å¦å·²ç»å·¥ä½ï¼\n\n# root @ dbclusterdev01 in /usr/local/redis/conf [11:07:55]\n$ ps -ef | grep redis\nroot      4604     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7001 [cluster]\nroot      4609     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7002 [cluster]\nroot      4614     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7003 [cluster]\nroot      4619     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7004 [cluster]\nroot      4624     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7005 [cluster]\nroot      4629     1  0 11:07 ?        00:00:00 /opt/redis/src/redis-server 0.0.0.0:7006 [cluster]\n\n\nï¼4ï¼å¯å¨éç¾¤\n\néè¿ redis-cli --cluster create å½ä»¤å¯ä»¥èªå¨éç½®éç¾¤ï¼å¦ä¸ï¼\n\n./redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.2:7003 127.0.0.2:7004 127.0.0.3:7005 127.0.0.3:7006 --cluster-replicas 1\n\n\nredis-cluster ä¼æ ¹æ®è®¾ç½®çèç¹æ°åå¯æ¬æ°èªå¨åçï¼åé hash èææ§½ slotï¼ï¼å¦ææ»¡æï¼è¾å¥ yes ï¼ç´æ¥å¼å§åçã\n\n>>> performing hash slots allocation on 6 nodes...\nmaster[0] -> slots 0 - 5460\nmaster[1] -> slots 5461 - 10922\nmaster[2] -> slots 10923 - 16383\nadding replica 127.0.0.2:7004 to 127.0.0.1:7001\nadding replica 127.0.0.3:7006 to 127.0.0.2:7003\nadding replica 127.0.0.1:7002 to 127.0.0.3:7005\nm: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\ns: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\nm: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.2:7003\n   slots:[5461-10922] (5462 slots) master\ns: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.2:7004\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\nm: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.3:7005\n   slots:[10923-16383] (5461 slots) master\ns: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.3:7006\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\ncan i set the above configuration? (type \'yes\' to accept): yes\n>>> nodes configuration updated\n>>> assign a different config epoch to each node\n>>> sending cluster meet messages to join the cluster\nwaiting for the cluster to join\n....\n>>> performing cluster check (using node 127.0.0.1:7001)\nm: b721235997deb6b9a7a2be690b5b9663db8057c6 127.0.0.1:7001\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\ns: a2869dc153ea4977ca790b76483574a5d56cb40e 127.0.0.1:7006\n   slots: (0 slots) slave\n   replicates 91523c0391a044da6cc9f53bb965aabe89502187\nm: 91523c0391a044da6cc9f53bb965aabe89502187 127.0.0.1:7003\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\nm: 3623fff69b5243ed18c02a2fbb6f53069b0f1505 127.0.0.1:7005\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\ns: 9d899cbe49dead7b8c4f769920cdb75714a441ae 127.0.0.1:7004\n   slots: (0 slots) slave\n   replicates b721235997deb6b9a7a2be690b5b9663db8057c6\ns: bda9b7036df0bbefe601bda4ce45d3787a2e9bd9 127.0.0.1:7002\n   slots: (0 slots) slave\n   replicates 3623fff69b5243ed18c02a2fbb6f53069b0f1505\n[ok] all nodes agree about slots configuration.\n>>> check for open slots...\n>>> check slots coverage...\n[ok] all 16384 slots covered.\n\n\nï¼5ï¼æ¥å¸¸ç»´æ¤æä½\n\n * å³é­éç¾¤ - ./create-cluster stop\n * æ£æ¥éç¾¤æ¯å¦å¥åº·ï¼æå®ä»»æèç¹å³å¯ï¼ï¼./redis-cli --cluster check <ip:port>\n * å°è¯ä¿®å¤éç¾¤èç¹ï¼./redis-cli --cluster fix <ip:port>\n\n\n# é¨ç½²å¨åµ\n\nredis-cluster å®ç°äº redis çåçãå¤å¶ã\n\nä½ redis-cluster æ²¡æè§£å³æéè½¬ç§»é®é¢ï¼ä¸æ¦ä»»æåçç master èç¹å®æºãç½ç»ä¸éï¼å°±ä¼å¯¼è´ redis-cluster çéç¾¤ä¸è½å·¥ä½ãä¸ºäºè§£å³é«å¯ç¨çé®é¢ï¼redis æä¾äº redis å¨åµæ¥çæ§ redis èç¹ç¶æï¼å¹¶ä¸ä¼å¨ master å®æºæ¶ï¼åèµ·éä¸¾ï¼å°è¿ä¸ª master çä¸ä¸ª slave èç¹éä¸¾ä¸º masterã\n\nï¼1ï¼åå»ºèç¹ç®å½\n\næä¸ªäººåå¥½å°è½¯ä»¶æ¾å¨ /opt ç®å½ä¸ï¼å¨æçæºå¨ä¸­ï¼redis é½å®è£å¨ /usr/local/redis ç®å½ä¸ãæä»¥ï¼ä¸é¢çå½ä»¤åéç½®é½åè®¾ redis å®è£ç®å½ä¸º /usr/local/redis ã\n\nç¡®ä¿æºå¨ä¸å·²ç»å®è£äº redis åï¼æ§è¡ä»¥ä¸å½ä»¤ï¼åå»º redis éç¾¤èç¹å®ä¾ç®å½ï¼\n\nsudo mkdir -p /usr/local/redis/conf/27001\nsudo mkdir -p /usr/local/redis/conf/27002\nsudo mkdir -p /usr/local/redis/conf/27003\n\n\nï¼2ï¼éç½®éç¾¤èç¹\n\næ¯ä¸ªå®ä¾ç®å½ä¸ï¼æ°å»º redis.conf éç½®æä»¶ã\n\nå®ä¾éç½®æ¨¡æ¿ä»¥ 7001 èç¹ä¸ºä¾ï¼å¶ä»èç¹ï¼å®å¨æ¿æ¢éç½®ä¸­çç«¯å£å· 7001 å³å¯ï¼ï¼å¦ä¸ï¼\n\nport 27001\ndaemonize yes\nsentinel monitor redis-master 172.22.6.3 7001 2\nsentinel down-after-milliseconds redis-master 5000\nsentinel failover-timeout redis-master 900000\nsentinel parallel-syncs redis-master 1\n#sentinel auth-pass redis-master 123456\nlogfile /usr/local/redis/conf/27001/27001.log\n\n\nï¼3ï¼æ¹éå¯å¨å¨åµèç¹\n\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27001/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27002/sentinel.conf\n/opt/redis/src/redis-sentinel /usr/local/redis/conf/27003/sentinel.conf\n\n\n\n# æ©å®¹\n\nï¼1ï¼æ¥çä¿¡æ¯\n\nè¿å¥ä»»æèç¹\n\n./redis-cli -h 172.22.6.3 -p 7001\n\n\ncluster info æ¥çéç¾¤èç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594528179000 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594528179000 1 connected 0-5460\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594528178000 4 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594528179852 5 connected\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594528178000 2 connected 5461-10922\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594528178000 3 connected 10923-16383\n\n\ncluster info æ¥çéç¾¤ä¿¡æ¯\n\n172.22.6.3:7001> cluster info\ncluster_state:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:6\ncluster_size:3\ncluster_current_epoch:6\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:3406\ncluster_stats_messages_pong_sent:3569\ncluster_stats_messages_publish_sent:5035\ncluster_stats_messages_sent:12010\ncluster_stats_messages_ping_received:3564\ncluster_stats_messages_pong_received:3406\ncluster_stats_messages_meet_received:5\ncluster_stats_messages_publish_received:5033\ncluster_stats_messages_received:12008\n\n\nï¼2ï¼æ·»å èç¹å°éç¾¤\n\nå°å·²å¯å¨çèç¹å®ä¾æ·»å å°éç¾¤ä¸­\n\nredis-cli --cluster add-node 127.0.0.1:7007 127.0.0.1:7008\n\n\næ·»å ä¸»èç¹\n\næ·»å ä¸ç»ä¸»èç¹\n\n./redis-cli --cluster add-node 172.22.6.3:7007 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7008 172.22.6.3:7001\n./redis-cli --cluster add-node 172.22.6.3:7009 172.22.6.3:7001\n\n\næ¥çèç¹ç¶æ\n\n172.22.6.3:7001> cluster nodes\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529342575 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529340000 1 connected 0-5460\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529342000 0 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529341573 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529343577 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529342000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529341000 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529340000 4 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529340000 7 connected\n\n\nå¯ä»¥åç°ï¼æ°å å¥çä¸ä¸ªä¸»èç¹ï¼è¿æ²¡æåéåå¸æ§½ï¼æä»¥ï¼ææ¶è¿æ æ³è®¿é®ã\n\næ·»å ä»èç¹\n\n--slaveï¼è®¾ç½®è¯¥åæ°ï¼åæ°èç¹ä»¥ slave çè§è²å å¥éç¾¤\n--master-idï¼è¿ä¸ªåæ°éè¦è®¾ç½®äº--slave æè½çæï¼--master-id ç¨æ¥æå®æ°èç¹ç master èç¹ãå¦æä¸è®¾ç½®è¯¥åæ°ï¼åä¼éæºä¸ºèç¹éæ© master èç¹ã\n\nè¯­æ³\n\nredis-cli --cluster add-node  æ°èç¹ipå°åï¼ç«¯å£    å­å¨èç¹ipï¼ç«¯å£ --cluster-slave ï¼ä»èç¹ï¼ --cluster-master-id ï¼masterèç¹çidï¼\nredis-cli --cluster add-node   10.42.141.119:6379  10.42.166.105:6379  --cluster-slave   --cluster-master-id  dfa238fff8a7a49230cff7eb74f573f5645c8ec5\n\n\nç¤ºä¾\n\n./redis-cli --cluster add-node 172.22.6.3:7010 172.22.6.3:7007 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7011 172.22.6.3:7008 --cluster-slave\n./redis-cli --cluster add-node 172.22.6.3:7012 172.22.6.3:7009 --cluster-slave\n\n\næ¥çç¶æ\n\n172.22.6.3:7001> cluster nodes\nef5c1b9ce4cc795dc12b2c1e8736a572647b4c3e 172.22.6.3:7011@17011 slave 79d4fffc2cec210556c3b4c44e63ab506e87eda3 0 1594529492043 7 connected\nf158bf70bb2767cac271ce4efcfc14ba0b7ca98b 172.22.6.3:7006@17006 slave e7aa182e756b76ec85b471797db9b66e4b2da725 0 1594529491943 6 connected\nf348e67648460c7a800120d69b4977bf2e4524cb 172.22.6.3:7001@17001 myself,master - 0 1594529488000 1 connected 0-5460\n5140d1129ed850df59c51cf818c4eb74545d9959 172.22.6.3:7010@17010 slave e5ba78fe629115977a74fbbe1478caf8868d6d55 0 1594529488000 0 connected\n55cacf121662833a4a19dbeb4a5df712cfedf77f 172.22.6.3:7009@17009 master - 0 1594529488000 8 connected\nc6c6a68674ae8aac3c6ec792c8af4dc1228c6c31 172.22.6.3:7005@17005 slave f348e67648460c7a800120d69b4977bf2e4524cb 0 1594529490000 5 connected\n4802fafe897160c46392c6e569d6f5e466cca696 172.22.6.3:7003@17003 master - 0 1594529489939 3 connected 10923-16383\ne7aa182e756b76ec85b471797db9b66e4b2da725 172.22.6.3:7002@17002 master - 0 1594529491000 2 connected 5461-10922\ne5ba78fe629115977a74fbbe1478caf8868d6d55 172.22.6.3:7007@17007 master - 0 1594529490942 0 connected\n52601e2d4af0e64b83f4cc6d20e8316d0ac38b99 172.22.6.3:7004@17004 slave 4802fafe897160c46392c6e569d6f5e466cca696 0 1594529491000 4 connected\n02e9f57b5b45c350dc57acf1c8efa8db136db7b7 172.22.6.3:7012@17012 master - 0 1594529489000 0 connected\n79d4fffc2cec210556c3b4c44e63ab506e87eda3 172.22.6.3:7008@17008 master - 0 1594529489000 7 connected\n\n\nåéåå¸æ§½\n\næ§è¡ ./redis-cli --cluster rebalance 172.22.6.3:7001 --cluster-threshold 1 --cluster-use-empty-masters\n\nåæ°è¯´æï¼\n\nrebalanceï¼è¡¨æè®© redis èªå¨æ ¹æ®èç¹æ°è¿è¡åè¡¡åå¸æ§½åéã\n\n--cluster-use-empty-mastersï¼è¡¨æ\n\n\n\næ§è¡ç»æåï¼æ¥çç¶æï¼\n\n\n\n\n# åãredis å½ä»¤\n\n\n# éç¨å½ä»¤\n\n> å½ä»¤è¯¦ç»ç¨æ³ï¼è¯·åè redis å½ä»¤å®æ¹ææ¡£\n> \n> æ¬è¿ä¸¤å¼  cheat sheet å¾ï¼ååï¼https://www.cheatography.com/tasjaevan/cheat-sheets/redis/\n\n\n\n\n\n\n# éç¾¤å½ä»¤\n\n * éç¾¤\n   * cluster info - æå°éç¾¤çä¿¡æ¯\n   * cluster nodes - ååºéç¾¤å½åå·²ç¥çææèç¹ï¼ nodeï¼ï¼ä»¥åè¿äºèç¹çç¸å³ä¿¡æ¯ã\n * èç¹\n   * cluster meet <ip> <port> - å° ip å port ææå®çèç¹æ·»å å°éç¾¤å½ä¸­ï¼è®©å®æä¸ºéç¾¤çä¸ä»½å­ã\n   * cluster forget <node_id> - ä»éç¾¤ä¸­ç§»é¤ node_id æå®çèç¹ã\n   * cluster replicate <node_id> - å°å½åèç¹è®¾ç½®ä¸º node_id æå®çèç¹çä»èç¹ã\n   * cluster saveconfig - å°èç¹çéç½®æä»¶ä¿å­å°ç¡¬çéé¢ã\n * æ§½(slot)\n   * cluster addslots <slot> [slot ...] - å°ä¸ä¸ªæå¤ä¸ªæ§½ï¼ slotï¼ææ´¾ï¼ assignï¼ç»å½åèç¹ã\n   * cluster delslots <slot> [slot ...] - ç§»é¤ä¸ä¸ªæå¤ä¸ªæ§½å¯¹å½åèç¹çææ´¾ã\n   * cluster flushslots - ç§»é¤ææ´¾ç»å½åèç¹çæææ§½ï¼è®©å½åèç¹åæä¸ä¸ªæ²¡æææ´¾ä»»ä½æ§½çèç¹ã\n   * cluster setslot <slot> node <node_id> - å°æ§½ slot ææ´¾ç» node_id æå®çèç¹ï¼å¦ææ§½å·²ç»ææ´¾ç»å¦ä¸ä¸ªèç¹ï¼é£ä¹åè®©å¦ä¸ä¸ªèç¹å é¤è¯¥æ§½>ï¼ç¶ååè¿è¡ææ´¾ã\n   * cluster setslot <slot> migrating <node_id> - å°æ¬èç¹çæ§½ slot è¿ç§»å° node_id æå®çèç¹ä¸­ã\n   * cluster setslot <slot> importing <node_id> - ä» node_id æå®çèç¹ä¸­å¯¼å¥æ§½ slot å°æ¬èç¹ã\n   * cluster setslot <slot> stable - åæ¶å¯¹æ§½ slot çå¯¼å¥ï¼ importï¼æèè¿ç§»ï¼ migrateï¼ã\n * é®\n   * cluster keyslot <key> - è®¡ç®é® key åºè¯¥è¢«æ¾ç½®å¨åªä¸ªæ§½ä¸ã\n   * cluster countkeysinslot <slot> - è¿åæ§½ slot ç®ååå«çé®å¼å¯¹æ°éã\n   * cluster getkeysinslot <slot> <count> - è¿å count ä¸ª slot æ§½ä¸­çé®ã\n\n# éæ°åç\n\næ·»å èç¹ï¼./redis-cli --cluster add-node 192.168.1.136:7007 192.168.1.136:7001 --cluster-slave\n\nredis-cli --cluster reshard 172.22.6.3 7001\n\n\n# äºãå®¢æ·ç«¯\n\næ¨èä½¿ç¨ redisdesktopmanager\n\n\n# åèèµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * æ·±å¥åæ redis ç³»å(ä¸) - redis éç¾¤æ¨¡å¼æ­å»ºä¸åçè¯¦è§£',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Redis æç¨",frontmatter:{title:"Redis æç¨",date:"2020-02-10T14:27:39.000Z",categories:["æ°æ®åº","KVæ°æ®åº","Redis"],tags:["æ°æ®åº","KVæ°æ®åº","Redis"],permalink:"/pages/b2487a/"},regularPath:"/05.KV%E6%95%B0%E6%8D%AE%E5%BA%93/01.Redis/",relativePath:"05.KVæ°æ®åº/01.Redis/README.md",key:"v-88bb15a6",path:"/pages/b2487a/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:143},{level:3,title:"Redis é¢è¯æ»ç» ð¯",slug:"redis-é¢è¯æ»ç»-ð¯",normalizedTitle:"redis é¢è¯æ»ç» ð¯",charIndex:153},{level:3,title:"Redis åºç¨æå â¡",slug:"redis-åºç¨æå-â¡",normalizedTitle:"redis åºç¨æå â¡",charIndex:171},{level:3,title:"Redis æ°æ®ç±»åååºç¨",slug:"redis-æ°æ®ç±»åååºç¨",normalizedTitle:"redis æ°æ®ç±»åååºç¨",charIndex:217},{level:3,title:"Redis æä¹å",slug:"redis-æä¹å",normalizedTitle:"redis æä¹å",charIndex:293},{level:3,title:"Redis å¤å¶",slug:"redis-å¤å¶",normalizedTitle:"redis å¤å¶",charIndex:348},{level:3,title:"Redis å¨åµ",slug:"redis-å¨åµ",normalizedTitle:"redis å¨åµ",charIndex:402},{level:3,title:"Redis éç¾¤",slug:"redis-éç¾¤",normalizedTitle:"redis éç¾¤",charIndex:540},{level:3,title:"Redis å®æ",slug:"redis-å®æ",normalizedTitle:"redis å®æ",charIndex:621},{level:3,title:"Redis è¿ç»´ ð¨",slug:"redis-è¿ç»´-ð¨",normalizedTitle:"redis è¿ç»´ ð¨",charIndex:655},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:691},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:1123}],headersStr:"ð åå®¹ Redis é¢è¯æ»ç» ð¯ Redis åºç¨æå â¡ Redis æ°æ®ç±»åååºç¨ Redis æä¹å Redis å¤å¶ Redis å¨åµ Redis éç¾¤ Redis å®æ Redis è¿ç»´ ð¨ ð èµæ ðª ä¼ é",content:"# Redis æç¨\n\n> Redis æå¸åçåºç¨åºæ¯æ¯ä½ä¸ºåå¸å¼ç¼å­ã\n> \n> å­¦ä¹  Redisï¼æå¿è¦æ·±å¥çè§£ç¼å­çåçï¼ä»¥å Redis ä½ä¸ºä¸ç§ç¼å­æ¹æ¡ï¼å¨ç³»ç»åºç¨ä¸­çå®ä½ã\n> \n> åèï¼ç¼å­åºæ¬åçï¼æå©äºçè§£ç¼å­çç¹æ§ãåçï¼ä½¿ç¨ç¼å­å¸¸è§çé®é¢åè§£å³æ¹æ¡ã\n\n\n# ð åå®¹\n\n\n# Redis é¢è¯æ»ç» ð¯\n\n\n# Redis åºç¨æå â¡\n\n> å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n\n\n\n\n# Redis æ°æ®ç±»åååºç¨\n\n> å³é®è¯ï¼STRINGãHASHãLISTãSETãZSETãBitMapãHyperLogLogãGeo\n\n\n\n\n# Redis æä¹å\n\n> å³é®è¯ï¼RDBãAOFãSAVEãBGSAVEãappendfsync\n\n\n\n\n# Redis å¤å¶\n\n> å³é®è¯ï¼SLAVEOFãSYNCãPSYNCãREPLCONF ACK\n\n\n\n\n# Redis å¨åµ\n\n> Redis å¨åµï¼Sentinelï¼æ¯ Redis çé«å¯ç¨æ§ï¼Hight Availabilityï¼è§£å³æ¹æ¡ã\n> \n> Redis å¨åµæ¯ Raft ç®æ³ çå·ä½å®ç°ã\n> \n> å³é®è¯ï¼SentinelãPINGãINFOãRaft\n\n\n\n\n# Redis éç¾¤\n\n> å³é®è¯ï¼CLUSTER MEETãHash slotãMOVEDãASKãSLAVEOF no oneãredis-trib\n\n\n\n\n# Redis å®æ\n\n> å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n\n\n# Redis è¿ç»´ ð¨\n\n> å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# ð èµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * Redis å½ä»¤åè\n * æç« \n   * Introduction to Redis\n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- Redis åºç¡\n * æºç \n   * ãRedis å®æãéå¥ Python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# redis æç¨\n\n> redis æå¸åçåºç¨åºæ¯æ¯ä½ä¸ºåå¸å¼ç¼å­ã\n> \n> å­¦ä¹  redisï¼æå¿è¦æ·±å¥çè§£ç¼å­çåçï¼ä»¥å redis ä½ä¸ºä¸ç§ç¼å­æ¹æ¡ï¼å¨ç³»ç»åºç¨ä¸­çå®ä½ã\n> \n> åèï¼ç¼å­åºæ¬åçï¼æå©äºçè§£ç¼å­çç¹æ§ãåçï¼ä½¿ç¨ç¼å­å¸¸è§çé®é¢åè§£å³æ¹æ¡ã\n\n\n# ð åå®¹\n\n\n# redis é¢è¯æ»ç» ð¯\n\n\n# redis åºç¨æå â¡\n\n> å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n\n\n\n\n# redis æ°æ®ç±»åååºç¨\n\n> å³é®è¯ï¼stringãhashãlistãsetãzsetãbitmapãhyperloglogãgeo\n\n\n\n\n# redis æä¹å\n\n> å³é®è¯ï¼rdbãaofãsaveãbgsaveãappendfsync\n\n\n\n\n# redis å¤å¶\n\n> å³é®è¯ï¼slaveofãsyncãpsyncãreplconf ack\n\n\n\n\n# redis å¨åµ\n\n> redis å¨åµï¼sentinelï¼æ¯ redis çé«å¯ç¨æ§ï¼hight availabilityï¼è§£å³æ¹æ¡ã\n> \n> redis å¨åµæ¯ raft ç®æ³ çå·ä½å®ç°ã\n> \n> å³é®è¯ï¼sentinelãpingãinfoãraft\n\n\n\n\n# redis éç¾¤\n\n> å³é®è¯ï¼cluster meetãhash slotãmovedãaskãslaveof no oneãredis-trib\n\n\n\n\n# redis å®æ\n\n> å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n\n\n# redis è¿ç»´ ð¨\n\n> å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# ð èµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æç¨\n   * redis å½ä»¤åè\n * æç« \n   * introduction to redis\n   * ãæä»¬ä¸èµ·è¿å¤§åãç³»å- redis åºç¡\n * æºç \n   * ãredis å®æãéå¥ python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Hbase",frontmatter:{title:"Hbase",date:"2020-02-10T14:27:39.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº"],tags:["æ°æ®åº","åå¼æ°æ®åº","Hbase"],permalink:"/pages/b570af/"},regularPath:"/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/01.Hbase.html",relativePath:"06.åå¼æ°æ®åº/01.Hbase.md",key:"v-db539372",path:"/pages/b570af/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:12},{level:2,title:"åºç¡",slug:"åºç¡",normalizedTitle:"åºç¡",charIndex:32},{level:2,title:"åç",slug:"åç",normalizedTitle:"åç",charIndex:206},{level:3,title:"æ°æ®æ¨¡å",slug:"æ°æ®æ¨¡å",normalizedTitle:"æ°æ®æ¨¡å",charIndex:213},{level:3,title:"HBase æ¶æ",slug:"hbase-æ¶æ",normalizedTitle:"hbase æ¶æ",charIndex:498},{level:4,title:"Regin",slug:"regin",normalizedTitle:"regin",charIndex:766},{level:4,title:"Master æå¡å¨",slug:"master-æå¡å¨",normalizedTitle:"master æå¡å¨",charIndex:873},{level:4,title:"Regin æå¡å¨",slug:"regin-æå¡å¨",normalizedTitle:"regin æå¡å¨",charIndex:1059},{level:4,title:"ZooKeeper",slug:"zookeeper",normalizedTitle:"zookeeper",charIndex:744},{level:2,title:"HBase å RDBMS",slug:"hbase-å-rdbms",normalizedTitle:"hbase å rdbms",charIndex:1442},{level:2,title:"API",slug:"api",normalizedTitle:"api",charIndex:1739},{level:2,title:"éå½",slug:"éå½",normalizedTitle:"éå½",charIndex:1774},{level:3,title:"å½ä»¤è¡",slug:"å½ä»¤è¡",normalizedTitle:"å½ä»¤è¡",charIndex:1781},{level:2,title:"æ´å¤åå®¹",slug:"æ´å¤åå®¹",normalizedTitle:"æ´å¤åå®¹",charIndex:1816},{level:3,title:"æ©å±éè¯»",slug:"æ©å±éè¯»",normalizedTitle:"æ©å±éè¯»",charIndex:1825},{level:3,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:1859},{level:4,title:"å®æ¹",slug:"å®æ¹",normalizedTitle:"å®æ¹",charIndex:1867},{level:4,title:"æç« ",slug:"æç« ",normalizedTitle:"æç« ",charIndex:1930}],headersStr:"ç®ä» åºç¡ åç æ°æ®æ¨¡å HBase æ¶æ Regin Master æå¡å¨ Regin æå¡å¨ ZooKeeper HBase å RDBMS API éå½ å½ä»¤è¡ æ´å¤åå®¹ æ©å±éè¯» åèèµæ å®æ¹ æç« ",content:"# HBase\n\n\n# ç®ä»\n\nHBase æ¯å»ºç«å¨ HDFS åºç¡ä¸çé¢ååçåå¸å¼æ°æ®åºã\n\n * HBase åèäºè°·æ­ç BigTable å»ºæ¨¡ï¼å®ç°çç¼ç¨è¯­è¨ä¸º Javaã\n * å®æ¯ Hadoop é¡¹ç®çå­é¡¹ç®ï¼è¿è¡äº HDFS æä»¶ç³»ç»ä¹ä¸ã\n\nHBase éç¨åºæ¯ï¼å®æ¶å°éæºè®¿é®è¶å¤§æ°æ®éã\n\nå¨ CAP çè®ºä¸­ï¼HBase å±äº CP ç±»åçç³»ç»ã\n\n\n# åºç¡\n\nHBase ç»´æ¤\n\n\n# åç\n\n\n# æ°æ®æ¨¡å\n\nHBase æ¯ä¸ä¸ªé¢ååçæ°æ®åºï¼å¨è¡¨ä¸­å®ç±è¡æåºã\n\nHBase è¡¨æ¨¡åç»æä¸ºï¼\n\n * è¡¨ï¼tableï¼æ¯è¡çéåã\n * è¡ï¼rowï¼æ¯åæçéåã\n * åæï¼column familyï¼æ¯åçéåã\n * åï¼rowï¼æ¯é®å¼å¯¹çéåã\n\n\n\nHBase è¡¨çååæ ¼ï¼cellï¼ç±è¡ååçåæ äº¤åå³å®ï¼æ¯æçæ¬çãé»è®¤æåµä¸ï¼çæ¬å·æ¯èªå¨åéçï¼ä¸º HBase æå¥ååæ ¼æ¶çæ¶é´æ³ãååæ ¼çåå®¹æ¯æªè§£éçå­èæ°ç»ã\n\nè¡çé®ä¹æ¯æªè§£éçå­èæ°ç»ï¼æä»¥çè®ºä¸ï¼ä»»ä½æ°æ®é½å¯ä»¥éè¿åºååè¡¨ç¤ºæå­ç¬¦ä¸²æäºè¿å¶ï¼ä»èå­ä¸º HBase çé®å¼ã\n\n\n\n\n# HBase æ¶æ\n\n\n\nå HDFSãYARN ä¸æ ·ï¼HBase ä¹éç¨ master / slave æ¶æï¼\n\n * HBase æä¸ä¸ª master èç¹ãmaster èç¹è´è´£å°åºåï¼regionï¼åéç» region èç¹ï¼æ¢å¤ region èç¹çæéã\n * HBase æå¤ä¸ª region èç¹ãregion èç¹è´è´£é¶ä¸ªæå¤ä¸ªåºåï¼regionï¼çç®¡çå¹¶ç¸åºå®¢æ·ç«¯çè¯»åè¯·æ±ãregion èç¹è¿è´è´£åºåçååå¹¶éç¥ master èç¹æäºæ°çå­åºåã\n\nHBase ä¾èµ ZooKeeper æ¥å®ç°æéæ¢å¤ã\n\n# Regin\n\nHBase è¡¨æè¡é®èå´æ°´å¹³èªå¨ååä¸ºåºåï¼regionï¼ãæ¯ä¸ªåºåç±è¡¨ä¸­è¡çå­éææãæ¯ä¸ªåºåç±å®æå±çè¡¨ãå®æå«çç¬¬ä¸è¡åæåä¸è¡æ¥è¡¨ç¤ºã\n\nåºååªä¸è¿æ¯è¡¨è¢«æåï¼å¹¶åå¸å¨åºåæå¡å¨ã\n\n\n\n# Master æå¡å¨\n\nåºååéãDDL(createãdelete)æä½ç± HBase master æå¡å¨å¤çã\n\n * master æå¡å¨è´è´£åè° region æå¡å¨\n   * åå©åºåå¯å¨ï¼åºç°æéæ¢å¤æè´è½½åè¡¡æåµæ¶ï¼éæ°åé region æå¡å¨\n   * çæ§éç¾¤ä¸­çææ region æå¡å¨\n * æ¯æ DDL æ¥å£ï¼åå»ºãå é¤ãæ´æ°è¡¨ï¼\n\n\n\n# Regin æå¡å¨\n\nåºåæå¡å¨è¿è¡å¨ HDFS æ°æ®èç¹ä¸ï¼å·æä»¥ä¸ç»ä»¶\n\n * WAL - Write Ahead Log æ¯ HDFS ä¸çæä»¶ãWAL å­å¨å°æªæä¹å­å¨å°æ°¸ä¹å­å¨çæ°æ°æ®ï¼å®ç¨äºå¨åçæéæ¶è¿è¡æ¢å¤ã\n\n * BlockCache - æ¯è¯»ç¼å­ãå®å°é¢ç¹è¯»åçæ°æ®å­å¨å¨åå­ä¸­ãè³å°æè¿ä½¿ç¨çæ°æ®å¨å®æ´æ¶è¢«éåºã\n\n * MemStore - æ¯åç¼å­ãå®å­å¨å°æªåå¥ç£ççæ°æ°æ®ãå¨åå¥ç£çä¹åå¯¹å¶è¿è¡æåºãæ¯ä¸ªåºåæ¯ä¸ªåææä¸ä¸ª MemStoreã\n\n * Hfiles - å°è¡å­å¨ä¸ºç£çä¸çæåºé®å¼å¯¹ã\n\n\n\n# ZooKeeper\n\nHBase ä½¿ç¨ ZooKeeper ä½ä¸ºåå¸å¼åè°æå¡æ¥ç»´æ¤éç¾¤ä¸­çæå¡å¨ç¶æãZookeeper ç»´æ¤åªäºæå¡å¨æ¯æ´»å¨çåå¯ç¨çï¼å¹¶æä¾æå¡å¨æééç¥ãéç¾¤è³å°åºè¯¥æ 3 ä¸ªèç¹ã\n\n\n\n\n# HBase å RDBMS\n\nHBASE                           RDBMS\nHBase æ æ¨¡å¼ï¼å®ä¸å·æåºå®åæ¨¡å¼çæ¦å¿µ;ä»å®ä¹åæã   RDBMS æå®çæ¨¡å¼ï¼æè¿°è¡¨çæ´ä½ç»æççº¦æã\nå®ä¸é¨åå»ºä¸ºå®½è¡¨ã HBase æ¯æ¨ªåæ©å±ã          è¿äºé½æ¯ç»èä¸ä¸ºå°è¡¨ãå¾é¾å½¢æè§æ¨¡ã\næ²¡æä»»ä½äºå¡å­å¨äº HBaseã                RDBMS æ¯äºå¡æ§çã\nå®åè§èåçæ°æ®ã                       å®å·æè§èåçæ°æ®ã\nå®ç¨äºåç»æä»¥åç»æåæ°æ®æ¯éå¸¸å¥½çã             ç¨äºç»æåæ°æ®éå¸¸å¥½ã\n\n\n# API\n\nJava API å½çº³æ»ç»å¨è¿éï¼HBase åºç¨\n\n\n# éå½\n\n\n# å½ä»¤è¡\n\nHBase å½ä»¤è¡å¯ä»¥åèè¿éï¼HBase å½ä»¤è¡\n\n\n# æ´å¤åå®¹\n\n\n# æ©å±éè¯»\n\n * HBase å½ä»¤\n * HBase è¿ç»´\n\n\n# åèèµæ\n\n# å®æ¹\n\n * HBase å®ç½\n * HBase å®æ¹ææ¡£\n * HBase å®æ¹ææ¡£ä¸­æç\n * HBase API\n\n# æç« \n\n * Bigtable: A Distributed Storage System for Structured Data\n * An In-Depth Look at the HBase Architecture",normalizedContent:"# hbase\n\n\n# ç®ä»\n\nhbase æ¯å»ºç«å¨ hdfs åºç¡ä¸çé¢ååçåå¸å¼æ°æ®åºã\n\n * hbase åèäºè°·æ­ç bigtable å»ºæ¨¡ï¼å®ç°çç¼ç¨è¯­è¨ä¸º javaã\n * å®æ¯ hadoop é¡¹ç®çå­é¡¹ç®ï¼è¿è¡äº hdfs æä»¶ç³»ç»ä¹ä¸ã\n\nhbase éç¨åºæ¯ï¼å®æ¶å°éæºè®¿é®è¶å¤§æ°æ®éã\n\nå¨ cap çè®ºä¸­ï¼hbase å±äº cp ç±»åçç³»ç»ã\n\n\n# åºç¡\n\nhbase ç»´æ¤\n\n\n# åç\n\n\n# æ°æ®æ¨¡å\n\nhbase æ¯ä¸ä¸ªé¢ååçæ°æ®åºï¼å¨è¡¨ä¸­å®ç±è¡æåºã\n\nhbase è¡¨æ¨¡åç»æä¸ºï¼\n\n * è¡¨ï¼tableï¼æ¯è¡çéåã\n * è¡ï¼rowï¼æ¯åæçéåã\n * åæï¼column familyï¼æ¯åçéåã\n * åï¼rowï¼æ¯é®å¼å¯¹çéåã\n\n\n\nhbase è¡¨çååæ ¼ï¼cellï¼ç±è¡ååçåæ äº¤åå³å®ï¼æ¯æçæ¬çãé»è®¤æåµä¸ï¼çæ¬å·æ¯èªå¨åéçï¼ä¸º hbase æå¥ååæ ¼æ¶çæ¶é´æ³ãååæ ¼çåå®¹æ¯æªè§£éçå­èæ°ç»ã\n\nè¡çé®ä¹æ¯æªè§£éçå­èæ°ç»ï¼æä»¥çè®ºä¸ï¼ä»»ä½æ°æ®é½å¯ä»¥éè¿åºååè¡¨ç¤ºæå­ç¬¦ä¸²æäºè¿å¶ï¼ä»èå­ä¸º hbase çé®å¼ã\n\n\n\n\n# hbase æ¶æ\n\n\n\nå hdfsãyarn ä¸æ ·ï¼hbase ä¹éç¨ master / slave æ¶æï¼\n\n * hbase æä¸ä¸ª master èç¹ãmaster èç¹è´è´£å°åºåï¼regionï¼åéç» region èç¹ï¼æ¢å¤ region èç¹çæéã\n * hbase æå¤ä¸ª region èç¹ãregion èç¹è´è´£é¶ä¸ªæå¤ä¸ªåºåï¼regionï¼çç®¡çå¹¶ç¸åºå®¢æ·ç«¯çè¯»åè¯·æ±ãregion èç¹è¿è´è´£åºåçååå¹¶éç¥ master èç¹æäºæ°çå­åºåã\n\nhbase ä¾èµ zookeeper æ¥å®ç°æéæ¢å¤ã\n\n# regin\n\nhbase è¡¨æè¡é®èå´æ°´å¹³èªå¨ååä¸ºåºåï¼regionï¼ãæ¯ä¸ªåºåç±è¡¨ä¸­è¡çå­éææãæ¯ä¸ªåºåç±å®æå±çè¡¨ãå®æå«çç¬¬ä¸è¡åæåä¸è¡æ¥è¡¨ç¤ºã\n\nåºååªä¸è¿æ¯è¡¨è¢«æåï¼å¹¶åå¸å¨åºåæå¡å¨ã\n\n\n\n# master æå¡å¨\n\nåºååéãddl(createãdelete)æä½ç± hbase master æå¡å¨å¤çã\n\n * master æå¡å¨è´è´£åè° region æå¡å¨\n   * åå©åºåå¯å¨ï¼åºç°æéæ¢å¤æè´è½½åè¡¡æåµæ¶ï¼éæ°åé region æå¡å¨\n   * çæ§éç¾¤ä¸­çææ region æå¡å¨\n * æ¯æ ddl æ¥å£ï¼åå»ºãå é¤ãæ´æ°è¡¨ï¼\n\n\n\n# regin æå¡å¨\n\nåºåæå¡å¨è¿è¡å¨ hdfs æ°æ®èç¹ä¸ï¼å·æä»¥ä¸ç»ä»¶\n\n * wal - write ahead log æ¯ hdfs ä¸çæä»¶ãwal å­å¨å°æªæä¹å­å¨å°æ°¸ä¹å­å¨çæ°æ°æ®ï¼å®ç¨äºå¨åçæéæ¶è¿è¡æ¢å¤ã\n\n * blockcache - æ¯è¯»ç¼å­ãå®å°é¢ç¹è¯»åçæ°æ®å­å¨å¨åå­ä¸­ãè³å°æè¿ä½¿ç¨çæ°æ®å¨å®æ´æ¶è¢«éåºã\n\n * memstore - æ¯åç¼å­ãå®å­å¨å°æªåå¥ç£ççæ°æ°æ®ãå¨åå¥ç£çä¹åå¯¹å¶è¿è¡æåºãæ¯ä¸ªåºåæ¯ä¸ªåææä¸ä¸ª memstoreã\n\n * hfiles - å°è¡å­å¨ä¸ºç£çä¸çæåºé®å¼å¯¹ã\n\n\n\n# zookeeper\n\nhbase ä½¿ç¨ zookeeper ä½ä¸ºåå¸å¼åè°æå¡æ¥ç»´æ¤éç¾¤ä¸­çæå¡å¨ç¶æãzookeeper ç»´æ¤åªäºæå¡å¨æ¯æ´»å¨çåå¯ç¨çï¼å¹¶æä¾æå¡å¨æééç¥ãéç¾¤è³å°åºè¯¥æ 3 ä¸ªèç¹ã\n\n\n\n\n# hbase å rdbms\n\nhbase                           rdbms\nhbase æ æ¨¡å¼ï¼å®ä¸å·æåºå®åæ¨¡å¼çæ¦å¿µ;ä»å®ä¹åæã   rdbms æå®çæ¨¡å¼ï¼æè¿°è¡¨çæ´ä½ç»æççº¦æã\nå®ä¸é¨åå»ºä¸ºå®½è¡¨ã hbase æ¯æ¨ªåæ©å±ã          è¿äºé½æ¯ç»èä¸ä¸ºå°è¡¨ãå¾é¾å½¢æè§æ¨¡ã\næ²¡æä»»ä½äºå¡å­å¨äº hbaseã                rdbms æ¯äºå¡æ§çã\nå®åè§èåçæ°æ®ã                       å®å·æè§èåçæ°æ®ã\nå®ç¨äºåç»æä»¥åç»æåæ°æ®æ¯éå¸¸å¥½çã             ç¨äºç»æåæ°æ®éå¸¸å¥½ã\n\n\n# api\n\njava api å½çº³æ»ç»å¨è¿éï¼hbase åºç¨\n\n\n# éå½\n\n\n# å½ä»¤è¡\n\nhbase å½ä»¤è¡å¯ä»¥åèè¿éï¼hbase å½ä»¤è¡\n\n\n# æ´å¤åå®¹\n\n\n# æ©å±éè¯»\n\n * hbase å½ä»¤\n * hbase è¿ç»´\n\n\n# åèèµæ\n\n# å®æ¹\n\n * hbase å®ç½\n * hbase å®æ¹ææ¡£\n * hbase å®æ¹ææ¡£ä¸­æç\n * hbase api\n\n# æç« \n\n * bigtable: a distributed storage system for structured data\n * an in-depth look at the hbase architecture",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Cassandra",frontmatter:{title:"Cassandra",date:"2019-08-22T09:02:39.000Z",categories:["æ°æ®åº","åå¼æ°æ®åº"],tags:["æ°æ®åº","åå¼æ°æ®åº","Cassandra"],permalink:"/pages/4c58c2/"},regularPath:"/06.%E5%88%97%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93/02.Cassandra.html",relativePath:"06.åå¼æ°æ®åº/02.Cassandra.md",key:"v-33028f47",path:"/pages/4c58c2/",headers:[{level:2,title:"Quick Start",slug:"quick-start",normalizedTitle:"quick start",charIndex:81},{level:3,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:97},{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:142},{level:3,title:"ç¹æ§",slug:"ç¹æ§",normalizedTitle:"ç¹æ§",charIndex:220},{level:4,title:"ä¸»è¦ç¹æ§",slug:"ä¸»è¦ç¹æ§",normalizedTitle:"ä¸»è¦ç¹æ§",charIndex:226},{level:4,title:"çªåºç¹æ§",slug:"çªåºç¹æ§",normalizedTitle:"çªåºç¹æ§",charIndex:435},{level:2,title:"æ´å¤åå®¹",slug:"æ´å¤åå®¹",normalizedTitle:"æ´å¤åå®¹",charIndex:810},{level:2,title:"ðª ä¼ éé¨",slug:"ä¼ éé¨",normalizedTitle:"ðª ä¼ éé¨",charIndex:856}],headersStr:"Quick Start å®è£ ç®ä» ç¹æ§ ä¸»è¦ç¹æ§ çªåºç¹æ§ æ´å¤åå®¹ ðª ä¼ éé¨",content:"# Cassandra\n\n> Apache Cassandra æ¯ä¸ä¸ªé«åº¦å¯æ©å±çååºè¡å­å¨ãè¡è¢«ç»ç»æå·ææéä¸»é®çè¡¨ã\n> \n> ææ°çæ¬ï¼v4.0\n\n\n# Quick Start\n\n\n# å®è£\n\n> åå³æ¡ä»¶\n> \n>  * JDK8+\n>  * Python 2.7\n\n\n# ç®ä»\n\nApache Cassandra æ¯ä¸å¥å¼æºåå¸å¼ Key-Value å­å¨ç³»ç»ãå®æåç± Facebook å¼åï¼ç¨äºå¨å­ç¹å«å¤§çæ°æ®ã\n\n\n# ç¹æ§\n\n# ä¸»è¦ç¹æ§\n\n * åå¸å¼\n * åºäº column çç»æå\n * é«ä¼¸å±æ§\n\nCassandra çä¸»è¦ç¹ç¹å°±æ¯å®ä¸æ¯ä¸ä¸ªæ°æ®åºï¼èæ¯ç±ä¸å æ°æ®åºèç¹å±åææçä¸ä¸ªåå¸å¼ç½ç»æå¡ï¼å¯¹ Cassandra çä¸ä¸ªåæä½ï¼ä¼è¢«å¤å¶å°å¶ä»èç¹ä¸å»ï¼å¯¹ Cassandra çè¯»æä½ï¼ä¹ä¼è¢«è·¯ç±å°æä¸ªèç¹ä¸é¢å»è¯»åãå¯¹äºä¸ä¸ª Cassandra ç¾¤éæ¥è¯´ï¼æ©å±æ§è½ æ¯æ¯è¾ç®åçäºæï¼åªç®¡å¨ç¾¤ééé¢æ·»å èç¹å°±å¯ä»¥äºã\n\n# çªåºç¹æ§\n\n * æ¨¡å¼çµæ´» - ä½¿ç¨ Cassandraï¼åææ¡£å­å¨ï¼ä¸å¿æåè§£å³è®°å½ä¸­çå­æ®µãä½ å¯ä»¥å¨ç³»ç»è¿è¡æ¶éæçæ·»å æç§»é¤å­æ®µãè¿æ¯ä¸ä¸ªæäººçæçæåï¼ç¹å«æ¯å¨å¤§åé¨ç½²ä¸ã\n * çæ­£çå¯æ©å±æ§ - Cassandra æ¯çº¯ç²¹æä¹ä¸çæ°´å¹³æ©å±ãä¸ºç»éç¾¤æ·»å æ´å¤å®¹éï¼å¯ä»¥æåå¦ä¸å°çµèãä½ ä¸å¿éå¯ä»»ä½è¿ç¨ï¼æ¹ååºç¨æ¥è¯¢ï¼ææå¨è¿ç§»ä»»ä½æ°æ®ã\n * å¤æ°æ®ä¸­å¿è¯å« - ä½ å¯ä»¥è°æ´ä½ çèç¹å¸å±æ¥é¿åæä¸ä¸ªæ°æ®ä¸­å¿èµ·ç«ï¼ä¸ä¸ªå¤ç¨çæ°æ®ä¸­å¿å°è³å°ææ¯æ¡è®°å½çå®å¨å¤å¶ã\n * èå´æ¥è¯¢ - å¦æä½ ä¸åæ¬¢å¨é¨çé®å¼æ¥è¯¢ï¼åå¯ä»¥è®¾ç½®é®çèå´æ¥æ¥è¯¢ã\n * åè¡¨æ°æ®ç»æ - å¨æ··åæ¨¡å¼å¯ä»¥å°è¶çº§åæ·»å å° 5 ç»´ãå¯¹äºæ¯ä¸ªç¨æ·çç´¢å¼ï¼è¿æ¯éå¸¸æ¹ä¾¿çã\n * åå¸å¼åæä½ - æå¯ä»¥å¨ä»»ä½å°æ¹ä»»ä½æ¶é´éä¸­è¯»æåä»»ä½æ°æ®ãå¹¶ä¸ä¸ä¼æä»»ä½åç¹å¤±è´¥ã\n\n\n# æ´å¤åå®¹\n\n * Cassandra å®ç½\n * Cassandra Github\n\n\n# ðª ä¼ éé¨\n\n| æç Github åå®¢ | db-tutorial é¦é¡µ |",normalizedContent:"# cassandra\n\n> apache cassandra æ¯ä¸ä¸ªé«åº¦å¯æ©å±çååºè¡å­å¨ãè¡è¢«ç»ç»æå·ææéä¸»é®çè¡¨ã\n> \n> ææ°çæ¬ï¼v4.0\n\n\n# quick start\n\n\n# å®è£\n\n> åå³æ¡ä»¶\n> \n>  * jdk8+\n>  * python 2.7\n\n\n# ç®ä»\n\napache cassandra æ¯ä¸å¥å¼æºåå¸å¼ key-value å­å¨ç³»ç»ãå®æåç± facebook å¼åï¼ç¨äºå¨å­ç¹å«å¤§çæ°æ®ã\n\n\n# ç¹æ§\n\n# ä¸»è¦ç¹æ§\n\n * åå¸å¼\n * åºäº column çç»æå\n * é«ä¼¸å±æ§\n\ncassandra çä¸»è¦ç¹ç¹å°±æ¯å®ä¸æ¯ä¸ä¸ªæ°æ®åºï¼èæ¯ç±ä¸å æ°æ®åºèç¹å±åææçä¸ä¸ªåå¸å¼ç½ç»æå¡ï¼å¯¹ cassandra çä¸ä¸ªåæä½ï¼ä¼è¢«å¤å¶å°å¶ä»èç¹ä¸å»ï¼å¯¹ cassandra çè¯»æä½ï¼ä¹ä¼è¢«è·¯ç±å°æä¸ªèç¹ä¸é¢å»è¯»åãå¯¹äºä¸ä¸ª cassandra ç¾¤éæ¥è¯´ï¼æ©å±æ§è½ æ¯æ¯è¾ç®åçäºæï¼åªç®¡å¨ç¾¤ééé¢æ·»å èç¹å°±å¯ä»¥äºã\n\n# çªåºç¹æ§\n\n * æ¨¡å¼çµæ´» - ä½¿ç¨ cassandraï¼åææ¡£å­å¨ï¼ä¸å¿æåè§£å³è®°å½ä¸­çå­æ®µãä½ å¯ä»¥å¨ç³»ç»è¿è¡æ¶éæçæ·»å æç§»é¤å­æ®µãè¿æ¯ä¸ä¸ªæäººçæçæåï¼ç¹å«æ¯å¨å¤§åé¨ç½²ä¸ã\n * çæ­£çå¯æ©å±æ§ - cassandra æ¯çº¯ç²¹æä¹ä¸çæ°´å¹³æ©å±ãä¸ºç»éç¾¤æ·»å æ´å¤å®¹éï¼å¯ä»¥æåå¦ä¸å°çµèãä½ ä¸å¿éå¯ä»»ä½è¿ç¨ï¼æ¹ååºç¨æ¥è¯¢ï¼ææå¨è¿ç§»ä»»ä½æ°æ®ã\n * å¤æ°æ®ä¸­å¿è¯å« - ä½ å¯ä»¥è°æ´ä½ çèç¹å¸å±æ¥é¿åæä¸ä¸ªæ°æ®ä¸­å¿èµ·ç«ï¼ä¸ä¸ªå¤ç¨çæ°æ®ä¸­å¿å°è³å°ææ¯æ¡è®°å½çå®å¨å¤å¶ã\n * èå´æ¥è¯¢ - å¦æä½ ä¸åæ¬¢å¨é¨çé®å¼æ¥è¯¢ï¼åå¯ä»¥è®¾ç½®é®çèå´æ¥æ¥è¯¢ã\n * åè¡¨æ°æ®ç»æ - å¨æ··åæ¨¡å¼å¯ä»¥å°è¶çº§åæ·»å å° 5 ç»´ãå¯¹äºæ¯ä¸ªç¨æ·çç´¢å¼ï¼è¿æ¯éå¸¸æ¹ä¾¿çã\n * åå¸å¼åæä½ - æå¯ä»¥å¨ä»»ä½å°æ¹ä»»ä½æ¶é´éä¸­è¯»æåä»»ä½æ°æ®ãå¹¶ä¸ä¸ä¼æä»»ä½åç¹å¤±è´¥ã\n\n\n# æ´å¤åå®¹\n\n * cassandra å®ç½\n * cassandra github\n\n\n# ðª ä¼ éé¨\n\n| æç github åå®¢ | db-tutorial é¦é¡µ |",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch é¢è¯æ»ç»",frontmatter:{title:"Elasticsearch é¢è¯æ»ç»",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","é¢è¯"],permalink:"/pages/1f9edc/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/01.Elasticsearch%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/01.Elasticsearché¢è¯æ»ç».md",key:"v-5718adbb",path:"/pages/1f9edc/",headers:[{level:2,title:"éç¾¤é¨ç½²",slug:"éç¾¤é¨ç½²",normalizedTitle:"éç¾¤é¨ç½²",charIndex:25},{level:2,title:"æ§è½ä¼å",slug:"æ§è½ä¼å",normalizedTitle:"æ§è½ä¼å",charIndex:127},{level:3,title:"filesystem cache",slug:"filesystem-cache",normalizedTitle:"filesystem cache",charIndex:136},{level:3,title:"æ°æ®é¢ç­",slug:"æ°æ®é¢ç­",normalizedTitle:"æ°æ®é¢ç­",charIndex:1707},{level:3,title:"å·ç­åç¦»",slug:"å·ç­åç¦»",normalizedTitle:"å·ç­åç¦»",charIndex:2177},{level:3,title:"document æ¨¡åè®¾è®¡",slug:"document-æ¨¡åè®¾è®¡",normalizedTitle:"document æ¨¡åè®¾è®¡",charIndex:2652},{level:3,title:"åé¡µæ§è½ä¼å",slug:"åé¡µæ§è½ä¼å",normalizedTitle:"åé¡µæ§è½ä¼å",charIndex:3002},{level:4,title:"ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼",slug:"ä¸åè®¸æ·±åº¦åé¡µ-é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®",normalizedTitle:"ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼",charIndex:3493},{level:4,title:"ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç",slug:"ç±»ä¼¼äº-app-éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç",normalizedTitle:"ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç",charIndex:3551},{level:2,title:"å·¥ä½åç",slug:"å·¥ä½åç",normalizedTitle:"å·¥ä½åç",charIndex:4678},{level:3,title:"es åæ°æ®è¿ç¨",slug:"es-åæ°æ®è¿ç¨",normalizedTitle:"es åæ°æ®è¿ç¨",charIndex:4687},{level:3,title:"es è¯»æ°æ®è¿ç¨",slug:"es-è¯»æ°æ®è¿ç¨",normalizedTitle:"es è¯»æ°æ®è¿ç¨",charIndex:4966},{level:3,title:"es æç´¢æ°æ®è¿ç¨",slug:"es-æç´¢æ°æ®è¿ç¨",normalizedTitle:"es æç´¢æ°æ®è¿ç¨",charIndex:5311},{level:3,title:"åæ°æ®åºå±åç",slug:"åæ°æ®åºå±åç",normalizedTitle:"åæ°æ®åºå±åç",charIndex:5805},{level:3,title:"å é¤/æ´æ°æ°æ®åºå±åç",slug:"å é¤-æ´æ°æ°æ®åºå±åç",normalizedTitle:"å é¤/æ´æ°æ°æ®åºå±åç",charIndex:8075},{level:3,title:"åºå± lucene",slug:"åºå±-lucene",normalizedTitle:"åºå± lucene",charIndex:8520},{level:3,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:4542},{level:2,title:"elasticsearch çåæç´¢å¼æ¯ä»ä¹",slug:"elasticsearch-çåæç´¢å¼æ¯ä»ä¹",normalizedTitle:"elasticsearch çåæç´¢å¼æ¯ä»ä¹",charIndex:9624},{level:2,title:"3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²",slug:"_3ãelasticsearch-ç´¢å¼æ°æ®å¤äºæä¹å-å¦ä½è°ä¼-é¨ç½²",normalizedTitle:"3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²",charIndex:10036},{level:2,title:"4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç",slug:"_4ãelasticsearch-æ¯å¦ä½å®ç°-master-éä¸¾ç",normalizedTitle:"4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç",charIndex:10603},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-ç´¢å¼ææ¡£çè¿ç¨",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨",charIndex:11110},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ï¼",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-æç´¢çè¿ç¨",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ï¼",charIndex:11636},{level:2,title:"Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³",slug:"elasticsearch-å¨é¨ç½²æ¶-å¯¹-linux-çè®¾ç½®æåªäºä¼åæ¹æ³",normalizedTitle:"elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³",charIndex:11931},{level:2,title:"lucence åé¨ç»ææ¯ä»ä¹ï¼",slug:"lucence-åé¨ç»ææ¯ä»ä¹",normalizedTitle:"lucence åé¨ç»ææ¯ä»ä¹ï¼",charIndex:12136},{level:2,title:"Elasticsearch æ¯å¦ä½å®ç° Master éä¸¾çï¼",slug:"elasticsearch-æ¯å¦ä½å®ç°-master-éä¸¾ç",normalizedTitle:"elasticsearch æ¯å¦ä½å®ç° master éä¸¾çï¼",charIndex:12237},{level:2,title:"10ãElasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª",slug:"_10ãelasticsearch-ä¸­çèç¹-æ¯å¦å±-20-ä¸ª-å¶ä¸­ç-10-ä¸ª",normalizedTitle:"10ãelasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª",charIndex:12659},{level:2,title:"å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼",slug:"å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶-å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±ç",normalizedTitle:"å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼",charIndex:12897},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-ç´¢å¼ææ¡£çè¿ç¨ã",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã",charIndex:13045},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-æ´æ°åå é¤ææ¡£çè¿ç¨ã",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã",charIndex:13899},{level:2,title:"è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ã",slug:"è¯¦ç»æè¿°ä¸ä¸-elasticsearch-æç´¢çè¿ç¨ã",normalizedTitle:"è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ã",charIndex:14231},{level:2,title:"å¨ Elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼",slug:"å¨-elasticsearch-ä¸­-æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼ç",normalizedTitle:"å¨ elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼",charIndex:14793},{level:2,title:"Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼",slug:"elasticsearch-å¨é¨ç½²æ¶-å¯¹-linux-çè®¾ç½®æåªäºä¼åæ¹æ³-2",normalizedTitle:"elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼",charIndex:14942},{level:2,title:"å¯¹äº GC æ¹é¢ï¼å¨ä½¿ç¨ Elasticsearch æ¶è¦æ³¨æä»ä¹ï¼",slug:"å¯¹äº-gc-æ¹é¢-å¨ä½¿ç¨-elasticsearch-æ¶è¦æ³¨æä»ä¹",normalizedTitle:"å¯¹äº gc æ¹é¢ï¼å¨ä½¿ç¨ elasticsearch æ¶è¦æ³¨æä»ä¹ï¼",charIndex:16250},{level:2,title:"18ãElasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼",slug:"_18ãelasticsearch-å¯¹äºå¤§æ°æ®é-ä¸äº¿éçº§-çèåå¦ä½å®ç°",normalizedTitle:"18ãelasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼",charIndex:16751},{level:2,title:"19ãå¨å¹¶åæåµä¸ï¼Elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼",slug:"_19ãå¨å¹¶åæåµä¸-elasticsearch-å¦æä¿è¯è¯»åä¸è´",normalizedTitle:"19ãå¨å¹¶åæåµä¸ï¼elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼",charIndex:17043},{level:2,title:"20ãå¦ä½çæ§ Elasticsearch éç¾¤ç¶æï¼",slug:"_20ãå¦ä½çæ§-elasticsearch-éç¾¤ç¶æ",normalizedTitle:"20ãå¦ä½çæ§ elasticsearch éç¾¤ç¶æï¼",charIndex:17394},{level:2,title:"21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã",slug:"_21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã",normalizedTitle:"21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã",charIndex:17508},{level:2,title:"ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼",slug:"ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡",normalizedTitle:"ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼",charIndex:17535},{level:2,title:"æ¯å¦äºè§£å­å¸æ ï¼",slug:"æ¯å¦äºè§£å­å¸æ ",normalizedTitle:"æ¯å¦äºè§£å­å¸æ ï¼",charIndex:17816},{level:2,title:"æ¼åçº éæ¯å¦ä½å®ç°çï¼",slug:"æ¼åçº éæ¯å¦ä½å®ç°ç",normalizedTitle:"æ¼åçº éæ¯å¦ä½å®ç°çï¼",charIndex:18209}],headersStr:"éç¾¤é¨ç½² æ§è½ä¼å filesystem cache æ°æ®é¢ç­ å·ç­åç¦» document æ¨¡åè®¾è®¡ åé¡µæ§è½ä¼å ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼ ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç å·¥ä½åç es åæ°æ®è¿ç¨ es è¯»æ°æ®è¿ç¨ es æç´¢æ°æ®è¿ç¨ åæ°æ®åºå±åç å é¤/æ´æ°æ°æ®åºå±åç åºå± lucene åæç´¢å¼ elasticsearch çåæç´¢å¼æ¯ä»ä¹ 3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½² 4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ï¼ Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ lucence åé¨ç»ææ¯ä»ä¹ï¼ Elasticsearch æ¯å¦ä½å®ç° Master éä¸¾çï¼ 10ãElasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼ è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ã å¨ Elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼ Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼ å¯¹äº GC æ¹é¢ï¼å¨ä½¿ç¨ Elasticsearch æ¶è¦æ³¨æä»ä¹ï¼ 18ãElasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼ 19ãå¨å¹¶åæåµä¸ï¼Elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼ 20ãå¦ä½çæ§ Elasticsearch éç¾¤ç¶æï¼ 21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼ æ¯å¦äºè§£å­å¸æ ï¼ æ¼åçº éæ¯å¦ä½å®ç°çï¼",content:"# Elasticsearch é¢è¯æ»ç»\n\n\n# éç¾¤é¨ç½²\n\nES é¨ç½²æåµï¼\n\n5 èç¹ï¼éç½®ï¼8 æ ¸ 64 G 1Tï¼ï¼æ»è®¡ 320 Gï¼5 Tã\n\nçº¦ 10+ ç´¢å¼ï¼5 åçï¼æ¯æ¥æ°å¢æ°æ®éçº¦ä¸º 2Gï¼4000w æ¡ãè®°å½ä¿å­ 30 å¤©ã\n\n\n# æ§è½ä¼å\n\n\n# filesystem cache\n\nä½ å¾ es éåçæ°æ®ï¼å®éä¸é½åå°ç£çæä»¶éå»äºï¼æ¥è¯¢çæ¶åï¼æä½ç³»ç»ä¼å°ç£çæä»¶éçæ°æ®èªå¨ç¼å­å° filesystem cache éé¢å»ã\n\n\n\nes çæç´¢å¼æä¸¥éä¾èµäºåºå±ç filesystem cache ï¼ä½ å¦æç» filesystem cache æ´å¤çåå­ï¼å°½éè®©åå­å¯ä»¥å®¹çº³ææç idx segment fileç´¢å¼æ°æ®æä»¶ï¼é£ä¹ä½ æç´¢çæ¶åå°±åºæ¬é½æ¯èµ°åå­çï¼æ§è½ä¼éå¸¸é«ã\n\næ§è½å·®è·ç©¶ç«å¯ä»¥æå¤å¤§ï¼æä»¬ä¹åå¾å¤çæµè¯ååæµï¼å¦æèµ°ç£çä¸è¬è¯å®ä¸ç§ï¼æç´¢æ§è½ç»å¯¹æ¯ç§çº§å«çï¼1 ç§ã5 ç§ã10 ç§ãä½å¦ææ¯èµ° filesystem cache ï¼æ¯èµ°çº¯åå­çï¼é£ä¹ä¸è¬æ¥è¯´æ§è½æ¯èµ°ç£çè¦é«ä¸ä¸ªæ°éçº§ï¼åºæ¬ä¸å°±æ¯æ¯«ç§çº§çï¼ä»å æ¯«ç§å°å ç¾æ¯«ç§ä¸ç­ã\n\nè¿éæä¸ªçå®çæ¡ä¾ãæä¸ªå¬å¸ es èç¹æ 3 å°æºå¨ï¼æ¯å°æºå¨çèµ·æ¥åå­å¾å¤ï¼64Gï¼æ»åå­å°±æ¯ 64 * 3 = 192G ãæ¯å°æºå¨ç» es jvm heap æ¯ 32G ï¼é£ä¹å©ä¸æ¥çç» filesystem cache çå°±æ¯æ¯å°æºå¨æ 32G ï¼æ»å±éç¾¤éç» filesystem cache çå°±æ¯ 32 * 3 = 96G åå­ãèæ­¤æ¶ï¼æ´ä¸ªç£çä¸ç´¢å¼æ°æ®æä»¶ï¼å¨ 3 å°æºå¨ä¸ä¸å±å ç¨äº 1T çç£çå®¹éï¼es æ°æ®éæ¯ 1T ï¼é£ä¹æ¯å°æºå¨çæ°æ®éæ¯ 300G ãè¿æ ·æ§è½å¥½åï¼ filesystem cache çåå­æ 100Gï¼ååä¹ä¸çæ°æ®å¯ä»¥æ¾åå­ï¼å¶ä»çé½å¨ç£çï¼ç¶åä½ æ§è¡æç´¢æä½ï¼å¤§é¨åæä½é½æ¯èµ°ç£çï¼æ§è½è¯å®å·®ã\n\nå½æ ¹ç»åºï¼ä½ è¦è®© es æ§è½è¦å¥½ï¼æä½³çæåµä¸ï¼å°±æ¯ä½ çæºå¨çåå­ï¼è³å°å¯ä»¥å®¹çº³ä½ çæ»æ°æ®éçä¸åã\n\næ ¹æ®æä»¬èªå·±ççäº§ç¯å¢å®è·µç»éªï¼æä½³çæåµä¸ï¼æ¯ä»ä»å¨ es ä¸­å°±å­å°éçæ°æ®ï¼å°±æ¯ä½ è¦ç¨æ¥æç´¢çé£äºç´¢å¼ï¼å¦æåå­çç» filesystem cache çæ¯ 100Gï¼é£ä¹ä½ å°±å°ç´¢å¼æ°æ®æ§å¶å¨ 100G ä»¥åï¼è¿æ ·çè¯ï¼ä½ çæ°æ®å ä¹å¨é¨èµ°åå­æ¥æç´¢ï¼æ§è½éå¸¸ä¹é«ï¼ä¸è¬å¯ä»¥å¨ 1 ç§ä»¥åã\n\næ¯å¦è¯´ä½ ç°å¨æä¸è¡æ°æ®ã id,name,age .... 30 ä¸ªå­æ®µãä½æ¯ä½ ç°å¨æç´¢ï¼åªéè¦æ ¹æ® id,name,age ä¸ä¸ªå­æ®µæ¥æç´¢ãå¦æä½ å»ä¹ä¹å¾ es éåå¥ä¸è¡æ°æ®ææçå­æ®µï¼å°±ä¼å¯¼è´è¯´ 90% çæ°æ®æ¯ä¸ç¨æ¥æç´¢çï¼ç»æç¡¬æ¯å æ®äº es æºå¨ä¸ç filesystem cache çç©ºé´ï¼åæ¡æ°æ®çæ°æ®éè¶å¤§ï¼å°±ä¼å¯¼è´ filesystem cahce è½ç¼å­çæ°æ®å°±è¶å°ãå¶å®ï¼ä»ä»åå¥ es ä¸­è¦ç¨æ¥æ£ç´¢çå°æ°å ä¸ªå­æ®µå°±å¯ä»¥äºï¼æ¯å¦è¯´å°±åå¥ es id,name,age ä¸ä¸ªå­æ®µï¼ç¶åä½ å¯ä»¥æå¶ä»çå­æ®µæ°æ®å­å¨ mysql/hbase éï¼æä»¬ä¸è¬æ¯å»ºè®®ç¨ es + hbase è¿ä¹ä¸ä¸ªæ¶æã\n\nhbase çç¹ç¹æ¯éç¨äºæµ·éæ°æ®çå¨çº¿å­å¨ï¼å°±æ¯å¯¹ hbase å¯ä»¥åå¥æµ·éæ°æ®ï¼ä½æ¯ä¸è¦åå¤æçæç´¢ï¼åå¾ç®åçä¸äºæ ¹æ® id æèèå´è¿è¡æ¥è¯¢çè¿ä¹ä¸ä¸ªæä½å°±å¯ä»¥äºãä» es ä¸­æ ¹æ® name å age å»æç´¢ï¼æ¿å°çç»æå¯è½å°± 20 ä¸ª doc id ï¼ç¶åæ ¹æ® doc id å° hbase éå»æ¥è¯¢æ¯ä¸ª doc id å¯¹åºçå®æ´çæ°æ®ï¼ç»æ¥åºæ¥ï¼åè¿åç»åç«¯ã\n\nåå¥ es çæ°æ®æå¥½å°äºç­äºï¼æèæ¯ç¥å¾®å¤§äº es ç filesystem cache çåå­å®¹éãç¶åä½ ä» es æ£ç´¢å¯è½å°±è±è´¹ 20msï¼ç¶ååæ ¹æ® es è¿åç id å» hbase éæ¥è¯¢ï¼æ¥ 20 æ¡æ°æ®ï¼å¯è½ä¹å°±èè´¹ä¸ª 30msï¼å¯è½ä½ åæ¥é£ä¹ç©å¿ï¼1T æ°æ®é½æ¾ esï¼ä¼æ¯æ¬¡æ¥è¯¢é½æ¯ 5~10sï¼ç°å¨å¯è½æ§è½å°±ä¼å¾é«ï¼æ¯æ¬¡æ¥è¯¢å°±æ¯ 50msã\n\n\n# æ°æ®é¢ç­\n\nåå¦è¯´ï¼åªææ¯ä½ å°±æç§ä¸è¿°çæ¹æ¡å»åäºï¼es éç¾¤ä¸­æ¯ä¸ªæºå¨åå¥çæ°æ®éè¿æ¯è¶è¿äº filesystem cache ä¸åï¼æ¯å¦è¯´ä½ åå¥ä¸å°æºå¨ 60G æ°æ®ï¼ç»æ filesystem cache å°± 30Gï¼è¿æ¯æ 30G æ°æ®çå¨äºç£çä¸ã\n\nå¶å®å¯ä»¥åæ°æ®é¢ç­ã\n\nä¸¾ä¸ªä¾å­ï¼æ¿å¾®åæ¥è¯´ï¼ä½ å¯ä»¥æä¸äºå¤§ Vï¼å¹³æ¶ççäººå¾å¤çæ°æ®ï¼ä½ èªå·±æååå°æä¸ªç³»ç»ï¼æ¯éä¸ä¼å¿ï¼èªå·±çåå°ç³»ç»å»æç´¢ä¸ä¸ç­æ°æ®ï¼å·å° filesystem cache éå»ï¼åé¢ç¨æ·å®éä¸æ¥çè¿ä¸ªç­æ°æ®çæ¶åï¼ä»ä»¬å°±æ¯ç´æ¥ä»åå­éæç´¢äºï¼å¾å¿«ã\n\næèæ¯çµåï¼ä½ å¯ä»¥å°å¹³æ¶æ¥çæå¤çä¸äºååï¼æ¯å¦è¯´ iphone 8ï¼ç­æ°æ®æååå°æä¸ªç¨åºï¼æ¯é 1 åéèªå·±ä¸»å¨è®¿é®ä¸æ¬¡ï¼å·å° filesystem cache éå»ã\n\nå¯¹äºé£äºä½ è§å¾æ¯è¾ç­çãç»å¸¸ä¼æäººè®¿é®çæ°æ®ï¼æå¥½åä¸ä¸ªä¸é¨çç¼å­é¢ç­å­ç³»ç»ï¼å°±æ¯å¯¹ç­æ°æ®æ¯éä¸æ®µæ¶é´ï¼å°±æåè®¿é®ä¸ä¸ï¼è®©æ°æ®è¿å¥ filesystem cache éé¢å»ãè¿æ ·ä¸æ¬¡å«äººè®¿é®çæ¶åï¼æ§è½ä¸å®ä¼å¥½å¾å¤ã\n\n\n# å·ç­åç¦»\n\nes å¯ä»¥åç±»ä¼¼äº mysql çæ°´å¹³æåï¼å°±æ¯è¯´å°å¤§éçè®¿é®å¾å°ãé¢çå¾ä½çæ°æ®ï¼åç¬åä¸ä¸ªç´¢å¼ï¼ç¶åå°è®¿é®å¾é¢ç¹çç­æ°æ®åç¬åä¸ä¸ªç´¢å¼ãæå¥½æ¯å°å·æ°æ®åå¥ä¸ä¸ªç´¢å¼ä¸­ï¼ç¶åç­æ°æ®åå¥å¦å¤ä¸ä¸ªç´¢å¼ä¸­ï¼è¿æ ·å¯ä»¥ç¡®ä¿ç­æ°æ®å¨è¢«é¢ç­ä¹åï¼å°½éé½è®©ä»ä»¬çå¨ filesystem os cache éï¼å«è®©å·æ°æ®ç»å²å·æã\n\nä½ çï¼åè®¾ä½ æ 6 å°æºå¨ï¼2 ä¸ªç´¢å¼ï¼ä¸ä¸ªæ¾å·æ°æ®ï¼ä¸ä¸ªæ¾ç­æ°æ®ï¼æ¯ä¸ªç´¢å¼ 3 ä¸ª shardã3 å°æºå¨æ¾ç­æ°æ® indexï¼å¦å¤ 3 å°æºå¨æ¾å·æ°æ® indexãç¶åè¿æ ·çè¯ï¼ä½ å¤§éçæ¶é´æ¯å¨è®¿é®ç­æ°æ® indexï¼ç­æ°æ®å¯è½å°±å æ»æ°æ®éç 10%ï¼æ­¤æ¶æ°æ®éå¾å°ï¼å ä¹å¨é½ä¿çå¨ filesystem cache éé¢äºï¼å°±å¯ä»¥ç¡®ä¿ç­æ°æ®çè®¿é®æ§è½æ¯å¾é«çãä½æ¯å¯¹äºå·æ°æ®èè¨ï¼æ¯å¨å«ç index éçï¼è·ç­æ°æ® index ä¸å¨ç¸åçæºå¨ä¸ï¼å¤§å®¶äºç¸ä¹é´é½æ²¡ä»ä¹èç³»äºãå¦ææäººè®¿é®å·æ°æ®ï¼å¯è½å¤§éæ°æ®æ¯å¨ç£çä¸çï¼æ­¤æ¶æ§è½å·®ç¹ï¼å°± 10% çäººå»è®¿é®å·æ°æ®ï¼90% çäººå¨è®¿é®ç­æ°æ®ï¼ä¹æ æè°äºã\n\n\n# document æ¨¡åè®¾è®¡\n\nå¯¹äº MySQLï¼æä»¬ç»å¸¸æä¸äºå¤æçå³èæ¥è¯¢ãå¨ es éè¯¥æä¹ç©å¿ï¼es éé¢çå¤æçå³èæ¥è¯¢å°½éå«ç¨ï¼ä¸æ¦ç¨äºæ§è½ä¸è¬é½ä¸å¤ªå¥½ã\n\næå¥½æ¯åå¨ Java ç³»ç»éå°±å®æå³èï¼å°å³èå¥½çæ°æ®ç´æ¥åå¥ es ä¸­ãæç´¢çæ¶åï¼å°±ä¸éè¦å©ç¨ es çæç´¢è¯­æ³æ¥å®æ join ä¹ç±»çå³èæç´¢äºã\n\ndocument æ¨¡åè®¾è®¡æ¯éå¸¸éè¦çï¼å¾å¤æä½ï¼ä¸è¦å¨æç´¢çæ¶åææ³å»æ§è¡åç§å¤æçä¹±ä¸å«ç³çæä½ães è½æ¯æçæä½å°±é£ä¹å¤ï¼ä¸è¦èèç¨ es åä¸äºå®ä¸å¥½æä½çäºæãå¦æççæé£ç§æä½ï¼å°½éå¨ document æ¨¡åè®¾è®¡çæ¶åï¼åå¥çæ¶åå°±å®æãå¦å¤å¯¹äºä¸äºå¤ªå¤æçæä½ï¼æ¯å¦ join/nested/parent-child æç´¢é½è¦å°½éé¿åï¼æ§è½é½å¾å·®çã\n\n\n# åé¡µæ§è½ä¼å\n\nes çåé¡µæ¯è¾åçï¼ä¸ºå¥å¢ï¼ä¸¾ä¸ªä¾å­å§ï¼åå¦ä½ æ¯é¡µæ¯ 10 æ¡æ°æ®ï¼ä½ ç°å¨è¦æ¥è¯¢ç¬¬ 100 é¡µï¼å®éä¸æ¯ä¼ææ¯ä¸ª shard ä¸å­å¨çå 1000 æ¡æ°æ®é½æ¥å°ä¸ä¸ªåè°èç¹ä¸ï¼å¦æä½ æä¸ª 5 ä¸ª shardï¼é£ä¹å°±æ 5000 æ¡æ°æ®ï¼æ¥çåè°èç¹å¯¹è¿ 5000 æ¡æ°æ®è¿è¡ä¸äºåå¹¶ãå¤çï¼åè·åå°æç»ç¬¬ 100 é¡µç 10 æ¡æ°æ®ã\n\nåå¸å¼çï¼ä½ è¦æ¥ç¬¬ 100 é¡µç 10 æ¡æ°æ®ï¼ä¸å¯è½è¯´ä» 5 ä¸ª shardï¼æ¯ä¸ª shard å°±æ¥ 2 æ¡æ°æ®ï¼æåå°åè°èç¹åå¹¶æ 10 æ¡æ°æ®å§ï¼ä½ å¿é¡»å¾ä»æ¯ä¸ª shard é½æ¥ 1000 æ¡æ°æ®è¿æ¥ï¼ç¶åæ ¹æ®ä½ çéæ±è¿è¡æåºãç­éç­ç­æä½ï¼æååæ¬¡åé¡µï¼æ¿å°éé¢ç¬¬ 100 é¡µçæ°æ®ãä½ ç¿»é¡µçæ¶åï¼ç¿»çè¶æ·±ï¼æ¯ä¸ª shard è¿åçæ°æ®å°±è¶å¤ï¼èä¸åè°èç¹å¤ççæ¶é´è¶é¿ï¼éå¸¸åç¹ãæä»¥ç¨ es ååé¡µçæ¶åï¼ä½ ä¼åç°è¶ç¿»å°åé¢ï¼å°±è¶æ¯æ¢ã\n\næä»¬ä¹åä¹æ¯éå°è¿è¿ä¸ªé®é¢ï¼ç¨ es ä½åé¡µï¼åå é¡µå°±å åæ¯«ç§ï¼ç¿»å° 10 é¡µæèå åé¡µçæ¶åï¼åºæ¬ä¸å°±è¦ 5~10 ç§æè½æ¥åºæ¥ä¸é¡µæ°æ®äºã\n\næä»ä¹è§£å³æ¹æ¡åï¼\n\n# ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼\n\nè·äº§åç»çè¯´ï¼ä½ ç³»ç»ä¸åè®¸ç¿»é£ä¹æ·±çé¡µï¼é»è®¤ç¿»çè¶æ·±ï¼æ§è½å°±è¶å·®ã\n\n# ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç\n\nç±»ä¼¼äºå¾®åä¸­ï¼ä¸æå·å¾®åï¼å·åºæ¥ä¸é¡µä¸é¡µçï¼ä½ å¯ä»¥ç¨ scroll api ï¼å³äºå¦ä½ä½¿ç¨ï¼èªè¡ä¸ç½æç´¢ã\n\nscroll ä¼ä¸æ¬¡æ§ç»ä½ çææææ°æ®çä¸ä¸ªå¿«ç§ï¼ç¶åæ¯æ¬¡æ»å¨ååç¿»é¡µå°±æ¯éè¿æ¸¸æ  scroll_id ç§»å¨ï¼è·åä¸ä¸é¡µä¸ä¸é¡µè¿æ ·å­ï¼æ§è½ä¼æ¯ä¸é¢è¯´çé£ç§åé¡µæ§è½è¦é«å¾å¤å¾å¤ï¼åºæ¬ä¸é½æ¯æ¯«ç§çº§çã\n\nä½æ¯ï¼å¯ä¸çä¸ç¹å°±æ¯ï¼è¿ä¸ªéåäºé£ç§ç±»ä¼¼å¾®åä¸æç¿»é¡µçï¼ä¸è½éæè·³å°ä»»ä½ä¸é¡µçåºæ¯ãä¹å°±æ¯è¯´ï¼ä½ ä¸è½åè¿å¥ç¬¬ 10 é¡µï¼ç¶åå»ç¬¬ 120 é¡µï¼ç¶åååå°ç¬¬ 58 é¡µï¼ä¸è½éæä¹±è·³é¡µãæä»¥ç°å¨å¾å¤äº§åï¼é½æ¯ä¸åè®¸ä½ éæç¿»é¡µçï¼appï¼ä¹æä¸äºç½ç«ï¼åçå°±æ¯ä½ åªè½å¾ä¸æï¼ä¸é¡µä¸é¡µçç¿»ã\n\nåå§åæ¶å¿é¡»æå® scroll åæ°ï¼åè¯ es è¦ä¿å­æ­¤æ¬¡æç´¢çä¸ä¸æå¤é¿æ¶é´ãä½ éè¦ç¡®ä¿ç¨æ·ä¸ä¼æç»­ä¸æ­ç¿»é¡µç¿»å ä¸ªå°æ¶ï¼å¦åå¯è½å ä¸ºè¶æ¶èå¤±è´¥ã\n\né¤äºç¨ scroll api ï¼ä½ ä¹å¯ä»¥ç¨ search_after æ¥åï¼ search_after çææ³æ¯ä½¿ç¨åä¸é¡µçç»ææ¥å¸®å©æ£ç´¢ä¸ä¸é¡µçæ°æ®ï¼æ¾ç¶ï¼è¿ç§æ¹å¼ä¹ä¸åè®¸ä½ éæç¿»é¡µï¼ä½ åªè½ä¸é¡µé¡µå¾åç¿»ãåå§åæ¶ï¼éè¦ä½¿ç¨ä¸ä¸ªå¯ä¸å¼çå­æ®µä½ä¸º sort å­æ®µã\n\n1.1ãè®¾è®¡é¶æ®µè°ä¼\n\nï¼1ï¼æ ¹æ®ä¸å¡å¢ééæ±ï¼éååºäºæ¥ææ¨¡æ¿åå»ºç´¢å¼ï¼éè¿ roll over API æ»å¨ç´¢å¼ï¼\n\nï¼2ï¼ä½¿ç¨å«åè¿è¡ç´¢å¼ç®¡çï¼\n\nï¼3ï¼æ¯å¤©åæ¨å®æ¶å¯¹ç´¢å¼å force_merge æä½ï¼ä»¥éæ¾ç©ºé´ï¼\n\nï¼4ï¼éåå·ç­åç¦»æºå¶ï¼ç­æ°æ®å­å¨å° SSDï¼æé«æ£ç´¢æçï¼å·æ°æ®å®æè¿è¡ shrink æä½ï¼ä»¥ç¼©åå­å¨ï¼\n\nï¼5ï¼éå curator è¿è¡ç´¢å¼ççå½å¨æç®¡çï¼\n\nï¼6ï¼ä»éå¯¹éè¦åè¯çå­æ®µï¼åççè®¾ç½®åè¯å¨ï¼\n\nï¼7ï¼Mapping é¶æ®µååç»ååä¸ªå­æ®µçå±æ§ï¼æ¯å¦éè¦æ£ç´¢ãæ¯å¦éè¦å­å¨ç­ãâ¦â¦..\n\n1.2ãåå¥è°ä¼\n\nï¼1ï¼åå¥åå¯æ¬æ°è®¾ç½®ä¸º 0ï¼\n\nï¼2ï¼åå¥åå³é­ refresh_interval è®¾ç½®ä¸º-1ï¼ç¦ç¨å·æ°æºå¶ï¼\n\nï¼3ï¼åå¥è¿ç¨ä¸­ï¼éå bulk æ¹éåå¥ï¼\n\nï¼4ï¼åå¥åæ¢å¤å¯æ¬æ°åå·æ°é´éï¼\n\nï¼5ï¼å°½éä½¿ç¨èªå¨çæç idã\n\n1.3ãæ¥è¯¢è°ä¼\n\nï¼1ï¼ç¦ç¨ wildcardï¼\n\nï¼2ï¼ç¦ç¨æ¹é termsï¼æç¾ä¸åçåºæ¯ï¼ï¼\n\nï¼3ï¼ååå©ç¨åæç´¢å¼æºå¶ï¼è½ keyword ç±»åå°½é keywordï¼\n\nï¼4ï¼æ°æ®éå¤§æ¶åï¼å¯ä»¥ååºäºæ¶é´æ²å®ç´¢å¼åæ£ç´¢ï¼\n\nï¼5ï¼è®¾ç½®åççè·¯ç±æºå¶ã\n\n1.4ãå¶ä»è°ä¼\n\né¨ç½²è°ä¼ï¼ä¸å¡è°ä¼ç­ã\n\nä¸é¢çæåä¸é¨åï¼é¢è¯èå°±åºæ¬å¯¹ä½ ä¹åçå®è·µæèè¿ç»´ç»éªææè¯ä¼°äºã\n\n\n# å·¥ä½åç\n\n\n# es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating node ï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica node ã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate node ã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate node ã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refresh ã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment file ï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment file ï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cache ï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cache ï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cache ä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ NRT ï¼å¨ç§° near real-time ãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java api ï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cache ä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment file ï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flush ãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flush ï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flush ãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment file ï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment file ï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit point ï¼æ è¯æææ°ç segment file ï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment file ã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ Java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ IDï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ ID çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\nDOCID   DOC\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook\n2       è°·æ­å°å¾ä¹ç¶å ç Facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç Facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook ä¸ Wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« Facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nWORDID   WORD       DOCIDS\n1        è°·æ­         1, 2, 3, 4, 5\n2        å°å¾         1, 2, 3, 4, 5\n3        ä¹ç¶         1, 2, 4, 5\n4        è·³æ§½         1, 4\n5        Facebook   1, 2, 3, 4, 5\n6        å ç         2, 3, 5\n7        åå§äºº        3\n8        ææ¯         3, 5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ Facebook ï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# elasticsearch çåæç´¢å¼æ¯ä»ä¹\n\né¢è¯å®ï¼æ³äºè§£ä½ å¯¹åºç¡æ¦å¿µçè®¤ç¥ã\n\nè§£ç­ï¼éä¿è§£éä¸ä¸å°±å¯ä»¥ã\n\nä¼ ç»çæä»¬çæ£ç´¢æ¯éè¿æç« ï¼éä¸ªéåæ¾å°å¯¹åºå³é®è¯çä½ç½®ã\n\nèåæç´¢å¼ï¼æ¯éè¿åè¯ç­ç¥ï¼å½¢æäºè¯åæç« çæ å°å³ç³»è¡¨ï¼è¿ç§è¯å¸+æ å°è¡¨å³ä¸ºåæç´¢å¼ãæäºåæç´¢å¼ï¼å°±è½å®ç° oï¼1ï¼æ¶é´å¤æåº¦çæçæ£ç´¢æç« äºï¼æå¤§çæé«äºæ£ç´¢æçã\n\n\n\nå­¦æ¯çè§£ç­æ¹å¼ï¼\n\nåæç´¢å¼ï¼ç¸åäºä¸ç¯æç« åå«äºåªäºè¯ï¼å®ä»è¯åºåï¼è®°è½½äºè¿ä¸ªè¯å¨åªäºææ¡£ä¸­åºç°è¿ï¼ç±ä¸¤é¨åç»æââè¯å¸ååæè¡¨ã\n\nå åé¡¹ï¼åæç´¢å¼çåºå±å®ç°æ¯åºäºï¼FSTï¼Finite State Transducerï¼æ°æ®ç»æã\n\nlucene ä» 4+çæ¬åå¼å§å¤§éä½¿ç¨çæ°æ®ç»ææ¯ FSTãFST æä¸¤ä¸ªä¼ç¹ï¼\n\nï¼1ï¼ç©ºé´å ç¨å°ãéè¿å¯¹è¯å¸ä¸­åè¯åç¼ååç¼çéå¤å©ç¨ï¼åç¼©äºå­å¨ç©ºé´ï¼\n\nï¼2ï¼æ¥è¯¢éåº¦å¿«ãO(len(str))çæ¥è¯¢æ¶é´å¤æåº¦ã\n\n\n# 3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²\n\né¢è¯å®ï¼æ³äºè§£å¤§æ°æ®éçè¿ç»´è½åã\n\nè§£ç­ï¼ç´¢å¼æ°æ®çè§åï¼åºå¨åæåå¥½è§åï¼æ­£æè°âè®¾è®¡åè¡ï¼ç¼ç å¨åâï¼è¿æ ·æè½ææçé¿åçªå¦å¶æ¥çæ°æ®æ¿å¢å¯¼è´éç¾¤å¤çè½åä¸è¶³å¼åççº¿ä¸å®¢æ·æ£ç´¢æèå¶ä»ä¸å¡åå°å½±åã\n\nå¦ä½è°ä¼ï¼æ­£å¦é®é¢ 1 æè¯´ï¼è¿éç»åä¸ä¸ï¼\n\n3.1 å¨æç´¢å¼å±é¢\n\nåºäºæ¨¡æ¿+æ¶é´+rollover api æ»å¨åå»ºç´¢å¼ï¼ä¸¾ä¾ï¼è®¾è®¡é¶æ®µå®ä¹ï¼blog ç´¢å¼çæ¨¡æ¿æ ¼å¼ä¸ºï¼blogindexæ¶é´æ³çå½¢å¼ï¼æ¯å¤©éå¢æ°æ®ãè¿æ ·åçå¥½å¤ï¼ä¸è³äºæ°æ®éæ¿å¢å¯¼è´åä¸ªç´¢å¼æ°æ®ééå¸¸å¤§ï¼æ¥è¿äºä¸çº¿ 2 ç 32 æ¬¡å¹-1ï¼ç´¢å¼å­å¨è¾¾å°äº TB+çè³æ´å¤§ã\n\nä¸æ¦åä¸ªç´¢å¼å¾å¤§ï¼å­å¨ç­åç§é£é©ä¹éä¹èæ¥ï¼æä»¥è¦æåèè+åæ©é¿åã\n\n3.2 å­å¨å±é¢\n\nå·ç­æ°æ®åç¦»å­å¨ï¼ç­æ°æ®ï¼æ¯å¦æè¿ 3 å¤©æèä¸å¨çæ°æ®ï¼ï¼å¶ä½ä¸ºå·æ°æ®ã\n\nå¯¹äºå·æ°æ®ä¸ä¼ååå¥æ°æ°æ®ï¼å¯ä»¥èèå®æ force_merge å  shrink åç¼©æä½ï¼èçå­å¨ç©ºé´åæ£ç´¢æçã\n\n3.3 é¨ç½²å±é¢\n\nä¸æ¦ä¹åæ²¡æè§åï¼è¿éå°±å±äºåºæ¥ç­ç¥ã\n\nç»å ES èªèº«çæ¯æå¨ææ©å±çç¹ç¹ï¼å¨ææ°å¢æºå¨çæ¹å¼å¯ä»¥ç¼è§£éç¾¤ååï¼æ³¨æï¼å¦æä¹åä¸»èç¹ç­è§ååçï¼ä¸éè¦éå¯éç¾¤ä¹è½å®æå¨ææ°å¢çã\n\n\n# 4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç\n\né¢è¯å®ï¼æ³äºè§£ ES éç¾¤çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nåç½®åæï¼\n\nï¼1ï¼åªæåéä¸»èç¹ï¼masterï¼trueï¼çèç¹æè½æä¸ºä¸»èç¹ã\n\nï¼2ï¼æå°ä¸»èç¹æ°ï¼min_master_nodesï¼çç®çæ¯é²æ­¢èè£ã\n\næ ¸å¯¹äºä¸ä¸ä»£ç ï¼æ ¸å¿å¥å£ä¸º findMasterï¼éæ©ä¸»èç¹æåè¿åå¯¹åº Masterï¼å¦åè¿å nullãéä¸¾æµç¨å¤§è´æè¿°å¦ä¸ï¼\n\nç¬¬ä¸æ­¥ï¼ç¡®è®¤åéä¸»èç¹æ°è¾¾æ ï¼elasticsearch.yml è®¾ç½®çå¼\n\ndiscovery.zen.minimum_master_nodesï¼\n\nç¬¬äºæ­¥ï¼æ¯è¾ï¼åå¤å®æ¯å¦å·å¤ master èµæ ¼ï¼å·å¤åéä¸»èç¹èµæ ¼çä¼åè¿åï¼\n\nè¥ä¸¤èç¹é½ä¸ºåéä¸»èç¹ï¼å id å°çå¼ä¼ä¸»èç¹ãæ³¨æè¿éç id ä¸º string ç±»åã\n\né¢å¤è¯ï¼è·åèç¹ id çæ¹æ³ã\n\n1GET /_cat/nodes?v&amp;h=ip,port,heapPercent,heapMax,id,name\n\n2ip port heapPercent heapMax id name\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨\n\né¢è¯å®ï¼æ³äºè§£ ES çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nè¿éçç´¢å¼ææ¡£åºè¯¥çè§£ä¸ºææ¡£åå¥ ESï¼åå»ºç´¢å¼çè¿ç¨ã\n\nææ¡£åå¥åå«ï¼åææ¡£åå¥åæ¹é bulk åå¥ï¼è¿éåªè§£éä¸ä¸ï¼åææ¡£åå¥æµç¨ã\n\nè®°ä½å®æ¹ææ¡£ä¸­çè¿ä¸ªå¾ã\n\n\n\nç¬¬ä¸æ­¥ï¼å®¢æ·åéç¾¤æèç¹åå¥æ°æ®ï¼åéè¯·æ±ãï¼å¦ææ²¡ææå®è·¯ç±/åè°èç¹ï¼è¯·æ±çèç¹æ®æ¼è·¯ç±èç¹çè§è²ãï¼\n\nç¬¬äºæ­¥ï¼èç¹ 1 æ¥åå°è¯·æ±åï¼ä½¿ç¨ææ¡£_id æ¥ç¡®å®ææ¡£å±äºåç 0ãè¯·æ±ä¼è¢«è½¬å°å¦å¤çèç¹ï¼åå®èç¹ 3ãå æ­¤åç 0 çä¸»åçåéå°èç¹ 3 ä¸ã\n\nç¬¬ä¸æ­¥ï¼èç¹ 3 å¨ä¸»åçä¸æ§è¡åæä½ï¼å¦ææåï¼åå°è¯·æ±å¹¶è¡è½¬åå°èç¹ 1 åèç¹ 2 çå¯æ¬åçä¸ï¼ç­å¾ç»æè¿åãææçå¯æ¬åçé½æ¥åæåï¼èç¹ 3 å°ååè°èç¹ï¼èç¹ 1ï¼æ¥åæåï¼èç¹ 1 åè¯·æ±å®¢æ·ç«¯æ¥ååå¥æåã\n\nå¦æé¢è¯å®åé®ï¼ç¬¬äºæ­¥ä¸­çææ¡£è·ååççè¿ç¨ï¼\n\nåç­ï¼åå©è·¯ç±ç®æ³è·åï¼è·¯ç±ç®æ³å°±æ¯æ ¹æ®è·¯ç±åææ¡£ id è®¡ç®ç®æ çåç id çè¿ç¨ã\n\n1shard = hash(_routing) % (num_of_primary_shards)\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ï¼\n\né¢è¯å®ï¼æ³äºè§£ ES æç´¢çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\næç´¢æè§£ä¸ºâquery then fetchâ ä¸¤ä¸ªé¶æ®µã\n\nquery é¶æ®µçç®çï¼å®ä½å°ä½ç½®ï¼ä½ä¸åã\n\næ­¥éª¤æè§£å¦ä¸ï¼\n\nï¼1ï¼åè®¾ä¸ä¸ªç´¢å¼æ°æ®æ 5 ä¸»+1 å¯æ¬ å± 10 åçï¼ä¸æ¬¡è¯·æ±ä¼å½ä¸­ï¼ä¸»æèå¯æ¬åçä¸­ï¼çä¸ä¸ªã\n\nï¼2ï¼æ¯ä¸ªåçå¨æ¬å°è¿è¡æ¥è¯¢ï¼ç»æè¿åå°æ¬å°æåºçä¼åéåä¸­ã\n\nï¼3ï¼ç¬¬ 2ï¼æ­¥éª¤çç»æåéå°åè°èç¹ï¼åè°èç¹äº§çä¸ä¸ªå¨å±çæåºåè¡¨ã\n\nfetch é¶æ®µçç®çï¼åæ°æ®ã\n\nè·¯ç±èç¹è·åææææ¡£ï¼è¿åç»å®¢æ·ç«¯ã\n\n\n# Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³\n\né¢è¯å®ï¼æ³äºè§£å¯¹ ES éç¾¤çè¿ç»´è½åã\n\nè§£ç­ï¼\n\nï¼1ï¼å³é­ç¼å­ swap;\n\nï¼2ï¼å åå­è®¾ç½®ä¸ºï¼Minï¼èç¹åå­/2, 32GBï¼;\n\nï¼3ï¼è®¾ç½®æå¤§æä»¶å¥ææ°ï¼\n\nï¼4ï¼çº¿ç¨æ± +éåå¤§å°æ ¹æ®ä¸å¡éè¦åè°æ´ï¼\n\nï¼5ï¼ç£çå­å¨ raid æ¹å¼ââå­å¨ææ¡ä»¶ä½¿ç¨ RAID10ï¼å¢å åèç¹æ§è½ä»¥åé¿ååèç¹å­å¨æéã\n\n\n# lucence åé¨ç»ææ¯ä»ä¹ï¼\n\né¢è¯å®ï¼æ³äºè§£ä½ çç¥è¯é¢çå¹¿åº¦åæ·±åº¦ã\n\nè§£ç­ï¼\n\n\n\nLucene æ¯æç´¢å¼åæç´¢çä¸¤ä¸ªè¿ç¨ï¼åå«ç´¢å¼åå»ºï¼ç´¢å¼ï¼æç´¢ä¸ä¸ªè¦ç¹ãå¯ä»¥åºäºè¿ä¸ªèç»å±å¼ä¸äºã\n\n\n# Elasticsearch æ¯å¦ä½å®ç° Master éä¸¾çï¼\n\nï¼1ï¼Elasticsearch çéä¸»æ¯ ZenDiscovery æ¨¡åè´è´£çï¼ä¸»è¦åå« Pingï¼èç¹ä¹é´éè¿è¿ä¸ª RPC æ¥åç°å½¼æ­¤ï¼å Unicastï¼åæ­æ¨¡ååå«ä¸ä¸ªä¸»æºåè¡¨ä»¥æ§å¶åªäºèç¹éè¦ ping éï¼è¿ä¸¤é¨åï¼\n\nï¼2ï¼å¯¹ææå¯ä»¥æä¸º master çèç¹ï¼node.master: trueï¼æ ¹æ® nodeId å­å¸æåºï¼æ¯æ¬¡éä¸¾æ¯ä¸ªèç¹é½æèªå·±æç¥éèç¹æä¸æ¬¡åºï¼ç¶åéåºç¬¬ä¸ä¸ªï¼ç¬¬ 0 ä½ï¼èç¹ï¼æä¸è®¤ä¸ºå®æ¯ master èç¹ã\n\nï¼3ï¼å¦æå¯¹æä¸ªèç¹çæç¥¨æ°è¾¾å°ä¸å®çå¼ï¼å¯ä»¥æä¸º master èç¹æ° n/2+1ï¼å¹¶ä¸è¯¥èç¹èªå·±ä¹éä¸¾èªå·±ï¼é£è¿ä¸ªèç¹å°±æ¯ masterãå¦åéæ°éä¸¾ä¸ç´å°æ»¡è¶³ä¸è¿°æ¡ä»¶ã\n\nï¼4ï¼è¡¥åï¼master èç¹çèè´£ä¸»è¦åæ¬éç¾¤ãèç¹åç´¢å¼çç®¡çï¼ä¸è´è´£ææ¡£çº§å«çç®¡çï¼data èç¹å¯ä»¥å³é­ http åè½*ã\n\n\n# 10ãElasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª\n\néäºä¸ä¸ª masterï¼å¦å¤ 10 ä¸ªéäºå¦ä¸ä¸ª masterï¼æä¹åï¼\n\nï¼1ï¼å½éç¾¤ master åéæ°éä¸å°äº 3 ä¸ªæ¶ï¼å¯ä»¥éè¿è®¾ç½®æå°æç¥¨éè¿æ°éï¼discovery.zen.minimum_master_nodesï¼è¶è¿ææåéèç¹ä¸åä»¥ä¸æ¥è§£å³èè£é®é¢ï¼\n\nï¼3ï¼å½åéæ°éä¸ºä¸¤ä¸ªæ¶ï¼åªè½ä¿®æ¹ä¸ºå¯ä¸çä¸ä¸ª master åéï¼å¶ä»ä½ä¸º data èç¹ï¼é¿åèè£é®é¢ã\n\n\n# å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼\n\nTransportClient å©ç¨ transport æ¨¡åè¿ç¨è¿æ¥ä¸ä¸ª elasticsearch éç¾¤ãå®å¹¶ä¸å å¥å°éç¾¤ä¸­ï¼åªæ¯ç®åçè·å¾ä¸ä¸ªæèå¤ä¸ªåå§åç transport å°åï¼å¹¶ä»¥ è½®è¯¢ çæ¹å¼ä¸è¿äºå°åè¿è¡éä¿¡ã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã\n\nåè°èç¹é»è®¤ä½¿ç¨ææ¡£ ID åä¸è®¡ç®ï¼ä¹æ¯æéè¿ routingï¼ï¼ä»¥ä¾¿ä¸ºè·¯ç±æä¾åéçåçã\n\nshard = hash(document_id) % (num_of_primary_shards)\n\n\nï¼1ï¼å½åçæå¨çèç¹æ¥æ¶å°æ¥èªåè°èç¹çè¯·æ±åï¼ä¼å°è¯·æ±åå¥å° MemoryBufferï¼ç¶åå®æ¶ï¼é»è®¤æ¯æ¯é 1 ç§ï¼åå¥å° Filesystem Cacheï¼è¿ä¸ªä» MomeryBuffer å° Filesystem Cache çè¿ç¨å°±å«å refreshï¼\n\nï¼2ï¼å½ç¶å¨æäºæåµä¸ï¼å­å¨ Momery Buffer å Filesystem Cache çæ°æ®å¯è½ä¼ä¸¢å¤±ï¼ES æ¯éè¿ translog çæºå¶æ¥ä¿è¯æ°æ®çå¯é æ§çãå¶å®ç°æºå¶æ¯æ¥æ¶å°è¯·æ±åï¼åæ¶ä¹ä¼åå¥å° translog ä¸­ ï¼å½ Filesystem cache ä¸­çæ°æ®åå¥å°ç£çä¸­æ¶ï¼æä¼æ¸é¤æï¼è¿ä¸ªè¿ç¨å«å flushï¼\n\nï¼3ï¼å¨ flush è¿ç¨ä¸­ï¼åå­ä¸­çç¼å²å°è¢«æ¸é¤ï¼åå®¹è¢«åå¥ä¸ä¸ªæ°æ®µï¼æ®µç fsync å°åå»ºä¸ä¸ªæ°çæäº¤ç¹ï¼å¹¶å°åå®¹å·æ°å°ç£çï¼æ§ç translog å°è¢«å é¤å¹¶å¼å§ä¸ä¸ªæ°ç translogã\n\nï¼4ï¼flush è§¦åçæ¶æºæ¯å®æ¶è§¦åï¼é»è®¤ 30 åéï¼æè translog åå¾å¤ªå¤§ï¼é»è®¤ä¸º 512Mï¼æ¶ï¼\n\n\n\nè¡¥åï¼å³äº Lucene ç Segementï¼\n\nï¼1ï¼Lucene ç´¢å¼æ¯ç±å¤ä¸ªæ®µç»æï¼æ®µæ¬èº«æ¯ä¸ä¸ªåè½é½å¨çåæç´¢å¼ã\n\nï¼2ï¼æ®µæ¯ä¸å¯åçï¼åè®¸ Lucene å°æ°çææ¡£å¢éå°æ·»å å°ç´¢å¼ä¸­ï¼èä¸ç¨ä»å¤´éå»ºç´¢å¼ã\n\nï¼3ï¼å¯¹äºæ¯ä¸ä¸ªæç´¢è¯·æ±èè¨ï¼ç´¢å¼ä¸­çæææ®µé½ä¼è¢«æç´¢ï¼å¹¶ä¸æ¯ä¸ªæ®µä¼æ¶è CPU çæ¶éå¨ãæä»¶å¥æååå­ãè¿æå³çæ®µçæ°éè¶å¤ï¼æç´¢æ§è½ä¼è¶ä½ã\n\nï¼4ï¼ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼Elasticsearch ä¼åå¹¶å°æ®µå°ä¸ä¸ªè¾å¤§çæ®µï¼æäº¤æ°çåå¹¶æ®µå°ç£çï¼å¹¶å é¤é£äºæ§çå°æ®µã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã\n\nï¼1ï¼å é¤åæ´æ°ä¹é½æ¯åæä½ï¼ä½æ¯ Elasticsearch ä¸­çææ¡£æ¯ä¸å¯åçï¼å æ­¤ä¸è½è¢«å é¤æèæ¹å¨ä»¥å±ç¤ºå¶åæ´ï¼\n\nï¼2ï¼ç£çä¸çæ¯ä¸ªæ®µé½æä¸ä¸ªç¸åºç.del æä»¶ãå½å é¤è¯·æ±åéåï¼ææ¡£å¹¶æ²¡æççè¢«å é¤ï¼èæ¯å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ãè¯¥ææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æãå½æ®µåå¹¶æ¶ï¼å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤çææ¡£å°ä¸ä¼è¢«åå¥æ°æ®µã\n\nï¼3ï¼å¨æ°çææ¡£è¢«åå»ºæ¶ï¼Elasticsearch ä¼ä¸ºè¯¥ææ¡£æå®ä¸ä¸ªçæ¬å·ï¼å½æ§è¡æ´æ°æ¶ï¼æ§çæ¬çææ¡£å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ï¼æ°çæ¬çææ¡£è¢«ç´¢å¼å°ä¸ä¸ªæ°æ®µãæ§çæ¬çææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ Elasticsearch æç´¢çè¿ç¨ã\n\nï¼1ï¼æç´¢è¢«æ§è¡æä¸ä¸ªä¸¤é¶æ®µè¿ç¨ï¼æä»¬ç§°ä¹ä¸º Query Then Fetchï¼\n\nï¼2ï¼å¨åå§æ¥è¯¢é¶æ®µæ¶ï¼æ¥è¯¢ä¼å¹¿æ­å°ç´¢å¼ä¸­æ¯ä¸ä¸ªåçæ·è´ï¼ä¸»åçæèå¯æ¬åçï¼ã æ¯ä¸ªåçå¨æ¬å°æ§è¡æç´¢å¹¶æå»ºä¸ä¸ªå¹éææ¡£çå¤§å°ä¸º from + size çä¼åéåã\n\nPSï¼å¨æç´¢çæ¶åæ¯ä¼æ¥è¯¢ Filesystem Cache çï¼ä½æ¯æé¨åæ°æ®è¿å¨ MemoryBufferï¼æä»¥æç´¢æ¯è¿å®æ¶çã\n\nï¼3ï¼æ¯ä¸ªåçè¿ååèªä¼åéåä¸­ ææææ¡£ç ID åæåºå¼ ç»åè°èç¹ï¼å®åå¹¶è¿äºå¼å°èªå·±çä¼åéåä¸­æ¥äº§çä¸ä¸ªå¨å±æåºåçç»æåè¡¨ã\n\nï¼4ï¼æ¥ä¸æ¥å°±æ¯ ååé¶æ®µï¼åè°èç¹è¾¨å«åºåªäºææ¡£éè¦è¢«ååå¹¶åç¸å³çåçæäº¤å¤ä¸ª GET è¯·æ±ãæ¯ä¸ªåçå è½½å¹¶ ä¸° å¯ ææ¡£ï¼å¦ææéè¦çè¯ï¼æ¥çè¿åææ¡£ç»åè°èç¹ãä¸æ¦ææçææ¡£é½è¢«ååäºï¼åè°èç¹è¿åç»æç»å®¢æ·ç«¯ã\n\nï¼5ï¼è¡¥åï¼Query Then Fetch çæç´¢ç±»åå¨ææ¡£ç¸å³æ§æåçæ¶ååèçæ¯æ¬åççæ°æ®ï¼è¿æ ·å¨ææ¡£æ°éè¾å°çæ¶åå¯è½ä¸å¤åç¡®ï¼DFS Query Then Fetch å¢å äºä¸ä¸ªé¢æ¥è¯¢çå¤çï¼è¯¢é® Term å Document frequencyï¼è¿ä¸ªè¯åæ´åç¡®ï¼ä½æ¯æ§è½ä¼åå·®ã*\n\n\n\n\n# å¨ Elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼\n\nï¼1ï¼Lucene çç´¢å¼è¿ç¨ï¼å°±æ¯æç§å¨ææ£ç´¢çåºæ¬è¿ç¨ï¼å°åæè¡¨åææ­¤æä»¶æ ¼å¼çè¿ç¨ã\n\nï¼2ï¼Lucene çæç´¢è¿ç¨ï¼å°±æ¯æç§æ­¤æä»¶æ ¼å¼å°ç´¢å¼è¿å»çä¿¡æ¯è¯»åºæ¥ï¼ç¶åè®¡ç®æ¯ç¯ææ¡£æå(score)çè¿ç¨ã\n\n\n# Elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ Linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼\n\nï¼1ï¼64 GB åå­çæºå¨æ¯éå¸¸çæ³çï¼ ä½æ¯ 32 GB å 16 GB æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 GB ä¼éå¾å¶åã\n\nï¼2ï¼å¦æä½ è¦å¨æ´å¿«ç CPUs åæ´å¤çæ ¸å¿ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸å¿æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\nï¼3ï¼å¦æä½ è´æå¾èµ· SSDï¼å®å°è¿è¿è¶åºä»»ä½æè½¬ä»è´¨ã åºäº SSD çèç¹ï¼æ¥è¯¢åç´¢å¼æ§è½é½ææåãå¦æä½ è´æå¾èµ·ï¼SSD æ¯ä¸ä¸ªå¥½çéæ©ã\n\nï¼4ï¼å³ä½¿æ°æ®ä¸­å¿ä»¬è¿å¨å«å°ºï¼ä¹è¦é¿åéç¾¤è·¨è¶å¤ä¸ªæ°æ®ä¸­å¿ãç»å¯¹è¦é¿åéç¾¤è·¨è¶å¤§çå°çè·ç¦»ã\n\nï¼5ï¼è¯·ç¡®ä¿è¿è¡ä½ åºç¨ç¨åºç JVM åæå¡å¨ç JVM æ¯å®å¨ä¸æ ·çã å¨ Elasticsearch çå ä¸ªå°æ¹ï¼ä½¿ç¨ Java çæ¬å°åºååã\n\nï¼6ï¼éè¿è®¾ç½® gateway.recover_after_nodesãgateway.expected_nodesãgateway.recover_after_time å¯ä»¥å¨éç¾¤éå¯çæ¶åé¿åè¿å¤çåçäº¤æ¢ï¼è¿å¯è½ä¼è®©æ°æ®æ¢å¤ä»æ°ä¸ªå°æ¶ç¼©ç­ä¸ºå ç§éã\n\nï¼7ï¼Elasticsearch é»è®¤è¢«éç½®ä¸ºä½¿ç¨åæ­åç°ï¼ä»¥é²æ­¢èç¹æ æä¸­å å¥éç¾¤ãåªæå¨åä¸å°æºå¨ä¸è¿è¡çèç¹æä¼èªå¨ç»æéç¾¤ãæå¥½ä½¿ç¨åæ­ä»£æ¿ç»æ­ã\n\nï¼8ï¼ä¸è¦éæä¿®æ¹åå¾åæ¶å¨ï¼CMSï¼ååä¸ªçº¿ç¨æ± çå¤§å°ã\n\nï¼9ï¼æä½ çåå­çï¼å°äºï¼ä¸åç» Luceneï¼ä½ä¸è¦è¶è¿ 32 GBï¼ï¼ï¼éè¿ ES_HEAP_SIZE ç¯å¢åéè®¾ç½®ã\n\nï¼10ï¼åå­äº¤æ¢å°ç£çå¯¹æå¡å¨æ§è½æ¥è¯´æ¯è´å½çãå¦æåå­äº¤æ¢å°ç£çä¸ï¼ä¸ä¸ª 100 å¾®ç§çæä½å¯è½åæ 10 æ¯«ç§ã åæ³æ³é£ä¹å¤ 10 å¾®ç§çæä½æ¶å»¶ç´¯å èµ·æ¥ã ä¸é¾çåº swapping å¯¹äºæ§è½æ¯å¤ä¹å¯æã\n\nï¼11ï¼Lucene ä½¿ç¨äºå¤§ é çæä»¶ãåæ¶ï¼Elasticsearch å¨èç¹å HTTP å®¢æ·ç«¯ä¹é´è¿è¡éä¿¡ä¹ä½¿ç¨äºå¤§éçå¥æ¥å­ã ææè¿ä¸åé½éè¦è¶³å¤çæä»¶æè¿°ç¬¦ãä½ åºè¯¥å¢å ä½ çæä»¶æè¿°ç¬¦ï¼è®¾ç½®ä¸ä¸ªå¾å¤§çå¼ï¼å¦ 64,000ã\n\nè¡¥åï¼ç´¢å¼é¶æ®µæ§è½æåæ¹æ³\n\nï¼1ï¼ä½¿ç¨æ¹éè¯·æ±å¹¶è°æ´å¶å¤§å°ï¼æ¯æ¬¡æ¹éæ°æ® 5â15 MB å¤§æ¯ä¸ªä¸éçèµ·å§ç¹ã\n\nï¼2ï¼å­å¨ï¼ä½¿ç¨ SSD\n\nï¼3ï¼æ®µååå¹¶ï¼Elasticsearch é»è®¤å¼æ¯ 20 MB/sï¼å¯¹æºæ¢°ç£çåºè¯¥æ¯ä¸ªä¸éçè®¾ç½®ãå¦æä½ ç¨çæ¯ SSDï¼å¯ä»¥èèæé«å° 100â200 MB/sãå¦æä½ å¨åæ¹éå¯¼å¥ï¼å®å¨ä¸å¨ææç´¢ï¼ä½ å¯ä»¥å½»åºå³æåå¹¶éæµãå¦å¤è¿å¯ä»¥å¢å  index.translog.flush_threshold_size è®¾ç½®ï¼ä»é»è®¤ç 512 MB å°æ´å¤§ä¸äºçå¼ï¼æ¯å¦ 1 GBï¼è¿å¯ä»¥å¨ä¸æ¬¡æ¸ç©ºè§¦åçæ¶åå¨äºå¡æ¥å¿éç§¯ç´¯åºæ´å¤§çæ®µã\n\nï¼4ï¼å¦æä½ çæç´¢ç»æä¸éè¦è¿å®æ¶çåç¡®åº¦ï¼èèææ¯ä¸ªç´¢å¼ç index.refresh_interval æ¹å° 30sã\n\nï¼5ï¼å¦æä½ å¨åå¤§æ¹éå¯¼å¥ï¼èèéè¿è®¾ç½® index.number_of_replicas: 0 å³é­å¯æ¬ã\n\n\n# å¯¹äº GC æ¹é¢ï¼å¨ä½¿ç¨ Elasticsearch æ¶è¦æ³¨æä»ä¹ï¼\n\nï¼1ï¼åæè¯å¸çç´¢å¼éè¦å¸¸é©»åå­ï¼æ æ³ GCï¼éè¦çæ§ data node ä¸ segmentmemory å¢é¿è¶å¿ã\n\nï¼2ï¼åç±»ç¼å­ï¼field cache, filter cache, indexing cache, bulk queue ç­ç­ï¼è¦è®¾ç½®åççå¤§å°ï¼å¹¶ä¸è¦åºè¯¥æ ¹æ®æåçæåµæ¥ç heap æ¯å¦å¤ç¨ï¼ä¹å°±æ¯åç±»ç¼å­å¨é¨å æ»¡çæ¶åï¼è¿æ heap ç©ºé´å¯ä»¥åéç»å¶ä»ä»»å¡åï¼é¿åéç¨ clear cache ç­âèªæ¬ºæ¬ºäººâçæ¹å¼æ¥éæ¾åå­ã\n\nï¼3ï¼é¿åè¿åå¤§éç»æéçæç´¢ä¸èåãç¡®å®éè¦å¤§éæåæ°æ®çåºæ¯ï¼å¯ä»¥éç¨ scan & scroll api æ¥å®ç°ã\n\nï¼4ï¼cluster stats é©»çåå­å¹¶æ æ³æ°´å¹³æ©å±ï¼è¶å¤§è§æ¨¡éç¾¤å¯ä»¥èèåææå¤ä¸ªéç¾¤éè¿ tribe node è¿æ¥ã\n\nï¼5ï¼æ³ç¥é heap å¤ä¸å¤ï¼å¿é¡»ç»åå®éåºç¨åºæ¯ï¼å¹¶å¯¹éç¾¤ç heap ä½¿ç¨æåµåæç»­ççæ§ã\n\nï¼6ï¼æ ¹æ®çæ§æ°æ®çè§£åå­éæ±ï¼åçéç½®åç±» circuit breakerï¼å°åå­æº¢åºé£é©éä½å°æä½\n\n\n# 18ãElasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼\n\nElasticsearch æä¾çé¦ä¸ªè¿ä¼¼èåæ¯ cardinality åº¦éãå®æä¾ä¸ä¸ªå­æ®µçåºæ°ï¼å³è¯¥å­æ®µç distinct æè unique å¼çæ°ç®ãå®æ¯åºäº HLL ç®æ³çãHLL ä¼åå¯¹æä»¬çè¾å¥ä½åå¸è¿ç®ï¼ç¶åæ ¹æ®åå¸è¿ç®çç»æä¸­ç bits åæ¦çä¼°ç®ä»èå¾å°åºæ°ãå¶ç¹ç¹æ¯ï¼å¯éç½®çç²¾åº¦ï¼ç¨æ¥æ§å¶åå­çä½¿ç¨ï¼æ´ç²¾ç¡® ï¼ æ´å¤åå­ï¼ï¼å°çæ°æ®éç²¾åº¦æ¯éå¸¸é«çï¼æä»¬å¯ä»¥éè¿éç½®åæ°ï¼æ¥è®¾ç½®å»ééè¦çåºå®åå­ä½¿ç¨éãæ è®ºæ°åè¿æ¯æ°åäº¿çå¯ä¸å¼ï¼åå­ä½¿ç¨éåªä¸ä½ éç½®çç²¾ç¡®åº¦ç¸å³ã\n\n\n# 19ãå¨å¹¶åæåµä¸ï¼Elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼\n\nï¼1ï¼å¯ä»¥éè¿çæ¬å·ä½¿ç¨ä¹è§å¹¶åæ§å¶ï¼ä»¥ç¡®ä¿æ°çæ¬ä¸ä¼è¢«æ§çæ¬è¦çï¼ç±åºç¨å±æ¥å¤çå·ä½çå²çªï¼\n\nï¼2ï¼å¦å¤å¯¹äºåæä½ï¼ä¸è´æ§çº§å«æ¯æ quorum/one/allï¼é»è®¤ä¸º quorumï¼å³åªæå½å¤§å¤æ°åçå¯ç¨æ¶æåè®¸åæä½ãä½å³ä½¿å¤§å¤æ°å¯ç¨ï¼ä¹å¯è½å­å¨å ä¸ºç½ç»ç­åå å¯¼è´åå¥å¯æ¬å¤±è´¥ï¼è¿æ ·è¯¥å¯æ¬è¢«è®¤ä¸ºæéï¼åçå°ä¼å¨ä¸ä¸ªä¸åçèç¹ä¸éå»ºã\n\nï¼3ï¼å¯¹äºè¯»æä½ï¼å¯ä»¥è®¾ç½® replication ä¸º sync(é»è®¤)ï¼è¿ä½¿å¾æä½å¨ä¸»åçåå¯æ¬åçé½å®æåæä¼è¿åï¼å¦æè®¾ç½® replication ä¸º async æ¶ï¼ä¹å¯ä»¥éè¿è®¾ç½®æç´¢è¯·æ±åæ°_preference ä¸º primary æ¥æ¥è¯¢ä¸»åçï¼ç¡®ä¿ææ¡£æ¯ææ°çæ¬ã\n\n\n# 20ãå¦ä½çæ§ Elasticsearch éç¾¤ç¶æï¼\n\nMarvel è®©ä½ å¯ä»¥å¾ç®åçéè¿ Kibana çæ§ Elasticsearchãä½ å¯ä»¥å®æ¶æ¥çä½ çéç¾¤å¥åº·ç¶æåæ§è½ï¼ä¹å¯ä»¥åæè¿å»çéç¾¤ãç´¢å¼åèç¹ææ ã\n\n\n# 21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã\n\n\n\n\n# ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼\n\nåºäº word2vec å Elasticsearch å®ç°ä¸ªæ§åæç´¢\n\nï¼1ï¼åºäº word2vecãElasticsearch åèªå®ä¹çèæ¬æä»¶ï¼æä»¬å°±å®ç°äºä¸ä¸ªä¸ªæ§åçæç´¢æå¡ï¼ç¸å¯¹äºåæçå®ç°ï¼æ°ççç¹å»çåè½¬åçé½æå¤§å¹çæåï¼\n\nï¼2ï¼åºäº word2vec çåååéè¿æä¸ä¸ªå¯ç¨ä¹å¤ï¼å°±æ¯å¯ä»¥ç¨æ¥å®ç°ç¸ä¼¼ååçæ¨èï¼\n\nï¼3ï¼ä½¿ç¨ word2vec æ¥å®ç°ä¸ªæ§åæç´¢æä¸ªæ§åæ¨èæ¯æä¸å®å±éæ§çï¼å ä¸ºå®åªè½å¤çç¨æ·ç¹å»åå²è¿æ ·çæ¶åºæ°æ®ï¼èæ æ³å¨é¢çå»èèç¨æ·åå¥½ï¼è¿ä¸ªè¿æ¯æå¾å¤§çæ¹è¿åæåçç©ºé´ï¼\n\n\n# æ¯å¦äºè§£å­å¸æ ï¼\n\nå¸¸ç¨å­å¸æ°æ®ç»æå¦ä¸æç¤ºï¼\n\n\n\nTrie çæ ¸å¿ææ³æ¯ç©ºé´æ¢æ¶é´ï¼å©ç¨å­ç¬¦ä¸²çå¬å±åç¼æ¥éä½æ¥è¯¢æ¶é´çå¼éä»¥è¾¾å°æé«æççç®çãå®æ 3 ä¸ªåºæ¬æ§è´¨ï¼\n\n1ï¼æ ¹èç¹ä¸åå«å­ç¬¦ï¼é¤æ ¹èç¹å¤æ¯ä¸ä¸ªèç¹é½åªåå«ä¸ä¸ªå­ç¬¦ã\n\n2ï¼ä»æ ¹èç¹å°æä¸èç¹ï¼è·¯å¾ä¸ç»è¿çå­ç¬¦è¿æ¥èµ·æ¥ï¼ä¸ºè¯¥èç¹å¯¹åºçå­ç¬¦ä¸²ã\n\n3ï¼æ¯ä¸ªèç¹çææå­èç¹åå«çå­ç¬¦é½ä¸ç¸åã\n\n\n\nï¼1ï¼å¯ä»¥çå°ï¼trie æ æ¯ä¸å±çèç¹æ°æ¯ 26^i çº§å«çãæä»¥ä¸ºäºèçç©ºé´ï¼æä»¬è¿å¯ä»¥ç¨å¨æé¾è¡¨ï¼æèç¨æ°ç»æ¥æ¨¡æå¨æãèç©ºé´çè±è´¹ï¼ä¸ä¼è¶è¿åè¯æ° Ã åè¯é¿åº¦ã\n\nï¼2ï¼å®ç°ï¼å¯¹æ¯ä¸ªç»ç¹å¼ä¸ä¸ªå­æ¯éå¤§å°çæ°ç»ï¼æ¯ä¸ªç»ç¹æä¸ä¸ªé¾è¡¨ï¼ä½¿ç¨å·¦å¿å­å³åå¼è¡¨ç¤ºæ³è®°å½è¿æ£µæ ï¼\n\nï¼3ï¼å¯¹äºä¸­æçå­å¸æ ï¼æ¯ä¸ªèç¹çå­èç¹ç¨ä¸ä¸ªåå¸è¡¨å­å¨ï¼è¿æ ·å°±ä¸ç¨æµªè´¹å¤ªå¤§çç©ºé´ï¼èä¸æ¥è¯¢éåº¦ä¸å¯ä»¥ä¿çåå¸çå¤æåº¦ O(1)ã\n\n\n# æ¼åçº éæ¯å¦ä½å®ç°çï¼\n\nï¼1ï¼æ¼åçº éæ¯åºäºç¼è¾è·ç¦»æ¥å®ç°ï¼ç¼è¾è·ç¦»æ¯ä¸ç§æ åçæ¹æ³ï¼å®ç¨æ¥è¡¨ç¤ºç»è¿æå¥ãå é¤åæ¿æ¢æä½ä»ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢å°å¦å¤ä¸ä¸ªå­ç¬¦ä¸²çæå°æä½æ­¥æ°ï¼\n\nï¼2ï¼ç¼è¾è·ç¦»çè®¡ç®è¿ç¨ï¼æ¯å¦è¦è®¡ç® batyu å beauty çç¼è¾è·ç¦»ï¼ååå»ºä¸ä¸ª 7Ã8 çè¡¨ï¼batyu é¿åº¦ä¸º 5ï¼coffee é¿åº¦ä¸º 6ï¼åå  2ï¼ï¼æ¥çï¼å¨å¦ä¸ä½ç½®å¡«å¥é»è²æ°å­ãå¶ä»æ ¼çè®¡ç®è¿ç¨æ¯åä»¥ä¸ä¸ä¸ªå¼çæå°å¼ï¼\n\nå¦ææä¸æ¹çå­ç¬¦ç­äºæå·¦æ¹çå­ç¬¦ï¼åä¸ºå·¦ä¸æ¹çæ°å­ãå¦åä¸ºå·¦ä¸æ¹çæ°å­+1ãï¼å¯¹äº 3,3 æ¥è¯´ä¸º 0ï¼\n\nå·¦æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\nä¸æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\næç»åå³ä¸è§çå¼å³ä¸ºç¼è¾è·ç¦»çå¼ 3ã\n\n\n\nå¯¹äºæ¼åçº éï¼æä»¬èèæé ä¸ä¸ªåº¦éç©ºé´ï¼Metric Spaceï¼ï¼è¯¥ç©ºé´åä»»ä½å³ç³»æ»¡è¶³ä»¥ä¸ä¸æ¡åºæ¬æ¡ä»¶ï¼\n\nd(x,y) = 0 -- åå¦ x ä¸ y çè·ç¦»ä¸º 0ï¼å x=y\n\nd(x,y) = d(y,x) -- x å° y çè·ç¦»ç­åäº y å° x çè·ç¦»\n\nd(x,y) + d(y,z) >= d(x,z) -- ä¸è§ä¸ç­å¼\n\nï¼1ï¼æ ¹æ®ä¸è§ä¸ç­å¼ï¼åæ»¡è¶³ä¸ query è·ç¦»å¨ n èå´åçå¦ä¸ä¸ªå­ç¬¦è½¬ Bï¼å¶ä¸ A çè·ç¦»æå¤§ä¸º d+nï¼æå°ä¸º d-nã\n\nï¼2ï¼BK æ çæé å°±è¿ç¨å¦ä¸ï¼æ¯ä¸ªèç¹æä»»æä¸ªå­èç¹ï¼æ¯æ¡è¾¹æä¸ªå¼è¡¨ç¤ºç¼è¾è·ç¦»ãææå­èç¹å°ç¶èç¹çè¾¹ä¸æ æ³¨ n è¡¨ç¤ºç¼è¾è·ç¦»æ°å¥½ä¸º nãæ¯å¦ï¼æä»¬ææ£µæ ç¶èç¹æ¯âbookâåä¸¤ä¸ªå­èç¹âcakeâåâbooksâï¼âbookâå°âbooksâçè¾¹æ å· 1ï¼âbookâå°âcakeâçè¾¹ä¸æ å· 4ãä»å­å¸éæé å¥½æ åï¼æ è®ºä½æ¶ä½ æ³æå¥æ°åè¯æ¶ï¼è®¡ç®è¯¥åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦»ï¼å¹¶ä¸æ¥æ¾æ°å¼ä¸º d(neweord, root)çè¾¹ãéå½å¾ä¸åå­èç¹è¿è¡æ¯è¾ï¼ç´å°æ²¡æå­èç¹ï¼ä½ å°±å¯ä»¥åå»ºæ°çå­èç¹å¹¶å°æ°åè¯ä¿å­å¨é£ãæ¯å¦ï¼æå¥âbooâå°åæä¸è¿°ä¾å­çæ ä¸­ï¼æä»¬åæ£æ¥æ ¹èç¹ï¼æ¥æ¾ d(âbookâ, âbooâ) = 1 çè¾¹ï¼ç¶åæ£æ¥æ å·ä¸º 1 çè¾¹çå­èç¹ï¼å¾å°åè¯âbooksâãæä»¬åè®¡ç®è·ç¦» d(âbooksâ, âbooâ)=2ï¼åå°æ°åè¯æå¨âbooksâä¹åï¼è¾¹æ å·ä¸º 2ã\n\nï¼3ï¼æ¥è¯¢ç¸ä¼¼è¯å¦ä¸ï¼è®¡ç®åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦» dï¼ç¶åéå½æ¥æ¾æ¯ä¸ªå­èç¹æ å·ä¸º d-n å° d+nï¼åå«ï¼çè¾¹ãåå¦è¢«æ£æ¥çèç¹ä¸æç´¢åè¯çè·ç¦» d å°äº nï¼åè¿åè¯¥èç¹å¹¶ç»§ç»­æ¥è¯¢ãæ¯å¦è¾å¥ cape ä¸æå¤§å®¹å¿è·ç¦»ä¸º 1ï¼ååè®¡ç®åæ ¹çç¼è¾è·ç¦» d(âbookâ, âcapeâ)=4ï¼ç¶åæ¥çæ¾åæ ¹èç¹ä¹é´ç¼è¾è·ç¦»ä¸º 3 å° 5 çï¼è¿ä¸ªå°±æ¾å°äº cake è¿ä¸ªèç¹ï¼è®¡ç® d(âcakeâ, âcapeâ)=1ï¼æ»¡è¶³æ¡ä»¶æä»¥è¿å cakeï¼ç¶ååæ¾å cake èç¹ç¼è¾è·ç¦»æ¯ 0 å° 2 çï¼åå«æ¾å° cape å cart èç¹ï¼è¿æ ·å°±å¾å° cape è¿ä¸ªæ»¡è¶³æ¡ä»¶çç»æã\n\n",normalizedContent:"# elasticsearch é¢è¯æ»ç»\n\n\n# éç¾¤é¨ç½²\n\nes é¨ç½²æåµï¼\n\n5 èç¹ï¼éç½®ï¼8 æ ¸ 64 g 1tï¼ï¼æ»è®¡ 320 gï¼5 tã\n\nçº¦ 10+ ç´¢å¼ï¼5 åçï¼æ¯æ¥æ°å¢æ°æ®éçº¦ä¸º 2gï¼4000w æ¡ãè®°å½ä¿å­ 30 å¤©ã\n\n\n# æ§è½ä¼å\n\n\n# filesystem cache\n\nä½ å¾ es éåçæ°æ®ï¼å®éä¸é½åå°ç£çæä»¶éå»äºï¼æ¥è¯¢çæ¶åï¼æä½ç³»ç»ä¼å°ç£çæä»¶éçæ°æ®èªå¨ç¼å­å° filesystem cache éé¢å»ã\n\n\n\nes çæç´¢å¼æä¸¥éä¾èµäºåºå±ç filesystem cache ï¼ä½ å¦æç» filesystem cache æ´å¤çåå­ï¼å°½éè®©åå­å¯ä»¥å®¹çº³ææç idx segment fileç´¢å¼æ°æ®æä»¶ï¼é£ä¹ä½ æç´¢çæ¶åå°±åºæ¬é½æ¯èµ°åå­çï¼æ§è½ä¼éå¸¸é«ã\n\næ§è½å·®è·ç©¶ç«å¯ä»¥æå¤å¤§ï¼æä»¬ä¹åå¾å¤çæµè¯ååæµï¼å¦æèµ°ç£çä¸è¬è¯å®ä¸ç§ï¼æç´¢æ§è½ç»å¯¹æ¯ç§çº§å«çï¼1 ç§ã5 ç§ã10 ç§ãä½å¦ææ¯èµ° filesystem cache ï¼æ¯èµ°çº¯åå­çï¼é£ä¹ä¸è¬æ¥è¯´æ§è½æ¯èµ°ç£çè¦é«ä¸ä¸ªæ°éçº§ï¼åºæ¬ä¸å°±æ¯æ¯«ç§çº§çï¼ä»å æ¯«ç§å°å ç¾æ¯«ç§ä¸ç­ã\n\nè¿éæä¸ªçå®çæ¡ä¾ãæä¸ªå¬å¸ es èç¹æ 3 å°æºå¨ï¼æ¯å°æºå¨çèµ·æ¥åå­å¾å¤ï¼64gï¼æ»åå­å°±æ¯ 64 * 3 = 192g ãæ¯å°æºå¨ç» es jvm heap æ¯ 32g ï¼é£ä¹å©ä¸æ¥çç» filesystem cache çå°±æ¯æ¯å°æºå¨æ 32g ï¼æ»å±éç¾¤éç» filesystem cache çå°±æ¯ 32 * 3 = 96g åå­ãèæ­¤æ¶ï¼æ´ä¸ªç£çä¸ç´¢å¼æ°æ®æä»¶ï¼å¨ 3 å°æºå¨ä¸ä¸å±å ç¨äº 1t çç£çå®¹éï¼es æ°æ®éæ¯ 1t ï¼é£ä¹æ¯å°æºå¨çæ°æ®éæ¯ 300g ãè¿æ ·æ§è½å¥½åï¼ filesystem cache çåå­æ 100gï¼ååä¹ä¸çæ°æ®å¯ä»¥æ¾åå­ï¼å¶ä»çé½å¨ç£çï¼ç¶åä½ æ§è¡æç´¢æä½ï¼å¤§é¨åæä½é½æ¯èµ°ç£çï¼æ§è½è¯å®å·®ã\n\nå½æ ¹ç»åºï¼ä½ è¦è®© es æ§è½è¦å¥½ï¼æä½³çæåµä¸ï¼å°±æ¯ä½ çæºå¨çåå­ï¼è³å°å¯ä»¥å®¹çº³ä½ çæ»æ°æ®éçä¸åã\n\næ ¹æ®æä»¬èªå·±ççäº§ç¯å¢å®è·µç»éªï¼æä½³çæåµä¸ï¼æ¯ä»ä»å¨ es ä¸­å°±å­å°éçæ°æ®ï¼å°±æ¯ä½ è¦ç¨æ¥æç´¢çé£äºç´¢å¼ï¼å¦æåå­çç» filesystem cache çæ¯ 100gï¼é£ä¹ä½ å°±å°ç´¢å¼æ°æ®æ§å¶å¨ 100g ä»¥åï¼è¿æ ·çè¯ï¼ä½ çæ°æ®å ä¹å¨é¨èµ°åå­æ¥æç´¢ï¼æ§è½éå¸¸ä¹é«ï¼ä¸è¬å¯ä»¥å¨ 1 ç§ä»¥åã\n\næ¯å¦è¯´ä½ ç°å¨æä¸è¡æ°æ®ã id,name,age .... 30 ä¸ªå­æ®µãä½æ¯ä½ ç°å¨æç´¢ï¼åªéè¦æ ¹æ® id,name,age ä¸ä¸ªå­æ®µæ¥æç´¢ãå¦æä½ å»ä¹ä¹å¾ es éåå¥ä¸è¡æ°æ®ææçå­æ®µï¼å°±ä¼å¯¼è´è¯´ 90% çæ°æ®æ¯ä¸ç¨æ¥æç´¢çï¼ç»æç¡¬æ¯å æ®äº es æºå¨ä¸ç filesystem cache çç©ºé´ï¼åæ¡æ°æ®çæ°æ®éè¶å¤§ï¼å°±ä¼å¯¼è´ filesystem cahce è½ç¼å­çæ°æ®å°±è¶å°ãå¶å®ï¼ä»ä»åå¥ es ä¸­è¦ç¨æ¥æ£ç´¢çå°æ°å ä¸ªå­æ®µå°±å¯ä»¥äºï¼æ¯å¦è¯´å°±åå¥ es id,name,age ä¸ä¸ªå­æ®µï¼ç¶åä½ å¯ä»¥æå¶ä»çå­æ®µæ°æ®å­å¨ mysql/hbase éï¼æä»¬ä¸è¬æ¯å»ºè®®ç¨ es + hbase è¿ä¹ä¸ä¸ªæ¶æã\n\nhbase çç¹ç¹æ¯éç¨äºæµ·éæ°æ®çå¨çº¿å­å¨ï¼å°±æ¯å¯¹ hbase å¯ä»¥åå¥æµ·éæ°æ®ï¼ä½æ¯ä¸è¦åå¤æçæç´¢ï¼åå¾ç®åçä¸äºæ ¹æ® id æèèå´è¿è¡æ¥è¯¢çè¿ä¹ä¸ä¸ªæä½å°±å¯ä»¥äºãä» es ä¸­æ ¹æ® name å age å»æç´¢ï¼æ¿å°çç»æå¯è½å°± 20 ä¸ª doc id ï¼ç¶åæ ¹æ® doc id å° hbase éå»æ¥è¯¢æ¯ä¸ª doc id å¯¹åºçå®æ´çæ°æ®ï¼ç»æ¥åºæ¥ï¼åè¿åç»åç«¯ã\n\nåå¥ es çæ°æ®æå¥½å°äºç­äºï¼æèæ¯ç¥å¾®å¤§äº es ç filesystem cache çåå­å®¹éãç¶åä½ ä» es æ£ç´¢å¯è½å°±è±è´¹ 20msï¼ç¶ååæ ¹æ® es è¿åç id å» hbase éæ¥è¯¢ï¼æ¥ 20 æ¡æ°æ®ï¼å¯è½ä¹å°±èè´¹ä¸ª 30msï¼å¯è½ä½ åæ¥é£ä¹ç©å¿ï¼1t æ°æ®é½æ¾ esï¼ä¼æ¯æ¬¡æ¥è¯¢é½æ¯ 5~10sï¼ç°å¨å¯è½æ§è½å°±ä¼å¾é«ï¼æ¯æ¬¡æ¥è¯¢å°±æ¯ 50msã\n\n\n# æ°æ®é¢ç­\n\nåå¦è¯´ï¼åªææ¯ä½ å°±æç§ä¸è¿°çæ¹æ¡å»åäºï¼es éç¾¤ä¸­æ¯ä¸ªæºå¨åå¥çæ°æ®éè¿æ¯è¶è¿äº filesystem cache ä¸åï¼æ¯å¦è¯´ä½ åå¥ä¸å°æºå¨ 60g æ°æ®ï¼ç»æ filesystem cache å°± 30gï¼è¿æ¯æ 30g æ°æ®çå¨äºç£çä¸ã\n\nå¶å®å¯ä»¥åæ°æ®é¢ç­ã\n\nä¸¾ä¸ªä¾å­ï¼æ¿å¾®åæ¥è¯´ï¼ä½ å¯ä»¥æä¸äºå¤§ vï¼å¹³æ¶ççäººå¾å¤çæ°æ®ï¼ä½ èªå·±æååå°æä¸ªç³»ç»ï¼æ¯éä¸ä¼å¿ï¼èªå·±çåå°ç³»ç»å»æç´¢ä¸ä¸ç­æ°æ®ï¼å·å° filesystem cache éå»ï¼åé¢ç¨æ·å®éä¸æ¥çè¿ä¸ªç­æ°æ®çæ¶åï¼ä»ä»¬å°±æ¯ç´æ¥ä»åå­éæç´¢äºï¼å¾å¿«ã\n\næèæ¯çµåï¼ä½ å¯ä»¥å°å¹³æ¶æ¥çæå¤çä¸äºååï¼æ¯å¦è¯´ iphone 8ï¼ç­æ°æ®æååå°æä¸ªç¨åºï¼æ¯é 1 åéèªå·±ä¸»å¨è®¿é®ä¸æ¬¡ï¼å·å° filesystem cache éå»ã\n\nå¯¹äºé£äºä½ è§å¾æ¯è¾ç­çãç»å¸¸ä¼æäººè®¿é®çæ°æ®ï¼æå¥½åä¸ä¸ªä¸é¨çç¼å­é¢ç­å­ç³»ç»ï¼å°±æ¯å¯¹ç­æ°æ®æ¯éä¸æ®µæ¶é´ï¼å°±æåè®¿é®ä¸ä¸ï¼è®©æ°æ®è¿å¥ filesystem cache éé¢å»ãè¿æ ·ä¸æ¬¡å«äººè®¿é®çæ¶åï¼æ§è½ä¸å®ä¼å¥½å¾å¤ã\n\n\n# å·ç­åç¦»\n\nes å¯ä»¥åç±»ä¼¼äº mysql çæ°´å¹³æåï¼å°±æ¯è¯´å°å¤§éçè®¿é®å¾å°ãé¢çå¾ä½çæ°æ®ï¼åç¬åä¸ä¸ªç´¢å¼ï¼ç¶åå°è®¿é®å¾é¢ç¹çç­æ°æ®åç¬åä¸ä¸ªç´¢å¼ãæå¥½æ¯å°å·æ°æ®åå¥ä¸ä¸ªç´¢å¼ä¸­ï¼ç¶åç­æ°æ®åå¥å¦å¤ä¸ä¸ªç´¢å¼ä¸­ï¼è¿æ ·å¯ä»¥ç¡®ä¿ç­æ°æ®å¨è¢«é¢ç­ä¹åï¼å°½éé½è®©ä»ä»¬çå¨ filesystem os cache éï¼å«è®©å·æ°æ®ç»å²å·æã\n\nä½ çï¼åè®¾ä½ æ 6 å°æºå¨ï¼2 ä¸ªç´¢å¼ï¼ä¸ä¸ªæ¾å·æ°æ®ï¼ä¸ä¸ªæ¾ç­æ°æ®ï¼æ¯ä¸ªç´¢å¼ 3 ä¸ª shardã3 å°æºå¨æ¾ç­æ°æ® indexï¼å¦å¤ 3 å°æºå¨æ¾å·æ°æ® indexãç¶åè¿æ ·çè¯ï¼ä½ å¤§éçæ¶é´æ¯å¨è®¿é®ç­æ°æ® indexï¼ç­æ°æ®å¯è½å°±å æ»æ°æ®éç 10%ï¼æ­¤æ¶æ°æ®éå¾å°ï¼å ä¹å¨é½ä¿çå¨ filesystem cache éé¢äºï¼å°±å¯ä»¥ç¡®ä¿ç­æ°æ®çè®¿é®æ§è½æ¯å¾é«çãä½æ¯å¯¹äºå·æ°æ®èè¨ï¼æ¯å¨å«ç index éçï¼è·ç­æ°æ® index ä¸å¨ç¸åçæºå¨ä¸ï¼å¤§å®¶äºç¸ä¹é´é½æ²¡ä»ä¹èç³»äºãå¦ææäººè®¿é®å·æ°æ®ï¼å¯è½å¤§éæ°æ®æ¯å¨ç£çä¸çï¼æ­¤æ¶æ§è½å·®ç¹ï¼å°± 10% çäººå»è®¿é®å·æ°æ®ï¼90% çäººå¨è®¿é®ç­æ°æ®ï¼ä¹æ æè°äºã\n\n\n# document æ¨¡åè®¾è®¡\n\nå¯¹äº mysqlï¼æä»¬ç»å¸¸æä¸äºå¤æçå³èæ¥è¯¢ãå¨ es éè¯¥æä¹ç©å¿ï¼es éé¢çå¤æçå³èæ¥è¯¢å°½éå«ç¨ï¼ä¸æ¦ç¨äºæ§è½ä¸è¬é½ä¸å¤ªå¥½ã\n\næå¥½æ¯åå¨ java ç³»ç»éå°±å®æå³èï¼å°å³èå¥½çæ°æ®ç´æ¥åå¥ es ä¸­ãæç´¢çæ¶åï¼å°±ä¸éè¦å©ç¨ es çæç´¢è¯­æ³æ¥å®æ join ä¹ç±»çå³èæç´¢äºã\n\ndocument æ¨¡åè®¾è®¡æ¯éå¸¸éè¦çï¼å¾å¤æä½ï¼ä¸è¦å¨æç´¢çæ¶åææ³å»æ§è¡åç§å¤æçä¹±ä¸å«ç³çæä½ães è½æ¯æçæä½å°±é£ä¹å¤ï¼ä¸è¦èèç¨ es åä¸äºå®ä¸å¥½æä½çäºæãå¦æççæé£ç§æä½ï¼å°½éå¨ document æ¨¡åè®¾è®¡çæ¶åï¼åå¥çæ¶åå°±å®æãå¦å¤å¯¹äºä¸äºå¤ªå¤æçæä½ï¼æ¯å¦ join/nested/parent-child æç´¢é½è¦å°½éé¿åï¼æ§è½é½å¾å·®çã\n\n\n# åé¡µæ§è½ä¼å\n\nes çåé¡µæ¯è¾åçï¼ä¸ºå¥å¢ï¼ä¸¾ä¸ªä¾å­å§ï¼åå¦ä½ æ¯é¡µæ¯ 10 æ¡æ°æ®ï¼ä½ ç°å¨è¦æ¥è¯¢ç¬¬ 100 é¡µï¼å®éä¸æ¯ä¼ææ¯ä¸ª shard ä¸å­å¨çå 1000 æ¡æ°æ®é½æ¥å°ä¸ä¸ªåè°èç¹ä¸ï¼å¦æä½ æä¸ª 5 ä¸ª shardï¼é£ä¹å°±æ 5000 æ¡æ°æ®ï¼æ¥çåè°èç¹å¯¹è¿ 5000 æ¡æ°æ®è¿è¡ä¸äºåå¹¶ãå¤çï¼åè·åå°æç»ç¬¬ 100 é¡µç 10 æ¡æ°æ®ã\n\nåå¸å¼çï¼ä½ è¦æ¥ç¬¬ 100 é¡µç 10 æ¡æ°æ®ï¼ä¸å¯è½è¯´ä» 5 ä¸ª shardï¼æ¯ä¸ª shard å°±æ¥ 2 æ¡æ°æ®ï¼æåå°åè°èç¹åå¹¶æ 10 æ¡æ°æ®å§ï¼ä½ å¿é¡»å¾ä»æ¯ä¸ª shard é½æ¥ 1000 æ¡æ°æ®è¿æ¥ï¼ç¶åæ ¹æ®ä½ çéæ±è¿è¡æåºãç­éç­ç­æä½ï¼æååæ¬¡åé¡µï¼æ¿å°éé¢ç¬¬ 100 é¡µçæ°æ®ãä½ ç¿»é¡µçæ¶åï¼ç¿»çè¶æ·±ï¼æ¯ä¸ª shard è¿åçæ°æ®å°±è¶å¤ï¼èä¸åè°èç¹å¤ççæ¶é´è¶é¿ï¼éå¸¸åç¹ãæä»¥ç¨ es ååé¡µçæ¶åï¼ä½ ä¼åç°è¶ç¿»å°åé¢ï¼å°±è¶æ¯æ¢ã\n\næä»¬ä¹åä¹æ¯éå°è¿è¿ä¸ªé®é¢ï¼ç¨ es ä½åé¡µï¼åå é¡µå°±å åæ¯«ç§ï¼ç¿»å° 10 é¡µæèå åé¡µçæ¶åï¼åºæ¬ä¸å°±è¦ 5~10 ç§æè½æ¥åºæ¥ä¸é¡µæ°æ®äºã\n\næä»ä¹è§£å³æ¹æ¡åï¼\n\n# ä¸åè®¸æ·±åº¦åé¡µï¼é»è®¤æ·±åº¦åé¡µæ§è½å¾å·®ï¼\n\nè·äº§åç»çè¯´ï¼ä½ ç³»ç»ä¸åè®¸ç¿»é£ä¹æ·±çé¡µï¼é»è®¤ç¿»çè¶æ·±ï¼æ§è½å°±è¶å·®ã\n\n# ç±»ä¼¼äº app éçæ¨èååä¸æ­ä¸æåºæ¥ä¸é¡µä¸é¡µç\n\nç±»ä¼¼äºå¾®åä¸­ï¼ä¸æå·å¾®åï¼å·åºæ¥ä¸é¡µä¸é¡µçï¼ä½ å¯ä»¥ç¨ scroll api ï¼å³äºå¦ä½ä½¿ç¨ï¼èªè¡ä¸ç½æç´¢ã\n\nscroll ä¼ä¸æ¬¡æ§ç»ä½ çææææ°æ®çä¸ä¸ªå¿«ç§ï¼ç¶åæ¯æ¬¡æ»å¨ååç¿»é¡µå°±æ¯éè¿æ¸¸æ  scroll_id ç§»å¨ï¼è·åä¸ä¸é¡µä¸ä¸é¡µè¿æ ·å­ï¼æ§è½ä¼æ¯ä¸é¢è¯´çé£ç§åé¡µæ§è½è¦é«å¾å¤å¾å¤ï¼åºæ¬ä¸é½æ¯æ¯«ç§çº§çã\n\nä½æ¯ï¼å¯ä¸çä¸ç¹å°±æ¯ï¼è¿ä¸ªéåäºé£ç§ç±»ä¼¼å¾®åä¸æç¿»é¡µçï¼ä¸è½éæè·³å°ä»»ä½ä¸é¡µçåºæ¯ãä¹å°±æ¯è¯´ï¼ä½ ä¸è½åè¿å¥ç¬¬ 10 é¡µï¼ç¶åå»ç¬¬ 120 é¡µï¼ç¶åååå°ç¬¬ 58 é¡µï¼ä¸è½éæä¹±è·³é¡µãæä»¥ç°å¨å¾å¤äº§åï¼é½æ¯ä¸åè®¸ä½ éæç¿»é¡µçï¼appï¼ä¹æä¸äºç½ç«ï¼åçå°±æ¯ä½ åªè½å¾ä¸æï¼ä¸é¡µä¸é¡µçç¿»ã\n\nåå§åæ¶å¿é¡»æå® scroll åæ°ï¼åè¯ es è¦ä¿å­æ­¤æ¬¡æç´¢çä¸ä¸æå¤é¿æ¶é´ãä½ éè¦ç¡®ä¿ç¨æ·ä¸ä¼æç»­ä¸æ­ç¿»é¡µç¿»å ä¸ªå°æ¶ï¼å¦åå¯è½å ä¸ºè¶æ¶èå¤±è´¥ã\n\né¤äºç¨ scroll api ï¼ä½ ä¹å¯ä»¥ç¨ search_after æ¥åï¼ search_after çææ³æ¯ä½¿ç¨åä¸é¡µçç»ææ¥å¸®å©æ£ç´¢ä¸ä¸é¡µçæ°æ®ï¼æ¾ç¶ï¼è¿ç§æ¹å¼ä¹ä¸åè®¸ä½ éæç¿»é¡µï¼ä½ åªè½ä¸é¡µé¡µå¾åç¿»ãåå§åæ¶ï¼éè¦ä½¿ç¨ä¸ä¸ªå¯ä¸å¼çå­æ®µä½ä¸º sort å­æ®µã\n\n1.1ãè®¾è®¡é¶æ®µè°ä¼\n\nï¼1ï¼æ ¹æ®ä¸å¡å¢ééæ±ï¼éååºäºæ¥ææ¨¡æ¿åå»ºç´¢å¼ï¼éè¿ roll over api æ»å¨ç´¢å¼ï¼\n\nï¼2ï¼ä½¿ç¨å«åè¿è¡ç´¢å¼ç®¡çï¼\n\nï¼3ï¼æ¯å¤©åæ¨å®æ¶å¯¹ç´¢å¼å force_merge æä½ï¼ä»¥éæ¾ç©ºé´ï¼\n\nï¼4ï¼éåå·ç­åç¦»æºå¶ï¼ç­æ°æ®å­å¨å° ssdï¼æé«æ£ç´¢æçï¼å·æ°æ®å®æè¿è¡ shrink æä½ï¼ä»¥ç¼©åå­å¨ï¼\n\nï¼5ï¼éå curator è¿è¡ç´¢å¼ççå½å¨æç®¡çï¼\n\nï¼6ï¼ä»éå¯¹éè¦åè¯çå­æ®µï¼åççè®¾ç½®åè¯å¨ï¼\n\nï¼7ï¼mapping é¶æ®µååç»ååä¸ªå­æ®µçå±æ§ï¼æ¯å¦éè¦æ£ç´¢ãæ¯å¦éè¦å­å¨ç­ãâ¦â¦..\n\n1.2ãåå¥è°ä¼\n\nï¼1ï¼åå¥åå¯æ¬æ°è®¾ç½®ä¸º 0ï¼\n\nï¼2ï¼åå¥åå³é­ refresh_interval è®¾ç½®ä¸º-1ï¼ç¦ç¨å·æ°æºå¶ï¼\n\nï¼3ï¼åå¥è¿ç¨ä¸­ï¼éå bulk æ¹éåå¥ï¼\n\nï¼4ï¼åå¥åæ¢å¤å¯æ¬æ°åå·æ°é´éï¼\n\nï¼5ï¼å°½éä½¿ç¨èªå¨çæç idã\n\n1.3ãæ¥è¯¢è°ä¼\n\nï¼1ï¼ç¦ç¨ wildcardï¼\n\nï¼2ï¼ç¦ç¨æ¹é termsï¼æç¾ä¸åçåºæ¯ï¼ï¼\n\nï¼3ï¼ååå©ç¨åæç´¢å¼æºå¶ï¼è½ keyword ç±»åå°½é keywordï¼\n\nï¼4ï¼æ°æ®éå¤§æ¶åï¼å¯ä»¥ååºäºæ¶é´æ²å®ç´¢å¼åæ£ç´¢ï¼\n\nï¼5ï¼è®¾ç½®åççè·¯ç±æºå¶ã\n\n1.4ãå¶ä»è°ä¼\n\né¨ç½²è°ä¼ï¼ä¸å¡è°ä¼ç­ã\n\nä¸é¢çæåä¸é¨åï¼é¢è¯èå°±åºæ¬å¯¹ä½ ä¹åçå®è·µæèè¿ç»´ç»éªææè¯ä¼°äºã\n\n\n# å·¥ä½åç\n\n\n# es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating node ï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica node ã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate node ã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate node ã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refresh ã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment file ï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment file ï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cache ï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cache ï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cache ä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ nrt ï¼å¨ç§° near real-time ãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java api ï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cache ä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment file ï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flush ãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flush ï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flush ãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment file ï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment file ï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit point ï¼æ è¯æææ°ç segment file ï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment file ã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ idï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ id çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\ndocid   doc\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook\n2       è°·æ­å°å¾ä¹ç¶å ç facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook ä¸ wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nwordid   word       docids\n1        è°·æ­         1, 2, 3, 4, 5\n2        å°å¾         1, 2, 3, 4, 5\n3        ä¹ç¶         1, 2, 4, 5\n4        è·³æ§½         1, 4\n5        facebook   1, 2, 3, 4, 5\n6        å ç         2, 3, 5\n7        åå§äºº        3\n8        ææ¯         3, 5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ facebook ï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# elasticsearch çåæç´¢å¼æ¯ä»ä¹\n\né¢è¯å®ï¼æ³äºè§£ä½ å¯¹åºç¡æ¦å¿µçè®¤ç¥ã\n\nè§£ç­ï¼éä¿è§£éä¸ä¸å°±å¯ä»¥ã\n\nä¼ ç»çæä»¬çæ£ç´¢æ¯éè¿æç« ï¼éä¸ªéåæ¾å°å¯¹åºå³é®è¯çä½ç½®ã\n\nèåæç´¢å¼ï¼æ¯éè¿åè¯ç­ç¥ï¼å½¢æäºè¯åæç« çæ å°å³ç³»è¡¨ï¼è¿ç§è¯å¸+æ å°è¡¨å³ä¸ºåæç´¢å¼ãæäºåæç´¢å¼ï¼å°±è½å®ç° oï¼1ï¼æ¶é´å¤æåº¦çæçæ£ç´¢æç« äºï¼æå¤§çæé«äºæ£ç´¢æçã\n\n\n\nå­¦æ¯çè§£ç­æ¹å¼ï¼\n\nåæç´¢å¼ï¼ç¸åäºä¸ç¯æç« åå«äºåªäºè¯ï¼å®ä»è¯åºåï¼è®°è½½äºè¿ä¸ªè¯å¨åªäºææ¡£ä¸­åºç°è¿ï¼ç±ä¸¤é¨åç»æââè¯å¸ååæè¡¨ã\n\nå åé¡¹ï¼åæç´¢å¼çåºå±å®ç°æ¯åºäºï¼fstï¼finite state transducerï¼æ°æ®ç»æã\n\nlucene ä» 4+çæ¬åå¼å§å¤§éä½¿ç¨çæ°æ®ç»ææ¯ fstãfst æä¸¤ä¸ªä¼ç¹ï¼\n\nï¼1ï¼ç©ºé´å ç¨å°ãéè¿å¯¹è¯å¸ä¸­åè¯åç¼ååç¼çéå¤å©ç¨ï¼åç¼©äºå­å¨ç©ºé´ï¼\n\nï¼2ï¼æ¥è¯¢éåº¦å¿«ão(len(str))çæ¥è¯¢æ¶é´å¤æåº¦ã\n\n\n# 3ãelasticsearch ç´¢å¼æ°æ®å¤äºæä¹åï¼å¦ä½è°ä¼ï¼é¨ç½²\n\né¢è¯å®ï¼æ³äºè§£å¤§æ°æ®éçè¿ç»´è½åã\n\nè§£ç­ï¼ç´¢å¼æ°æ®çè§åï¼åºå¨åæåå¥½è§åï¼æ­£æè°âè®¾è®¡åè¡ï¼ç¼ç å¨åâï¼è¿æ ·æè½ææçé¿åçªå¦å¶æ¥çæ°æ®æ¿å¢å¯¼è´éç¾¤å¤çè½åä¸è¶³å¼åççº¿ä¸å®¢æ·æ£ç´¢æèå¶ä»ä¸å¡åå°å½±åã\n\nå¦ä½è°ä¼ï¼æ­£å¦é®é¢ 1 æè¯´ï¼è¿éç»åä¸ä¸ï¼\n\n3.1 å¨æç´¢å¼å±é¢\n\nåºäºæ¨¡æ¿+æ¶é´+rollover api æ»å¨åå»ºç´¢å¼ï¼ä¸¾ä¾ï¼è®¾è®¡é¶æ®µå®ä¹ï¼blog ç´¢å¼çæ¨¡æ¿æ ¼å¼ä¸ºï¼blogindexæ¶é´æ³çå½¢å¼ï¼æ¯å¤©éå¢æ°æ®ãè¿æ ·åçå¥½å¤ï¼ä¸è³äºæ°æ®éæ¿å¢å¯¼è´åä¸ªç´¢å¼æ°æ®ééå¸¸å¤§ï¼æ¥è¿äºä¸çº¿ 2 ç 32 æ¬¡å¹-1ï¼ç´¢å¼å­å¨è¾¾å°äº tb+çè³æ´å¤§ã\n\nä¸æ¦åä¸ªç´¢å¼å¾å¤§ï¼å­å¨ç­åç§é£é©ä¹éä¹èæ¥ï¼æä»¥è¦æåèè+åæ©é¿åã\n\n3.2 å­å¨å±é¢\n\nå·ç­æ°æ®åç¦»å­å¨ï¼ç­æ°æ®ï¼æ¯å¦æè¿ 3 å¤©æèä¸å¨çæ°æ®ï¼ï¼å¶ä½ä¸ºå·æ°æ®ã\n\nå¯¹äºå·æ°æ®ä¸ä¼ååå¥æ°æ°æ®ï¼å¯ä»¥èèå®æ force_merge å  shrink åç¼©æä½ï¼èçå­å¨ç©ºé´åæ£ç´¢æçã\n\n3.3 é¨ç½²å±é¢\n\nä¸æ¦ä¹åæ²¡æè§åï¼è¿éå°±å±äºåºæ¥ç­ç¥ã\n\nç»å es èªèº«çæ¯æå¨ææ©å±çç¹ç¹ï¼å¨ææ°å¢æºå¨çæ¹å¼å¯ä»¥ç¼è§£éç¾¤ååï¼æ³¨æï¼å¦æä¹åä¸»èç¹ç­è§ååçï¼ä¸éè¦éå¯éç¾¤ä¹è½å®æå¨ææ°å¢çã\n\n\n# 4ãelasticsearch æ¯å¦ä½å®ç° master éä¸¾ç\n\né¢è¯å®ï¼æ³äºè§£ es éç¾¤çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nåç½®åæï¼\n\nï¼1ï¼åªæåéä¸»èç¹ï¼masterï¼trueï¼çèç¹æè½æä¸ºä¸»èç¹ã\n\nï¼2ï¼æå°ä¸»èç¹æ°ï¼min_master_nodesï¼çç®çæ¯é²æ­¢èè£ã\n\næ ¸å¯¹äºä¸ä¸ä»£ç ï¼æ ¸å¿å¥å£ä¸º findmasterï¼éæ©ä¸»èç¹æåè¿åå¯¹åº masterï¼å¦åè¿å nullãéä¸¾æµç¨å¤§è´æè¿°å¦ä¸ï¼\n\nç¬¬ä¸æ­¥ï¼ç¡®è®¤åéä¸»èç¹æ°è¾¾æ ï¼elasticsearch.yml è®¾ç½®çå¼\n\ndiscovery.zen.minimum_master_nodesï¼\n\nç¬¬äºæ­¥ï¼æ¯è¾ï¼åå¤å®æ¯å¦å·å¤ master èµæ ¼ï¼å·å¤åéä¸»èç¹èµæ ¼çä¼åè¿åï¼\n\nè¥ä¸¤èç¹é½ä¸ºåéä¸»èç¹ï¼å id å°çå¼ä¼ä¸»èç¹ãæ³¨æè¿éç id ä¸º string ç±»åã\n\né¢å¤è¯ï¼è·åèç¹ id çæ¹æ³ã\n\n1get /_cat/nodes?v&amp;h=ip,port,heappercent,heapmax,id,name\n\n2ip port heappercent heapmax id name\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨\n\né¢è¯å®ï¼æ³äºè§£ es çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\nè¿éçç´¢å¼ææ¡£åºè¯¥çè§£ä¸ºææ¡£åå¥ esï¼åå»ºç´¢å¼çè¿ç¨ã\n\nææ¡£åå¥åå«ï¼åææ¡£åå¥åæ¹é bulk åå¥ï¼è¿éåªè§£éä¸ä¸ï¼åææ¡£åå¥æµç¨ã\n\nè®°ä½å®æ¹ææ¡£ä¸­çè¿ä¸ªå¾ã\n\n\n\nç¬¬ä¸æ­¥ï¼å®¢æ·åéç¾¤æèç¹åå¥æ°æ®ï¼åéè¯·æ±ãï¼å¦ææ²¡ææå®è·¯ç±/åè°èç¹ï¼è¯·æ±çèç¹æ®æ¼è·¯ç±èç¹çè§è²ãï¼\n\nç¬¬äºæ­¥ï¼èç¹ 1 æ¥åå°è¯·æ±åï¼ä½¿ç¨ææ¡£_id æ¥ç¡®å®ææ¡£å±äºåç 0ãè¯·æ±ä¼è¢«è½¬å°å¦å¤çèç¹ï¼åå®èç¹ 3ãå æ­¤åç 0 çä¸»åçåéå°èç¹ 3 ä¸ã\n\nç¬¬ä¸æ­¥ï¼èç¹ 3 å¨ä¸»åçä¸æ§è¡åæä½ï¼å¦ææåï¼åå°è¯·æ±å¹¶è¡è½¬åå°èç¹ 1 åèç¹ 2 çå¯æ¬åçä¸ï¼ç­å¾ç»æè¿åãææçå¯æ¬åçé½æ¥åæåï¼èç¹ 3 å°ååè°èç¹ï¼èç¹ 1ï¼æ¥åæåï¼èç¹ 1 åè¯·æ±å®¢æ·ç«¯æ¥ååå¥æåã\n\nå¦æé¢è¯å®åé®ï¼ç¬¬äºæ­¥ä¸­çææ¡£è·ååççè¿ç¨ï¼\n\nåç­ï¼åå©è·¯ç±ç®æ³è·åï¼è·¯ç±ç®æ³å°±æ¯æ ¹æ®è·¯ç±åææ¡£ id è®¡ç®ç®æ çåç id çè¿ç¨ã\n\n1shard = hash(_routing) % (num_of_primary_shards)\n\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ï¼\n\né¢è¯å®ï¼æ³äºè§£ es æç´¢çåºå±åçï¼ä¸ååªå³æ³¨ä¸å¡å±é¢äºã\n\nè§£ç­ï¼\n\næç´¢æè§£ä¸ºâquery then fetchâ ä¸¤ä¸ªé¶æ®µã\n\nquery é¶æ®µçç®çï¼å®ä½å°ä½ç½®ï¼ä½ä¸åã\n\næ­¥éª¤æè§£å¦ä¸ï¼\n\nï¼1ï¼åè®¾ä¸ä¸ªç´¢å¼æ°æ®æ 5 ä¸»+1 å¯æ¬ å± 10 åçï¼ä¸æ¬¡è¯·æ±ä¼å½ä¸­ï¼ä¸»æèå¯æ¬åçä¸­ï¼çä¸ä¸ªã\n\nï¼2ï¼æ¯ä¸ªåçå¨æ¬å°è¿è¡æ¥è¯¢ï¼ç»æè¿åå°æ¬å°æåºçä¼åéåä¸­ã\n\nï¼3ï¼ç¬¬ 2ï¼æ­¥éª¤çç»æåéå°åè°èç¹ï¼åè°èç¹äº§çä¸ä¸ªå¨å±çæåºåè¡¨ã\n\nfetch é¶æ®µçç®çï¼åæ°æ®ã\n\nè·¯ç±èç¹è·åææææ¡£ï¼è¿åç»å®¢æ·ç«¯ã\n\n\n# elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³\n\né¢è¯å®ï¼æ³äºè§£å¯¹ es éç¾¤çè¿ç»´è½åã\n\nè§£ç­ï¼\n\nï¼1ï¼å³é­ç¼å­ swap;\n\nï¼2ï¼å åå­è®¾ç½®ä¸ºï¼minï¼èç¹åå­/2, 32gbï¼;\n\nï¼3ï¼è®¾ç½®æå¤§æä»¶å¥ææ°ï¼\n\nï¼4ï¼çº¿ç¨æ± +éåå¤§å°æ ¹æ®ä¸å¡éè¦åè°æ´ï¼\n\nï¼5ï¼ç£çå­å¨ raid æ¹å¼ââå­å¨ææ¡ä»¶ä½¿ç¨ raid10ï¼å¢å åèç¹æ§è½ä»¥åé¿ååèç¹å­å¨æéã\n\n\n# lucence åé¨ç»ææ¯ä»ä¹ï¼\n\né¢è¯å®ï¼æ³äºè§£ä½ çç¥è¯é¢çå¹¿åº¦åæ·±åº¦ã\n\nè§£ç­ï¼\n\n\n\nlucene æ¯æç´¢å¼åæç´¢çä¸¤ä¸ªè¿ç¨ï¼åå«ç´¢å¼åå»ºï¼ç´¢å¼ï¼æç´¢ä¸ä¸ªè¦ç¹ãå¯ä»¥åºäºè¿ä¸ªèç»å±å¼ä¸äºã\n\n\n# elasticsearch æ¯å¦ä½å®ç° master éä¸¾çï¼\n\nï¼1ï¼elasticsearch çéä¸»æ¯ zendiscovery æ¨¡åè´è´£çï¼ä¸»è¦åå« pingï¼èç¹ä¹é´éè¿è¿ä¸ª rpc æ¥åç°å½¼æ­¤ï¼å unicastï¼åæ­æ¨¡ååå«ä¸ä¸ªä¸»æºåè¡¨ä»¥æ§å¶åªäºèç¹éè¦ ping éï¼è¿ä¸¤é¨åï¼\n\nï¼2ï¼å¯¹ææå¯ä»¥æä¸º master çèç¹ï¼node.master: trueï¼æ ¹æ® nodeid å­å¸æåºï¼æ¯æ¬¡éä¸¾æ¯ä¸ªèç¹é½æèªå·±æç¥éèç¹æä¸æ¬¡åºï¼ç¶åéåºç¬¬ä¸ä¸ªï¼ç¬¬ 0 ä½ï¼èç¹ï¼æä¸è®¤ä¸ºå®æ¯ master èç¹ã\n\nï¼3ï¼å¦æå¯¹æä¸ªèç¹çæç¥¨æ°è¾¾å°ä¸å®çå¼ï¼å¯ä»¥æä¸º master èç¹æ° n/2+1ï¼å¹¶ä¸è¯¥èç¹èªå·±ä¹éä¸¾èªå·±ï¼é£è¿ä¸ªèç¹å°±æ¯ masterãå¦åéæ°éä¸¾ä¸ç´å°æ»¡è¶³ä¸è¿°æ¡ä»¶ã\n\nï¼4ï¼è¡¥åï¼master èç¹çèè´£ä¸»è¦åæ¬éç¾¤ãèç¹åç´¢å¼çç®¡çï¼ä¸è´è´£ææ¡£çº§å«çç®¡çï¼data èç¹å¯ä»¥å³é­ http åè½*ã\n\n\n# 10ãelasticsearch ä¸­çèç¹ï¼æ¯å¦å± 20 ä¸ªï¼ï¼å¶ä¸­ç 10 ä¸ª\n\néäºä¸ä¸ª masterï¼å¦å¤ 10 ä¸ªéäºå¦ä¸ä¸ª masterï¼æä¹åï¼\n\nï¼1ï¼å½éç¾¤ master åéæ°éä¸å°äº 3 ä¸ªæ¶ï¼å¯ä»¥éè¿è®¾ç½®æå°æç¥¨éè¿æ°éï¼discovery.zen.minimum_master_nodesï¼è¶è¿ææåéèç¹ä¸åä»¥ä¸æ¥è§£å³èè£é®é¢ï¼\n\nï¼3ï¼å½åéæ°éä¸ºä¸¤ä¸ªæ¶ï¼åªè½ä¿®æ¹ä¸ºå¯ä¸çä¸ä¸ª master åéï¼å¶ä»ä½ä¸º data èç¹ï¼é¿åèè£é®é¢ã\n\n\n# å®¢æ·ç«¯å¨åéç¾¤è¿æ¥æ¶ï¼å¦ä½éæ©ç¹å®çèç¹æ§è¡è¯·æ±çï¼\n\ntransportclient å©ç¨ transport æ¨¡åè¿ç¨è¿æ¥ä¸ä¸ª elasticsearch éç¾¤ãå®å¹¶ä¸å å¥å°éç¾¤ä¸­ï¼åªæ¯ç®åçè·å¾ä¸ä¸ªæèå¤ä¸ªåå§åç transport å°åï¼å¹¶ä»¥ è½®è¯¢ çæ¹å¼ä¸è¿äºå°åè¿è¡éä¿¡ã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch ç´¢å¼ææ¡£çè¿ç¨ã\n\nåè°èç¹é»è®¤ä½¿ç¨ææ¡£ id åä¸è®¡ç®ï¼ä¹æ¯æéè¿ routingï¼ï¼ä»¥ä¾¿ä¸ºè·¯ç±æä¾åéçåçã\n\nshard = hash(document_id) % (num_of_primary_shards)\n\n\nï¼1ï¼å½åçæå¨çèç¹æ¥æ¶å°æ¥èªåè°èç¹çè¯·æ±åï¼ä¼å°è¯·æ±åå¥å° memorybufferï¼ç¶åå®æ¶ï¼é»è®¤æ¯æ¯é 1 ç§ï¼åå¥å° filesystem cacheï¼è¿ä¸ªä» momerybuffer å° filesystem cache çè¿ç¨å°±å«å refreshï¼\n\nï¼2ï¼å½ç¶å¨æäºæåµä¸ï¼å­å¨ momery buffer å filesystem cache çæ°æ®å¯è½ä¼ä¸¢å¤±ï¼es æ¯éè¿ translog çæºå¶æ¥ä¿è¯æ°æ®çå¯é æ§çãå¶å®ç°æºå¶æ¯æ¥æ¶å°è¯·æ±åï¼åæ¶ä¹ä¼åå¥å° translog ä¸­ ï¼å½ filesystem cache ä¸­çæ°æ®åå¥å°ç£çä¸­æ¶ï¼æä¼æ¸é¤æï¼è¿ä¸ªè¿ç¨å«å flushï¼\n\nï¼3ï¼å¨ flush è¿ç¨ä¸­ï¼åå­ä¸­çç¼å²å°è¢«æ¸é¤ï¼åå®¹è¢«åå¥ä¸ä¸ªæ°æ®µï¼æ®µç fsync å°åå»ºä¸ä¸ªæ°çæäº¤ç¹ï¼å¹¶å°åå®¹å·æ°å°ç£çï¼æ§ç translog å°è¢«å é¤å¹¶å¼å§ä¸ä¸ªæ°ç translogã\n\nï¼4ï¼flush è§¦åçæ¶æºæ¯å®æ¶è§¦åï¼é»è®¤ 30 åéï¼æè translog åå¾å¤ªå¤§ï¼é»è®¤ä¸º 512mï¼æ¶ï¼\n\n\n\nè¡¥åï¼å³äº lucene ç segementï¼\n\nï¼1ï¼lucene ç´¢å¼æ¯ç±å¤ä¸ªæ®µç»æï¼æ®µæ¬èº«æ¯ä¸ä¸ªåè½é½å¨çåæç´¢å¼ã\n\nï¼2ï¼æ®µæ¯ä¸å¯åçï¼åè®¸ lucene å°æ°çææ¡£å¢éå°æ·»å å°ç´¢å¼ä¸­ï¼èä¸ç¨ä»å¤´éå»ºç´¢å¼ã\n\nï¼3ï¼å¯¹äºæ¯ä¸ä¸ªæç´¢è¯·æ±èè¨ï¼ç´¢å¼ä¸­çæææ®µé½ä¼è¢«æç´¢ï¼å¹¶ä¸æ¯ä¸ªæ®µä¼æ¶è cpu çæ¶éå¨ãæä»¶å¥æååå­ãè¿æå³çæ®µçæ°éè¶å¤ï¼æç´¢æ§è½ä¼è¶ä½ã\n\nï¼4ï¼ä¸ºäºè§£å³è¿ä¸ªé®é¢ï¼elasticsearch ä¼åå¹¶å°æ®µå°ä¸ä¸ªè¾å¤§çæ®µï¼æäº¤æ°çåå¹¶æ®µå°ç£çï¼å¹¶å é¤é£äºæ§çå°æ®µã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch æ´æ°åå é¤ææ¡£çè¿ç¨ã\n\nï¼1ï¼å é¤åæ´æ°ä¹é½æ¯åæä½ï¼ä½æ¯ elasticsearch ä¸­çææ¡£æ¯ä¸å¯åçï¼å æ­¤ä¸è½è¢«å é¤æèæ¹å¨ä»¥å±ç¤ºå¶åæ´ï¼\n\nï¼2ï¼ç£çä¸çæ¯ä¸ªæ®µé½æä¸ä¸ªç¸åºç.del æä»¶ãå½å é¤è¯·æ±åéåï¼ææ¡£å¹¶æ²¡æççè¢«å é¤ï¼èæ¯å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ãè¯¥ææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æãå½æ®µåå¹¶æ¶ï¼å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤çææ¡£å°ä¸ä¼è¢«åå¥æ°æ®µã\n\nï¼3ï¼å¨æ°çææ¡£è¢«åå»ºæ¶ï¼elasticsearch ä¼ä¸ºè¯¥ææ¡£æå®ä¸ä¸ªçæ¬å·ï¼å½æ§è¡æ´æ°æ¶ï¼æ§çæ¬çææ¡£å¨.del æä»¶ä¸­è¢«æ è®°ä¸ºå é¤ï¼æ°çæ¬çææ¡£è¢«ç´¢å¼å°ä¸ä¸ªæ°æ®µãæ§çæ¬çææ¡£ä¾ç¶è½å¹éæ¥è¯¢ï¼ä½æ¯ä¼å¨ç»æä¸­è¢«è¿æ»¤æã\n\n\n# è¯¦ç»æè¿°ä¸ä¸ elasticsearch æç´¢çè¿ç¨ã\n\nï¼1ï¼æç´¢è¢«æ§è¡æä¸ä¸ªä¸¤é¶æ®µè¿ç¨ï¼æä»¬ç§°ä¹ä¸º query then fetchï¼\n\nï¼2ï¼å¨åå§æ¥è¯¢é¶æ®µæ¶ï¼æ¥è¯¢ä¼å¹¿æ­å°ç´¢å¼ä¸­æ¯ä¸ä¸ªåçæ·è´ï¼ä¸»åçæèå¯æ¬åçï¼ã æ¯ä¸ªåçå¨æ¬å°æ§è¡æç´¢å¹¶æå»ºä¸ä¸ªå¹éææ¡£çå¤§å°ä¸º from + size çä¼åéåã\n\npsï¼å¨æç´¢çæ¶åæ¯ä¼æ¥è¯¢ filesystem cache çï¼ä½æ¯æé¨åæ°æ®è¿å¨ memorybufferï¼æä»¥æç´¢æ¯è¿å®æ¶çã\n\nï¼3ï¼æ¯ä¸ªåçè¿ååèªä¼åéåä¸­ ææææ¡£ç id åæåºå¼ ç»åè°èç¹ï¼å®åå¹¶è¿äºå¼å°èªå·±çä¼åéåä¸­æ¥äº§çä¸ä¸ªå¨å±æåºåçç»æåè¡¨ã\n\nï¼4ï¼æ¥ä¸æ¥å°±æ¯ ååé¶æ®µï¼åè°èç¹è¾¨å«åºåªäºææ¡£éè¦è¢«ååå¹¶åç¸å³çåçæäº¤å¤ä¸ª get è¯·æ±ãæ¯ä¸ªåçå è½½å¹¶ ä¸° å¯ ææ¡£ï¼å¦ææéè¦çè¯ï¼æ¥çè¿åææ¡£ç»åè°èç¹ãä¸æ¦ææçææ¡£é½è¢«ååäºï¼åè°èç¹è¿åç»æç»å®¢æ·ç«¯ã\n\nï¼5ï¼è¡¥åï¼query then fetch çæç´¢ç±»åå¨ææ¡£ç¸å³æ§æåçæ¶ååèçæ¯æ¬åççæ°æ®ï¼è¿æ ·å¨ææ¡£æ°éè¾å°çæ¶åå¯è½ä¸å¤åç¡®ï¼dfs query then fetch å¢å äºä¸ä¸ªé¢æ¥è¯¢çå¤çï¼è¯¢é® term å document frequencyï¼è¿ä¸ªè¯åæ´åç¡®ï¼ä½æ¯æ§è½ä¼åå·®ã*\n\n\n\n\n# å¨ elasticsearch ä¸­ï¼æ¯æä¹æ ¹æ®ä¸ä¸ªè¯æ¾å°å¯¹åºçåæç´¢å¼çï¼\n\nï¼1ï¼lucene çç´¢å¼è¿ç¨ï¼å°±æ¯æç§å¨ææ£ç´¢çåºæ¬è¿ç¨ï¼å°åæè¡¨åææ­¤æä»¶æ ¼å¼çè¿ç¨ã\n\nï¼2ï¼lucene çæç´¢è¿ç¨ï¼å°±æ¯æç§æ­¤æä»¶æ ¼å¼å°ç´¢å¼è¿å»çä¿¡æ¯è¯»åºæ¥ï¼ç¶åè®¡ç®æ¯ç¯ææ¡£æå(score)çè¿ç¨ã\n\n\n# elasticsearch å¨é¨ç½²æ¶ï¼å¯¹ linux çè®¾ç½®æåªäºä¼åæ¹æ³ï¼\n\nï¼1ï¼64 gb åå­çæºå¨æ¯éå¸¸çæ³çï¼ ä½æ¯ 32 gb å 16 gb æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 gb ä¼éå¾å¶åã\n\nï¼2ï¼å¦æä½ è¦å¨æ´å¿«ç cpus åæ´å¤çæ ¸å¿ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸å¿æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\nï¼3ï¼å¦æä½ è´æå¾èµ· ssdï¼å®å°è¿è¿è¶åºä»»ä½æè½¬ä»è´¨ã åºäº ssd çèç¹ï¼æ¥è¯¢åç´¢å¼æ§è½é½ææåãå¦æä½ è´æå¾èµ·ï¼ssd æ¯ä¸ä¸ªå¥½çéæ©ã\n\nï¼4ï¼å³ä½¿æ°æ®ä¸­å¿ä»¬è¿å¨å«å°ºï¼ä¹è¦é¿åéç¾¤è·¨è¶å¤ä¸ªæ°æ®ä¸­å¿ãç»å¯¹è¦é¿åéç¾¤è·¨è¶å¤§çå°çè·ç¦»ã\n\nï¼5ï¼è¯·ç¡®ä¿è¿è¡ä½ åºç¨ç¨åºç jvm åæå¡å¨ç jvm æ¯å®å¨ä¸æ ·çã å¨ elasticsearch çå ä¸ªå°æ¹ï¼ä½¿ç¨ java çæ¬å°åºååã\n\nï¼6ï¼éè¿è®¾ç½® gateway.recover_after_nodesãgateway.expected_nodesãgateway.recover_after_time å¯ä»¥å¨éç¾¤éå¯çæ¶åé¿åè¿å¤çåçäº¤æ¢ï¼è¿å¯è½ä¼è®©æ°æ®æ¢å¤ä»æ°ä¸ªå°æ¶ç¼©ç­ä¸ºå ç§éã\n\nï¼7ï¼elasticsearch é»è®¤è¢«éç½®ä¸ºä½¿ç¨åæ­åç°ï¼ä»¥é²æ­¢èç¹æ æä¸­å å¥éç¾¤ãåªæå¨åä¸å°æºå¨ä¸è¿è¡çèç¹æä¼èªå¨ç»æéç¾¤ãæå¥½ä½¿ç¨åæ­ä»£æ¿ç»æ­ã\n\nï¼8ï¼ä¸è¦éæä¿®æ¹åå¾åæ¶å¨ï¼cmsï¼ååä¸ªçº¿ç¨æ± çå¤§å°ã\n\nï¼9ï¼æä½ çåå­çï¼å°äºï¼ä¸åç» luceneï¼ä½ä¸è¦è¶è¿ 32 gbï¼ï¼ï¼éè¿ es_heap_size ç¯å¢åéè®¾ç½®ã\n\nï¼10ï¼åå­äº¤æ¢å°ç£çå¯¹æå¡å¨æ§è½æ¥è¯´æ¯è´å½çãå¦æåå­äº¤æ¢å°ç£çä¸ï¼ä¸ä¸ª 100 å¾®ç§çæä½å¯è½åæ 10 æ¯«ç§ã åæ³æ³é£ä¹å¤ 10 å¾®ç§çæä½æ¶å»¶ç´¯å èµ·æ¥ã ä¸é¾çåº swapping å¯¹äºæ§è½æ¯å¤ä¹å¯æã\n\nï¼11ï¼lucene ä½¿ç¨äºå¤§ é çæä»¶ãåæ¶ï¼elasticsearch å¨èç¹å http å®¢æ·ç«¯ä¹é´è¿è¡éä¿¡ä¹ä½¿ç¨äºå¤§éçå¥æ¥å­ã ææè¿ä¸åé½éè¦è¶³å¤çæä»¶æè¿°ç¬¦ãä½ åºè¯¥å¢å ä½ çæä»¶æè¿°ç¬¦ï¼è®¾ç½®ä¸ä¸ªå¾å¤§çå¼ï¼å¦ 64,000ã\n\nè¡¥åï¼ç´¢å¼é¶æ®µæ§è½æåæ¹æ³\n\nï¼1ï¼ä½¿ç¨æ¹éè¯·æ±å¹¶è°æ´å¶å¤§å°ï¼æ¯æ¬¡æ¹éæ°æ® 5â15 mb å¤§æ¯ä¸ªä¸éçèµ·å§ç¹ã\n\nï¼2ï¼å­å¨ï¼ä½¿ç¨ ssd\n\nï¼3ï¼æ®µååå¹¶ï¼elasticsearch é»è®¤å¼æ¯ 20 mb/sï¼å¯¹æºæ¢°ç£çåºè¯¥æ¯ä¸ªä¸éçè®¾ç½®ãå¦æä½ ç¨çæ¯ ssdï¼å¯ä»¥èèæé«å° 100â200 mb/sãå¦æä½ å¨åæ¹éå¯¼å¥ï¼å®å¨ä¸å¨ææç´¢ï¼ä½ å¯ä»¥å½»åºå³æåå¹¶éæµãå¦å¤è¿å¯ä»¥å¢å  index.translog.flush_threshold_size è®¾ç½®ï¼ä»é»è®¤ç 512 mb å°æ´å¤§ä¸äºçå¼ï¼æ¯å¦ 1 gbï¼è¿å¯ä»¥å¨ä¸æ¬¡æ¸ç©ºè§¦åçæ¶åå¨äºå¡æ¥å¿éç§¯ç´¯åºæ´å¤§çæ®µã\n\nï¼4ï¼å¦æä½ çæç´¢ç»æä¸éè¦è¿å®æ¶çåç¡®åº¦ï¼èèææ¯ä¸ªç´¢å¼ç index.refresh_interval æ¹å° 30sã\n\nï¼5ï¼å¦æä½ å¨åå¤§æ¹éå¯¼å¥ï¼èèéè¿è®¾ç½® index.number_of_replicas: 0 å³é­å¯æ¬ã\n\n\n# å¯¹äº gc æ¹é¢ï¼å¨ä½¿ç¨ elasticsearch æ¶è¦æ³¨æä»ä¹ï¼\n\nï¼1ï¼åæè¯å¸çç´¢å¼éè¦å¸¸é©»åå­ï¼æ æ³ gcï¼éè¦çæ§ data node ä¸ segmentmemory å¢é¿è¶å¿ã\n\nï¼2ï¼åç±»ç¼å­ï¼field cache, filter cache, indexing cache, bulk queue ç­ç­ï¼è¦è®¾ç½®åççå¤§å°ï¼å¹¶ä¸è¦åºè¯¥æ ¹æ®æåçæåµæ¥ç heap æ¯å¦å¤ç¨ï¼ä¹å°±æ¯åç±»ç¼å­å¨é¨å æ»¡çæ¶åï¼è¿æ heap ç©ºé´å¯ä»¥åéç»å¶ä»ä»»å¡åï¼é¿åéç¨ clear cache ç­âèªæ¬ºæ¬ºäººâçæ¹å¼æ¥éæ¾åå­ã\n\nï¼3ï¼é¿åè¿åå¤§éç»æéçæç´¢ä¸èåãç¡®å®éè¦å¤§éæåæ°æ®çåºæ¯ï¼å¯ä»¥éç¨ scan & scroll api æ¥å®ç°ã\n\nï¼4ï¼cluster stats é©»çåå­å¹¶æ æ³æ°´å¹³æ©å±ï¼è¶å¤§è§æ¨¡éç¾¤å¯ä»¥èèåææå¤ä¸ªéç¾¤éè¿ tribe node è¿æ¥ã\n\nï¼5ï¼æ³ç¥é heap å¤ä¸å¤ï¼å¿é¡»ç»åå®éåºç¨åºæ¯ï¼å¹¶å¯¹éç¾¤ç heap ä½¿ç¨æåµåæç»­ççæ§ã\n\nï¼6ï¼æ ¹æ®çæ§æ°æ®çè§£åå­éæ±ï¼åçéç½®åç±» circuit breakerï¼å°åå­æº¢åºé£é©éä½å°æä½\n\n\n# 18ãelasticsearch å¯¹äºå¤§æ°æ®éï¼ä¸äº¿éçº§ï¼çèåå¦ä½å®ç°ï¼\n\nelasticsearch æä¾çé¦ä¸ªè¿ä¼¼èåæ¯ cardinality åº¦éãå®æä¾ä¸ä¸ªå­æ®µçåºæ°ï¼å³è¯¥å­æ®µç distinct æè unique å¼çæ°ç®ãå®æ¯åºäº hll ç®æ³çãhll ä¼åå¯¹æä»¬çè¾å¥ä½åå¸è¿ç®ï¼ç¶åæ ¹æ®åå¸è¿ç®çç»æä¸­ç bits åæ¦çä¼°ç®ä»èå¾å°åºæ°ãå¶ç¹ç¹æ¯ï¼å¯éç½®çç²¾åº¦ï¼ç¨æ¥æ§å¶åå­çä½¿ç¨ï¼æ´ç²¾ç¡® ï¼ æ´å¤åå­ï¼ï¼å°çæ°æ®éç²¾åº¦æ¯éå¸¸é«çï¼æä»¬å¯ä»¥éè¿éç½®åæ°ï¼æ¥è®¾ç½®å»ééè¦çåºå®åå­ä½¿ç¨éãæ è®ºæ°åè¿æ¯æ°åäº¿çå¯ä¸å¼ï¼åå­ä½¿ç¨éåªä¸ä½ éç½®çç²¾ç¡®åº¦ç¸å³ã\n\n\n# 19ãå¨å¹¶åæåµä¸ï¼elasticsearch å¦æä¿è¯è¯»åä¸è´ï¼\n\nï¼1ï¼å¯ä»¥éè¿çæ¬å·ä½¿ç¨ä¹è§å¹¶åæ§å¶ï¼ä»¥ç¡®ä¿æ°çæ¬ä¸ä¼è¢«æ§çæ¬è¦çï¼ç±åºç¨å±æ¥å¤çå·ä½çå²çªï¼\n\nï¼2ï¼å¦å¤å¯¹äºåæä½ï¼ä¸è´æ§çº§å«æ¯æ quorum/one/allï¼é»è®¤ä¸º quorumï¼å³åªæå½å¤§å¤æ°åçå¯ç¨æ¶æåè®¸åæä½ãä½å³ä½¿å¤§å¤æ°å¯ç¨ï¼ä¹å¯è½å­å¨å ä¸ºç½ç»ç­åå å¯¼è´åå¥å¯æ¬å¤±è´¥ï¼è¿æ ·è¯¥å¯æ¬è¢«è®¤ä¸ºæéï¼åçå°ä¼å¨ä¸ä¸ªä¸åçèç¹ä¸éå»ºã\n\nï¼3ï¼å¯¹äºè¯»æä½ï¼å¯ä»¥è®¾ç½® replication ä¸º sync(é»è®¤)ï¼è¿ä½¿å¾æä½å¨ä¸»åçåå¯æ¬åçé½å®æåæä¼è¿åï¼å¦æè®¾ç½® replication ä¸º async æ¶ï¼ä¹å¯ä»¥éè¿è®¾ç½®æç´¢è¯·æ±åæ°_preference ä¸º primary æ¥æ¥è¯¢ä¸»åçï¼ç¡®ä¿ææ¡£æ¯ææ°çæ¬ã\n\n\n# 20ãå¦ä½çæ§ elasticsearch éç¾¤ç¶æï¼\n\nmarvel è®©ä½ å¯ä»¥å¾ç®åçéè¿ kibana çæ§ elasticsearchãä½ å¯ä»¥å®æ¶æ¥çä½ çéç¾¤å¥åº·ç¶æåæ§è½ï¼ä¹å¯ä»¥åæè¿å»çéç¾¤ãç´¢å¼åèç¹ææ ã\n\n\n# 21ãä»ç»ä¸ä½ ä»¬çµåæç´¢çæ´ä½ææ¯æ¶æã\n\n\n\n\n# ä»ç»ä¸ä¸ä½ ä»¬çä¸ªæ§åæç´¢æ¹æ¡ï¼\n\nåºäº word2vec å elasticsearch å®ç°ä¸ªæ§åæç´¢\n\nï¼1ï¼åºäº word2vecãelasticsearch åèªå®ä¹çèæ¬æä»¶ï¼æä»¬å°±å®ç°äºä¸ä¸ªä¸ªæ§åçæç´¢æå¡ï¼ç¸å¯¹äºåæçå®ç°ï¼æ°ççç¹å»çåè½¬åçé½æå¤§å¹çæåï¼\n\nï¼2ï¼åºäº word2vec çåååéè¿æä¸ä¸ªå¯ç¨ä¹å¤ï¼å°±æ¯å¯ä»¥ç¨æ¥å®ç°ç¸ä¼¼ååçæ¨èï¼\n\nï¼3ï¼ä½¿ç¨ word2vec æ¥å®ç°ä¸ªæ§åæç´¢æä¸ªæ§åæ¨èæ¯æä¸å®å±éæ§çï¼å ä¸ºå®åªè½å¤çç¨æ·ç¹å»åå²è¿æ ·çæ¶åºæ°æ®ï¼èæ æ³å¨é¢çå»èèç¨æ·åå¥½ï¼è¿ä¸ªè¿æ¯æå¾å¤§çæ¹è¿åæåçç©ºé´ï¼\n\n\n# æ¯å¦äºè§£å­å¸æ ï¼\n\nå¸¸ç¨å­å¸æ°æ®ç»æå¦ä¸æç¤ºï¼\n\n\n\ntrie çæ ¸å¿ææ³æ¯ç©ºé´æ¢æ¶é´ï¼å©ç¨å­ç¬¦ä¸²çå¬å±åç¼æ¥éä½æ¥è¯¢æ¶é´çå¼éä»¥è¾¾å°æé«æççç®çãå®æ 3 ä¸ªåºæ¬æ§è´¨ï¼\n\n1ï¼æ ¹èç¹ä¸åå«å­ç¬¦ï¼é¤æ ¹èç¹å¤æ¯ä¸ä¸ªèç¹é½åªåå«ä¸ä¸ªå­ç¬¦ã\n\n2ï¼ä»æ ¹èç¹å°æä¸èç¹ï¼è·¯å¾ä¸ç»è¿çå­ç¬¦è¿æ¥èµ·æ¥ï¼ä¸ºè¯¥èç¹å¯¹åºçå­ç¬¦ä¸²ã\n\n3ï¼æ¯ä¸ªèç¹çææå­èç¹åå«çå­ç¬¦é½ä¸ç¸åã\n\n\n\nï¼1ï¼å¯ä»¥çå°ï¼trie æ æ¯ä¸å±çèç¹æ°æ¯ 26^i çº§å«çãæä»¥ä¸ºäºèçç©ºé´ï¼æä»¬è¿å¯ä»¥ç¨å¨æé¾è¡¨ï¼æèç¨æ°ç»æ¥æ¨¡æå¨æãèç©ºé´çè±è´¹ï¼ä¸ä¼è¶è¿åè¯æ° Ã åè¯é¿åº¦ã\n\nï¼2ï¼å®ç°ï¼å¯¹æ¯ä¸ªç»ç¹å¼ä¸ä¸ªå­æ¯éå¤§å°çæ°ç»ï¼æ¯ä¸ªç»ç¹æä¸ä¸ªé¾è¡¨ï¼ä½¿ç¨å·¦å¿å­å³åå¼è¡¨ç¤ºæ³è®°å½è¿æ£µæ ï¼\n\nï¼3ï¼å¯¹äºä¸­æçå­å¸æ ï¼æ¯ä¸ªèç¹çå­èç¹ç¨ä¸ä¸ªåå¸è¡¨å­å¨ï¼è¿æ ·å°±ä¸ç¨æµªè´¹å¤ªå¤§çç©ºé´ï¼èä¸æ¥è¯¢éåº¦ä¸å¯ä»¥ä¿çåå¸çå¤æåº¦ o(1)ã\n\n\n# æ¼åçº éæ¯å¦ä½å®ç°çï¼\n\nï¼1ï¼æ¼åçº éæ¯åºäºç¼è¾è·ç¦»æ¥å®ç°ï¼ç¼è¾è·ç¦»æ¯ä¸ç§æ åçæ¹æ³ï¼å®ç¨æ¥è¡¨ç¤ºç»è¿æå¥ãå é¤åæ¿æ¢æä½ä»ä¸ä¸ªå­ç¬¦ä¸²è½¬æ¢å°å¦å¤ä¸ä¸ªå­ç¬¦ä¸²çæå°æä½æ­¥æ°ï¼\n\nï¼2ï¼ç¼è¾è·ç¦»çè®¡ç®è¿ç¨ï¼æ¯å¦è¦è®¡ç® batyu å beauty çç¼è¾è·ç¦»ï¼ååå»ºä¸ä¸ª 7Ã8 çè¡¨ï¼batyu é¿åº¦ä¸º 5ï¼coffee é¿åº¦ä¸º 6ï¼åå  2ï¼ï¼æ¥çï¼å¨å¦ä¸ä½ç½®å¡«å¥é»è²æ°å­ãå¶ä»æ ¼çè®¡ç®è¿ç¨æ¯åä»¥ä¸ä¸ä¸ªå¼çæå°å¼ï¼\n\nå¦ææä¸æ¹çå­ç¬¦ç­äºæå·¦æ¹çå­ç¬¦ï¼åä¸ºå·¦ä¸æ¹çæ°å­ãå¦åä¸ºå·¦ä¸æ¹çæ°å­+1ãï¼å¯¹äº 3,3 æ¥è¯´ä¸º 0ï¼\n\nå·¦æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\nä¸æ¹æ°å­+1ï¼å¯¹äº 3,3 æ ¼æ¥è¯´ä¸º 2ï¼\n\næç»åå³ä¸è§çå¼å³ä¸ºç¼è¾è·ç¦»çå¼ 3ã\n\n\n\nå¯¹äºæ¼åçº éï¼æä»¬èèæé ä¸ä¸ªåº¦éç©ºé´ï¼metric spaceï¼ï¼è¯¥ç©ºé´åä»»ä½å³ç³»æ»¡è¶³ä»¥ä¸ä¸æ¡åºæ¬æ¡ä»¶ï¼\n\nd(x,y) = 0 -- åå¦ x ä¸ y çè·ç¦»ä¸º 0ï¼å x=y\n\nd(x,y) = d(y,x) -- x å° y çè·ç¦»ç­åäº y å° x çè·ç¦»\n\nd(x,y) + d(y,z) >= d(x,z) -- ä¸è§ä¸ç­å¼\n\nï¼1ï¼æ ¹æ®ä¸è§ä¸ç­å¼ï¼åæ»¡è¶³ä¸ query è·ç¦»å¨ n èå´åçå¦ä¸ä¸ªå­ç¬¦è½¬ bï¼å¶ä¸ a çè·ç¦»æå¤§ä¸º d+nï¼æå°ä¸º d-nã\n\nï¼2ï¼bk æ çæé å°±è¿ç¨å¦ä¸ï¼æ¯ä¸ªèç¹æä»»æä¸ªå­èç¹ï¼æ¯æ¡è¾¹æä¸ªå¼è¡¨ç¤ºç¼è¾è·ç¦»ãææå­èç¹å°ç¶èç¹çè¾¹ä¸æ æ³¨ n è¡¨ç¤ºç¼è¾è·ç¦»æ°å¥½ä¸º nãæ¯å¦ï¼æä»¬ææ£µæ ç¶èç¹æ¯âbookâåä¸¤ä¸ªå­èç¹âcakeâåâbooksâï¼âbookâå°âbooksâçè¾¹æ å· 1ï¼âbookâå°âcakeâçè¾¹ä¸æ å· 4ãä»å­å¸éæé å¥½æ åï¼æ è®ºä½æ¶ä½ æ³æå¥æ°åè¯æ¶ï¼è®¡ç®è¯¥åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦»ï¼å¹¶ä¸æ¥æ¾æ°å¼ä¸º d(neweord, root)çè¾¹ãéå½å¾ä¸åå­èç¹è¿è¡æ¯è¾ï¼ç´å°æ²¡æå­èç¹ï¼ä½ å°±å¯ä»¥åå»ºæ°çå­èç¹å¹¶å°æ°åè¯ä¿å­å¨é£ãæ¯å¦ï¼æå¥âbooâå°åæä¸è¿°ä¾å­çæ ä¸­ï¼æä»¬åæ£æ¥æ ¹èç¹ï¼æ¥æ¾ d(âbookâ, âbooâ) = 1 çè¾¹ï¼ç¶åæ£æ¥æ å·ä¸º 1 çè¾¹çå­èç¹ï¼å¾å°åè¯âbooksâãæä»¬åè®¡ç®è·ç¦» d(âbooksâ, âbooâ)=2ï¼åå°æ°åè¯æå¨âbooksâä¹åï¼è¾¹æ å·ä¸º 2ã\n\nï¼3ï¼æ¥è¯¢ç¸ä¼¼è¯å¦ä¸ï¼è®¡ç®åè¯ä¸æ ¹èç¹çç¼è¾è·ç¦» dï¼ç¶åéå½æ¥æ¾æ¯ä¸ªå­èç¹æ å·ä¸º d-n å° d+nï¼åå«ï¼çè¾¹ãåå¦è¢«æ£æ¥çèç¹ä¸æç´¢åè¯çè·ç¦» d å°äº nï¼åè¿åè¯¥èç¹å¹¶ç»§ç»­æ¥è¯¢ãæ¯å¦è¾å¥ cape ä¸æå¤§å®¹å¿è·ç¦»ä¸º 1ï¼ååè®¡ç®åæ ¹çç¼è¾è·ç¦» d(âbookâ, âcapeâ)=4ï¼ç¶åæ¥çæ¾åæ ¹èç¹ä¹é´ç¼è¾è·ç¦»ä¸º 3 å° 5 çï¼è¿ä¸ªå°±æ¾å°äº cake è¿ä¸ªèç¹ï¼è®¡ç® d(âcakeâ, âcapeâ)=1ï¼æ»¡è¶³æ¡ä»¶æä»¥è¿å cakeï¼ç¶ååæ¾å cake èç¹ç¼è¾è·ç¦»æ¯ 0 å° 2 çï¼åå«æ¾å° cape å cart èç¹ï¼è¿æ ·å°±å¾å° cape è¿ä¸ªæ»¡è¶³æ¡ä»¶çç»æã\n\n",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch å¿«éå¥é¨",frontmatter:{title:"Elasticsearch å¿«éå¥é¨",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],permalink:"/pages/37b739/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/02.Elasticsearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/02.Elasticsearchå¿«éå¥é¨.md",key:"v-3e99c22e",path:"/pages/37b739/",headers:[{level:2,title:"ä¸ãElasticsearch ç®ä»",slug:"ä¸ãelasticsearch-ç®ä»",normalizedTitle:"ä¸ãelasticsearch ç®ä»",charIndex:267},{level:3,title:"ä»ä¹æ¯ Elasticsearch",slug:"ä»ä¹æ¯-elasticsearch",normalizedTitle:"ä»ä¹æ¯ elasticsearch",charIndex:290},{level:3,title:"æ ¸å¿æ¦å¿µ",slug:"æ ¸å¿æ¦å¿µ",normalizedTitle:"æ ¸å¿æ¦å¿µ",charIndex:671},{level:4,title:"Cluster",slug:"cluster",normalizedTitle:"cluster",charIndex:727},{level:4,title:"Node",slug:"node",normalizedTitle:"node",charIndex:798},{level:4,title:"Index",slug:"index",normalizedTitle:"index",charIndex:942},{level:4,title:"Type",slug:"type",normalizedTitle:"type",charIndex:1105},{level:4,title:"Document",slug:"document",normalizedTitle:"document",charIndex:1371},{level:4,title:"Field",slug:"field",normalizedTitle:"field",charIndex:1620},{level:4,title:"Shard",slug:"shard",normalizedTitle:"shard",charIndex:1710},{level:4,title:"Replica",slug:"replica",normalizedTitle:"replica",charIndex:1884},{level:4,title:"ES æ ¸å¿æ¦å¿µ vs. DB æ ¸å¿æ¦å¿µ",slug:"es-æ ¸å¿æ¦å¿µ-vs-db-æ ¸å¿æ¦å¿µ",normalizedTitle:"es æ ¸å¿æ¦å¿µ vs. db æ ¸å¿æ¦å¿µ",charIndex:2163},{level:2,title:"äºãElasticSearch åºæ¬åç",slug:"äºãelasticsearch-åºæ¬åç",normalizedTitle:"äºãelasticsearch åºæ¬åç",charIndex:2248},{level:3,title:"ES åæ°æ®è¿ç¨",slug:"es-åæ°æ®è¿ç¨",normalizedTitle:"es åæ°æ®è¿ç¨",charIndex:2273},{level:3,title:"ES è¯»æ°æ®è¿ç¨",slug:"es-è¯»æ°æ®è¿ç¨",normalizedTitle:"es è¯»æ°æ®è¿ç¨",charIndex:2550},{level:3,title:"es æç´¢æ°æ®è¿ç¨",slug:"es-æç´¢æ°æ®è¿ç¨",normalizedTitle:"es æç´¢æ°æ®è¿ç¨",charIndex:2891},{level:3,title:"åæ°æ®åºå±åç",slug:"åæ°æ®åºå±åç",normalizedTitle:"åæ°æ®åºå±åç",charIndex:3385},{level:3,title:"å é¤/æ´æ°æ°æ®åºå±åç",slug:"å é¤-æ´æ°æ°æ®åºå±åç",normalizedTitle:"å é¤/æ´æ°æ°æ®åºå±åç",charIndex:5641},{level:3,title:"åºå± lucene",slug:"åºå±-lucene",normalizedTitle:"åºå± lucene",charIndex:6081},{level:3,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:5631},{level:2,title:"åèèµæ",slug:"åèèµæ",normalizedTitle:"åèèµæ",charIndex:7165}],headersStr:"ä¸ãElasticsearch ç®ä» ä»ä¹æ¯ Elasticsearch æ ¸å¿æ¦å¿µ Cluster Node Index Type Document Field Shard Replica ES æ ¸å¿æ¦å¿µ vs. DB æ ¸å¿æ¦å¿µ äºãElasticSearch åºæ¬åç ES åæ°æ®è¿ç¨ ES è¯»æ°æ®è¿ç¨ es æç´¢æ°æ®è¿ç¨ åæ°æ®åºå±åç å é¤/æ´æ°æ°æ®åºå±åç åºå± lucene åæç´¢å¼ åèèµæ",content:'# Elasticsearch å¿«éå¥é¨\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> Elasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° ESã\n\n\n# ä¸ãElasticsearch ç®ä»\n\n\n# ä»ä¹æ¯ Elasticsearch\n\nElasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\nElasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n\nElasticSearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º JSON å­å¨ã\n\nElasticSearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº ES æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n\n# æ ¸å¿æ¦å¿µ\n\nindex -> type -> mapping -> document -> field\n\n\n# Cluster\n\néç¾¤åå«å¤ä¸ªèç¹ï¼æ¯ä¸ªèç¹å±äºåªä¸ªéç¾¤é½æ¯éè¿ä¸ä¸ªéç½®æ¥å³å®çï¼å¯¹äºä¸­å°ååºç¨æ¥è¯´ï¼åå¼å§ä¸ä¸ªéç¾¤å°±ä¸ä¸ªèç¹å¾æ­£å¸¸ã\n\n# Node\n\nNode æ¯éç¾¤ä¸­çä¸ä¸ªèç¹ï¼èç¹ä¹æä¸ä¸ªåç§°ï¼é»è®¤æ¯éæºåéçãé»è®¤èç¹ä¼å»å å¥ä¸ä¸ªåç§°ä¸º elasticsearch çéç¾¤ãå¦æç´æ¥å¯å¨ä¸å èç¹ï¼é£ä¹å®ä»¬ä¼èªå¨ç»æä¸ä¸ª elasticsearch éç¾¤ï¼å½ç¶ä¸ä¸ªèç¹ä¹å¯ä»¥ç»æ elasticsearch éç¾¤ã\n\n# Index\n\nå¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n\nES ä¼ä¸ºææå­æ®µå»ºç«ç´¢å¼ï¼ç»è¿å¤çååå¥ä¸ä¸ªååç´¢å¼ï¼Inverted Indexï¼ãæ¥æ¾æ°æ®çæ¶åï¼ç´æ¥æ¥æ¾è¯¥ç´¢å¼ã\n\næä»¥ï¼ES æ°æ®ç®¡ççé¡¶å±åä½å°±å«å Indexï¼ç´¢å¼ï¼ãå®æ¯åä¸ªæ°æ®åºçåä¹è¯ãæ¯ä¸ª Index ï¼å³æ°æ®åºï¼çåå­å¿é¡»æ¯å°åã\n\n# Type\n\næ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ã\n\nä¸åç Type åºè¯¥æç¸ä¼¼çç»æï¼schemaï¼ï¼ä¸¾ä¾æ¥è¯´ï¼idå­æ®µä¸è½å¨è¿ä¸ªç»æ¯å­ç¬¦ä¸²ï¼å¨å¦ä¸ä¸ªç»æ¯æ°å¼ãè¿æ¯ä¸å³ç³»åæ°æ®åºçè¡¨çä¸ä¸ªåºå«ãæ§è´¨å®å¨ä¸åçæ°æ®ï¼æ¯å¦productsålogsï¼åºè¯¥å­æä¸¤ä¸ª Indexï¼èä¸æ¯ä¸ä¸ª Index éé¢çä¸¤ä¸ª Typeï¼è½ç¶å¯ä»¥åå°ï¼ã\n\n> æ³¨æï¼æ ¹æ®è§åï¼Elastic 6.x çåªåè®¸æ¯ä¸ª Index åå«ä¸ä¸ª Typeï¼7.x çå°ä¼å½»åºç§»é¤ Typeã\n\n# Document\n\nIndex éé¢åæ¡çè®°å½ç§°ä¸º Documentï¼ææ¡£ï¼ãè®¸å¤æ¡ Document ææäºä¸ä¸ª Indexã\n\næ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n\nDocument ä½¿ç¨ JSON æ ¼å¼è¡¨ç¤ºï¼ä¸é¢æ¯ä¸ä¸ªä¾å­ã\n\n{\n"user": "å¼ ä¸",\n"title": "å·¥ç¨å¸",\n"desc": "æ°æ®åºç®¡ç"\n}\n\n\nåä¸ä¸ª Index éé¢ç Documentï¼ä¸è¦æ±æç¸åçç»æï¼schemeï¼ï¼ä½æ¯æå¥½ä¿æç¸åï¼è¿æ ·æå©äºæé«æç´¢æçã\n\n# Field\n\nå­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n\né»è®¤æåµä¸ï¼Elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n\n# Shard\n\nå½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼Elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n\n# Replica\n\nä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n# ES æ ¸å¿æ¦å¿µ vs. DB æ ¸å¿æ¦å¿µ\n\nES         DB\nindex      æ°æ®åº\ntype       æ°æ®è¡¨\ndocuemnt   ä¸è¡æ°æ®\n\n\n# äºãElasticSearch åºæ¬åç\n\n\n# ES åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# ES è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin è½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ NRTï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ Java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ IDï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ ID çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\nDOCID   DOC\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook\n2       è°·æ­å°å¾ä¹ç¶å ç Facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç Facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook ä¸ Wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« Facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nWORDID   WORD       DOCIDS\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        Facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ Facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n * æç« \n   * Install Elasticsearch with RPM\n   * https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html\n   * es-introduction\n   * es-write-query-search',normalizedContent:'# elasticsearch å¿«éå¥é¨\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> elasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° esã\n\n\n# ä¸ãelasticsearch ç®ä»\n\n\n# ä»ä¹æ¯ elasticsearch\n\nelasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\nelasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n\nelasticsearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º json å­å¨ã\n\nelasticsearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº es æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n\n# æ ¸å¿æ¦å¿µ\n\nindex -> type -> mapping -> document -> field\n\n\n# cluster\n\néç¾¤åå«å¤ä¸ªèç¹ï¼æ¯ä¸ªèç¹å±äºåªä¸ªéç¾¤é½æ¯éè¿ä¸ä¸ªéç½®æ¥å³å®çï¼å¯¹äºä¸­å°ååºç¨æ¥è¯´ï¼åå¼å§ä¸ä¸ªéç¾¤å°±ä¸ä¸ªèç¹å¾æ­£å¸¸ã\n\n# node\n\nnode æ¯éç¾¤ä¸­çä¸ä¸ªèç¹ï¼èç¹ä¹æä¸ä¸ªåç§°ï¼é»è®¤æ¯éæºåéçãé»è®¤èç¹ä¼å»å å¥ä¸ä¸ªåç§°ä¸º elasticsearch çéç¾¤ãå¦æç´æ¥å¯å¨ä¸å èç¹ï¼é£ä¹å®ä»¬ä¼èªå¨ç»æä¸ä¸ª elasticsearch éç¾¤ï¼å½ç¶ä¸ä¸ªèç¹ä¹å¯ä»¥ç»æ elasticsearch éç¾¤ã\n\n# index\n\nå¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n\nes ä¼ä¸ºææå­æ®µå»ºç«ç´¢å¼ï¼ç»è¿å¤çååå¥ä¸ä¸ªååç´¢å¼ï¼inverted indexï¼ãæ¥æ¾æ°æ®çæ¶åï¼ç´æ¥æ¥æ¾è¯¥ç´¢å¼ã\n\næä»¥ï¼es æ°æ®ç®¡ççé¡¶å±åä½å°±å«å indexï¼ç´¢å¼ï¼ãå®æ¯åä¸ªæ°æ®åºçåä¹è¯ãæ¯ä¸ª index ï¼å³æ°æ®åºï¼çåå­å¿é¡»æ¯å°åã\n\n# type\n\næ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ã\n\nä¸åç type åºè¯¥æç¸ä¼¼çç»æï¼schemaï¼ï¼ä¸¾ä¾æ¥è¯´ï¼idå­æ®µä¸è½å¨è¿ä¸ªç»æ¯å­ç¬¦ä¸²ï¼å¨å¦ä¸ä¸ªç»æ¯æ°å¼ãè¿æ¯ä¸å³ç³»åæ°æ®åºçè¡¨çä¸ä¸ªåºå«ãæ§è´¨å®å¨ä¸åçæ°æ®ï¼æ¯å¦productsålogsï¼åºè¯¥å­æä¸¤ä¸ª indexï¼èä¸æ¯ä¸ä¸ª index éé¢çä¸¤ä¸ª typeï¼è½ç¶å¯ä»¥åå°ï¼ã\n\n> æ³¨æï¼æ ¹æ®è§åï¼elastic 6.x çåªåè®¸æ¯ä¸ª index åå«ä¸ä¸ª typeï¼7.x çå°ä¼å½»åºç§»é¤ typeã\n\n# document\n\nindex éé¢åæ¡çè®°å½ç§°ä¸º documentï¼ææ¡£ï¼ãè®¸å¤æ¡ document ææäºä¸ä¸ª indexã\n\næ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n\ndocument ä½¿ç¨ json æ ¼å¼è¡¨ç¤ºï¼ä¸é¢æ¯ä¸ä¸ªä¾å­ã\n\n{\n"user": "å¼ ä¸",\n"title": "å·¥ç¨å¸",\n"desc": "æ°æ®åºç®¡ç"\n}\n\n\nåä¸ä¸ª index éé¢ç documentï¼ä¸è¦æ±æç¸åçç»æï¼schemeï¼ï¼ä½æ¯æå¥½ä¿æç¸åï¼è¿æ ·æå©äºæé«æç´¢æçã\n\n# field\n\nå­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n\né»è®¤æåµä¸ï¼elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n\n# shard\n\nå½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n\n# replica\n\nä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n# es æ ¸å¿æ¦å¿µ vs. db æ ¸å¿æ¦å¿µ\n\nes         db\nindex      æ°æ®åº\ntype       æ°æ®è¡¨\ndocuemnt   ä¸è¡æ°æ®\n\n\n# äºãelasticsearch åºæ¬åç\n\n\n# es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n\n# es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin è½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n\n# es æç´¢æ°æ®è¿ç¨\n\nes æå¼ºå¤§çæ¯åå¨ææ£ç´¢ï¼å°±æ¯æ¯å¦ä½ æä¸æ¡æ°æ®ï¼\n\njavaçå¥½ç©å¿å\njavaå¥½é¾å­¦å\nj2eeç¹å«ç\n\n\nä½ æ ¹æ® java å³é®è¯æ¥æç´¢ï¼å°åå« java ç document ç»æç´¢åºæ¥ães å°±ä¼ç»ä½ è¿åï¼java çå¥½ç©å¿åï¼java å¥½é¾å­¦åã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä¸ä¸ª coordinate node ã\n * åè°èç¹å°æç´¢è¯·æ±è½¬åå°ææç shard å¯¹åºç primary shard æ replica shard ï¼é½å¯ä»¥ã\n * query phaseï¼æ¯ä¸ª shard å°èªå·±çæç´¢ç»æï¼å¶å®å°±æ¯ä¸äº doc id ï¼è¿åç»åè°èç¹ï¼ç±åè°èç¹è¿è¡æ°æ®çåå¹¶ãæåºãåé¡µç­æä½ï¼äº§åºæç»ç»æã\n * fetch phaseï¼æ¥çç±åè°èç¹æ ¹æ® doc id å»åä¸ªèç¹ä¸æåå®éç document æ°æ®ï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n> åè¯·æ±æ¯åå¥ primary shardï¼ç¶ååæ­¥ç»ææç replica shardï¼è¯»è¯·æ±å¯ä»¥ä» primary shard æ replica shard è¯»åï¼éç¨çæ¯éæºè½®è¯¢ç®æ³ã\n\n\n# åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ nrtï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n\n# å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n\n# åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n\n# åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ idï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ id çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\ndocid   doc\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook\n2       è°·æ­å°å¾ä¹ç¶å ç facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook ä¸ wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nwordid   word       docids\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# åèèµæ\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n * æç« \n   * install elasticsearch with rpm\n   * https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html\n   * es-introduction\n   * es-write-query-search',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch ç®ä»",frontmatter:{title:"Elasticsearch ç®ä»",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],permalink:"/pages/6f7391/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/03.Elasticsearch%E7%AE%80%E4%BB%8B.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/03.Elasticsearchç®ä».md",key:"v-29937047",path:"/pages/6f7391/",headers:[{level:2,title:"1. Elasticsearch ç¹ç¹",slug:"_1-elasticsearch-ç¹ç¹",normalizedTitle:"1. elasticsearch ç¹ç¹",charIndex:429},{level:2,title:"2. Elasticsearch åå±åå²",slug:"_2-elasticsearch-åå±åå²",normalizedTitle:"2. elasticsearch åå±åå²",charIndex:452},{level:2,title:"3. Elasticsearch æ¦å¿µ",slug:"_3-elasticsearch-æ¦å¿µ",normalizedTitle:"3. elasticsearch æ¦å¿µ",charIndex:477},{level:3,title:"3.1. è¿å®æ¶ï¼NRTï¼",slug:"_3-1-è¿å®æ¶-nrt",normalizedTitle:"3.1. è¿å®æ¶ï¼nrtï¼",charIndex:502},{level:3,title:"3.2. ç´¢å¼ï¼Indexï¼",slug:"_3-2-ç´¢å¼-index",normalizedTitle:"3.2. ç´¢å¼ï¼indexï¼",charIndex:521},{level:4,title:"åæç´¢å¼",slug:"åæç´¢å¼",normalizedTitle:"åæç´¢å¼",charIndex:3842},{level:4,title:"index template",slug:"index-template",normalizedTitle:"index template",charIndex:4198},{level:4,title:"dynamic template",slug:"dynamic-template",normalizedTitle:"dynamic template",charIndex:5398},{level:3,title:"3.3. ~~ç±»åï¼Typeï¼~~",slug:"_3-3-ç±»å-type",normalizedTitle:"3.3. <s>ç±»åï¼typeï¼</s>",charIndex:null},{level:3,title:"3.4. ææ¡£ï¼Documentï¼",slug:"_3-4-ææ¡£-document",normalizedTitle:"3.4. ææ¡£ï¼documentï¼",charIndex:560},{level:4,title:"ææ¡£çåæ°æ®",slug:"ææ¡£çåæ°æ®",normalizedTitle:"ææ¡£çåæ°æ®",charIndex:7037},{level:3,title:"3.5. èç¹ï¼Nodeï¼",slug:"_3-5-èç¹-node",normalizedTitle:"3.5. èç¹ï¼nodeï¼",charIndex:583},{level:4,title:"èç¹ç®ä»",slug:"èç¹ç®ä»",normalizedTitle:"èç¹ç®ä»",charIndex:7510},{level:4,title:"èç¹ç±»å",slug:"èç¹ç±»å",normalizedTitle:"èç¹ç±»å",charIndex:7730},{level:4,title:"èç¹éç½®",slug:"èç¹éç½®",normalizedTitle:"èç¹éç½®",charIndex:8306},{level:3,title:"3.6. éç¾¤ï¼Clusterï¼",slug:"_3-6-éç¾¤-cluster",normalizedTitle:"3.6. éç¾¤ï¼clusterï¼",charIndex:602},{level:4,title:"éç¾¤ç®ä»",slug:"éç¾¤ç®ä»",normalizedTitle:"éç¾¤ç®ä»",charIndex:8535},{level:4,title:"éç¾¤å¥åº·",slug:"éç¾¤å¥åº·",normalizedTitle:"éç¾¤å¥åº·",charIndex:8992},{level:3,title:"3.7. åçï¼Shardsï¼",slug:"_3-7-åç-shards",normalizedTitle:"3.7. åçï¼shardsï¼",charIndex:624},{level:4,title:"åçç®ä»",slug:"åçç®ä»",normalizedTitle:"åçç®ä»",charIndex:9745},{level:4,title:"ä¸»åçåå¯åç",slug:"ä¸»åçåå¯åç",normalizedTitle:"ä¸»åçåå¯åç",charIndex:10023},{level:3,title:"3.8. å¯æ¬ï¼Replicasï¼",slug:"_3-8-å¯æ¬-replicas",normalizedTitle:"3.8. å¯æ¬ï¼replicasï¼",charIndex:645},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:666}],headersStr:"1. Elasticsearch ç¹ç¹ 2. Elasticsearch åå±åå² 3. Elasticsearch æ¦å¿µ 3.1. è¿å®æ¶ï¼NRTï¼ 3.2. ç´¢å¼ï¼Indexï¼ åæç´¢å¼ index template dynamic template 3.3. ~~ç±»åï¼Typeï¼~~ 3.4. ææ¡£ï¼Documentï¼ ææ¡£çåæ°æ® 3.5. èç¹ï¼Nodeï¼ èç¹ç®ä» èç¹ç±»å èç¹éç½® 3.6. éç¾¤ï¼Clusterï¼ éç¾¤ç®ä» éç¾¤å¥åº· 3.7. åçï¼Shardsï¼ åçç®ä» ä¸»åçåå¯åç 3.8. å¯æ¬ï¼Replicasï¼ 4. åèèµæ",content:'# Elasticsearch ç®ä»\n\nElasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\nå®ç¨äºå¨ææç´¢ãç»æåæç´¢ãåæä»¥åå°è¿ä¸èæ··åä½¿ç¨ï¼\n\n * ç»´åºç¾ç§ä½¿ç¨ Elasticsearch æä¾å¨ææç´¢å¹¶é«äº®å³é®å­ï¼ä»¥å**è¾å¥å®æ¶æç´¢(search-as-you-type)åæç´¢çº é(did-you-mean)**ç­æç´¢å»ºè®®åè½ã\n * è±å½å«æ¥ä½¿ç¨ Elasticsearch ç»åç¨æ·æ¥å¿åç¤¾äº¤ç½ç»æ°æ®æä¾ç»ä»ä»¬çç¼è¾ä»¥å®æ¶çåé¦ï¼ä»¥ä¾¿åæ¶äºè§£å¬ä¼å¯¹æ°åè¡¨çæç« çååºã\n * StackOverflow ç»åå¨ææç´¢ä¸å°çä½ç½®æ¥è¯¢ï¼ä»¥åmore-like-thisåè½æ¥æ¾å°ç¸å³çé®é¢åç­æ¡ã\n * Github ä½¿ç¨ Elasticsearch æ£ç´¢ 1300 äº¿è¡çä»£ç ã\n\n * 1. Elasticsearch ç¹ç¹\n * 2. Elasticsearch åå±åå²\n * 3. Elasticsearch æ¦å¿µ\n   * 3.1. è¿å®æ¶ï¼NRTï¼\n   * 3.2. ç´¢å¼ï¼Indexï¼\n   * 3.3. ç±»åï¼Typeï¼\n   * 3.4. ææ¡£ï¼Documentï¼\n   * 3.5. èç¹ï¼Nodeï¼\n   * 3.6. éç¾¤ï¼Clusterï¼\n   * 3.7. åçï¼Shardsï¼\n   * 3.8. å¯æ¬ï¼Replicasï¼\n * 4. åèèµæ\n\n\n# 1. Elasticsearch ç¹ç¹\n\n * åå¸å¼çå®æ¶æä»¶å­å¨ï¼æ¯ä¸ªå­æ®µé½è¢«ç´¢å¼å¹¶å¯è¢«æç´¢ï¼\n * åå¸å¼çå®æ¶åææç´¢å¼æï¼\n * å¯å¼¹æ§æ©å±å°ä¸ç¾å°æå¡å¨è§æ¨¡ï¼å¤ç PB çº§ç»æåæéç»æåæ°æ®ï¼\n * å¼ç®±å³ç¨ï¼å®è£å³å¯ä½¿ç¨ï¼ï¼å®æä¾äºè®¸å¤åççç¼ºçå¼ï¼å¹¶å¯¹åå­¦èéèäºå¤æçæç´¢å¼æçè®ºãåªéå¾å°çå­¦ä¹ æ¢å¯å¨çäº§ç¯å¢ä¸­ä½¿ç¨ã\n\n\n# 2. Elasticsearch åå±åå²\n\n * 2010 å¹´ 2 æ 8 æ¥ï¼Elasticsearch ç¬¬ä¸ä¸ªå¬å¼çæ¬åå¸ã\n\n * 2010 å¹´ 5 æ 14 æ¥ï¼åå¸ç¬¬ä¸ä¸ªå·æéç¨ç¢æä¹çåå§çæ¬ 0.7.0 ï¼å·æå¦ä¸ç¹å¾ï¼\n\n * Zen Discovery èªå¨åç°æ¨¡åï¼\n   \n   * æ¯æ Groovy Clientï¼\n\n * ç®åçæä»¶ç®¡çæºå¶ï¼\n   \n   * æ´å¥½å°æ¯æ icu åè¯å¨ï¼\n\n * æ´å¤çç®¡ç apiã\n\n * 2013 å¹´åï¼GitHub æå¼äº Solrï¼éå ElasticSearch æ¥åå¶ PB çº§çæç´¢ã\n\n * 2014 å¹´ 2 æ 14 æ¥ï¼åå¸ 1.0.0 çæ¬ï¼å¢å å¦ä¸éè¦ç¹æ§ï¼\n\n * æ¯æ Snapshot/Restore API å¤ä»½æ¢å¤ APIï¼\n   \n   * æ¯æèååæ Aggregationsï¼\n\n * æ¯æ cat apiï¼\n   \n   * æ¯ææ­è·¯å¨ï¼\n\n * å¼å¥ Doc valuesã\n\n * 2015 å¹´ 10 æ 28 æ¥ï¼åå¸ 2.0.0 çæ¬ï¼æå¦ä¸éè¦ç¹æ§ï¼\n\n * å¢å äº Pipleline Aggregationsï¼\n   \n   * query/filter æ¥è¯¢åå¹¶ï¼é½åå¹¶å° query ä¸­ï¼æ ¹æ®ä¸åçä¸ä¸ææ§è¡ä¸åçæ¥è¯¢ï¼\n\n * åç¼©å­å¨å¯éç½®ï¼\n   \n   * Rivers æ¨¡åè¢«ç§»é¤ï¼\n\n * Multicast ç»æ­åç°è¢«ç§»é¤ï¼æä¸ºä¸ä¸ªæä»¶ï¼çäº§ç¯å¢å¿é¡»éç½®åæ­å°åã\n\n * 2016 å¹´ 10 æ 26 æ¥ï¼åå¸ 5.0.0 çæ¬ï¼æå¦ä¸éå¤§ç¹æ§ååï¼\n\n * Lucene 6.x çæ¯æï¼ç£çç©ºé´å°ä¸åï¼ç´¢å¼æ¶é´å°ä¸åï¼æ¥è¯¢æ§è½æå 25%ï¼æ¯æ IPV6ï¼\n   \n   * Internal Engine çº§å«ç§»é¤äºç¨äºé¿ååä¸ææ¡£å¹¶åæ´æ°çç«äºéï¼å¸¦æ¥ 15%-20% çæ§è½æåï¼\n\n * Shrink APIï¼å®å¯å°åçæ°è¿è¡æ¶ç¼©æå®çå æ°ï¼å¦ä¹åä½ æ¯ 15 ä¸ªåçï¼ä½ å¯ä»¥æ¶ç¼©æ 5 ä¸ªæè 3 ä¸ªåæè 1 ä¸ªï¼é£ä¹æä»¬å°±å¯ä»¥æ³è±¡æè¿æ ·ä¸ç§åºæ¯ï¼å¨åå¥ååéå¸¸å¤§çæ¶éé¶æ®µï¼è®¾ç½®è¶³å¤å¤çç´¢å¼ï¼ååå©ç¨ shard çå¹¶è¡åè½åï¼ç´¢å¼åå®ä¹åæ¶ç¼©ææ´å°ç shardï¼æé«æ¥è¯¢æ§è½ï¼\n   \n   * æä¾äºç¬¬ä¸ä¸ª Java åçç REST å®¢æ·ç«¯ SDKï¼\n\n * IngestNodeï¼ä¹åå¦æéè¦å¯¹æ°æ®è¿è¡å å·¥ï¼é½æ¯å¨ç´¢å¼ä¹åè¿è¡å¤çï¼æ¯å¦ logstash å¯ä»¥å¯¹æ¥å¿è¿è¡ç»æååè½¬æ¢ï¼ç°å¨ç´æ¥å¨ es å°±å¯ä»¥å¤çäºï¼\n   \n   * æä¾äº Painless èæ¬ï¼ä»£æ¿ Groovy èæ¬ï¼\n   * ç§»é¤ site pluginsï¼å°±æ¯è¯´ headãbigdesk é½ä¸è½ç´æ¥è£ es éé¢äºï¼ä¸è¿å¯ä»¥é¨ç½²ç¬ç«ç«ç¹ï¼åæ­£é½æ¯éææä»¶ï¼æå¼å kibana æä»¶ï¼\n   * æ°å¢ Sliced Scroll ç±»åï¼ç°å¨ Scroll æ¥å£å¯ä»¥å¹¶åæ¥è¿è¡æ°æ®éåäºãæ¯ä¸ª Scroll è¯·æ±ï¼å¯ä»¥åæå¤ä¸ª Slice è¯·æ±ï¼å¯ä»¥çè§£ä¸ºåçï¼å Slice ç¬ç«å¹¶è¡ï¼å©ç¨ Scroll éå»ºæèéåè¦å¿«å¾å¤åï¼\n   * æ°å¢äº Profile APIï¼\n   * æ°å¢äº Rollover APIï¼\n   * æ°å¢ Reindexï¼\n   * å¼å¥æ°çå­æ®µç±»å Text/Keyword æ¥æ¿æ¢ Stringï¼\n   * éå¶ç´¢å¼è¯·æ±å¤§å°ï¼é¿åå¤§éå¹¶åè¯·æ±åå® ESï¼\n   * éå¶åä¸ªè¯·æ±ç shards æ°éï¼é»è®¤ 1000 ä¸ªã\n\n * 2017 å¹´ 8 æ 31 æ¥ï¼åå¸ 6.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * ç¨çæ§ Doc Values çæ¯æï¼\n   \n   * Index Sortingï¼å³ç´¢å¼é¶æ®µçæåºï¼\n\n * é¡ºåºå·çæ¯æï¼æ¯ä¸ª es çæä½é½æä¸ä¸ªé¡ºåºç¼å·ï¼ç±»ä¼¼å¢éè®¾è®¡ï¼ï¼\n   \n   * æ ç¼æ»å¨åçº§ï¼\n\n * ä» 6.0 å¼å§ä¸æ¯æä¸ä¸ª index éé¢å­å¨å¤ä¸ª typeï¼\n   \n   * Index-template inheritanceï¼ç´¢å¼çæ¬çç»§æ¿ï¼ç®åç´¢å¼æ¨¡æ¿æ¯ææå¹éçé½ä¼åå¹¶ï¼è¿æ ·ä¼é æç´¢å¼æ¨¡æ¿æä¸äºå²çªé®é¢ï¼ 6.0 å°ä¼åªå¹éä¸ä¸ªï¼ç´¢å¼åå»ºæ¶ä¹ä¼è¿è¡éªè¯ï¼\n   * Load aware shard routingï¼ åºäºè´è½½çè¯·æ±è·¯ç±ï¼ç®åçæç´¢è¯·æ±æ¯å¨èç¹è½®è¯¢ï¼é£ä¹æ§è½ææ¢çèç¹å¾å¾ä¼é ææ´ä½çå»¶è¿å¢å ï¼æ°çå®ç°æ¹å¼å°åºäºéåçèè´¹æ¶é´èªå¨è°èéåé¿åº¦ï¼è´è½½é«çèç¹çéåé¿åº¦å°åå°ï¼è®©å¶ä»èç¹åææ´å¤çååï¼æç´¢åç´¢å¼é½å°åºäºè¿ç§æºå¶ï¼\n   * å·²ç»å³é­çç´¢å¼å°ä¹æ¯æ replica çèªå¨å¤çï¼ç¡®ä¿æ°æ®å¯é ã\n\n * 2019 å¹´ 4 æ 10 æ¥ï¼åå¸ 7.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * éç¾¤è¿æ¥ååï¼TransportClient è¢«åºå¼ï¼es7 ç java ä»£ç ï¼åªè½ä½¿ç¨ restclientï¼å¯¹äº java ç¼ç¨ï¼å»ºè®®éç¨ High-level-rest-client çæ¹å¼æä½ ES éç¾¤ï¼\n   \n   * ES ç¨åºåé»è®¤æå jdkï¼7.x çæ¬çç¨åºåå¤§å°åæ 300MB+ï¼å¯¹æ¯ 6.xï¼åå¤§äº 200MB+ï¼è¿æ­£æ¯ JDK çå¤§å°ï¼\n\n * éç¨åºäº Lucene 9.0ï¼\n   \n   * æ­£å¼åºé¤åä¸ªç´¢å¼ä¸å¤ Type çæ¯æï¼es6 æ¶ï¼å®æ¹å°±æå°äº es7 ä¼å é¤ typeï¼å¹¶ä¸ es6 æ¶ï¼å·²ç»è§å®æ¯ä¸ä¸ª index åªè½æä¸ä¸ª typeãå¨ es7 ä¸­ï¼ä½¿ç¨é»è®¤ç _doc ä½ä¸º typeï¼å®æ¹è¯´å¨ 8.x çæ¬ä¼å½»åºç§»é¤ typeãapi è¯·æ±æ¹å¼ä¹åéååï¼å¦è·å¾æç´¢å¼çæ ID çææ¡£ï¼GET index/_doc/id å¶ä¸­ index å id ä¸ºå·ä½çå¼ï¼\n\n * å¼å¥äºçæ­£çåå­æ­è·¯å¨ï¼å®å¯ä»¥æ´ç²¾åå°æ£æµåºæ æ³å¤ççè¯·æ±ï¼å¹¶é²æ­¢å®ä»¬ä½¿åä¸ªèç¹ä¸ç¨³å®ï¼\n   \n   * Zen2 æ¯ Elasticsearch çå¨æ°éç¾¤åè°å±ï¼æé«äºå¯é æ§ãæ§è½åç¨æ·ä½éªï¼åå¾æ´å¿«ãæ´å®å¨ï¼å¹¶æ´æäºä½¿ç¨ã\n\n\n# 3. Elasticsearch æ¦å¿µ\n\nä¸åæä¸äºæ¦å¿µæ¯ Elasticsearch çæ ¸å¿ãä»ä¸å¼å§å°±çè§£è¿äºæ¦å¿µå°æå¤§å°å¸®å©ç®åå­¦ä¹  Elasticsearch çè¿ç¨ã\n\n\n# 3.1. è¿å®æ¶ï¼NRTï¼\n\nElasticsearch æ¯ä¸ä¸ªè¿ä¹å®æ¶çæç´¢å¹³å°ãè¿æå³çä»ç´¢å¼ææ¡£å°å¯æç´¢ææ¡£çæ¶é´æä¸ç¹å»¶è¿ï¼éå¸¸æ¯ä¸ç§ï¼ã\n\n\n# 3.2. ç´¢å¼ï¼Indexï¼\n\nç´¢å¼å¨ä¸åè¯­å¢ï¼æçä¸åçå«ä¹\n\n * ç´¢å¼ï¼åè¯ï¼ï¼ä¸ä¸ª ç´¢å¼ ç±»ä¼¼äºä¼ ç»å³ç³»æ°æ®åºä¸­çä¸ä¸ª æ°æ®åº ï¼æ¯ä¸ä¸ªå­å¨å³ç³»åææ¡£çå®¹å¨ã ç´¢å¼ (index) çå¤æ°è¯ä¸º indices æ indexes ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n * ç´¢å¼ï¼å¨è¯ï¼ï¼ç´¢å¼ä¸ä¸ªææ¡£ å°±æ¯å­å¨ä¸ä¸ªææ¡£å°ä¸ä¸ª ç´¢å¼ ï¼åè¯ï¼ä¸­ä»¥ä¾¿è¢«æ£ç´¢åæ¥è¯¢ãè¿éå¸¸ç±»ä¼¼äº SQL è¯­å¥ä¸­ç INSERT å³é®è¯ï¼é¤äºææ¡£å·²å­å¨æ¶ï¼æ°ææ¡£ä¼æ¿æ¢æ§ææ¡£æåµä¹å¤ã\n * åæç´¢å¼ï¼å³ç³»åæ°æ®åºéè¿å¢å ä¸ä¸ªç´¢å¼æ¯å¦ä¸ä¸ª B æ ç´¢å¼å°æå®çåä¸ï¼ä»¥ä¾¿æåæ°æ®æ£ç´¢éåº¦ãElasticsearch å Lucene ä½¿ç¨äºä¸ä¸ªå«å åæç´¢å¼ çç»ææ¥è¾¾å°ç¸åçç®çã\n\nç´¢å¼ç Mapping å Setting\n\n * Mapping å®ä¹ææ¡£å­æ®µçç±»å\n * Setting å®ä¹ä¸åçæ°æ®åå¸\n\nç¤ºä¾ï¼\n\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# åæç´¢å¼\n\n\n\n# index template\n\nindex templateï¼ç´¢å¼æ¨¡æ¿ï¼å¸®å©ç¨æ·è®¾å® Mapping å Settingï¼å¹¶æç§ä¸å®çè§åï¼èªå¨å¹éå°æ°åå»ºçç´¢å¼ä¹ä¸ã\n\n * æ¨¡æ¿ä»å¨ä¸ä¸ªç´¢å¼è¢«åå»ºæ¶ï¼æä¼äº§çä½ç¨ãä¿®æ¹æ¨¡æ¿ä¸ä¼å½±åå·²åå»ºçç´¢å¼ã\n * ä½ å¯ä»¥è®¾å®å¤ä¸ªç´¢å¼æ¨¡æ¿ï¼è¿äºè®¾ç½®ä¼è¢« merge å¨ä¸èµ·ã\n * ä½ å¯ä»¥æå® order çæ°å¼ï¼æ§å¶ merge çè¿ç¨ã\n\nå½æ°å»ºä¸ä¸ªç´¢å¼æ¶\n\n * åºç¨ ES é»è®¤ç Mapping å Setting\n * åºç¨ order æ°å¼ä½ç index template ä¸­çè®¾å®\n * åºç¨ order æ°å¼é«ç index template ä¸­çè®¾å®ï¼ä¹åçè®¾å®ä¼è¢«è¦ç\n * åºç¨åå»ºç´¢å¼æ¯ï¼ç¨æ·ææå®ç Mapping å Settingï¼å¹¶è¦çä¹åæ¨¡æ¿ä¸­çè®¾å®ã\n\nç¤ºä¾ï¼åå»ºé»è®¤ç´¢å¼æ¨¡æ¿\n\nPUT _template/template_default\n{\n  "index_patterns": ["*"],\n  "order": 0,\n  "version": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 1\n  }\n}\n\nPUT /_template/template_test\n{\n  "index_patterns": ["test*"],\n  "order": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 2\n  },\n  "mappings": {\n    "date_detection": false,\n    "numeric_detection": true\n  }\n}\n\n# æ¥çç´¢å¼æ¨¡æ¿\nGET /_template/template_default\nGET /_template/temp*\n\n#åå¥æ°çæ°æ®ï¼indexä»¥testå¼å¤´\nPUT testtemplate/_doc/1\n{\n  "someNumber": "1",\n  "someDate": "2019/01/01"\n}\nGET testtemplate/_mapping\nGET testtemplate/_settings\n\nPUT testmy\n{\n\t"settings":{\n\t\t"number_of_replicas":5\n\t}\n}\n\nPUT testmy/_doc/1\n{\n  "key": "value"\n}\n\nGET testmy/_settings\nDELETE testmy\nDELETE /_template/template_default\nDELETE /_template/template_test\n\n\n# dynamic template\n\n * æ ¹æ® ES è¯å«çæ°æ®ç±»åï¼ç»åå­æ®µåç§°ï¼æ¥å¨æè®¾å®å­æ®µç±»å\n   * ææçå­ç¬¦ä¸²ç±»åé½è®¾å®æ Keywordï¼æèå³é­ keyword å­æ®µã\n   * is å¼å¤´çå­æ®µé½è®¾ç½®æ boolean\n   * long_ å¼å¤´çé½è®¾ç½®æ long ç±»å\n * dynamic template æ¯å®ä¹å¨æä¸ªç´¢å¼ç Mapping ä¸­\n * template æä¸ä¸ªåç§°\n * å¹éè§åæ¯ä¸ä¸ªæ°ç»\n * ä¸ºå¹éå°å­æ®µè®¾ç½® Mapping\n\nç¤ºä¾ï¼\n\n#Dynaminc Mapping æ ¹æ®ç±»ååå­æ®µå\nDELETE my_index\n\nPUT my_index/_doc/1\n{\n  "firstName": "Ruan",\n  "isVIP": "true"\n}\n\nGET my_index/_mapping\n\nDELETE my_index\nPUT my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "strings_as_boolean": {\n          "match_mapping_type": "string",\n          "match": "is*",\n          "mapping": {\n            "type": "boolean"\n          }\n        }\n      },\n      {\n        "strings_as_keywords": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "keyword"\n          }\n        }\n      }\n    ]\n  }\n}\nGET my_index/_mapping\n\nDELETE my_index\n#ç»åè·¯å¾\nPUT my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "full_name": {\n          "path_match": "name.*",\n          "path_unmatch": "*.middle",\n          "mapping": {\n            "type": "text",\n            "copy_to": "full_name"\n          }\n        }\n      }\n    ]\n  }\n}\nGET my_index/_mapping\n\n\nPUT my_index/_doc/1\n{\n  "name": {\n    "first": "John",\n    "middle": "Winston",\n    "last": "Lennon"\n  }\n}\n\nGET my_index/_search?q=full_name:John\nDELETE my_index\n\n\n\n# 3.3. ç±»åï¼Typeï¼\n\ntype æ¯ä¸ä¸ªé»è¾æä¹ä¸çåç±»æèå«ååºï¼åè®¸å¨åä¸ç´¢å¼ä¸­å»ºç«å¤ä¸ª typeãæ¬è´¨æ¯ç¸å½äºä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼é«çæ¬å°ä¼åºå¼ type æ¦å¿µã\n\n> 6.0.0 çæ¬åä¹åï¼åºå¼ type\n\n\n# 3.4. ææ¡£ï¼Documentï¼\n\nElasticsearch æ¯é¢åææ¡£çï¼ææ¡£æ¯ææå¯æç´¢æ°æ®çæå°åä½ã\n\nElasticsearch ä½¿ç¨ JSON ä½ä¸ºææ¡£çåºååæ ¼å¼ã\n\nå¨ç´¢å¼/ç±»åä¸­ï¼å¯ä»¥æ ¹æ®éè¦å­å¨ä»»ææ°éçææ¡£ã\n\næ¯ä¸ªææ¡£é½æä¸ä¸ª Unique ID\n\n * ç¨æ·å¯ä»¥èªå·±æå®\n * æéè¿ Elasticsearch èªå¨çæ\n\n# ææ¡£çåæ°æ®\n\nä¸ä¸ªææ¡£ä¸ä»ä»åå«å®çæ°æ® ï¼ä¹åå«åæ°æ® ââ æå³ææ¡£çä¿¡æ¯ã\n\n * _indexï¼ææ¡£å¨åªå­æ¾\n * _typeï¼ææ¡£è¡¨ç¤ºçå¯¹è±¡ç±»å«\n * _idï¼ææ¡£å¯ä¸æ è¯\n * _sourceï¼ææ¡£çåå§ Json æ°æ®\n * _allï¼æ´åææå­æ®µåå®¹å°è¯¥å­æ®µï¼å·²è¢«åºé¤\n * _versionï¼ææ¡£ççæ¬ä¿¡æ¯\n * _scoreï¼ç¸å³æ§æå\n\nç¤ºä¾ï¼\n\n{\n  "_index": "megacorp",\n  "_type": "employee",\n  "_id": "1",\n  "_version": 1,\n  "found": true,\n  "_source": {\n    "first_name": "John",\n    "last_name": "Smith",\n    "age": 25,\n    "about": "I love to go rock climbing",\n    "interests": ["sports", "music"]\n  }\n}\n\n\n\n# 3.5. èç¹ï¼Nodeï¼\n\n# èç¹ç®ä»\n\nä¸ä¸ªè¿è¡ä¸­ç Elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ã\n\nElasticsearch å®ä¾æ¬è´¨ä¸æ¯ä¸ä¸ª Java è¿ç¨ãä¸å°æºå¨ä¸å¯ä»¥è¿è¡å¤ä¸ª Elasticsearch è¿ç¨ï¼ä½æ¯çäº§ç¯å¢å»ºè®®ä¸å°æºå¨ä¸åªè¿è¡ä¸ä¸ª Elasticsearch è¿ç¨\n\næ¯ä¸ªèç¹é½æåå­ï¼éè¿éç½®æä»¶éç½®ï¼æå¯å¨æ¶éè¿ -E node.name=node1 æå®ã\n\næ¯ä¸ªèç¹å¨å¯å¨åï¼ä¼åéä¸ä¸ª UIDï¼ä¿å­å¨ data ç®å½ä¸ã\n\n# èç¹ç±»å\n\n * ä¸»èç¹ï¼master nodeï¼ï¼æ¯ä¸ªèç¹é½ä¿å­äºéç¾¤çç¶æï¼åªæ master èç¹æè½ä¿®æ¹éç¾¤çç¶æä¿¡æ¯ï¼ä¿è¯æ°æ®ä¸è´æ§ï¼ãéç¾¤ç¶æï¼ç»´æ¤äºä»¥ä¸ä¿¡æ¯ï¼\n   * ææçèç¹ä¿¡æ¯\n   * ææçç´¢å¼åå¶ç¸å³ç mapping å setting ä¿¡æ¯\n   * åççè·¯ç±ä¿¡æ¯\n * åéèç¹ï¼master eligible nodeï¼ï¼master eligible èç¹å¯ä»¥åå éä¸»æµç¨ãç¬¬ä¸ä¸ªå¯å¨çèç¹ï¼ä¼å°èªå·±éä¸¾ä¸º mater èç¹ã\n   * æ¯ä¸ªèç¹å¯å¨åï¼é»è®¤ä¸º master eligible èç¹ï¼å¯ä»¥éè¿éç½® node.master: false ç¦æ­¢\n * æ°æ®èç¹ï¼data nodeï¼ï¼è´è´£ä¿å­åçæ°æ®ã\n * åè°èç¹ï¼coordinating nodeï¼ï¼è´è´£æ¥æ¶å®¢æ·ç«¯çè¯·æ±ï¼å°è¯·æ±ååå°åéçæ¥å°é£ï¼æç»æç»ææ±éå°ä¸èµ·ãæ¯ä¸ª Elasticsearch èç¹é»è®¤é½æ¯åè°èç¹ï¼coordinating nodeï¼ã\n * å·/ç­èç¹ï¼warm/hot nodeï¼ï¼éå¯¹ä¸åç¡¬ä»¶éç½®çæ°æ®èç¹ï¼data nodeï¼ï¼ç¨æ¥å®ç° Hot & Warm æ¶æï¼éä½éç¾¤é¨ç½²çææ¬ã\n * æºå¨å­¦ä¹ èç¹ï¼machine learning nodeï¼ï¼è´è´£æ§è¡æºå¨å­¦ä¹ ç Jobï¼ç¨æ¥åå¼å¸¸æ£æµã\n\n# èç¹éç½®\n\néç½®åæ°          é»è®¤å¼    è¯´æ\nnode.master   true   æ¯å¦ä¸ºä¸»èç¹\nnode.data     true   æ¯å¦ä¸ºæ°æ®èç¹\nnode.ingest   true   \nnode.ml       true   æ¯å¦ä¸ºæºå¨å­¦ä¹ èç¹ï¼éè¦å¼å¯ x-packï¼\n\n> å»ºè®®\n> \n> å¼åç¯å¢ä¸­ä¸ä¸ªèç¹å¯ä»¥æ¿æå¤ç§è§è²ãä½æ¯ï¼å¨çäº§ç¯å¢ä¸­ï¼èç¹åºè¯¥è®¾ç½®ä¸ºåä¸è§è²ã\n\n\n# 3.6. éç¾¤ï¼Clusterï¼\n\n# éç¾¤ç®ä»\n\næ¥æç¸å cluster.name éç½®ç Elasticsearch èç¹ç»æä¸ä¸ªéç¾¤ã cluster.name é»è®¤åä¸º elasticsearchï¼å¯ä»¥éè¿éç½®æä»¶ä¿®æ¹ï¼æå¯å¨æ¶éè¿ -E cluster.name=xxx æå®ã\n\nå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéå¢å ï¼å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã Elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n# éç¾¤å¥åº·\n\nElasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name" : "elasticsearch",\n  "status" : "green",\n  "timed_out" : false,\n  "number_of_nodes" : 1,\n  "number_of_data_nodes" : 1,\n  "active_primary_shards" : 5,\n  "active_shards" : 5,\n  "relocating_shards" : 0,\n  "initializing_shards" : 0,\n  "unassigned_shards" : 0,\n  "delayed_unassigned_shards" : 0,\n  "number_of_pending_tasks" : 0,\n  "number_of_in_flight_fetch" : 0,\n  "task_max_waiting_in_queue_millis" : 0,\n  "active_shards_percent_as_number" : 100.0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# 3.7. åçï¼Shardsï¼\n\n# åçç®ä»\n\nç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ªåçæ¯ä¸ä¸ªåºå±çå·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãä¸ä¸ªåçå¯ä»¥è§ä¸ºä¸ä¸ª Lucene çå®ä¾ï¼å¹¶ä¸å®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nElasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ Elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\n# ä¸»åçåå¯åç\n\nåçåä¸ºä¸»åçï¼Primary Shardï¼åå¯åçï¼Replica Shardï¼ã\n\nä¸»åçï¼ç¨äºè§£å³æ°æ®æ°´å¹³æ©å±çé®é¢ãéè¿ä¸»åçï¼å¯ä»¥å°æ°æ®åå¸å°éç¾¤åä¸åèç¹ä¸ã\n\n * ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçã\n * ä¸»åçæ°å¨ç´¢å¼åå»ºæ¶æå®ï¼ååºä¸åè®¸ä¿®æ¹ï¼é¤é Reindex\n\nå¯åçï¼Replica Shardï¼ï¼ç¨äºè§£å³æ°æ®é«å¯ç¨çé®é¢ãå¯åçæ¯ä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\n * å¯åçæ°å¯ä»¥å¨æè°æ´\n * å¢å å¯æ¬æ°ï¼è¿å¯ä»¥å¨ä¸å®ç¨åº¦ä¸æé«æå¡çå¯ç¨æ§ï¼è¯»åçååï¼\n\nå¯¹äºçäº§ç¯å¢ä¸­åççè®¾å®ï¼éè¦æååå¥½å®¹éè§å\n\nåçæ°è¿å°\n\n * æ æ³æ°´å¹³æ©å±\n * åä¸ªåççæ°éå¤ªå¤§ï¼å¯¼è´æ°æ®éæ°åéèæ¶\n\nåçæ°è¿å¤§\n\n * å½±åæç´¢ç»æçç¸å³æ§æåï¼å½±åç»è®¡ç»æçåç¡®æ§\n * åèç¹ä¸è¿å¤çåçï¼ä¼å¯¼è´èµæºæµªè´¹ï¼åæ¶ä¹ä¼å½±åæ§è½\n\n\n# 3.8. å¯æ¬ï¼Replicasï¼\n\nå¯æ¬ä¸»è¦æ¯éå¯¹ä¸»åçï¼Shardsï¼çå¤å¶ï¼Elasticsearch ä¸­ä¸»åçå¯ä»¥æ¥æ 0 ä¸ªæå¤ä¸ªçå¯æ¬ã\n\nå¯æ¬åççä¸»è¦ç®çå°±æ¯ä¸ºäºæéè½¬ç§»ã\n\nåçå¯æ¬å¾éè¦ï¼ä¸»è¦æä¸¤ä¸ªåå ï¼\n\n * å®å¨åçæèç¹åçæéæ¶æä¾é«å¯ç¨æ§ãå æ­¤ï¼å¯æ¬åçæ°¸è¿ä¸ä¼å¨ä¸å¶å¤å¶çä¸»åçç¸åçèç¹ï¼\n * å¯æ¬åçä¹å¯ä»¥æ¥åæç´¢çè¯·æ±ï¼å¯ä»¥å¹¶è¡æç´¢ï¼ä»èæé«ç³»ç»çååéã\n\n> æ¯ä¸ª Elasticsearch åçé½æ¯ Lucene ç´¢å¼ãåä¸ª Lucene ç´¢å¼ä¸­å¯ä»¥åå«æå¤§æ°éçææ¡£ãæªæ­¢ LUCENE-5843ï¼éå¶æ¯ 2,147,483,519ï¼= Integer.MAX_VALUE - 128ï¼ææ¡£ãæ¨å¯ä»¥ä½¿ç¨_cat/shardsAPI çæ§åçå¤§å°ã\n\n\n# 4. åèèµæ\n\n * Elasticsearch å®ç½\n * Elasticsearch ç®ä»',normalizedContent:'# elasticsearch ç®ä»\n\nelasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\nå®ç¨äºå¨ææç´¢ãç»æåæç´¢ãåæä»¥åå°è¿ä¸èæ··åä½¿ç¨ï¼\n\n * ç»´åºç¾ç§ä½¿ç¨ elasticsearch æä¾å¨ææç´¢å¹¶é«äº®å³é®å­ï¼ä»¥å**è¾å¥å®æ¶æç´¢(search-as-you-type)åæç´¢çº é(did-you-mean)**ç­æç´¢å»ºè®®åè½ã\n * è±å½å«æ¥ä½¿ç¨ elasticsearch ç»åç¨æ·æ¥å¿åç¤¾äº¤ç½ç»æ°æ®æä¾ç»ä»ä»¬çç¼è¾ä»¥å®æ¶çåé¦ï¼ä»¥ä¾¿åæ¶äºè§£å¬ä¼å¯¹æ°åè¡¨çæç« çååºã\n * stackoverflow ç»åå¨ææç´¢ä¸å°çä½ç½®æ¥è¯¢ï¼ä»¥åmore-like-thisåè½æ¥æ¾å°ç¸å³çé®é¢åç­æ¡ã\n * github ä½¿ç¨ elasticsearch æ£ç´¢ 1300 äº¿è¡çä»£ç ã\n\n * 1. elasticsearch ç¹ç¹\n * 2. elasticsearch åå±åå²\n * 3. elasticsearch æ¦å¿µ\n   * 3.1. è¿å®æ¶ï¼nrtï¼\n   * 3.2. ç´¢å¼ï¼indexï¼\n   * 3.3. ç±»åï¼typeï¼\n   * 3.4. ææ¡£ï¼documentï¼\n   * 3.5. èç¹ï¼nodeï¼\n   * 3.6. éç¾¤ï¼clusterï¼\n   * 3.7. åçï¼shardsï¼\n   * 3.8. å¯æ¬ï¼replicasï¼\n * 4. åèèµæ\n\n\n# 1. elasticsearch ç¹ç¹\n\n * åå¸å¼çå®æ¶æä»¶å­å¨ï¼æ¯ä¸ªå­æ®µé½è¢«ç´¢å¼å¹¶å¯è¢«æç´¢ï¼\n * åå¸å¼çå®æ¶åææç´¢å¼æï¼\n * å¯å¼¹æ§æ©å±å°ä¸ç¾å°æå¡å¨è§æ¨¡ï¼å¤ç pb çº§ç»æåæéç»æåæ°æ®ï¼\n * å¼ç®±å³ç¨ï¼å®è£å³å¯ä½¿ç¨ï¼ï¼å®æä¾äºè®¸å¤åççç¼ºçå¼ï¼å¹¶å¯¹åå­¦èéèäºå¤æçæç´¢å¼æçè®ºãåªéå¾å°çå­¦ä¹ æ¢å¯å¨çäº§ç¯å¢ä¸­ä½¿ç¨ã\n\n\n# 2. elasticsearch åå±åå²\n\n * 2010 å¹´ 2 æ 8 æ¥ï¼elasticsearch ç¬¬ä¸ä¸ªå¬å¼çæ¬åå¸ã\n\n * 2010 å¹´ 5 æ 14 æ¥ï¼åå¸ç¬¬ä¸ä¸ªå·æéç¨ç¢æä¹çåå§çæ¬ 0.7.0 ï¼å·æå¦ä¸ç¹å¾ï¼\n\n * zen discovery èªå¨åç°æ¨¡åï¼\n   \n   * æ¯æ groovy clientï¼\n\n * ç®åçæä»¶ç®¡çæºå¶ï¼\n   \n   * æ´å¥½å°æ¯æ icu åè¯å¨ï¼\n\n * æ´å¤çç®¡ç apiã\n\n * 2013 å¹´åï¼github æå¼äº solrï¼éå elasticsearch æ¥åå¶ pb çº§çæç´¢ã\n\n * 2014 å¹´ 2 æ 14 æ¥ï¼åå¸ 1.0.0 çæ¬ï¼å¢å å¦ä¸éè¦ç¹æ§ï¼\n\n * æ¯æ snapshot/restore api å¤ä»½æ¢å¤ apiï¼\n   \n   * æ¯æèååæ aggregationsï¼\n\n * æ¯æ cat apiï¼\n   \n   * æ¯ææ­è·¯å¨ï¼\n\n * å¼å¥ doc valuesã\n\n * 2015 å¹´ 10 æ 28 æ¥ï¼åå¸ 2.0.0 çæ¬ï¼æå¦ä¸éè¦ç¹æ§ï¼\n\n * å¢å äº pipleline aggregationsï¼\n   \n   * query/filter æ¥è¯¢åå¹¶ï¼é½åå¹¶å° query ä¸­ï¼æ ¹æ®ä¸åçä¸ä¸ææ§è¡ä¸åçæ¥è¯¢ï¼\n\n * åç¼©å­å¨å¯éç½®ï¼\n   \n   * rivers æ¨¡åè¢«ç§»é¤ï¼\n\n * multicast ç»æ­åç°è¢«ç§»é¤ï¼æä¸ºä¸ä¸ªæä»¶ï¼çäº§ç¯å¢å¿é¡»éç½®åæ­å°åã\n\n * 2016 å¹´ 10 æ 26 æ¥ï¼åå¸ 5.0.0 çæ¬ï¼æå¦ä¸éå¤§ç¹æ§ååï¼\n\n * lucene 6.x çæ¯æï¼ç£çç©ºé´å°ä¸åï¼ç´¢å¼æ¶é´å°ä¸åï¼æ¥è¯¢æ§è½æå 25%ï¼æ¯æ ipv6ï¼\n   \n   * internal engine çº§å«ç§»é¤äºç¨äºé¿ååä¸ææ¡£å¹¶åæ´æ°çç«äºéï¼å¸¦æ¥ 15%-20% çæ§è½æåï¼\n\n * shrink apiï¼å®å¯å°åçæ°è¿è¡æ¶ç¼©æå®çå æ°ï¼å¦ä¹åä½ æ¯ 15 ä¸ªåçï¼ä½ å¯ä»¥æ¶ç¼©æ 5 ä¸ªæè 3 ä¸ªåæè 1 ä¸ªï¼é£ä¹æä»¬å°±å¯ä»¥æ³è±¡æè¿æ ·ä¸ç§åºæ¯ï¼å¨åå¥ååéå¸¸å¤§çæ¶éé¶æ®µï¼è®¾ç½®è¶³å¤å¤çç´¢å¼ï¼ååå©ç¨ shard çå¹¶è¡åè½åï¼ç´¢å¼åå®ä¹åæ¶ç¼©ææ´å°ç shardï¼æé«æ¥è¯¢æ§è½ï¼\n   \n   * æä¾äºç¬¬ä¸ä¸ª java åçç rest å®¢æ·ç«¯ sdkï¼\n\n * ingestnodeï¼ä¹åå¦æéè¦å¯¹æ°æ®è¿è¡å å·¥ï¼é½æ¯å¨ç´¢å¼ä¹åè¿è¡å¤çï¼æ¯å¦ logstash å¯ä»¥å¯¹æ¥å¿è¿è¡ç»æååè½¬æ¢ï¼ç°å¨ç´æ¥å¨ es å°±å¯ä»¥å¤çäºï¼\n   \n   * æä¾äº painless èæ¬ï¼ä»£æ¿ groovy èæ¬ï¼\n   * ç§»é¤ site pluginsï¼å°±æ¯è¯´ headãbigdesk é½ä¸è½ç´æ¥è£ es éé¢äºï¼ä¸è¿å¯ä»¥é¨ç½²ç¬ç«ç«ç¹ï¼åæ­£é½æ¯éææä»¶ï¼æå¼å kibana æä»¶ï¼\n   * æ°å¢ sliced scroll ç±»åï¼ç°å¨ scroll æ¥å£å¯ä»¥å¹¶åæ¥è¿è¡æ°æ®éåäºãæ¯ä¸ª scroll è¯·æ±ï¼å¯ä»¥åæå¤ä¸ª slice è¯·æ±ï¼å¯ä»¥çè§£ä¸ºåçï¼å slice ç¬ç«å¹¶è¡ï¼å©ç¨ scroll éå»ºæèéåè¦å¿«å¾å¤åï¼\n   * æ°å¢äº profile apiï¼\n   * æ°å¢äº rollover apiï¼\n   * æ°å¢ reindexï¼\n   * å¼å¥æ°çå­æ®µç±»å text/keyword æ¥æ¿æ¢ stringï¼\n   * éå¶ç´¢å¼è¯·æ±å¤§å°ï¼é¿åå¤§éå¹¶åè¯·æ±åå® esï¼\n   * éå¶åä¸ªè¯·æ±ç shards æ°éï¼é»è®¤ 1000 ä¸ªã\n\n * 2017 å¹´ 8 æ 31 æ¥ï¼åå¸ 6.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * ç¨çæ§ doc values çæ¯æï¼\n   \n   * index sortingï¼å³ç´¢å¼é¶æ®µçæåºï¼\n\n * é¡ºåºå·çæ¯æï¼æ¯ä¸ª es çæä½é½æä¸ä¸ªé¡ºåºç¼å·ï¼ç±»ä¼¼å¢éè®¾è®¡ï¼ï¼\n   \n   * æ ç¼æ»å¨åçº§ï¼\n\n * ä» 6.0 å¼å§ä¸æ¯æä¸ä¸ª index éé¢å­å¨å¤ä¸ª typeï¼\n   \n   * index-template inheritanceï¼ç´¢å¼çæ¬çç»§æ¿ï¼ç®åç´¢å¼æ¨¡æ¿æ¯ææå¹éçé½ä¼åå¹¶ï¼è¿æ ·ä¼é æç´¢å¼æ¨¡æ¿æä¸äºå²çªé®é¢ï¼ 6.0 å°ä¼åªå¹éä¸ä¸ªï¼ç´¢å¼åå»ºæ¶ä¹ä¼è¿è¡éªè¯ï¼\n   * load aware shard routingï¼ åºäºè´è½½çè¯·æ±è·¯ç±ï¼ç®åçæç´¢è¯·æ±æ¯å¨èç¹è½®è¯¢ï¼é£ä¹æ§è½ææ¢çèç¹å¾å¾ä¼é ææ´ä½çå»¶è¿å¢å ï¼æ°çå®ç°æ¹å¼å°åºäºéåçèè´¹æ¶é´èªå¨è°èéåé¿åº¦ï¼è´è½½é«çèç¹çéåé¿åº¦å°åå°ï¼è®©å¶ä»èç¹åææ´å¤çååï¼æç´¢åç´¢å¼é½å°åºäºè¿ç§æºå¶ï¼\n   * å·²ç»å³é­çç´¢å¼å°ä¹æ¯æ replica çèªå¨å¤çï¼ç¡®ä¿æ°æ®å¯é ã\n\n * 2019 å¹´ 4 æ 10 æ¥ï¼åå¸ 7.0.0 çæ¬ï¼å·æå¦ä¸éè¦ç¹æ§ï¼\n\n * éç¾¤è¿æ¥ååï¼transportclient è¢«åºå¼ï¼es7 ç java ä»£ç ï¼åªè½ä½¿ç¨ restclientï¼å¯¹äº java ç¼ç¨ï¼å»ºè®®éç¨ high-level-rest-client çæ¹å¼æä½ es éç¾¤ï¼\n   \n   * es ç¨åºåé»è®¤æå jdkï¼7.x çæ¬çç¨åºåå¤§å°åæ 300mb+ï¼å¯¹æ¯ 6.xï¼åå¤§äº 200mb+ï¼è¿æ­£æ¯ jdk çå¤§å°ï¼\n\n * éç¨åºäº lucene 9.0ï¼\n   \n   * æ­£å¼åºé¤åä¸ªç´¢å¼ä¸å¤ type çæ¯æï¼es6 æ¶ï¼å®æ¹å°±æå°äº es7 ä¼å é¤ typeï¼å¹¶ä¸ es6 æ¶ï¼å·²ç»è§å®æ¯ä¸ä¸ª index åªè½æä¸ä¸ª typeãå¨ es7 ä¸­ï¼ä½¿ç¨é»è®¤ç _doc ä½ä¸º typeï¼å®æ¹è¯´å¨ 8.x çæ¬ä¼å½»åºç§»é¤ typeãapi è¯·æ±æ¹å¼ä¹åéååï¼å¦è·å¾æç´¢å¼çæ id çææ¡£ï¼get index/_doc/id å¶ä¸­ index å id ä¸ºå·ä½çå¼ï¼\n\n * å¼å¥äºçæ­£çåå­æ­è·¯å¨ï¼å®å¯ä»¥æ´ç²¾åå°æ£æµåºæ æ³å¤ççè¯·æ±ï¼å¹¶é²æ­¢å®ä»¬ä½¿åä¸ªèç¹ä¸ç¨³å®ï¼\n   \n   * zen2 æ¯ elasticsearch çå¨æ°éç¾¤åè°å±ï¼æé«äºå¯é æ§ãæ§è½åç¨æ·ä½éªï¼åå¾æ´å¿«ãæ´å®å¨ï¼å¹¶æ´æäºä½¿ç¨ã\n\n\n# 3. elasticsearch æ¦å¿µ\n\nä¸åæä¸äºæ¦å¿µæ¯ elasticsearch çæ ¸å¿ãä»ä¸å¼å§å°±çè§£è¿äºæ¦å¿µå°æå¤§å°å¸®å©ç®åå­¦ä¹  elasticsearch çè¿ç¨ã\n\n\n# 3.1. è¿å®æ¶ï¼nrtï¼\n\nelasticsearch æ¯ä¸ä¸ªè¿ä¹å®æ¶çæç´¢å¹³å°ãè¿æå³çä»ç´¢å¼ææ¡£å°å¯æç´¢ææ¡£çæ¶é´æä¸ç¹å»¶è¿ï¼éå¸¸æ¯ä¸ç§ï¼ã\n\n\n# 3.2. ç´¢å¼ï¼indexï¼\n\nç´¢å¼å¨ä¸åè¯­å¢ï¼æçä¸åçå«ä¹\n\n * ç´¢å¼ï¼åè¯ï¼ï¼ä¸ä¸ª ç´¢å¼ ç±»ä¼¼äºä¼ ç»å³ç³»æ°æ®åºä¸­çä¸ä¸ª æ°æ®åº ï¼æ¯ä¸ä¸ªå­å¨å³ç³»åææ¡£çå®¹å¨ã ç´¢å¼ (index) çå¤æ°è¯ä¸º indices æ indexes ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n * ç´¢å¼ï¼å¨è¯ï¼ï¼ç´¢å¼ä¸ä¸ªææ¡£ å°±æ¯å­å¨ä¸ä¸ªææ¡£å°ä¸ä¸ª ç´¢å¼ ï¼åè¯ï¼ä¸­ä»¥ä¾¿è¢«æ£ç´¢åæ¥è¯¢ãè¿éå¸¸ç±»ä¼¼äº sql è¯­å¥ä¸­ç insert å³é®è¯ï¼é¤äºææ¡£å·²å­å¨æ¶ï¼æ°ææ¡£ä¼æ¿æ¢æ§ææ¡£æåµä¹å¤ã\n * åæç´¢å¼ï¼å³ç³»åæ°æ®åºéè¿å¢å ä¸ä¸ªç´¢å¼æ¯å¦ä¸ä¸ª b æ ç´¢å¼å°æå®çåä¸ï¼ä»¥ä¾¿æåæ°æ®æ£ç´¢éåº¦ãelasticsearch å lucene ä½¿ç¨äºä¸ä¸ªå«å åæç´¢å¼ çç»ææ¥è¾¾å°ç¸åçç®çã\n\nç´¢å¼ç mapping å setting\n\n * mapping å®ä¹ææ¡£å­æ®µçç±»å\n * setting å®ä¹ä¸åçæ°æ®åå¸\n\nç¤ºä¾ï¼\n\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# åæç´¢å¼\n\n\n\n# index template\n\nindex templateï¼ç´¢å¼æ¨¡æ¿ï¼å¸®å©ç¨æ·è®¾å® mapping å settingï¼å¹¶æç§ä¸å®çè§åï¼èªå¨å¹éå°æ°åå»ºçç´¢å¼ä¹ä¸ã\n\n * æ¨¡æ¿ä»å¨ä¸ä¸ªç´¢å¼è¢«åå»ºæ¶ï¼æä¼äº§çä½ç¨ãä¿®æ¹æ¨¡æ¿ä¸ä¼å½±åå·²åå»ºçç´¢å¼ã\n * ä½ å¯ä»¥è®¾å®å¤ä¸ªç´¢å¼æ¨¡æ¿ï¼è¿äºè®¾ç½®ä¼è¢« merge å¨ä¸èµ·ã\n * ä½ å¯ä»¥æå® order çæ°å¼ï¼æ§å¶ merge çè¿ç¨ã\n\nå½æ°å»ºä¸ä¸ªç´¢å¼æ¶\n\n * åºç¨ es é»è®¤ç mapping å setting\n * åºç¨ order æ°å¼ä½ç index template ä¸­çè®¾å®\n * åºç¨ order æ°å¼é«ç index template ä¸­çè®¾å®ï¼ä¹åçè®¾å®ä¼è¢«è¦ç\n * åºç¨åå»ºç´¢å¼æ¯ï¼ç¨æ·ææå®ç mapping å settingï¼å¹¶è¦çä¹åæ¨¡æ¿ä¸­çè®¾å®ã\n\nç¤ºä¾ï¼åå»ºé»è®¤ç´¢å¼æ¨¡æ¿\n\nput _template/template_default\n{\n  "index_patterns": ["*"],\n  "order": 0,\n  "version": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 1\n  }\n}\n\nput /_template/template_test\n{\n  "index_patterns": ["test*"],\n  "order": 1,\n  "settings": {\n    "number_of_shards": 1,\n    "number_of_replicas": 2\n  },\n  "mappings": {\n    "date_detection": false,\n    "numeric_detection": true\n  }\n}\n\n# æ¥çç´¢å¼æ¨¡æ¿\nget /_template/template_default\nget /_template/temp*\n\n#åå¥æ°çæ°æ®ï¼indexä»¥testå¼å¤´\nput testtemplate/_doc/1\n{\n  "somenumber": "1",\n  "somedate": "2019/01/01"\n}\nget testtemplate/_mapping\nget testtemplate/_settings\n\nput testmy\n{\n\t"settings":{\n\t\t"number_of_replicas":5\n\t}\n}\n\nput testmy/_doc/1\n{\n  "key": "value"\n}\n\nget testmy/_settings\ndelete testmy\ndelete /_template/template_default\ndelete /_template/template_test\n\n\n# dynamic template\n\n * æ ¹æ® es è¯å«çæ°æ®ç±»åï¼ç»åå­æ®µåç§°ï¼æ¥å¨æè®¾å®å­æ®µç±»å\n   * ææçå­ç¬¦ä¸²ç±»åé½è®¾å®æ keywordï¼æèå³é­ keyword å­æ®µã\n   * is å¼å¤´çå­æ®µé½è®¾ç½®æ boolean\n   * long_ å¼å¤´çé½è®¾ç½®æ long ç±»å\n * dynamic template æ¯å®ä¹å¨æä¸ªç´¢å¼ç mapping ä¸­\n * template æä¸ä¸ªåç§°\n * å¹éè§åæ¯ä¸ä¸ªæ°ç»\n * ä¸ºå¹éå°å­æ®µè®¾ç½® mapping\n\nç¤ºä¾ï¼\n\n#dynaminc mapping æ ¹æ®ç±»ååå­æ®µå\ndelete my_index\n\nput my_index/_doc/1\n{\n  "firstname": "ruan",\n  "isvip": "true"\n}\n\nget my_index/_mapping\n\ndelete my_index\nput my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "strings_as_boolean": {\n          "match_mapping_type": "string",\n          "match": "is*",\n          "mapping": {\n            "type": "boolean"\n          }\n        }\n      },\n      {\n        "strings_as_keywords": {\n          "match_mapping_type": "string",\n          "mapping": {\n            "type": "keyword"\n          }\n        }\n      }\n    ]\n  }\n}\nget my_index/_mapping\n\ndelete my_index\n#ç»åè·¯å¾\nput my_index\n{\n  "mappings": {\n    "dynamic_templates": [\n      {\n        "full_name": {\n          "path_match": "name.*",\n          "path_unmatch": "*.middle",\n          "mapping": {\n            "type": "text",\n            "copy_to": "full_name"\n          }\n        }\n      }\n    ]\n  }\n}\nget my_index/_mapping\n\n\nput my_index/_doc/1\n{\n  "name": {\n    "first": "john",\n    "middle": "winston",\n    "last": "lennon"\n  }\n}\n\nget my_index/_search?q=full_name:john\ndelete my_index\n\n\n\n# 3.3. ç±»åï¼typeï¼\n\ntype æ¯ä¸ä¸ªé»è¾æä¹ä¸çåç±»æèå«ååºï¼åè®¸å¨åä¸ç´¢å¼ä¸­å»ºç«å¤ä¸ª typeãæ¬è´¨æ¯ç¸å½äºä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼é«çæ¬å°ä¼åºå¼ type æ¦å¿µã\n\n> 6.0.0 çæ¬åä¹åï¼åºå¼ type\n\n\n# 3.4. ææ¡£ï¼documentï¼\n\nelasticsearch æ¯é¢åææ¡£çï¼ææ¡£æ¯ææå¯æç´¢æ°æ®çæå°åä½ã\n\nelasticsearch ä½¿ç¨ json ä½ä¸ºææ¡£çåºååæ ¼å¼ã\n\nå¨ç´¢å¼/ç±»åä¸­ï¼å¯ä»¥æ ¹æ®éè¦å­å¨ä»»ææ°éçææ¡£ã\n\næ¯ä¸ªææ¡£é½æä¸ä¸ª unique id\n\n * ç¨æ·å¯ä»¥èªå·±æå®\n * æéè¿ elasticsearch èªå¨çæ\n\n# ææ¡£çåæ°æ®\n\nä¸ä¸ªææ¡£ä¸ä»ä»åå«å®çæ°æ® ï¼ä¹åå«åæ°æ® ââ æå³ææ¡£çä¿¡æ¯ã\n\n * _indexï¼ææ¡£å¨åªå­æ¾\n * _typeï¼ææ¡£è¡¨ç¤ºçå¯¹è±¡ç±»å«\n * _idï¼ææ¡£å¯ä¸æ è¯\n * _sourceï¼ææ¡£çåå§ json æ°æ®\n * _allï¼æ´åææå­æ®µåå®¹å°è¯¥å­æ®µï¼å·²è¢«åºé¤\n * _versionï¼ææ¡£ççæ¬ä¿¡æ¯\n * _scoreï¼ç¸å³æ§æå\n\nç¤ºä¾ï¼\n\n{\n  "_index": "megacorp",\n  "_type": "employee",\n  "_id": "1",\n  "_version": 1,\n  "found": true,\n  "_source": {\n    "first_name": "john",\n    "last_name": "smith",\n    "age": 25,\n    "about": "i love to go rock climbing",\n    "interests": ["sports", "music"]\n  }\n}\n\n\n\n# 3.5. èç¹ï¼nodeï¼\n\n# èç¹ç®ä»\n\nä¸ä¸ªè¿è¡ä¸­ç elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ã\n\nelasticsearch å®ä¾æ¬è´¨ä¸æ¯ä¸ä¸ª java è¿ç¨ãä¸å°æºå¨ä¸å¯ä»¥è¿è¡å¤ä¸ª elasticsearch è¿ç¨ï¼ä½æ¯çäº§ç¯å¢å»ºè®®ä¸å°æºå¨ä¸åªè¿è¡ä¸ä¸ª elasticsearch è¿ç¨\n\næ¯ä¸ªèç¹é½æåå­ï¼éè¿éç½®æä»¶éç½®ï¼æå¯å¨æ¶éè¿ -e node.name=node1 æå®ã\n\næ¯ä¸ªèç¹å¨å¯å¨åï¼ä¼åéä¸ä¸ª uidï¼ä¿å­å¨ data ç®å½ä¸ã\n\n# èç¹ç±»å\n\n * ä¸»èç¹ï¼master nodeï¼ï¼æ¯ä¸ªèç¹é½ä¿å­äºéç¾¤çç¶æï¼åªæ master èç¹æè½ä¿®æ¹éç¾¤çç¶æä¿¡æ¯ï¼ä¿è¯æ°æ®ä¸è´æ§ï¼ãéç¾¤ç¶æï¼ç»´æ¤äºä»¥ä¸ä¿¡æ¯ï¼\n   * ææçèç¹ä¿¡æ¯\n   * ææçç´¢å¼åå¶ç¸å³ç mapping å setting ä¿¡æ¯\n   * åççè·¯ç±ä¿¡æ¯\n * åéèç¹ï¼master eligible nodeï¼ï¼master eligible èç¹å¯ä»¥åå éä¸»æµç¨ãç¬¬ä¸ä¸ªå¯å¨çèç¹ï¼ä¼å°èªå·±éä¸¾ä¸º mater èç¹ã\n   * æ¯ä¸ªèç¹å¯å¨åï¼é»è®¤ä¸º master eligible èç¹ï¼å¯ä»¥éè¿éç½® node.master: false ç¦æ­¢\n * æ°æ®èç¹ï¼data nodeï¼ï¼è´è´£ä¿å­åçæ°æ®ã\n * åè°èç¹ï¼coordinating nodeï¼ï¼è´è´£æ¥æ¶å®¢æ·ç«¯çè¯·æ±ï¼å°è¯·æ±ååå°åéçæ¥å°é£ï¼æç»æç»ææ±éå°ä¸èµ·ãæ¯ä¸ª elasticsearch èç¹é»è®¤é½æ¯åè°èç¹ï¼coordinating nodeï¼ã\n * å·/ç­èç¹ï¼warm/hot nodeï¼ï¼éå¯¹ä¸åç¡¬ä»¶éç½®çæ°æ®èç¹ï¼data nodeï¼ï¼ç¨æ¥å®ç° hot & warm æ¶æï¼éä½éç¾¤é¨ç½²çææ¬ã\n * æºå¨å­¦ä¹ èç¹ï¼machine learning nodeï¼ï¼è´è´£æ§è¡æºå¨å­¦ä¹ ç jobï¼ç¨æ¥åå¼å¸¸æ£æµã\n\n# èç¹éç½®\n\néç½®åæ°          é»è®¤å¼    è¯´æ\nnode.master   true   æ¯å¦ä¸ºä¸»èç¹\nnode.data     true   æ¯å¦ä¸ºæ°æ®èç¹\nnode.ingest   true   \nnode.ml       true   æ¯å¦ä¸ºæºå¨å­¦ä¹ èç¹ï¼éè¦å¼å¯ x-packï¼\n\n> å»ºè®®\n> \n> å¼åç¯å¢ä¸­ä¸ä¸ªèç¹å¯ä»¥æ¿æå¤ç§è§è²ãä½æ¯ï¼å¨çäº§ç¯å¢ä¸­ï¼èç¹åºè¯¥è®¾ç½®ä¸ºåä¸è§è²ã\n\n\n# 3.6. éç¾¤ï¼clusterï¼\n\n# éç¾¤ç®ä»\n\næ¥æç¸å cluster.name éç½®ç elasticsearch èç¹ç»æä¸ä¸ªéç¾¤ã cluster.name é»è®¤åä¸º elasticsearchï¼å¯ä»¥éè¿éç½®æä»¶ä¿®æ¹ï¼æå¯å¨æ¶éè¿ -e cluster.name=xxx æå®ã\n\nå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéå¢å ï¼å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n# éç¾¤å¥åº·\n\nelasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name" : "elasticsearch",\n  "status" : "green",\n  "timed_out" : false,\n  "number_of_nodes" : 1,\n  "number_of_data_nodes" : 1,\n  "active_primary_shards" : 5,\n  "active_shards" : 5,\n  "relocating_shards" : 0,\n  "initializing_shards" : 0,\n  "unassigned_shards" : 0,\n  "delayed_unassigned_shards" : 0,\n  "number_of_pending_tasks" : 0,\n  "number_of_in_flight_fetch" : 0,\n  "task_max_waiting_in_queue_millis" : 0,\n  "active_shards_percent_as_number" : 100.0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# 3.7. åçï¼shardsï¼\n\n# åçç®ä»\n\nç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ªåçæ¯ä¸ä¸ªåºå±çå·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãä¸ä¸ªåçå¯ä»¥è§ä¸ºä¸ä¸ª lucene çå®ä¾ï¼å¹¶ä¸å®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nelasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\n# ä¸»åçåå¯åç\n\nåçåä¸ºä¸»åçï¼primary shardï¼åå¯åçï¼replica shardï¼ã\n\nä¸»åçï¼ç¨äºè§£å³æ°æ®æ°´å¹³æ©å±çé®é¢ãéè¿ä¸»åçï¼å¯ä»¥å°æ°æ®åå¸å°éç¾¤åä¸åèç¹ä¸ã\n\n * ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçã\n * ä¸»åçæ°å¨ç´¢å¼åå»ºæ¶æå®ï¼ååºä¸åè®¸ä¿®æ¹ï¼é¤é reindex\n\nå¯åçï¼replica shardï¼ï¼ç¨äºè§£å³æ°æ®é«å¯ç¨çé®é¢ãå¯åçæ¯ä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\n * å¯åçæ°å¯ä»¥å¨æè°æ´\n * å¢å å¯æ¬æ°ï¼è¿å¯ä»¥å¨ä¸å®ç¨åº¦ä¸æé«æå¡çå¯ç¨æ§ï¼è¯»åçååï¼\n\nå¯¹äºçäº§ç¯å¢ä¸­åççè®¾å®ï¼éè¦æååå¥½å®¹éè§å\n\nåçæ°è¿å°\n\n * æ æ³æ°´å¹³æ©å±\n * åä¸ªåççæ°éå¤ªå¤§ï¼å¯¼è´æ°æ®éæ°åéèæ¶\n\nåçæ°è¿å¤§\n\n * å½±åæç´¢ç»æçç¸å³æ§æåï¼å½±åç»è®¡ç»æçåç¡®æ§\n * åèç¹ä¸è¿å¤çåçï¼ä¼å¯¼è´èµæºæµªè´¹ï¼åæ¶ä¹ä¼å½±åæ§è½\n\n\n# 3.8. å¯æ¬ï¼replicasï¼\n\nå¯æ¬ä¸»è¦æ¯éå¯¹ä¸»åçï¼shardsï¼çå¤å¶ï¼elasticsearch ä¸­ä¸»åçå¯ä»¥æ¥æ 0 ä¸ªæå¤ä¸ªçå¯æ¬ã\n\nå¯æ¬åççä¸»è¦ç®çå°±æ¯ä¸ºäºæéè½¬ç§»ã\n\nåçå¯æ¬å¾éè¦ï¼ä¸»è¦æä¸¤ä¸ªåå ï¼\n\n * å®å¨åçæèç¹åçæéæ¶æä¾é«å¯ç¨æ§ãå æ­¤ï¼å¯æ¬åçæ°¸è¿ä¸ä¼å¨ä¸å¶å¤å¶çä¸»åçç¸åçèç¹ï¼\n * å¯æ¬åçä¹å¯ä»¥æ¥åæç´¢çè¯·æ±ï¼å¯ä»¥å¹¶è¡æç´¢ï¼ä»èæé«ç³»ç»çååéã\n\n> æ¯ä¸ª elasticsearch åçé½æ¯ lucene ç´¢å¼ãåä¸ª lucene ç´¢å¼ä¸­å¯ä»¥åå«æå¤§æ°éçææ¡£ãæªæ­¢ lucene-5843ï¼éå¶æ¯ 2,147,483,519ï¼= integer.max_value - 128ï¼ææ¡£ãæ¨å¯ä»¥ä½¿ç¨_cat/shardsapi çæ§åçå¤§å°ã\n\n\n# 4. åèèµæ\n\n * elasticsearch å®ç½\n * elasticsearch ç®ä»',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch ç´¢å¼",frontmatter:{title:"Elasticsearch ç´¢å¼",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","ç´¢å¼"],permalink:"/pages/5291b4/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/04.Elasticsearch%E7%B4%A2%E5%BC%95.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/04.Elasticsearchç´¢å¼.md",key:"v-a34eed14",path:"/pages/5291b4/",headers:[{level:2,title:"1. ç´¢å¼ç®¡çæä½",slug:"_1-ç´¢å¼ç®¡çæä½",normalizedTitle:"1. ç´¢å¼ç®¡çæä½",charIndex:23},{level:3,title:"1.1. ç´¢å¼å é¤",slug:"_1-1-ç´¢å¼å é¤",normalizedTitle:"1.1. ç´¢å¼å é¤",charIndex:102},{level:3,title:"1.2. ç´¢å¼å«å",slug:"_1-2-ç´¢å¼å«å",normalizedTitle:"1.2. ç´¢å¼å«å",charIndex:383},{level:2,title:"2. Settings è¯¦è§£",slug:"_2-settings-è¯¦è§£",normalizedTitle:"2. settings è¯¦è§£",charIndex:1009},{level:3,title:"2.1. åºå®å±æ§",slug:"_2-1-åºå®å±æ§",normalizedTitle:"2.1. åºå®å±æ§",charIndex:2747},{level:3,title:"2.2. ç´¢å¼éæéç½®",slug:"_2-2-ç´¢å¼éæéç½®",normalizedTitle:"2.2. ç´¢å¼éæéç½®",charIndex:2859},{level:3,title:"2.3. ç´¢å¼å¨æéç½®",slug:"_2-3-ç´¢å¼å¨æéç½®",normalizedTitle:"2.3. ç´¢å¼å¨æéç½®",charIndex:3600},{level:2,title:"3. Mapping è¯¦è§£",slug:"_3-mapping-è¯¦è§£",normalizedTitle:"3. mapping è¯¦è§£",charIndex:3819},{level:3,title:"3.1. æ å°åç±»",slug:"_3-1-æ å°åç±»",normalizedTitle:"3.1. æ å°åç±»",charIndex:4098},{level:4,title:"éææ å°",slug:"éææ å°",normalizedTitle:"éææ å°",charIndex:4132},{level:4,title:"å¨ææ å°",slug:"å¨ææ å°",normalizedTitle:"å¨ææ å°",charIndex:4137},{level:3,title:"3.2. åºç¡ç±»å",slug:"_3-2-åºç¡ç±»å",normalizedTitle:"3.2. åºç¡ç±»å",charIndex:5976},{level:3,title:"3.3. å¤æç±»å",slug:"_3-3-å¤æç±»å",normalizedTitle:"3.3. å¤æç±»å",charIndex:6158},{level:3,title:"3.4. ç¹æ®ç±»å",slug:"_3-4-ç¹æ®ç±»å",normalizedTitle:"3.4. ç¹æ®ç±»å",charIndex:6225},{level:3,title:"3.5. Mapping å±æ§",slug:"_3-5-mapping-å±æ§",normalizedTitle:"3.5. mapping å±æ§",charIndex:6384},{level:2,title:"4. ç´¢å¼æ¥è¯¢",slug:"_4-ç´¢å¼æ¥è¯¢",normalizedTitle:"4. ç´¢å¼æ¥è¯¢",charIndex:7620},{level:3,title:"4.1. å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢",slug:"_4-1-å¤ä¸ª-indexãå¤ä¸ª-type-æ¥è¯¢",normalizedTitle:"4.1. å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢",charIndex:7632},{level:3,title:"4.2. URI æç´¢",slug:"_4-2-uri-æç´¢",normalizedTitle:"4.2. uri æç´¢",charIndex:8095},{level:3,title:"4.3. æ¥è¯¢æµç¨",slug:"_4-3-æ¥è¯¢æµç¨",normalizedTitle:"4.3. æ¥è¯¢æµç¨",charIndex:10408},{level:2,title:"5. åèèµæ",slug:"_5-åèèµæ",normalizedTitle:"5. åèèµæ",charIndex:10681}],headersStr:"1. ç´¢å¼ç®¡çæä½ 1.1. ç´¢å¼å é¤ 1.2. ç´¢å¼å«å 2. Settings è¯¦è§£ 2.1. åºå®å±æ§ 2.2. ç´¢å¼éæéç½® 2.3. ç´¢å¼å¨æéç½® 3. Mapping è¯¦è§£ 3.1. æ å°åç±» éææ å° å¨ææ å° 3.2. åºç¡ç±»å 3.3. å¤æç±»å 3.4. ç¹æ®ç±»å 3.5. Mapping å±æ§ 4. ç´¢å¼æ¥è¯¢ 4.1. å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢ 4.2. URI æç´¢ 4.3. æ¥è¯¢æµç¨ 5. åèèµæ",content:'# Elasticsearch ç´¢å¼\n\n\n# 1. ç´¢å¼ç®¡çæä½\n\nElasticsearch ç´¢å¼ç®¡çä¸»è¦åæ¬å¦ä½è¿è¡ç´¢å¼çåå»ºãç´¢å¼çå é¤ãå¯æ¬çæ´æ°ãç´¢å¼è¯»åæéãç´¢å¼å«åçéç½®ç­ç­åå®¹ã\n\n\n# 1.1. ç´¢å¼å é¤\n\nES ç´¢å¼å é¤æä½å ES éç¾¤ç http æ¥å£åéæå®ç´¢å¼ç delete http è¯·æ±å³å¯ï¼å¯ä»¥éè¿ curl å½ä»¤ï¼å·ä½å¦ä¸ï¼\n\ncurl -X DELETE http://{es_host}:{es_http_port}/{index}\n\n\nå¦æå é¤æåï¼å®ä¼è¿åå¦ä¸ä¿¡æ¯ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\ncurl -X DELETE http://10.10.10.66:9200/my_index?pretty\n\n\nä¸ºäºè¿åçä¿¡æ¯ä¾¿äºè¯»åï¼å¢å äº pretty åæ°ï¼\n\n{\n  "acknowledged" : true\n}\n\n\n\n# 1.2. ç´¢å¼å«å\n\nES çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nPUT /my_index\nPUT /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º ES ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nES ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç Elasticsearchï¼ESï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# 2. Settings è¯¦è§£\n\nElasticsearch ç´¢å¼çéç½®é¡¹ä¸»è¦åä¸ºéæéç½®å±æ§åå¨æéç½®å±æ§ï¼éæéç½®å±æ§æ¯ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼èå¨æéç½®å±æ§åå¯ä»¥éæ¶ä¿®æ¹ã\n\nES ç´¢å¼è®¾ç½®ç api ä¸º _settingsï¼å®æ´çç¤ºä¾å¦ä¸ï¼\n\nPUT /my_index\n{\n  "settings": {\n    "index": {\n      "number_of_shards": "1",\n      "number_of_replicas": "1",\n      "refresh_interval": "60s",\n      "analysis": {\n        "filter": {\n          "tsconvert": {\n            "type": "stconvert",\n            "convert_type": "t2s",\n            "delimiter": ","\n          },\n          "synonym": {\n            "type": "synonym",\n            "synonyms_path": "analysis/synonyms.txt"\n          }\n        },\n        "analyzer": {\n          "ik_max_word_synonym": {\n            "filter": [\n              "synonym",\n              "tsconvert",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_max_word"\n          },\n          "ik_smart_synonym": {\n            "filter": [\n              "synonym",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_smart"\n          }\n        },\n\t\t\t"mapping": {\n\t\t\t\t"coerce": "false",\n\t\t\t\t"ignore_malformed": "false"\n\t\t\t},\n\t\t\t"indexing": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"index": {\n\t\t\t\t\t\t\t"warn": "2s",\n\t\t\t\t\t\t\t"info": "1s"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"provided_name": "hospital_202101070533",\n\t\t\t"query": {\n\t\t\t\t"default_field": "timestamp",\n\t\t\t\t"parse": {\n\t\t\t\t\t"allow_unmapped_fields": "false"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"requests": {\n\t\t\t\t"cache": {\n\t\t\t\t\t"enable": "true"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"search": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"fetch": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "200ms"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"query": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "500ms"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 2.1. åºå®å±æ§\n\n * index.creation_dateï¼é¡¾åæä¹ç´¢å¼çåå»ºæ¶é´æ³ã\n * index.uuidï¼ç´¢å¼ç uuid ä¿¡æ¯ã\n * index.version.createdï¼ç´¢å¼ççæ¬å·ã\n\n\n# 2.2. ç´¢å¼éæéç½®\n\n * index.number_of_shardsï¼ç´¢å¼çä¸»åçæ°ï¼é»è®¤å¼æ¯ 5ãè¿ä¸ªéç½®å¨ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼å¨ es å±é¢ï¼å¯ä»¥éè¿ es.index.max_number_of_shards å±æ§è®¾ç½®ç´¢å¼æå¤§çåçæ°ï¼é»è®¤ä¸º 1024ã\n * index.codecï¼æ°æ®å­å¨çåç¼©ç®æ³ï¼é»è®¤å¼ä¸º LZ4ï¼å¯éæ©å¼è¿æ best_compressionï¼å®æ¯ LZ4 å¯ä»¥è·å¾æ´å¥½çåç¼©æ¯ï¼å³å æ®è¾å°çç£çç©ºé´ï¼ä½å­å¨æ§è½æ¯ LZ4 ä½ï¼ã\n * index.routing_partition_sizeï¼è·¯ç±ååºæ°ï¼å¦æè®¾ç½®äºè¯¥åæ°ï¼å¶è·¯ç±ç®æ³ä¸ºï¼( hash(_routing) + hash(_id) % index.routing_parttion_size ) % number_of_shardsãå¦æè¯¥å¼ä¸è®¾ç½®ï¼åè·¯ç±ç®æ³ä¸º hash(_routing) % number_of_shardingsï¼_routing é»è®¤å¼ä¸º _idã\n\néæéç½®éï¼æéè¦çé¨åæ¯éç½®åæå¨ï¼config analyzersï¼ã\n\n * index.analysis\n   \n   ï¼åæå¨æå¤å±çéç½®é¡¹ï¼åé¨ä¸»è¦åä¸º char_filterãtokenizerãfilter å analyzerã\n   \n   * char_filterï¼å®ä¹æ°çå­ç¬¦è¿æ»¤å¨ä»¶ã\n   * tokenizerï¼å®ä¹æ°çåè¯å¨ã\n   * filterï¼å®ä¹æ°ç token filterï¼å¦åä¹è¯ filterã\n   * analyzerï¼éç½®æ°çåæå¨ï¼ä¸è¬æ¯ char_filterãtokenizer åä¸äº token filter çç»åã\n\n\n# 2.3. ç´¢å¼å¨æéç½®\n\n * index.number_of_replicasï¼ç´¢å¼ä¸»åççå¯æ¬æ°ï¼é»è®¤å¼æ¯ 1ï¼è¯¥å¼å¿é¡»å¤§äºç­äº 0ï¼è¿ä¸ªéç½®å¯ä»¥éæ¶ä¿®æ¹ã\n * index.refresh_intervalï¼æ§è¡æ°ç´¢å¼æ°æ®çå·æ°æä½é¢çï¼è¯¥æä½ä½¿å¯¹ç´¢å¼çææ°æ´æ¹å¯¹æç´¢å¯è§ï¼é»è®¤ä¸º 1sãä¹å¯ä»¥è®¾ç½®ä¸º -1 ä»¥ç¦ç¨å·æ°ãæ´è¯¦ç»ä¿¡æ¯åè Elasticsearch å¨æä¿®æ¹ refresh_interval å·æ°é´éè®¾ç½®ã\n\n\n# 3. Mapping è¯¦è§£\n\nå¨ Elasticsearch ä¸­ï¼Mappingï¼æ å°ï¼ï¼ç¨æ¥å®ä¹ä¸ä¸ªææ¡£ä»¥åå¶æåå«çå­æ®µå¦ä½è¢«å­å¨åç´¢å¼ï¼å¯ä»¥å¨æ å°ä¸­äºåå®ä¹å­æ®µçæ°æ®ç±»åãå­æ®µçæéãåè¯å¨ç­å±æ§ï¼å°±å¦åå¨å³ç³»åæ°æ®åºä¸­åå»ºæ°æ®è¡¨æ¶ä¼è®¾ç½®å­æ®µçç±»åã\n\nMapping ä¼æ json ææ¡£æ å°æ Lucene æéè¦çæå¹³æ ¼å¼\n\nä¸ä¸ª Mapping å±äºä¸ä¸ªç´¢å¼ç Type\n\n * æ¯ä¸ªææ¡£é½å±äºä¸ä¸ª Type\n * ä¸ä¸ª Type æä¸ä¸ª Mapping å®ä¹\n * 7.0 å¼å§ï¼ä¸éè¦å¨ Mapping å®ä¹ä¸­æå® type ä¿¡æ¯\n\n\n# 3.1. æ å°åç±»\n\nå¨ Elasticsearch ä¸­ï¼æ å°å¯åä¸ºéææ å°åå¨ææ å°ãå¨å³ç³»åæ°æ®åºä¸­åå¥æ°æ®ä¹åé¦åè¦å»ºè¡¨ï¼å¨å»ºè¡¨è¯­å¥ä¸­å£°æå­æ®µçå±æ§ï¼å¨ Elasticsearch ä¸­ï¼åä¸å¿å¦æ­¤ï¼Elasticsearch æéè¦çåè½ä¹ä¸å°±æ¯è®©ä½ å°½å¯è½å¿«å°å¼å§æ¢ç´¢æ°æ®ï¼ææ¡£åå¥ Elasticsearch ä¸­ï¼å®ä¼æ ¹æ®å­æ®µçç±»åèªå¨è¯å«ï¼è¿ç§æºå¶ç§°ä¸ºå¨ææ å°ï¼èéææ å°åæ¯åå¥æ°æ®ä¹åå¯¹å­æ®µçå±æ§è¿è¡æå·¥è®¾ç½®ã\n\n# éææ å°\n\néææ å°æ¯å¨åå»ºç´¢å¼æ¶æå·¥æå®ç´¢å¼æ å°ãéææ å°å SQL ä¸­å¨å»ºè¡¨è¯­å¥ä¸­æå®å­æ®µå±æ§ç±»ä¼¼ãç¸æ¯å¨ææ å°ï¼éè¿éææ å°å¯ä»¥æ·»å æ´è¯¦ç»ãæ´ç²¾åçéç½®ä¿¡æ¯ã\n\nå¦ä½å®ä¹ä¸ä¸ª Mapping\n\nPUT /books\n{\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# å¨ææ å°\n\nå¨ææ å°æ¯ä¸ç§å·æçæ¹å¼ï¼å¯ç´æ¥åå»ºç´¢å¼å¹¶åå¥ææ¡£ï¼ææ¡£ä¸­å­æ®µçç±»åæ¯ Elasticsearch èªå¨è¯å«çï¼ä¸éè¦å¨åå»ºç´¢å¼çæ¶åè®¾ç½®å­æ®µçç±»åãå¨å®éé¡¹ç®ä¸­ï¼å¦æéå°çä¸å¡å¨å¯¼å¥æ°æ®ä¹åä¸ç¡®å®æåªäºå­æ®µï¼ä¹ä¸æ¸æ¥å­æ®µçç±»åæ¯ä»ä¹ï¼ä½¿ç¨å¨ææ å°éå¸¸åéãå½ Elasticsearch å¨ææ¡£ä¸­ç¢°å°ä¸ä¸ªä»¥åæ²¡è§è¿çå­æ®µæ¶ï¼å®ä¼å©ç¨å¨ææ å°æ¥å³å®è¯¥å­æ®µçç±»åï¼å¹¶èªå¨æè¯¥å­æ®µæ·»å å°æ å°ä¸­ï¼æ ¹æ®å­æ®µçåå¼èªå¨æ¨æµå­æ®µç±»åçè§åè§ä¸è¡¨ï¼\n\nJSON æ ¼å¼çæ°æ®      èªå¨æ¨æµçå­æ®µç±»å\nnull            æ²¡æå­æ®µè¢«æ·»å \ntrue or false   boolean ç±»å\næµ®ç¹ç±»åæ°å­          float ç±»å\næ°å­              long ç±»å\nJSON å¯¹è±¡         object ç±»å\næ°ç»              ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®\nstring          æå¯è½æ¯ date ç±»åï¼è¥å¼å¯æ¥ææ£æµï¼ãdouble æ long ç±»åãtext ç±»åãkeyword ç±»å\n\nä¸é¢ä¸¾ä¸ä¸ªä¾å­è®¤è¯å¨æ mappingï¼å¨ Elasticsearch ä¸­åå»ºä¸ä¸ªæ°çç´¢å¼å¹¶æ¥çå®ç mappingï¼å½ä»¤å¦ä¸ï¼\n\nPUT books\nGET books/_mapping\n\n\næ­¤æ¶ books ç´¢å¼ç mapping æ¯ç©ºçï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {}\n  }\n}\n\n\nåå¾ books ç´¢å¼ä¸­åå¥ä¸æ¡ææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nPUT books/it/1\n{\n\t"id": 1,\n\t"publish_date": "2019-11-10",\n\t"name": "master Elasticsearch"\n}\n\n\nææ¡£åå¥å®æä¹åï¼åæ¬¡æ¥ç mappingï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {\n      "properties": {\n        "id": {\n          "type": "long"\n        },\n        "name": {\n          "type": "text",\n          "fields": {\n            "keyword": {\n              "type": "keyword",\n              "ignore_above": 256\n            }\n          }\n        },\n        "publish_date": {\n          "type": "date"\n        }\n      }\n    }\n  }\n}\n\n\nä½¿ç¨å¨æ mapping è¦ç»åå®éä¸å¡éæ±æ¥ç»¼åèèï¼å¦æå° Elasticsearch å½ä½ä¸»è¦çæ°æ®å­å¨ä½¿ç¨ï¼å¹¶ä¸å¸æåºç°æªç¥å­æ®µæ¶æåºå¼å¸¸æ¥æéä½ æ³¨æè¿ä¸é®é¢ï¼é£ä¹å¼å¯å¨æ mapping å¹¶ä¸éç¨ãå¨ mapping ä¸­å¯ä»¥éè¿ dynamic è®¾ç½®æ¥æ§å¶æ¯å¦èªå¨æ°å¢å­æ®µï¼æ¥åä»¥ä¸åæ°ï¼\n\n * trueï¼é»è®¤å¼ä¸º trueï¼èªå¨æ·»å å­æ®µã\n * falseï¼å¿½ç¥æ°çå­æ®µã\n * strictï¼ä¸¥æ ¼æ¨¡å¼ï¼åç°æ°çå­æ®µæåºå¼å¸¸ã\n\n\n# 3.2. åºç¡ç±»å\n\nç±»å      å³é®å­\nå­ç¬¦ä¸²ç±»å   stringãtextãkeyword\næ°å­ç±»å    longãintegerãshortãbyteãdoubleãfloatãhalf_floatãscaled_float\næ¥æç±»å    date\nå¸å°ç±»å    boolean\näºè¿å¶ç±»å   binary\nèå´ç±»å    range\n\n\n# 3.3. å¤æç±»å\n\nç±»å     å³é®å­\næ°ç»ç±»å   array\nå¯¹è±¡ç±»å   object\nåµå¥ç±»å   nested\n\n\n# 3.4. ç¹æ®ç±»å\n\nç±»å       å³é®å­\nå°çç±»å     geo_point\nå°çå¾å½¢ç±»å   geo_shape\nIP ç±»å    ip\nèå´ç±»å     completion\nä»¤çè®¡æ°ç±»å   token_count\néä»¶ç±»å     attachment\næ½åç±»å     percolator\n\n\n# 3.5. Mapping å±æ§\n\nElasticsearch ç mapping ä¸­çå­æ®µå±æ§éå¸¸å¤ï¼å·ä½å¦ä¸è¡¨æ ¼ï¼\n\n| å±æ§å | æè¿° | | :- | :- | | | type | å­æ®µç±»åï¼å¸¸ç¨çæ textãinteger ç­ç­ã | | index | å½åå­æ®µæ¯å¦è¢«ä½ä¸ºç´¢å¼ãå¯éå¼ä¸º trueï¼é»è®¤ä¸º trueã | | store | æ¯å¦å­å¨æå®å­æ®µï¼å¯éå¼ä¸º true | falseï¼è®¾ç½® true æå³çéè¦å¼è¾åç¬çå­å¨ç©ºé´ä¸ºè¿ä¸ªå­æ®µåå­å¨ï¼èä¸è¿ä¸ªå­å¨æ¯ç¬ç«äº _source çå­å¨çã | | norms | æ¯å¦ä½¿ç¨å½ä¸åå å­ï¼å¯éå¼ä¸º true | falseï¼ä¸éè¦å¯¹æå­æ®µè¿è¡æåæåºæ¶ï¼å¯ç¦ç¨å®ï¼èçç©ºé´ï¼type ä¸º text æ¶ï¼é»è®¤ä¸º trueï¼è type ä¸º keyword æ¶ï¼é»è®¤ä¸º falseã | | index_options | ç´¢å¼éé¡¹æ§å¶æ·»å å°åæç´¢å¼ï¼Inverted Indexï¼çä¿¡æ¯ï¼è¿äºä¿¡æ¯ç¨äºæç´¢ï¼Searchï¼åé«äº®æ¾ç¤ºï¼docsï¼åªç´¢å¼ææ¡£ç¼å·(Doc Number)ï¼freqsï¼ç´¢å¼ææ¡£ç¼å·åè¯é¢çï¼term frequencyï¼ï¼positionsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çåè¯ä½ç½®ï¼åºå·ï¼ï¼offsetsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çï¼è¯åç§»éï¼å¼å§åç»æä½ç½®ï¼åè¯ä½ç½®ï¼åºå·ï¼ãé»è®¤æåµä¸ï¼è¢«åæçå­ç¬¦ä¸²ï¼analyzed stringï¼å­æ®µä½¿ç¨ positionsï¼å¶ä»å­æ®µé»è®¤ä½¿ç¨ docsãæ­¤å¤ï¼éè¦æ³¨æçæ¯ index_option æ¯ elasticsearch ç¹æçè®¾ç½®å±æ§ï¼ä¸´è¿æç´¢åç­è¯­æ¥è¯¢æ¶ï¼index_option å¿é¡»è®¾ç½®ä¸º offsetsï¼åæ¶é«äº®ä¹å¯ä½¿ç¨ postings highlighterã | | term_vector | ç´¢å¼éé¡¹æ§å¶è¯åéç¸å³ä¿¡æ¯ï¼noï¼é»è®¤å¼ï¼è¡¨ç¤ºä¸å­å¨è¯åéç¸å³ä¿¡æ¯ï¼yesï¼åªå­å¨è¯åéä¿¡æ¯ï¼with_positionsï¼å­å¨è¯é¡¹åè¯é¡¹ä½ç½®ï¼with_offsetsï¼å­å¨è¯é¡¹åå­ç¬¦åç§»ä½ç½®ï¼with_positions_offsetsï¼å­å¨è¯é¡¹ãè¯é¡¹ä½ç½®ãå­ç¬¦åç§»ä½ç½®ãterm_vector æ¯ lucene å±é¢çç´¢å¼è®¾ç½®ã | | similarity | æå®ææ¡£ç¸ä¼¼åº¦ç®æ³ï¼ä¹å¯ä»¥å«è¯åæ¨¡åï¼ï¼BM25ï¼ES 5 ä¹åçé»è®¤è®¾ç½®ã | | copy_to | å¤å¶å°èªå®ä¹ _all å­æ®µï¼å¼æ¯æ°ç»å½¢å¼ï¼å³è¡¨æå¯ä»¥æå®å¤ä¸ªèªå®ä¹çå­æ®µã | | analyzer | æå®ç´¢å¼åæç´¢æ¶çåæå¨ï¼å¦æåæ¶æå® search_analyzer åæç´¢æ¶ä¼ä¼åä½¿ç¨ search_analyzerã | | search_analyzer | æå®æç´¢æ¶çåæå¨ï¼æç´¢æ¶çä¼åçº§æé«ã | | null_value | ç¨äºéè¦å¯¹ Null å¼å®ç°æç´¢çåºæ¯ï¼åªæ Keyword ç±»åæ¯ææ­¤éç½®ã |\n\n\n# 4. ç´¢å¼æ¥è¯¢\n\n\n# 4.1. å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢\n\nElasticsearch çæç´¢ api æ¯æä¸ä¸ªç´¢å¼ï¼indexï¼çå¤ä¸ªç±»åï¼typeï¼æ¥è¯¢ä»¥å**å¤ä¸ªç´¢å¼ï¼indexï¼**çæ¥è¯¢ã\n\nä¾å¦ï¼æä»¬å¯ä»¥æç´¢ twitter ç´¢å¼ä¸é¢ææå¹éæ¡ä»¶çææç±»åä¸­ææ¡£ï¼å¦ä¸ï¼\n\nGET /twitter/_search?q=user:shay\n\n\næä»¬ä¹å¯ä»¥æç´¢ä¸ä¸ªç´¢å¼ä¸é¢æå®å¤ä¸ª type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nGET /twitter/tweet,user/_search?q=user:banon\n\n\næä»¬ä¹å¯ä»¥æç´¢å¤ä¸ªç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nGET /twitter,elasticsearch/_search?q=tag:wow\n\n\næ­¤å¤æä»¬ä¹å¯ä»¥æç´¢ææç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼ç¨_all è¡¨ç¤ºææç´¢å¼ï¼å¦ä¸ï¼\n\nGET /_all/_search?q=tag:wow\n\n\nçè³æä»¬å¯ä»¥æç´¢ææç´¢å¼åææ type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nGET /_search?q=tag:wow\n\n\n\n# 4.2. URI æç´¢\n\nElasticsearch æ¯æç¨ uri æç´¢ï¼å¯ç¨ get è¯·æ±éé¢æ¼æ¥ç¸å³çåæ°ï¼å¹¶ç¨ curl ç¸å³çå½ä»¤å°±å¯ä»¥è¿è¡æµè¯ã\n\nå¦ä¸æä¸ä¸ªç¤ºä¾ï¼\n\nGET twitter/_search?q=user:kimchy\n\n\nå¦ä¸æ¯ä¸ä¸ä¸ªè¯·æ±çç¸åºå®ä½ï¼\n\n{\n  "timed_out": false,\n  "took": 62,\n  "_shards": {\n    "total": 1,\n    "successful": 1,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 1,\n    "max_score": 1.3862944,\n    "hits": [\n      {\n        "_index": "twitter",\n        "_type": "_doc",\n        "_id": "0",\n        "_score": 1.3862944,\n        "_source": {\n          "user": "kimchy",\n          "date": "2009-11-15T14:12:12",\n          "message": "trying out Elasticsearch",\n          "likes": 0\n        }\n      }\n    ]\n  }\n}\n\n\nURI ä¸­åè®¸çåæ°ï¼\n\nåç§°                             æè¿°\nq                              æ¥è¯¢å­ç¬¦ä¸²ï¼æ å°å° query_string æ¥è¯¢\ndf                             å¨æ¥è¯¢ä¸­æªå®ä¹å­æ®µåç¼æ¶ä½¿ç¨çé»è®¤å­æ®µ\nanalyzer                       æ¥è¯¢å­ç¬¦ä¸²æ¶æå®çåè¯å¨\nanalyze_wildcard               æ¯å¦åè®¸ééç¬¦ååç¼æ¥è¯¢ï¼é»è®¤è®¾ç½®ä¸º false\nbatched_reduce_size            åºå¨åè°èç¹ä¸ä¸æ¬¡åå°çåçç»ææ°ãå¦æè¯·æ±ä¸­æ½å¨çåçæ°éå¾å¤§ï¼ååºå°æ­¤å¼ç¨ä½ä¿æ¤æºå¶ï¼ä»¥åå°æ¯ä¸ªæç´¢è¯·æ±çåå­å¼é\ndefault_operator               é»è®¤ä½¿ç¨çå¹éè¿ç®ç¬¦ï¼å¯ä»¥æ¯ANDæèORï¼é»è®¤æ¯OR\nlenient                        å¦æè®¾ç½®ä¸º trueï¼å°ä¼å¿½ç¥ç±äºæ ¼å¼åå¼èµ·çé®é¢ï¼å¦åæ°æ®å­æ®µæä¾ææ¬ï¼ï¼é»è®¤ä¸º false\nexplain                        å¯¹äºæ¯ä¸ª hitï¼åå«äºå·ä½å¦ä½è®¡ç®å¾åçè§£é\n_source                        è¯·æ±ææ¡£åå®¹çåæ°ï¼é»è®¤ trueï¼è®¾ç½® false çè¯ï¼ä¸è¿å_source\n                               å­æ®µï¼å¯ä»¥ä½¿ç¨**_source_includeå_source_exclude**åæ°åå«æå®è¿åå­æ®µåä¸è¿åçå­æ®µ\nstored_fields                  æå®æ¯ä¸ªå¹éè¿åçææ¡£ä¸­çå­å¨å­æ®µï¼å¤ä¸ªç¨éå·åéãä¸æå®ä»»ä½å¼å°å¯¼è´æ²¡æå­æ®µè¿å\nsort                           æåºæ¹å¼ï¼å¯ä»¥æ¯fieldNameãfieldName:ascæèfieldName:descçå½¢å¼ãfieldName\n                               å¯ä»¥æ¯ææ¡£ä¸­çå®éå­æ®µï¼ä¹å¯ä»¥æ¯è¯¸å¦_score å­æ®µï¼å¶è¡¨ç¤ºåºäºåæ°çæåºãæ­¤å¤å¯ä»¥æå®å¤ä¸ª sort\n                               åæ°ï¼é¡ºåºå¾éè¦ï¼\ntrack_scores                   å½æåºæ¶ï¼è¥è®¾ç½® trueï¼è¿åæ¯ä¸ªå½ä¸­ææ¡£çåæ°\ntrack_total_hits               æ¯å¦è¿åå¹éæ¡ä»¶å½ä¸­çæ»ææ¡£æ°ï¼é»è®¤ä¸º true\ntimeout                        è®¾ç½®æç´¢çè¶æ¶æ¶é´ï¼é»è®¤æ è¶æ¶æ¶é´\nterminate_after                å¨è¾¾å°æ¥è¯¢ç»æ­¢æ¡ä»¶ä¹åï¼æå®æ¯ä¸ªåçæ¶éçæå¤§ææ¡£æ°ãå¦æè®¾ç½®ï¼åå¨ååºä¸­å¤äºä¸ä¸ª terminated_early\n                               çå¸å°å­æ®µï¼ä»¥æç¤ºæ¥è¯¢æ§è¡æ¯å¦å®éä¸å·²ç»æ­¢ãé»è®¤ä¸º no terminate_after\nfrom                           ä»ç¬¬å æ¡ï¼ç´¢å¼ä»¥ 0 å¼å§ï¼ç»æå¼å§è¿åï¼é»è®¤ä¸º 0\nsize                           è¿åå½ä¸­çææ¡£æ°ï¼é»è®¤ä¸º 10\nsearch_type                    æç´¢çæ¹å¼ï¼å¯ä»¥æ¯dfs_query_then_fetchæquery_then_fetchãé»è®¤ä¸ºquery_then_fetch\nallow_partial_search_results   æ¯å¦å¯ä»¥è¿åé¨åç»æãå¦è®¾ç½®ä¸º falseï¼è¡¨ç¤ºå¦æè¯·æ±äº§çé¨åç»æï¼åè®¾ç½®ä¸ºè¿åæ´ä½æéï¼é»è®¤ä¸º\n                               trueï¼è¡¨ç¤ºåè®¸è¯·æ±å¨è¶æ¶æé¨åå¤±è´¥çæåµä¸è·å¾é¨åç»æ\n\n\n# 4.3. æ¥è¯¢æµç¨\n\nå¨ Elasticsearch ä¸­ï¼æ¥è¯¢æ¯ä¸ä¸ªæ¯è¾å¤æçæ§è¡æ¨¡å¼ï¼å ä¸ºæä»¬ä¸ç¥éé£äº document ä¼è¢«å¹éå°ï¼ä»»ä½ä¸ä¸ª shard ä¸é½æå¯è½ï¼æä»¥ä¸ä¸ª search è¯·æ±å¿é¡»æ¥è¯¢ä¸ä¸ªç´¢å¼æå¤ä¸ªç´¢å¼éé¢çææ shard æè½å®æ´çæ¥è¯¢å°æä»¬æ³è¦çç»æã\n\næ¾å°ææå¹éçç»ææ¯æ¥è¯¢çç¬¬ä¸æ­¥ï¼æ¥èªå¤ä¸ª shard ä¸çæ°æ®éå¨åé¡µè¿åå°å®¢æ·ç«¯ä¹åä¼è¢«åå¹¶å°ä¸ä¸ªæåºåç list åè¡¨ï¼ç±äºéè¦ç»è¿ä¸æ­¥å top N çæä½ï¼æä»¥ search éè¦è¿è¿ä¸¤ä¸ªé¶æ®µæè½å®æï¼åå«æ¯ query å fetchã\n\n\n# 5. åèèµæ\n\n * Elasticsearch å®ç½\n * Elasticsearch ç´¢å¼æ å°ç±»åå mapping å±æ§è¯¦è§£',normalizedContent:'# elasticsearch ç´¢å¼\n\n\n# 1. ç´¢å¼ç®¡çæä½\n\nelasticsearch ç´¢å¼ç®¡çä¸»è¦åæ¬å¦ä½è¿è¡ç´¢å¼çåå»ºãç´¢å¼çå é¤ãå¯æ¬çæ´æ°ãç´¢å¼è¯»åæéãç´¢å¼å«åçéç½®ç­ç­åå®¹ã\n\n\n# 1.1. ç´¢å¼å é¤\n\nes ç´¢å¼å é¤æä½å es éç¾¤ç http æ¥å£åéæå®ç´¢å¼ç delete http è¯·æ±å³å¯ï¼å¯ä»¥éè¿ curl å½ä»¤ï¼å·ä½å¦ä¸ï¼\n\ncurl -x delete http://{es_host}:{es_http_port}/{index}\n\n\nå¦æå é¤æåï¼å®ä¼è¿åå¦ä¸ä¿¡æ¯ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\ncurl -x delete http://10.10.10.66:9200/my_index?pretty\n\n\nä¸ºäºè¿åçä¿¡æ¯ä¾¿äºè¯»åï¼å¢å äº pretty åæ°ï¼\n\n{\n  "acknowledged" : true\n}\n\n\n\n# 1.2. ç´¢å¼å«å\n\nes çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nput /my_index\nput /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º es ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nes ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç elasticsearchï¼esï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# 2. settings è¯¦è§£\n\nelasticsearch ç´¢å¼çéç½®é¡¹ä¸»è¦åä¸ºéæéç½®å±æ§åå¨æéç½®å±æ§ï¼éæéç½®å±æ§æ¯ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼èå¨æéç½®å±æ§åå¯ä»¥éæ¶ä¿®æ¹ã\n\nes ç´¢å¼è®¾ç½®ç api ä¸º _settingsï¼å®æ´çç¤ºä¾å¦ä¸ï¼\n\nput /my_index\n{\n  "settings": {\n    "index": {\n      "number_of_shards": "1",\n      "number_of_replicas": "1",\n      "refresh_interval": "60s",\n      "analysis": {\n        "filter": {\n          "tsconvert": {\n            "type": "stconvert",\n            "convert_type": "t2s",\n            "delimiter": ","\n          },\n          "synonym": {\n            "type": "synonym",\n            "synonyms_path": "analysis/synonyms.txt"\n          }\n        },\n        "analyzer": {\n          "ik_max_word_synonym": {\n            "filter": [\n              "synonym",\n              "tsconvert",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_max_word"\n          },\n          "ik_smart_synonym": {\n            "filter": [\n              "synonym",\n              "standard",\n              "lowercase",\n              "stop"\n            ],\n            "tokenizer": "ik_smart"\n          }\n        },\n\t\t\t"mapping": {\n\t\t\t\t"coerce": "false",\n\t\t\t\t"ignore_malformed": "false"\n\t\t\t},\n\t\t\t"indexing": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"index": {\n\t\t\t\t\t\t\t"warn": "2s",\n\t\t\t\t\t\t\t"info": "1s"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"provided_name": "hospital_202101070533",\n\t\t\t"query": {\n\t\t\t\t"default_field": "timestamp",\n\t\t\t\t"parse": {\n\t\t\t\t\t"allow_unmapped_fields": "false"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"requests": {\n\t\t\t\t"cache": {\n\t\t\t\t\t"enable": "true"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"search": {\n\t\t\t\t"slowlog": {\n\t\t\t\t\t"threshold": {\n\t\t\t\t\t\t"fetch": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "200ms"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"query": {\n\t\t\t\t\t\t\t"warn": "1s",\n\t\t\t\t\t\t\t"info": "500ms"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 2.1. åºå®å±æ§\n\n * index.creation_dateï¼é¡¾åæä¹ç´¢å¼çåå»ºæ¶é´æ³ã\n * index.uuidï¼ç´¢å¼ç uuid ä¿¡æ¯ã\n * index.version.createdï¼ç´¢å¼ççæ¬å·ã\n\n\n# 2.2. ç´¢å¼éæéç½®\n\n * index.number_of_shardsï¼ç´¢å¼çä¸»åçæ°ï¼é»è®¤å¼æ¯ 5ãè¿ä¸ªéç½®å¨ç´¢å¼åå»ºåä¸è½ä¿®æ¹ï¼å¨ es å±é¢ï¼å¯ä»¥éè¿ es.index.max_number_of_shards å±æ§è®¾ç½®ç´¢å¼æå¤§çåçæ°ï¼é»è®¤ä¸º 1024ã\n * index.codecï¼æ°æ®å­å¨çåç¼©ç®æ³ï¼é»è®¤å¼ä¸º lz4ï¼å¯éæ©å¼è¿æ best_compressionï¼å®æ¯ lz4 å¯ä»¥è·å¾æ´å¥½çåç¼©æ¯ï¼å³å æ®è¾å°çç£çç©ºé´ï¼ä½å­å¨æ§è½æ¯ lz4 ä½ï¼ã\n * index.routing_partition_sizeï¼è·¯ç±ååºæ°ï¼å¦æè®¾ç½®äºè¯¥åæ°ï¼å¶è·¯ç±ç®æ³ä¸ºï¼( hash(_routing) + hash(_id) % index.routing_parttion_size ) % number_of_shardsãå¦æè¯¥å¼ä¸è®¾ç½®ï¼åè·¯ç±ç®æ³ä¸º hash(_routing) % number_of_shardingsï¼_routing é»è®¤å¼ä¸º _idã\n\néæéç½®éï¼æéè¦çé¨åæ¯éç½®åæå¨ï¼config analyzersï¼ã\n\n * index.analysis\n   \n   ï¼åæå¨æå¤å±çéç½®é¡¹ï¼åé¨ä¸»è¦åä¸º char_filterãtokenizerãfilter å analyzerã\n   \n   * char_filterï¼å®ä¹æ°çå­ç¬¦è¿æ»¤å¨ä»¶ã\n   * tokenizerï¼å®ä¹æ°çåè¯å¨ã\n   * filterï¼å®ä¹æ°ç token filterï¼å¦åä¹è¯ filterã\n   * analyzerï¼éç½®æ°çåæå¨ï¼ä¸è¬æ¯ char_filterãtokenizer åä¸äº token filter çç»åã\n\n\n# 2.3. ç´¢å¼å¨æéç½®\n\n * index.number_of_replicasï¼ç´¢å¼ä¸»åççå¯æ¬æ°ï¼é»è®¤å¼æ¯ 1ï¼è¯¥å¼å¿é¡»å¤§äºç­äº 0ï¼è¿ä¸ªéç½®å¯ä»¥éæ¶ä¿®æ¹ã\n * index.refresh_intervalï¼æ§è¡æ°ç´¢å¼æ°æ®çå·æ°æä½é¢çï¼è¯¥æä½ä½¿å¯¹ç´¢å¼çææ°æ´æ¹å¯¹æç´¢å¯è§ï¼é»è®¤ä¸º 1sãä¹å¯ä»¥è®¾ç½®ä¸º -1 ä»¥ç¦ç¨å·æ°ãæ´è¯¦ç»ä¿¡æ¯åè elasticsearch å¨æä¿®æ¹ refresh_interval å·æ°é´éè®¾ç½®ã\n\n\n# 3. mapping è¯¦è§£\n\nå¨ elasticsearch ä¸­ï¼mappingï¼æ å°ï¼ï¼ç¨æ¥å®ä¹ä¸ä¸ªææ¡£ä»¥åå¶æåå«çå­æ®µå¦ä½è¢«å­å¨åç´¢å¼ï¼å¯ä»¥å¨æ å°ä¸­äºåå®ä¹å­æ®µçæ°æ®ç±»åãå­æ®µçæéãåè¯å¨ç­å±æ§ï¼å°±å¦åå¨å³ç³»åæ°æ®åºä¸­åå»ºæ°æ®è¡¨æ¶ä¼è®¾ç½®å­æ®µçç±»åã\n\nmapping ä¼æ json ææ¡£æ å°æ lucene æéè¦çæå¹³æ ¼å¼\n\nä¸ä¸ª mapping å±äºä¸ä¸ªç´¢å¼ç type\n\n * æ¯ä¸ªææ¡£é½å±äºä¸ä¸ª type\n * ä¸ä¸ª type æä¸ä¸ª mapping å®ä¹\n * 7.0 å¼å§ï¼ä¸éè¦å¨ mapping å®ä¹ä¸­æå® type ä¿¡æ¯\n\n\n# 3.1. æ å°åç±»\n\nå¨ elasticsearch ä¸­ï¼æ å°å¯åä¸ºéææ å°åå¨ææ å°ãå¨å³ç³»åæ°æ®åºä¸­åå¥æ°æ®ä¹åé¦åè¦å»ºè¡¨ï¼å¨å»ºè¡¨è¯­å¥ä¸­å£°æå­æ®µçå±æ§ï¼å¨ elasticsearch ä¸­ï¼åä¸å¿å¦æ­¤ï¼elasticsearch æéè¦çåè½ä¹ä¸å°±æ¯è®©ä½ å°½å¯è½å¿«å°å¼å§æ¢ç´¢æ°æ®ï¼ææ¡£åå¥ elasticsearch ä¸­ï¼å®ä¼æ ¹æ®å­æ®µçç±»åèªå¨è¯å«ï¼è¿ç§æºå¶ç§°ä¸ºå¨ææ å°ï¼èéææ å°åæ¯åå¥æ°æ®ä¹åå¯¹å­æ®µçå±æ§è¿è¡æå·¥è®¾ç½®ã\n\n# éææ å°\n\néææ å°æ¯å¨åå»ºç´¢å¼æ¶æå·¥æå®ç´¢å¼æ å°ãéææ å°å sql ä¸­å¨å»ºè¡¨è¯­å¥ä¸­æå®å­æ®µå±æ§ç±»ä¼¼ãç¸æ¯å¨ææ å°ï¼éè¿éææ å°å¯ä»¥æ·»å æ´è¯¦ç»ãæ´ç²¾åçéç½®ä¿¡æ¯ã\n\nå¦ä½å®ä¹ä¸ä¸ª mapping\n\nput /books\n{\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\n# å¨ææ å°\n\nå¨ææ å°æ¯ä¸ç§å·æçæ¹å¼ï¼å¯ç´æ¥åå»ºç´¢å¼å¹¶åå¥ææ¡£ï¼ææ¡£ä¸­å­æ®µçç±»åæ¯ elasticsearch èªå¨è¯å«çï¼ä¸éè¦å¨åå»ºç´¢å¼çæ¶åè®¾ç½®å­æ®µçç±»åãå¨å®éé¡¹ç®ä¸­ï¼å¦æéå°çä¸å¡å¨å¯¼å¥æ°æ®ä¹åä¸ç¡®å®æåªäºå­æ®µï¼ä¹ä¸æ¸æ¥å­æ®µçç±»åæ¯ä»ä¹ï¼ä½¿ç¨å¨ææ å°éå¸¸åéãå½ elasticsearch å¨ææ¡£ä¸­ç¢°å°ä¸ä¸ªä»¥åæ²¡è§è¿çå­æ®µæ¶ï¼å®ä¼å©ç¨å¨ææ å°æ¥å³å®è¯¥å­æ®µçç±»åï¼å¹¶èªå¨æè¯¥å­æ®µæ·»å å°æ å°ä¸­ï¼æ ¹æ®å­æ®µçåå¼èªå¨æ¨æµå­æ®µç±»åçè§åè§ä¸è¡¨ï¼\n\njson æ ¼å¼çæ°æ®      èªå¨æ¨æµçå­æ®µç±»å\nnull            æ²¡æå­æ®µè¢«æ·»å \ntrue or false   boolean ç±»å\næµ®ç¹ç±»åæ°å­          float ç±»å\næ°å­              long ç±»å\njson å¯¹è±¡         object ç±»å\næ°ç»              ç±æ°ç»ä¸­ç¬¬ä¸ä¸ªéç©ºå¼å³å®\nstring          æå¯è½æ¯ date ç±»åï¼è¥å¼å¯æ¥ææ£æµï¼ãdouble æ long ç±»åãtext ç±»åãkeyword ç±»å\n\nä¸é¢ä¸¾ä¸ä¸ªä¾å­è®¤è¯å¨æ mappingï¼å¨ elasticsearch ä¸­åå»ºä¸ä¸ªæ°çç´¢å¼å¹¶æ¥çå®ç mappingï¼å½ä»¤å¦ä¸ï¼\n\nput books\nget books/_mapping\n\n\næ­¤æ¶ books ç´¢å¼ç mapping æ¯ç©ºçï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {}\n  }\n}\n\n\nåå¾ books ç´¢å¼ä¸­åå¥ä¸æ¡ææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nput books/it/1\n{\n\t"id": 1,\n\t"publish_date": "2019-11-10",\n\t"name": "master elasticsearch"\n}\n\n\nææ¡£åå¥å®æä¹åï¼åæ¬¡æ¥ç mappingï¼è¿åç»æå¦ä¸ï¼\n\n{\n  "books": {\n    "mappings": {\n      "properties": {\n        "id": {\n          "type": "long"\n        },\n        "name": {\n          "type": "text",\n          "fields": {\n            "keyword": {\n              "type": "keyword",\n              "ignore_above": 256\n            }\n          }\n        },\n        "publish_date": {\n          "type": "date"\n        }\n      }\n    }\n  }\n}\n\n\nä½¿ç¨å¨æ mapping è¦ç»åå®éä¸å¡éæ±æ¥ç»¼åèèï¼å¦æå° elasticsearch å½ä½ä¸»è¦çæ°æ®å­å¨ä½¿ç¨ï¼å¹¶ä¸å¸æåºç°æªç¥å­æ®µæ¶æåºå¼å¸¸æ¥æéä½ æ³¨æè¿ä¸é®é¢ï¼é£ä¹å¼å¯å¨æ mapping å¹¶ä¸éç¨ãå¨ mapping ä¸­å¯ä»¥éè¿ dynamic è®¾ç½®æ¥æ§å¶æ¯å¦èªå¨æ°å¢å­æ®µï¼æ¥åä»¥ä¸åæ°ï¼\n\n * trueï¼é»è®¤å¼ä¸º trueï¼èªå¨æ·»å å­æ®µã\n * falseï¼å¿½ç¥æ°çå­æ®µã\n * strictï¼ä¸¥æ ¼æ¨¡å¼ï¼åç°æ°çå­æ®µæåºå¼å¸¸ã\n\n\n# 3.2. åºç¡ç±»å\n\nç±»å      å³é®å­\nå­ç¬¦ä¸²ç±»å   stringãtextãkeyword\næ°å­ç±»å    longãintegerãshortãbyteãdoubleãfloatãhalf_floatãscaled_float\næ¥æç±»å    date\nå¸å°ç±»å    boolean\näºè¿å¶ç±»å   binary\nèå´ç±»å    range\n\n\n# 3.3. å¤æç±»å\n\nç±»å     å³é®å­\næ°ç»ç±»å   array\nå¯¹è±¡ç±»å   object\nåµå¥ç±»å   nested\n\n\n# 3.4. ç¹æ®ç±»å\n\nç±»å       å³é®å­\nå°çç±»å     geo_point\nå°çå¾å½¢ç±»å   geo_shape\nip ç±»å    ip\nèå´ç±»å     completion\nä»¤çè®¡æ°ç±»å   token_count\néä»¶ç±»å     attachment\næ½åç±»å     percolator\n\n\n# 3.5. mapping å±æ§\n\nelasticsearch ç mapping ä¸­çå­æ®µå±æ§éå¸¸å¤ï¼å·ä½å¦ä¸è¡¨æ ¼ï¼\n\n| å±æ§å | æè¿° | | :- | :- | | | type | å­æ®µç±»åï¼å¸¸ç¨çæ textãinteger ç­ç­ã | | index | å½åå­æ®µæ¯å¦è¢«ä½ä¸ºç´¢å¼ãå¯éå¼ä¸º trueï¼é»è®¤ä¸º trueã | | store | æ¯å¦å­å¨æå®å­æ®µï¼å¯éå¼ä¸º true | falseï¼è®¾ç½® true æå³çéè¦å¼è¾åç¬çå­å¨ç©ºé´ä¸ºè¿ä¸ªå­æ®µåå­å¨ï¼èä¸è¿ä¸ªå­å¨æ¯ç¬ç«äº _source çå­å¨çã | | norms | æ¯å¦ä½¿ç¨å½ä¸åå å­ï¼å¯éå¼ä¸º true | falseï¼ä¸éè¦å¯¹æå­æ®µè¿è¡æåæåºæ¶ï¼å¯ç¦ç¨å®ï¼èçç©ºé´ï¼type ä¸º text æ¶ï¼é»è®¤ä¸º trueï¼è type ä¸º keyword æ¶ï¼é»è®¤ä¸º falseã | | index_options | ç´¢å¼éé¡¹æ§å¶æ·»å å°åæç´¢å¼ï¼inverted indexï¼çä¿¡æ¯ï¼è¿äºä¿¡æ¯ç¨äºæç´¢ï¼searchï¼åé«äº®æ¾ç¤ºï¼docsï¼åªç´¢å¼ææ¡£ç¼å·(doc number)ï¼freqsï¼ç´¢å¼ææ¡£ç¼å·åè¯é¢çï¼term frequencyï¼ï¼positionsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çåè¯ä½ç½®ï¼åºå·ï¼ï¼offsetsï¼ç´¢å¼ææ¡£ç¼å·ï¼è¯é¢çï¼è¯åç§»éï¼å¼å§åç»æä½ç½®ï¼åè¯ä½ç½®ï¼åºå·ï¼ãé»è®¤æåµä¸ï¼è¢«åæçå­ç¬¦ä¸²ï¼analyzed stringï¼å­æ®µä½¿ç¨ positionsï¼å¶ä»å­æ®µé»è®¤ä½¿ç¨ docsãæ­¤å¤ï¼éè¦æ³¨æçæ¯ index_option æ¯ elasticsearch ç¹æçè®¾ç½®å±æ§ï¼ä¸´è¿æç´¢åç­è¯­æ¥è¯¢æ¶ï¼index_option å¿é¡»è®¾ç½®ä¸º offsetsï¼åæ¶é«äº®ä¹å¯ä½¿ç¨ postings highlighterã | | term_vector | ç´¢å¼éé¡¹æ§å¶è¯åéç¸å³ä¿¡æ¯ï¼noï¼é»è®¤å¼ï¼è¡¨ç¤ºä¸å­å¨è¯åéç¸å³ä¿¡æ¯ï¼yesï¼åªå­å¨è¯åéä¿¡æ¯ï¼with_positionsï¼å­å¨è¯é¡¹åè¯é¡¹ä½ç½®ï¼with_offsetsï¼å­å¨è¯é¡¹åå­ç¬¦åç§»ä½ç½®ï¼with_positions_offsetsï¼å­å¨è¯é¡¹ãè¯é¡¹ä½ç½®ãå­ç¬¦åç§»ä½ç½®ãterm_vector æ¯ lucene å±é¢çç´¢å¼è®¾ç½®ã | | similarity | æå®ææ¡£ç¸ä¼¼åº¦ç®æ³ï¼ä¹å¯ä»¥å«è¯åæ¨¡åï¼ï¼bm25ï¼es 5 ä¹åçé»è®¤è®¾ç½®ã | | copy_to | å¤å¶å°èªå®ä¹ _all å­æ®µï¼å¼æ¯æ°ç»å½¢å¼ï¼å³è¡¨æå¯ä»¥æå®å¤ä¸ªèªå®ä¹çå­æ®µã | | analyzer | æå®ç´¢å¼åæç´¢æ¶çåæå¨ï¼å¦æåæ¶æå® search_analyzer åæç´¢æ¶ä¼ä¼åä½¿ç¨ search_analyzerã | | search_analyzer | æå®æç´¢æ¶çåæå¨ï¼æç´¢æ¶çä¼åçº§æé«ã | | null_value | ç¨äºéè¦å¯¹ null å¼å®ç°æç´¢çåºæ¯ï¼åªæ keyword ç±»åæ¯ææ­¤éç½®ã |\n\n\n# 4. ç´¢å¼æ¥è¯¢\n\n\n# 4.1. å¤ä¸ª indexãå¤ä¸ª type æ¥è¯¢\n\nelasticsearch çæç´¢ api æ¯æä¸ä¸ªç´¢å¼ï¼indexï¼çå¤ä¸ªç±»åï¼typeï¼æ¥è¯¢ä»¥å**å¤ä¸ªç´¢å¼ï¼indexï¼**çæ¥è¯¢ã\n\nä¾å¦ï¼æä»¬å¯ä»¥æç´¢ twitter ç´¢å¼ä¸é¢ææå¹éæ¡ä»¶çææç±»åä¸­ææ¡£ï¼å¦ä¸ï¼\n\nget /twitter/_search?q=user:shay\n\n\næä»¬ä¹å¯ä»¥æç´¢ä¸ä¸ªç´¢å¼ä¸é¢æå®å¤ä¸ª type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nget /twitter/tweet,user/_search?q=user:banon\n\n\næä»¬ä¹å¯ä»¥æç´¢å¤ä¸ªç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nget /twitter,elasticsearch/_search?q=tag:wow\n\n\næ­¤å¤æä»¬ä¹å¯ä»¥æç´¢ææç´¢å¼ä¸å¹éæ¡ä»¶çææ¡£ï¼ç¨_all è¡¨ç¤ºææç´¢å¼ï¼å¦ä¸ï¼\n\nget /_all/_search?q=tag:wow\n\n\nçè³æä»¬å¯ä»¥æç´¢ææç´¢å¼åææ type ä¸å¹éæ¡ä»¶çææ¡£ï¼å¦ä¸ï¼\n\nget /_search?q=tag:wow\n\n\n\n# 4.2. uri æç´¢\n\nelasticsearch æ¯æç¨ uri æç´¢ï¼å¯ç¨ get è¯·æ±éé¢æ¼æ¥ç¸å³çåæ°ï¼å¹¶ç¨ curl ç¸å³çå½ä»¤å°±å¯ä»¥è¿è¡æµè¯ã\n\nå¦ä¸æä¸ä¸ªç¤ºä¾ï¼\n\nget twitter/_search?q=user:kimchy\n\n\nå¦ä¸æ¯ä¸ä¸ä¸ªè¯·æ±çç¸åºå®ä½ï¼\n\n{\n  "timed_out": false,\n  "took": 62,\n  "_shards": {\n    "total": 1,\n    "successful": 1,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 1,\n    "max_score": 1.3862944,\n    "hits": [\n      {\n        "_index": "twitter",\n        "_type": "_doc",\n        "_id": "0",\n        "_score": 1.3862944,\n        "_source": {\n          "user": "kimchy",\n          "date": "2009-11-15t14:12:12",\n          "message": "trying out elasticsearch",\n          "likes": 0\n        }\n      }\n    ]\n  }\n}\n\n\nuri ä¸­åè®¸çåæ°ï¼\n\nåç§°                             æè¿°\nq                              æ¥è¯¢å­ç¬¦ä¸²ï¼æ å°å° query_string æ¥è¯¢\ndf                             å¨æ¥è¯¢ä¸­æªå®ä¹å­æ®µåç¼æ¶ä½¿ç¨çé»è®¤å­æ®µ\nanalyzer                       æ¥è¯¢å­ç¬¦ä¸²æ¶æå®çåè¯å¨\nanalyze_wildcard               æ¯å¦åè®¸ééç¬¦ååç¼æ¥è¯¢ï¼é»è®¤è®¾ç½®ä¸º false\nbatched_reduce_size            åºå¨åè°èç¹ä¸ä¸æ¬¡åå°çåçç»ææ°ãå¦æè¯·æ±ä¸­æ½å¨çåçæ°éå¾å¤§ï¼ååºå°æ­¤å¼ç¨ä½ä¿æ¤æºå¶ï¼ä»¥åå°æ¯ä¸ªæç´¢è¯·æ±çåå­å¼é\ndefault_operator               é»è®¤ä½¿ç¨çå¹éè¿ç®ç¬¦ï¼å¯ä»¥æ¯andæèorï¼é»è®¤æ¯or\nlenient                        å¦æè®¾ç½®ä¸º trueï¼å°ä¼å¿½ç¥ç±äºæ ¼å¼åå¼èµ·çé®é¢ï¼å¦åæ°æ®å­æ®µæä¾ææ¬ï¼ï¼é»è®¤ä¸º false\nexplain                        å¯¹äºæ¯ä¸ª hitï¼åå«äºå·ä½å¦ä½è®¡ç®å¾åçè§£é\n_source                        è¯·æ±ææ¡£åå®¹çåæ°ï¼é»è®¤ trueï¼è®¾ç½® false çè¯ï¼ä¸è¿å_source\n                               å­æ®µï¼å¯ä»¥ä½¿ç¨**_source_includeå_source_exclude**åæ°åå«æå®è¿åå­æ®µåä¸è¿åçå­æ®µ\nstored_fields                  æå®æ¯ä¸ªå¹éè¿åçææ¡£ä¸­çå­å¨å­æ®µï¼å¤ä¸ªç¨éå·åéãä¸æå®ä»»ä½å¼å°å¯¼è´æ²¡æå­æ®µè¿å\nsort                           æåºæ¹å¼ï¼å¯ä»¥æ¯fieldnameãfieldname:ascæèfieldname:descçå½¢å¼ãfieldname\n                               å¯ä»¥æ¯ææ¡£ä¸­çå®éå­æ®µï¼ä¹å¯ä»¥æ¯è¯¸å¦_score å­æ®µï¼å¶è¡¨ç¤ºåºäºåæ°çæåºãæ­¤å¤å¯ä»¥æå®å¤ä¸ª sort\n                               åæ°ï¼é¡ºåºå¾éè¦ï¼\ntrack_scores                   å½æåºæ¶ï¼è¥è®¾ç½® trueï¼è¿åæ¯ä¸ªå½ä¸­ææ¡£çåæ°\ntrack_total_hits               æ¯å¦è¿åå¹éæ¡ä»¶å½ä¸­çæ»ææ¡£æ°ï¼é»è®¤ä¸º true\ntimeout                        è®¾ç½®æç´¢çè¶æ¶æ¶é´ï¼é»è®¤æ è¶æ¶æ¶é´\nterminate_after                å¨è¾¾å°æ¥è¯¢ç»æ­¢æ¡ä»¶ä¹åï¼æå®æ¯ä¸ªåçæ¶éçæå¤§ææ¡£æ°ãå¦æè®¾ç½®ï¼åå¨ååºä¸­å¤äºä¸ä¸ª terminated_early\n                               çå¸å°å­æ®µï¼ä»¥æç¤ºæ¥è¯¢æ§è¡æ¯å¦å®éä¸å·²ç»æ­¢ãé»è®¤ä¸º no terminate_after\nfrom                           ä»ç¬¬å æ¡ï¼ç´¢å¼ä»¥ 0 å¼å§ï¼ç»æå¼å§è¿åï¼é»è®¤ä¸º 0\nsize                           è¿åå½ä¸­çææ¡£æ°ï¼é»è®¤ä¸º 10\nsearch_type                    æç´¢çæ¹å¼ï¼å¯ä»¥æ¯dfs_query_then_fetchæquery_then_fetchãé»è®¤ä¸ºquery_then_fetch\nallow_partial_search_results   æ¯å¦å¯ä»¥è¿åé¨åç»æãå¦è®¾ç½®ä¸º falseï¼è¡¨ç¤ºå¦æè¯·æ±äº§çé¨åç»æï¼åè®¾ç½®ä¸ºè¿åæ´ä½æéï¼é»è®¤ä¸º\n                               trueï¼è¡¨ç¤ºåè®¸è¯·æ±å¨è¶æ¶æé¨åå¤±è´¥çæåµä¸è·å¾é¨åç»æ\n\n\n# 4.3. æ¥è¯¢æµç¨\n\nå¨ elasticsearch ä¸­ï¼æ¥è¯¢æ¯ä¸ä¸ªæ¯è¾å¤æçæ§è¡æ¨¡å¼ï¼å ä¸ºæä»¬ä¸ç¥éé£äº document ä¼è¢«å¹éå°ï¼ä»»ä½ä¸ä¸ª shard ä¸é½æå¯è½ï¼æä»¥ä¸ä¸ª search è¯·æ±å¿é¡»æ¥è¯¢ä¸ä¸ªç´¢å¼æå¤ä¸ªç´¢å¼éé¢çææ shard æè½å®æ´çæ¥è¯¢å°æä»¬æ³è¦çç»æã\n\næ¾å°ææå¹éçç»ææ¯æ¥è¯¢çç¬¬ä¸æ­¥ï¼æ¥èªå¤ä¸ª shard ä¸çæ°æ®éå¨åé¡µè¿åå°å®¢æ·ç«¯ä¹åä¼è¢«åå¹¶å°ä¸ä¸ªæåºåç list åè¡¨ï¼ç±äºéè¦ç»è¿ä¸æ­¥å top n çæä½ï¼æä»¥ search éè¦è¿è¿ä¸¤ä¸ªé¶æ®µæè½å®æï¼åå«æ¯ query å fetchã\n\n\n# 5. åèèµæ\n\n * elasticsearch å®ç½\n * elasticsearch ç´¢å¼æ å°ç±»åå mapping å±æ§è¯¦è§£',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch æ¥è¯¢",frontmatter:{title:"Elasticsearch æ¥è¯¢",date:"2022-01-18T08:01:08.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","æ¥è¯¢"],permalink:"/pages/478bb5/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/05.Elasticsearch%E6%9F%A5%E8%AF%A2.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/05.Elasticsearchæ¥è¯¢.md",key:"v-fe41ffc6",path:"/pages/478bb5/",headers:[{level:2,title:"1. å¨ææ¥è¯¢",slug:"_1-å¨ææ¥è¯¢",normalizedTitle:"1. å¨ææ¥è¯¢",charIndex:250},{level:3,title:"1.1. intervals query",slug:"_1-1-intervals-query",normalizedTitle:"1.1. intervals query",charIndex:308},{level:3,title:"1.2. match query",slug:"_1-2-match-query",normalizedTitle:"1.2. match query",charIndex:1234},{level:4,title:"match query ç®å",slug:"match-query-ç®å",normalizedTitle:"match query ç®å",charIndex:1761},{level:4,title:"match query å¦ä½å·¥ä½",slug:"match-query-å¦ä½å·¥ä½",normalizedTitle:"match query å¦ä½å·¥ä½",charIndex:1912},{level:4,title:"match query çæ¨¡ç³æ¥è¯¢",slug:"match-query-çæ¨¡ç³æ¥è¯¢",normalizedTitle:"match query çæ¨¡ç³æ¥è¯¢",charIndex:2384},{level:4,title:"zero terms æ¥è¯¢",slug:"zero-terms-æ¥è¯¢",normalizedTitle:"zero terms æ¥è¯¢",charIndex:2815},{level:3,title:"1.3. matchboolprefix query",slug:"_1-3-match-bool-prefix-query",normalizedTitle:"1.3. matchboolprefix query",charIndex:null},{level:3,title:"1.4. match_phrase query",slug:"_1-4-match-phrase-query",normalizedTitle:"1.4. match_phrase query",charIndex:3846},{level:3,title:"1.5. matchphraseprefix query",slug:"_1-5-match-phrase-prefix-query",normalizedTitle:"1.5. matchphraseprefix query",charIndex:null},{level:3,title:"1.6. multi_match query",slug:"_1-6-multi-match-query",normalizedTitle:"1.6. multi_match query",charIndex:4672},{level:3,title:"1.7. combined_fields query",slug:"_1-7-combined-fields-query",normalizedTitle:"1.7. combined_fields query",charIndex:5469},{level:4,title:"å­æ®µåç¼æé",slug:"å­æ®µåç¼æé",normalizedTitle:"å­æ®µåç¼æé",charIndex:5846},{level:3,title:"1.8. common_terms query",slug:"_1-8-common-terms-query",normalizedTitle:"1.8. common_terms query",charIndex:5943},{level:3,title:"1.9. query_string query",slug:"_1-9-query-string-query",normalizedTitle:"1.9. query_string query",charIndex:7385},{level:3,title:"1.10. simplequerystring query",slug:"_1-10-simple-query-string-query",normalizedTitle:"1.10. simplequerystring query",charIndex:null},{level:4,title:"simplequerystring è¯­ä¹",slug:"simple-query-string-è¯­ä¹",normalizedTitle:"simplequerystring è¯­ä¹",charIndex:null},{level:3,title:"1.11. å¨ææ¥è¯¢å®æ´ç¤ºä¾",slug:"_1-11-å¨ææ¥è¯¢å®æ´ç¤ºä¾",normalizedTitle:"1.11. å¨ææ¥è¯¢å®æ´ç¤ºä¾",charIndex:8405},{level:2,title:"2. è¯é¡¹æ¥è¯¢",slug:"_2-è¯é¡¹æ¥è¯¢",normalizedTitle:"2. è¯é¡¹æ¥è¯¢",charIndex:8958},{level:3,title:"2.1. exists query",slug:"_2-1-exists-query",normalizedTitle:"2.1. exists query",charIndex:9330},{level:3,title:"2.2. fuzzy query",slug:"_2-2-fuzzy-query",normalizedTitle:"2.2. fuzzy query",charIndex:10062},{level:3,title:"2.3. ids query",slug:"_2-3-ids-query",normalizedTitle:"2.3. ids query",charIndex:10714},{level:3,title:"2.4. prefix query",slug:"_2-4-prefix-query",normalizedTitle:"2.4. prefix query",charIndex:10871},{level:3,title:"2.5. range query",slug:"_2-5-range-query",normalizedTitle:"2.5. range query",charIndex:11104},{level:3,title:"2.6. regexp query",slug:"_2-6-regexp-query",normalizedTitle:"2.6. regexp query",charIndex:11908},{level:3,title:"2.7. term query",slug:"_2-7-term-query",normalizedTitle:"2.7. term query",charIndex:12404},{level:3,title:"2.8. terms query",slug:"_2-8-terms-query",normalizedTitle:"2.8. terms query",charIndex:13285},{level:3,title:"2.9. type query",slug:"_2-9-type-query",normalizedTitle:"2.9. type query",charIndex:14009},{level:3,title:"2.10. wildcard query",slug:"_2-10-wildcard-query",normalizedTitle:"2.10. wildcard query",charIndex:14152},{level:3,title:"2.11. è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾",slug:"_2-11-è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾",normalizedTitle:"2.11. è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾",charIndex:14553},{level:2,title:"3. å¤åæ¥è¯¢",slug:"_3-å¤åæ¥è¯¢",normalizedTitle:"3. å¤åæ¥è¯¢",charIndex:15701},{level:3,title:"3.1. bool query",slug:"_3-1-bool-query",normalizedTitle:"3.1. bool query",charIndex:15768},{level:3,title:"3.2. boosting query",slug:"_3-2-boosting-query",normalizedTitle:"3.2. boosting query",charIndex:16772},{level:3,title:"3.3. constant_score query",slug:"_3-3-constant-score-query",normalizedTitle:"3.3. constant_score query",charIndex:17408},{level:3,title:"3.4. dis_max query",slug:"_3-4-dis-max-query",normalizedTitle:"3.4. dis_max query",charIndex:17828},{level:3,title:"3.5. function_score query",slug:"_3-5-function-score-query",normalizedTitle:"3.5. function_score query",charIndex:18216},{level:3,title:"3.6. indices query",slug:"_3-6-indices-query",normalizedTitle:"3.6. indices query",charIndex:19027},{level:2,title:"4. åµå¥æ¥è¯¢",slug:"_4-åµå¥æ¥è¯¢",normalizedTitle:"4. åµå¥æ¥è¯¢",charIndex:19538},{level:3,title:"4.1. nested query",slug:"_4-1-nested-query",normalizedTitle:"4.1. nested query",charIndex:19877},{level:3,title:"4.2. has_child query",slug:"_4-2-has-child-query",normalizedTitle:"4.2. has_child query",charIndex:20081},{level:3,title:"4.3. has_parent query",slug:"_4-3-has-parent-query",normalizedTitle:"4.3. has_parent query",charIndex:22040},{level:2,title:"5. ä½ç½®æ¥è¯¢",slug:"_5-ä½ç½®æ¥è¯¢",normalizedTitle:"5. ä½ç½®æ¥è¯¢",charIndex:22277},{level:3,title:"5.1. geo_distance query",slug:"_5-1-geo-distance-query",normalizedTitle:"5.1. geo_distance query",charIndex:23381},{level:3,title:"5.2. geoboundingbox query",slug:"_5-2-geo-bounding-box-query",normalizedTitle:"5.2. geoboundingbox query",charIndex:null},{level:3,title:"5.3. geo_polygon query",slug:"_5-3-geo-polygon-query",normalizedTitle:"5.3. geo_polygon query",charIndex:24546},{level:3,title:"5.4. geo_shape query",slug:"_5-4-geo-shape-query",normalizedTitle:"5.4. geo_shape query",charIndex:25026},{level:2,title:"6. ç¹æ®æ¥è¯¢",slug:"_6-ç¹æ®æ¥è¯¢",normalizedTitle:"6. ç¹æ®æ¥è¯¢",charIndex:26020},{level:3,title:"6.1. morelikethis query",slug:"_6-1-more-like-this-query",normalizedTitle:"6.1. morelikethis query",charIndex:null},{level:3,title:"6.2. script query",slug:"_6-2-script-query",normalizedTitle:"6.2. script query",charIndex:26752},{level:3,title:"6.3. percolate query",slug:"_6-3-percolate-query",normalizedTitle:"6.3. percolate query",charIndex:26986}],headersStr:"1. å¨ææ¥è¯¢ 1.1. intervals query 1.2. match query match query ç®å match query å¦ä½å·¥ä½ match query çæ¨¡ç³æ¥è¯¢ zero terms æ¥è¯¢ 1.3. matchboolprefix query 1.4. match_phrase query 1.5. matchphraseprefix query 1.6. multi_match query 1.7. combined_fields query å­æ®µåç¼æé 1.8. common_terms query 1.9. query_string query 1.10. simplequerystring query simplequerystring è¯­ä¹ 1.11. å¨ææ¥è¯¢å®æ´ç¤ºä¾ 2. è¯é¡¹æ¥è¯¢ 2.1. exists query 2.2. fuzzy query 2.3. ids query 2.4. prefix query 2.5. range query 2.6. regexp query 2.7. term query 2.8. terms query 2.9. type query 2.10. wildcard query 2.11. è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾ 3. å¤åæ¥è¯¢ 3.1. bool query 3.2. boosting query 3.3. constant_score query 3.4. dis_max query 3.5. function_score query 3.6. indices query 4. åµå¥æ¥è¯¢ 4.1. nested query 4.2. has_child query 4.3. has_parent query 5. ä½ç½®æ¥è¯¢ 5.1. geo_distance query 5.2. geoboundingbox query 5.3. geo_polygon query 5.4. geo_shape query 6. ç¹æ®æ¥è¯¢ 6.1. morelikethis query 6.2. script query 6.3. percolate query",content:'# Elasticsearch æ¥è¯¢\n\nElasticsearch æ¥è¯¢è¯­å¥éç¨åºäº RESTful é£æ ¼çæ¥å£å°è£æ JSON æ ¼å¼çå¯¹è±¡ï¼ç§°ä¹ä¸º Query DSLãElasticsearch æ¥è¯¢åç±»å¤§è´åä¸ºå¨ææ¥è¯¢ãè¯é¡¹æ¥è¯¢ãå¤åæ¥è¯¢ãåµå¥æ¥è¯¢ãä½ç½®æ¥è¯¢ãç¹æ®æ¥è¯¢ãElasticsearch æ¥è¯¢ä»æºå¶åä¸ºä¸¤ç§ï¼ä¸ç§æ¯æ ¹æ®ç¨æ·è¾å¥çæ¥è¯¢è¯ï¼éè¿æåºæ¨¡åè®¡ç®ææ¡£ä¸æ¥è¯¢è¯ä¹é´çç¸å³åº¦ï¼å¹¶æ ¹æ®è¯åé«ä½æåºè¿åï¼å¦ä¸ç§æ¯è¿æ»¤æºå¶ï¼åªæ ¹æ®è¿æ»¤æ¡ä»¶å¯¹ææ¡£è¿è¡è¿æ»¤ï¼ä¸è®¡ç®è¯åï¼éåº¦ç¸å¯¹è¾å¿«ã\n\n\n# 1. å¨ææ¥è¯¢\n\nES å¨ææ¥è¯¢ä¸»è¦ç¨äºå¨å¨æå­æ®µä¸ï¼ä¸»è¦èèæ¥è¯¢è¯ä¸ææ¡£çç¸å³æ§ï¼Relevanceï¼ã\n\n\n# 1.1. intervals query\n\nintervals query æ ¹æ®å¹éè¯çé¡ºåºåè¿ä¼¼åº¦è¿åææ¡£ã\n\nintervals query ä½¿ç¨å¹éè§åï¼è¿äºè§ååºç¨äºæå®å­æ®µä¸­ç termã\n\nç¤ºä¾ï¼ä¸é¢ç¤ºä¾æç´¢ query å­æ®µï¼æç´¢å¼æ¯ my favorite foodï¼æ²¡æä»»ä½é´éï¼ç¶åæ¯ my_text å­æ®µæç´¢å¹é hot waterãcold porridge ç termã\n\nå½ my_text ä¸­çå¼ä¸º my favorite food is cold porridge æ¶ï¼ä¼å¹éæåï¼ä½æ¯ when it\'s cold my favorite food is porridge åå¹éå¤±è´¥\n\nPOST _search\n{\n  "query": {\n    "intervals" : {\n      "my_text" : {\n        "all_of" : {\n          "ordered" : true,\n          "intervals" : [\n            {\n              "match" : {\n                "query" : "my favorite food",\n                "max_gaps" : 0,\n                "ordered" : true\n              }\n            },\n            {\n              "any_of" : {\n                "intervals" : [\n                  { "match" : { "query" : "hot water" } },\n                  { "match" : { "query" : "cold porridge" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\n\n\n# 1.2. match query\n\nmatch query ç¨äºæç´¢åä¸ªå­æ®µï¼é¦åä¼éå¯¹æ¥è¯¢è¯­å¥è¿è¡è§£æï¼ç»è¿ analyzerï¼ï¼ä¸»è¦æ¯å¯¹æ¥è¯¢è¯­å¥è¿è¡åè¯ï¼åè¯åæ¥è¯¢è¯­å¥çä»»ä½ä¸ä¸ªè¯é¡¹è¢«å¹éï¼ææ¡£å°±ä¼è¢«æå°ï¼é»è®¤æåµä¸ç¸å½äºå¯¹åè¯åè¯é¡¹è¿è¡ or å¹éæä½ã\n\nmatch query æ¯æ§è¡å¨ææç´¢çæ åæ¥è¯¢ï¼åæ¬æ¨¡ç³å¹ééé¡¹ã\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "George Hubbard"\n      }\n    }\n  }\n}\n\n\nç­åäº or å¹éæä½ï¼å¦ä¸ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "George Hubbard",\n        "operator": "or"\n      }\n    }\n  }\n}\n\n\n# match query ç®å\n\nå¯ä»¥éè¿ç»å <field> å query åæ°æ¥ç®åå¹éæ¥è¯¢è¯­æ³ã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "match": {\n      "message": "this is a test"\n    }\n  }\n}\n\n\n# match query å¦ä½å·¥ä½\n\nå¹éæ¥è¯¢æ¯å¸å°ç±»åãè¿æå³çä¼å¯¹æä¾çææ¬è¿è¡åæï¼åæè¿ç¨ä»æä¾çææ¬æé ä¸ä¸ªå¸å°æ¥è¯¢ã operator åæ°å¯ä»¥è®¾ç½®ä¸º or æ and æ¥æ§å¶å¸å°å­å¥ï¼é»è®¤ä¸º orï¼ãå¯ä»¥ä½¿ç¨ minimum_should_match åæ°è®¾ç½®è¦å¹éçå¯é should å­å¥çæå°æ°éã\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "George Hubbard",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® analyzer æ¥æ§å¶åªä¸ªåæå¨å°å¯¹ææ¬æ§è¡åæè¿ç¨ãå®é»è®¤ä¸ºå­æ®µæ¾å¼æ å°å®ä¹æé»è®¤æç´¢åæå¨ã\n\nlenient åæ°å¯ä»¥è®¾ç½®ä¸º true ä»¥å¿½ç¥ç±æ°æ®ç±»åä¸å¹éå¯¼è´çå¼å¸¸ï¼ä¾å¦å°è¯ä½¿ç¨ææ¬æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢æ°å­å­æ®µãé»è®¤ä¸º falseã\n\n# match query çæ¨¡ç³æ¥è¯¢\n\nfuzziness åè®¸åºäºè¢«æ¥è¯¢å­æ®µçç±»åè¿è¡æ¨¡ç³å¹éãè¯·åé Fuzziness çéç½®ã\n\nå¨è¿ç§æåµä¸å¯ä»¥è®¾ç½® prefix_length å max_expansions æ¥æ§å¶æ¨¡ç³å¹éãå¦æè®¾ç½®äºæ¨¡ç³éé¡¹ï¼æ¥è¯¢å°ä½¿ç¨ top_terms_blended_freqs_${max_expansions} ä½ä¸ºå¶éåæ¹æ³ï¼fuzzy_rewrite åæ°åè®¸æ§å¶æ¥è¯¢å°å¦ä½è¢«éåã\n\né»è®¤æåµä¸åè®¸æ¨¡ç³åè½¬ (ab â ba)ï¼ä½å¯ä»¥éè¿å° fuzzy_transpositions è®¾ç½®ä¸º false æ¥ç¦ç¨ã\n\nGET /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "this is a testt",\n        "fuzziness": "AUTO"\n      }\n    }\n  }\n}\n\n\n# zero terms æ¥è¯¢\n\nå¦æä½¿ç¨çåæå¨å stop è¿æ»¤å¨ä¸æ ·å é¤æ¥è¯¢ä¸­çæææ è®°ï¼åé»è®¤è¡ä¸ºæ¯ä¸å¹éä»»ä½ææ¡£ãå¯ä»¥ä½¿ç¨ zero_terms_query éé¡¹æ¥æ¹åé»è®¤è¡ä¸ºï¼å®æ¥å noneï¼é»è®¤ï¼å all ï¼ç¸å½äº match_all æ¥è¯¢ï¼ã\n\nGET /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "to be or not to be",\n        "operator": "and",\n        "zero_terms_query": "all"\n      }\n    }\n  }\n}\n\n\n\n# 1.3. match_bool_prefix query\n\nmatch_bool_prefix query åæå¶è¾å¥å¹¶æ ¹æ®è¿äºè¯æé ä¸ä¸ªå¸å°æ¥è¯¢ãé¤äºæåä¸ä¸ªæ¯è¯­ä¹å¤çæ¯ä¸ªæ¯è¯­é½ç¨äºæ¯è¯­æ¥è¯¢ãæåä¸ä¸ªè¯ç¨äº prefix queryã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "match_bool_prefix" : {\n      "message" : "quick brown f"\n    }\n  }\n}\n\n\nç­ä»·äº\n\nGET /_search\n{\n  "query": {\n    "bool" : {\n      "should": [\n        { "term": { "message": "quick" }},\n        { "term": { "message": "brown" }},\n        { "prefix": { "message": "f"}}\n      ]\n    }\n  }\n}\n\n\nmatch_bool_prefix query å match_phrase_prefix query ä¹é´çä¸ä¸ªéè¦åºå«æ¯ï¼match_phrase_prefix query å°å¶ term å¹éä¸ºç­è¯­ï¼ä½ match_bool_prefix query å¯ä»¥å¨ä»»ä½ä½ç½®å¹éå¶ termã\n\nä¸é¢çç¤ºä¾ match_bool_prefix query æ¥è¯¢å¯ä»¥å¹éåå« quick brown fox çå­æ®µï¼ä½å®ä¹å¯ä»¥å¿«éå¹é brown foxãå®è¿å¯ä»¥å¹éåå« quickãbrown åä»¥ f å¼å¤´çå­æ®µï¼åºç°å¨ä»»ä½ä½ç½®ã\n\n\n# 1.4. match_phrase query\n\nmatch_phrase query å³ç­è¯­å¹éï¼é¦åä¼æ query åå®¹åè¯ï¼åè¯å¨å¯ä»¥èªå®ä¹ï¼åæ¶ææ¡£è¿è¦æ»¡è¶³ä»¥ä¸ä¸¤ä¸ªæ¡ä»¶æä¼è¢«æç´¢å°ï¼\n\n 1. åè¯åææè¯é¡¹é½è¦åºç°å¨è¯¥å­æ®µä¸­ï¼ç¸å½äº and æä½ï¼ã\n 2. å­æ®µä¸­çè¯é¡¹é¡ºåºè¦ä¸è´ã\n\nä¾å¦ï¼æä»¥ä¸ 3 ä¸ªææ¡£ï¼ä½¿ç¨ match_phrase æ¥è¯¢ "How are you"ï¼åªæåä¸¤ä¸ªææ¡£ä¼è¢«å¹éï¼\n\nPUT demo/_create/1\n{ "desc": "How are you" }\n\nPUT demo/_create/2\n{ "desc": "How are you, Jack?"}\n\nPUT demo/_create/3\n{ "desc": "are you"}\n\nGET demo/_search\n{\n  "query": {\n    "match_phrase": {\n      "desc": "How are you"\n    }\n  }\n}\n\n\n> è¯´æï¼\n> \n> ä¸ä¸ªè¢«è®¤å®ä¸ºåç­è¯­ How are you å¹éçææ¡£ï¼å¿é¡»æ»¡è¶³ä»¥ä¸è¿äºè¦æ±ï¼\n> \n>  * Howã are å you éè¦å¨é¨åºç°å¨åä¸­ã\n>  * are çä½ç½®åºè¯¥æ¯ How çä½ç½®å¤§ 1 ã\n>  * you çä½ç½®åºè¯¥æ¯ How çä½ç½®å¤§ 2 ã\n\n\n# 1.5. match_phrase_prefix query\n\nmatch_phrase_prefix query å match_phrase query ç±»ä¼¼ï¼åªä¸è¿ match_phrase_prefix query æåä¸ä¸ª term ä¼è¢«ä½ä¸ºåç¼å¹éã\n\nGET demo/_search\n{\n  "query": {\n    "match_phrase_prefix": {\n      "desc": "are yo"\n    }\n  }\n}\n\n\n\n# 1.6. multi_match query\n\nmulti_match query æ¯ match query çåçº§ï¼ç¨äºæç´¢å¤ä¸ªå­æ®µã\n\nç¤ºä¾ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nmulti_match query çæç´¢å­æ®µå¯ä»¥ä½¿ç¨ééç¬¦æå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_*",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nåæ¶ï¼ä¹å¯ä»¥ç¨ææ°ç¬¦æå®æç´¢å­æ®µçæéã\n\nç¤ºä¾ï¼æå® taxful_total_price å­æ®µçæéæ¯ taxless_total_price å­æ®µç 3 åï¼å½ä»¤å¦ä¸ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price^3",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\n\n# 1.7. combined_fields query\n\ncombined_fields query æ¯ææç´¢å¤ä¸ªææ¬å­æ®µï¼å°±å¥½åå®ä»¬çåå®¹å·²è¢«ç´¢å¼å°ä¸ä¸ªç»åå­æ®µä¸­ä¸æ ·ãè¯¥æ¥è¯¢ä¼çæä»¥ term ä¸ºä¸­å¿çè¾å¥å­ç¬¦ä¸²è§å¾ï¼é¦åå®å°æ¥è¯¢å­ç¬¦ä¸²è§£æä¸ºç¬ç«ç termï¼ç¶åå¨ææå­æ®µä¸­æ¥æ¾æ¯ä¸ª termãå½å¹éç»æå¯è½è·¨è¶å¤ä¸ªææ¬å­æ®µæ¶ï¼æ­¤æ¥è¯¢ç¹å«æç¨ï¼ä¾å¦æç« çæ é¢ãæè¦åæ­£æï¼\n\nGET /_search\n{\n  "query": {\n    "combined_fields" : {\n      "query":      "database systems",\n      "fields":     [ "title", "abstract", "body"],\n      "operator":   "and"\n    }\n  }\n}\n\n\n# å­æ®µåç¼æé\n\nå­æ®µåç¼æéæ ¹æ®ç»åå­æ®µæ¨¡åè¿è¡è®¡ç®ãä¾å¦ï¼å¦æ title å­æ®µçæéä¸º 2ï¼åå¹éåº¦æåæ¶ä¼å° title ä¸­çæ¯ä¸ª term å½¢æçç»åå­æ®µï¼æåºç°ä¸¤æ¬¡è¿è¡æåã\n\n\n# 1.8. common_terms query\n\n> 7.3.0 åºå¼\n\ncommon_terms query æ¯ä¸ç§å¨ä¸çºç²æ§è½çæåµä¸æ¿ä»£åç¨è¯æé«æç´¢åç¡®çåå¬åççæ¹æ¡ã\n\næ¥è¯¢ä¸­çæ¯ä¸ªè¯é¡¹é½æä¸å®çä»£ä»·ï¼ä»¥æç´¢âThe brown foxâä¸ºä¾ï¼query ä¼è¢«è§£ææä¸ä¸ªè¯é¡¹âtheââbrownâåâfoxâï¼æ¯ä¸ªè¯é¡¹é½ä¼å°ç´¢å¼ä¸­æ§è¡ä¸æ¬¡æ¥è¯¢ãå¾æ¾ç¶åå«âtheâçææ¡£éå¸¸å¤ï¼ç¸æ¯å¶ä»è¯é¡¹ï¼âtheâçéè¦æ§ä¼ä½å¾å¤ãä¼ ç»çè§£å³æ¹æ¡æ¯æâtheâå½ä½åç¨è¯å¤çï¼å»é¤åç¨è¯ä¹åå¯ä»¥åå°ç´¢å¼å¤§å°ï¼åæ¶å¨æç´¢æ¶åå°å¯¹åç¨è¯çæ¶ç¼©ã\n\nè½ç¶åç¨è¯å¯¹ææ¡£è¯åå½±åä¸å¤§ï¼ä½æ¯å½åç¨è¯ä»ç¶æéè¦æä¹çæ¶åï¼å»é¤åç¨è¯å°±ä¸æ¯å®ç¾çè§£å³æ¹æ¡äºãå¦æå»é¤åç¨è¯ï¼å°±æ æ³åºåâhappyâåânot happyâ, âTheââTo be or not to beâå°±ä¸ä¼å¨ç´¢å¼ä¸­å­å¨ï¼æç´¢çåç¡®çåå¬åçå°±ä¼éä½ã\n\ncommon_terms query æä¾äºä¸ç§è§£å³æ¹æ¡ï¼å®æ query åè¯åçè¯é¡¹åæéè¦è¯é¡¹ï¼ä½é¢è¯é¡¹ï¼åä¸éè¦çè¯é¡¹ï¼é«é¢è¯ï¼ä¹å°±æ¯ä¹åçåç¨è¯ï¼ãå¨æç´¢çæ¶åï¼é¦åæç´¢åéè¦è¯é¡¹å¹éçææ¡£ï¼è¿äºææ¡£æ¯è¯é¡¹åºç°è¾å°å¹¶ä¸è¯é¡¹å¯¹å¶è¯åå½±åè¾å¤§çææ¡£ãç¶åæ§è¡ç¬¬äºæ¬¡æ¥è¯¢ï¼æç´¢å¯¹è¯åå½±åè¾å°çé«é¢è¯é¡¹ï¼ä½æ¯ä¸è®¡ç®ææææ¡£çè¯åï¼èæ¯åªè®¡ç®ç¬¬ä¸æ¬¡æ¥è¯¢å·²ç»å¹éçææ¡£å¾åãå¦æä¸ä¸ªæ¥è¯¢ä¸­åªåå«é«é¢è¯ï¼é£ä¹ä¼éè¿ and è¿æ¥ç¬¦æ§è¡ä¸ä¸ªåç¬çæ¥è¯¢ï¼æ¢è¨ä¹ï¼ä¼æç´¢ææçè¯é¡¹ã\n\nè¯é¡¹æ¯é«é¢è¯è¿æ¯ä½é¢è¯æ¯éè¿ cutoff frequency æ¥è®¾ç½®éå¼çï¼åå¼å¯ä»¥æ¯ç»å¯¹é¢çï¼é¢çå¤§äº 1ï¼æèç¸å¯¹é¢çï¼0 ï½ 1ï¼ãcommon_terms query ææè¶£ä¹å¤å¨äºå®è½èªéåºç¹å®é¢åçåç¨è¯ï¼ä¾å¦ï¼å¨è§é¢æç®¡ç½ç«ä¸ï¼è¯¸å¦âclipâæâvideoâä¹ç±»çé«é¢è¯é¡¹å°èªå¨è¡¨ç°ä¸ºåç¨è¯ï¼æ é¡»ä¿çæå¨åè¡¨ã\n\nä¾å¦ï¼ææ¡£é¢çé«äº 0.1% çè¯é¡¹å°ä¼è¢«å½ä½é«é¢è¯é¡¹ï¼è¯é¢ä¹é´å¯ä»¥ç¨ low_freq_operatorãhigh_freq_operator åæ°è¿æ¥ãè®¾ç½®ä½é¢è¯æä½ç¬¦ä¸ºâandâä½¿ææçä½é¢è¯é½æ¯å¿é¡»æç´¢çï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"common": {\n\t\t\t"body": {\n\t\t\t\t"query": "nelly the elephant as a cartoon",\n\t\t\t\t"cutoff_frequency": 0.001,\n\t\t\t\t"low_freq_operator": "and"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nä¸è¿°æä½ç­ä»·äºï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [\n\t\t\t  { "term": { "body": "nelly" } },\n\t\t\t  { "term": { "body": "elephant" } },\n\t\t\t  { "term": { "body": "cartoon" } }\n\t\t\t],\n\t\t\t"should": [\n\t\t\t  { "term": { "body": "the" } },\n\t\t\t  { "term": { "body": "as" } },\n\t\t\t  { "term": { "body": "a" } }\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# 1.9. query_string query\n\nquery_string query æ¯ä¸ Lucene æ¥è¯¢è¯­å¥çè¯­æ³ç»åéå¸¸ç´§å¯çä¸ç§æ¥è¯¢ï¼åè®¸å¨ä¸ä¸ªæ¥è¯¢è¯­å¥ä¸­ä½¿ç¨å¤ä¸ªç¹æ®æ¡ä»¶å³é®å­ï¼å¦ï¼AND | OR | NOTï¼å¯¹å¤ä¸ªå­æ®µè¿è¡æ¥è¯¢ï¼å»ºè®®çæ Lucene æ¥è¯¢è¯­æ³çç¨æ·å»ä½¿ç¨ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ query_string query æ¥åå»ºåå«ééç¬¦ãè·¨å¤ä¸ªå­æ®µçæç´¢ç­å¤ææç´¢ãè½ç¶éç¨ï¼ä½æ¥è¯¢æ¯ä¸¥æ ¼çï¼å¦ææ¥è¯¢å­ç¬¦ä¸²åå«ä»»ä½æ æè¯­æ³ï¼åä¼è¿åéè¯¯ã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "query_string": {\n      "query": "(new york city) OR (big apple)",\n      "default_field": "content"\n    }\n  }\n}\n\n\n\n# 1.10. simple_query_string query\n\nsimple_query_string query æ¯ä¸ç§éåç´æ¥æ´é²ç»ç¨æ·ï¼å¹¶ä¸å·æéå¸¸å®åçæ¥è¯¢è¯­æ³çæ¥è¯¢è¯­å¥ï¼æ¥å Lucene æ¥è¯¢è¯­æ³ï¼è§£æè¿ç¨ä¸­åçéè¯¯ä¸ä¼æåºå¼å¸¸ã\n\nè½ç¶è¯­æ³æ¯ query_string query æ´ä¸¥æ ¼ï¼ä½ simple_query_string query ä¸ä¼è¿åæ æè¯­æ³çéè¯¯ãç¸åï¼å®ä¼å¿½ç¥æ¥è¯¢å­ç¬¦ä¸²çä»»ä½æ æé¨åã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "simple_query_string" : {\n        "query": "\\"fried eggs\\" +(eggplant | potato) -frittata",\n        "fields": ["title^5", "body"],\n        "default_operator": "and"\n    }\n  }\n}\n\n\n# simple_query_string è¯­ä¹\n\n * +ï¼ç­ä»·äº AND æä½\n * |ï¼ç­ä»·äº OR æä½\n * -ï¼ç¸å½äº NOT æä½\n * "ï¼åè£ä¸äºæ è®°ä»¥è¡¨ç¤ºç¨äºæç´¢çç­è¯­\n * *ï¼è¯å°¾è¡¨ç¤ºåç¼æ¥è¯¢\n * ( and )ï¼è¡¨ç¤ºä¼åçº§\n * ~Nï¼è¯å°¾è¡¨ç¤ºè¡¨ç¤ºç¼è¾è·ç¦»ï¼æ¨¡ç³æ§ï¼\n * ~Nï¼å¨ä¸ä¸ªç­è¯­ä¹åè¡¨ç¤ºæº¢åºé\n\næ³¨æï¼è¦ä½¿ç¨ä¸é¢çå­ç¬¦ï¼è¯·ä½¿ç¨åææ  / å¯¹å¶è¿è¡è½¬ä¹ã\n\n\n# 1.11. å¨ææ¥è¯¢å®æ´ç¤ºä¾\n\n#è®¾ç½® position_increment_gap\nDELETE groups\nPUT groups\n{\n  "mappings": {\n    "properties": {\n      "names":{\n        "type": "text",\n        "position_increment_gap": 0\n      }\n    }\n  }\n}\n\nGET groups/_mapping\n\nPOST groups/_doc\n{\n  "names": [ "John Water", "Water Smith"]\n}\n\nPOST groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": {\n        "query": "Water Water",\n        "slop": 100\n      }\n    }\n  }\n}\n\nPOST groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": "Water Smith"\n    }\n  }\n}\n\nDELETE groups\n\n\n\n# 2. è¯é¡¹æ¥è¯¢\n\nTermï¼è¯é¡¹ï¼æ¯è¡¨è¾¾è¯­æçæå°åä½ãæç´¢åå©ç¨ç»è®¡è¯­è¨æ¨¡åè¿è¡èªç¶è¯­è¨å¤çé½éè¦å¤ç Termã\n\nå¨ææ¥è¯¢å¨æ§è¡æ¥è¯¢ä¹åä¼åææ¥è¯¢å­ç¬¦ä¸²ã\n\nä¸å¨ææ¥è¯¢ä¸åï¼è¯é¡¹æ¥è¯¢ä¸ä¼åè¯ï¼èæ¯å°è¾å¥ä½ä¸ºä¸ä¸ªæ´ä½ï¼å¨åæç´¢å¼ä¸­æ¥æ¾åç¡®çè¯é¡¹ãå¹¶ä¸ä½¿ç¨ç¸å³åº¦è®¡ç®å¬å¼ä¸ºæ¯ä¸ªåå«è¯¥è¯é¡¹çææ¡£è¿è¡ç¸å³åº¦è®¡ç®ãä¸è¨ä»¥æ¦ä¹ï¼è¯é¡¹æ¥è¯¢æ¯å¯¹è¯é¡¹è¿è¡ç²¾ç¡®å¹éãè¯é¡¹æ¥è¯¢éå¸¸ç¨äºç»æåæ°æ®ï¼å¦æ°å­ãæ¥æåæä¸¾ç±»åã\n\nè¯é¡¹æ¥è¯¢æä»¥ä¸ç±»åï¼\n\n * exists query\n * fuzzy query\n * ids query\n * prefix query\n * range query\n * regexp query\n * term query\n * terms query\n * type query\n * wildcard query\n\n\n# 2.1. exists query\n\nexists query ä¼è¿åå­æ®µä¸­è³å°æä¸ä¸ªéç©ºå¼çææ¡£ã\n\nç±äºå¤ç§åå ï¼ææ¡£å­æ®µå¯è½ä¸å­å¨ç´¢å¼å¼ï¼\n\n * JSON ä¸­çå­æ®µä¸º null æ []\n * è¯¥å­æ®µå¨ mapping ä¸­éç½®äº "index" : false\n * å­æ®µå¼çé¿åº¦è¶è¿äº mapping ä¸­ç ignore_above è®¾ç½®\n * å­æ®µå¼æ ¼å¼éè¯¯ï¼å¹¶ä¸å¨ mapping ä¸­å®ä¹äº ignore_malformed\n\nç¤ºä¾ï¼\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "exists": {\n      "field": "email"\n    }\n  }\n}\n\n\nä»¥ä¸ææ¡£ä¼å¹éä¸é¢çæ¥è¯¢ï¼\n\n * { "user" : "jane" } æ user å­æ®µï¼ä¸ä¸ä¸ºç©ºã\n * { "user" : "" } æ user å­æ®µï¼å¼ä¸ºç©ºå­ç¬¦ä¸²ã\n * { "user" : "-" } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane" ] } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane", null ] } æ user å­æ®µï¼è³å°ä¸ä¸ªå¼ä¸ä¸ºç©ºå³å¯ã\n\nä¸é¢çææ¡£é½ä¸ä¼è¢«å¹éï¼\n\n * { "user" : null } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [null] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "foo" : "bar" } æ²¡æ user å­æ®µã\n\n\n# 2.2. fuzzy query\n\nfuzzy queryï¼æ¨¡ç³æ¥è¯¢ï¼è¿ååå«ä¸æç´¢è¯ç¸ä¼¼çè¯çææ¡£ãES ä½¿ç¨ Levenshtein edit distanceï¼Levenshtein ç¼è¾è·ç¦»ï¼æµéç¸ä¼¼åº¦ææ¨¡ç³åº¦ã\n\nç¼è¾è·ç¦»æ¯å°ä¸ä¸ªæ¯è¯­è½¬æ¢ä¸ºå¦ä¸ä¸ªæ¯è¯­æéçåä¸ªå­ç¬¦æ´æ¹çæ°éãè¿äºååå¯è½åæ¬ï¼\n\n * æ¹åä¸ä¸ªå­ç¬¦ï¼ï¼box -> foxï¼\n * å é¤ä¸ä¸ªå­ç¬¦ï¼ï¼black -> lackï¼\n * æå¥ä¸ä¸ªå­ç¬¦ï¼ï¼sic -> sickï¼\n * åè½¬ä¸¤ä¸ªç¸é»å­ç¬¦ï¼ï¼act â catï¼\n\nä¸ºäºæ¾å°ç¸ä¼¼çè¯æ¡ï¼fuzzy query ä¼å¨æå®çç¼è¾è·ç¦»ååå»ºæç´¢è¯æ¡çææå¯è½åä½ææ©å±éãç¶åè¿åå®å¨å¹éä»»ææ©å±çææ¡£ã\n\nGET books/_search\n{\n  "query": {\n    "fuzzy": {\n      "user.id": {\n        "value": "ki",\n        "fuzziness": "AUTO",\n        "max_expansions": 50,\n        "prefix_length": 0,\n        "transpositions": true,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\næ³¨æï¼å¦æéç½®äº search.allow_expensive_queries ï¼å fuzzy query ä¸è½æ§è¡ã\n\n\n# 2.3. ids query\n\nids query æ ¹æ® ID è¿åææ¡£ã æ­¤æ¥è¯¢ä½¿ç¨å­å¨å¨ _id å­æ®µä¸­çææ¡£ IDã\n\nGET /_search\n{\n  "query": {\n    "ids" : {\n      "values" : ["1", "4", "100"]\n    }\n  }\n}\n\n\n\n# 2.4. prefix query\n\nprefix query ç¨äºæ¥è¯¢æä¸ªå­æ®µä¸­åå«æå®åç¼çææ¡£ã\n\næ¯å¦æ¥è¯¢ user.id ä¸­å«æä»¥ ki ä¸ºåç¼çå³é®è¯çææ¡£ï¼é£ä¹å«æ kindãkid ç­ææä»¥ ki å¼å¤´å³é®è¯çææ¡£é½ä¼è¢«å¹éã\n\nGET /_search\n{\n  "query": {\n    "prefix": {\n      "user.id": {\n        "value": "ki"\n      }\n    }\n  }\n}\n\n\n\n# 2.5. range query\n\nrange query å³èå´æ¥è¯¢ï¼ç¨äºå¹éå¨æä¸èå´åçæ°å¼åãæ¥æç±»åæèå­ç¬¦ä¸²åå­æ®µçææ¡£ãæ¯å¦æç´¢åªäºä¹¦ç±çä»·æ ¼å¨ 50 å° 100 ä¹é´ãåªäºä¹¦ç±çåºçæ¶é´å¨ 2015 å¹´å° 2019 å¹´ä¹é´ãä½¿ç¨ range æ¥è¯¢åªè½æ¥è¯¢ä¸ä¸ªå­æ®µï¼ä¸è½ä½ç¨å¨å¤ä¸ªå­æ®µä¸ã\n\nrange æ¥è¯¢æ¯æçåæ°æä»¥ä¸å ç§ï¼\n\n * gtï¼å¤§äº\n\n * gteï¼å¤§äºç­äº\n\n * ltï¼å°äº\n\n * lteï¼å°äºç­äº\n\n * formatï¼å¦æå­æ®µæ¯ Date ç±»åï¼å¯ä»¥è®¾ç½®æ¥ææ ¼å¼å\n\n * time_zoneï¼æ¶åº\n\n * relationï¼æç¤ºèå´æ¥è¯¢å¦ä½å¹éèå´å­æ®µçå¼ã\n   \n   * INTERSECTS (Default)ï¼å¹éä¸æ¥è¯¢å­æ®µå¼èå´ç¸äº¤çææ¡£ã\n   * CONTAINSï¼å¹éå®å¨åå«æ¥è¯¢å­æ®µå¼çææ¡£ã\n   * WITHINï¼å¹éå·æå®å¨å¨æ¥è¯¢èå´åçèå´å­æ®µå¼çææ¡£ã\n\nç¤ºä¾ï¼æ°å¼èå´æ¥è¯¢\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "taxful_total_price": {\n        "gt": 10,\n        "lte": 50\n      }\n    }\n  }\n}\n\n\nç¤ºä¾ï¼æ¥æèå´æ¥è¯¢\n\nGET kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "order_date": {\n        "time_zone": "+00:00",\n        "gte": "2018-01-01T00:00:00",\n        "lte": "now"\n      }\n    }\n  }\n}\n\n\n\n# 2.6. regexp query\n\nregexp query è¿åä¸æ­£åè¡¨è¾¾å¼ç¸å¹éç term æå±çææ¡£ã\n\næ­£åè¡¨è¾¾å¼æ¯ä¸ç§ä½¿ç¨å ä½ç¬¦å­ç¬¦å¹éæ°æ®æ¨¡å¼çæ¹æ³ï¼ç§°ä¸ºè¿ç®ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»»ä½ä»¥ k å¼å¤´å¹¶ä»¥ y ç»å°¾çææ¡£ã .* è¿ç®ç¬¦å¹éä»»ä½é¿åº¦çä»»ä½å­ç¬¦ï¼åæ¬æ å­ç¬¦ãå¹éé¡¹å¯ä»¥åæ¬ kyãkay å kimchyã\n\nGET /_search\n{\n  "query": {\n    "regexp": {\n      "user.id": {\n        "value": "k.*y",\n        "flags": "ALL",\n        "case_insensitive": true,\n        "max_determinized_states": 10000,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼å regexp query ä¼è¢«ç¦ç¨ã\n\n\n# 2.7. term query\n\nterm query ç¨æ¥æ¥æ¾æå®å­æ®µä¸­åå«ç»å®åè¯çææ¡£ï¼term æ¥è¯¢ä¸è¢«è§£æï¼åªææ¥è¯¢è¯åææ¡£ä¸­çè¯ç²¾ç¡®å¹éæä¼è¢«æç´¢å°ï¼åºç¨åºæ¯ä¸ºæ¥è¯¢äººåãå°åç­éè¦ç²¾åå¹éçéæ±ã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\nDELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "full_text": { "type": "text" }\n    }\n  }\n}\n\n# 2. ä½¿ç¨ "Quick Brown Foxes!" å³é®å­æ¥ "full_text" å­æ®µ\nPUT my-index-000001/_doc/1\n{\n  "full_text": "Quick Brown Foxes!"\n}\n\n# 3. ä½¿ç¨ term æ¥è¯¢\nGET my-index-000001/_search?pretty\n{\n  "query": {\n    "term": {\n      "full_text": "Quick Brown Foxes!"\n    }\n  }\n}\n# å ä¸º full_text å­æ®µä¸ååå«ç¡®åç Term ââ "Quick Brown Foxes!"ï¼æä»¥ term query æç´¢ä¸å°ä»»ä½ç»æ\n\n# 4. ä½¿ç¨ match æ¥è¯¢\nGET my-index-000001/_search?pretty\n{\n  "query": {\n    "match": {\n      "full_text": "Quick Brown Foxes!"\n    }\n  }\n}\n\nDELETE my-index-000001\n\n\n> â ï¸ æ³¨æï¼åºé¿å term æ¥è¯¢å¯¹ text å­æ®µä½¿ç¨æ¥è¯¢ã\n> \n> é»è®¤æåµä¸ï¼Elasticsearch éå¯¹ text å­æ®µçå¼è¿è¡è§£æåè¯ï¼è¿ä¼ä½¿æ¥æ¾ text å­æ®µå¼çç²¾ç¡®å¹éåå¾å°é¾ã\n> \n> è¦æç´¢ text å­æ®µå¼ï¼éæ¹ç¨ match æ¥è¯¢ã\n\n\n# 2.8. terms query\n\nterms query ä¸ term query ç¸åï¼ä½å¯ä»¥æç´¢å¤ä¸ªå¼ã\n\nterms query æ¥è¯¢åæ°ï¼\n\n * indexï¼ç´¢å¼å\n * idï¼ææ¡£ ID\n * pathï¼è¦ä»ä¸­è·åå­æ®µå¼çå­æ®µçåç§°ï¼å³æç´¢å³é®å­\n * routingï¼éå¡«ï¼ï¼è¦ä»ä¸­è·å term å¼çææ¡£çèªå®ä¹è·¯ç±å¼ãå¦æå¨ç´¢å¼ææ¡£æ¶æä¾äºèªå®ä¹è·¯ç±å¼ï¼åæ­¤åæ°æ¯å¿éçã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\nDELETE my-index-000001\nPUT my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "color": { "type": "keyword" }\n    }\n  }\n}\n\n# 2. åå¥ä¸ä¸ªææ¡£\nPUT my-index-000001/_doc/1\n{\n  "color": [\n    "blue",\n    "green"\n  ]\n}\n\n# 3. åå¥å¦ä¸ä¸ªææ¡£\nPUT my-index-000001/_doc/2\n{\n  "color": "blue"\n}\n\n# 3. ä½¿ç¨ terms query\nGET my-index-000001/_search?pretty\n{\n  "query": {\n    "terms": {\n      "color": {\n        "index": "my-index-000001",\n        "id": "2",\n        "path": "color"\n      }\n    }\n  }\n}\n\nDELETE my-index-000001\n\n\n\n# 2.9. type query\n\n> 7.0.0 ååºå¼\n\ntype query ç¨äºæ¥è¯¢å·ææå®ç±»åçææ¡£ã\n\nç¤ºä¾ï¼\n\nGET /_search\n{\n  "query": {\n    "type": {\n      "value": "_doc"\n    }\n  }\n}\n\n\n\n# 2.10. wildcard query\n\nwildcard query å³ééç¬¦æ¥è¯¢ï¼è¿åä¸ééç¬¦æ¨¡å¼å¹éçææ¡£ã\n\n? ç¨æ¥å¹éä¸ä¸ªä»»æå­ç¬¦ï¼* ç¨æ¥å¹éé¶ä¸ªæèå¤ä¸ªå­ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»¥ ki å¼å¤´å¹¶ä»¥ y ç»å°¾çæ¯è¯­çææ¡£ãè¿äºå¹éé¡¹å¯ä»¥åæ¬ kiyãkity æ kimchyã\n\nGET /_search\n{\n  "query": {\n    "wildcard": {\n      "user.id": {\n        "value": "ki*y",\n        "boost": 1.0,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼åwildcard query ä¼è¢«ç¦ç¨ã\n\n\n# 2.11. è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾\n\nDELETE products\nPUT products\n{\n  "settings": {\n    "number_of_shards": 1\n  }\n}\n\nPOST /products/_bulk\n{ "index": { "_id": 1 }}\n{ "productID" : "XHDK-A-1293-#fJ3","desc":"iPhone" }\n{ "index": { "_id": 2 }}\n{ "productID" : "KDKE-B-9947-#kL5","desc":"iPad" }\n{ "index": { "_id": 3 }}\n{ "productID" : "JODL-X-1937-#pV7","desc":"MBP" }\n\nGET /products\n\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "desc": {\n        //"value": "iPhone"\n        "value":"iphone"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "desc.keyword": {\n        //"value": "iPhone"\n        //"value":"iphone"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  "query": {\n    "term": {\n      "productID": {\n        "value": "XHDK-A-1293-#fJ3"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  //"explain": true,\n  "query": {\n    "term": {\n      "productID.keyword": {\n        "value": "XHDK-A-1293-#fJ3"\n      }\n    }\n  }\n}\n\nPOST /products/_search\n{\n  "explain": true,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "productID.keyword": "XHDK-A-1293-#fJ3"\n        }\n      }\n\n    }\n  }\n}\n\n\n\n# 3. å¤åæ¥è¯¢\n\nå¤åæ¥è¯¢å°±æ¯æä¸äºç®åæ¥è¯¢ç»åå¨ä¸èµ·å®ç°æ´å¤æçæ¥è¯¢éæ±ï¼é¤æ­¤ä¹å¤ï¼å¤åæ¥è¯¢è¿å¯ä»¥æ§å¶å¦å¤ä¸ä¸ªæ¥è¯¢çè¡ä¸ºã\n\n\n# 3.1. bool query\n\nbool æ¥è¯¢å¯ä»¥æä»»æå¤ä¸ªç®åæ¥è¯¢ç»åå¨ä¸èµ·ï¼ä½¿ç¨ mustãshouldãmust_notãfilter éé¡¹æ¥è¡¨ç¤ºç®åæ¥è¯¢ä¹é´çé»è¾ï¼æ¯ä¸ªéé¡¹é½å¯ä»¥åºç° 0 æ¬¡å°å¤æ¬¡ï¼å®ä»¬çå«ä¹å¦ä¸ï¼\n\n * must ææ¡£å¿é¡»å¹é must éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ï¼ç¸å½äºé»è¾è¿ç®ç ANDï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * should ææ¡£å¯ä»¥å¹é should éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ä¹å¯ä»¥ä¸å¹éï¼ç¸å½äºé»è¾è¿ç®ç ORï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * must_not ä¸ must ç¸åï¼å¹éè¯¥éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£ä¸ä¼è¢«è¿åï¼éè¦æ³¨æçæ¯ï¼must_not è¯­å¥ä¸ä¼å½±åè¯åï¼å®çä½ç¨åªæ¯å°ä¸ç¸å³çææ¡£æé¤ã\n * filter å must ä¸æ ·ï¼å¹é filter éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£æä¼è¢«è¿åï¼ä½æ¯ filter ä¸è¯åï¼åªèµ·å°è¿æ»¤åè½ï¼ä¸ must_not ç¸åã\n\nåè®¾è¦æ¥è¯¢ title ä¸­åå«å³é®è¯ javaï¼å¹¶ä¸ price ä¸è½é«äº 70ï¼description å¯ä»¥åå«ä¹å¯ä»¥ä¸åå«èææºçä¹¦ç±ï¼æé  bool æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n  "query": {\n    "bool": {\n      "filter": {\n        "term": {\n          "status": 1\n        }\n      },\n      "must_not": {\n        "range": {\n          "price": {\n            "gte": 70\n          }\n        }\n      },\n      "must": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "should": [\n        {\n          "match": {\n            "description": "èææº"\n          }\n        }\n      ],\n      "minimum_should_match": 1\n    }\n  }\n}\n\n\næå³å¸å°æ¥è¯¢æ´è¯¦ç»çä¿¡æ¯åè bool queryï¼ç»åæ¥è¯¢ï¼è¯¦è§£ã\n\n\n# 3.2. boosting query\n\nboosting æ¥è¯¢ç¨äºéè¦å¯¹ä¸¤ä¸ªæ¥è¯¢çè¯åè¿è¡è°æ´çåºæ¯ï¼boosting æ¥è¯¢ä¼æä¸¤ä¸ªæ¥è¯¢å°è£å¨ä¸èµ·å¹¶éä½å¶ä¸­ä¸ä¸ªæ¥è¯¢çè¯åã\n\nboosting æ¥è¯¢åæ¬ positiveãnegative å negative_boost ä¸ä¸ªé¨åï¼positive ä¸­çæ¥è¯¢è¯åä¿æä¸åï¼negative ä¸­çæ¥è¯¢ä¼éä½ææ¡£è¯åï¼negative_boost ææ negative ä¸­éä½çæå¼ãå¦ææä»¬æ³å¯¹ 2015 å¹´ä¹ååºççä¹¦éä½è¯åï¼å¯ä»¥æé ä¸ä¸ª boosting æ¥è¯¢ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"boosting": {\n\t\t\t"positive": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "python"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative": {\n\t\t\t\t"range": {\n\t\t\t\t\t"publish_time": {\n\t\t\t\t\t\t"lte": "2015-01-01"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative_boost": 0.2\n\t\t}\n\t}\n}\n\n\nboosting æ¥è¯¢ä¸­æå®äºæå¶å å­ä¸º 0.2ï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸åï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸ºåå¾åç 0.2 åã\n\n\n# 3.3. constant_score query\n\nconstantscore query åè£ä¸ä¸ª filter queryï¼å¹¶è¿åå¹éè¿æ»¤å¨æ¥è¯¢æ¡ä»¶çææ¡£ï¼ä¸å®ä»¬çç¸å³æ§è¯åé½ç­äº _boost åæ°å¼ï¼å¯ä»¥çè§£ä¸ºåæçåºäº tf-idf æ bm25 çç¸å³ååºå®ä¸º 1.0ï¼æä»¥æç»è¯åä¸º 1.0 * boostï¼å³ç­äº boost åæ°å¼ï¼ãä¸é¢çæ¥è¯¢è¯­å¥ä¼è¿å title å­æ®µä¸­å«æå³é®è¯ elasticsearch çææ¡£ï¼ææææ¡£çè¯åé½æ¯ 1.8ï¼\n\nGET books/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "title": "elasticsearch"\n        }\n      },\n      "boost": 1.8\n    }\n  }\n}\n\n\n\n# 3.4. dis_max query\n\ndis_max query ä¸ bool query æä¸å®èç³»ä¹æä¸å®åºå«ï¼dis_max query æ¯æå¤å¹¶åæ¥è¯¢ï¼å¯è¿åä¸ä»»ææ¥è¯¢æ¡ä»¶å­å¥å¹éçä»»ä½ææ¡£ç±»åãä¸ bool æ¥è¯¢å¯ä»¥å°ææå¹éæ¥è¯¢çåæ°ç¸ç»åä½¿ç¨çæ¹å¼ä¸åï¼dis_max æ¥è¯¢åªä½¿ç¨æä½³å¹éæ¥è¯¢æ¡ä»¶çåæ°ãè¯·çä¸é¢çä¾å­ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"dis_max": {\n\t\t\t"tie_breaker": 0.7,\n\t\t\t"boost": 1.2,\n\t\t\t"queries": [{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 34\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 35\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# 3.5. function_score query\n\nfunction_score query å¯ä»¥ä¿®æ¹æ¥è¯¢çææ¡£å¾åï¼è¿ä¸ªæ¥è¯¢å¨æäºæåµä¸éå¸¸æç¨ï¼æ¯å¦éè¿è¯åå½æ°è®¡ç®ææ¡£å¾åä»£ä»·è¾é«ï¼å¯ä»¥æ¹ç¨è¿æ»¤å¨å èªå®ä¹è¯åå½æ°çæ¹å¼æ¥åä»£ä¼ ç»çè¯åæ¹å¼ã\n\nä½¿ç¨ function_score queryï¼ç¨æ·éè¦å®ä¹ä¸ä¸ªæ¥è¯¢åä¸è³å¤ä¸ªè¯åå½æ°ï¼è¯åå½æ°ä¼å¯¹æ¥è¯¢å°çæ¯ä¸ªææ¡£åå«è®¡ç®å¾åã\n\nä¸é¢è¿æ¡æ¥è¯¢è¯­å¥ä¼è¿å books ç´¢å¼ä¸­çææææ¡£ï¼ææ¡£çæå¤§å¾åä¸º 5ï¼æ¯ä¸ªææ¡£çå¾åéæºçæï¼æéçè®¡ç®æ¨¡å¼ä¸ºç¸ä¹æ¨¡å¼ã\n\nGET books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match all": {}\n      },\n      "boost": "5",\n      "random_score": {},\n      "boost_mode": "multiply"\n    }\n  }\n}\n\n\nä½¿ç¨èæ¬èªå®ä¹è¯åå¬å¼ï¼è¿éæ price å¼çååä¹ä¸å¼æ¹ä½ä¸ºæ¯ä¸ªææ¡£çå¾åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "script_score": {\n        "inline": "Math.sqrt(doc[\'price\'].value/10)"\n      }\n    }\n  }\n}\n\n\nå³äº function_score çæ´å¤è¯¦ç»åå®¹è¯·æ¥ç Elasticsearch function_score æ¥è¯¢æå¼ºè¯¦è§£ã\n\n\n# 3.6. indices query\n\nindices query éç¨äºéè¦å¨å¤ä¸ªç´¢å¼ä¹é´è¿è¡æ¥è¯¢çåºæ¯ï¼å®åè®¸æå®ä¸ä¸ªç´¢å¼åå­åè¡¨ååé¨æ¥è¯¢ãindices query ä¸­æ query å no_match_query ä¸¤é¨åï¼query ä¸­ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¸­çææ¡£ï¼no_match_query ä¸­çæ¥è¯¢æ¡ä»¶ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¹å¤çææ¡£ãä¸é¢çæ¥è¯¢è¯­å¥å®ç°äºæç´¢ç´¢å¼ booksãbooks2 ä¸­ title å­æ®µåå«å³é®å­ javascriptï¼å¶ä»ç´¢å¼ä¸­ title å­æ®µåå« basketball çææ¡£ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"indices": {\n\t\t\t"indices": ["books", "books2"],\n\t\t\t"query": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "javascript"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"no_match_query": {\n\t\t\t\t"term": {\n\t\t\t\t\t"title": "basketball"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 4. åµå¥æ¥è¯¢\n\nå¨ Elasticsearch è¿æ ·çåå¸å¼ç³»ç»ä¸­æ§è¡å¨ SQL é£æ ¼çè¿æ¥æ¥è¯¢ä»£ä»·æè´µï¼æ¯ä¸å¯è¡çãç¸åºå°ï¼ä¸ºäºå®ç°æ°´å¹³è§æ¨¡å°æ©å±ï¼Elasticsearch æä¾äºä»¥ä¸ä¸¤ç§å½¢å¼ç joinï¼\n\n * nested queryï¼åµå¥æ¥è¯¢ï¼\n   \n   ææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ã\n\n * has_child queryï¼æå­æ¥è¯¢ï¼å has_parent queryï¼æç¶æ¥è¯¢ï¼\n   \n   ç¶å­å³ç³»å¯ä»¥å­å¨åä¸ªçç´¢å¼çä¸¤ä¸ªç±»åçææ¡£ä¹é´ãhas_child æ¥è¯¢å°è¿åå¶å­ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çç¶ææ¡£ï¼è has_parent åè¿åå¶ç¶ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çå­ææ¡£ã\n\n\n# 4.1. nested query\n\nææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ï¼ç¨åµå¥æ¥è¯¢ï¼ã\n\nPUT /my_index\n{\n\t"mappings": {\n\t\t"type1": {\n\t\t\t"properties": {\n\t\t\t\t"obj1": {\n\t\t\t\t\t"type": "nested"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 4.2. has_child query\n\nææ¡£çç¶å­å³ç³»åå»ºç´¢å¼æ¶å¨æ å°ä¸­å£°æï¼è¿éä»¥åå·¥ï¼employeeï¼åå·¥ä½åå¸ï¼branchï¼ä¸ºä¾ï¼å®ä»¬å±äºä¸åçç±»åï¼ç¸å½äºæ°æ®åºä¸­çä¸¤å¼ è¡¨ï¼å¦ææ³æåå·¥åä»ä»¬å·¥ä½çåå¸å³èèµ·æ¥ï¼éè¦åè¯ Elasticsearch ææ¡£ä¹é´çç¶å­å³ç³»ï¼è¿é employee æ¯ child typeï¼branch æ¯ parent typeï¼å¨æ å°ä¸­å£°æï¼æ§è¡å½ä»¤ï¼\n\nPUT /company\n{\n\t"mappings": {\n\t\t"branch": {},\n\t\t"employee": {\n\t\t\t"parent": { "type": "branch" }\n\t\t}\n\t}\n}\n\n\nä½¿ç¨ bulk api ç´¢å¼ branch ç±»åä¸çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nPOST company/branch/_bulk\n{ "index": { "_id": "london" }}\n{ "name": "London Westminster","city": "London","country": "UK" }\n{ "index": { "_id": "liverpool" }}\n{ "name": "Liverpool Central","city": "Liverpool","country": "UK" }\n{ "index": { "_id": "paris" }}\n{ "name": "Champs Elysees","city": "Paris","country": "France" }\n\n\næ·»å åå·¥æ°æ®ï¼\n\nPOST company/employee/_bulk\n{ "index": { "_id": 1,"parent":"london" }}\n{ "name": "Alice Smith","dob": "1970-10-24","hobby": "hiking" }\n{ "index": { "_id": 2,"parent":"london" }}\n{ "name": "Mark Tomas","dob": "1982-05-16","hobby": "diving" }\n{ "index": { "_id": 3,"parent":"liverpool" }}\n{ "name": "Barry Smith","dob": "1979-04-01","hobby": "hiking" }\n{ "index": { "_id": 4,"parent":"paris" }}\n{ "name": "Adrien Grand","dob": "1987-05-11","hobby": "horses" }\n\n\néè¿å­ææ¡£æ¥è¯¢ç¶ææ¡£è¦ä½¿ç¨ has_child æ¥è¯¢ãä¾å¦ï¼æç´¢ 1980 å¹´ä»¥ååºççåå·¥æå¨çåæ¯æºæï¼employee ä¸­ 1980 å¹´ä»¥ååºççæ Mark Thomas å Adrien Grandï¼ä»ä»¬åå«å¨ london å parisï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nGET company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"query": {\n\t\t\t\t"range": { "dob": { "gte": "1980-01-01" } }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næç´¢åªäºæºæä¸­æåä¸º âAlice Smithâ çåå·¥ï¼å ä¸ºä½¿ç¨ match æ¥è¯¢ï¼ä¼è§£æä¸º âAliceâ å âSmithâï¼æä»¥ Alice Smith å Barry Smith æå¨çæºæä¼è¢«å¹éï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nGET company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"score_mode": "max",\n\t\t\t"query": {\n\t\t\t\t"match": { "name": "Alice Smith" }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå¯ä»¥ä½¿ç¨ min_children æå®å­ææ¡£çæå°ä¸ªæ°ãä¾å¦ï¼æç´¢æå°å«æä¸¤ä¸ª employee çæºæï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nGET company/branch/_search?pretty\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"min_children": 2,\n\t\t\t"query": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 4.3. has_parent query\n\néè¿ç¶ææ¡£æ¥è¯¢å­ææ¡£ä½¿ç¨ has_parent æ¥è¯¢ãæ¯å¦ï¼æç´¢åªäº employee å·¥ä½å¨ UKï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nGET company/employee/_search\n{\n\t"query": {\n\t\t"has_parent": {\n\t\t\t"parent_type": "branch",\n\t\t\t"query": {\n\t\t\t\t"match": { "country": "UK }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 5. ä½ç½®æ¥è¯¢\n\nElasticsearch å¯ä»¥å¯¹å°çä½ç½®ç¹ geo_point ç±»ååå°çä½ç½®å½¢ç¶ geo_shape ç±»åçæ°æ®è¿è¡æç´¢ãä¸ºäºå­¦ä¹ æ¹ä¾¿ï¼è¿éåå¤ä¸äºåå¸çå°çåæ ä½ä¸ºæµè¯æ°æ®ï¼æ¯ä¸æ¡ææ¡£é½åå«åå¸åç§°åå°çåæ è¿ä¸¤ä¸ªå­æ®µï¼è¿éçåæ ç¹åçæ¯åä¸ªåå¸ä¸­å¿çä¸ä¸ªä½ç½®ãé¦åæä¸é¢çåå®¹ä¿å­å° geo.json æä»¶ä¸­ï¼\n\n{"index":{ "_index":"geo","_type":"city","_id":"1" }}\n{"name":"åäº¬","location":"39.9088145109,116.3973999023"}\n{"index":{ "_index":"geo","_type":"city","_id": "2" }}\n{"name":"ä¹é²æ¨é½","location":"43.8266300000,87.6168800000"}\n{"index":{ "_index":"geo","_type":"city","_id":"3" }}\n{"name":"è¥¿å®","location":"34.3412700000,108.9398400000"}\n{"index":{ "_index":"geo","_type":"city","_id":"4" }}\n{"name":"éå·","location":"34.7447157466,113.6587142944"}\n{"index":{ "_index":"geo","_type":"city","_id":"5" }}\n{"name":"æ­å·","location":"30.2294080260,120.1492309570"}\n{"index":{ "_index":"geo","_type":"city","_id":"6" }}\n{"name":"æµå","location":"36.6518400000,117.1200900000"}\n\n\nåå»ºä¸ä¸ªç´¢å¼å¹¶è®¾ç½®æ å°ï¼\n\nPUT geo\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_point"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nç¶åæ§è¡æ¹éå¯¼å¥å½ä»¤ï¼\n\ncurl -XPOST "http://localhost:9200/_bulk?pretty" --data-binary @geo.json\n\n\n\n# 5.1. geo_distance query\n\ngeo_distance query å¯ä»¥æ¥æ¾å¨ä¸ä¸ªä¸­å¿ç¹æå®èå´åçå°çç¹ææ¡£ãä¾å¦ï¼æ¥æ¾è·ç¦»å¤©æ´¥ 200km ä»¥åçåå¸ï¼æç´¢ç»æä¸­ä¼è¿ååäº¬ï¼å½ä»¤å¦ä¸ï¼\n\nGET geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_distance": {\n\t\t\t\t\t"distance": "200km",\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"lat": 39.0851000000,\n\t\t\t\t\t\t"lon": 117.1993700000\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næååå¸ç¦»åäº¬çè·ç¦»æåºï¼\n\nGET geo/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [{\n    "_geo_distance": {\n      "location": "39.9088145109,116.3973999023",\n      "unit": "km",\n      "order": "asc",\n      "distance_type": "plane"\n    }\n  }]\n}\n\n\nå¶ä¸­ location å¯¹åºçç»çº¬åº¦å­æ®µï¼unit ä¸º km è¡¨ç¤ºå°è·ç¦»ä»¥ km ä¸ºåä½åå¥å°æ¯ä¸ªè¿åç»æç sort é®ä¸­ï¼distance_type ä¸º plane è¡¨ç¤ºä½¿ç¨å¿«éä½ç²¾åº¦ç¥å·®ç plane è®¡ç®æ¹å¼ã\n\n\n# 5.2. geo_bounding_box query\n\ngeo_bounding_box query ç¨äºæ¥æ¾è½å¥æå®çç©å½¢åçå°çåæ ãæ¥è¯¢ä¸­ç±ä¸¤ä¸ªç¹ç¡®å®ä¸ä¸ªç©å½¢ï¼ç¶åå¨ç©å½¢åºååæ¥è¯¢å¹éçææ¡£ã\n\nGET geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_bounding_box": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"top_left": {\n\t\t\t\t\t\t\t"lat": 38.4864400000,\n\t\t\t\t\t\t\t"lon": 106.2324800000\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"bottom_right": {\n\t\t\t\t\t\t\t"lat": 28.6820200000,\n\t\t\t\t\t\t\t"lon": 115.8579400000\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 5.3. geo_polygon query\n\ngeo_polygon query ç¨äºæ¥æ¾å¨æå®å¤è¾¹å½¢åçå°çç¹ãä¾å¦ï¼å¼åæµ©ç¹ãéåºãä¸æµ·ä¸å°ç»æä¸ä¸ªä¸è§å½¢ï¼æ¥è¯¢ä½ç½®å¨è¯¥ä¸è§å½¢åºååçåå¸ï¼å½ä»¤å¦ä¸ï¼\n\nGET geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t},\n\t\t"filter": {\n\t\t\t"geo_polygon": {\n\t\t\t\t"location": {\n\t\t\t\t\t"points": [{\n\t\t\t\t\t\t"lat": 40.8414900000,\n\t\t\t\t\t\t"lon": 111.7519900000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 29.5647100000,\n\t\t\t\t\t\t"lon": 106.5507300000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 31.2303700000,\n\t\t\t\t\t\t"lon": 121.4737000000\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 5.4. geo_shape query\n\ngeo_shape query ç¨äºæ¥è¯¢ geo_shape ç±»åçå°çæ°æ®ï¼å°çå½¢ç¶ä¹é´çå³ç³»æç¸äº¤ãåå«ãä¸ç¸äº¤ä¸ç§ãåå»ºä¸ä¸ªæ°çç´¢å¼ç¨äºæµè¯ï¼å¶ä¸­ location å­æ®µçç±»åè®¾ä¸º geo_shape ç±»åã\n\nPUT geoshape\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_shape"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå³äºç»çº¬åº¦çé¡ºåºè¿éåä¸ä¸ªè¯´æï¼geo_point ç±»åçå­æ®µçº¬åº¦å¨åç»åº¦å¨åï¼ä½æ¯å¯¹äº geo_shape ç±»åä¸­çç¹ï¼æ¯ç»åº¦å¨åçº¬åº¦å¨åï¼è¿ä¸ç¹éè¦ç¹å«æ³¨æã\n\næè¥¿å®åéå·è¿æççº¿åå¥ç´¢å¼ï¼\n\nPOST geoshape/city/1\n{\n\t"name": "è¥¿å®-éå·",\n\t"location": {\n\t\t"type": "linestring",\n\t\t"coordinates": [\n\t\t\t[108.9398400000, 34.3412700000],\n\t\t\t[113.6587142944, 34.7447157466]\n\t\t]\n\t}\n}\n\n\næ¥è¯¢åå«å¨ç±é¶å·ååæä½ä¸ºå¯¹è§çº¿ä¸çç¹ç»æçç©å½¢çå°çå½¢ç¶ï¼ç±äºè¥¿å®åéå·ç»æçç´çº¿è½å¨è¯¥ç©å½¢åºååï¼å æ­¤å¯ä»¥è¢«æ¥è¯¢å°ãå½ä»¤å¦ä¸ï¼\n\nGET geoshape/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_shape": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"shape": {\n\t\t\t\t\t\t\t"type": "envelope",\n\t\t\t\t\t\t\t"coordinates": [\n\t\t\t\t\t\t\t\t[106.23248, 38.48644],\n\t\t\t\t\t\t\t\t[115.85794, 28.68202]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"relation": "within"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 6. ç¹æ®æ¥è¯¢\n\n\n# 6.1. more_like_this query\n\nmore_like_this query å¯ä»¥æ¥è¯¢åæä¾ææ¬ç±»ä¼¼çææ¡£ï¼éå¸¸ç¨äºè¿ä¼¼ææ¬çæ¨èç­åºæ¯ãæ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"more_like_ this": {\n\t\t\t"fields": ["title", "description"],\n\t\t\t"like": "java virtual machine",\n\t\t\t"min_term_freq": 1,\n\t\t\t"max_query_terms": 12\n\t\t}\n\t}\n}\n\n\nå¯éçåæ°ååå¼è¯´æå¦ä¸ï¼\n\n * fields è¦å¹éçå­æ®µï¼é»è®¤æ¯ _all å­æ®µã\n * like è¦å¹éçææ¬ã\n * min_term_freq ææ¡£ä¸­è¯é¡¹çæä½é¢çï¼é»è®¤æ¯ 2ï¼ä½äºæ­¤é¢ççææ¡£ä¼è¢«å¿½ç¥ã\n * max_query_terms query ä¸­è½åå«çæå¤§è¯é¡¹æ°ç®ï¼é»è®¤ä¸º 25ã\n * min_doc_freq æå°çææ¡£é¢çï¼é»è®¤ä¸º 5ã\n * max_doc_freq æå¤§ææ¡£é¢çã\n * min_word length åè¯çæå°é¿åº¦ã\n * max_word length åè¯çæå¤§é¿åº¦ã\n * stop_words åç¨è¯åè¡¨ã\n * analyzer åè¯å¨ã\n * minimum_should_match ææ¡£åºå¹éçæå°è¯é¡¹æ°ï¼é»è®¤ä¸º query åè¯åè¯é¡¹æ°ç 30%ã\n * boost terms è¯é¡¹çæéã\n * include æ¯å¦æè¾å¥ææ¡£ä½ä¸ºç»æè¿åã\n * boost æ´ä¸ª query çæéï¼é»è®¤ä¸º 1.0ã\n\n\n# 6.2. script query\n\nElasticsearch æ¯æä½¿ç¨èæ¬è¿è¡æ¥è¯¢ãä¾å¦ï¼æ¥è¯¢ä»·æ ¼å¤§äº 180 çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nGET books/_search\n{\n  "query": {\n    "script": {\n      "script": {\n        "inline": "doc[\'price\'].value > 180",\n        "lang": "painless"\n      }\n    }\n  }\n}\n\n\n\n# 6.3. percolate query\n\nä¸è¬æåµä¸ï¼æä»¬æ¯åæææ¡£åå¥å° Elasticsearch ä¸­ï¼éè¿æ¥è¯¢è¯­å¥å¯¹ææ¡£è¿è¡æç´¢ãpercolate query åæ¯åå¶éèè¡ä¹çåæ³ï¼å®ä¼åæ³¨åæ¥è¯¢æ¡ä»¶ï¼æ ¹æ®ææ¡£æ¥æ¥è¯¢ queryãä¾å¦ï¼å¨ my-index ç´¢å¼ä¸­æä¸ä¸ª laptop ç±»åï¼ææ¡£æ price å name ä¸¤ä¸ªå­æ®µï¼å¨æ å°ä¸­å£°æä¸ä¸ª percolator ç±»åç queryï¼å½ä»¤å¦ä¸ï¼\n\nPUT my-index\n{\n\t"mappings": {\n\t\t"laptop": {\n\t\t\t"properties": {\n\t\t\t\t"price": { "type": "long" },\n\t\t\t\t"name": { "type": "text" }\n\t\t\t},\n\t\t\t"queries": {\n\t\t\t\t"properties": {\n\t\t\t\t\t"query": { "type": "percolator" }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næ³¨åä¸ä¸ª bool queryï¼bool query ä¸­åå«ä¸ä¸ª range queryï¼è¦æ± price å­æ®µçåå¼å°äºç­äº 10000ï¼å¹¶ä¸ name å­æ®µä¸­å«æå³é®è¯ macbookï¼\n\nPUT /my-index/queries/1?refresh\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [{\n\t\t\t\t"range": { "price": { "lte": 10000 } }\n\t\t\t}, {\n\t\t\t\t"match": { "name": "macbook" }\n\t\t\t}]\n\t\t}\n\t}\n}\n\n\néè¿ææ¡£æ¥è¯¢ queryï¼\n\nGET /my-index/_search\n{\n\t"query": {\n\t\t"percolate": {\n\t\t\t"field": "query",\n\t\t\t"document_type": "laptop",\n\t\t\t"document": {\n\t\t\t\t"price": 9999,\n\t\t\t\t"name": "macbook pro on sale"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nææ¡£ç¬¦å query ä¸­çæ¡ä»¶ï¼è¿åç»æä¸­å¯ä»¥æ¥å°ä¸æä¸­æ³¨åç bool queryãpercolate query çè¿ç§ç¹æ§éç¨äºæ°æ®åç±»ãæ°æ®è·¯ç±ãäºä»¶çæ§åé¢è­¦ç­åºæ¯ã',normalizedContent:'# elasticsearch æ¥è¯¢\n\nelasticsearch æ¥è¯¢è¯­å¥éç¨åºäº restful é£æ ¼çæ¥å£å°è£æ json æ ¼å¼çå¯¹è±¡ï¼ç§°ä¹ä¸º query dslãelasticsearch æ¥è¯¢åç±»å¤§è´åä¸ºå¨ææ¥è¯¢ãè¯é¡¹æ¥è¯¢ãå¤åæ¥è¯¢ãåµå¥æ¥è¯¢ãä½ç½®æ¥è¯¢ãç¹æ®æ¥è¯¢ãelasticsearch æ¥è¯¢ä»æºå¶åä¸ºä¸¤ç§ï¼ä¸ç§æ¯æ ¹æ®ç¨æ·è¾å¥çæ¥è¯¢è¯ï¼éè¿æåºæ¨¡åè®¡ç®ææ¡£ä¸æ¥è¯¢è¯ä¹é´çç¸å³åº¦ï¼å¹¶æ ¹æ®è¯åé«ä½æåºè¿åï¼å¦ä¸ç§æ¯è¿æ»¤æºå¶ï¼åªæ ¹æ®è¿æ»¤æ¡ä»¶å¯¹ææ¡£è¿è¡è¿æ»¤ï¼ä¸è®¡ç®è¯åï¼éåº¦ç¸å¯¹è¾å¿«ã\n\n\n# 1. å¨ææ¥è¯¢\n\nes å¨ææ¥è¯¢ä¸»è¦ç¨äºå¨å¨æå­æ®µä¸ï¼ä¸»è¦èèæ¥è¯¢è¯ä¸ææ¡£çç¸å³æ§ï¼relevanceï¼ã\n\n\n# 1.1. intervals query\n\nintervals query æ ¹æ®å¹éè¯çé¡ºåºåè¿ä¼¼åº¦è¿åææ¡£ã\n\nintervals query ä½¿ç¨å¹éè§åï¼è¿äºè§ååºç¨äºæå®å­æ®µä¸­ç termã\n\nç¤ºä¾ï¼ä¸é¢ç¤ºä¾æç´¢ query å­æ®µï¼æç´¢å¼æ¯ my favorite foodï¼æ²¡æä»»ä½é´éï¼ç¶åæ¯ my_text å­æ®µæç´¢å¹é hot waterãcold porridge ç termã\n\nå½ my_text ä¸­çå¼ä¸º my favorite food is cold porridge æ¶ï¼ä¼å¹éæåï¼ä½æ¯ when it\'s cold my favorite food is porridge åå¹éå¤±è´¥\n\npost _search\n{\n  "query": {\n    "intervals" : {\n      "my_text" : {\n        "all_of" : {\n          "ordered" : true,\n          "intervals" : [\n            {\n              "match" : {\n                "query" : "my favorite food",\n                "max_gaps" : 0,\n                "ordered" : true\n              }\n            },\n            {\n              "any_of" : {\n                "intervals" : [\n                  { "match" : { "query" : "hot water" } },\n                  { "match" : { "query" : "cold porridge" } }\n                ]\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\n\n\n# 1.2. match query\n\nmatch query ç¨äºæç´¢åä¸ªå­æ®µï¼é¦åä¼éå¯¹æ¥è¯¢è¯­å¥è¿è¡è§£æï¼ç»è¿ analyzerï¼ï¼ä¸»è¦æ¯å¯¹æ¥è¯¢è¯­å¥è¿è¡åè¯ï¼åè¯åæ¥è¯¢è¯­å¥çä»»ä½ä¸ä¸ªè¯é¡¹è¢«å¹éï¼ææ¡£å°±ä¼è¢«æå°ï¼é»è®¤æåµä¸ç¸å½äºå¯¹åè¯åè¯é¡¹è¿è¡ or å¹éæä½ã\n\nmatch query æ¯æ§è¡å¨ææç´¢çæ åæ¥è¯¢ï¼åæ¬æ¨¡ç³å¹ééé¡¹ã\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "george hubbard"\n      }\n    }\n  }\n}\n\n\nç­åäº or å¹éæä½ï¼å¦ä¸ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "george hubbard",\n        "operator": "or"\n      }\n    }\n  }\n}\n\n\n# match query ç®å\n\nå¯ä»¥éè¿ç»å <field> å query åæ°æ¥ç®åå¹éæ¥è¯¢è¯­æ³ã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "match": {\n      "message": "this is a test"\n    }\n  }\n}\n\n\n# match query å¦ä½å·¥ä½\n\nå¹éæ¥è¯¢æ¯å¸å°ç±»åãè¿æå³çä¼å¯¹æä¾çææ¬è¿è¡åæï¼åæè¿ç¨ä»æä¾çææ¬æé ä¸ä¸ªå¸å°æ¥è¯¢ã operator åæ°å¯ä»¥è®¾ç½®ä¸º or æ and æ¥æ§å¶å¸å°å­å¥ï¼é»è®¤ä¸º orï¼ãå¯ä»¥ä½¿ç¨ minimum_should_match åæ°è®¾ç½®è¦å¹éçå¯é should å­å¥çæå°æ°éã\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "match": {\n      "customer_full_name": {\n        "query": "george hubbard",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® analyzer æ¥æ§å¶åªä¸ªåæå¨å°å¯¹ææ¬æ§è¡åæè¿ç¨ãå®é»è®¤ä¸ºå­æ®µæ¾å¼æ å°å®ä¹æé»è®¤æç´¢åæå¨ã\n\nlenient åæ°å¯ä»¥è®¾ç½®ä¸º true ä»¥å¿½ç¥ç±æ°æ®ç±»åä¸å¹éå¯¼è´çå¼å¸¸ï¼ä¾å¦å°è¯ä½¿ç¨ææ¬æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢æ°å­å­æ®µãé»è®¤ä¸º falseã\n\n# match query çæ¨¡ç³æ¥è¯¢\n\nfuzziness åè®¸åºäºè¢«æ¥è¯¢å­æ®µçç±»åè¿è¡æ¨¡ç³å¹éãè¯·åé fuzziness çéç½®ã\n\nå¨è¿ç§æåµä¸å¯ä»¥è®¾ç½® prefix_length å max_expansions æ¥æ§å¶æ¨¡ç³å¹éãå¦æè®¾ç½®äºæ¨¡ç³éé¡¹ï¼æ¥è¯¢å°ä½¿ç¨ top_terms_blended_freqs_${max_expansions} ä½ä¸ºå¶éåæ¹æ³ï¼fuzzy_rewrite åæ°åè®¸æ§å¶æ¥è¯¢å°å¦ä½è¢«éåã\n\né»è®¤æåµä¸åè®¸æ¨¡ç³åè½¬ (ab â ba)ï¼ä½å¯ä»¥éè¿å° fuzzy_transpositions è®¾ç½®ä¸º false æ¥ç¦ç¨ã\n\nget /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "this is a testt",\n        "fuzziness": "auto"\n      }\n    }\n  }\n}\n\n\n# zero terms æ¥è¯¢\n\nå¦æä½¿ç¨çåæå¨å stop è¿æ»¤å¨ä¸æ ·å é¤æ¥è¯¢ä¸­çæææ è®°ï¼åé»è®¤è¡ä¸ºæ¯ä¸å¹éä»»ä½ææ¡£ãå¯ä»¥ä½¿ç¨ zero_terms_query éé¡¹æ¥æ¹åé»è®¤è¡ä¸ºï¼å®æ¥å noneï¼é»è®¤ï¼å all ï¼ç¸å½äº match_all æ¥è¯¢ï¼ã\n\nget /_search\n{\n  "query": {\n    "match": {\n      "message": {\n        "query": "to be or not to be",\n        "operator": "and",\n        "zero_terms_query": "all"\n      }\n    }\n  }\n}\n\n\n\n# 1.3. match_bool_prefix query\n\nmatch_bool_prefix query åæå¶è¾å¥å¹¶æ ¹æ®è¿äºè¯æé ä¸ä¸ªå¸å°æ¥è¯¢ãé¤äºæåä¸ä¸ªæ¯è¯­ä¹å¤çæ¯ä¸ªæ¯è¯­é½ç¨äºæ¯è¯­æ¥è¯¢ãæåä¸ä¸ªè¯ç¨äº prefix queryã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "match_bool_prefix" : {\n      "message" : "quick brown f"\n    }\n  }\n}\n\n\nç­ä»·äº\n\nget /_search\n{\n  "query": {\n    "bool" : {\n      "should": [\n        { "term": { "message": "quick" }},\n        { "term": { "message": "brown" }},\n        { "prefix": { "message": "f"}}\n      ]\n    }\n  }\n}\n\n\nmatch_bool_prefix query å match_phrase_prefix query ä¹é´çä¸ä¸ªéè¦åºå«æ¯ï¼match_phrase_prefix query å°å¶ term å¹éä¸ºç­è¯­ï¼ä½ match_bool_prefix query å¯ä»¥å¨ä»»ä½ä½ç½®å¹éå¶ termã\n\nä¸é¢çç¤ºä¾ match_bool_prefix query æ¥è¯¢å¯ä»¥å¹éåå« quick brown fox çå­æ®µï¼ä½å®ä¹å¯ä»¥å¿«éå¹é brown foxãå®è¿å¯ä»¥å¹éåå« quickãbrown åä»¥ f å¼å¤´çå­æ®µï¼åºç°å¨ä»»ä½ä½ç½®ã\n\n\n# 1.4. match_phrase query\n\nmatch_phrase query å³ç­è¯­å¹éï¼é¦åä¼æ query åå®¹åè¯ï¼åè¯å¨å¯ä»¥èªå®ä¹ï¼åæ¶ææ¡£è¿è¦æ»¡è¶³ä»¥ä¸ä¸¤ä¸ªæ¡ä»¶æä¼è¢«æç´¢å°ï¼\n\n 1. åè¯åææè¯é¡¹é½è¦åºç°å¨è¯¥å­æ®µä¸­ï¼ç¸å½äº and æä½ï¼ã\n 2. å­æ®µä¸­çè¯é¡¹é¡ºåºè¦ä¸è´ã\n\nä¾å¦ï¼æä»¥ä¸ 3 ä¸ªææ¡£ï¼ä½¿ç¨ match_phrase æ¥è¯¢ "how are you"ï¼åªæåä¸¤ä¸ªææ¡£ä¼è¢«å¹éï¼\n\nput demo/_create/1\n{ "desc": "how are you" }\n\nput demo/_create/2\n{ "desc": "how are you, jack?"}\n\nput demo/_create/3\n{ "desc": "are you"}\n\nget demo/_search\n{\n  "query": {\n    "match_phrase": {\n      "desc": "how are you"\n    }\n  }\n}\n\n\n> è¯´æï¼\n> \n> ä¸ä¸ªè¢«è®¤å®ä¸ºåç­è¯­ how are you å¹éçææ¡£ï¼å¿é¡»æ»¡è¶³ä»¥ä¸è¿äºè¦æ±ï¼\n> \n>  * howã are å you éè¦å¨é¨åºç°å¨åä¸­ã\n>  * are çä½ç½®åºè¯¥æ¯ how çä½ç½®å¤§ 1 ã\n>  * you çä½ç½®åºè¯¥æ¯ how çä½ç½®å¤§ 2 ã\n\n\n# 1.5. match_phrase_prefix query\n\nmatch_phrase_prefix query å match_phrase query ç±»ä¼¼ï¼åªä¸è¿ match_phrase_prefix query æåä¸ä¸ª term ä¼è¢«ä½ä¸ºåç¼å¹éã\n\nget demo/_search\n{\n  "query": {\n    "match_phrase_prefix": {\n      "desc": "are yo"\n    }\n  }\n}\n\n\n\n# 1.6. multi_match query\n\nmulti_match query æ¯ match query çåçº§ï¼ç¨äºæç´¢å¤ä¸ªå­æ®µã\n\nç¤ºä¾ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nmulti_match query çæç´¢å­æ®µå¯ä»¥ä½¿ç¨ééç¬¦æå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_*",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\nåæ¶ï¼ä¹å¯ä»¥ç¨ææ°ç¬¦æå®æç´¢å­æ®µçæéã\n\nç¤ºä¾ï¼æå® taxful_total_price å­æ®µçæéæ¯ taxless_total_price å­æ®µç 3 åï¼å½ä»¤å¦ä¸ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "multi_match": {\n      "query": 34.98,\n      "fields": [\n        "taxful_total_price^3",\n        "taxless_total_price"\n      ]\n    }\n  }\n}\n\n\n\n# 1.7. combined_fields query\n\ncombined_fields query æ¯ææç´¢å¤ä¸ªææ¬å­æ®µï¼å°±å¥½åå®ä»¬çåå®¹å·²è¢«ç´¢å¼å°ä¸ä¸ªç»åå­æ®µä¸­ä¸æ ·ãè¯¥æ¥è¯¢ä¼çæä»¥ term ä¸ºä¸­å¿çè¾å¥å­ç¬¦ä¸²è§å¾ï¼é¦åå®å°æ¥è¯¢å­ç¬¦ä¸²è§£æä¸ºç¬ç«ç termï¼ç¶åå¨ææå­æ®µä¸­æ¥æ¾æ¯ä¸ª termãå½å¹éç»æå¯è½è·¨è¶å¤ä¸ªææ¬å­æ®µæ¶ï¼æ­¤æ¥è¯¢ç¹å«æç¨ï¼ä¾å¦æç« çæ é¢ãæè¦åæ­£æï¼\n\nget /_search\n{\n  "query": {\n    "combined_fields" : {\n      "query":      "database systems",\n      "fields":     [ "title", "abstract", "body"],\n      "operator":   "and"\n    }\n  }\n}\n\n\n# å­æ®µåç¼æé\n\nå­æ®µåç¼æéæ ¹æ®ç»åå­æ®µæ¨¡åè¿è¡è®¡ç®ãä¾å¦ï¼å¦æ title å­æ®µçæéä¸º 2ï¼åå¹éåº¦æåæ¶ä¼å° title ä¸­çæ¯ä¸ª term å½¢æçç»åå­æ®µï¼æåºç°ä¸¤æ¬¡è¿è¡æåã\n\n\n# 1.8. common_terms query\n\n> 7.3.0 åºå¼\n\ncommon_terms query æ¯ä¸ç§å¨ä¸çºç²æ§è½çæåµä¸æ¿ä»£åç¨è¯æé«æç´¢åç¡®çåå¬åççæ¹æ¡ã\n\næ¥è¯¢ä¸­çæ¯ä¸ªè¯é¡¹é½æä¸å®çä»£ä»·ï¼ä»¥æç´¢âthe brown foxâä¸ºä¾ï¼query ä¼è¢«è§£ææä¸ä¸ªè¯é¡¹âtheââbrownâåâfoxâï¼æ¯ä¸ªè¯é¡¹é½ä¼å°ç´¢å¼ä¸­æ§è¡ä¸æ¬¡æ¥è¯¢ãå¾æ¾ç¶åå«âtheâçææ¡£éå¸¸å¤ï¼ç¸æ¯å¶ä»è¯é¡¹ï¼âtheâçéè¦æ§ä¼ä½å¾å¤ãä¼ ç»çè§£å³æ¹æ¡æ¯æâtheâå½ä½åç¨è¯å¤çï¼å»é¤åç¨è¯ä¹åå¯ä»¥åå°ç´¢å¼å¤§å°ï¼åæ¶å¨æç´¢æ¶åå°å¯¹åç¨è¯çæ¶ç¼©ã\n\nè½ç¶åç¨è¯å¯¹ææ¡£è¯åå½±åä¸å¤§ï¼ä½æ¯å½åç¨è¯ä»ç¶æéè¦æä¹çæ¶åï¼å»é¤åç¨è¯å°±ä¸æ¯å®ç¾çè§£å³æ¹æ¡äºãå¦æå»é¤åç¨è¯ï¼å°±æ æ³åºåâhappyâåânot happyâ, âtheââto be or not to beâå°±ä¸ä¼å¨ç´¢å¼ä¸­å­å¨ï¼æç´¢çåç¡®çåå¬åçå°±ä¼éä½ã\n\ncommon_terms query æä¾äºä¸ç§è§£å³æ¹æ¡ï¼å®æ query åè¯åçè¯é¡¹åæéè¦è¯é¡¹ï¼ä½é¢è¯é¡¹ï¼åä¸éè¦çè¯é¡¹ï¼é«é¢è¯ï¼ä¹å°±æ¯ä¹åçåç¨è¯ï¼ãå¨æç´¢çæ¶åï¼é¦åæç´¢åéè¦è¯é¡¹å¹éçææ¡£ï¼è¿äºææ¡£æ¯è¯é¡¹åºç°è¾å°å¹¶ä¸è¯é¡¹å¯¹å¶è¯åå½±åè¾å¤§çææ¡£ãç¶åæ§è¡ç¬¬äºæ¬¡æ¥è¯¢ï¼æç´¢å¯¹è¯åå½±åè¾å°çé«é¢è¯é¡¹ï¼ä½æ¯ä¸è®¡ç®ææææ¡£çè¯åï¼èæ¯åªè®¡ç®ç¬¬ä¸æ¬¡æ¥è¯¢å·²ç»å¹éçææ¡£å¾åãå¦æä¸ä¸ªæ¥è¯¢ä¸­åªåå«é«é¢è¯ï¼é£ä¹ä¼éè¿ and è¿æ¥ç¬¦æ§è¡ä¸ä¸ªåç¬çæ¥è¯¢ï¼æ¢è¨ä¹ï¼ä¼æç´¢ææçè¯é¡¹ã\n\nè¯é¡¹æ¯é«é¢è¯è¿æ¯ä½é¢è¯æ¯éè¿ cutoff frequency æ¥è®¾ç½®éå¼çï¼åå¼å¯ä»¥æ¯ç»å¯¹é¢çï¼é¢çå¤§äº 1ï¼æèç¸å¯¹é¢çï¼0 ï½ 1ï¼ãcommon_terms query ææè¶£ä¹å¤å¨äºå®è½èªéåºç¹å®é¢åçåç¨è¯ï¼ä¾å¦ï¼å¨è§é¢æç®¡ç½ç«ä¸ï¼è¯¸å¦âclipâæâvideoâä¹ç±»çé«é¢è¯é¡¹å°èªå¨è¡¨ç°ä¸ºåç¨è¯ï¼æ é¡»ä¿çæå¨åè¡¨ã\n\nä¾å¦ï¼ææ¡£é¢çé«äº 0.1% çè¯é¡¹å°ä¼è¢«å½ä½é«é¢è¯é¡¹ï¼è¯é¢ä¹é´å¯ä»¥ç¨ low_freq_operatorãhigh_freq_operator åæ°è¿æ¥ãè®¾ç½®ä½é¢è¯æä½ç¬¦ä¸ºâandâä½¿ææçä½é¢è¯é½æ¯å¿é¡»æç´¢çï¼ç¤ºä¾ä»£ç å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"common": {\n\t\t\t"body": {\n\t\t\t\t"query": "nelly the elephant as a cartoon",\n\t\t\t\t"cutoff_frequency": 0.001,\n\t\t\t\t"low_freq_operator": "and"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nä¸è¿°æä½ç­ä»·äºï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [\n\t\t\t  { "term": { "body": "nelly" } },\n\t\t\t  { "term": { "body": "elephant" } },\n\t\t\t  { "term": { "body": "cartoon" } }\n\t\t\t],\n\t\t\t"should": [\n\t\t\t  { "term": { "body": "the" } },\n\t\t\t  { "term": { "body": "as" } },\n\t\t\t  { "term": { "body": "a" } }\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# 1.9. query_string query\n\nquery_string query æ¯ä¸ lucene æ¥è¯¢è¯­å¥çè¯­æ³ç»åéå¸¸ç´§å¯çä¸ç§æ¥è¯¢ï¼åè®¸å¨ä¸ä¸ªæ¥è¯¢è¯­å¥ä¸­ä½¿ç¨å¤ä¸ªç¹æ®æ¡ä»¶å³é®å­ï¼å¦ï¼and | or | notï¼å¯¹å¤ä¸ªå­æ®µè¿è¡æ¥è¯¢ï¼å»ºè®®çæ lucene æ¥è¯¢è¯­æ³çç¨æ·å»ä½¿ç¨ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ query_string query æ¥åå»ºåå«ééç¬¦ãè·¨å¤ä¸ªå­æ®µçæç´¢ç­å¤ææç´¢ãè½ç¶éç¨ï¼ä½æ¥è¯¢æ¯ä¸¥æ ¼çï¼å¦ææ¥è¯¢å­ç¬¦ä¸²åå«ä»»ä½æ æè¯­æ³ï¼åä¼è¿åéè¯¯ã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "query_string": {\n      "query": "(new york city) or (big apple)",\n      "default_field": "content"\n    }\n  }\n}\n\n\n\n# 1.10. simple_query_string query\n\nsimple_query_string query æ¯ä¸ç§éåç´æ¥æ´é²ç»ç¨æ·ï¼å¹¶ä¸å·æéå¸¸å®åçæ¥è¯¢è¯­æ³çæ¥è¯¢è¯­å¥ï¼æ¥å lucene æ¥è¯¢è¯­æ³ï¼è§£æè¿ç¨ä¸­åçéè¯¯ä¸ä¼æåºå¼å¸¸ã\n\nè½ç¶è¯­æ³æ¯ query_string query æ´ä¸¥æ ¼ï¼ä½ simple_query_string query ä¸ä¼è¿åæ æè¯­æ³çéè¯¯ãç¸åï¼å®ä¼å¿½ç¥æ¥è¯¢å­ç¬¦ä¸²çä»»ä½æ æé¨åã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "simple_query_string" : {\n        "query": "\\"fried eggs\\" +(eggplant | potato) -frittata",\n        "fields": ["title^5", "body"],\n        "default_operator": "and"\n    }\n  }\n}\n\n\n# simple_query_string è¯­ä¹\n\n * +ï¼ç­ä»·äº and æä½\n * |ï¼ç­ä»·äº or æä½\n * -ï¼ç¸å½äº not æä½\n * "ï¼åè£ä¸äºæ è®°ä»¥è¡¨ç¤ºç¨äºæç´¢çç­è¯­\n * *ï¼è¯å°¾è¡¨ç¤ºåç¼æ¥è¯¢\n * ( and )ï¼è¡¨ç¤ºä¼åçº§\n * ~nï¼è¯å°¾è¡¨ç¤ºè¡¨ç¤ºç¼è¾è·ç¦»ï¼æ¨¡ç³æ§ï¼\n * ~nï¼å¨ä¸ä¸ªç­è¯­ä¹åè¡¨ç¤ºæº¢åºé\n\næ³¨æï¼è¦ä½¿ç¨ä¸é¢çå­ç¬¦ï¼è¯·ä½¿ç¨åææ  / å¯¹å¶è¿è¡è½¬ä¹ã\n\n\n# 1.11. å¨ææ¥è¯¢å®æ´ç¤ºä¾\n\n#è®¾ç½® position_increment_gap\ndelete groups\nput groups\n{\n  "mappings": {\n    "properties": {\n      "names":{\n        "type": "text",\n        "position_increment_gap": 0\n      }\n    }\n  }\n}\n\nget groups/_mapping\n\npost groups/_doc\n{\n  "names": [ "john water", "water smith"]\n}\n\npost groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": {\n        "query": "water water",\n        "slop": 100\n      }\n    }\n  }\n}\n\npost groups/_search\n{\n  "query": {\n    "match_phrase": {\n      "names": "water smith"\n    }\n  }\n}\n\ndelete groups\n\n\n\n# 2. è¯é¡¹æ¥è¯¢\n\ntermï¼è¯é¡¹ï¼æ¯è¡¨è¾¾è¯­æçæå°åä½ãæç´¢åå©ç¨ç»è®¡è¯­è¨æ¨¡åè¿è¡èªç¶è¯­è¨å¤çé½éè¦å¤ç termã\n\nå¨ææ¥è¯¢å¨æ§è¡æ¥è¯¢ä¹åä¼åææ¥è¯¢å­ç¬¦ä¸²ã\n\nä¸å¨ææ¥è¯¢ä¸åï¼è¯é¡¹æ¥è¯¢ä¸ä¼åè¯ï¼èæ¯å°è¾å¥ä½ä¸ºä¸ä¸ªæ´ä½ï¼å¨åæç´¢å¼ä¸­æ¥æ¾åç¡®çè¯é¡¹ãå¹¶ä¸ä½¿ç¨ç¸å³åº¦è®¡ç®å¬å¼ä¸ºæ¯ä¸ªåå«è¯¥è¯é¡¹çææ¡£è¿è¡ç¸å³åº¦è®¡ç®ãä¸è¨ä»¥æ¦ä¹ï¼è¯é¡¹æ¥è¯¢æ¯å¯¹è¯é¡¹è¿è¡ç²¾ç¡®å¹éãè¯é¡¹æ¥è¯¢éå¸¸ç¨äºç»æåæ°æ®ï¼å¦æ°å­ãæ¥æåæä¸¾ç±»åã\n\nè¯é¡¹æ¥è¯¢æä»¥ä¸ç±»åï¼\n\n * exists query\n * fuzzy query\n * ids query\n * prefix query\n * range query\n * regexp query\n * term query\n * terms query\n * type query\n * wildcard query\n\n\n# 2.1. exists query\n\nexists query ä¼è¿åå­æ®µä¸­è³å°æä¸ä¸ªéç©ºå¼çææ¡£ã\n\nç±äºå¤ç§åå ï¼ææ¡£å­æ®µå¯è½ä¸å­å¨ç´¢å¼å¼ï¼\n\n * json ä¸­çå­æ®µä¸º null æ []\n * è¯¥å­æ®µå¨ mapping ä¸­éç½®äº "index" : false\n * å­æ®µå¼çé¿åº¦è¶è¿äº mapping ä¸­ç ignore_above è®¾ç½®\n * å­æ®µå¼æ ¼å¼éè¯¯ï¼å¹¶ä¸å¨ mapping ä¸­å®ä¹äº ignore_malformed\n\nç¤ºä¾ï¼\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "exists": {\n      "field": "email"\n    }\n  }\n}\n\n\nä»¥ä¸ææ¡£ä¼å¹éä¸é¢çæ¥è¯¢ï¼\n\n * { "user" : "jane" } æ user å­æ®µï¼ä¸ä¸ä¸ºç©ºã\n * { "user" : "" } æ user å­æ®µï¼å¼ä¸ºç©ºå­ç¬¦ä¸²ã\n * { "user" : "-" } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane" ] } æ user å­æ®µï¼å¼ä¸ä¸ºç©ºã\n * { "user" : [ "jane", null ] } æ user å­æ®µï¼è³å°ä¸ä¸ªå¼ä¸ä¸ºç©ºå³å¯ã\n\nä¸é¢çææ¡£é½ä¸ä¼è¢«å¹éï¼\n\n * { "user" : null } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "user" : [null] } è½ç¶æ user å­æ®µï¼ä½æ¯å¼ä¸ºç©ºã\n * { "foo" : "bar" } æ²¡æ user å­æ®µã\n\n\n# 2.2. fuzzy query\n\nfuzzy queryï¼æ¨¡ç³æ¥è¯¢ï¼è¿ååå«ä¸æç´¢è¯ç¸ä¼¼çè¯çææ¡£ães ä½¿ç¨ levenshtein edit distanceï¼levenshtein ç¼è¾è·ç¦»ï¼æµéç¸ä¼¼åº¦ææ¨¡ç³åº¦ã\n\nç¼è¾è·ç¦»æ¯å°ä¸ä¸ªæ¯è¯­è½¬æ¢ä¸ºå¦ä¸ä¸ªæ¯è¯­æéçåä¸ªå­ç¬¦æ´æ¹çæ°éãè¿äºååå¯è½åæ¬ï¼\n\n * æ¹åä¸ä¸ªå­ç¬¦ï¼ï¼box -> foxï¼\n * å é¤ä¸ä¸ªå­ç¬¦ï¼ï¼black -> lackï¼\n * æå¥ä¸ä¸ªå­ç¬¦ï¼ï¼sic -> sickï¼\n * åè½¬ä¸¤ä¸ªç¸é»å­ç¬¦ï¼ï¼act â catï¼\n\nä¸ºäºæ¾å°ç¸ä¼¼çè¯æ¡ï¼fuzzy query ä¼å¨æå®çç¼è¾è·ç¦»ååå»ºæç´¢è¯æ¡çææå¯è½åä½ææ©å±éãç¶åè¿åå®å¨å¹éä»»ææ©å±çææ¡£ã\n\nget books/_search\n{\n  "query": {\n    "fuzzy": {\n      "user.id": {\n        "value": "ki",\n        "fuzziness": "auto",\n        "max_expansions": 50,\n        "prefix_length": 0,\n        "transpositions": true,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\næ³¨æï¼å¦æéç½®äº search.allow_expensive_queries ï¼å fuzzy query ä¸è½æ§è¡ã\n\n\n# 2.3. ids query\n\nids query æ ¹æ® id è¿åææ¡£ã æ­¤æ¥è¯¢ä½¿ç¨å­å¨å¨ _id å­æ®µä¸­çææ¡£ idã\n\nget /_search\n{\n  "query": {\n    "ids" : {\n      "values" : ["1", "4", "100"]\n    }\n  }\n}\n\n\n\n# 2.4. prefix query\n\nprefix query ç¨äºæ¥è¯¢æä¸ªå­æ®µä¸­åå«æå®åç¼çææ¡£ã\n\næ¯å¦æ¥è¯¢ user.id ä¸­å«æä»¥ ki ä¸ºåç¼çå³é®è¯çææ¡£ï¼é£ä¹å«æ kindãkid ç­ææä»¥ ki å¼å¤´å³é®è¯çææ¡£é½ä¼è¢«å¹éã\n\nget /_search\n{\n  "query": {\n    "prefix": {\n      "user.id": {\n        "value": "ki"\n      }\n    }\n  }\n}\n\n\n\n# 2.5. range query\n\nrange query å³èå´æ¥è¯¢ï¼ç¨äºå¹éå¨æä¸èå´åçæ°å¼åãæ¥æç±»åæèå­ç¬¦ä¸²åå­æ®µçææ¡£ãæ¯å¦æç´¢åªäºä¹¦ç±çä»·æ ¼å¨ 50 å° 100 ä¹é´ãåªäºä¹¦ç±çåºçæ¶é´å¨ 2015 å¹´å° 2019 å¹´ä¹é´ãä½¿ç¨ range æ¥è¯¢åªè½æ¥è¯¢ä¸ä¸ªå­æ®µï¼ä¸è½ä½ç¨å¨å¤ä¸ªå­æ®µä¸ã\n\nrange æ¥è¯¢æ¯æçåæ°æä»¥ä¸å ç§ï¼\n\n * gtï¼å¤§äº\n\n * gteï¼å¤§äºç­äº\n\n * ltï¼å°äº\n\n * lteï¼å°äºç­äº\n\n * formatï¼å¦æå­æ®µæ¯ date ç±»åï¼å¯ä»¥è®¾ç½®æ¥ææ ¼å¼å\n\n * time_zoneï¼æ¶åº\n\n * relationï¼æç¤ºèå´æ¥è¯¢å¦ä½å¹éèå´å­æ®µçå¼ã\n   \n   * intersects (default)ï¼å¹éä¸æ¥è¯¢å­æ®µå¼èå´ç¸äº¤çææ¡£ã\n   * containsï¼å¹éå®å¨åå«æ¥è¯¢å­æ®µå¼çææ¡£ã\n   * withinï¼å¹éå·æå®å¨å¨æ¥è¯¢èå´åçèå´å­æ®µå¼çææ¡£ã\n\nç¤ºä¾ï¼æ°å¼èå´æ¥è¯¢\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "taxful_total_price": {\n        "gt": 10,\n        "lte": 50\n      }\n    }\n  }\n}\n\n\nç¤ºä¾ï¼æ¥æèå´æ¥è¯¢\n\nget kibana_sample_data_ecommerce/_search\n{\n  "query": {\n    "range": {\n      "order_date": {\n        "time_zone": "+00:00",\n        "gte": "2018-01-01t00:00:00",\n        "lte": "now"\n      }\n    }\n  }\n}\n\n\n\n# 2.6. regexp query\n\nregexp query è¿åä¸æ­£åè¡¨è¾¾å¼ç¸å¹éç term æå±çææ¡£ã\n\næ­£åè¡¨è¾¾å¼æ¯ä¸ç§ä½¿ç¨å ä½ç¬¦å­ç¬¦å¹éæ°æ®æ¨¡å¼çæ¹æ³ï¼ç§°ä¸ºè¿ç®ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»»ä½ä»¥ k å¼å¤´å¹¶ä»¥ y ç»å°¾çææ¡£ã .* è¿ç®ç¬¦å¹éä»»ä½é¿åº¦çä»»ä½å­ç¬¦ï¼åæ¬æ å­ç¬¦ãå¹éé¡¹å¯ä»¥åæ¬ kyãkay å kimchyã\n\nget /_search\n{\n  "query": {\n    "regexp": {\n      "user.id": {\n        "value": "k.*y",\n        "flags": "all",\n        "case_insensitive": true,\n        "max_determinized_states": 10000,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼å regexp query ä¼è¢«ç¦ç¨ã\n\n\n# 2.7. term query\n\nterm query ç¨æ¥æ¥æ¾æå®å­æ®µä¸­åå«ç»å®åè¯çææ¡£ï¼term æ¥è¯¢ä¸è¢«è§£æï¼åªææ¥è¯¢è¯åææ¡£ä¸­çè¯ç²¾ç¡®å¹éæä¼è¢«æç´¢å°ï¼åºç¨åºæ¯ä¸ºæ¥è¯¢äººåãå°åç­éè¦ç²¾åå¹éçéæ±ã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\ndelete my-index-000001\nput my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "full_text": { "type": "text" }\n    }\n  }\n}\n\n# 2. ä½¿ç¨ "quick brown foxes!" å³é®å­æ¥ "full_text" å­æ®µ\nput my-index-000001/_doc/1\n{\n  "full_text": "quick brown foxes!"\n}\n\n# 3. ä½¿ç¨ term æ¥è¯¢\nget my-index-000001/_search?pretty\n{\n  "query": {\n    "term": {\n      "full_text": "quick brown foxes!"\n    }\n  }\n}\n# å ä¸º full_text å­æ®µä¸ååå«ç¡®åç term ââ "quick brown foxes!"ï¼æä»¥ term query æç´¢ä¸å°ä»»ä½ç»æ\n\n# 4. ä½¿ç¨ match æ¥è¯¢\nget my-index-000001/_search?pretty\n{\n  "query": {\n    "match": {\n      "full_text": "quick brown foxes!"\n    }\n  }\n}\n\ndelete my-index-000001\n\n\n> â ï¸ æ³¨æï¼åºé¿å term æ¥è¯¢å¯¹ text å­æ®µä½¿ç¨æ¥è¯¢ã\n> \n> é»è®¤æåµä¸ï¼elasticsearch éå¯¹ text å­æ®µçå¼è¿è¡è§£æåè¯ï¼è¿ä¼ä½¿æ¥æ¾ text å­æ®µå¼çç²¾ç¡®å¹éåå¾å°é¾ã\n> \n> è¦æç´¢ text å­æ®µå¼ï¼éæ¹ç¨ match æ¥è¯¢ã\n\n\n# 2.8. terms query\n\nterms query ä¸ term query ç¸åï¼ä½å¯ä»¥æç´¢å¤ä¸ªå¼ã\n\nterms query æ¥è¯¢åæ°ï¼\n\n * indexï¼ç´¢å¼å\n * idï¼ææ¡£ id\n * pathï¼è¦ä»ä¸­è·åå­æ®µå¼çå­æ®µçåç§°ï¼å³æç´¢å³é®å­\n * routingï¼éå¡«ï¼ï¼è¦ä»ä¸­è·å term å¼çææ¡£çèªå®ä¹è·¯ç±å¼ãå¦æå¨ç´¢å¼ææ¡£æ¶æä¾äºèªå®ä¹è·¯ç±å¼ï¼åæ­¤åæ°æ¯å¿éçã\n\nç¤ºä¾ï¼\n\n# 1. åå»ºä¸ä¸ªç´¢å¼\ndelete my-index-000001\nput my-index-000001\n{\n  "mappings": {\n    "properties": {\n      "color": { "type": "keyword" }\n    }\n  }\n}\n\n# 2. åå¥ä¸ä¸ªææ¡£\nput my-index-000001/_doc/1\n{\n  "color": [\n    "blue",\n    "green"\n  ]\n}\n\n# 3. åå¥å¦ä¸ä¸ªææ¡£\nput my-index-000001/_doc/2\n{\n  "color": "blue"\n}\n\n# 3. ä½¿ç¨ terms query\nget my-index-000001/_search?pretty\n{\n  "query": {\n    "terms": {\n      "color": {\n        "index": "my-index-000001",\n        "id": "2",\n        "path": "color"\n      }\n    }\n  }\n}\n\ndelete my-index-000001\n\n\n\n# 2.9. type query\n\n> 7.0.0 ååºå¼\n\ntype query ç¨äºæ¥è¯¢å·ææå®ç±»åçææ¡£ã\n\nç¤ºä¾ï¼\n\nget /_search\n{\n  "query": {\n    "type": {\n      "value": "_doc"\n    }\n  }\n}\n\n\n\n# 2.10. wildcard query\n\nwildcard query å³ééç¬¦æ¥è¯¢ï¼è¿åä¸ééç¬¦æ¨¡å¼å¹éçææ¡£ã\n\n? ç¨æ¥å¹éä¸ä¸ªä»»æå­ç¬¦ï¼* ç¨æ¥å¹éé¶ä¸ªæèå¤ä¸ªå­ç¬¦ã\n\nç¤ºä¾ï¼ä»¥ä¸æç´¢è¿å user.id å­æ®µåå«ä»¥ ki å¼å¤´å¹¶ä»¥ y ç»å°¾çæ¯è¯­çææ¡£ãè¿äºå¹éé¡¹å¯ä»¥åæ¬ kiyãkity æ kimchyã\n\nget /_search\n{\n  "query": {\n    "wildcard": {\n      "user.id": {\n        "value": "ki*y",\n        "boost": 1.0,\n        "rewrite": "constant_score"\n      }\n    }\n  }\n}\n\n\n> æ³¨æï¼å¦æéç½®äºsearch.allow_expensive_queries ï¼åwildcard query ä¼è¢«ç¦ç¨ã\n\n\n# 2.11. è¯é¡¹æ¥è¯¢å®æ´ç¤ºä¾\n\ndelete products\nput products\n{\n  "settings": {\n    "number_of_shards": 1\n  }\n}\n\npost /products/_bulk\n{ "index": { "_id": 1 }}\n{ "productid" : "xhdk-a-1293-#fj3","desc":"iphone" }\n{ "index": { "_id": 2 }}\n{ "productid" : "kdke-b-9947-#kl5","desc":"ipad" }\n{ "index": { "_id": 3 }}\n{ "productid" : "jodl-x-1937-#pv7","desc":"mbp" }\n\nget /products\n\npost /products/_search\n{\n  "query": {\n    "term": {\n      "desc": {\n        //"value": "iphone"\n        "value":"iphone"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  "query": {\n    "term": {\n      "desc.keyword": {\n        //"value": "iphone"\n        //"value":"iphone"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  "query": {\n    "term": {\n      "productid": {\n        "value": "xhdk-a-1293-#fj3"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  //"explain": true,\n  "query": {\n    "term": {\n      "productid.keyword": {\n        "value": "xhdk-a-1293-#fj3"\n      }\n    }\n  }\n}\n\npost /products/_search\n{\n  "explain": true,\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "productid.keyword": "xhdk-a-1293-#fj3"\n        }\n      }\n\n    }\n  }\n}\n\n\n\n# 3. å¤åæ¥è¯¢\n\nå¤åæ¥è¯¢å°±æ¯æä¸äºç®åæ¥è¯¢ç»åå¨ä¸èµ·å®ç°æ´å¤æçæ¥è¯¢éæ±ï¼é¤æ­¤ä¹å¤ï¼å¤åæ¥è¯¢è¿å¯ä»¥æ§å¶å¦å¤ä¸ä¸ªæ¥è¯¢çè¡ä¸ºã\n\n\n# 3.1. bool query\n\nbool æ¥è¯¢å¯ä»¥æä»»æå¤ä¸ªç®åæ¥è¯¢ç»åå¨ä¸èµ·ï¼ä½¿ç¨ mustãshouldãmust_notãfilter éé¡¹æ¥è¡¨ç¤ºç®åæ¥è¯¢ä¹é´çé»è¾ï¼æ¯ä¸ªéé¡¹é½å¯ä»¥åºç° 0 æ¬¡å°å¤æ¬¡ï¼å®ä»¬çå«ä¹å¦ä¸ï¼\n\n * must ææ¡£å¿é¡»å¹é must éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ï¼ç¸å½äºé»è¾è¿ç®ç andï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * should ææ¡£å¯ä»¥å¹é should éé¡¹ä¸çæ¥è¯¢æ¡ä»¶ä¹å¯ä»¥ä¸å¹éï¼ç¸å½äºé»è¾è¿ç®ç orï¼ä¸åä¸ææ¡£ç¸å³åº¦çè¯åã\n * must_not ä¸ must ç¸åï¼å¹éè¯¥éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£ä¸ä¼è¢«è¿åï¼éè¦æ³¨æçæ¯ï¼must_not è¯­å¥ä¸ä¼å½±åè¯åï¼å®çä½ç¨åªæ¯å°ä¸ç¸å³çææ¡£æé¤ã\n * filter å must ä¸æ ·ï¼å¹é filter éé¡¹ä¸çæ¥è¯¢æ¡ä»¶çææ¡£æä¼è¢«è¿åï¼ä½æ¯ filter ä¸è¯åï¼åªèµ·å°è¿æ»¤åè½ï¼ä¸ must_not ç¸åã\n\nåè®¾è¦æ¥è¯¢ title ä¸­åå«å³é®è¯ javaï¼å¹¶ä¸ price ä¸è½é«äº 70ï¼description å¯ä»¥åå«ä¹å¯ä»¥ä¸åå«èææºçä¹¦ç±ï¼æé  bool æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n  "query": {\n    "bool": {\n      "filter": {\n        "term": {\n          "status": 1\n        }\n      },\n      "must_not": {\n        "range": {\n          "price": {\n            "gte": 70\n          }\n        }\n      },\n      "must": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "should": [\n        {\n          "match": {\n            "description": "èææº"\n          }\n        }\n      ],\n      "minimum_should_match": 1\n    }\n  }\n}\n\n\næå³å¸å°æ¥è¯¢æ´è¯¦ç»çä¿¡æ¯åè bool queryï¼ç»åæ¥è¯¢ï¼è¯¦è§£ã\n\n\n# 3.2. boosting query\n\nboosting æ¥è¯¢ç¨äºéè¦å¯¹ä¸¤ä¸ªæ¥è¯¢çè¯åè¿è¡è°æ´çåºæ¯ï¼boosting æ¥è¯¢ä¼æä¸¤ä¸ªæ¥è¯¢å°è£å¨ä¸èµ·å¹¶éä½å¶ä¸­ä¸ä¸ªæ¥è¯¢çè¯åã\n\nboosting æ¥è¯¢åæ¬ positiveãnegative å negative_boost ä¸ä¸ªé¨åï¼positive ä¸­çæ¥è¯¢è¯åä¿æä¸åï¼negative ä¸­çæ¥è¯¢ä¼éä½ææ¡£è¯åï¼negative_boost ææ negative ä¸­éä½çæå¼ãå¦ææä»¬æ³å¯¹ 2015 å¹´ä¹ååºççä¹¦éä½è¯åï¼å¯ä»¥æé ä¸ä¸ª boosting æ¥è¯¢ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"boosting": {\n\t\t\t"positive": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "python"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative": {\n\t\t\t\t"range": {\n\t\t\t\t\t"publish_time": {\n\t\t\t\t\t\t"lte": "2015-01-01"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t"negative_boost": 0.2\n\t\t}\n\t}\n}\n\n\nboosting æ¥è¯¢ä¸­æå®äºæå¶å å­ä¸º 0.2ï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸åï¼publish_time çå¼å¨ 2015-01-01 ä¹åçææ¡£å¾åä¸ºåå¾åç 0.2 åã\n\n\n# 3.3. constant_score query\n\nconstantscore query åè£ä¸ä¸ª filter queryï¼å¹¶è¿åå¹éè¿æ»¤å¨æ¥è¯¢æ¡ä»¶çææ¡£ï¼ä¸å®ä»¬çç¸å³æ§è¯åé½ç­äº _boost åæ°å¼ï¼å¯ä»¥çè§£ä¸ºåæçåºäº tf-idf æ bm25 çç¸å³ååºå®ä¸º 1.0ï¼æä»¥æç»è¯åä¸º 1.0 * boostï¼å³ç­äº boost åæ°å¼ï¼ãä¸é¢çæ¥è¯¢è¯­å¥ä¼è¿å title å­æ®µä¸­å«æå³é®è¯ elasticsearch çææ¡£ï¼ææææ¡£çè¯åé½æ¯ 1.8ï¼\n\nget books/_search\n{\n  "query": {\n    "constant_score": {\n      "filter": {\n        "term": {\n          "title": "elasticsearch"\n        }\n      },\n      "boost": 1.8\n    }\n  }\n}\n\n\n\n# 3.4. dis_max query\n\ndis_max query ä¸ bool query æä¸å®èç³»ä¹æä¸å®åºå«ï¼dis_max query æ¯æå¤å¹¶åæ¥è¯¢ï¼å¯è¿åä¸ä»»ææ¥è¯¢æ¡ä»¶å­å¥å¹éçä»»ä½ææ¡£ç±»åãä¸ bool æ¥è¯¢å¯ä»¥å°ææå¹éæ¥è¯¢çåæ°ç¸ç»åä½¿ç¨çæ¹å¼ä¸åï¼dis_max æ¥è¯¢åªä½¿ç¨æä½³å¹éæ¥è¯¢æ¡ä»¶çåæ°ãè¯·çä¸é¢çä¾å­ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"dis_max": {\n\t\t\t"tie_breaker": 0.7,\n\t\t\t"boost": 1.2,\n\t\t\t"queries": [{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 34\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t"term": {\n\t\t\t\t\t\t"age": 35\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n}\n\n\n\n# 3.5. function_score query\n\nfunction_score query å¯ä»¥ä¿®æ¹æ¥è¯¢çææ¡£å¾åï¼è¿ä¸ªæ¥è¯¢å¨æäºæåµä¸éå¸¸æç¨ï¼æ¯å¦éè¿è¯åå½æ°è®¡ç®ææ¡£å¾åä»£ä»·è¾é«ï¼å¯ä»¥æ¹ç¨è¿æ»¤å¨å èªå®ä¹è¯åå½æ°çæ¹å¼æ¥åä»£ä¼ ç»çè¯åæ¹å¼ã\n\nä½¿ç¨ function_score queryï¼ç¨æ·éè¦å®ä¹ä¸ä¸ªæ¥è¯¢åä¸è³å¤ä¸ªè¯åå½æ°ï¼è¯åå½æ°ä¼å¯¹æ¥è¯¢å°çæ¯ä¸ªææ¡£åå«è®¡ç®å¾åã\n\nä¸é¢è¿æ¡æ¥è¯¢è¯­å¥ä¼è¿å books ç´¢å¼ä¸­çææææ¡£ï¼ææ¡£çæå¤§å¾åä¸º 5ï¼æ¯ä¸ªææ¡£çå¾åéæºçæï¼æéçè®¡ç®æ¨¡å¼ä¸ºç¸ä¹æ¨¡å¼ã\n\nget books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match all": {}\n      },\n      "boost": "5",\n      "random_score": {},\n      "boost_mode": "multiply"\n    }\n  }\n}\n\n\nä½¿ç¨èæ¬èªå®ä¹è¯åå¬å¼ï¼è¿éæ price å¼çååä¹ä¸å¼æ¹ä½ä¸ºæ¯ä¸ªææ¡£çå¾åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n  "query": {\n    "function_score": {\n      "query": {\n        "match": {\n          "title": "java"\n        }\n      },\n      "script_score": {\n        "inline": "math.sqrt(doc[\'price\'].value/10)"\n      }\n    }\n  }\n}\n\n\nå³äº function_score çæ´å¤è¯¦ç»åå®¹è¯·æ¥ç elasticsearch function_score æ¥è¯¢æå¼ºè¯¦è§£ã\n\n\n# 3.6. indices query\n\nindices query éç¨äºéè¦å¨å¤ä¸ªç´¢å¼ä¹é´è¿è¡æ¥è¯¢çåºæ¯ï¼å®åè®¸æå®ä¸ä¸ªç´¢å¼åå­åè¡¨ååé¨æ¥è¯¢ãindices query ä¸­æ query å no_match_query ä¸¤é¨åï¼query ä¸­ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¸­çææ¡£ï¼no_match_query ä¸­çæ¥è¯¢æ¡ä»¶ç¨äºæç´¢æå®ç´¢å¼åè¡¨ä¹å¤çææ¡£ãä¸é¢çæ¥è¯¢è¯­å¥å®ç°äºæç´¢ç´¢å¼ booksãbooks2 ä¸­ title å­æ®µåå«å³é®å­ javascriptï¼å¶ä»ç´¢å¼ä¸­ title å­æ®µåå« basketball çææ¡£ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"indices": {\n\t\t\t"indices": ["books", "books2"],\n\t\t\t"query": {\n\t\t\t\t"match": {\n\t\t\t\t\t"title": "javascript"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"no_match_query": {\n\t\t\t\t"term": {\n\t\t\t\t\t"title": "basketball"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 4. åµå¥æ¥è¯¢\n\nå¨ elasticsearch è¿æ ·çåå¸å¼ç³»ç»ä¸­æ§è¡å¨ sql é£æ ¼çè¿æ¥æ¥è¯¢ä»£ä»·æè´µï¼æ¯ä¸å¯è¡çãç¸åºå°ï¼ä¸ºäºå®ç°æ°´å¹³è§æ¨¡å°æ©å±ï¼elasticsearch æä¾äºä»¥ä¸ä¸¤ç§å½¢å¼ç joinï¼\n\n * nested queryï¼åµå¥æ¥è¯¢ï¼\n   \n   ææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ã\n\n * has_child queryï¼æå­æ¥è¯¢ï¼å has_parent queryï¼æç¶æ¥è¯¢ï¼\n   \n   ç¶å­å³ç³»å¯ä»¥å­å¨åä¸ªçç´¢å¼çä¸¤ä¸ªç±»åçææ¡£ä¹é´ãhas_child æ¥è¯¢å°è¿åå¶å­ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çç¶ææ¡£ï¼è has_parent åè¿åå¶ç¶ææ¡£è½æ»¡è¶³ç¹å®æ¥è¯¢çå­ææ¡£ã\n\n\n# 4.1. nested query\n\nææ¡£ä¸­å¯è½åå«åµå¥ç±»åçå­æ®µï¼è¿äºå­æ®µç¨æ¥ç´¢å¼ä¸äºæ°ç»å¯¹è±¡ï¼æ¯ä¸ªå¯¹è±¡é½å¯ä»¥ä½ä¸ºä¸æ¡ç¬ç«çææ¡£è¢«æ¥è¯¢åºæ¥ï¼ç¨åµå¥æ¥è¯¢ï¼ã\n\nput /my_index\n{\n\t"mappings": {\n\t\t"type1": {\n\t\t\t"properties": {\n\t\t\t\t"obj1": {\n\t\t\t\t\t"type": "nested"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 4.2. has_child query\n\nææ¡£çç¶å­å³ç³»åå»ºç´¢å¼æ¶å¨æ å°ä¸­å£°æï¼è¿éä»¥åå·¥ï¼employeeï¼åå·¥ä½åå¸ï¼branchï¼ä¸ºä¾ï¼å®ä»¬å±äºä¸åçç±»åï¼ç¸å½äºæ°æ®åºä¸­çä¸¤å¼ è¡¨ï¼å¦ææ³æåå·¥åä»ä»¬å·¥ä½çåå¸å³èèµ·æ¥ï¼éè¦åè¯ elasticsearch ææ¡£ä¹é´çç¶å­å³ç³»ï¼è¿é employee æ¯ child typeï¼branch æ¯ parent typeï¼å¨æ å°ä¸­å£°æï¼æ§è¡å½ä»¤ï¼\n\nput /company\n{\n\t"mappings": {\n\t\t"branch": {},\n\t\t"employee": {\n\t\t\t"parent": { "type": "branch" }\n\t\t}\n\t}\n}\n\n\nä½¿ç¨ bulk api ç´¢å¼ branch ç±»åä¸çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\npost company/branch/_bulk\n{ "index": { "_id": "london" }}\n{ "name": "london westminster","city": "london","country": "uk" }\n{ "index": { "_id": "liverpool" }}\n{ "name": "liverpool central","city": "liverpool","country": "uk" }\n{ "index": { "_id": "paris" }}\n{ "name": "champs elysees","city": "paris","country": "france" }\n\n\næ·»å åå·¥æ°æ®ï¼\n\npost company/employee/_bulk\n{ "index": { "_id": 1,"parent":"london" }}\n{ "name": "alice smith","dob": "1970-10-24","hobby": "hiking" }\n{ "index": { "_id": 2,"parent":"london" }}\n{ "name": "mark tomas","dob": "1982-05-16","hobby": "diving" }\n{ "index": { "_id": 3,"parent":"liverpool" }}\n{ "name": "barry smith","dob": "1979-04-01","hobby": "hiking" }\n{ "index": { "_id": 4,"parent":"paris" }}\n{ "name": "adrien grand","dob": "1987-05-11","hobby": "horses" }\n\n\néè¿å­ææ¡£æ¥è¯¢ç¶ææ¡£è¦ä½¿ç¨ has_child æ¥è¯¢ãä¾å¦ï¼æç´¢ 1980 å¹´ä»¥ååºççåå·¥æå¨çåæ¯æºæï¼employee ä¸­ 1980 å¹´ä»¥ååºççæ mark thomas å adrien grandï¼ä»ä»¬åå«å¨ london å parisï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nget company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"query": {\n\t\t\t\t"range": { "dob": { "gte": "1980-01-01" } }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næç´¢åªäºæºæä¸­æåä¸º âalice smithâ çåå·¥ï¼å ä¸ºä½¿ç¨ match æ¥è¯¢ï¼ä¼è§£æä¸º âaliceâ å âsmithâï¼æä»¥ alice smith å barry smith æå¨çæºæä¼è¢«å¹éï¼æ§è¡ä»¥ä¸æ¥è¯¢å½ä»¤è¿è¡éªè¯ï¼\n\nget company/branch/_search\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"score_mode": "max",\n\t\t\t"query": {\n\t\t\t\t"match": { "name": "alice smith" }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå¯ä»¥ä½¿ç¨ min_children æå®å­ææ¡£çæå°ä¸ªæ°ãä¾å¦ï¼æç´¢æå°å«æä¸¤ä¸ª employee çæºæï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nget company/branch/_search?pretty\n{\n\t"query": {\n\t\t"has_child": {\n\t\t\t"type": "employee",\n\t\t\t"min_children": 2,\n\t\t\t"query": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 4.3. has_parent query\n\néè¿ç¶ææ¡£æ¥è¯¢å­ææ¡£ä½¿ç¨ has_parent æ¥è¯¢ãæ¯å¦ï¼æç´¢åªäº employee å·¥ä½å¨ ukï¼æ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nget company/employee/_search\n{\n\t"query": {\n\t\t"has_parent": {\n\t\t\t"parent_type": "branch",\n\t\t\t"query": {\n\t\t\t\t"match": { "country": "uk }\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 5. ä½ç½®æ¥è¯¢\n\nelasticsearch å¯ä»¥å¯¹å°çä½ç½®ç¹ geo_point ç±»ååå°çä½ç½®å½¢ç¶ geo_shape ç±»åçæ°æ®è¿è¡æç´¢ãä¸ºäºå­¦ä¹ æ¹ä¾¿ï¼è¿éåå¤ä¸äºåå¸çå°çåæ ä½ä¸ºæµè¯æ°æ®ï¼æ¯ä¸æ¡ææ¡£é½åå«åå¸åç§°åå°çåæ è¿ä¸¤ä¸ªå­æ®µï¼è¿éçåæ ç¹åçæ¯åä¸ªåå¸ä¸­å¿çä¸ä¸ªä½ç½®ãé¦åæä¸é¢çåå®¹ä¿å­å° geo.json æä»¶ä¸­ï¼\n\n{"index":{ "_index":"geo","_type":"city","_id":"1" }}\n{"name":"åäº¬","location":"39.9088145109,116.3973999023"}\n{"index":{ "_index":"geo","_type":"city","_id": "2" }}\n{"name":"ä¹é²æ¨é½","location":"43.8266300000,87.6168800000"}\n{"index":{ "_index":"geo","_type":"city","_id":"3" }}\n{"name":"è¥¿å®","location":"34.3412700000,108.9398400000"}\n{"index":{ "_index":"geo","_type":"city","_id":"4" }}\n{"name":"éå·","location":"34.7447157466,113.6587142944"}\n{"index":{ "_index":"geo","_type":"city","_id":"5" }}\n{"name":"æ­å·","location":"30.2294080260,120.1492309570"}\n{"index":{ "_index":"geo","_type":"city","_id":"6" }}\n{"name":"æµå","location":"36.6518400000,117.1200900000"}\n\n\nåå»ºä¸ä¸ªç´¢å¼å¹¶è®¾ç½®æ å°ï¼\n\nput geo\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_point"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nç¶åæ§è¡æ¹éå¯¼å¥å½ä»¤ï¼\n\ncurl -xpost "http://localhost:9200/_bulk?pretty" --data-binary @geo.json\n\n\n\n# 5.1. geo_distance query\n\ngeo_distance query å¯ä»¥æ¥æ¾å¨ä¸ä¸ªä¸­å¿ç¹æå®èå´åçå°çç¹ææ¡£ãä¾å¦ï¼æ¥æ¾è·ç¦»å¤©æ´¥ 200km ä»¥åçåå¸ï¼æç´¢ç»æä¸­ä¼è¿ååäº¬ï¼å½ä»¤å¦ä¸ï¼\n\nget geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_distance": {\n\t\t\t\t\t"distance": "200km",\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"lat": 39.0851000000,\n\t\t\t\t\t\t"lon": 117.1993700000\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næååå¸ç¦»åäº¬çè·ç¦»æåºï¼\n\nget geo/_search\n{\n  "query": {\n    "match_all": {}\n  },\n  "sort": [{\n    "_geo_distance": {\n      "location": "39.9088145109,116.3973999023",\n      "unit": "km",\n      "order": "asc",\n      "distance_type": "plane"\n    }\n  }]\n}\n\n\nå¶ä¸­ location å¯¹åºçç»çº¬åº¦å­æ®µï¼unit ä¸º km è¡¨ç¤ºå°è·ç¦»ä»¥ km ä¸ºåä½åå¥å°æ¯ä¸ªè¿åç»æç sort é®ä¸­ï¼distance_type ä¸º plane è¡¨ç¤ºä½¿ç¨å¿«éä½ç²¾åº¦ç¥å·®ç plane è®¡ç®æ¹å¼ã\n\n\n# 5.2. geo_bounding_box query\n\ngeo_bounding_box query ç¨äºæ¥æ¾è½å¥æå®çç©å½¢åçå°çåæ ãæ¥è¯¢ä¸­ç±ä¸¤ä¸ªç¹ç¡®å®ä¸ä¸ªç©å½¢ï¼ç¶åå¨ç©å½¢åºååæ¥è¯¢å¹éçææ¡£ã\n\nget geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_bounding_box": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"top_left": {\n\t\t\t\t\t\t\t"lat": 38.4864400000,\n\t\t\t\t\t\t\t"lon": 106.2324800000\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"bottom_right": {\n\t\t\t\t\t\t\t"lat": 28.6820200000,\n\t\t\t\t\t\t\t"lon": 115.8579400000\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 5.3. geo_polygon query\n\ngeo_polygon query ç¨äºæ¥æ¾å¨æå®å¤è¾¹å½¢åçå°çç¹ãä¾å¦ï¼å¼åæµ©ç¹ãéåºãä¸æµ·ä¸å°ç»æä¸ä¸ªä¸è§å½¢ï¼æ¥è¯¢ä½ç½®å¨è¯¥ä¸è§å½¢åºååçåå¸ï¼å½ä»¤å¦ä¸ï¼\n\nget geo/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t}\n\t\t},\n\t\t"filter": {\n\t\t\t"geo_polygon": {\n\t\t\t\t"location": {\n\t\t\t\t\t"points": [{\n\t\t\t\t\t\t"lat": 40.8414900000,\n\t\t\t\t\t\t"lon": 111.7519900000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 29.5647100000,\n\t\t\t\t\t\t"lon": 106.5507300000\n\t\t\t\t\t}, {\n\t\t\t\t\t\t"lat": 31.2303700000,\n\t\t\t\t\t\t"lon": 121.4737000000\n\t\t\t\t\t}]\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 5.4. geo_shape query\n\ngeo_shape query ç¨äºæ¥è¯¢ geo_shape ç±»åçå°çæ°æ®ï¼å°çå½¢ç¶ä¹é´çå³ç³»æç¸äº¤ãåå«ãä¸ç¸äº¤ä¸ç§ãåå»ºä¸ä¸ªæ°çç´¢å¼ç¨äºæµè¯ï¼å¶ä¸­ location å­æ®µçç±»åè®¾ä¸º geo_shape ç±»åã\n\nput geoshape\n{\n\t"mappings": {\n\t\t"city": {\n\t\t\t"properties": {\n\t\t\t\t"name": {\n\t\t\t\t\t"type": "keyword"\n\t\t\t\t},\n\t\t\t\t"location": {\n\t\t\t\t\t"type": "geo_shape"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nå³äºç»çº¬åº¦çé¡ºåºè¿éåä¸ä¸ªè¯´æï¼geo_point ç±»åçå­æ®µçº¬åº¦å¨åç»åº¦å¨åï¼ä½æ¯å¯¹äº geo_shape ç±»åä¸­çç¹ï¼æ¯ç»åº¦å¨åçº¬åº¦å¨åï¼è¿ä¸ç¹éè¦ç¹å«æ³¨æã\n\næè¥¿å®åéå·è¿æççº¿åå¥ç´¢å¼ï¼\n\npost geoshape/city/1\n{\n\t"name": "è¥¿å®-éå·",\n\t"location": {\n\t\t"type": "linestring",\n\t\t"coordinates": [\n\t\t\t[108.9398400000, 34.3412700000],\n\t\t\t[113.6587142944, 34.7447157466]\n\t\t]\n\t}\n}\n\n\næ¥è¯¢åå«å¨ç±é¶å·ååæä½ä¸ºå¯¹è§çº¿ä¸çç¹ç»æçç©å½¢çå°çå½¢ç¶ï¼ç±äºè¥¿å®åéå·ç»æçç´çº¿è½å¨è¯¥ç©å½¢åºååï¼å æ­¤å¯ä»¥è¢«æ¥è¯¢å°ãå½ä»¤å¦ä¸ï¼\n\nget geoshape/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"geo_shape": {\n\t\t\t\t\t"location": {\n\t\t\t\t\t\t"shape": {\n\t\t\t\t\t\t\t"type": "envelope",\n\t\t\t\t\t\t\t"coordinates": [\n\t\t\t\t\t\t\t\t[106.23248, 38.48644],\n\t\t\t\t\t\t\t\t[115.85794, 28.68202]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\t"relation": "within"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n\n# 6. ç¹æ®æ¥è¯¢\n\n\n# 6.1. more_like_this query\n\nmore_like_this query å¯ä»¥æ¥è¯¢åæä¾ææ¬ç±»ä¼¼çææ¡£ï¼éå¸¸ç¨äºè¿ä¼¼ææ¬çæ¨èç­åºæ¯ãæ¥è¯¢å½ä»¤å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"more_like_ this": {\n\t\t\t"fields": ["title", "description"],\n\t\t\t"like": "java virtual machine",\n\t\t\t"min_term_freq": 1,\n\t\t\t"max_query_terms": 12\n\t\t}\n\t}\n}\n\n\nå¯éçåæ°ååå¼è¯´æå¦ä¸ï¼\n\n * fields è¦å¹éçå­æ®µï¼é»è®¤æ¯ _all å­æ®µã\n * like è¦å¹éçææ¬ã\n * min_term_freq ææ¡£ä¸­è¯é¡¹çæä½é¢çï¼é»è®¤æ¯ 2ï¼ä½äºæ­¤é¢ççææ¡£ä¼è¢«å¿½ç¥ã\n * max_query_terms query ä¸­è½åå«çæå¤§è¯é¡¹æ°ç®ï¼é»è®¤ä¸º 25ã\n * min_doc_freq æå°çææ¡£é¢çï¼é»è®¤ä¸º 5ã\n * max_doc_freq æå¤§ææ¡£é¢çã\n * min_word length åè¯çæå°é¿åº¦ã\n * max_word length åè¯çæå¤§é¿åº¦ã\n * stop_words åç¨è¯åè¡¨ã\n * analyzer åè¯å¨ã\n * minimum_should_match ææ¡£åºå¹éçæå°è¯é¡¹æ°ï¼é»è®¤ä¸º query åè¯åè¯é¡¹æ°ç 30%ã\n * boost terms è¯é¡¹çæéã\n * include æ¯å¦æè¾å¥ææ¡£ä½ä¸ºç»æè¿åã\n * boost æ´ä¸ª query çæéï¼é»è®¤ä¸º 1.0ã\n\n\n# 6.2. script query\n\nelasticsearch æ¯æä½¿ç¨èæ¬è¿è¡æ¥è¯¢ãä¾å¦ï¼æ¥è¯¢ä»·æ ¼å¤§äº 180 çææ¡£ï¼å½ä»¤å¦ä¸ï¼\n\nget books/_search\n{\n  "query": {\n    "script": {\n      "script": {\n        "inline": "doc[\'price\'].value > 180",\n        "lang": "painless"\n      }\n    }\n  }\n}\n\n\n\n# 6.3. percolate query\n\nä¸è¬æåµä¸ï¼æä»¬æ¯åæææ¡£åå¥å° elasticsearch ä¸­ï¼éè¿æ¥è¯¢è¯­å¥å¯¹ææ¡£è¿è¡æç´¢ãpercolate query åæ¯åå¶éèè¡ä¹çåæ³ï¼å®ä¼åæ³¨åæ¥è¯¢æ¡ä»¶ï¼æ ¹æ®ææ¡£æ¥æ¥è¯¢ queryãä¾å¦ï¼å¨ my-index ç´¢å¼ä¸­æä¸ä¸ª laptop ç±»åï¼ææ¡£æ price å name ä¸¤ä¸ªå­æ®µï¼å¨æ å°ä¸­å£°æä¸ä¸ª percolator ç±»åç queryï¼å½ä»¤å¦ä¸ï¼\n\nput my-index\n{\n\t"mappings": {\n\t\t"laptop": {\n\t\t\t"properties": {\n\t\t\t\t"price": { "type": "long" },\n\t\t\t\t"name": { "type": "text" }\n\t\t\t},\n\t\t\t"queries": {\n\t\t\t\t"properties": {\n\t\t\t\t\t"query": { "type": "percolator" }\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n\næ³¨åä¸ä¸ª bool queryï¼bool query ä¸­åå«ä¸ä¸ª range queryï¼è¦æ± price å­æ®µçåå¼å°äºç­äº 10000ï¼å¹¶ä¸ name å­æ®µä¸­å«æå³é®è¯ macbookï¼\n\nput /my-index/queries/1?refresh\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": [{\n\t\t\t\t"range": { "price": { "lte": 10000 } }\n\t\t\t}, {\n\t\t\t\t"match": { "name": "macbook" }\n\t\t\t}]\n\t\t}\n\t}\n}\n\n\néè¿ææ¡£æ¥è¯¢ queryï¼\n\nget /my-index/_search\n{\n\t"query": {\n\t\t"percolate": {\n\t\t\t"field": "query",\n\t\t\t"document_type": "laptop",\n\t\t\t"document": {\n\t\t\t\t"price": 9999,\n\t\t\t\t"name": "macbook pro on sale"\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nææ¡£ç¬¦å query ä¸­çæ¡ä»¶ï¼è¿åç»æä¸­å¯ä»¥æ¥å°ä¸æä¸­æ³¨åç bool queryãpercolate query çè¿ç§ç¹æ§éç¨äºæ°æ®åç±»ãæ°æ®è·¯ç±ãäºä»¶çæ§åé¢è­¦ç­åºæ¯ã',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch é«äº®æç´¢åæ¾ç¤º",frontmatter:{title:"Elasticsearch é«äº®æç´¢åæ¾ç¤º",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","é«äº®"],permalink:"/pages/4ae35a/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/06.Elasticsearch%E9%AB%98%E4%BA%AE.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/06.Elasticsearché«äº®.md",key:"v-d28308f2",path:"/pages/4ae35a/",headers:[{level:2,title:"1. é«äº®åæ°",slug:"_1-é«äº®åæ°",normalizedTitle:"1. é«äº®åæ°",charIndex:187},{level:2,title:"2. èªå®ä¹é«äº®çæ®µ",slug:"_2-èªå®ä¹é«äº®çæ®µ",normalizedTitle:"2. èªå®ä¹é«äº®çæ®µ",charIndex:2382},{level:2,title:"3. å¤å­æ®µé«äº®",slug:"_3-å¤å­æ®µé«äº®",normalizedTitle:"3. å¤å­æ®µé«äº®",charIndex:2734},{level:2,title:"4. é«äº®æ§è½åæ",slug:"_4-é«äº®æ§è½åæ",normalizedTitle:"4. é«äº®æ§è½åæ",charIndex:3120}],headersStr:"1. é«äº®åæ° 2. èªå®ä¹é«äº®çæ®µ 3. å¤å­æ®µé«äº® 4. é«äº®æ§è½åæ",content:'# Elasticsearch é«äº®æç´¢åæ¾ç¤º\n\nElasticsearch çé«äº®ï¼highlightï¼å¯ä»¥è®©æ¨ä»æç´¢ç»æä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µä¸­è·åçªåºæ¾ç¤ºçæè¦ï¼ä»¥ä¾¿åç¨æ·æ¾ç¤ºæ¥è¯¢å¹éçä½ç½®ãå½æ¨è¯·æ±çªåºæ¾ç¤ºï¼å³é«äº®ï¼æ¶ï¼ååºç»æç highlight å­æ®µä¸­åæ¬é«äº®çå­æ®µåé«äº®ççæ®µãElasticsearch é»è®¤ä¼ç¨ <em></em> æ ç­¾æ è®°å³é®å­ã\n\n\n# 1. é«äº®åæ°\n\nES æä¾äºå¦ä¸é«äº®åæ°ï¼\n\nåæ°                        è¯´æ\nboundary_chars            åå«æ¯ä¸ªè¾¹çå­ç¬¦çå­ç¬¦ä¸²ãé»è®¤ä¸º,! ?\\ \\ nã\nboundary_max_scan         æ«æè¾¹çå­ç¬¦çè·ç¦»ãé»è®¤ä¸º 20ã\nboundary_scanner          æå®å¦ä½åå²çªåºæ¾ç¤ºççæ®µï¼æ¯æ charsãsentenceãword ä¸ç§æ¹å¼ã\nboundary_scanner_locale   ç¨æ¥è®¾ç½®æç´¢åç¡®å®åè¯è¾¹ççæ¬å°åè®¾ç½®ï¼æ­¤åæ°ä½¿ç¨è¯­è¨æ è®°çå½¢å¼ï¼âen-USâ, âfr-FRâ, âja-JPâï¼\nencoder                   è¡¨ç¤ºä»£ç æ®µåºè¯¥æ¯ HTML ç¼ç ç:é»è®¤(æ ç¼ç )è¿æ¯ HTML (HTML-è½¬ä¹ä»£ç æ®µææ¬ï¼ç¶åæå¥é«äº®æ è®°)\nfields                    æå®æ£ç´¢é«äº®æ¾ç¤ºçå­æ®µãå¯ä»¥ä½¿ç¨ééç¬¦æ¥æå®å­æ®µãä¾å¦ï¼å¯ä»¥æå® comment**æ¥è·åä»¥\n                          comment*å¼å¤´çææææ¬åå³é®å­å­æ®µçé«äº®æ¾ç¤ºã\nforce_source              æ ¹æ®æºé«äº®æ¾ç¤ºãé»è®¤å¼ä¸º falseã\nfragmenter                æå®ææ¬åºå¦ä½å¨çªåºæ¾ç¤ºçæ®µä¸­æå:æ¯æåæ° simple æè spanã\nfragment_offset           æ§å¶è¦å¼å§çªåºæ¾ç¤ºçç©ºç½ãä»å¨ä½¿ç¨ fvh highlighter æ¶ææã\nfragment_size             å­ç¬¦ä¸­çªåºæ¾ç¤ºççæ®µçå¤§å°ãé»è®¤ä¸º 100ã\nhighlight_query           çªåºæ¾ç¤ºæç´¢æ¥è¯¢ä¹å¤çå¶ä»æ¥è¯¢çå¹éé¡¹ãè¿å¨ä½¿ç¨éæåæ¥è¯¢æ¶ç¹å«æç¨ï¼å ä¸ºé»è®¤æåµä¸é«äº®æ¾ç¤ºä¸ä¼èèè¿äºé®é¢ã\nmatched_fields            ç»åå¤ä¸ªå¹éç»æä»¥çªåºæ¾ç¤ºåä¸ªå­æ®µï¼å¯¹äºä½¿ç¨ä¸åæ¹å¼åæåä¸å­ç¬¦ä¸²çå¤å­æ®µãææç matched_fields å¿é¡»å°\n                          term_vector è®¾ç½®ä¸º\n                          with_positions_offsetsï¼ä½æ¯åªæå°å¹éé¡¹ç»åå°çå­æ®µæä¼è¢«å è½½ï¼å æ­¤åªæå° store è®¾ç½®ä¸º\n                          yes æè½ä½¿è¯¥å­æ®µåçãåªéç¨äº fvh highlighterã\nno_match_size             å¦ææ²¡æè¦çªåºæ¾ç¤ºçå¹éçæ®µï¼åå¸æä»å­æ®µå¼å¤´è¿åçææ¬éãé»è®¤ä¸º 0(ä¸è¿åä»»ä½åå®¹)ã\nnumber_of_fragments       è¿åççæ®µçæå¤§æ°éãå¦æçæ®µçæ°éè®¾ç½®ä¸º\n                          0ï¼åä¸ä¼è¿åä»»ä½çæ®µãç¸åï¼çªåºæ¾ç¤ºå¹¶è¿åæ´ä¸ªå­æ®µåå®¹ãå½éè¦çªåºæ¾ç¤ºç­ææ¬(å¦æ é¢æå°å)ï¼ä½ä¸éè¦åæ®µæ¶ï¼ä½¿ç¨æ­¤éç½®éå¸¸æ¹ä¾¿ãå¦æ\n                          number_of_fragments ä¸º 0ï¼åå¿½ç¥ fragment_sizeãé»è®¤ä¸º 5ã\norder                     è®¾ç½®ä¸º score\n                          æ¶ï¼æåæ°å¯¹çªåºæ¾ç¤ºççæ®µè¿è¡æåºãé»è®¤æåµä¸ï¼çæ®µå°æç§å®ä»¬å¨å­æ®µä¸­åºç°çé¡ºåºè¾åº(order:none)ãå°æ­¤éé¡¹è®¾ç½®ä¸º\n                          score å°é¦åè¾åºæç¸å³ççæ®µãæ¯ä¸ªé«äº®åºç¨èªå·±çé»è¾æ¥è®¡ç®ç¸å³æ§å¾åã\nphrase_limit              æ§å¶ææ¡£ä¸­æèèçå¹éç­è¯­çæ°éãé²æ­¢ fvh highlighter\n                          åæå¤ªå¤çç­è¯­åæ¶èå¤ªå¤çåå­ãæé«éå¶ä¼å¢å æ¥è¯¢æ¶é´å¹¶æ¶èæ´å¤åå­ãé»è®¤ä¸º 256ã\npre_tags                  ä¸ post_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç HTML\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\npost_tags                 ä¸ pre_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç HTML\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\nrequire_field_match       é»è®¤æåµä¸ï¼åªçªåºæ¾ç¤ºåå«æ¥è¯¢å¹éçå­æ®µãå° require_field_match è®¾ç½®ä¸º false\n                          ä»¥çªåºæ¾ç¤ºææå­æ®µãé»è®¤å¼ä¸º trueã\ntags_schema               è®¾ç½®ä¸ºä½¿ç¨åç½®æ è®°æ¨¡å¼çæ ·å¼ã\ntype                      ä½¿ç¨çé«äº®æ¨¡å¼ï¼å¯éé¡¹ä¸º**unifiedãplainæfvh**ãé»è®¤ä¸º unifiedã\n\n\n# 2. èªå®ä¹é«äº®çæ®µ\n\nå¦ææä»¬æ³ä½¿ç¨èªå®ä¹æ ç­¾ï¼å¨é«äº®å±æ§ä¸­ç»éè¦é«äº®çå­æ®µå ä¸ pre_tags å post_tags å³å¯ãä¾å¦ï¼æç´¢ title å­æ®µä¸­åå«å³é®è¯ javascript çä¹¦ç±å¹¶ä½¿ç¨èªå®ä¹ HTML æ ç­¾é«äº®å³é®è¯ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "fields": {\n      "title": {\n        "pre_tags": ["<strong>"],\n        "post_tags": ["</strong>"]\n      }\n    }\n  }\n}\n\n\n\n# 3. å¤å­æ®µé«äº®\n\nå³äºæç´¢é«äº®ï¼è¿éè¦ææ¡å¦ä½è®¾ç½®å¤å­æ®µæç´¢é«äº®ãæ¯å¦ï¼æç´¢ title å­æ®µçæ¶åï¼æä»¬ææ description å­æ®µä¸­çå³é®å­ä¹å¯ä»¥é«äº®ï¼è¿æ¶åå°±éè¦æ require_field_match å±æ§çåå¼è®¾ç½®ä¸º fasleãrequire_field_match çé»è®¤å¼ä¸º trueï¼åªä¼é«äº®å¹éçå­æ®µãå¤å­æ®µé«äº®çæ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "require_field_match": false,\n    "fields": {\n      "title": {},\n      "description": {}\n    }\n  }\n}\n\n\n\n# 4. é«äº®æ§è½åæ\n\nElasticsearch æä¾äºä¸ç§é«äº®å¨ï¼åå«æ¯é»è®¤ç highlighter é«äº®å¨ãpostings-highlighter é«äº®å¨å fast-vector-highlighter é«äº®å¨ã\n\né»è®¤ç highlighter æ¯æåºæ¬çé«äº®å¨ãhighlighter é«äº®å¨å®ç°é«äº®åè½éè¦å¯¹ _source ä¸­ä¿å­çåå§ææ¡£è¿è¡äºæ¬¡åæï¼å¶éåº¦å¨ä¸ç§é«äº®å¨éææ¢ï¼ä¼ç¹æ¯ä¸éè¦é¢å¤çå­å¨ç©ºé´ã\n\npostings-highlighter é«äº®å¨å®ç°é«äº®åè½ä¸éè¦äºæ¬¡åæï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® index_options åæ°çåå¼ä¸º offsetsï¼å³ä¿å­å³é®è¯çåç§»éï¼éåº¦å¿«äºé»è®¤ç highlighter é«äº®å¨ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ postings-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nPUT /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "index_options": "offsets"\n        }\n      }\n    }\n  }\n}\n\n\nfast-vector-highlighter é«äº®å¨å®ç°é«äº®åè½éåº¦æå¿«ï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® term_vector åæ°çåå¼ä¸º with_positions_offsetsï¼å³ä¿å­å³é®è¯çä½ç½®ååç§»ä¿¡æ¯ï¼å ç¨çå­å¨ç©ºé´æå¤§ï¼æ¯å¸åçç©ºé´æ¢æ¶é´çåæ³ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ fast-vector-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nPUT /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "term_vector": "with_positions_offsets"\n        }\n      }\n    }\n  }\n}\n',normalizedContent:'# elasticsearch é«äº®æç´¢åæ¾ç¤º\n\nelasticsearch çé«äº®ï¼highlightï¼å¯ä»¥è®©æ¨ä»æç´¢ç»æä¸­çä¸ä¸ªæå¤ä¸ªå­æ®µä¸­è·åçªåºæ¾ç¤ºçæè¦ï¼ä»¥ä¾¿åç¨æ·æ¾ç¤ºæ¥è¯¢å¹éçä½ç½®ãå½æ¨è¯·æ±çªåºæ¾ç¤ºï¼å³é«äº®ï¼æ¶ï¼ååºç»æç highlight å­æ®µä¸­åæ¬é«äº®çå­æ®µåé«äº®ççæ®µãelasticsearch é»è®¤ä¼ç¨ <em></em> æ ç­¾æ è®°å³é®å­ã\n\n\n# 1. é«äº®åæ°\n\nes æä¾äºå¦ä¸é«äº®åæ°ï¼\n\nåæ°                        è¯´æ\nboundary_chars            åå«æ¯ä¸ªè¾¹çå­ç¬¦çå­ç¬¦ä¸²ãé»è®¤ä¸º,! ?\\ \\ nã\nboundary_max_scan         æ«æè¾¹çå­ç¬¦çè·ç¦»ãé»è®¤ä¸º 20ã\nboundary_scanner          æå®å¦ä½åå²çªåºæ¾ç¤ºççæ®µï¼æ¯æ charsãsentenceãword ä¸ç§æ¹å¼ã\nboundary_scanner_locale   ç¨æ¥è®¾ç½®æç´¢åç¡®å®åè¯è¾¹ççæ¬å°åè®¾ç½®ï¼æ­¤åæ°ä½¿ç¨è¯­è¨æ è®°çå½¢å¼ï¼âen-usâ, âfr-frâ, âja-jpâï¼\nencoder                   è¡¨ç¤ºä»£ç æ®µåºè¯¥æ¯ html ç¼ç ç:é»è®¤(æ ç¼ç )è¿æ¯ html (html-è½¬ä¹ä»£ç æ®µææ¬ï¼ç¶åæå¥é«äº®æ è®°)\nfields                    æå®æ£ç´¢é«äº®æ¾ç¤ºçå­æ®µãå¯ä»¥ä½¿ç¨ééç¬¦æ¥æå®å­æ®µãä¾å¦ï¼å¯ä»¥æå® comment**æ¥è·åä»¥\n                          comment*å¼å¤´çææææ¬åå³é®å­å­æ®µçé«äº®æ¾ç¤ºã\nforce_source              æ ¹æ®æºé«äº®æ¾ç¤ºãé»è®¤å¼ä¸º falseã\nfragmenter                æå®ææ¬åºå¦ä½å¨çªåºæ¾ç¤ºçæ®µä¸­æå:æ¯æåæ° simple æè spanã\nfragment_offset           æ§å¶è¦å¼å§çªåºæ¾ç¤ºçç©ºç½ãä»å¨ä½¿ç¨ fvh highlighter æ¶ææã\nfragment_size             å­ç¬¦ä¸­çªåºæ¾ç¤ºççæ®µçå¤§å°ãé»è®¤ä¸º 100ã\nhighlight_query           çªåºæ¾ç¤ºæç´¢æ¥è¯¢ä¹å¤çå¶ä»æ¥è¯¢çå¹éé¡¹ãè¿å¨ä½¿ç¨éæåæ¥è¯¢æ¶ç¹å«æç¨ï¼å ä¸ºé»è®¤æåµä¸é«äº®æ¾ç¤ºä¸ä¼èèè¿äºé®é¢ã\nmatched_fields            ç»åå¤ä¸ªå¹éç»æä»¥çªåºæ¾ç¤ºåä¸ªå­æ®µï¼å¯¹äºä½¿ç¨ä¸åæ¹å¼åæåä¸å­ç¬¦ä¸²çå¤å­æ®µãææç matched_fields å¿é¡»å°\n                          term_vector è®¾ç½®ä¸º\n                          with_positions_offsetsï¼ä½æ¯åªæå°å¹éé¡¹ç»åå°çå­æ®µæä¼è¢«å è½½ï¼å æ­¤åªæå° store è®¾ç½®ä¸º\n                          yes æè½ä½¿è¯¥å­æ®µåçãåªéç¨äº fvh highlighterã\nno_match_size             å¦ææ²¡æè¦çªåºæ¾ç¤ºçå¹éçæ®µï¼åå¸æä»å­æ®µå¼å¤´è¿åçææ¬éãé»è®¤ä¸º 0(ä¸è¿åä»»ä½åå®¹)ã\nnumber_of_fragments       è¿åççæ®µçæå¤§æ°éãå¦æçæ®µçæ°éè®¾ç½®ä¸º\n                          0ï¼åä¸ä¼è¿åä»»ä½çæ®µãç¸åï¼çªåºæ¾ç¤ºå¹¶è¿åæ´ä¸ªå­æ®µåå®¹ãå½éè¦çªåºæ¾ç¤ºç­ææ¬(å¦æ é¢æå°å)ï¼ä½ä¸éè¦åæ®µæ¶ï¼ä½¿ç¨æ­¤éç½®éå¸¸æ¹ä¾¿ãå¦æ\n                          number_of_fragments ä¸º 0ï¼åå¿½ç¥ fragment_sizeãé»è®¤ä¸º 5ã\norder                     è®¾ç½®ä¸º score\n                          æ¶ï¼æåæ°å¯¹çªåºæ¾ç¤ºççæ®µè¿è¡æåºãé»è®¤æåµä¸ï¼çæ®µå°æç§å®ä»¬å¨å­æ®µä¸­åºç°çé¡ºåºè¾åº(order:none)ãå°æ­¤éé¡¹è®¾ç½®ä¸º\n                          score å°é¦åè¾åºæç¸å³ççæ®µãæ¯ä¸ªé«äº®åºç¨èªå·±çé»è¾æ¥è®¡ç®ç¸å³æ§å¾åã\nphrase_limit              æ§å¶ææ¡£ä¸­æèèçå¹éç­è¯­çæ°éãé²æ­¢ fvh highlighter\n                          åæå¤ªå¤çç­è¯­åæ¶èå¤ªå¤çåå­ãæé«éå¶ä¼å¢å æ¥è¯¢æ¶é´å¹¶æ¶èæ´å¤åå­ãé»è®¤ä¸º 256ã\npre_tags                  ä¸ post_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç html\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\npost_tags                 ä¸ pre_tags ä¸èµ·ä½¿ç¨ï¼å®ä¹ç¨äºçªåºæ¾ç¤ºææ¬ç html\n                          æ è®°ãé»è®¤æåµä¸ï¼çªåºæ¾ç¤ºçææ¬è¢«åè£å¨åæ è®°ä¸­ãæå®ä¸ºå­ç¬¦ä¸²æ°ç»ã\nrequire_field_match       é»è®¤æåµä¸ï¼åªçªåºæ¾ç¤ºåå«æ¥è¯¢å¹éçå­æ®µãå° require_field_match è®¾ç½®ä¸º false\n                          ä»¥çªåºæ¾ç¤ºææå­æ®µãé»è®¤å¼ä¸º trueã\ntags_schema               è®¾ç½®ä¸ºä½¿ç¨åç½®æ è®°æ¨¡å¼çæ ·å¼ã\ntype                      ä½¿ç¨çé«äº®æ¨¡å¼ï¼å¯éé¡¹ä¸º**unifiedãplainæfvh**ãé»è®¤ä¸º unifiedã\n\n\n# 2. èªå®ä¹é«äº®çæ®µ\n\nå¦ææä»¬æ³ä½¿ç¨èªå®ä¹æ ç­¾ï¼å¨é«äº®å±æ§ä¸­ç»éè¦é«äº®çå­æ®µå ä¸ pre_tags å post_tags å³å¯ãä¾å¦ï¼æç´¢ title å­æ®µä¸­åå«å³é®è¯ javascript çä¹¦ç±å¹¶ä½¿ç¨èªå®ä¹ html æ ç­¾é«äº®å³é®è¯ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "fields": {\n      "title": {\n        "pre_tags": ["<strong>"],\n        "post_tags": ["</strong>"]\n      }\n    }\n  }\n}\n\n\n\n# 3. å¤å­æ®µé«äº®\n\nå³äºæç´¢é«äº®ï¼è¿éè¦ææ¡å¦ä½è®¾ç½®å¤å­æ®µæç´¢é«äº®ãæ¯å¦ï¼æç´¢ title å­æ®µçæ¶åï¼æä»¬ææ description å­æ®µä¸­çå³é®å­ä¹å¯ä»¥é«äº®ï¼è¿æ¶åå°±éè¦æ require_field_match å±æ§çåå¼è®¾ç½®ä¸º fasleãrequire_field_match çé»è®¤å¼ä¸º trueï¼åªä¼é«äº®å¹éçå­æ®µãå¤å­æ®µé«äº®çæ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search\n{\n  "query": {\n    "match": { "title": "javascript" }\n  },\n  "highlight": {\n    "require_field_match": false,\n    "fields": {\n      "title": {},\n      "description": {}\n    }\n  }\n}\n\n\n\n# 4. é«äº®æ§è½åæ\n\nelasticsearch æä¾äºä¸ç§é«äº®å¨ï¼åå«æ¯é»è®¤ç highlighter é«äº®å¨ãpostings-highlighter é«äº®å¨å fast-vector-highlighter é«äº®å¨ã\n\né»è®¤ç highlighter æ¯æåºæ¬çé«äº®å¨ãhighlighter é«äº®å¨å®ç°é«äº®åè½éè¦å¯¹ _source ä¸­ä¿å­çåå§ææ¡£è¿è¡äºæ¬¡åæï¼å¶éåº¦å¨ä¸ç§é«äº®å¨éææ¢ï¼ä¼ç¹æ¯ä¸éè¦é¢å¤çå­å¨ç©ºé´ã\n\npostings-highlighter é«äº®å¨å®ç°é«äº®åè½ä¸éè¦äºæ¬¡åæï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® index_options åæ°çåå¼ä¸º offsetsï¼å³ä¿å­å³é®è¯çåç§»éï¼éåº¦å¿«äºé»è®¤ç highlighter é«äº®å¨ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ postings-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nput /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "index_options": "offsets"\n        }\n      }\n    }\n  }\n}\n\n\nfast-vector-highlighter é«äº®å¨å®ç°é«äº®åè½éåº¦æå¿«ï¼ä½æ¯éè¦å¨å­æ®µçæ å°ä¸­è®¾ç½® term_vector åæ°çåå¼ä¸º with_positions_offsetsï¼å³ä¿å­å³é®è¯çä½ç½®ååç§»ä¿¡æ¯ï¼å ç¨çå­å¨ç©ºé´æå¤§ï¼æ¯å¸åçç©ºé´æ¢æ¶é´çåæ³ãä¾å¦ï¼éç½® comment å­æ®µä½¿ç¨ fast-vector-highlighter é«äº®å¨ï¼æ å°å¦ä¸ï¼\n\nput /example\n{\n  "mappings": {\n    "doc": {\n      "properties": {\n        "comment": {\n          "type": "text",\n          "term_vector": "with_positions_offsets"\n        }\n      }\n    }\n  }\n}\n',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch æåº",frontmatter:{title:"Elasticsearch æåº",date:"2022-01-19T22:49:16.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","æåº"],permalink:"/pages/44ca8e/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/07.Elasticsearch%E6%8E%92%E5%BA%8F.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/07.Elasticsearchæåº.md",key:"v-0b132004",path:"/pages/44ca8e/",headers:[{level:2,title:"1. é»è®¤ç¸å³æ§æåº",slug:"_1-é»è®¤ç¸å³æ§æåº",normalizedTitle:"1. é»è®¤ç¸å³æ§æåº",charIndex:216},{level:3,title:"1.1. TF-IDF æ¨¡å",slug:"_1-1-tf-idf-æ¨¡å",normalizedTitle:"1.1. tf-idf æ¨¡å",charIndex:462},{level:3,title:"1.2. BM25 æ¨¡å",slug:"_1-2-bm25-æ¨¡å",normalizedTitle:"1.2. bm25 æ¨¡å",charIndex:1859},{level:2,title:"2. å­æ®µçå¼æåº",slug:"_2-å­æ®µçå¼æåº",normalizedTitle:"2. å­æ®µçå¼æåº",charIndex:1987},{level:2,title:"3. å¤å­æ®µæåº",slug:"_3-å¤å­æ®µæåº",normalizedTitle:"3. å¤å­æ®µæåº",charIndex:2786},{level:2,title:"4. å¤å¼å­æ®µçæåº",slug:"_4-å¤å¼å­æ®µçæåº",normalizedTitle:"4. å¤å¼å­æ®µçæåº",charIndex:3315},{level:2,title:"5. å°çä½ç½®ä¸çè·ç¦»æåº",slug:"_5-å°çä½ç½®ä¸çè·ç¦»æåº",normalizedTitle:"5. å°çä½ç½®ä¸çè·ç¦»æåº",charIndex:3554},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:4544}],headersStr:"1. é»è®¤ç¸å³æ§æåº 1.1. TF-IDF æ¨¡å 1.2. BM25 æ¨¡å 2. å­æ®µçå¼æåº 3. å¤å­æ®µæåº 4. å¤å¼å­æ®µçæåº 5. å°çä½ç½®ä¸çè·ç¦»æåº 6. åèèµæ",content:'# Elasticsearch æåº\n\nå¨ Elasticsearch ä¸­ï¼é»è®¤æåºæ¯æç§ç¸å³æ§çè¯åï¼_scoreï¼è¿è¡éåºæåºï¼ä¹å¯ä»¥æç§å­æ®µçå¼æåºãå¤çº§æåºãå¤å¼å­æ®µæåºãåºäº geoï¼å°çä½ç½®ï¼æåºä»¥åèªå®ä¹èæ¬æåºï¼é¤æ­¤ä¹å¤ï¼å¯¹äºç¸å³æ§çè¯åä¹å¯ä»¥ç¨ rescore äºæ¬¡ãä¸æ¬¡æåï¼å®å¯ä»¥éå®éæ°æåççªå£å¤§å°ï¼window sizeï¼ï¼å¹¶éå¯¹ä½ç¨èå´åçææ¡£ä¿®æ¹å¶å¾åï¼ä»èè¾¾å°ç²¾ç»åæ§å¶ç»æç¸å³æ§çç®çã\n\n\n# 1. é»è®¤ç¸å³æ§æåº\n\nå¨ Elasticsearch ä¸­ï¼é»è®¤æåµä¸ï¼ææ¡£æ¯æç§ç¸å³æ§å¾åååºæåçï¼å¶å¯¹åºçç¸å³æ§å¾åå­æ®µç¨ _score æ¥è¡¨ç¤ºï¼å®æ¯æµ®ç¹æ°ç±»åï¼_score è¯åè¶é«ï¼ç¸å³æ§è¶é«ãè¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\nç¸ä¼¼åº¦ç®æ³å¯ä»¥æå­æ®µæå®ï¼åªéå¨æ å°ä¸­ä¸ºä¸åå­æ®µéå®å³å¯ï¼å¦æè¦ä¿®æ¹å·²æå­æ®µçç¸ä¼¼åº¦ç®æ³ï¼åªè½éè¿ä¸ºæ°æ®éæ°å»ºç«ç´¢å¼æ¥è¾¾å°ç®çãå³äºæ´å¤ es ç¸ä¼¼åº¦ç®æ³å¯ä»¥åè æ·±å¥çè§£ es ç¸ä¼¼åº¦ç®æ³ï¼ç¸å³æ§å¾åè®¡ç®ï¼ã\n\n\n# 1.1. TF-IDF æ¨¡å\n\nElasticsearch å¨ 5.4 çæ¬ä»¥åï¼text ç±»åçå­æ®µï¼é»è®¤éç¨åºäº tf-idf çåéç©ºé´æ¨¡åã\n\nå¨å¼å§è®¡ç®å¾åä¹æ¶ï¼Elasticsearch ä½¿ç¨äºè¢«æç´¢è¯æ¡çé¢çä»¥åå®æå¤å¸¸è§æ¥å½±åå¾åãä¸ä¸ªç®ç­çè§£éæ¯ï¼ä¸ä¸ªè¯æ¡åºç°å¨æä¸ªææ¡£ä¸­çæ¬¡æ°è¶å¤ï¼å®å°±è¶ç¸å³ï¼ä½æ¯ï¼å¦æè¯¥è¯æ¡åºç°å¨ä¸åçææ¡£çæ¬¡æ°è¶å¤ï¼å®å°±è¶ä¸ç¸å³ãè¿ä¸ç¹è¢«ç§°ä¸º TF-IDFï¼TF æ¯è¯é¢ï¼term frequencyï¼ï¼IDF æ¯éææ¡£é¢çï¼inverse document frequencyï¼ã\n\nèèç»ä¸ç¯ææ¡£æåçé¦è¦æ¹å¼ï¼æ¯ç»è®¡ä¸ä¸ªè¯æ¡å¨ææ¬ä¸­åºç°çæ¬¡æ°ãä¸¾ä¸ªä¾å­ï¼å¦æå¨ç¨æ·çåºåæç´¢å³äº Elasticsearch ç get-togetherï¼ç¨æ·å¸æé¢ç¹æå Elasticsearch çåç»è¢«ä¼åå±ç¤ºåºæ¥ã\n\n"We will discuss Elasticsearch at the next Big Data group."\n"Tuesday the Elasticsearch team will gather to answer questions about Elasticsearch."\n\n\nç¬¬ä¸ä¸ªå¥å­æå° Elasticsearch ä¸æ¬¡ï¼èç¬¬äºä¸ªå¥å­æå° Elasticsearch ä¸¤æ¬¡ï¼æä»¥åå«ç¬¬äºå¥è¯çææ¡£åºè¯¥æ¯åå«ç¬¬ä¸å¥è¯çææ¡£æ¥ææ´é«çå¾åãå¦ææä»¬è¦æç§æ°éæ¥è®¨è®ºï¼ç¬¬ä¸å¥è¯çè¯é¢ï¼TFï¼æ¯ 1ï¼èç¬¬äºå¥è¯çè¯é¢å°æ¯ 2ã\n\néææ¡£é¢çæ¯ææ¡£è¯é¢ç¨å¾®å¤æä¸ç¹ãè¿ä¸ªå¬ä¸å»å¾é·ç«çæè¿°æå³çï¼å¦æä¸ä¸ªåè¯ï¼éå¸¸æ¯åè¯ï¼ä½ä¸ä¸å®æ¯ï¼å¨ç´¢å¼çä¸åææ¡£ä¸­åºç°è¶å¤çæ¬¡æ°ï¼é£ä¹å®å°±è¶ä¸éè¦ãä½¿ç¨å¦ä¸ä¾å­æ´å®¹æè§£éè¿ä¸ç¹ã\n\n"We use Elasticsearch to power the search for our website."\n"The developers like Elasticsearch so far."\n"The scoring of documents is calculated by the scoring formula."\n\n\nå¦ä¸è¿°ä¾å­ï¼éè¦çè§£ä»¥ä¸å ç¹ï¼\n\n * è¯æ¡ âElasticsearchâ çææ¡£é¢çæ¯ 2ï¼å ä¸ºå®åºç°å¨ä¸¤ç¯ææ¡£ä¸­ï¼ãææ¡£é¢ççéæºèªå¾åä¹ä»¥ 1/DFï¼è¿é DF æ¯è¯¥è¯æ¡çææ¡£é¢çãè¿å°±æå³çï¼ç±äºè¯æ¡æ¥ææ´é«çææ¡£é¢çï¼å®çæéå°±ä¼éä½ã\n * è¯æ¡ âtheâ çææ¡£é¢çæ¯ 3ï¼å ä¸ºå®åºç°å¨ææçä¸ç¯ææ¡£ä¸­ãè¯·æ³¨æï¼å°½ç®¡ âtheâ å¨æåä¸ç¯ææ¡£ä¸­åºç°äºä¸¤æ¬¡ï¼å®çææ¡£é¢çè¿æ¯ 3ãè¿æ¯å ä¸ºï¼éææ¡£é¢çåªæ£æ¥ä¸ä¸ªè¯æ¡æ¯å¦åºç°å¨æææ¡£ä¸­ï¼èä¸æ£æ¥å®åºç°å¤å°æ¬¡ãé£ä¸ªåºè¯¥æ¯è¯é¢æå³å¿çäºæã\n\néææ¡£é¢çæ¯ä¸ä¸ªéè¦çå ç´ ï¼ç¨äºå¹³è¡¡è¯æ¡çè¯é¢ãä¸¾ä¸ªä¾å­ï¼èèæä¸ä¸ªç¨æ·æç´¢è¯æ¡ âthe scoreâï¼åè¯ the å ä¹åºç°å¨æ¯ä¸ªæ®éçè±è¯­ææ¬ä¸­ï¼å¦æå®ä¸è¢«åè¡¡ä¸ä¸ï¼åè¯ the çé¢çè¦å®å¨æ·¹æ²¡åè¯ score çé¢çãéææ¡£é¢ç IDF åè¡¡äº the è¿ç§å¸¸è§è¯çç¸å³æ§å½±åï¼æä»¥å®éçç¸å³æ§å¾åå°ä¼å¯¹æ¥è¯¢çè¯æ¡æä¸ä¸ªæ´åç¡®çæè¿°ã\n\nä¸æ¦è¯é¢ TF åéææ¡£é¢ç IDF è®¡ç®å®æï¼å°±å¯ä»¥ä½¿ç¨ TF-IDF å¬å¼æ¥è®¡ç®ææ¡£çå¾åã\n\n\n# 1.2. BM25 æ¨¡å\n\nElasticsearch å¨ 5.4 çæ¬ä¹åï¼éå¯¹ text ç±»åçå­æ®µï¼é»è®¤éç¨çæ¯ BM25 è¯åæ¨¡åï¼èä¸æ¯åºäº tf-idf çåéç©ºé´æ¨¡åï¼è¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\n\n# 2. å­æ®µçå¼æåº\n\nå¨ Elasticsearch ä¸­æç§å­æ®µçå¼æåºï¼å¯ä»¥å©ç¨ sort åæ°å®ç°ã\n\nGET books/_search\n{\n  "sort": {\n    "price": {\n      "order": "desc"\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  "took": 132,\n  "timed_out": false,\n  "_shards": {\n    "total": 10,\n    "successful": 10,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 749244,\n    "max_score": null,\n    "hits": [\n      {\n        "_index": "books",\n        "_type": "book",\n        "_id": "8456479",\n        "_score": null,\n        "_source": {\n          "id": 8456479,\n          "price": 1580.00,\n          ...\n        },\n        "sort": [\n          1580.00\n        ]\n      },\n      ...\n    ]\n  }\n}\n\n\nä»å¦ä¸è¿åç»æï¼å¯ä»¥çåºï¼max_score å _score å­æ®µé½è¿å nullï¼è¿åå­æ®µå¤åº sort å­æ®µï¼åå«æåºå­æ®µçåå¼ãè®¡ç® _score çè±éå·¨å¤§ï¼å¦æä¸æ ¹æ®ç¸å³æ§æåºï¼è®°å½ _score æ¯æ²¡ææä¹çãå¦ææ è®ºå¦ä½é½è¦è®¡ç® _scoreï¼å¯ä»¥å° track_scores åæ°è®¾ç½®ä¸º trueã\n\n\n# 3. å¤å­æ®µæåº\n\nå¦ææä»¬æ³è¦ç»åä½¿ç¨ priceãdate å _score è¿è¡æ¥è¯¢ï¼å¹¶ä¸å¹éçç»æé¦åæç§ä»·æ ¼æåºï¼ç¶åæç§æ¥ææåºï¼æåæç§ç¸å³æ§æåºï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nGET books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match": { "content": "java" }\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"term": { "user_id": 4868438 }\n\t\t\t}\n\t\t}\n\t},\n\t"sort": [{\n\t\t\t"price": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"date": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"_score": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}\n\t]\n}\n\n\næåºæ¡ä»¶çé¡ºåºæ¯å¾éè¦çãç»æé¦åæç¬¬ä¸ä¸ªæ¡ä»¶æåºï¼ä»å½ç»æéçç¬¬ä¸ä¸ª sort å¼å®å¨ç¸åæ¶æä¼æç§ç¬¬äºä¸ªæ¡ä»¶è¿è¡æåºï¼ä»¥æ­¤ç±»æ¨ã\n\nå¤çº§æåºå¹¶ä¸ä¸å®åå« _scoreãä½ å¯ä»¥æ ¹æ®ä¸äºä¸åçå­æ®µè¿è¡æåºï¼å¦å°çè·ç¦»ææ¯èæ¬è®¡ç®çç¹å®å¼ã\n\n\n# 4. å¤å¼å­æ®µçæåº\n\nä¸ç§æå½¢æ¯å­æ®µæå¤ä¸ªå¼çæåºï¼éè¦è®°ä½è¿äºå¼å¹¶æ²¡æåºæçé¡ºåºï¼ä¸ä¸ªå¤å¼çå­æ®µä»ä»æ¯å¤ä¸ªå¼çåè£ï¼è¿æ¶åºè¯¥éæ©åªä¸ªè¿è¡æåºå¢ï¼\n\nå¯¹äºæ°å­ææ¥æï¼ä½ å¯ä»¥å°å¤å¼å­æ®µåä¸ºåå¼ï¼è¿å¯ä»¥éè¿ä½¿ç¨ minãmaxãavg ææ¯ sum æåºæ¨¡å¼ãä¾å¦ä½ å¯ä»¥æç§æ¯ä¸ª date å­æ®µä¸­çææ©æ¥æè¿è¡æåºï¼éè¿ä»¥ä¸æ¹æ³ï¼\n\n"sort": {\n  "dates": {\n    "order": "asc",\n    "mode":  "min"\n  }\n}\n\n\n\n# 5. å°çä½ç½®ä¸çè·ç¦»æåº\n\nes çå°çä½ç½®æåºä½¿ç¨ _geo_distance æ¥è¿è¡è·ç¦»æåºï¼å¦ä¸ç¤ºä¾ï¼\n\n{\n  "sort" : [\n    {\n      "_geo_distance" : {\n        "es_location_field" : [116.407526, 39.904030],\n        "order" : "asc",\n        "unit" : "km",\n        "mode" : "min",\n        "distance_type" : "plane"\n      }\n    }\n  ],\n  "query" : {\n    ......\n  }\n}\n\n\n_geo_distance çéé¡¹å·ä½å¦ä¸ï¼\n\n * å¦ä¸ç es_location_field æçæ¯ es å­å¨ç»çº¬åº¦æ°æ®çå­æ®µåã\n * orderï¼æå®æè·ç¦»ååºæéåºï¼åå«å¯¹åº asc å descã\n * unitï¼è®¡ç®è·ç¦»å¼çåä½ï¼é»è®¤æ¯ mï¼è¡¨ç¤ºç±³ï¼metersï¼ï¼å¶å®å¯éé¡¹æ miãcmãmmãNMãkmãftãyd å inã\n * modeï¼éå¯¹æ°ç»æ°æ®ï¼å¤ä¸ªå¼ï¼æ¶ï¼æå®çåå¼æ¨¡å¼ï¼å¯éå¼æ minãmaxãsumãavg å medianï¼å½æåºéç¨ååºæ¶ï¼é»è®¤ä¸º minï¼æåºéç¨éåºæ¶ï¼é»è®¤ä¸º maxã\n * distance_typeï¼ç¨æ¥è®¾ç½®å¦ä½è®¡ç®è·ç¦»ï¼å®çå¯éé¡¹æ sloppy_arcãarc å planeï¼é»è®¤ä¸º sloppy_arcï¼arc å®ç¸å¯¹æ´ç²¾ç¡®äºï¼ä½éåº¦ä¼ææ¾ä¸éï¼plane åæ¯è®¡ç®å¿«ï¼ä½æ¯é¿è·ç¦»è®¡ç®ç¸å¯¹ä¸åç¡®ã\n * ignore_unmappedï¼æªæ å°å­æ®µæ¶ï¼æ¯å¦å¿½ç¥å¤çï¼å¯éé¡¹æ true å falseï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¦ææªæ å°å­æ®µï¼æ¥è¯¢å°å¼åå¼å¸¸ï¼è¥è®¾ç½® trueï¼å°å¿½ç¥æªæ å°çå­æ®µï¼å¹¶ä¸ä¸å¹éæ­¤æ¥è¯¢çä»»ä½ææ¡£ã\n * validation_methodï¼æå®æ£éªç»çº¬åº¦æ°æ®çæ¹å¼ï¼å¯éé¡¹æ IGNORE_MALFORMEDãCOERCE å STRICTï¼IGNORE_MALFORMED è¡¨ç¤ºå¯æ¥åçº¬åº¦æç»åº¦æ æçå°çç¹ï¼å³å¿½ç¥æ°æ®ï¼COERCE è¡¨ç¤ºå¦å¤å°è¯å¹¶æ¨æ­æ­£ç¡®çå°çåæ ï¼STRICT ä¸ºé»è®¤å¼ï¼è¡¨ç¤ºéå°ä¸æ­£ç¡®çå°çåæ ç´æ¥æåºå¼å¸¸ã\n\n\n# 6. åèèµæ\n\n * Elasticsearch æç¨',normalizedContent:'# elasticsearch æåº\n\nå¨ elasticsearch ä¸­ï¼é»è®¤æåºæ¯æç§ç¸å³æ§çè¯åï¼_scoreï¼è¿è¡éåºæåºï¼ä¹å¯ä»¥æç§å­æ®µçå¼æåºãå¤çº§æåºãå¤å¼å­æ®µæåºãåºäº geoï¼å°çä½ç½®ï¼æåºä»¥åèªå®ä¹èæ¬æåºï¼é¤æ­¤ä¹å¤ï¼å¯¹äºç¸å³æ§çè¯åä¹å¯ä»¥ç¨ rescore äºæ¬¡ãä¸æ¬¡æåï¼å®å¯ä»¥éå®éæ°æåççªå£å¤§å°ï¼window sizeï¼ï¼å¹¶éå¯¹ä½ç¨èå´åçææ¡£ä¿®æ¹å¶å¾åï¼ä»èè¾¾å°ç²¾ç»åæ§å¶ç»æç¸å³æ§çç®çã\n\n\n# 1. é»è®¤ç¸å³æ§æåº\n\nå¨ elasticsearch ä¸­ï¼é»è®¤æåµä¸ï¼ææ¡£æ¯æç§ç¸å³æ§å¾åååºæåçï¼å¶å¯¹åºçç¸å³æ§å¾åå­æ®µç¨ _score æ¥è¡¨ç¤ºï¼å®æ¯æµ®ç¹æ°ç±»åï¼_score è¯åè¶é«ï¼ç¸å³æ§è¶é«ãè¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\nç¸ä¼¼åº¦ç®æ³å¯ä»¥æå­æ®µæå®ï¼åªéå¨æ å°ä¸­ä¸ºä¸åå­æ®µéå®å³å¯ï¼å¦æè¦ä¿®æ¹å·²æå­æ®µçç¸ä¼¼åº¦ç®æ³ï¼åªè½éè¿ä¸ºæ°æ®éæ°å»ºç«ç´¢å¼æ¥è¾¾å°ç®çãå³äºæ´å¤ es ç¸ä¼¼åº¦ç®æ³å¯ä»¥åè æ·±å¥çè§£ es ç¸ä¼¼åº¦ç®æ³ï¼ç¸å³æ§å¾åè®¡ç®ï¼ã\n\n\n# 1.1. tf-idf æ¨¡å\n\nelasticsearch å¨ 5.4 çæ¬ä»¥åï¼text ç±»åçå­æ®µï¼é»è®¤éç¨åºäº tf-idf çåéç©ºé´æ¨¡åã\n\nå¨å¼å§è®¡ç®å¾åä¹æ¶ï¼elasticsearch ä½¿ç¨äºè¢«æç´¢è¯æ¡çé¢çä»¥åå®æå¤å¸¸è§æ¥å½±åå¾åãä¸ä¸ªç®ç­çè§£éæ¯ï¼ä¸ä¸ªè¯æ¡åºç°å¨æä¸ªææ¡£ä¸­çæ¬¡æ°è¶å¤ï¼å®å°±è¶ç¸å³ï¼ä½æ¯ï¼å¦æè¯¥è¯æ¡åºç°å¨ä¸åçææ¡£çæ¬¡æ°è¶å¤ï¼å®å°±è¶ä¸ç¸å³ãè¿ä¸ç¹è¢«ç§°ä¸º tf-idfï¼tf æ¯è¯é¢ï¼term frequencyï¼ï¼idf æ¯éææ¡£é¢çï¼inverse document frequencyï¼ã\n\nèèç»ä¸ç¯ææ¡£æåçé¦è¦æ¹å¼ï¼æ¯ç»è®¡ä¸ä¸ªè¯æ¡å¨ææ¬ä¸­åºç°çæ¬¡æ°ãä¸¾ä¸ªä¾å­ï¼å¦æå¨ç¨æ·çåºåæç´¢å³äº elasticsearch ç get-togetherï¼ç¨æ·å¸æé¢ç¹æå elasticsearch çåç»è¢«ä¼åå±ç¤ºåºæ¥ã\n\n"we will discuss elasticsearch at the next big data group."\n"tuesday the elasticsearch team will gather to answer questions about elasticsearch."\n\n\nç¬¬ä¸ä¸ªå¥å­æå° elasticsearch ä¸æ¬¡ï¼èç¬¬äºä¸ªå¥å­æå° elasticsearch ä¸¤æ¬¡ï¼æä»¥åå«ç¬¬äºå¥è¯çææ¡£åºè¯¥æ¯åå«ç¬¬ä¸å¥è¯çææ¡£æ¥ææ´é«çå¾åãå¦ææä»¬è¦æç§æ°éæ¥è®¨è®ºï¼ç¬¬ä¸å¥è¯çè¯é¢ï¼tfï¼æ¯ 1ï¼èç¬¬äºå¥è¯çè¯é¢å°æ¯ 2ã\n\néææ¡£é¢çæ¯ææ¡£è¯é¢ç¨å¾®å¤æä¸ç¹ãè¿ä¸ªå¬ä¸å»å¾é·ç«çæè¿°æå³çï¼å¦æä¸ä¸ªåè¯ï¼éå¸¸æ¯åè¯ï¼ä½ä¸ä¸å®æ¯ï¼å¨ç´¢å¼çä¸åææ¡£ä¸­åºç°è¶å¤çæ¬¡æ°ï¼é£ä¹å®å°±è¶ä¸éè¦ãä½¿ç¨å¦ä¸ä¾å­æ´å®¹æè§£éè¿ä¸ç¹ã\n\n"we use elasticsearch to power the search for our website."\n"the developers like elasticsearch so far."\n"the scoring of documents is calculated by the scoring formula."\n\n\nå¦ä¸è¿°ä¾å­ï¼éè¦çè§£ä»¥ä¸å ç¹ï¼\n\n * è¯æ¡ âelasticsearchâ çææ¡£é¢çæ¯ 2ï¼å ä¸ºå®åºç°å¨ä¸¤ç¯ææ¡£ä¸­ï¼ãææ¡£é¢ççéæºèªå¾åä¹ä»¥ 1/dfï¼è¿é df æ¯è¯¥è¯æ¡çææ¡£é¢çãè¿å°±æå³çï¼ç±äºè¯æ¡æ¥ææ´é«çææ¡£é¢çï¼å®çæéå°±ä¼éä½ã\n * è¯æ¡ âtheâ çææ¡£é¢çæ¯ 3ï¼å ä¸ºå®åºç°å¨ææçä¸ç¯ææ¡£ä¸­ãè¯·æ³¨æï¼å°½ç®¡ âtheâ å¨æåä¸ç¯ææ¡£ä¸­åºç°äºä¸¤æ¬¡ï¼å®çææ¡£é¢çè¿æ¯ 3ãè¿æ¯å ä¸ºï¼éææ¡£é¢çåªæ£æ¥ä¸ä¸ªè¯æ¡æ¯å¦åºç°å¨æææ¡£ä¸­ï¼èä¸æ£æ¥å®åºç°å¤å°æ¬¡ãé£ä¸ªåºè¯¥æ¯è¯é¢æå³å¿çäºæã\n\néææ¡£é¢çæ¯ä¸ä¸ªéè¦çå ç´ ï¼ç¨äºå¹³è¡¡è¯æ¡çè¯é¢ãä¸¾ä¸ªä¾å­ï¼èèæä¸ä¸ªç¨æ·æç´¢è¯æ¡ âthe scoreâï¼åè¯ the å ä¹åºç°å¨æ¯ä¸ªæ®éçè±è¯­ææ¬ä¸­ï¼å¦æå®ä¸è¢«åè¡¡ä¸ä¸ï¼åè¯ the çé¢çè¦å®å¨æ·¹æ²¡åè¯ score çé¢çãéææ¡£é¢ç idf åè¡¡äº the è¿ç§å¸¸è§è¯çç¸å³æ§å½±åï¼æä»¥å®éçç¸å³æ§å¾åå°ä¼å¯¹æ¥è¯¢çè¯æ¡æä¸ä¸ªæ´åç¡®çæè¿°ã\n\nä¸æ¦è¯é¢ tf åéææ¡£é¢ç idf è®¡ç®å®æï¼å°±å¯ä»¥ä½¿ç¨ tf-idf å¬å¼æ¥è®¡ç®ææ¡£çå¾åã\n\n\n# 1.2. bm25 æ¨¡å\n\nelasticsearch å¨ 5.4 çæ¬ä¹åï¼éå¯¹ text ç±»åçå­æ®µï¼é»è®¤éç¨çæ¯ bm25 è¯åæ¨¡åï¼èä¸æ¯åºäº tf-idf çåéç©ºé´æ¨¡åï¼è¯åæ¨¡åçéæ©å¯ä»¥éè¿ similarity åæ°å¨æ å°ä¸­æå®ã\n\n\n# 2. å­æ®µçå¼æåº\n\nå¨ elasticsearch ä¸­æç§å­æ®µçå¼æåºï¼å¯ä»¥å©ç¨ sort åæ°å®ç°ã\n\nget books/_search\n{\n  "sort": {\n    "price": {\n      "order": "desc"\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  "took": 132,\n  "timed_out": false,\n  "_shards": {\n    "total": 10,\n    "successful": 10,\n    "skipped": 0,\n    "failed": 0\n  },\n  "hits": {\n    "total": 749244,\n    "max_score": null,\n    "hits": [\n      {\n        "_index": "books",\n        "_type": "book",\n        "_id": "8456479",\n        "_score": null,\n        "_source": {\n          "id": 8456479,\n          "price": 1580.00,\n          ...\n        },\n        "sort": [\n          1580.00\n        ]\n      },\n      ...\n    ]\n  }\n}\n\n\nä»å¦ä¸è¿åç»æï¼å¯ä»¥çåºï¼max_score å _score å­æ®µé½è¿å nullï¼è¿åå­æ®µå¤åº sort å­æ®µï¼åå«æåºå­æ®µçåå¼ãè®¡ç® _score çè±éå·¨å¤§ï¼å¦æä¸æ ¹æ®ç¸å³æ§æåºï¼è®°å½ _score æ¯æ²¡ææä¹çãå¦ææ è®ºå¦ä½é½è¦è®¡ç® _scoreï¼å¯ä»¥å° track_scores åæ°è®¾ç½®ä¸º trueã\n\n\n# 3. å¤å­æ®µæåº\n\nå¦ææä»¬æ³è¦ç»åä½¿ç¨ priceãdate å _score è¿è¡æ¥è¯¢ï¼å¹¶ä¸å¹éçç»æé¦åæç§ä»·æ ¼æåºï¼ç¶åæç§æ¥ææåºï¼æåæç§ç¸å³æ§æåºï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nget books/_search\n{\n\t"query": {\n\t\t"bool": {\n\t\t\t"must": {\n\t\t\t\t"match": { "content": "java" }\n\t\t\t},\n\t\t\t"filter": {\n\t\t\t\t"term": { "user_id": 4868438 }\n\t\t\t}\n\t\t}\n\t},\n\t"sort": [{\n\t\t\t"price": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"date": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}, {\n\t\t\t"_score": {\n\t\t\t\t"order": "desc"\n\t\t\t}\n\t\t}\n\t]\n}\n\n\næåºæ¡ä»¶çé¡ºåºæ¯å¾éè¦çãç»æé¦åæç¬¬ä¸ä¸ªæ¡ä»¶æåºï¼ä»å½ç»æéçç¬¬ä¸ä¸ª sort å¼å®å¨ç¸åæ¶æä¼æç§ç¬¬äºä¸ªæ¡ä»¶è¿è¡æåºï¼ä»¥æ­¤ç±»æ¨ã\n\nå¤çº§æåºå¹¶ä¸ä¸å®åå« _scoreãä½ å¯ä»¥æ ¹æ®ä¸äºä¸åçå­æ®µè¿è¡æåºï¼å¦å°çè·ç¦»ææ¯èæ¬è®¡ç®çç¹å®å¼ã\n\n\n# 4. å¤å¼å­æ®µçæåº\n\nä¸ç§æå½¢æ¯å­æ®µæå¤ä¸ªå¼çæåºï¼éè¦è®°ä½è¿äºå¼å¹¶æ²¡æåºæçé¡ºåºï¼ä¸ä¸ªå¤å¼çå­æ®µä»ä»æ¯å¤ä¸ªå¼çåè£ï¼è¿æ¶åºè¯¥éæ©åªä¸ªè¿è¡æåºå¢ï¼\n\nå¯¹äºæ°å­ææ¥æï¼ä½ å¯ä»¥å°å¤å¼å­æ®µåä¸ºåå¼ï¼è¿å¯ä»¥éè¿ä½¿ç¨ minãmaxãavg ææ¯ sum æåºæ¨¡å¼ãä¾å¦ä½ å¯ä»¥æç§æ¯ä¸ª date å­æ®µä¸­çææ©æ¥æè¿è¡æåºï¼éè¿ä»¥ä¸æ¹æ³ï¼\n\n"sort": {\n  "dates": {\n    "order": "asc",\n    "mode":  "min"\n  }\n}\n\n\n\n# 5. å°çä½ç½®ä¸çè·ç¦»æåº\n\nes çå°çä½ç½®æåºä½¿ç¨ _geo_distance æ¥è¿è¡è·ç¦»æåºï¼å¦ä¸ç¤ºä¾ï¼\n\n{\n  "sort" : [\n    {\n      "_geo_distance" : {\n        "es_location_field" : [116.407526, 39.904030],\n        "order" : "asc",\n        "unit" : "km",\n        "mode" : "min",\n        "distance_type" : "plane"\n      }\n    }\n  ],\n  "query" : {\n    ......\n  }\n}\n\n\n_geo_distance çéé¡¹å·ä½å¦ä¸ï¼\n\n * å¦ä¸ç es_location_field æçæ¯ es å­å¨ç»çº¬åº¦æ°æ®çå­æ®µåã\n * orderï¼æå®æè·ç¦»ååºæéåºï¼åå«å¯¹åº asc å descã\n * unitï¼è®¡ç®è·ç¦»å¼çåä½ï¼é»è®¤æ¯ mï¼è¡¨ç¤ºç±³ï¼metersï¼ï¼å¶å®å¯éé¡¹æ miãcmãmmãnmãkmãftãyd å inã\n * modeï¼éå¯¹æ°ç»æ°æ®ï¼å¤ä¸ªå¼ï¼æ¶ï¼æå®çåå¼æ¨¡å¼ï¼å¯éå¼æ minãmaxãsumãavg å medianï¼å½æåºéç¨ååºæ¶ï¼é»è®¤ä¸º minï¼æåºéç¨éåºæ¶ï¼é»è®¤ä¸º maxã\n * distance_typeï¼ç¨æ¥è®¾ç½®å¦ä½è®¡ç®è·ç¦»ï¼å®çå¯éé¡¹æ sloppy_arcãarc å planeï¼é»è®¤ä¸º sloppy_arcï¼arc å®ç¸å¯¹æ´ç²¾ç¡®äºï¼ä½éåº¦ä¼ææ¾ä¸éï¼plane åæ¯è®¡ç®å¿«ï¼ä½æ¯é¿è·ç¦»è®¡ç®ç¸å¯¹ä¸åç¡®ã\n * ignore_unmappedï¼æªæ å°å­æ®µæ¶ï¼æ¯å¦å¿½ç¥å¤çï¼å¯éé¡¹æ true å falseï¼é»è®¤ä¸º falseï¼è¡¨ç¤ºå¦ææªæ å°å­æ®µï¼æ¥è¯¢å°å¼åå¼å¸¸ï¼è¥è®¾ç½® trueï¼å°å¿½ç¥æªæ å°çå­æ®µï¼å¹¶ä¸ä¸å¹éæ­¤æ¥è¯¢çä»»ä½ææ¡£ã\n * validation_methodï¼æå®æ£éªç»çº¬åº¦æ°æ®çæ¹å¼ï¼å¯éé¡¹æ ignore_malformedãcoerce å strictï¼ignore_malformed è¡¨ç¤ºå¯æ¥åçº¬åº¦æç»åº¦æ æçå°çç¹ï¼å³å¿½ç¥æ°æ®ï¼coerce è¡¨ç¤ºå¦å¤å°è¯å¹¶æ¨æ­æ­£ç¡®çå°çåæ ï¼strict ä¸ºé»è®¤å¼ï¼è¡¨ç¤ºéå°ä¸æ­£ç¡®çå°çåæ ç´æ¥æåºå¼å¸¸ã\n\n\n# 6. åèèµæ\n\n * elasticsearch æç¨',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch èå",frontmatter:{title:"Elasticsearch èå",date:"2022-01-19T22:49:16.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","èå"],permalink:"/pages/93fa2a/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/08.Elasticsearch%E8%81%9A%E5%90%88.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/08.Elasticsearchèå.md",key:"v-272e6736",path:"/pages/93fa2a/",headers:[{level:2,title:"1. èåçå·ä½ç»æ",slug:"_1-èåçå·ä½ç»æ",normalizedTitle:"1. èåçå·ä½ç»æ",charIndex:327},{level:2,title:"2. ææ èå",slug:"_2-ææ èå",normalizedTitle:"2. ææ èå",charIndex:341},{level:3,title:"2.1. Max Aggregation",slug:"_2-1-max-aggregation",normalizedTitle:"2.1. max aggregation",charIndex:354},{level:3,title:"2.2. Min Aggregation",slug:"_2-2-min-aggregation",normalizedTitle:"2.2. min aggregation",charIndex:380},{level:3,title:"2.3. Avg Aggregation",slug:"_2-3-avg-aggregation",normalizedTitle:"2.3. avg aggregation",charIndex:406},{level:3,title:"2.4. Sum Aggregation",slug:"_2-4-sum-aggregation",normalizedTitle:"2.4. sum aggregation",charIndex:432},{level:3,title:"2.5. Value Count Aggregation",slug:"_2-5-value-count-aggregation",normalizedTitle:"2.5. value count aggregation",charIndex:458},{level:3,title:"2.6. Cardinality Aggregation",slug:"_2-6-cardinality-aggregation",normalizedTitle:"2.6. cardinality aggregation",charIndex:492},{level:3,title:"2.7. Stats Aggregation",slug:"_2-7-stats-aggregation",normalizedTitle:"2.7. stats aggregation",charIndex:526},{level:3,title:"2.8. Extended Stats Aggregation",slug:"_2-8-extended-stats-aggregation",normalizedTitle:"2.8. extended stats aggregation",charIndex:554},{level:3,title:"2.9. Percentiles Aggregation",slug:"_2-9-percentiles-aggregation",normalizedTitle:"2.9. percentiles aggregation",charIndex:591},{level:3,title:"2.10. Percentiles Ranks Aggregation",slug:"_2-10-percentiles-ranks-aggregation",normalizedTitle:"2.10. percentiles ranks aggregation",charIndex:625},{level:2,title:"3. æ¡¶èå",slug:"_3-æ¡¶èå",normalizedTitle:"3. æ¡¶èå",charIndex:664},{level:3,title:"3.1. Terms Aggregation",slug:"_3-1-terms-aggregation",normalizedTitle:"3.1. terms aggregation",charIndex:676},{level:3,title:"3.2. Filter Aggregation",slug:"_3-2-filter-aggregation",normalizedTitle:"3.2. filter aggregation",charIndex:704},{level:3,title:"3.3. Filters Aggregation",slug:"_3-3-filters-aggregation",normalizedTitle:"3.3. filters aggregation",charIndex:733},{level:3,title:"3.4. Range Aggregation",slug:"_3-4-range-aggregation",normalizedTitle:"3.4. range aggregation",charIndex:763},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:789}],headersStr:"1. èåçå·ä½ç»æ 2. ææ èå 2.1. Max Aggregation 2.2. Min Aggregation 2.3. Avg Aggregation 2.4. Sum Aggregation 2.5. Value Count Aggregation 2.6. Cardinality Aggregation 2.7. Stats Aggregation 2.8. Extended Stats Aggregation 2.9. Percentiles Aggregation 2.10. Percentiles Ranks Aggregation 3. æ¡¶èå 3.1. Terms Aggregation 3.2. Filter Aggregation 3.3. Filters Aggregation 3.4. Range Aggregation 4. åèèµæ",content:'# Elasticsearch èå\n\nElasticsearch æ¯ä¸ä¸ªåå¸å¼çå¨ææç´¢å¼æï¼ç´¢å¼åæç´¢æ¯ Elasticsearch çåºæ¬åè½ãäºå®ä¸ï¼Elasticsearch çèåï¼Aggregationsï¼åè½ä¹ååå¼ºå¤§ï¼åè®¸å¨æ°æ®ä¸åå¤æçåæç»è®¡ãElasticsearch æä¾çèååæåè½ä¸»è¦æææ èå(metrics aggregations)ãæ¡¶èå(bucket aggregations)ãç®¡éèå(pipeline aggregations) å ç©éµèå(matrix aggregations) åå¤§ç±»ï¼ç®¡éèååç©éµèåå®æ¹è¯´ææ¯å¨è¯éªé¶æ®µï¼åæä¼å®å¨æ´æ¹æèç§»é¤ï¼è¿éä¸åå¯¹ç®¡éèååç©éµèåè¿è¡è®²è§£ã\n\n * 1. èåçå·ä½ç»æ\n * 2. ææ èå\n   * 2.1. Max Aggregation\n   * 2.2. Min Aggregation\n   * 2.3. Avg Aggregation\n   * 2.4. Sum Aggregation\n   * 2.5. Value Count Aggregation\n   * 2.6. Cardinality Aggregation\n   * 2.7. Stats Aggregation\n   * 2.8. Extended Stats Aggregation\n   * 2.9. Percentiles Aggregation\n   * 2.10. Percentiles Ranks Aggregation\n * 3. æ¡¶èå\n   * 3.1. Terms Aggregation\n   * 3.2. Filter Aggregation\n   * 3.3. Filters Aggregation\n   * 3.4. Range Aggregation\n * 4. åèèµæ\n\n\n# 1. èåçå·ä½ç»æ\n\nææçèåï¼æ è®ºå®ä»¬æ¯ä»ä¹ç±»åï¼é½éµä»ä»¥ä¸çè§åã\n\n * ä½¿ç¨æ¥è¯¢ä¸­åæ ·ç JSON è¯·æ±æ¥å®ä¹å®ä»¬ï¼èä¸ä½ æ¯ä½¿ç¨é® aggregations æèæ¯ aggs æ¥è¿è¡æ è®°ãéè¦ç»æ¯ä¸ªèåèµ·ä¸ä¸ªåå­ï¼æå®å®çç±»åä»¥ååè¯¥ç±»åç¸å³çéé¡¹ã\n * å®ä»¬è¿è¡å¨æ¥è¯¢çç»æä¹ä¸ãåæ¥è¯¢ä¸å¹éçææ¡£ä¸ä¼è®¡ç®å¨åï¼é¤éä½ ä½¿ç¨ global èéå°ä¸å¹éçææ¡£åæ¬å¶ä¸­ã\n * å¯ä»¥è¿ä¸æ­¥è¿æ»¤æ¥è¯¢çç»æï¼èä¸å½±åèéã\n\nä»¥ä¸æ¯èåçåºæ¬ç»æï¼\n\n"aggregations" : { \x3c!-- æå¤å±çèåé®ï¼ä¹å¯ä»¥ç¼©åä¸º aggs --\x3e\n    "<aggregation_name>" : { \x3c!-- èåçèªå®ä¹åå­ --\x3e\n        "<aggregation_type>" : { \x3c!-- èåçç±»åï¼ææ ç¸å³çï¼å¦ maxãminãavgãsumï¼æ¡¶ç¸å³ç termsãfilter ç­ --\x3e\n            <aggregation_body> \x3c!-- èåä½ï¼å¯¹åªäºå­æ®µè¿è¡èåï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æ --\x3e\n        }\n        [,"meta" : {  [<meta_data_body>] } ]? \x3c!-- å --\x3e\n        [,"aggregations" : { [<sub_aggregation>]+ } ]? \x3c!-- å¨èåéé¢å¨å®ä¹å­èå --\x3e\n    }\n    [,"<aggregation_name_2>" : { ... } ]* \x3c!-- èåçèªå®ä¹åå­ 2 --\x3e\n}\n\n\n * å¨æä¸å±æä¸ä¸ª aggregations çé®ï¼å¯ä»¥ç¼©åä¸º aggsã\n * å¨ä¸é¢ä¸å±ï¼éè¦ä¸ºèåæå®ä¸ä¸ªåå­ãå¯ä»¥å¨è¯·æ±çè¿åä¸­çå°è¿ä¸ªåå­ãå¨åä¸ä¸ªè¯·æ±ä¸­ä½¿ç¨å¤ä¸ªèåæ¶ï¼è¿ä¸ç¹éå¸¸æç¨ï¼å®è®©ä½ å¯ä»¥å¾å®¹æå°çè§£æ¯ç»ç»æçå«ä¹ã\n * æåï¼å¿é¡»è¦æå®èåçç±»åã\n\n> å³äºèååæçå¼æ¥æºï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æã\n> \n> ä½æ¯ç¨èæ¬è®¡ç®çç»ææ¶ï¼éè¦æ³¨æèæ¬çæ§è½åå®å¨æ§ï¼å°½ç®¡å¤æ°èéç±»ååè®¸ä½¿ç¨èæ¬ï¼ä½æ¯èæ¬ä½¿å¾èéåå¾ç¼æ¢ï¼å ä¸ºèæ¬å¿é¡»å¨æ¯ç¯ææ¡£ä¸è¿è¡ãä¸ºäºé¿åèæ¬çè¿è¡ï¼å¯ä»¥å¨ç´¢å¼é¶æ®µè¿è¡è®¡ç®ã\n> \n> æ­¤å¤ï¼èæ¬ä¹å¯ä»¥è¢«äººå¯è½å©ç¨è¿è¡æ¶æä»£ç æ»å»ï¼å°½éä½¿ç¨æ²çï¼sandboxï¼åçèæ¬è¯­è¨ã\n\nç¤ºä¾ï¼æ¥è¯¢ææçåçå¹³åå¹´é¾æ¯å¤å°ï¼å¹¶å¯¹çåçå¹³åèªæ°´å  188ï¼ä¹å¯ä»¥çè§£ä¸ºæ¯åçåå  188 åçå¹³åèªæ°´ï¼ã\n\nPOST /player/_search?size=0\n{\n  "aggs": {\n    "avg_age": {\n      "avg": {\n        "field": "age"\n      }\n    },\n    "avg_salary_188": {\n      "avg": {\n        "script": {\n          "source": "doc.salary.value + 188"\n        }\n      }\n    }\n  }\n}\n\n\n\n# 2. ææ èå\n\nææ èåï¼åç§°åº¦éèåï¼ä¸»è¦ä»ä¸åææ¡£çåç»ä¸­æåç»è®¡æ°æ®ï¼æèï¼ä»æ¥èªå¶ä»èåçææ¡£æ¡¶æ¥æåç»è®¡æ°æ®ã\n\nè¿äºç»è®¡æ°æ®éå¸¸æ¥èªæ°å¼åå­æ®µï¼å¦æå°æèå¹³åä»·æ ¼ãç¨æ·å¯ä»¥åç¬è·åæ¯é¡¹ç»è®¡æ°æ®ï¼æèä¹å¯ä»¥ä½¿ç¨ stats èåæ¥åæ¶è·åå®ä»¬ãæ´é«çº§çç»è®¡æ°æ®ï¼å¦å¹³æ¹åæèæ¯æ åå·®ï¼å¯ä»¥éè¿ extended stats èåæ¥è·åã\n\n\n# 2.1. Max Aggregation\n\nMax Aggregation ç¨äºæå¤§å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æé«çæ¯åªæ¬ä¹¦ï¼å¹¶ä¸è®¡ç®åºå¯¹åºçä»·æ ¼ç 2 åå¼ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /sales/_search?size=0\n{\n  "aggs" : {\n    "max_price" : {\n      "max" : {\n        "field" : "price"\n      }\n    },\n    "max_price_2" : {\n      "max" : {\n        "field" : "price",\n        "script": {\n          "source": "_value * 2.0"\n        }\n      }\n    }\n  }\n}\n\n\næå®ç fieldï¼å¨èæ¬ä¸­å¯ä»¥ç¨ _value åå­æ®µçå¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "max_price": {\n      "value": 188.0\n    },\n    "max_price_2": {\n      "value": 376.0\n    }\n  }\n}\n\n\n\n# 2.2. Min Aggregation\n\nMin Aggregation ç¨äºæå°å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æä½çæ¯åªæ¬ä¹¦ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /sales/_search?size=0\n{\n  "aggs" : {\n    "min_price" : {\n      "min" : {\n        "field" : "price"\n      }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "min_price": {\n      "value": 18.0\n    }\n  }\n}\n\n\n\n# 2.3. Avg Aggregation\n\nAvg Aggregation ç¨äºè®¡ç®å¹³åå¼ãä¾å¦ï¼ç»è®¡ exams ç´¢å¼ä¸­èè¯çå¹³ååæ°ï¼å¦æªå­å¨åæ°ï¼é»è®¤ä¸º 60 åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "aggs" : {\n    "avg_grade" : {\n      "avg" : {\n        "field" : "grade",\n        "missing": 60\n      }\n    }\n  }\n}\n\n\nå¦ææå®å­æ®µæ²¡æå¼ï¼å¯ä»¥éè¿ missing æå®é»è®¤å¼ï¼è¥æªæå®é»è®¤å¼ï¼ç¼ºå¤±è¯¥å­æ®µå¼çææ¡£å°è¢«å¿½ç¥ï¼è®¡ç®ï¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "avg_grade": {\n      "value": 78.0\n    }\n  }\n}\n\n\né¤äºå¸¸è§çå¹³åå¼èåè®¡ç®å¤ï¼elasticsearch è¿æä¾äºå æå¹³åå¼çèåè®¡ç®ï¼è¯¦æåè§ Elasticsearch ææ èåä¹ Weighted Avg Aggregationã\n\n\n# 2.4. Sum Aggregation\n\nSum Aggregation ç¨äºè®¡ç®æ»åãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ type å­æ®µä¸­å¹é hat çä»·æ ¼æ»åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "query" : {\n    "constant_score" : {\n      "filter" : {\n        "match" : { "type" : "hat" }\n      }\n    }\n  },\n  "aggs" : {\n    "hat_prices" : {\n      "sum" : { "field" : "price" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hat_prices": {\n      "value": 567.0\n    }\n  }\n}\n\n\n\n# 2.5. Value Count Aggregation\n\nValue Count Aggregation å¯æå­æ®µç»è®¡ææ¡£æ°éãä¾å¦ï¼ç»è®¡ books ç´¢å¼ä¸­åå« author å­æ®µçææ¡£æ°éï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search?size=0\n{\n  "aggs" : {\n    "doc_count" : {\n      "value_count" : { "field" : "author" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "doc_count": {\n      "value": 5\n    }\n  }\n}\n\n\n\n# 2.6. Cardinality Aggregation\n\nCardinality Aggregation ç¨äºåºæ°ç»è®¡ï¼å¶ä½ç¨æ¯åæ§è¡ç±»ä¼¼ SQL ä¸­ç distinct æä½ï¼å»æéåä¸­çéå¤é¡¹ï¼ç¶åç»è®¡å»éåçéåé¿åº¦ãä¾å¦ï¼å¨ books ç´¢å¼ä¸­å¯¹ language å­æ®µè¿è¡ cardinality æä½å¯ä»¥ç»è®¡åºç¼ç¨è¯­è¨çç§ç±»æ°ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /books/_search?size=0\n{\n  "aggs" : {\n    "all_lan" : {\n      "cardinality" : { "field" : "language" }\n    },\n    "title_cnt" : {\n      "cardinality" : { "field" : "title.keyword" }\n    }\n  }\n}\n\n\nåè®¾ title å­æ®µä¸ºææ¬ç±»åï¼textï¼ï¼å»éæ¶éè¦æå® keywordï¼è¡¨ç¤ºæ title ä½ä¸ºæ´ä½å»éï¼å³ä¸åè¯ç»è®¡ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "all_lan": {\n      "value": 8\n    },\n    "title_cnt": {\n      "value": 18\n    }\n  }\n}\n\n\n\n# 2.7. Stats Aggregation\n\nStats Aggregation ç¨äºåºæ¬ç»è®¡ï¼ä¼ä¸æ¬¡è¿å countãmaxãminãavg å sum è¿ 5 ä¸ªææ ãä¾å¦ï¼å¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çåºæ¬ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0\n    }\n  }\n}\n\n\n\n# 2.8. Extended Stats Aggregation\n\nExtended Stats Aggregation ç¨äºé«çº§ç»è®¡ï¼ååºæ¬ç»è®¡åè½ç±»ä¼¼ï¼ä½æ¯ä¼æ¯åºæ¬ç»è®¡å¤åºä»¥ä¸å ä¸ªç»è®¡ç»æï¼sum_of_squaresï¼å¹³æ¹åï¼ãvarianceï¼æ¹å·®ï¼ãstd_deviationï¼æ åå·®ï¼ãstd_deviation_boundsï¼å¹³åå¼å /åä¸¤ä¸ªæ åå·®çåºé´ï¼ãå¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çé«çº§ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "extended_stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0,\n      "sum_of_squares": 12500.0,\n      "variance": 625.0,\n      "std_deviation": 25.0,\n      "std_deviation_bounds": {\n        "upper": 125.0,\n        "lower": 25.0\n      }\n    }\n  }\n}\n\n\n\n# 2.9. Percentiles Aggregation\n\nPercentiles Aggregation ç¨äºç¾åä½ç»è®¡ãç¾åä½æ°æ¯ä¸ä¸ªç»è®¡å­¦æ¯è¯­ï¼å¦æå°ä¸ç»æ°æ®ä»å¤§å°å°æåºï¼å¹¶è®¡ç®ç¸åºçç´¯è®¡ç¾åä½ï¼æä¸ç¾åä½æå¯¹åºæ°æ®çå¼å°±ç§°ä¸ºè¿ä¸ç¾åä½çç¾åä½æ°ãé»è®¤æåµä¸ï¼ç´¯è®¡ç¾åä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ]ãä»¥ä¸ä¾å­ç»åºäºå¨ latency ç´¢å¼ä¸­å¯¹ load_time å­æ®µè¿è¡å è½½æ¶é´çç¾åä½ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nGET latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time"\n      }\n    }\n  }\n}\n\n\néè¦æ³¨æçæ¯ï¼å¦ä¸ç load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_outlier": {\n      "values" : {\n        "1.0": 5.0,\n        "5.0": 25.0,\n        "25.0": 165.0,\n        "50.0": 445.0,\n        "75.0": 725.0,\n        "95.0": 945.0,\n        "99.0": 985.0\n      }\n    }\n  }\n}\n\n\nç¾åä½çç»è®¡ä¹å¯ä»¥æå® percents åæ°æå®ç¾åä½ï¼å¦ä¸ï¼\n\nGET latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time",\n        "percents": [60, 80, 95]\n      }\n    }\n  }\n}\n\n\n\n# 2.10. Percentiles Ranks Aggregation\n\nPercentiles Ranks Aggregation ä¸ Percentiles Aggregation ç»è®¡æ°æ°ç¸åï¼å°±æ¯æ³çå½åæ°å¼å¤å¨ä»ä¹èå´åï¼ç¾åä½ï¼ï¼ åå¦ä½ æ¥ä¸ä¸å½åå¼ 500 å 600 æå¤çç¾åä½ï¼åç°æ¯ 90.01 å 100ï¼é£ä¹è¯´ææ 90.01 % çæ°å¼é½å¨ 500 ä»¥åï¼100 % çæ°å¼å¨ 600 ä»¥åã\n\nGET latency/_search\n{\n  "size": 0,\n    "aggs" : {\n      "load_time_ranks" : {\n        "percentile_ranks" : {\n          "field" : "load_time",\n          "values" : [500, 600]\n        }\n      }\n  }\n}\n\n\nåæ · load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nè¿åç»æå¤§æ¦ç±»ä¼¼å¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values" : {\n        "500.0": 90.01,\n        "600.0": 100.0\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® keyed åæ°ä¸º trueï¼å°å¯¹åºç values ä½ä¸ºæ¡¶ key ä¸èµ·è¿åï¼é»è®¤æ¯ falseã\n\nGET latency/_search\n{\n  "size": 0,\n  "aggs": {\n    "load_time_ranks": {\n      "percentile_ranks": {\n        "field": "load_time",\n        "values": [500, 600],\n        "keyed": true\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values": [\n        {\n          "key": 500.0,\n          "value": 90.01\n        },\n        {\n          "key": 600.0,\n          "value": 100.0\n        }\n      ]\n    }\n  }\n}\n\n\n\n# 3. æ¡¶èå\n\nbucket å¯ä»¥çè§£ä¸ºä¸ä¸ªæ¡¶ï¼å®ä¼éåææ¡£ä¸­çåå®¹ï¼å¡æ¯ç¬¦åæä¸è¦æ±çå°±æ¾å¥ä¸ä¸ªæ¡¶ä¸­ï¼åæ¡¶ç¸å½äº SQL ä¸­ç group byãä»å¦å¤ä¸ä¸ªè§åº¦ï¼å¯ä»¥å°ææ èåçæåæ¡¶èåï¼å³æææææ¡£æ¾å°ä¸ä¸ªæ¡¶ä¸­ï¼èæ¡¶èåæ¯å¤æ¡¶åèåï¼å®æ ¹æ®ç¸åºçæ¡ä»¶è¿è¡åç»ã\n\nç§ç±»                                      æè¿°/åºæ¯\nè¯é¡¹èåï¼Terms Aggregationï¼                 ç¨äºåç»èåï¼è®©ç¨æ·å¾ç¥ææ¡£ä¸­æ¯ä¸ªè¯é¡¹çé¢çï¼å®è¿åæ¯ä¸ªè¯é¡¹åºç°çæ¬¡æ°ã\nå·®å¼è¯é¡¹èåï¼Significant Terms Aggregationï¼   å®ä¼è¿åæä¸ªè¯é¡¹å¨æ´ä¸ªç´¢å¼ä¸­åå¨æ¥è¯¢ç»æä¸­çè¯é¢å·®å¼ï¼è¿æå©äºæä»¬åç°æç´¢åºæ¯ä¸­ææä¹çè¯ã\nè¿æ»¤å¨èåï¼Filter Aggregationï¼               æå®è¿æ»¤å¨å¹éçææææ¡£å°åä¸ªæ¡¶ï¼bucketï¼ï¼éå¸¸è¿å°ç¨äºå°å½åèåä¸ä¸æç¼©å°å°ä¸ç»ç¹å®çææ¡£ã\nå¤è¿æ»¤å¨èåï¼Filters Aggregationï¼             æå®å¤ä¸ªè¿æ»¤å¨å¹éææææ¡£å°å¤ä¸ªæ¡¶ï¼bucketï¼ã\nèå´èåï¼Range Aggregationï¼                 èå´èåï¼ç¨äºåæ æ°æ®çåå¸æåµã\næ¥æèå´èåï¼Date Range Aggregationï¼          ä¸é¨ç¨äºæ¥æç±»åçèå´èåã\nIP èå´èåï¼IP Range Aggregationï¼           ç¨äºå¯¹ IP ç±»åæ°æ®èå´èåã\nç´æ¹å¾èåï¼Histogram Aggregationï¼            å¯è½æ¯æ°å¼ï¼æèæ¥æåï¼åèå´èéç±»ä¼¼ã\næ¶é´ç´æ¹å¾èåï¼Date Histogram Aggregationï¼     æ¶é´ç´æ¹å¾èåï¼å¸¸ç¨äºæç§æ¥æå¯¹ææ¡£è¿è¡ç»è®¡å¹¶ç»å¶æ¡å½¢å¾ã\nç©ºå¼èåï¼Missing Aggregationï¼               ç©ºå¼èåï¼å¯ä»¥æææ¡£éä¸­ææç¼ºå¤±å­æ®µçææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ã\nå°çç¹èå´èåï¼Geo Distance Aggregationï¼       ç¨äºå¯¹å°çç¹ï¼geo pointï¼åèå´ç»è®¡ã\n\n\n# 3.1. Terms Aggregation\n\nTerms Aggregation ç¨äºè¯é¡¹çåç»èåãæä¸ºç»å¸çç¨ä¾æ¯è·å X ä¸­æé¢ç¹ï¼top frequentï¼çé¡¹ç®ï¼å¶ä¸­ X æ¯ææ¡£ä¸­çæä¸ªå­æ®µï¼å¦ç¨æ·çåç§°ãæ ç­¾æåç±»ãç±äº terms èéç»è®¡çæ¯æ¯ä¸ªè¯æ¡ï¼èä¸æ¯æ´ä¸ªå­æ®µå¼ï¼å æ­¤éå¸¸éè¦å¨ä¸ä¸ªéåæåçå­æ®µä¸è¿è¡è¿ç§èéãåå æ¯, ä½ ææâbig dataâä½ä¸ºè¯ç»ç»è®¡ï¼èä¸æ¯âbigâåç¬ç»è®¡ä¸æ¬¡ï¼âdataâååç¬ç»è®¡ä¸æ¬¡ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ terms èéï¼ä»åæåå­æ®µï¼å¦åå®¹ï¼ä¸­æ½åæä¸ºé¢ç¹çè¯æ¡ãè¿å¯ä»¥ä½¿ç¨è¿ç§ä¿¡æ¯æ¥çæä¸ä¸ªåè¯äºã\n\n{\n  "aggs": {\n    "profit_terms": {\n      "terms": { // terms èå å³é®å­\n        "field": "profit",\n        ......\n      }\n    }\n  }\n}\n\n\nå¨ terms åæ¡¶çåºç¡ä¸ï¼è¿å¯ä»¥å¯¹æ¯ä¸ªæ¡¶è¿è¡ææ ç»è®¡ï¼ä¹å¯ä»¥åºäºä¸äºææ æå­æ®µå¼è¿è¡æåºãç¤ºä¾å¦ä¸ï¼\n\n{\n  "aggs": {\n    "item_terms": {\n      "terms": {\n        "field": "item_id",\n        "size": 1000,\n        "order":[{\n          "gmv_stat": "desc"\n        },{\n          "gmv_180d": "desc"\n        }]\n      },\n      "aggs": {\n        "gmv_stat": {\n          "sum": {\n            "field": "gmv"\n          }\n        },\n        "gmv_180d": {\n          "sum": {\n            "script": "doc[\'gmv_90d\'].value*2"\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åçç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hospital_id_agg": {\n      "doc_count_error_upper_bound": 0,\n      "sum_other_doc_count": 260,\n      "buckets": [\n        {\n          "key": 23388,\n          "doc_count": 18,\n          "gmv_stat": {\n            "value": 176220\n          },\n          "gmv_180d": {\n            "value": 89732\n          }\n        },\n        {\n          "key": 96117,\n          "doc_count": 16,\n          "gmv_stat": {\n            "value": 129306\n          },\n          "gmv_180d": {\n            "value": 56988\n          }\n        },\n        ...\n      ]\n    }\n  }\n}\n\n\né»è®¤æåµä¸è¿åæææ¡£è®¡æ°ä»é«å°ä½çå 10 ä¸ªåç»ï¼å¯ä»¥éè¿ size åæ°æå®è¿åçåç»æ°ã\n\n\n# 3.2. Filter Aggregation\n\nFilter Aggregation æ¯è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åè¿æ»¤å¨ä¸­çæ¡ä»¶çææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ï¼å³æ¯ååç»èåã\n\n{\n  "aggs": {\n    "age_terms": {\n      "filter": {"match":{"gender":"F"}},\n      "aggs": {\n        "avg_age": {\n          "avg": {\n            "field": "age"\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# 3.3. Filters Aggregation\n\nFilters Aggregation æ¯å¤è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åå¤ä¸ªè¿æ»¤æ¡ä»¶çææ¡£åå°ä¸åçæ¡¶ä¸­ï¼å³æ¯ä¸ªåç»å³èä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼å¹¶æ¶éæææ»¡è¶³èªèº«è¿æ»¤æ¡ä»¶çææ¡£ã\n\n{\n  "size": 0,\n  "aggs": {\n    "messages": {\n      "filters": {\n        "filters": {\n          "errors": { "match": { "body": "error" } },\n          "warnings": { "match": { "body": "warning" } }\n        }\n      }\n    }\n  }\n}\n\n\nå¨è¿ä¸ªä¾å­éï¼æä»¬åææ¥å¿ä¿¡æ¯ãèåä¼åå»ºä¸¤ä¸ªå³äºæ¥å¿æ°æ®çåç»ï¼ä¸ä¸ªæ¶éåå«éè¯¯ä¿¡æ¯çææ¡£ï¼å¦ä¸ä¸ªæ¶éåå«åè­¦ä¿¡æ¯çææ¡£ãèä¸æ¯ä¸ªåç»ä¼ææä»½ååã\n\n{\n  ...\n  "aggregations": {\n    "messages": {\n      "buckets": {\n        "errors": {\n          "doc_count": 1\n        },\n        "warnings": {\n          "doc_count": 2\n        }\n      }\n    }\n  }\n}\n\n\n\n# 3.4. Range Aggregation\n\nRange Aggregation èå´èåæ¯ä¸ä¸ªåºäºå¤ç»å¼æ¥æºçèåï¼å¯ä»¥è®©ç¨æ·å®ä¹ä¸ç³»åèå´ï¼æ¯ä¸ªèå´ä»£è¡¨ä¸ä¸ªåç»ãå¨èåæ§è¡çè¿ç¨ä¸­ï¼ä»æ¯ä¸ªææ¡£æååºæ¥çå¼é½ä¼æ£æ¥æ¯ä¸ªåç»çèå´ï¼å¹¶ä¸ä½¿ç¸å³çææ¡£è½å¥åç»ä¸­ãæ³¨æï¼èå´èåçæ¯ä¸ªèå´ååå« from å¼ä½æ¯æé¤ to å¼ã\n\n{\n  "aggs": {\n    "age_range": {\n      "range": {\n        "field": "age",\n          "ranges": [{\n            "to": 25\n          },\n          {\n            "from": 25,\n            "to": 35\n          },\n          {\n            "from": 35\n          }]\n        },\n        "aggs": {\n          "bmax": {\n            "max": {\n              "field": "balance"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "age_range": {\n      "buckets": [{\n        "key": "*-25.0",\n        "to": 25,\n        "doc_count": 225,\n        "bmax": {\n          "value": 49587\n        }\n      },\n      {\n        "key": "25.0-35.0",\n        "from": 25,\n        "to": 35,\n        "doc_count": 485,\n        "bmax": {\n          "value": 49795\n        }\n      },\n      {\n        "key": "35.0-*",\n        "from": 35,\n        "doc_count": 290,\n        "bmax": {\n          "value": 49989\n        }\n      }]\n    }\n  }\n}\n\n\n\n# 4. åèèµæ\n\n * Elasticsearch æç¨',normalizedContent:'# elasticsearch èå\n\nelasticsearch æ¯ä¸ä¸ªåå¸å¼çå¨ææç´¢å¼æï¼ç´¢å¼åæç´¢æ¯ elasticsearch çåºæ¬åè½ãäºå®ä¸ï¼elasticsearch çèåï¼aggregationsï¼åè½ä¹ååå¼ºå¤§ï¼åè®¸å¨æ°æ®ä¸åå¤æçåæç»è®¡ãelasticsearch æä¾çèååæåè½ä¸»è¦æææ èå(metrics aggregations)ãæ¡¶èå(bucket aggregations)ãç®¡éèå(pipeline aggregations) å ç©éµèå(matrix aggregations) åå¤§ç±»ï¼ç®¡éèååç©éµèåå®æ¹è¯´ææ¯å¨è¯éªé¶æ®µï¼åæä¼å®å¨æ´æ¹æèç§»é¤ï¼è¿éä¸åå¯¹ç®¡éèååç©éµèåè¿è¡è®²è§£ã\n\n * 1. èåçå·ä½ç»æ\n * 2. ææ èå\n   * 2.1. max aggregation\n   * 2.2. min aggregation\n   * 2.3. avg aggregation\n   * 2.4. sum aggregation\n   * 2.5. value count aggregation\n   * 2.6. cardinality aggregation\n   * 2.7. stats aggregation\n   * 2.8. extended stats aggregation\n   * 2.9. percentiles aggregation\n   * 2.10. percentiles ranks aggregation\n * 3. æ¡¶èå\n   * 3.1. terms aggregation\n   * 3.2. filter aggregation\n   * 3.3. filters aggregation\n   * 3.4. range aggregation\n * 4. åèèµæ\n\n\n# 1. èåçå·ä½ç»æ\n\nææçèåï¼æ è®ºå®ä»¬æ¯ä»ä¹ç±»åï¼é½éµä»ä»¥ä¸çè§åã\n\n * ä½¿ç¨æ¥è¯¢ä¸­åæ ·ç json è¯·æ±æ¥å®ä¹å®ä»¬ï¼èä¸ä½ æ¯ä½¿ç¨é® aggregations æèæ¯ aggs æ¥è¿è¡æ è®°ãéè¦ç»æ¯ä¸ªèåèµ·ä¸ä¸ªåå­ï¼æå®å®çç±»åä»¥ååè¯¥ç±»åç¸å³çéé¡¹ã\n * å®ä»¬è¿è¡å¨æ¥è¯¢çç»æä¹ä¸ãåæ¥è¯¢ä¸å¹éçææ¡£ä¸ä¼è®¡ç®å¨åï¼é¤éä½ ä½¿ç¨ global èéå°ä¸å¹éçææ¡£åæ¬å¶ä¸­ã\n * å¯ä»¥è¿ä¸æ­¥è¿æ»¤æ¥è¯¢çç»æï¼èä¸å½±åèéã\n\nä»¥ä¸æ¯èåçåºæ¬ç»æï¼\n\n"aggregations" : { \x3c!-- æå¤å±çèåé®ï¼ä¹å¯ä»¥ç¼©åä¸º aggs --\x3e\n    "<aggregation_name>" : { \x3c!-- èåçèªå®ä¹åå­ --\x3e\n        "<aggregation_type>" : { \x3c!-- èåçç±»åï¼ææ ç¸å³çï¼å¦ maxãminãavgãsumï¼æ¡¶ç¸å³ç termsãfilter ç­ --\x3e\n            <aggregation_body> \x3c!-- èåä½ï¼å¯¹åªäºå­æ®µè¿è¡èåï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æ --\x3e\n        }\n        [,"meta" : {  [<meta_data_body>] } ]? \x3c!-- å --\x3e\n        [,"aggregations" : { [<sub_aggregation>]+ } ]? \x3c!-- å¨èåéé¢å¨å®ä¹å­èå --\x3e\n    }\n    [,"<aggregation_name_2>" : { ... } ]* \x3c!-- èåçèªå®ä¹åå­ 2 --\x3e\n}\n\n\n * å¨æä¸å±æä¸ä¸ª aggregations çé®ï¼å¯ä»¥ç¼©åä¸º aggsã\n * å¨ä¸é¢ä¸å±ï¼éè¦ä¸ºèåæå®ä¸ä¸ªåå­ãå¯ä»¥å¨è¯·æ±çè¿åä¸­çå°è¿ä¸ªåå­ãå¨åä¸ä¸ªè¯·æ±ä¸­ä½¿ç¨å¤ä¸ªèåæ¶ï¼è¿ä¸ç¹éå¸¸æç¨ï¼å®è®©ä½ å¯ä»¥å¾å®¹æå°çè§£æ¯ç»ç»æçå«ä¹ã\n * æåï¼å¿é¡»è¦æå®èåçç±»åã\n\n> å³äºèååæçå¼æ¥æºï¼å¯ä»¥åå­æ®µçå¼ï¼ä¹å¯ä»¥æ¯èæ¬è®¡ç®çç»æã\n> \n> ä½æ¯ç¨èæ¬è®¡ç®çç»ææ¶ï¼éè¦æ³¨æèæ¬çæ§è½åå®å¨æ§ï¼å°½ç®¡å¤æ°èéç±»ååè®¸ä½¿ç¨èæ¬ï¼ä½æ¯èæ¬ä½¿å¾èéåå¾ç¼æ¢ï¼å ä¸ºèæ¬å¿é¡»å¨æ¯ç¯ææ¡£ä¸è¿è¡ãä¸ºäºé¿åèæ¬çè¿è¡ï¼å¯ä»¥å¨ç´¢å¼é¶æ®µè¿è¡è®¡ç®ã\n> \n> æ­¤å¤ï¼èæ¬ä¹å¯ä»¥è¢«äººå¯è½å©ç¨è¿è¡æ¶æä»£ç æ»å»ï¼å°½éä½¿ç¨æ²çï¼sandboxï¼åçèæ¬è¯­è¨ã\n\nç¤ºä¾ï¼æ¥è¯¢ææçåçå¹³åå¹´é¾æ¯å¤å°ï¼å¹¶å¯¹çåçå¹³åèªæ°´å  188ï¼ä¹å¯ä»¥çè§£ä¸ºæ¯åçåå  188 åçå¹³åèªæ°´ï¼ã\n\npost /player/_search?size=0\n{\n  "aggs": {\n    "avg_age": {\n      "avg": {\n        "field": "age"\n      }\n    },\n    "avg_salary_188": {\n      "avg": {\n        "script": {\n          "source": "doc.salary.value + 188"\n        }\n      }\n    }\n  }\n}\n\n\n\n# 2. ææ èå\n\nææ èåï¼åç§°åº¦éèåï¼ä¸»è¦ä»ä¸åææ¡£çåç»ä¸­æåç»è®¡æ°æ®ï¼æèï¼ä»æ¥èªå¶ä»èåçææ¡£æ¡¶æ¥æåç»è®¡æ°æ®ã\n\nè¿äºç»è®¡æ°æ®éå¸¸æ¥èªæ°å¼åå­æ®µï¼å¦æå°æèå¹³åä»·æ ¼ãç¨æ·å¯ä»¥åç¬è·åæ¯é¡¹ç»è®¡æ°æ®ï¼æèä¹å¯ä»¥ä½¿ç¨ stats èåæ¥åæ¶è·åå®ä»¬ãæ´é«çº§çç»è®¡æ°æ®ï¼å¦å¹³æ¹åæèæ¯æ åå·®ï¼å¯ä»¥éè¿ extended stats èåæ¥è·åã\n\n\n# 2.1. max aggregation\n\nmax aggregation ç¨äºæå¤§å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æé«çæ¯åªæ¬ä¹¦ï¼å¹¶ä¸è®¡ç®åºå¯¹åºçä»·æ ¼ç 2 åå¼ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /sales/_search?size=0\n{\n  "aggs" : {\n    "max_price" : {\n      "max" : {\n        "field" : "price"\n      }\n    },\n    "max_price_2" : {\n      "max" : {\n        "field" : "price",\n        "script": {\n          "source": "_value * 2.0"\n        }\n      }\n    }\n  }\n}\n\n\næå®ç fieldï¼å¨èæ¬ä¸­å¯ä»¥ç¨ _value åå­æ®µçå¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "max_price": {\n      "value": 188.0\n    },\n    "max_price_2": {\n      "value": 376.0\n    }\n  }\n}\n\n\n\n# 2.2. min aggregation\n\nmin aggregation ç¨äºæå°å¼ç»è®¡ãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ä»·æ ¼æä½çæ¯åªæ¬ä¹¦ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /sales/_search?size=0\n{\n  "aggs" : {\n    "min_price" : {\n      "min" : {\n        "field" : "price"\n      }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "min_price": {\n      "value": 18.0\n    }\n  }\n}\n\n\n\n# 2.3. avg aggregation\n\navg aggregation ç¨äºè®¡ç®å¹³åå¼ãä¾å¦ï¼ç»è®¡ exams ç´¢å¼ä¸­èè¯çå¹³ååæ°ï¼å¦æªå­å¨åæ°ï¼é»è®¤ä¸º 60 åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "aggs" : {\n    "avg_grade" : {\n      "avg" : {\n        "field" : "grade",\n        "missing": 60\n      }\n    }\n  }\n}\n\n\nå¦ææå®å­æ®µæ²¡æå¼ï¼å¯ä»¥éè¿ missing æå®é»è®¤å¼ï¼è¥æªæå®é»è®¤å¼ï¼ç¼ºå¤±è¯¥å­æ®µå¼çææ¡£å°è¢«å¿½ç¥ï¼è®¡ç®ï¼ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "avg_grade": {\n      "value": 78.0\n    }\n  }\n}\n\n\né¤äºå¸¸è§çå¹³åå¼èåè®¡ç®å¤ï¼elasticsearch è¿æä¾äºå æå¹³åå¼çèåè®¡ç®ï¼è¯¦æåè§ elasticsearch ææ èåä¹ weighted avg aggregationã\n\n\n# 2.4. sum aggregation\n\nsum aggregation ç¨äºè®¡ç®æ»åãä¾å¦ï¼ç»è®¡ sales ç´¢å¼ä¸­ type å­æ®µä¸­å¹é hat çä»·æ ¼æ»åï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "query" : {\n    "constant_score" : {\n      "filter" : {\n        "match" : { "type" : "hat" }\n      }\n    }\n  },\n  "aggs" : {\n    "hat_prices" : {\n      "sum" : { "field" : "price" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hat_prices": {\n      "value": 567.0\n    }\n  }\n}\n\n\n\n# 2.5. value count aggregation\n\nvalue count aggregation å¯æå­æ®µç»è®¡ææ¡£æ°éãä¾å¦ï¼ç»è®¡ books ç´¢å¼ä¸­åå« author å­æ®µçææ¡£æ°éï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search?size=0\n{\n  "aggs" : {\n    "doc_count" : {\n      "value_count" : { "field" : "author" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "doc_count": {\n      "value": 5\n    }\n  }\n}\n\n\n\n# 2.6. cardinality aggregation\n\ncardinality aggregation ç¨äºåºæ°ç»è®¡ï¼å¶ä½ç¨æ¯åæ§è¡ç±»ä¼¼ sql ä¸­ç distinct æä½ï¼å»æéåä¸­çéå¤é¡¹ï¼ç¶åç»è®¡å»éåçéåé¿åº¦ãä¾å¦ï¼å¨ books ç´¢å¼ä¸­å¯¹ language å­æ®µè¿è¡ cardinality æä½å¯ä»¥ç»è®¡åºç¼ç¨è¯­è¨çç§ç±»æ°ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /books/_search?size=0\n{\n  "aggs" : {\n    "all_lan" : {\n      "cardinality" : { "field" : "language" }\n    },\n    "title_cnt" : {\n      "cardinality" : { "field" : "title.keyword" }\n    }\n  }\n}\n\n\nåè®¾ title å­æ®µä¸ºææ¬ç±»åï¼textï¼ï¼å»éæ¶éè¦æå® keywordï¼è¡¨ç¤ºæ title ä½ä¸ºæ´ä½å»éï¼å³ä¸åè¯ç»è®¡ã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "all_lan": {\n      "value": 8\n    },\n    "title_cnt": {\n      "value": 18\n    }\n  }\n}\n\n\n\n# 2.7. stats aggregation\n\nstats aggregation ç¨äºåºæ¬ç»è®¡ï¼ä¼ä¸æ¬¡è¿å countãmaxãminãavg å sum è¿ 5 ä¸ªææ ãä¾å¦ï¼å¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çåºæ¬ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0\n    }\n  }\n}\n\n\n\n# 2.8. extended stats aggregation\n\nextended stats aggregation ç¨äºé«çº§ç»è®¡ï¼ååºæ¬ç»è®¡åè½ç±»ä¼¼ï¼ä½æ¯ä¼æ¯åºæ¬ç»è®¡å¤åºä»¥ä¸å ä¸ªç»è®¡ç»æï¼sum_of_squaresï¼å¹³æ¹åï¼ãvarianceï¼æ¹å·®ï¼ãstd_deviationï¼æ åå·®ï¼ãstd_deviation_boundsï¼å¹³åå¼å /åä¸¤ä¸ªæ åå·®çåºé´ï¼ãå¨ exams ç´¢å¼ä¸­å¯¹ grade å­æ®µè¿è¡åæ°ç¸å³çé«çº§ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget /exams/_search?size=0\n{\n  "aggs" : {\n    "grades_stats" : {\n      "extended_stats" : { "field" : "grade" }\n    }\n  }\n}\n\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "grades_stats": {\n      "count": 2,\n      "min": 50.0,\n      "max": 100.0,\n      "avg": 75.0,\n      "sum": 150.0,\n      "sum_of_squares": 12500.0,\n      "variance": 625.0,\n      "std_deviation": 25.0,\n      "std_deviation_bounds": {\n        "upper": 125.0,\n        "lower": 25.0\n      }\n    }\n  }\n}\n\n\n\n# 2.9. percentiles aggregation\n\npercentiles aggregation ç¨äºç¾åä½ç»è®¡ãç¾åä½æ°æ¯ä¸ä¸ªç»è®¡å­¦æ¯è¯­ï¼å¦æå°ä¸ç»æ°æ®ä»å¤§å°å°æåºï¼å¹¶è®¡ç®ç¸åºçç´¯è®¡ç¾åä½ï¼æä¸ç¾åä½æå¯¹åºæ°æ®çå¼å°±ç§°ä¸ºè¿ä¸ç¾åä½çç¾åä½æ°ãé»è®¤æåµä¸ï¼ç´¯è®¡ç¾åä½ä¸º [ 1, 5, 25, 50, 75, 95, 99 ]ãä»¥ä¸ä¾å­ç»åºäºå¨ latency ç´¢å¼ä¸­å¯¹ load_time å­æ®µè¿è¡å è½½æ¶é´çç¾åä½ç»è®¡ï¼æ¥è¯¢è¯­å¥å¦ä¸ï¼\n\nget latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time"\n      }\n    }\n  }\n}\n\n\néè¦æ³¨æçæ¯ï¼å¦ä¸ç load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nèåç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_outlier": {\n      "values" : {\n        "1.0": 5.0,\n        "5.0": 25.0,\n        "25.0": 165.0,\n        "50.0": 445.0,\n        "75.0": 725.0,\n        "95.0": 945.0,\n        "99.0": 985.0\n      }\n    }\n  }\n}\n\n\nç¾åä½çç»è®¡ä¹å¯ä»¥æå® percents åæ°æå®ç¾åä½ï¼å¦ä¸ï¼\n\nget latency/_search\n{\n  "size": 0,\n  "aggs" : {\n    "load_time_outlier" : {\n      "percentiles" : {\n        "field" : "load_time",\n        "percents": [60, 80, 95]\n      }\n    }\n  }\n}\n\n\n\n# 2.10. percentiles ranks aggregation\n\npercentiles ranks aggregation ä¸ percentiles aggregation ç»è®¡æ°æ°ç¸åï¼å°±æ¯æ³çå½åæ°å¼å¤å¨ä»ä¹èå´åï¼ç¾åä½ï¼ï¼ åå¦ä½ æ¥ä¸ä¸å½åå¼ 500 å 600 æå¤çç¾åä½ï¼åç°æ¯ 90.01 å 100ï¼é£ä¹è¯´ææ 90.01 % çæ°å¼é½å¨ 500 ä»¥åï¼100 % çæ°å¼å¨ 600 ä»¥åã\n\nget latency/_search\n{\n  "size": 0,\n    "aggs" : {\n      "load_time_ranks" : {\n        "percentile_ranks" : {\n          "field" : "load_time",\n          "values" : [500, 600]\n        }\n      }\n  }\n}\n\n\nåæ · load_time å­æ®µå¿é¡»æ¯æ°å­ç±»åã\n\nè¿åç»æå¤§æ¦ç±»ä¼¼å¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values" : {\n        "500.0": 90.01,\n        "600.0": 100.0\n      }\n    }\n  }\n}\n\n\nå¯ä»¥è®¾ç½® keyed åæ°ä¸º trueï¼å°å¯¹åºç values ä½ä¸ºæ¡¶ key ä¸èµ·è¿åï¼é»è®¤æ¯ falseã\n\nget latency/_search\n{\n  "size": 0,\n  "aggs": {\n    "load_time_ranks": {\n      "percentile_ranks": {\n        "field": "load_time",\n        "values": [500, 600],\n        "keyed": true\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "load_time_ranks": {\n      "values": [\n        {\n          "key": 500.0,\n          "value": 90.01\n        },\n        {\n          "key": 600.0,\n          "value": 100.0\n        }\n      ]\n    }\n  }\n}\n\n\n\n# 3. æ¡¶èå\n\nbucket å¯ä»¥çè§£ä¸ºä¸ä¸ªæ¡¶ï¼å®ä¼éåææ¡£ä¸­çåå®¹ï¼å¡æ¯ç¬¦åæä¸è¦æ±çå°±æ¾å¥ä¸ä¸ªæ¡¶ä¸­ï¼åæ¡¶ç¸å½äº sql ä¸­ç group byãä»å¦å¤ä¸ä¸ªè§åº¦ï¼å¯ä»¥å°ææ èåçæåæ¡¶èåï¼å³æææææ¡£æ¾å°ä¸ä¸ªæ¡¶ä¸­ï¼èæ¡¶èåæ¯å¤æ¡¶åèåï¼å®æ ¹æ®ç¸åºçæ¡ä»¶è¿è¡åç»ã\n\nç§ç±»                                      æè¿°/åºæ¯\nè¯é¡¹èåï¼terms aggregationï¼                 ç¨äºåç»èåï¼è®©ç¨æ·å¾ç¥ææ¡£ä¸­æ¯ä¸ªè¯é¡¹çé¢çï¼å®è¿åæ¯ä¸ªè¯é¡¹åºç°çæ¬¡æ°ã\nå·®å¼è¯é¡¹èåï¼significant terms aggregationï¼   å®ä¼è¿åæä¸ªè¯é¡¹å¨æ´ä¸ªç´¢å¼ä¸­åå¨æ¥è¯¢ç»æä¸­çè¯é¢å·®å¼ï¼è¿æå©äºæä»¬åç°æç´¢åºæ¯ä¸­ææä¹çè¯ã\nè¿æ»¤å¨èåï¼filter aggregationï¼               æå®è¿æ»¤å¨å¹éçææææ¡£å°åä¸ªæ¡¶ï¼bucketï¼ï¼éå¸¸è¿å°ç¨äºå°å½åèåä¸ä¸æç¼©å°å°ä¸ç»ç¹å®çææ¡£ã\nå¤è¿æ»¤å¨èåï¼filters aggregationï¼             æå®å¤ä¸ªè¿æ»¤å¨å¹éææææ¡£å°å¤ä¸ªæ¡¶ï¼bucketï¼ã\nèå´èåï¼range aggregationï¼                 èå´èåï¼ç¨äºåæ æ°æ®çåå¸æåµã\næ¥æèå´èåï¼date range aggregationï¼          ä¸é¨ç¨äºæ¥æç±»åçèå´èåã\nip èå´èåï¼ip range aggregationï¼           ç¨äºå¯¹ ip ç±»åæ°æ®èå´èåã\nç´æ¹å¾èåï¼histogram aggregationï¼            å¯è½æ¯æ°å¼ï¼æèæ¥æåï¼åèå´èéç±»ä¼¼ã\næ¶é´ç´æ¹å¾èåï¼date histogram aggregationï¼     æ¶é´ç´æ¹å¾èåï¼å¸¸ç¨äºæç§æ¥æå¯¹ææ¡£è¿è¡ç»è®¡å¹¶ç»å¶æ¡å½¢å¾ã\nç©ºå¼èåï¼missing aggregationï¼               ç©ºå¼èåï¼å¯ä»¥æææ¡£éä¸­ææç¼ºå¤±å­æ®µçææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ã\nå°çç¹èå´èåï¼geo distance aggregationï¼       ç¨äºå¯¹å°çç¹ï¼geo pointï¼åèå´ç»è®¡ã\n\n\n# 3.1. terms aggregation\n\nterms aggregation ç¨äºè¯é¡¹çåç»èåãæä¸ºç»å¸çç¨ä¾æ¯è·å x ä¸­æé¢ç¹ï¼top frequentï¼çé¡¹ç®ï¼å¶ä¸­ x æ¯ææ¡£ä¸­çæä¸ªå­æ®µï¼å¦ç¨æ·çåç§°ãæ ç­¾æåç±»ãç±äº terms èéç»è®¡çæ¯æ¯ä¸ªè¯æ¡ï¼èä¸æ¯æ´ä¸ªå­æ®µå¼ï¼å æ­¤éå¸¸éè¦å¨ä¸ä¸ªéåæåçå­æ®µä¸è¿è¡è¿ç§èéãåå æ¯, ä½ ææâbig dataâä½ä¸ºè¯ç»ç»è®¡ï¼èä¸æ¯âbigâåç¬ç»è®¡ä¸æ¬¡ï¼âdataâååç¬ç»è®¡ä¸æ¬¡ã\n\nç¨æ·å¯ä»¥ä½¿ç¨ terms èéï¼ä»åæåå­æ®µï¼å¦åå®¹ï¼ä¸­æ½åæä¸ºé¢ç¹çè¯æ¡ãè¿å¯ä»¥ä½¿ç¨è¿ç§ä¿¡æ¯æ¥çæä¸ä¸ªåè¯äºã\n\n{\n  "aggs": {\n    "profit_terms": {\n      "terms": { // terms èå å³é®å­\n        "field": "profit",\n        ......\n      }\n    }\n  }\n}\n\n\nå¨ terms åæ¡¶çåºç¡ä¸ï¼è¿å¯ä»¥å¯¹æ¯ä¸ªæ¡¶è¿è¡ææ ç»è®¡ï¼ä¹å¯ä»¥åºäºä¸äºææ æå­æ®µå¼è¿è¡æåºãç¤ºä¾å¦ä¸ï¼\n\n{\n  "aggs": {\n    "item_terms": {\n      "terms": {\n        "field": "item_id",\n        "size": 1000,\n        "order":[{\n          "gmv_stat": "desc"\n        },{\n          "gmv_180d": "desc"\n        }]\n      },\n      "aggs": {\n        "gmv_stat": {\n          "sum": {\n            "field": "gmv"\n          }\n        },\n        "gmv_180d": {\n          "sum": {\n            "script": "doc[\'gmv_90d\'].value*2"\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åçç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "hospital_id_agg": {\n      "doc_count_error_upper_bound": 0,\n      "sum_other_doc_count": 260,\n      "buckets": [\n        {\n          "key": 23388,\n          "doc_count": 18,\n          "gmv_stat": {\n            "value": 176220\n          },\n          "gmv_180d": {\n            "value": 89732\n          }\n        },\n        {\n          "key": 96117,\n          "doc_count": 16,\n          "gmv_stat": {\n            "value": 129306\n          },\n          "gmv_180d": {\n            "value": 56988\n          }\n        },\n        ...\n      ]\n    }\n  }\n}\n\n\né»è®¤æåµä¸è¿åæææ¡£è®¡æ°ä»é«å°ä½çå 10 ä¸ªåç»ï¼å¯ä»¥éè¿ size åæ°æå®è¿åçåç»æ°ã\n\n\n# 3.2. filter aggregation\n\nfilter aggregation æ¯è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åè¿æ»¤å¨ä¸­çæ¡ä»¶çææ¡£åå°ä¸ä¸ªæ¡¶ä¸­ï¼å³æ¯ååç»èåã\n\n{\n  "aggs": {\n    "age_terms": {\n      "filter": {"match":{"gender":"f"}},\n      "aggs": {\n        "avg_age": {\n          "avg": {\n            "field": "age"\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# 3.3. filters aggregation\n\nfilters aggregation æ¯å¤è¿æ»¤å¨èåï¼å¯ä»¥æç¬¦åå¤ä¸ªè¿æ»¤æ¡ä»¶çææ¡£åå°ä¸åçæ¡¶ä¸­ï¼å³æ¯ä¸ªåç»å³èä¸ä¸ªè¿æ»¤æ¡ä»¶ï¼å¹¶æ¶éæææ»¡è¶³èªèº«è¿æ»¤æ¡ä»¶çææ¡£ã\n\n{\n  "size": 0,\n  "aggs": {\n    "messages": {\n      "filters": {\n        "filters": {\n          "errors": { "match": { "body": "error" } },\n          "warnings": { "match": { "body": "warning" } }\n        }\n      }\n    }\n  }\n}\n\n\nå¨è¿ä¸ªä¾å­éï¼æä»¬åææ¥å¿ä¿¡æ¯ãèåä¼åå»ºä¸¤ä¸ªå³äºæ¥å¿æ°æ®çåç»ï¼ä¸ä¸ªæ¶éåå«éè¯¯ä¿¡æ¯çææ¡£ï¼å¦ä¸ä¸ªæ¶éåå«åè­¦ä¿¡æ¯çææ¡£ãèä¸æ¯ä¸ªåç»ä¼ææä»½ååã\n\n{\n  ...\n  "aggregations": {\n    "messages": {\n      "buckets": {\n        "errors": {\n          "doc_count": 1\n        },\n        "warnings": {\n          "doc_count": 2\n        }\n      }\n    }\n  }\n}\n\n\n\n# 3.4. range aggregation\n\nrange aggregation èå´èåæ¯ä¸ä¸ªåºäºå¤ç»å¼æ¥æºçèåï¼å¯ä»¥è®©ç¨æ·å®ä¹ä¸ç³»åèå´ï¼æ¯ä¸ªèå´ä»£è¡¨ä¸ä¸ªåç»ãå¨èåæ§è¡çè¿ç¨ä¸­ï¼ä»æ¯ä¸ªææ¡£æååºæ¥çå¼é½ä¼æ£æ¥æ¯ä¸ªåç»çèå´ï¼å¹¶ä¸ä½¿ç¸å³çææ¡£è½å¥åç»ä¸­ãæ³¨æï¼èå´èåçæ¯ä¸ªèå´ååå« from å¼ä½æ¯æé¤ to å¼ã\n\n{\n  "aggs": {\n    "age_range": {\n      "range": {\n        "field": "age",\n          "ranges": [{\n            "to": 25\n          },\n          {\n            "from": 25,\n            "to": 35\n          },\n          {\n            "from": 35\n          }]\n        },\n        "aggs": {\n          "bmax": {\n            "max": {\n              "field": "balance"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n\nè¿åç»æå¦ä¸ï¼\n\n{\n  ...\n  "aggregations": {\n    "age_range": {\n      "buckets": [{\n        "key": "*-25.0",\n        "to": 25,\n        "doc_count": 225,\n        "bmax": {\n          "value": 49587\n        }\n      },\n      {\n        "key": "25.0-35.0",\n        "from": 25,\n        "to": 35,\n        "doc_count": 485,\n        "bmax": {\n          "value": 49795\n        }\n      },\n      {\n        "key": "35.0-*",\n        "from": 35,\n        "doc_count": 290,\n        "bmax": {\n          "value": 49989\n        }\n      }]\n    }\n  }\n}\n\n\n\n# 4. åèèµæ\n\n * elasticsearch æç¨',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch åæå¨",frontmatter:{title:"Elasticsearch åæå¨",date:"2022-02-22T21:01:01.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","åæå¨"],permalink:"/pages/c04143/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/09.Elasticsearch%E5%88%86%E6%9E%90%E5%99%A8.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/09.Elasticsearchåæå¨.md",key:"v-3afd3137",path:"/pages/c04143/",headers:[{level:2,title:"1. å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼",slug:"_1-å­ç¬¦è¿æ»¤å¨-character-filters",normalizedTitle:"1. å­ç¬¦è¿æ»¤å¨ï¼character filtersï¼",charIndex:220},{level:3,title:"1.1. HTML strip character filter",slug:"_1-1-html-strip-character-filter",normalizedTitle:"1.1. html strip character filter",charIndex:253},{level:3,title:"1.2. Mapping character filter",slug:"_1-2-mapping-character-filter",normalizedTitle:"1.2. mapping character filter",charIndex:291},{level:3,title:"1.3. Pattern Replace character filter",slug:"_1-3-pattern-replace-character-filter",normalizedTitle:"1.3. pattern replace character filter",charIndex:326},{level:2,title:"2. åè¯å¨ï¼Tokenizerï¼",slug:"_2-åè¯å¨-tokenizer",normalizedTitle:"2. åè¯å¨ï¼tokenizerï¼",charIndex:367},{level:3,title:"2.1. elasticsearch-plugin ä½¿ç¨",slug:"_2-1-elasticsearch-plugin-ä½¿ç¨",normalizedTitle:"2.1. elasticsearch-plugin ä½¿ç¨",charIndex:390},{level:3,title:"2.2. elasticsearch-analysis-ik å®è£",slug:"_2-2-elasticsearch-analysis-ik-å®è£",normalizedTitle:"2.2. elasticsearch-analysis-ik å®è£",charIndex:424},{level:3,title:"2.3. elasticsearch-analysis-ik ä½¿ç¨",slug:"_2-3-elasticsearch-analysis-ik-ä½¿ç¨",normalizedTitle:"2.3. elasticsearch-analysis-ik ä½¿ç¨",charIndex:463},{level:4,title:"ç´¢å¼ mapping è®¾ç½®",slug:"ç´¢å¼-mapping-è®¾ç½®",normalizedTitle:"ç´¢å¼ mapping è®¾ç½®",charIndex:4069},{level:4,title:"æ¥ç ik åè¯ç»æ",slug:"æ¥ç-ik-åè¯ç»æ",normalizedTitle:"æ¥ç ik åè¯ç»æ",charIndex:4832},{level:4,title:"elasticsearch-analysis-ik èªå®ä¹è¯å¸",slug:"elasticsearch-analysis-ik-èªå®ä¹è¯å¸",normalizedTitle:"elasticsearch-analysis-ik èªå®ä¹è¯å¸",charIndex:5499},{level:2,title:"3. è¯åè¿æ»¤å¨ï¼Token Filtersï¼",slug:"_3-è¯åè¿æ»¤å¨-token-filters",normalizedTitle:"3. è¯åè¿æ»¤å¨ï¼token filtersï¼",charIndex:500},{level:3,title:"3.1. åä¹è¯",slug:"_3-1-åä¹è¯",normalizedTitle:"3.1. åä¹è¯",charIndex:529},{level:4,title:"åä¹è¯ï¼synonymï¼éç½®è¯­æ³",slug:"åä¹è¯-synonym-éç½®è¯­æ³",normalizedTitle:"åä¹è¯ï¼synonymï¼éç½®è¯­æ³",charIndex:7188},{level:4,title:"åä¹è¯ææ¡£æ ¼å¼",slug:"åä¹è¯ææ¡£æ ¼å¼",normalizedTitle:"åä¹è¯ææ¡£æ ¼å¼",charIndex:7688},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:541}],headersStr:"1. å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼ 1.1. HTML strip character filter 1.2. Mapping character filter 1.3. Pattern Replace character filter 2. åè¯å¨ï¼Tokenizerï¼ 2.1. elasticsearch-plugin ä½¿ç¨ 2.2. elasticsearch-analysis-ik å®è£ 2.3. elasticsearch-analysis-ik ä½¿ç¨ ç´¢å¼ mapping è®¾ç½® æ¥ç ik åè¯ç»æ elasticsearch-analysis-ik èªå®ä¹è¯å¸ 3. è¯åè¿æ»¤å¨ï¼Token Filtersï¼ 3.1. åä¹è¯ åä¹è¯ï¼synonymï¼éç½®è¯­æ³ åä¹è¯ææ¡£æ ¼å¼ 4. åèèµæ",content:'# Elasticsearch åæå¨\n\nå¨ ES ä¸­ï¼ä¸ç®¡æ¯ç´¢å¼ä»»å¡è¿æ¯æç´¢å·¥ä½ï¼é½éè¦ä½¿ç¨ analyzerï¼åæå¨ï¼ãåæå¨ï¼åä¸ºåç½®åæå¨åèªå®ä¹çåæå¨ã\n\nåæå¨è¿ä¸æ­¥ç±å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼ãåè¯å¨ï¼Tokenizerï¼åè¯åè¿æ»¤å¨ï¼Token Filtersï¼ä¸é¨åç»æãå®çæ§è¡é¡ºåºå¦ä¸ï¼\n\ncharacter filters -> tokenizer -> token filters\n\n * 1. å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼\n   * 1.1. HTML strip character filter\n   * 1.2. Mapping character filter\n   * 1.3. Pattern Replace character filter\n * 2. åè¯å¨ï¼Tokenizerï¼\n   * 2.1. elasticsearch-plugin ä½¿ç¨\n   * 2.2. elasticsearch-analysis-ik å®è£\n   * 2.3. elasticsearch-analysis-ik ä½¿ç¨\n * 3. è¯åè¿æ»¤å¨ï¼Token Filtersï¼\n   * 3.1. åä¹è¯\n * 4. åèèµæ\n\n\n# 1. å­ç¬¦è¿æ»¤å¨ï¼Character Filtersï¼\n\ncharacter filter çè¾å¥æ¯åå§çææ¬ textï¼å¦æéç½®äºå¤ä¸ªï¼å®ä¼æç§éç½®çé¡ºåºæ§è¡ï¼ç®å ES èªå¸¦ç character filter ä¸»è¦ç±å¦ä¸ 3 ç±»ï¼\n\n 1. html strip character filterï¼ä»ææ¬ä¸­å¥ç¦» HTML åç´ ï¼å¹¶ç¨å¶è§£ç å¼æ¿æ¢ HTML å®ä½ï¼å¦ï¼å° ï¼amp; æ¿æ¢ä¸º ï¼ï¼ã\n 2. mapping character filterï¼èªå®ä¹ä¸ä¸ª map æ å°ï¼å¯ä»¥è¿è¡ä¸äºèªå®ä¹çæ¿æ¢ï¼å¦å¸¸ç¨çå¤§ååå°åä¹å¯ä»¥å¨è¯¥ç¯èè®¾ç½®ã\n 3. pattern replace character filterï¼ä½¿ç¨ java æ­£åè¡¨è¾¾å¼æ¥å¹éåºæ¿æ¢ä¸ºæå®æ¿æ¢å­ç¬¦ä¸²çå­ç¬¦ï¼æ­¤å¤ï¼æ¿æ¢å­ç¬¦ä¸²å¯ä»¥å¼ç¨æ­£åè¡¨è¾¾å¼ä¸­çæè·ç»ã\n\n\n# 1.1. HTML strip character filter\n\nHTML strip å¦ä¸ç¤ºä¾ï¼\n\nGET /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    "html_strip"\n  ],\n  "text": "<p>I&apos;m so <b>happy</b>!</p>"\n}\n\n\nç»è¿ html_strip å­ç¬¦è¿æ»¤å¨å¤çåï¼è¾åºå¦ä¸ï¼\n\n[ \\nI\'m so happy!\\n ]\n\n\n\n# 1.2. Mapping character filter\n\nMapping character filter æ¥æ¶é®åå¼æ å°ï¼key => valueï¼ä½ä¸ºéç½®åæ°ï¼æ¯å½å¨é¢å¤çè¿ç¨ä¸­éå°ä¸é®å¼æ å°ä¸­çé®ç¸åçå­ç¬¦ä¸²æ¶ï¼å°±ä¼ä½¿ç¨è¯¥é®å¯¹åºçå¼å»æ¿æ¢å®ã\n\nåå§ææ¬ä¸­çå­ç¬¦ä¸²åé®å¼æ å°ä¸­çé®çå¹éæ¯è´ªå¿çï¼å¨å¯¹ç»å®çææ¬è¿è¡é¢å¤çè¿ç¨ä¸­å¦æéç½®çé®å¼æ å°å­å¨åå«å³ç³»ï¼ä¼ä¼åå¹éæé¿é®ãåæ ·ä¹å¯ä»¥ç¨ç©ºå­ç¬¦ä¸²è¿è¡æ¿æ¢ã\n\nmapping char_filter ä¸å html_strip é£æ ·æç®±å³å¯ç¨ï¼å¿é¡»åè¿è¡éç½®æè½ä½¿ç¨ï¼å®æä¸¤ä¸ªå±æ§å¯ä»¥éç½®ï¼\n\nåæ°åç§°            åæ°è¯´æ\nmappings        ä¸ç»æ å°ï¼æ¯ä¸ªåç´ çæ ¼å¼ä¸º key => valueã\nmappings_path   ä¸ä¸ªç¸å¯¹æèç»å¯¹çæä»¶è·¯å¾ï¼æåä¸ä¸ªæ¯è¡åå«ä¸ä¸ª key =>value æ å°ç UTF-8 ç¼ç ææ¬æ å°æä»¶ã\n\nmapping char_filter ç¤ºä¾å¦ä¸ï¼\n\nGET /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    {\n      "type": "mapping",\n      "mappings": [\n        "Ù  => 0",\n        "Ù¡ => 1",\n        "Ù¢ => 2",\n        "Ù£ => 3",\n        "Ù¤ => 4",\n        "Ù¥ => 5",\n        "Ù¦ => 6",\n        "Ù§ => 7",\n        "Ù¨ => 8",\n        "Ù© => 9"\n      ]\n    }\n  ],\n  "text": "My license plate is Ù¢Ù¥Ù Ù¡Ù¥"\n}\n\n\nåæç»æå¦ä¸ï¼\n\n[ My license plate is 25015 ]\n\n\n\n# 1.3. Pattern Replace character filter\n\nPattern Replace character filter æ¯æå¦ä¸ä¸ä¸ªåæ°ï¼\n\nåæ°åç§°          åæ°è¯´æ\npattern       å¿å¡«åæ°ï¼ä¸ä¸ª java çæ­£åè¡¨è¾¾å¼ã\nreplacement   æ¿æ¢å­ç¬¦ä¸²ï¼å¯ä»¥ä½¿ç¨ $1 ... $9 è¯­æ³æ¥å¼ç¨æè·ç»ã\nflags         Java æ­£åè¡¨è¾¾å¼çæ å¿ï¼å·ä½åè java ç java.util.regex.Pattern ç±»çæ å¿å±æ§ã\n\nå¦å°è¾å¥ç text ä¸­å¤§äºä¸ä¸ªçç©ºæ ¼é½è½¬åä¸ºä¸ä¸ªç©ºæ ¼ï¼å¨ settings æ¶ï¼éç½®ç¤ºä¾å¦ä¸ï¼\n\n"char_filter": {\n  "multi_space_2_one": {\n    "pattern": "[ ]+",\n    "type": "pattern_replace",\n    "replacement": " "\n  },\n  ...\n}\n\n\n\n# 2. åè¯å¨ï¼Tokenizerï¼\n\ntokenizer å³åè¯å¨ï¼ä¹æ¯ analyzer æéè¦çç»ä»¶ï¼å®å¯¹ææ¬è¿è¡åè¯ï¼ä¸ä¸ª analyzer å¿éä¸åªå¯åå«ä¸ä¸ª tokenizerã\n\nES èªå¸¦é»è®¤çåè¯å¨æ¯ standard tokenizerï¼æ ååè¯å¨æä¾åºäºè¯­æ³çåè¯ï¼åºäº Unicode ææ¬åå²ç®æ³ï¼ï¼å¹¶ä¸éç¨äºå¤§å¤æ°è¯­è¨ã\n\næ­¤å¤æå¾å¤ç¬¬ä¸æ¹çåè¯æä»¶ï¼å¦ä¸­æåè¯çæç»å¸ç ik åè¯å¨ï¼å®å¯¹åºç tokenizer åä¸º ik_smart å ik_max_wordï¼ä¸ä¸ªæ¯æºè½åè¯ï¼éå¯¹æç´¢ä¾§ï¼ï¼ä¸ä¸ªæ¯å¨ååè¯ï¼éå¯¹ç´¢å¼ä¾§ï¼ã\n\nES é»è®¤æä¾çåè¯å¨ standard å¯¹ä¸­æåè¯ä¸ä¼åï¼ææå·®ï¼ä¸è¬ä¼å®è£ç¬¬ä¸æ¹ä¸­æåè¯æä»¶ï¼éå¸¸é¦å elasticsearch-analysis-ik æä»¶ï¼å®å¶å®æ¯ ik éå¯¹ç ES çå®å¶çã\n\n\n# 2.1. elasticsearch-plugin ä½¿ç¨\n\nå¨å®è£ elasticsearch-analysis-ik ç¬¬ä¸æ¹ä¹åï¼æä»¬é¦åè¦äºè§£ es çæä»¶ç®¡çå·¥å· elasticsearch-plugin çä½¿ç¨ã\n\nç°å¨ç elasticsearch å®è£å®åï¼å¨å®è£ç®å½ç bin ç®å½ä¸ä¼å­å¨ elasticsearch-plugin å½ä»¤å·¥å·ï¼ç¨å®æ¥å¯¹ es æä»¶è¿è¡ç®¡çã\n\nbin/elasticsearch-plugin\n\n\nå¶å®è¯¥å½ä»¤çæ¯è½¯è¿æ¥ï¼åå§è·¯å¾æ¯ï¼\n\nlibexec/bin/elasticsearch-plugin\n\n\nåè¿ä¸æ­¥çèæ¬ä»£ç ï¼ä½ ä¼åç°ï¼å®æ¯éè¿ elasticsearch-cli æ§è¡ libexec/lib/tools/plugin-cli/elasticsearch-plugin-cli-x.x.x.jarã\n\nä½ä¸è¬ä½¿ç¨èäºè§£ elasticsearch-plugin å½ä»¤ä½¿ç¨å°±å¯ï¼\n\n#  å®è£æå®çæä»¶å°å½å ES èç¹ä¸­\nelasticsearch-plugin install {plugin_url}\n\n#  æ¾ç¤ºå½å ES èç¹å·²ç»å®è£çæä»¶åè¡¨\nelasticsearch-plugin list\n\n#  å é¤å·²å®è£çæä»¶\nelasticsearch-plugin remove {plugin_name}\n\n\n> å¨å®è£æä»¶æ¶ï¼è¦ä¿è¯å®è£çæä»¶ä¸ ES çæ¬ä¸è´ã\n\n\n# 2.2. elasticsearch-analysis-ik å®è£\n\nå¨ç¡®å®è¦å®è£ç ik çæ¬ä¹åï¼æ§è¡å¦ä¸å½ä»¤ï¼\n\n./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v{X.X.X}/elasticsearch-analysis-ik-{X.X.X}.zip\n\n\næ§è¡å®å®è£å½ä»¤åï¼æä»¬ä¼åç°å¨ plugins ä¸­å¤äº analysis-ik ç®å½ï¼è¿éé¢ä¸»è¦å­æ¾çæ¯æºç  jar åï¼æ­¤å¤ï¼å¨ config æä»¶éä¹å¤äº analysis-ik ç®å½ï¼éé¢ä¸»è¦æ¯ ik ç¸å³çéç½®ï¼å¦ IKAnalyzer.cfg.xml éç½®ãè¯å¸æä»¶ç­ã\n\n#  ä¸¤ä¸ªæ°å¢ç®å½è·¯å¾\nlibexec/plugins/analysis-ik/\nlibexec/config/analysis-ik/\n\n\n\n# 2.3. elasticsearch-analysis-ik ä½¿ç¨\n\nES 5.X çæ¬å¼å§å®è£å®ç elasticsearch-analysis-ik æä¾äºä¸¤ä¸ªåè¯å¨ï¼åå«å¯¹åºåç§°æ¯ ik_max_word å ik_smartï¼ik_max_word æ¯ç´¢å¼ä¾§çåè¯å¨ï¼èµ°å¨åæ¨¡å¼ï¼ik_smart æ¯æç´¢ä¾§çåè¯å¨ï¼èµ°æºè½åè¯ï¼å±äºæç´¢æ¨¡å¼ã\n\n# ç´¢å¼ mapping è®¾ç½®\n\nå®è£å® elasticsearch-analysis-ik åï¼æä»¬å¯ä»¥æå®ç´¢å¼åæå®å­æ®µè®¾ç½®å¯ç¨çåæå¨ï¼analyzerï¼ï¼ç¤ºä¾å¦ä¸ï¼\n\n{\n  "qa": {\n    "mappings": {\n      "qa": {\n        "_all": {\n          "enabled": false\n        },\n        "properties": {\n          "question": {\n            "type": "text",\n            "store": true,\n            "similarity": "BM25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          "answer": {\n            "type": "text",\n            "store": false,\n            "similarity": "BM25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          ...\n        }\n      }\n    }\n  }\n}\n\n\nå¦ä¸ç¤ºä¾ä¸­ï¼analyzer æå® ik_max_wordï¼å³ç´¢å¼ä¾§ä½¿ç¨ ik å¨åæ¨¡å¼ï¼search_analyzer è®¾ç½® ik_smartï¼å³æç´¢ä¾§ä½¿ç¨ ik æºè½åè¯æ¨¡å¼ã\n\n# æ¥ç ik åè¯ç»æ\n\nes æä¾äºæ¥çåè¯ç»æç api analyzeï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nGET {index}/_analyze\n{\n  "analyzer" : "ik_smart",\n  "text" : "es ä¸­æåè¯å¨å®è£"\n}\n\n\nè¾åºå¦ä¸ï¼\n\n{\n  "tokens": [\n    {\n      "token": "es",\n      "start_offset": 0,\n      "end_offset": 2,\n      "type": "CN_WORD",\n      "position": 0\n    },\n    {\n      "token": "ä¸­æ",\n      "start_offset": 3,\n      "end_offset": 5,\n      "type": "CN_WORD",\n      "position": 1\n    },\n    {\n      "token": "åè¯å¨",\n      "start_offset": 5,\n      "end_offset": 8,\n      "type": "CN_WORD",\n      "position": 2\n    },\n    {\n      "token": "å®è£",\n      "start_offset": 8,\n      "end_offset": 10,\n      "type": "CN_WORD",\n      "position": 3\n    }\n  ]\n}\n\n\n# elasticsearch-analysis-ik èªå®ä¹è¯å¸\n\nelasticsearch-analysis-ik æ¬è´¨æ¯ ik åè¯å¨ï¼ä½¿ç¨èæ ¹æ®å®ééæ±å¯ä»¥æ©å±èªå®ä¹çè¯å¸ï¼å·ä½ä¸»è¦åä¸ºå¦ä¸ 2 å¤§ç±»ï¼æ¯ç±»ååä¸ºæ¬å°éç½®åè¿ç¨éç½® 2 ç§ï¼\n\n 1. èªå®ä¹æ©å±è¯å¸ï¼\n 2. èªå®ä¹æ©å±åç¨è¯å¸ï¼\n\nelasticsearch-analysis-ik éç½®æä»¶ä¸º IKAnalyzer.cfg.xmlï¼å®ä½äº libexec/config/analysis-ik ç®å½ä¸ï¼å·ä½éç½®ç»æå¦ä¸ï¼\n\n<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">\n<properties>\n\t<comment>IK Analyzer æ©å±éç½®</comment>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±å­å¸ --\x3e\n\t<entry key="ext_dict"></entry>\n\t \x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±åæ­¢è¯å­å¸--\x3e\n\t<entry key="ext_stopwords"></entry>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±å­å¸ --\x3e\n\t\x3c!-- <entry key="remote_ext_dict">words_location</entry> --\x3e\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±åæ­¢è¯å­å¸--\x3e\n\t\x3c!-- <entry key="remote_ext_stopwords">words_location</entry> --\x3e\n</properties>\n\n\n> å½ç¶ï¼å¦æå¼åèè®¤ä¸º ik é»è®¤çè¯è¡¨æé®é¢ï¼ä¹å¯ä»¥è¿è¡è°æ´ï¼æä»¶é½å¨ libexec/config/analysis-ik ä¸ï¼å¦ main.dic ä¸ºä¸»è¯å¸ï¼stopword.dic ä¸ºåç¨è¯è¡¨ã\n\n\n# 3. è¯åè¿æ»¤å¨ï¼Token Filtersï¼\n\ntoken filters å«è¯åè¿æ»¤å¨ï¼æè¯é¡¹è¿æ»¤å¨ï¼å¯¹ tokenizer ååºçè¯è¿è¡è¿æ»¤å¤çãå¸¸ç¨çæè½¬å°åãåç¨è¯å¤çãåä¹è¯å¤çç­ç­ãä¸ä¸ª analyzer å¯åå« 0 ä¸ªæå¤ä¸ªè¯é¡¹è¿æ»¤å¨ï¼æéç½®é¡ºåºè¿è¡è¿æ»¤ã\n\nä»¥åä¹è¯è¿æ»¤å¨çä½¿ç¨ç¤ºä¾ï¼å·ä½å¦ä¸ï¼\n\nPUT /test_index\n{\n  "settings": {\n    "index": {\n      "analysis": {\n        "analyzer": {\n          "synonym": {\n            "tokenizer": "standard",\n            "filter": [ "my_stop", "synonym" ]\n          }\n        },\n        "filter": {\n          "my_stop": {\n            "type": "stop",\n            "stopwords": [ "bar" ]\n          },\n          "synonym": {\n            "type": "synonym",\n            "lenient": true,\n            "synonyms": [ "foo, bar => baz" ]\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# 3.1. åä¹è¯\n\nElasticsearch åä¹è¯éè¿ä¸æçåä¹è¯è¿æ»¤å¨ï¼synonym token filterï¼æ¥è¿è¡å·¥ä½ï¼å®åè®¸å¨åæï¼analysisï¼è¿ç¨ä¸­æ¹ä¾¿å°å¤çåä¹è¯ï¼ä¸è¬æ¯éè¿éç½®æä»¶éç½®åä¹è¯ãæ­¤å¤ï¼åä¹è¯å¯ä»¥åå»ºç´¢å¼æ¶ï¼index-time synonymsï¼æèæ£ç´¢æ¶ï¼search-time synonymsï¼ä½¿ç¨ã\n\n# åä¹è¯ï¼synonymï¼éç½®è¯­æ³\n\nå¦ä¸ä¾å­æç¤ºï¼es åä¹è¯éç½®ç filter è¯­æ³å·ä½å¦ä¸éé¡¹ï¼\n\n * typeï¼æå® synonymï¼è¡¨ç¤ºåä¹è¯ filterï¼\n\n * synonyms_pathï¼æå®åä¹è¯éç½®æä»¶è·¯å¾ï¼\n\n * expandï¼è¯¥åæ°å³å®æ å°è¡ä¸ºçæ¨¡å¼ï¼é»è®¤ä¸º trueï¼è¡¨ç¤ºæ©å±æ¨¡å¼ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n   \n   * å½ expand == true æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod, i-pod, i pod\n     \n     \n     å½ expand == false æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ä»æ å°ç¬¬ä¸ä¸ªåè¯ï¼ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod\n     \n\n * lenientï¼å¦æå¼ä¸º true æ¶ï¼éå°é£äºæ æ³è§£æçåä¹è¯è§åæ¶ï¼å¿½ç¥å¼å¸¸ãé»è®¤ä¸º falseã\n\n# åä¹è¯ææ¡£æ ¼å¼\n\nelasticsearch çåä¹è¯æå¦ä¸ä¸¤ç§å½¢å¼ï¼\n\n * åååä¹è¯ï¼\n   \n   ipod, i-pod, i pod => ipod\n   \n\n * åååä¹è¯ï¼\n   \n   é©¬éè¯, åè±, potato\n   \n\nåååä¹è¯ä¸ç®¡ç´¢å¼è¿æ¯æ£ç´¢æ¶ï¼ç®­å¤´å·¦ä¾§çè¯é½ä¼æ å°æç®­å¤´å³ä¾§çè¯ï¼\n\nåååä¹è¯æ¯ç´¢å¼æ¶ï¼é½å»ºç«åä¹è¯çåæç´¢å¼ï¼æ£ç´¢æ¶ï¼åä¹è¯ä¹é´é½ä¼è¿è¡åæç´¢å¼çå¹éã\n\n> åä¹è¯çææ¡£åæ¶ï¼éè¦æ³¨æçæ¯ï¼åä¸ä¸ªè¯å¨ä¸åçåä¹è¯å³ç³»ä¸­åºç°æ¶ï¼å¶å®åä¹è¯ä¹é´ä¸å·æä¼ éæ§ï¼è¿ç¹éè¦æ³¨æã\n\nåè®¾å¦ä¸ç¤ºä¾ä¸­ï¼å¦æâé©¬éè¯âåå¶å®ä¸¤ä¸ªåä¹è¯åæä¸¤è¡åï¼\n\né©¬éè¯,åè±\né©¬éè¯,potato\n\n\næ­¤æ¶ï¼elasticsearch ä¸­ä¸ä¼å°âåè±âåâpotatoâè§ä¸ºåä¹è¯å³ç³»ï¼æä»¥å¤ä¸ªåä¹è¯è¦åå¨ä¸èµ·ï¼è¿å¾å¾æ¯å¼åä¸­ç»å¸¸å®¹æçå¿½çç¹ã\n\n\n# 4. åèèµæ\n\n * Elasticsearch æç¨',normalizedContent:'# elasticsearch åæå¨\n\nå¨ es ä¸­ï¼ä¸ç®¡æ¯ç´¢å¼ä»»å¡è¿æ¯æç´¢å·¥ä½ï¼é½éè¦ä½¿ç¨ analyzerï¼åæå¨ï¼ãåæå¨ï¼åä¸ºåç½®åæå¨åèªå®ä¹çåæå¨ã\n\nåæå¨è¿ä¸æ­¥ç±å­ç¬¦è¿æ»¤å¨ï¼character filtersï¼ãåè¯å¨ï¼tokenizerï¼åè¯åè¿æ»¤å¨ï¼token filtersï¼ä¸é¨åç»æãå®çæ§è¡é¡ºåºå¦ä¸ï¼\n\ncharacter filters -> tokenizer -> token filters\n\n * 1. å­ç¬¦è¿æ»¤å¨ï¼character filtersï¼\n   * 1.1. html strip character filter\n   * 1.2. mapping character filter\n   * 1.3. pattern replace character filter\n * 2. åè¯å¨ï¼tokenizerï¼\n   * 2.1. elasticsearch-plugin ä½¿ç¨\n   * 2.2. elasticsearch-analysis-ik å®è£\n   * 2.3. elasticsearch-analysis-ik ä½¿ç¨\n * 3. è¯åè¿æ»¤å¨ï¼token filtersï¼\n   * 3.1. åä¹è¯\n * 4. åèèµæ\n\n\n# 1. å­ç¬¦è¿æ»¤å¨ï¼character filtersï¼\n\ncharacter filter çè¾å¥æ¯åå§çææ¬ textï¼å¦æéç½®äºå¤ä¸ªï¼å®ä¼æç§éç½®çé¡ºåºæ§è¡ï¼ç®å es èªå¸¦ç character filter ä¸»è¦ç±å¦ä¸ 3 ç±»ï¼\n\n 1. html strip character filterï¼ä»ææ¬ä¸­å¥ç¦» html åç´ ï¼å¹¶ç¨å¶è§£ç å¼æ¿æ¢ html å®ä½ï¼å¦ï¼å° ï¼amp; æ¿æ¢ä¸º ï¼ï¼ã\n 2. mapping character filterï¼èªå®ä¹ä¸ä¸ª map æ å°ï¼å¯ä»¥è¿è¡ä¸äºèªå®ä¹çæ¿æ¢ï¼å¦å¸¸ç¨çå¤§ååå°åä¹å¯ä»¥å¨è¯¥ç¯èè®¾ç½®ã\n 3. pattern replace character filterï¼ä½¿ç¨ java æ­£åè¡¨è¾¾å¼æ¥å¹éåºæ¿æ¢ä¸ºæå®æ¿æ¢å­ç¬¦ä¸²çå­ç¬¦ï¼æ­¤å¤ï¼æ¿æ¢å­ç¬¦ä¸²å¯ä»¥å¼ç¨æ­£åè¡¨è¾¾å¼ä¸­çæè·ç»ã\n\n\n# 1.1. html strip character filter\n\nhtml strip å¦ä¸ç¤ºä¾ï¼\n\nget /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    "html_strip"\n  ],\n  "text": "<p>i&apos;m so <b>happy</b>!</p>"\n}\n\n\nç»è¿ html_strip å­ç¬¦è¿æ»¤å¨å¤çåï¼è¾åºå¦ä¸ï¼\n\n[ \\ni\'m so happy!\\n ]\n\n\n\n# 1.2. mapping character filter\n\nmapping character filter æ¥æ¶é®åå¼æ å°ï¼key => valueï¼ä½ä¸ºéç½®åæ°ï¼æ¯å½å¨é¢å¤çè¿ç¨ä¸­éå°ä¸é®å¼æ å°ä¸­çé®ç¸åçå­ç¬¦ä¸²æ¶ï¼å°±ä¼ä½¿ç¨è¯¥é®å¯¹åºçå¼å»æ¿æ¢å®ã\n\nåå§ææ¬ä¸­çå­ç¬¦ä¸²åé®å¼æ å°ä¸­çé®çå¹éæ¯è´ªå¿çï¼å¨å¯¹ç»å®çææ¬è¿è¡é¢å¤çè¿ç¨ä¸­å¦æéç½®çé®å¼æ å°å­å¨åå«å³ç³»ï¼ä¼ä¼åå¹éæé¿é®ãåæ ·ä¹å¯ä»¥ç¨ç©ºå­ç¬¦ä¸²è¿è¡æ¿æ¢ã\n\nmapping char_filter ä¸å html_strip é£æ ·æç®±å³å¯ç¨ï¼å¿é¡»åè¿è¡éç½®æè½ä½¿ç¨ï¼å®æä¸¤ä¸ªå±æ§å¯ä»¥éç½®ï¼\n\nåæ°åç§°            åæ°è¯´æ\nmappings        ä¸ç»æ å°ï¼æ¯ä¸ªåç´ çæ ¼å¼ä¸º key => valueã\nmappings_path   ä¸ä¸ªç¸å¯¹æèç»å¯¹çæä»¶è·¯å¾ï¼æåä¸ä¸ªæ¯è¡åå«ä¸ä¸ª key =>value æ å°ç utf-8 ç¼ç ææ¬æ å°æä»¶ã\n\nmapping char_filter ç¤ºä¾å¦ä¸ï¼\n\nget /_analyze\n{\n  "tokenizer": "keyword",\n  "char_filter": [\n    {\n      "type": "mapping",\n      "mappings": [\n        "Ù  => 0",\n        "Ù¡ => 1",\n        "Ù¢ => 2",\n        "Ù£ => 3",\n        "Ù¤ => 4",\n        "Ù¥ => 5",\n        "Ù¦ => 6",\n        "Ù§ => 7",\n        "Ù¨ => 8",\n        "Ù© => 9"\n      ]\n    }\n  ],\n  "text": "my license plate is Ù¢Ù¥Ù Ù¡Ù¥"\n}\n\n\nåæç»æå¦ä¸ï¼\n\n[ my license plate is 25015 ]\n\n\n\n# 1.3. pattern replace character filter\n\npattern replace character filter æ¯æå¦ä¸ä¸ä¸ªåæ°ï¼\n\nåæ°åç§°          åæ°è¯´æ\npattern       å¿å¡«åæ°ï¼ä¸ä¸ª java çæ­£åè¡¨è¾¾å¼ã\nreplacement   æ¿æ¢å­ç¬¦ä¸²ï¼å¯ä»¥ä½¿ç¨ $1 ... $9 è¯­æ³æ¥å¼ç¨æè·ç»ã\nflags         java æ­£åè¡¨è¾¾å¼çæ å¿ï¼å·ä½åè java ç java.util.regex.pattern ç±»çæ å¿å±æ§ã\n\nå¦å°è¾å¥ç text ä¸­å¤§äºä¸ä¸ªçç©ºæ ¼é½è½¬åä¸ºä¸ä¸ªç©ºæ ¼ï¼å¨ settings æ¶ï¼éç½®ç¤ºä¾å¦ä¸ï¼\n\n"char_filter": {\n  "multi_space_2_one": {\n    "pattern": "[ ]+",\n    "type": "pattern_replace",\n    "replacement": " "\n  },\n  ...\n}\n\n\n\n# 2. åè¯å¨ï¼tokenizerï¼\n\ntokenizer å³åè¯å¨ï¼ä¹æ¯ analyzer æéè¦çç»ä»¶ï¼å®å¯¹ææ¬è¿è¡åè¯ï¼ä¸ä¸ª analyzer å¿éä¸åªå¯åå«ä¸ä¸ª tokenizerã\n\nes èªå¸¦é»è®¤çåè¯å¨æ¯ standard tokenizerï¼æ ååè¯å¨æä¾åºäºè¯­æ³çåè¯ï¼åºäº unicode ææ¬åå²ç®æ³ï¼ï¼å¹¶ä¸éç¨äºå¤§å¤æ°è¯­è¨ã\n\næ­¤å¤æå¾å¤ç¬¬ä¸æ¹çåè¯æä»¶ï¼å¦ä¸­æåè¯çæç»å¸ç ik åè¯å¨ï¼å®å¯¹åºç tokenizer åä¸º ik_smart å ik_max_wordï¼ä¸ä¸ªæ¯æºè½åè¯ï¼éå¯¹æç´¢ä¾§ï¼ï¼ä¸ä¸ªæ¯å¨ååè¯ï¼éå¯¹ç´¢å¼ä¾§ï¼ã\n\nes é»è®¤æä¾çåè¯å¨ standard å¯¹ä¸­æåè¯ä¸ä¼åï¼ææå·®ï¼ä¸è¬ä¼å®è£ç¬¬ä¸æ¹ä¸­æåè¯æä»¶ï¼éå¸¸é¦å elasticsearch-analysis-ik æä»¶ï¼å®å¶å®æ¯ ik éå¯¹ç es çå®å¶çã\n\n\n# 2.1. elasticsearch-plugin ä½¿ç¨\n\nå¨å®è£ elasticsearch-analysis-ik ç¬¬ä¸æ¹ä¹åï¼æä»¬é¦åè¦äºè§£ es çæä»¶ç®¡çå·¥å· elasticsearch-plugin çä½¿ç¨ã\n\nç°å¨ç elasticsearch å®è£å®åï¼å¨å®è£ç®å½ç bin ç®å½ä¸ä¼å­å¨ elasticsearch-plugin å½ä»¤å·¥å·ï¼ç¨å®æ¥å¯¹ es æä»¶è¿è¡ç®¡çã\n\nbin/elasticsearch-plugin\n\n\nå¶å®è¯¥å½ä»¤çæ¯è½¯è¿æ¥ï¼åå§è·¯å¾æ¯ï¼\n\nlibexec/bin/elasticsearch-plugin\n\n\nåè¿ä¸æ­¥çèæ¬ä»£ç ï¼ä½ ä¼åç°ï¼å®æ¯éè¿ elasticsearch-cli æ§è¡ libexec/lib/tools/plugin-cli/elasticsearch-plugin-cli-x.x.x.jarã\n\nä½ä¸è¬ä½¿ç¨èäºè§£ elasticsearch-plugin å½ä»¤ä½¿ç¨å°±å¯ï¼\n\n#  å®è£æå®çæä»¶å°å½å es èç¹ä¸­\nelasticsearch-plugin install {plugin_url}\n\n#  æ¾ç¤ºå½å es èç¹å·²ç»å®è£çæä»¶åè¡¨\nelasticsearch-plugin list\n\n#  å é¤å·²å®è£çæä»¶\nelasticsearch-plugin remove {plugin_name}\n\n\n> å¨å®è£æä»¶æ¶ï¼è¦ä¿è¯å®è£çæä»¶ä¸ es çæ¬ä¸è´ã\n\n\n# 2.2. elasticsearch-analysis-ik å®è£\n\nå¨ç¡®å®è¦å®è£ç ik çæ¬ä¹åï¼æ§è¡å¦ä¸å½ä»¤ï¼\n\n./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v{x.x.x}/elasticsearch-analysis-ik-{x.x.x}.zip\n\n\næ§è¡å®å®è£å½ä»¤åï¼æä»¬ä¼åç°å¨ plugins ä¸­å¤äº analysis-ik ç®å½ï¼è¿éé¢ä¸»è¦å­æ¾çæ¯æºç  jar åï¼æ­¤å¤ï¼å¨ config æä»¶éä¹å¤äº analysis-ik ç®å½ï¼éé¢ä¸»è¦æ¯ ik ç¸å³çéç½®ï¼å¦ ikanalyzer.cfg.xml éç½®ãè¯å¸æä»¶ç­ã\n\n#  ä¸¤ä¸ªæ°å¢ç®å½è·¯å¾\nlibexec/plugins/analysis-ik/\nlibexec/config/analysis-ik/\n\n\n\n# 2.3. elasticsearch-analysis-ik ä½¿ç¨\n\nes 5.x çæ¬å¼å§å®è£å®ç elasticsearch-analysis-ik æä¾äºä¸¤ä¸ªåè¯å¨ï¼åå«å¯¹åºåç§°æ¯ ik_max_word å ik_smartï¼ik_max_word æ¯ç´¢å¼ä¾§çåè¯å¨ï¼èµ°å¨åæ¨¡å¼ï¼ik_smart æ¯æç´¢ä¾§çåè¯å¨ï¼èµ°æºè½åè¯ï¼å±äºæç´¢æ¨¡å¼ã\n\n# ç´¢å¼ mapping è®¾ç½®\n\nå®è£å® elasticsearch-analysis-ik åï¼æä»¬å¯ä»¥æå®ç´¢å¼åæå®å­æ®µè®¾ç½®å¯ç¨çåæå¨ï¼analyzerï¼ï¼ç¤ºä¾å¦ä¸ï¼\n\n{\n  "qa": {\n    "mappings": {\n      "qa": {\n        "_all": {\n          "enabled": false\n        },\n        "properties": {\n          "question": {\n            "type": "text",\n            "store": true,\n            "similarity": "bm25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          "answer": {\n            "type": "text",\n            "store": false,\n            "similarity": "bm25",\n            "analyzer": "ik_max_word",\n            "search_analyzer": "ik_smart"\n          },\n          ...\n        }\n      }\n    }\n  }\n}\n\n\nå¦ä¸ç¤ºä¾ä¸­ï¼analyzer æå® ik_max_wordï¼å³ç´¢å¼ä¾§ä½¿ç¨ ik å¨åæ¨¡å¼ï¼search_analyzer è®¾ç½® ik_smartï¼å³æç´¢ä¾§ä½¿ç¨ ik æºè½åè¯æ¨¡å¼ã\n\n# æ¥ç ik åè¯ç»æ\n\nes æä¾äºæ¥çåè¯ç»æç api analyzeï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n\nget {index}/_analyze\n{\n  "analyzer" : "ik_smart",\n  "text" : "es ä¸­æåè¯å¨å®è£"\n}\n\n\nè¾åºå¦ä¸ï¼\n\n{\n  "tokens": [\n    {\n      "token": "es",\n      "start_offset": 0,\n      "end_offset": 2,\n      "type": "cn_word",\n      "position": 0\n    },\n    {\n      "token": "ä¸­æ",\n      "start_offset": 3,\n      "end_offset": 5,\n      "type": "cn_word",\n      "position": 1\n    },\n    {\n      "token": "åè¯å¨",\n      "start_offset": 5,\n      "end_offset": 8,\n      "type": "cn_word",\n      "position": 2\n    },\n    {\n      "token": "å®è£",\n      "start_offset": 8,\n      "end_offset": 10,\n      "type": "cn_word",\n      "position": 3\n    }\n  ]\n}\n\n\n# elasticsearch-analysis-ik èªå®ä¹è¯å¸\n\nelasticsearch-analysis-ik æ¬è´¨æ¯ ik åè¯å¨ï¼ä½¿ç¨èæ ¹æ®å®ééæ±å¯ä»¥æ©å±èªå®ä¹çè¯å¸ï¼å·ä½ä¸»è¦åä¸ºå¦ä¸ 2 å¤§ç±»ï¼æ¯ç±»ååä¸ºæ¬å°éç½®åè¿ç¨éç½® 2 ç§ï¼\n\n 1. èªå®ä¹æ©å±è¯å¸ï¼\n 2. èªå®ä¹æ©å±åç¨è¯å¸ï¼\n\nelasticsearch-analysis-ik éç½®æä»¶ä¸º ikanalyzer.cfg.xmlï¼å®ä½äº libexec/config/analysis-ik ç®å½ä¸ï¼å·ä½éç½®ç»æå¦ä¸ï¼\n\n<?xml version="1.0" encoding="utf-8"?>\n<!doctype properties system "http://java.sun.com/dtd/properties.dtd">\n<properties>\n\t<comment>ik analyzer æ©å±éç½®</comment>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±å­å¸ --\x3e\n\t<entry key="ext_dict"></entry>\n\t \x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®èªå·±çæ©å±åæ­¢è¯å­å¸--\x3e\n\t<entry key="ext_stopwords"></entry>\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±å­å¸ --\x3e\n\t\x3c!-- <entry key="remote_ext_dict">words_location</entry> --\x3e\n\t\x3c!--ç¨æ·å¯ä»¥å¨è¿ééç½®è¿ç¨æ©å±åæ­¢è¯å­å¸--\x3e\n\t\x3c!-- <entry key="remote_ext_stopwords">words_location</entry> --\x3e\n</properties>\n\n\n> å½ç¶ï¼å¦æå¼åèè®¤ä¸º ik é»è®¤çè¯è¡¨æé®é¢ï¼ä¹å¯ä»¥è¿è¡è°æ´ï¼æä»¶é½å¨ libexec/config/analysis-ik ä¸ï¼å¦ main.dic ä¸ºä¸»è¯å¸ï¼stopword.dic ä¸ºåç¨è¯è¡¨ã\n\n\n# 3. è¯åè¿æ»¤å¨ï¼token filtersï¼\n\ntoken filters å«è¯åè¿æ»¤å¨ï¼æè¯é¡¹è¿æ»¤å¨ï¼å¯¹ tokenizer ååºçè¯è¿è¡è¿æ»¤å¤çãå¸¸ç¨çæè½¬å°åãåç¨è¯å¤çãåä¹è¯å¤çç­ç­ãä¸ä¸ª analyzer å¯åå« 0 ä¸ªæå¤ä¸ªè¯é¡¹è¿æ»¤å¨ï¼æéç½®é¡ºåºè¿è¡è¿æ»¤ã\n\nä»¥åä¹è¯è¿æ»¤å¨çä½¿ç¨ç¤ºä¾ï¼å·ä½å¦ä¸ï¼\n\nput /test_index\n{\n  "settings": {\n    "index": {\n      "analysis": {\n        "analyzer": {\n          "synonym": {\n            "tokenizer": "standard",\n            "filter": [ "my_stop", "synonym" ]\n          }\n        },\n        "filter": {\n          "my_stop": {\n            "type": "stop",\n            "stopwords": [ "bar" ]\n          },\n          "synonym": {\n            "type": "synonym",\n            "lenient": true,\n            "synonyms": [ "foo, bar => baz" ]\n          }\n        }\n      }\n    }\n  }\n}\n\n\n\n# 3.1. åä¹è¯\n\nelasticsearch åä¹è¯éè¿ä¸æçåä¹è¯è¿æ»¤å¨ï¼synonym token filterï¼æ¥è¿è¡å·¥ä½ï¼å®åè®¸å¨åæï¼analysisï¼è¿ç¨ä¸­æ¹ä¾¿å°å¤çåä¹è¯ï¼ä¸è¬æ¯éè¿éç½®æä»¶éç½®åä¹è¯ãæ­¤å¤ï¼åä¹è¯å¯ä»¥åå»ºç´¢å¼æ¶ï¼index-time synonymsï¼æèæ£ç´¢æ¶ï¼search-time synonymsï¼ä½¿ç¨ã\n\n# åä¹è¯ï¼synonymï¼éç½®è¯­æ³\n\nå¦ä¸ä¾å­æç¤ºï¼es åä¹è¯éç½®ç filter è¯­æ³å·ä½å¦ä¸éé¡¹ï¼\n\n * typeï¼æå® synonymï¼è¡¨ç¤ºåä¹è¯ filterï¼\n\n * synonyms_pathï¼æå®åä¹è¯éç½®æä»¶è·¯å¾ï¼\n\n * expandï¼è¯¥åæ°å³å®æ å°è¡ä¸ºçæ¨¡å¼ï¼é»è®¤ä¸º trueï¼è¡¨ç¤ºæ©å±æ¨¡å¼ï¼å·ä½ç¤ºä¾å¦ä¸ï¼\n   \n   * å½ expand == true æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod, i-pod, i pod\n     \n     \n     å½ expand == false æ¶ï¼\n     \n     ipod, i-pod, i pod\n     \n     \n     ä»æ å°ç¬¬ä¸ä¸ªåè¯ï¼ç­ä»·äºï¼\n     \n     ipod, i-pod, i pod => ipod\n     \n\n * lenientï¼å¦æå¼ä¸º true æ¶ï¼éå°é£äºæ æ³è§£æçåä¹è¯è§åæ¶ï¼å¿½ç¥å¼å¸¸ãé»è®¤ä¸º falseã\n\n# åä¹è¯ææ¡£æ ¼å¼\n\nelasticsearch çåä¹è¯æå¦ä¸ä¸¤ç§å½¢å¼ï¼\n\n * åååä¹è¯ï¼\n   \n   ipod, i-pod, i pod => ipod\n   \n\n * åååä¹è¯ï¼\n   \n   é©¬éè¯, åè±, potato\n   \n\nåååä¹è¯ä¸ç®¡ç´¢å¼è¿æ¯æ£ç´¢æ¶ï¼ç®­å¤´å·¦ä¾§çè¯é½ä¼æ å°æç®­å¤´å³ä¾§çè¯ï¼\n\nåååä¹è¯æ¯ç´¢å¼æ¶ï¼é½å»ºç«åä¹è¯çåæç´¢å¼ï¼æ£ç´¢æ¶ï¼åä¹è¯ä¹é´é½ä¼è¿è¡åæç´¢å¼çå¹éã\n\n> åä¹è¯çææ¡£åæ¶ï¼éè¦æ³¨æçæ¯ï¼åä¸ä¸ªè¯å¨ä¸åçåä¹è¯å³ç³»ä¸­åºç°æ¶ï¼å¶å®åä¹è¯ä¹é´ä¸å·æä¼ éæ§ï¼è¿ç¹éè¦æ³¨æã\n\nåè®¾å¦ä¸ç¤ºä¾ä¸­ï¼å¦æâé©¬éè¯âåå¶å®ä¸¤ä¸ªåä¹è¯åæä¸¤è¡åï¼\n\né©¬éè¯,åè±\né©¬éè¯,potato\n\n\næ­¤æ¶ï¼elasticsearch ä¸­ä¸ä¼å°âåè±âåâpotatoâè§ä¸ºåä¹è¯å³ç³»ï¼æä»¥å¤ä¸ªåä¹è¯è¦åå¨ä¸èµ·ï¼è¿å¾å¾æ¯å¼åä¸­ç»å¸¸å®¹æçå¿½çç¹ã\n\n\n# 4. åèèµæ\n\n * elasticsearch æç¨',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch æ§è½ä¼å",frontmatter:{title:"Elasticsearch æ§è½ä¼å",date:"2022-01-21T19:54:43.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","æ§è½"],permalink:"/pages/dc6b0f/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/10.Elasticsearch%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/10.Elasticsearchæ§è½ä¼å.md",key:"v-16b255f9",path:"/pages/dc6b0f/",headers:[{level:2,title:"1. ç¡¬ä»¶éç½®ä¼å",slug:"_1-ç¡¬ä»¶éç½®ä¼å",normalizedTitle:"1. ç¡¬ä»¶éç½®ä¼å",charIndex:234},{level:3,title:"1.1. CPU éç½®",slug:"_1-1-cpu-éç½®",normalizedTitle:"1.1. cpu éç½®",charIndex:332},{level:3,title:"1.2. åå­éç½®",slug:"_1-2-åå­éç½®",normalizedTitle:"1.2. åå­éç½®",charIndex:595},{level:4,title:"åå­åé",slug:"åå­åé",normalizedTitle:"åå­åé",charIndex:1052},{level:4,title:"ç¦æ­¢ swap",slug:"ç¦æ­¢-swap",normalizedTitle:"ç¦æ­¢ swap",charIndex:1533},{level:4,title:"GC è®¾ç½®",slug:"gc-è®¾ç½®",normalizedTitle:"gc è®¾ç½®",charIndex:1655},{level:3,title:"1.3. ç£ç",slug:"_1-3-ç£ç",normalizedTitle:"1.3. ç£ç",charIndex:1892},{level:2,title:"2. ç´¢å¼ä¼åè®¾ç½®",slug:"_2-ç´¢å¼ä¼åè®¾ç½®",normalizedTitle:"2. ç´¢å¼ä¼åè®¾ç½®",charIndex:2737},{level:3,title:"2.1. æ¹éæäº¤",slug:"_2-1-æ¹éæäº¤",normalizedTitle:"2.1. æ¹éæäº¤",charIndex:2859},{level:3,title:"2.2. å¢å  Refresh æ¶é´é´é",slug:"_2-2-å¢å -refresh-æ¶é´é´é",normalizedTitle:"2.2. å¢å  refresh æ¶é´é´é",charIndex:3234},{level:3,title:"2.3. ä¿®æ¹ indexbuffersize çè®¾ç½®",slug:"_2-3-ä¿®æ¹-index-buffer-size-çè®¾ç½®",normalizedTitle:"2.3. ä¿®æ¹ indexbuffersize çè®¾ç½®",charIndex:null},{level:3,title:"2.4. ä¿®æ¹ translog ç¸å³çè®¾ç½®",slug:"_2-4-ä¿®æ¹-translog-ç¸å³çè®¾ç½®",normalizedTitle:"2.4. ä¿®æ¹ translog ç¸å³çè®¾ç½®",charIndex:4120},{level:3,title:"2.5. æ³¨æ _id å­æ®µçä½¿ç¨",slug:"_2-5-æ³¨æ-id-å­æ®µçä½¿ç¨",normalizedTitle:"2.5. æ³¨æ _id å­æ®µçä½¿ç¨",charIndex:4361},{level:3,title:"2.6. æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨",slug:"_2-6-æ³¨æ-all-å­æ®µå-source-å­æ®µçä½¿ç¨",normalizedTitle:"2.6. æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨",charIndex:4459},{level:3,title:"2.7. åççéç½®ä½¿ç¨ index å±æ§",slug:"_2-7-åççéç½®ä½¿ç¨-index-å±æ§",normalizedTitle:"2.7. åççéç½®ä½¿ç¨ index å±æ§",charIndex:4658},{level:3,title:"2.8. åå°å¯æ¬æ°é",slug:"_2-8-åå°å¯æ¬æ°é",normalizedTitle:"2.8. åå°å¯æ¬æ°é",charIndex:4797},{level:2,title:"3. æ¥è¯¢æ¹é¢ä¼å",slug:"_3-æ¥è¯¢æ¹é¢ä¼å",normalizedTitle:"3. æ¥è¯¢æ¹é¢ä¼å",charIndex:5004},{level:3,title:"3.1. è·¯ç±ä¼å",slug:"_3-1-è·¯ç±ä¼å",normalizedTitle:"3.1. è·¯ç±ä¼å",charIndex:5062},{level:4,title:"ä¸å¸¦ routing æ¥è¯¢",slug:"ä¸å¸¦-routing-æ¥è¯¢",normalizedTitle:"ä¸å¸¦ routing æ¥è¯¢",charIndex:5231},{level:4,title:"å¸¦ routing æ¥è¯¢",slug:"å¸¦-routing-æ¥è¯¢",normalizedTitle:"å¸¦ routing æ¥è¯¢",charIndex:5232},{level:3,title:"3.2. Filter VS Query",slug:"_3-2-filter-vs-query",normalizedTitle:"3.2. filter vs query",charIndex:5505},{level:3,title:"3.3. æ·±åº¦ç¿»é¡µ",slug:"_3-3-æ·±åº¦ç¿»é¡µ",normalizedTitle:"3.3. æ·±åº¦ç¿»é¡µ",charIndex:5698},{level:3,title:"3.4. èæ¬ï¼scriptï¼åçä½¿ç¨",slug:"_3-4-èæ¬-script-åçä½¿ç¨",normalizedTitle:"3.4. èæ¬ï¼scriptï¼åçä½¿ç¨",charIndex:6091},{level:2,title:"4. æ°æ®ç»æä¼å",slug:"_4-æ°æ®ç»æä¼å",normalizedTitle:"4. æ°æ®ç»æä¼å",charIndex:6321},{level:3,title:"4.1. å°½éåå°ä¸éè¦çå­æ®µ",slug:"_4-1-å°½éåå°ä¸éè¦çå­æ®µ",normalizedTitle:"4.1. å°½éåå°ä¸éè¦çå­æ®µ",charIndex:6390},{level:3,title:"4.2. Nested Object vs Parent/Child",slug:"_4-2-nested-object-vs-parent-child",normalizedTitle:"4.2. nested object vs parent/child",charIndex:6746},{level:3,title:"4.3. éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°",slug:"_4-3-éæ©éææ å°-éå¿éæ¶-ç¦æ­¢å¨ææ å°",normalizedTitle:"4.3. éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°",charIndex:7308},{level:2,title:"5. éç¾¤æ¶æè®¾è®¡",slug:"_5-éç¾¤æ¶æè®¾è®¡",normalizedTitle:"5. éç¾¤æ¶æè®¾è®¡",charIndex:7543},{level:3,title:"5.1. ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»",slug:"_5-1-ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»",normalizedTitle:"5.1. ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»",charIndex:7593},{level:4,title:"ä¸»ï¼masterï¼èç¹",slug:"ä¸»-master-èç¹",normalizedTitle:"ä¸»ï¼masterï¼èç¹",charIndex:7780},{level:4,title:"æ°æ®ï¼dataï¼èç¹",slug:"æ°æ®-data-èç¹",normalizedTitle:"æ°æ®ï¼dataï¼èç¹",charIndex:8166},{level:4,title:"åè°ï¼coordinatingï¼èç¹",slug:"åè°-coordinating-èç¹",normalizedTitle:"åè°ï¼coordinatingï¼èç¹",charIndex:9129},{level:3,title:"5.2. å³é­ data èç¹æå¡å¨ä¸­ç http åè½",slug:"_5-2-å³é­-data-èç¹æå¡å¨ä¸­ç-http-åè½",normalizedTitle:"5.2. å³é­ data èç¹æå¡å¨ä¸­ç http åè½",charIndex:9837},{level:3,title:"5.3. ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node",slug:"_5-3-ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª-node",normalizedTitle:"5.3. ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node",charIndex:10117},{level:3,title:"5.4. éç¾¤åçè®¾ç½®",slug:"_5-4-éç¾¤åçè®¾ç½®",normalizedTitle:"5.4. éç¾¤åçè®¾ç½®",charIndex:10246},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:10653}],headersStr:"1. ç¡¬ä»¶éç½®ä¼å 1.1. CPU éç½® 1.2. åå­éç½® åå­åé ç¦æ­¢ swap GC è®¾ç½® 1.3. ç£ç 2. ç´¢å¼ä¼åè®¾ç½® 2.1. æ¹éæäº¤ 2.2. å¢å  Refresh æ¶é´é´é 2.3. ä¿®æ¹ indexbuffersize çè®¾ç½® 2.4. ä¿®æ¹ translog ç¸å³çè®¾ç½® 2.5. æ³¨æ _id å­æ®µçä½¿ç¨ 2.6. æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨ 2.7. åççéç½®ä½¿ç¨ index å±æ§ 2.8. åå°å¯æ¬æ°é 3. æ¥è¯¢æ¹é¢ä¼å 3.1. è·¯ç±ä¼å ä¸å¸¦ routing æ¥è¯¢ å¸¦ routing æ¥è¯¢ 3.2. Filter VS Query 3.3. æ·±åº¦ç¿»é¡µ 3.4. èæ¬ï¼scriptï¼åçä½¿ç¨ 4. æ°æ®ç»æä¼å 4.1. å°½éåå°ä¸éè¦çå­æ®µ 4.2. Nested Object vs Parent/Child 4.3. éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å° 5. éç¾¤æ¶æè®¾è®¡ 5.1. ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦» ä¸»ï¼masterï¼èç¹ æ°æ®ï¼dataï¼èç¹ åè°ï¼coordinatingï¼èç¹ 5.2. å³é­ data èç¹æå¡å¨ä¸­ç http åè½ 5.3. ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node 5.4. éç¾¤åçè®¾ç½® 6. åèèµæ",content:"# Elasticsearch æ§è½ä¼å\n\nElasticsearch æ¯å½åæµè¡çä¼ä¸çº§æç´¢å¼æï¼è®¾è®¡ç¨äºäºè®¡ç®ä¸­ï¼è½å¤è¾¾å°å®æ¶æç´¢ï¼ç¨³å®ï¼å¯é ï¼å¿«éï¼å®è£ä½¿ç¨æ¹ä¾¿ãä½ä¸ºä¸ä¸ªå¼ç®±å³ç¨çäº§åï¼å¨çäº§ç¯å¢ä¸çº¿ä¹åï¼æä»¬å¶å®ä¸ä¸å®è½ç¡®ä¿å¶çæ§è½åç¨³å®æ§ãå¦ä½æ ¹æ®å®éæåµæé«æå¡çæ§è½ï¼å¶å®æå¾å¤æå·§ãè¿ç« æä»¬åäº«ä»å®æç»éªä¸­æ»ç»åºæ¥ç elasticsearch æ§è½ä¼åï¼ä¸»è¦ä»ç¡¬ä»¶éç½®ä¼åãç´¢å¼ä¼åè®¾ç½®ãæ¥è¯¢æ¹é¢ä¼åãæ°æ®ç»æä¼åãéç¾¤æ¶æä¼åç­æ¹é¢è®²è§£ã\n\n\n# 1. ç¡¬ä»¶éç½®ä¼å\n\nåçº§ç¡¬ä»¶è®¾å¤éç½®ä¸ç´é½æ¯æé«æå¡è½åæå¿«éææçææ®µï¼å¨ç³»ç»å±é¢è½å¤å½±ååºç¨æ§è½çä¸è¬åæ¬ä¸ä¸ªå ç´ ï¼CPUãåå­å IOï¼å¯ä»¥ä»è¿ä¸æ¹é¢è¿è¡ ES çæ§è½ä¼åå·¥ä½ã\n\n\n# 1.1. CPU éç½®\n\nä¸è¬è¯´æ¥ï¼CPU ç¹å¿çåå æä»¥ä¸å ä¸ªï¼\n\n 1. çº¿ç¨ä¸­ææ éç©ºå¾ªç¯ãæ é»å¡ãæ­£åå¹éæèåçº¯çè®¡ç®ï¼\n 2. åçäºé¢ç¹ç GCï¼\n 3. å¤çº¿ç¨çä¸ä¸æåæ¢ï¼\n\nå¤§å¤æ° Elasticsearch é¨ç½²å¾å¾å¯¹ CPU è¦æ±ä¸é«ãå æ­¤ï¼ç¸å¯¹å¶å®èµæºï¼å·ä½éç½®å¤å°ä¸ªï¼CPUï¼ä¸æ¯é£ä¹å³é®ãä½ åºè¯¥éæ©å·æå¤ä¸ªåæ ¸çç°ä»£å¤çå¨ï¼å¸¸è§çéç¾¤ä½¿ç¨ 2 å° 8 ä¸ªæ ¸çæºå¨ãå¦æä½ è¦å¨æ´å¿«ç CPUs åæ´å¤çæ ¸æ°ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸æ°æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\n\n# 1.2. åå­éç½®\n\nå¦ææä¸ç§èµæºæ¯æåè¢«èå°½çï¼å®å¯è½æ¯åå­ãæåºåèåé½å¾èåå­ï¼æä»¥æè¶³å¤çå ç©ºé´æ¥åºä»å®ä»¬æ¯å¾éè¦çãå³ä½¿å ç©ºé´æ¯æ¯è¾å°çæ¶åï¼ä¹è½ä¸ºæä½ç³»ç»æä»¶ç¼å­æä¾é¢å¤çåå­ãå ä¸º Lucene ä½¿ç¨çè®¸å¤æ°æ®ç»ææ¯åºäºç£ççæ ¼å¼ï¼Elasticsearch å©ç¨æä½ç³»ç»ç¼å­è½äº§çå¾å¤§ææã\n\n64 GB åå­çæºå¨æ¯éå¸¸çæ³çï¼ä½æ¯ 32 GB å 16 GB æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 GB ä¼éå¾å¶åï¼ä½ æç»éè¦å¾å¤å¾å¤çå°æºå¨ï¼ï¼å¤§äº 64 GB çæºå¨ä¹ä¼æé®é¢ã\n\nç±äº ES æå»ºåºäº luceneï¼è lucene è®¾è®¡å¼ºå¤§ä¹å¤å¨äº lucene è½å¤å¾å¥½çå©ç¨æä½ç³»ç»åå­æ¥ç¼å­ç´¢å¼æ°æ®ï¼ä»¥æä¾å¿«éçæ¥è¯¢æ§è½ãlucene çç´¢å¼æä»¶ segements æ¯å­å¨å¨åæä»¶ä¸­çï¼å¹¶ä¸ä¸å¯åï¼å¯¹äº OS æ¥è¯´ï¼è½å¤å¾åå¥½å°å°ç´¢å¼æä»¶ä¿æå¨ cache ä¸­ï¼ä»¥ä¾¿å¿«éè®¿é®ï¼å æ­¤ï¼æä»¬å¾æå¿è¦å°ä¸åçç©çåå­çç» luceneï¼å¦ä¸åçç©çåå­çç» ESï¼JVM heapï¼ã\n\n# åå­åé\n\nå½æºå¨åå­å°äº 64G æ¶ï¼éµå¾ªéç¨çååï¼50% ç» ESï¼50% çç» luceneã\n\nå½æºå¨åå­å¤§äº 64G æ¶ï¼éµå¾ªä»¥ä¸ååï¼\n\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯å¨ææ£ç´¢ï¼é£ä¹å»ºè®®ç» ES Heap åé 4~32G çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼segments cacheï¼ï¼ä»¥æä¾æ´å¿«çæ¥è¯¢æ§è½ã\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸å¤§å¤æ°æ¯ numericsï¼datesï¼geo_points ä»¥å not_analyzed çå­ç¬¦ç±»åï¼å»ºè®®åéç» ES Heap åé 4~32G çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼æä¾å¿«éçåºäºææ¡£çèç±»ãæåºæ§è½ã\n * å¦æä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸é½æ¯åºäº analyzed å­ç¬¦æ°æ®ï¼è¿æ¶éè¦æ´å¤ç heap sizeï¼å»ºè®®æºå¨ä¸è¿è¡å¤ ES å®ä¾ï¼æ¯ä¸ªå®ä¾ä¿æä¸è¶è¿ 50% ç ES heap è®¾ç½®ï¼ä½ä¸è¶è¿ 32 Gï¼å åå­è®¾ç½® 32 G ä»¥ä¸æ¶ï¼JVM ä½¿ç¨å¯¹è±¡ææ åç¼©æå·§èçç©ºé´ï¼ï¼50% ä»¥ä¸çç» luceneã\n\n# ç¦æ­¢ swap\n\nç¦æ­¢ swapï¼ä¸æ¦åè®¸åå­ä¸ç£ççäº¤æ¢ï¼ä¼å¼èµ·è´å½çæ§è½é®é¢ãå¯ä»¥éè¿å¨ elasticsearch.yml ä¸­ bootstrap.memory_lock: trueï¼ä»¥ä¿æ JVM éå®åå­ï¼ä¿è¯ ES çæ§è½ã\n\n# GC è®¾ç½®\n\nä¿æ GC çç°æè®¾ç½®ï¼é»è®¤è®¾ç½®ä¸ºï¼Concurrent-Mark and Sweepï¼CMSï¼ï¼å«æ¢æ G1 GCï¼å ä¸ºç®å G1 è¿æå¾å¤ BUGã\n\nä¿æçº¿ç¨æ± çç°æè®¾ç½®ï¼ç®å ES ççº¿ç¨æ± è¾ 1.X æäºè¾å¤ä¼åè®¾ç½®ï¼ä¿æç°ç¶å³å¯ï¼é»è®¤çº¿ç¨æ± å¤§å°ç­äº CPU æ ¸å¿æ°ãå¦æä¸å®è¦æ¹ï¼æå¬å¼ ( ( CPU æ ¸å¿æ° * 3 ) / 2 ) + 1 è®¾ç½®ï¼ä¸è½è¶è¿ CPU æ ¸å¿æ°ç 2 åï¼ä½æ¯ä¸å»ºè®®ä¿®æ¹é»è®¤éç½®ï¼å¦åä¼å¯¹ CPU é æç¡¬ä¼¤ã\n\n\n# 1.3. ç£ç\n\nç¡¬çå¯¹ææçéç¾¤é½å¾éè¦ï¼å¯¹å¤§éåå¥çéç¾¤æ´æ¯å åéè¦ï¼ä¾å¦é£äºå­å¨æ¥å¿æ°æ®çï¼ãç¡¬çæ¯æå¡å¨ä¸ææ¢çå­ç³»ç»ï¼è¿æå³çé£äºåå¥éå¾å¤§çéç¾¤å¾å®¹æè®©ç¡¬çé¥±åï¼ä½¿å¾å®æä¸ºéç¾¤çç¶é¢ã\n\nå¨ç»æµååè½æ¿åçèå´ä¸ï¼å°½éä½¿ç¨åºæç¡¬çï¼SSDï¼ãåºæç¡¬çç¸æ¯äºä»»ä½æè½¬ä»è´¨ï¼æºæ¢°ç¡¬çï¼ç£å¸¦ç­ï¼ï¼æ è®ºéæºåè¿æ¯é¡ºåºåï¼é½ä¼å¯¹ IO æè¾å¤§çæåã\n\n> å¦æä½ æ­£å¨ä½¿ç¨ SSDsï¼ç¡®ä¿ä½ çç³»ç» I/O è°åº¦ç¨åºæ¯éç½®æ­£ç¡®çãå½ä½ åç¡¬çåæ°æ®ï¼I/O è°åº¦ç¨åºå³å®ä½æ¶ææ°æ®å®éåéå°ç¡¬çãå¤§å¤æ°é»è®¤ *nix åè¡çä¸çè°åº¦ç¨åºé½å«å cfqï¼å®å¨å¬å¹³éåï¼ã\n> \n> è°åº¦ç¨åºåéæ¶é´çå°æ¯ä¸ªè¿ç¨ãå¹¶ä¸ä¼åè¿äºå°ç¡¬ççä¼å¤éåçä¼ éãä½å®æ¯ä¸ºæè½¬ä»è´¨ä¼åçï¼æºæ¢°ç¡¬ççåºæç¹æ§æå³çå®åå¥æ°æ®å°åºäºç©çå¸å±çç¡¬çä¼æ´é«æã\n> \n> è¿å¯¹ SSD æ¥è¯´æ¯ä½æçï¼å°½ç®¡è¿éæ²¡ææ¶åå°æºæ¢°ç¡¬çãä½æ¯ï¼deadline æè noop åºè¯¥è¢«ä½¿ç¨ãdeadline è°åº¦ç¨åºåºäºåå¥ç­å¾æ¶é´è¿è¡ä¼åï¼noop åªæ¯ä¸ä¸ªç®åç FIFO éåã\n> \n> è¿ä¸ªç®åçæ´æ¹å¯ä»¥å¸¦æ¥æ¾èçå½±åãä»ä»æ¯ä½¿ç¨æ­£ç¡®çè°åº¦ç¨åºï¼æä»¬çå°äº 500 åçåå¥è½åæåã\n\nå¦æä½ ä½¿ç¨æè½¬ä»è´¨ï¼å¦æºæ¢°ç¡¬çï¼ï¼å°è¯è·åå°½å¯è½å¿«çç¡¬çï¼é«æ§è½æå¡å¨ç¡¬çï¼15k RPM é©±å¨å¨ï¼ã\n\nä½¿ç¨ RAID0 æ¯æé«ç¡¬çéåº¦çææéå¾ï¼å¯¹æºæ¢°ç¡¬çå SSD æ¥è¯´é½æ¯å¦æ­¤ãæ²¡æå¿è¦ä½¿ç¨éåæå¶å® RAID åä½ï¼å ä¸º Elasticsearch å¨èªèº«å±é¢éè¿å¯æ¬ï¼å·²ç»æä¾äºå¤ä»½çåè½ï¼æä»¥ä¸éè¦å©ç¨ç£ççå¤ä»½åè½ï¼åæ¶å¦æä½¿ç¨ç£çå¤ä»½åè½çè¯ï¼å¯¹åå¥éåº¦æè¾å¤§çå½±åã\n\næåï¼é¿åä½¿ç¨ç½ç»éå å­å¨ï¼NASï¼ãäººä»¬å¸¸å£°ç§°ä»ä»¬ç NAS è§£å³æ¹æ¡æ¯æ¬å°é©±å¨å¨æ´å¿«æ´å¯é ãé¤å´è¿äºå£°ç§°ï¼æä»¬ä»æ²¡çå° NAS è½éå¾ä¸å®çå¤§èå®£ä¼ ãNAS å¸¸å¸¸å¾æ¢ï¼æ¾é²åºæ´å¤§çå»¶æ¶åæ´å®½çå¹³åå»¶æ¶æ¹å·®ï¼èä¸å®æ¯åç¹æéçã\n\n\n# 2. ç´¢å¼ä¼åè®¾ç½®\n\nç´¢å¼ä¼åä¸»è¦æ¯å¨ Elasticsearch çæå¥å±é¢ä¼åï¼Elasticsearch æ¬èº«ç´¢å¼éåº¦å¶å®è¿æ¯è®å¿«çï¼å·ä½æ°æ®ï¼æä»¬å¯ä»¥åèå®æ¹ç benchmark æ°æ®ãæä»¬å¯ä»¥æ ¹æ®ä¸åçéæ±ï¼éå¯¹ç´¢å¼ä¼åã\n\n\n# 2.1. æ¹éæäº¤\n\nå½æå¤§éæ°æ®æäº¤çæ¶åï¼å»ºè®®éç¨æ¹éæäº¤ï¼Bulk æä½ï¼ï¼æ­¤å¤ä½¿ç¨ bulk è¯·æ±æ¶ï¼æ¯ä¸ªè¯·æ±ä¸è¶è¿å å Mï¼å ä¸ºå¤ªå¤§ä¼å¯¼è´åå­ä½¿ç¨è¿å¤§ã\n\næ¯å¦å¨å ELK è¿ç¨ä¸­ï¼Logstash indexer æäº¤æ°æ®å° Elasticsearch ä¸­ï¼batch size å°±å¯ä»¥ä½ä¸ºä¸ä¸ªä¼ååè½ç¹ãä½æ¯ä¼å size å¤§å°éè¦æ ¹æ®ææ¡£å¤§å°åæå¡å¨æ§è½èå®ã\n\nå Logstash ä¸­æäº¤ææ¡£å¤§å°è¶è¿ 20MBï¼Logstash ä¼å°ä¸ä¸ªæ¹éè¯·æ±ååä¸ºå¤ä¸ªæ¹éè¯·æ±ã\n\nå¦æå¨æäº¤è¿ç¨ä¸­ï¼éå° EsRejectedExecutionException å¼å¸¸çè¯ï¼åè¯´æéç¾¤çç´¢å¼æ§è½å·²ç»è¾¾å°æéäºãè¿ç§æåµï¼è¦ä¹æé«æå¡å¨éç¾¤çèµæºï¼è¦ä¹æ ¹æ®ä¸å¡è§åï¼åå°æ°æ®æ¶ééåº¦ï¼æ¯å¦åªæ¶é WarnãError çº§å«ä»¥ä¸çæ¥å¿ã\n\n\n# 2.2. å¢å  Refresh æ¶é´é´é\n\nä¸ºäºæé«ç´¢å¼æ§è½ï¼Elasticsearch å¨åå¥æ°æ®çæ¶åï¼éç¨å»¶è¿åå¥çç­ç¥ï¼å³æ°æ®ååå°åå­ä¸­ï¼å½è¶è¿é»è®¤ 1 ç§ï¼index.refresh_intervalï¼ä¼è¿è¡ä¸æ¬¡åå¥æä½ï¼å°±æ¯å°åå­ä¸­ segment æ°æ®å·æ°å°ç£çä¸­ï¼æ­¤æ¶æä»¬æè½å°æ°æ®æç´¢åºæ¥ï¼æä»¥è¿å°±æ¯ä¸ºä»ä¹ Elasticsearch æä¾çæ¯è¿å®æ¶æç´¢åè½ï¼èä¸æ¯å®æ¶æç´¢åè½ã\n\nå¦ææä»¬çç³»ç»å¯¹æ°æ®å»¶è¿è¦æ±ä¸é«çè¯ï¼æä»¬å¯ä»¥éè¿å»¶é¿ refresh æ¶é´é´éï¼å¯ä»¥ææå°åå° segment åå¹¶ååï¼æé«ç´¢å¼éåº¦ãæ¯å¦å¨åå¨é¾è·¯è·è¸ªçè¿ç¨ä¸­ï¼æä»¬å°±å° index.refresh_interval è®¾ç½®ä¸º 30sï¼åå° refresh æ¬¡æ°ãåå¦ï¼å¨è¿è¡å¨éç´¢å¼æ¶ï¼å¯ä»¥å° refresh æ¬¡æ°ä¸´æ¶å³é­ï¼å³ index.refresh_interval è®¾ç½®ä¸º-1ï¼æ°æ®å¯¼å¥æåååæå¼å°æ­£å¸¸æ¨¡å¼ï¼æ¯å¦ 30sã\n\n> å¨å è½½å¤§éæ°æ®æ¶åå¯ä»¥ææ¶ä¸ç¨ refresh å repliccasï¼index.refresh_interval è®¾ç½®ä¸º-1ï¼index.number_of_replicas è®¾ç½®ä¸º 0ã\n\n\n# 2.3. ä¿®æ¹ index_buffer_size çè®¾ç½®\n\nç´¢å¼ç¼å²çè®¾ç½®å¯ä»¥æ§å¶å¤å°åå­åéç»ç´¢å¼è¿ç¨ãè¿æ¯ä¸ä¸ªå¨å±éç½®ï¼ä¼åºç¨äºä¸ä¸ªèç¹ä¸ææä¸åçåçä¸ã\n\nindices.memory.index_buffer_size: 10%\nindices.memory.min_index_buffer_size: 48mb\n\n\nindices.memory.index_buffer_size æ¥åä¸ä¸ªç¾åæ¯æèä¸ä¸ªè¡¨ç¤ºå­èå¤§å°çå¼ãé»è®¤æ¯ 10%ï¼æå³çåéç»èç¹çæ»åå­ç 10%ç¨æ¥åç´¢å¼ç¼å²çå¤§å°ãè¿ä¸ªæ°å¼è¢«åå°ä¸åçåçï¼shardsï¼ä¸ãå¦æè®¾ç½®çæ¯ç¾åæ¯ï¼è¿å¯ä»¥è®¾ç½® min_index_buffer_size ï¼é»è®¤ 48mbï¼å max_index_buffer_sizeï¼é»è®¤æ²¡æä¸éï¼ã\n\n\n# 2.4. ä¿®æ¹ translog ç¸å³çè®¾ç½®\n\nä¸æ¯æ§å¶æ°æ®ä»åå­å°ç¡¬ççæä½é¢çï¼ä»¥åå°ç¡¬ç IOãå¯å° sync_interval çæ¶é´è®¾ç½®å¤§ä¸äºãé»è®¤ä¸º 5sã\n\nindex.translog.sync_interval: 5s\n\n\nä¹å¯ä»¥æ§å¶ tranlog æ°æ®åçå¤§å°ï¼è¾¾å° threshold å¤§å°æ¶ï¼æä¼ flush å° lucene ç´¢å¼æä»¶ãé»è®¤ä¸º 512mã\n\nindex.translog.flush_threshold_size: 512mb\n\n\n\n# 2.5. æ³¨æ _id å­æ®µçä½¿ç¨\n\n_id å­æ®µçä½¿ç¨ï¼åºå°½å¯è½é¿åèªå®ä¹ _idï¼ä»¥é¿åéå¯¹ ID ççæ¬ç®¡çï¼å»ºè®®ä½¿ç¨ ES çé»è®¤ ID çæç­ç¥æä½¿ç¨æ°å­ç±»å ID åä¸ºä¸»é®ã\n\n\n# 2.6. æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨\n\n**_**all å­æ®µå _source å­æ®µçä½¿ç¨ï¼åºè¯¥æ³¨æåºæ¯åéè¦ï¼_all å­æ®µåå«äºææçç´¢å¼å­æ®µï¼æ¹ä¾¿åå¨ææ£ç´¢ï¼å¦ææ æ­¤éæ±ï¼å¯ä»¥ç¦ç¨ï¼_source å­å¨äºåå§ç document åå®¹ï¼å¦ææ²¡æè·ååå§ææ¡£æ°æ®çéæ±ï¼å¯éè¿è®¾ç½® includesãexcludes å±æ§æ¥å®ä¹æ¾å¥ _source çå­æ®µã\n\n\n# 2.7. åççéç½®ä½¿ç¨ index å±æ§\n\nåççéç½®ä½¿ç¨ index å±æ§ï¼analyzed å not_analyzedï¼æ ¹æ®ä¸å¡éæ±æ¥æ§å¶å­æ®µæ¯å¦åè¯æä¸åè¯ãåªæ groupby éæ±çå­æ®µï¼éç½®æ¶å°±è®¾ç½®æ not_analyzedï¼ä»¥æé«æ¥è¯¢æèç±»çæçã\n\n\n# 2.8. åå°å¯æ¬æ°é\n\nElasticsearch é»è®¤å¯æ¬æ°éä¸º 3 ä¸ªï¼è½ç¶è¿æ ·ä¼æé«éç¾¤çå¯ç¨æ§ï¼å¢å æç´¢çå¹¶åæ°ï¼ä½æ¯åæ¶ä¹ä¼å½±ååå¥ç´¢å¼çæçã\n\nå¨ç´¢å¼è¿ç¨ä¸­ï¼éè¦ææ´æ°çææ¡£åå°å¯æ¬èç¹ä¸ï¼ç­å¯æ¬èç¹çæåå¨è¿è¡è¿åç»æãä½¿ç¨ Elasticsearch åä¸å¡æç´¢çæ¶åï¼å»ºè®®å¯æ¬æ°ç®è¿æ¯è®¾ç½®ä¸º 3 ä¸ªï¼ä½æ¯ååé¨ ELK æ¥å¿ç³»ç»ãåå¸å¼è·è¸ªç³»ç»ä¸­ï¼å®å¨å¯ä»¥å°å¯æ¬æ°ç®è®¾ç½®ä¸º 1 ä¸ªã\n\n\n# 3. æ¥è¯¢æ¹é¢ä¼å\n\nElasticsearch ä½ä¸ºä¸å¡æç´¢çè¿å®æ¶æ¥è¯¢æ¶ï¼æ¥è¯¢æççä¼åæ¾å¾å°¤ä¸ºéè¦ã\n\n\n# 3.1. è·¯ç±ä¼å\n\nå½æä»¬æ¥è¯¢ææ¡£çæ¶åï¼Elasticsearch å¦ä½ç¥éä¸ä¸ªææ¡£åºè¯¥å­æ¾å°åªä¸ªåçä¸­å¢ï¼å®å¶å®æ¯éè¿ä¸é¢è¿ä¸ªå¬å¼æ¥è®¡ç®åºæ¥çã\n\nshard = hash(routing) % number_of_primary_shards\n\n\nrouting é»è®¤å¼æ¯ææ¡£ç idï¼ä¹å¯ä»¥éç¨èªå®ä¹å¼ï¼æ¯å¦ç¨æ· IDã\n\n# ä¸å¸¦ routing æ¥è¯¢\n\nå¨æ¥è¯¢çæ¶åå ä¸ºä¸ç¥éè¦æ¥è¯¢çæ°æ®å·ä½å¨åªä¸ªåçä¸ï¼æä»¥æ´ä¸ªè¿ç¨åä¸º 2 ä¸ªæ­¥éª¤ï¼\n\n 1. ååï¼è¯·æ±å°è¾¾åè°èç¹åï¼åè°èç¹å°æ¥è¯¢è¯·æ±ååå°æ¯ä¸ªåçä¸ã\n 2. èåï¼åè°èç¹æéå°æ¯ä¸ªåçä¸æ¥è¯¢ç»æï¼åå°æ¥è¯¢çç»æè¿è¡æåºï¼ä¹åç»ç¨æ·è¿åç»æã\n\n# å¸¦ routing æ¥è¯¢\n\næ¥è¯¢çæ¶åï¼å¯ä»¥ç´æ¥æ ¹æ® routing ä¿¡æ¯å®ä½å°æä¸ªåéæ¥è¯¢ï¼ä¸éè¦æ¥è¯¢ææçåéï¼ç»è¿åè°èç¹æåºã\n\nåä¸é¢èªå®ä¹çç¨æ·æ¥è¯¢ï¼å¦æ routing è®¾ç½®ä¸º userid çè¯ï¼å°±å¯ä»¥ç´æ¥æ¥è¯¢åºæ°æ®æ¥ï¼æçæåå¾å¤ã\n\n\n# 3.2. Filter VS Query\n\nå°½å¯è½ä½¿ç¨è¿æ»¤å¨ä¸ä¸æï¼Filterï¼æ¿ä»£æ¥è¯¢ä¸ä¸æï¼Queryï¼\n\n * Queryï¼æ­¤ææ¡£ä¸æ­¤æ¥è¯¢å­å¥çå¹éç¨åº¦å¦ä½ï¼\n * Filterï¼æ­¤ææ¡£åæ¥è¯¢å­å¥å¹éåï¼\n\nElasticsearch éå¯¹ Filter æ¥è¯¢åªéè¦åç­ãæ¯ãæèãå¦ãï¼ä¸éè¦å Query æ¥è¯¢ä¸æ ·è®¡ç®ç¸å³æ§åæ°ï¼åæ¶ Filter ç»æå¯ä»¥ç¼å­ã\n\n\n# 3.3. æ·±åº¦ç¿»é¡µ\n\nå¨ä½¿ç¨ Elasticsearch è¿ç¨ä¸­ï¼åºå°½éé¿åå¤§ç¿»é¡µçåºç°ã\n\næ­£å¸¸ç¿»é¡µæ¥è¯¢é½æ¯ä» from å¼å§ size æ¡æ°æ®ï¼è¿æ ·å°±éè¦å¨æ¯ä¸ªåçä¸­æ¥è¯¢æåæåå¨åé¢ç from+size æ¡æ°æ®ãååèç¹æ¶éæ¯ä¸ªåéçå from+size æ¡æ°æ®ãååèç¹ä¸å±ä¼åå° N*(from+size) æ¡æ°æ®ï¼ç¶åè¿è¡æåºï¼åå°å¶ä¸­ from å° from+size æ¡æ°æ®è¿ååºå»ãå¦æ from æè size å¾å¤§çè¯ï¼å¯¼è´åå æåºçæ°éä¼åæ­¥æ©å¤§å¾å¤ï¼æç»ä¼å¯¼è´ CPU èµæºæ¶èå¢å¤§ã\n\nå¯ä»¥éè¿ä½¿ç¨ Elasticsearch scroll å scroll-scan é«ææ»å¨çæ¹å¼æ¥è§£å³è¿æ ·çé®é¢ã\n\nä¹å¯ä»¥ç»åå®éä¸å¡ç¹ç¹ï¼ææ¡£ id å¤§å°å¦æåææ¡£åå»ºæ¶é´æ¯ä¸è´æåºçï¼å¯ä»¥ä»¥ææ¡£ id ä½ä¸ºåé¡µçåç§»éï¼å¹¶å°å¶ä½ä¸ºåé¡µæ¥è¯¢çä¸ä¸ªæ¡ä»¶ã\n\n\n# 3.4. èæ¬ï¼scriptï¼åçä½¿ç¨\n\næä»¬ç¥éèæ¬ä½¿ç¨ä¸»è¦æ 3 ç§å½¢å¼ï¼åèå¨æç¼è¯æ¹å¼ã_script ç´¢å¼åºä¸­å­å¨åæä»¶èæ¬å­å¨çå½¢å¼ï¼ä¸è¬èæ¬çä½¿ç¨åºæ¯æ¯ç²æï¼å°½éç¨ç¬¬äºç§æ¹å¼åå°èæ¬å­å¨å¨ _script ç´¢å¼åºä¸­ï¼èµ·å°æåç¼è¯ï¼ç¶åéè¿å¼ç¨èæ¬ idï¼å¹¶ç»å params åæ°ä½¿ç¨ï¼å³å¯ä»¥è¾¾å°æ¨¡åï¼é»è¾ï¼åæ°æ®è¿è¡äºåç¦»ï¼åæ¶åä¾¿äºèæ¬æ¨¡åçæ©å±ä¸ç»´æ¤ãå·ä½ ES èæ¬çæ·±å¥åå®¹è¯·åè Elasticsearch èæ¬æ¨¡åçè¯¦è§£ã\n\n\n# 4. æ°æ®ç»æä¼å\n\nåºäº Elasticsearch çä½¿ç¨åºæ¯ï¼ææ¡£æ°æ®ç»æå°½éåä½¿ç¨åºæ¯è¿è¡ç»åï¼å»ææ²¡ç¨åä¸åççæ°æ®ã\n\n\n# 4.1. å°½éåå°ä¸éè¦çå­æ®µ\n\nå¦æ Elasticsearch ç¨äºä¸å¡æç´¢æå¡ï¼ä¸äºä¸éè¦ç¨äºæç´¢çå­æ®µæå¥½ä¸å­å° ES ä¸­ï¼è¿æ ·å³èçç©ºé´ï¼åæ¶å¨ç¸åçæ°æ®éä¸ï¼ä¹è½æé«æç´¢æ§è½ã\n\né¿åä½¿ç¨å¨æå¼ä½å­æ®µï¼å¨æéå¢ç mappingï¼ä¼å¯¼è´éç¾¤å´©æºï¼åæ ·ï¼ä¹éè¦æ§å¶å­æ®µçæ°éï¼ä¸å¡ä¸­ä¸ä½¿ç¨çå­æ®µï¼å°±ä¸è¦ç´¢å¼ãæ§å¶ç´¢å¼çå­æ®µæ°éãmapping æ·±åº¦ãç´¢å¼å­æ®µçç±»åï¼å¯¹äº ES çæ§è½ä¼åæ¯éä¸­ä¹éã\n\nä»¥ä¸æ¯ ES å³äºå­æ®µæ°ãmapping æ·±åº¦çä¸äºé»è®¤è®¾ç½®ï¼\n\nindex.mapping.nested_objects.limit: 10000\nindex.mapping.total_fields.limit: 1000\nindex.mapping.depth.limit: 20\n\n\n\n# 4.2. Nested Object vs Parent/Child\n\nå°½éé¿åä½¿ç¨ nested æ parent/child çå­æ®µï¼è½ä¸ç¨å°±ä¸ç¨ï¼nested query æ¢ï¼parent/child query æ´æ¢ï¼æ¯ nested query æ¢ä¸ç¾åï¼å æ­¤è½å¨ mapping è®¾è®¡é¶æ®µæå®çï¼å¤§å®½è¡¨è®¾è®¡æéç¨æ¯è¾ smart çæ°æ®ç»æï¼ï¼å°±ä¸è¦ç¨ç¶å­å³ç³»ç mappingã\n\nå¦æä¸å®è¦ä½¿ç¨ nested fieldsï¼ä¿è¯ nested fields å­æ®µä¸è½è¿å¤ï¼ç®å ES é»è®¤éå¶æ¯ 50ãå ä¸ºéå¯¹ 1 ä¸ª documentï¼æ¯ä¸ä¸ª nested fieldï¼é½ä¼çæä¸ä¸ªç¬ç«ç documentï¼è¿å°ä½¿ doc æ°éå§å¢ï¼å½±åæ¥è¯¢æçï¼å°¤å¶æ¯ JOIN çæçã\n\nindex.mapping.nested_fields.limit: 50\n\n\nå¯¹æ¯   NESTED OBJECT        PARENT/CHILD\nä¼ç¹   ææ¡£å­å¨å¨ä¸èµ·ï¼å æ­¤è¯»åæ§é«       ç¶å­ææ¡£å¯ä»¥ç¬ç«æ´æ°ï¼äºä¸å½±å\nç¼ºç¹   æ´æ°ç¶ææ¡£æå­ææ¡£æ¶éè¦æ´æ°æ´ä¸ªææ¡£   ä¸ºäºç»´æ¤ join å³ç³»ï¼éè¦å ç¨é¨ååå­ï¼è¯»åæ§è½è¾å·®\nåºæ¯   å­ææ¡£å¶å°æ´æ°ï¼æ¥è¯¢é¢ç¹         å­ææ¡£æ´æ°é¢ç¹\n\n\n# 4.3. éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°\n\nå°½éé¿åä½¿ç¨å¨ææ å°ï¼è¿æ ·æå¯è½ä¼å¯¼è´éç¾¤å´©æºï¼æ­¤å¤ï¼å¨ææ å°æå¯è½ä¼å¸¦æ¥ä¸å¯æ§å¶çæ°æ®ç±»åï¼è¿èæå¯è½å¯¼è´å¨æ¥è¯¢ç«¯åºç°ç¸å³å¼å¸¸ï¼å½±åä¸å¡ã\n\næ­¤å¤ï¼Elasticsearch ä½ä¸ºæç´¢å¼ææ¶ï¼ä¸»è¦æ¿è½½ query çå¹éåæåºçåè½ï¼é£æ°æ®çå­å¨ç±»ååºäºè¿ä¸¤ç§åè½çç¨éåä¸ºä¸¤ç±»ï¼ä¸æ¯éè¦å¹éçå­æ®µï¼ç¨æ¥å»ºç«åæç´¢å¼å¯¹ query å¹éç¨ï¼å¦ä¸ç±»å­æ®µæ¯ç¨åç²æç¨å°çç¹å¾å­æ®µï¼å¦ ctrãç¹å»æ°ãè¯è®ºæ°ç­ç­ã\n\n\n# 5. éç¾¤æ¶æè®¾è®¡\n\nåççé¨ç½² Elasticsearch æå©äºæé«æå¡çæ´ä½å¯ç¨æ§ã\n\n\n# 5.1. ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»\n\nElasticsearch éç¾¤å¨æ¶æææ´æ¶ï¼éç¨ä¸»èç¹ãæ°æ®èç¹åè´è½½åè¡¡èç¹åç¦»çæ¶æï¼å¨ 5.x çæ¬ä»¥åï¼åå¯å°æ°æ®èç¹åç»åä¸ºâHot-Warmâçæ¶ææ¨¡å¼ã\n\nElasticsearch çéç½®æä»¶ä¸­æ 2 ä¸ªåæ°ï¼node.master å node.dataãè¿ä¸¤ä¸ªåæ°æ­éä½¿ç¨æ¶ï¼è½å¤å¸®å©æä¾æå¡å¨æ§è½ã\n\n# ä¸»ï¼masterï¼èç¹\n\néç½® node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ãæä»¬æ¨èæ¯ä¸ªéç¾¤è¿è¡ 3 ä¸ªä¸ç¨ç master èç¹æ¥æä¾æå¥½çå¼¹æ§ãä½¿ç¨æ¶ï¼ä½ è¿éè¦å° discovery.zen.minimum_master_nodes setting åæ°è®¾ç½®ä¸º 2ï¼ä»¥ååºç°èè£ï¼split-brainï¼çæåµãç¨ 3 ä¸ªä¸ç¨ç master èç¹ï¼ä¸é¨è´è´£å¤çéç¾¤çç®¡çä»¥åå å¼ºç¶æçæ´ä½ç¨³å®æ§ãå ä¸ºè¿ 3 ä¸ª master èç¹ä¸åå«æ°æ®ä¹ä¸ä¼å®éåä¸æç´¢ä»¥åç´¢å¼æä½ï¼å¨ JVM ä¸å®ä»¬ä¸ç¨åç¸åçäºï¼ä¾å¦ç¹éçç´¢å¼æèèæ¶ï¼èµæºèè´¹å¾å¤§çæç´¢ãå æ­¤ä¸å¤ªå¯è½ä¼å ä¸ºåå¾åæ¶èå¯¼è´åé¡¿ãå æ­¤ï¼master èç¹ç CPUï¼åå­ä»¥åç£çéç½®å¯ä»¥æ¯ data èç¹å°å¾å¤çã\n\n# æ°æ®ï¼dataï¼èç¹\n\néç½® node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n\nå¨ Elasticsearch 5.x çæ¬ä¹åï¼data èç¹åå¯åç»åä¸ºâHot-Warmâæ¶æï¼å³åä¸ºç­èç¹ï¼hot nodeï¼åæèç¹ï¼warm nodeï¼ã\n\nhot èç¹ï¼\n\nhot èç¹ä¸»è¦æ¯ç´¢å¼èç¹ï¼åèç¹ï¼ï¼åæ¶ä¼ä¿å­è¿æçä¸äºé¢ç¹è¢«æ¥è¯¢çç´¢å¼ãç±äºè¿è¡ç´¢å¼éå¸¸èè´¹ CPU å IOï¼å³å±äº IO å CPU å¯éåæä½ï¼å»ºè®®ä½¿ç¨ SSD çç£çç±»åï¼ä¿æè¯å¥½çåæ§è½ï¼æä»¬æ¨èé¨ç½²æå°åç 3 ä¸ª hot èç¹æ¥ä¿è¯é«å¯ç¨æ§ãæ ¹æ®è¿æéè¦æ¶éä»¥åæ¥è¯¢çæ°æ®éï¼å¯ä»¥å¢å æå¡å¨æ°éæ¥è·å¾æ³è¦çæ§è½ã\n\nå°èç¹è®¾ç½®ä¸º hot ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: hot\n\n\nå¦ææ¯éå¯¹æå®ç index æä½ï¼å¯ä»¥éè¿ settings è®¾ç½® index.routing.allocation.require.box_type: hot å°ç´¢å¼åå¥ hot èç¹ã\n\nwarm èç¹ï¼\n\nè¿ç§ç±»åçèç¹æ¯ä¸ºäºå¤çå¤§éçï¼èä¸ä¸ç»å¸¸è®¿é®çåªè¯»ç´¢å¼èè®¾è®¡çãç±äºè¿äºç´¢å¼æ¯åªè¯»çï¼warm èç¹å¾åäºæè½½å¤§éç£çï¼æ®éç£çï¼æ¥æ¿ä»£ SSDãåå­ãCPU çéç½®è· hot èç¹ä¿æä¸è´å³å¯ï¼èç¹æ°éä¸è¬ä¹æ¯å¤§äºç­äº 3 ä¸ªã\n\nå°èç¹è®¾ç½®ä¸º warm ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: warm\n\n\nåæ¶ï¼ä¹å¯ä»¥å¨ elasticsearch.yml ä¸­è®¾ç½® index.codec:best_compression ä¿è¯ warm èç¹çåç¼©éç½®ã\n\nå½ç´¢å¼ä¸åè¢«é¢ç¹æ¥è¯¢æ¶ï¼å¯éè¿ index.routing.allocation.require.box_type:warmï¼å°ç´¢å¼æ è®°ä¸º warmï¼ä»èä¿è¯ç´¢å¼ä¸åå¥ hot èç¹ï¼ä»¥ä¾¿å° SSD ç£çèµæºç¨å¨ååä¸ãä¸æ¦è®¾ç½®è¿ä¸ªå±æ§ï¼ES ä¼èªå¨å°ç´¢å¼åå¹¶å° warm èç¹ã\n\n# åè°ï¼coordinatingï¼èç¹\n\nåè°èç¹ç¨äºååå¸å¼éçåè°ï¼å°ååçæèç¹è¿åçæ°æ®æ´ååè¿åãè¯¥èç¹ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ãå¨ ES éç¾¤ä¸­ï¼ææçèç¹é½æå¯è½æ¯åè°èç¹ï¼ä½æ¯ï¼å¯ä»¥éè¿è®¾ç½® node.masterãnode.dataãnode.ingest é½ä¸º false æ¥è®¾ç½®ä¸é¨çåè°èç¹ãéè¦è¾å¥½ç CPU åè¾é«çåå­ã\n\n * node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n * node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ï¼è¯¥ node æå¡å¨å°ä½¿ç¨èªèº«ç©ºé²çèµæºï¼æ¥åè°åç§åå»ºç´¢å¼è¯·æ±æèæ¥è¯¢è¯·æ±ï¼å¹¶å°è¿äºè¯·æ±åçååå°ç¸å³ç node æå¡å¨ä¸ã\n * node.master:false å node.data:falseï¼è¯¥ node æå¡å¨å³ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n\n# 5.2. å³é­ data èç¹æå¡å¨ä¸­ç http åè½\n\néå¯¹ Elasticsearch éç¾¤ä¸­çæææ°æ®èç¹ï¼ä¸ç¨å¼å¯ http æå¡ãå°å¶ä¸­çéç½®åæ°è¿æ ·è®¾ç½®ï¼http.enabled:falseï¼åæ¶ä¹ä¸è¦å®è£ head, bigdesk, marvel ç­çæ§æä»¶ï¼è¿æ ·ä¿è¯ data èç¹æå¡å¨åªéå¤çåå»º/æ´æ°/å é¤/æ¥è¯¢ç´¢å¼æ°æ®ç­æä½ã\n\nhttp åè½å¯ä»¥å¨éæ°æ®èç¹æå¡å¨ä¸å¼å¯ï¼ä¸è¿°ç¸å³ççæ§æä»¶ä¹å®è£å°è¿äºæå¡å¨ä¸ï¼ç¨äºçæ§ Elasticsearch éç¾¤ç¶æç­æ°æ®ä¿¡æ¯ãè¿æ ·åä¸æ¥åºäºæ°æ®å®å¨èèï¼äºæ¥åºäºæå¡æ§è½èèã\n\n\n# 5.3. ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node\n\nä¸å°ç©çæå¡å¨ä¸å¯ä»¥å¯å¨å¤ä¸ª node æå¡å¨èç¹ï¼éè¿è®¾ç½®ä¸åçå¯å¨ portï¼ï¼ä½ä¸å°æå¡å¨ä¸ç CPUãåå­ãç¡¬çç­èµæºæ¯ç«æéï¼ä»æå¡å¨æ§è½èèï¼ä¸å»ºè®®ä¸å°æå¡å¨ä¸å¯å¨å¤ä¸ª node èç¹ã\n\n\n# 5.4. éç¾¤åçè®¾ç½®\n\nES ä¸æ¦åå»ºå¥½ç´¢å¼åï¼å°±æ æ³è°æ´åççè®¾ç½®ï¼èå¨ ES ä¸­ï¼ä¸ä¸ªåçå®éä¸å¯¹åºä¸ä¸ª lucene ç´¢å¼ï¼è lucene ç´¢å¼çè¯»åä¼å ç¨å¾å¤çç³»ç»èµæºï¼å æ­¤ï¼åçæ°ä¸è½è®¾ç½®è¿å¤§ï¼æä»¥ï¼å¨åå»ºç´¢å¼æ¶ï¼åçéç½®åçæ°æ¯éå¸¸éè¦çãä¸è¬æ¥è¯´ï¼æä»¬éµå¾ªä¸äºååï¼\n\n 1. æ§å¶æ¯ä¸ªåçå ç¨çç¡¬çå®¹éä¸è¶è¿ ES çæå¤§ JVM çå ç©ºé´è®¾ç½®ï¼ä¸è¬è®¾ç½®ä¸è¶è¿ 32 Gï¼åèä¸é¢ç JVM åå­è®¾ç½®ååï¼ï¼å æ­¤ï¼å¦æç´¢å¼çæ»å®¹éå¨ 500 G å·¦å³ï¼é£åçå¤§å°å¨ 16 ä¸ªå·¦å³å³å¯ï¼å½ç¶ï¼æå¥½åæ¶èèåå 2ã\n 2. èèä¸ä¸ node æ°éï¼ä¸è¬ä¸ä¸ªèç¹ææ¶åå°±æ¯ä¸å°ç©çæºï¼å¦æåçæ°è¿å¤ï¼å¤§å¤§è¶è¿äºèç¹æ°ï¼å¾å¯è½ä¼å¯¼è´ä¸ä¸ªèç¹ä¸å­å¨å¤ä¸ªåçï¼ä¸æ¦è¯¥èç¹æéï¼å³ä½¿ä¿æäº 1 ä¸ªä»¥ä¸çå¯æ¬ï¼åæ ·æå¯è½ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼éç¾¤æ æ³æ¢å¤ãæä»¥ï¼ä¸è¬é½è®¾ç½®åçæ°ä¸è¶è¿èç¹æ°ç 3 åã\n\n\n# 6. åèèµæ\n\n * Elasticsearch æç¨",normalizedContent:"# elasticsearch æ§è½ä¼å\n\nelasticsearch æ¯å½åæµè¡çä¼ä¸çº§æç´¢å¼æï¼è®¾è®¡ç¨äºäºè®¡ç®ä¸­ï¼è½å¤è¾¾å°å®æ¶æç´¢ï¼ç¨³å®ï¼å¯é ï¼å¿«éï¼å®è£ä½¿ç¨æ¹ä¾¿ãä½ä¸ºä¸ä¸ªå¼ç®±å³ç¨çäº§åï¼å¨çäº§ç¯å¢ä¸çº¿ä¹åï¼æä»¬å¶å®ä¸ä¸å®è½ç¡®ä¿å¶çæ§è½åç¨³å®æ§ãå¦ä½æ ¹æ®å®éæåµæé«æå¡çæ§è½ï¼å¶å®æå¾å¤æå·§ãè¿ç« æä»¬åäº«ä»å®æç»éªä¸­æ»ç»åºæ¥ç elasticsearch æ§è½ä¼åï¼ä¸»è¦ä»ç¡¬ä»¶éç½®ä¼åãç´¢å¼ä¼åè®¾ç½®ãæ¥è¯¢æ¹é¢ä¼åãæ°æ®ç»æä¼åãéç¾¤æ¶æä¼åç­æ¹é¢è®²è§£ã\n\n\n# 1. ç¡¬ä»¶éç½®ä¼å\n\nåçº§ç¡¬ä»¶è®¾å¤éç½®ä¸ç´é½æ¯æé«æå¡è½åæå¿«éææçææ®µï¼å¨ç³»ç»å±é¢è½å¤å½±ååºç¨æ§è½çä¸è¬åæ¬ä¸ä¸ªå ç´ ï¼cpuãåå­å ioï¼å¯ä»¥ä»è¿ä¸æ¹é¢è¿è¡ es çæ§è½ä¼åå·¥ä½ã\n\n\n# 1.1. cpu éç½®\n\nä¸è¬è¯´æ¥ï¼cpu ç¹å¿çåå æä»¥ä¸å ä¸ªï¼\n\n 1. çº¿ç¨ä¸­ææ éç©ºå¾ªç¯ãæ é»å¡ãæ­£åå¹éæèåçº¯çè®¡ç®ï¼\n 2. åçäºé¢ç¹ç gcï¼\n 3. å¤çº¿ç¨çä¸ä¸æåæ¢ï¼\n\nå¤§å¤æ° elasticsearch é¨ç½²å¾å¾å¯¹ cpu è¦æ±ä¸é«ãå æ­¤ï¼ç¸å¯¹å¶å®èµæºï¼å·ä½éç½®å¤å°ä¸ªï¼cpuï¼ä¸æ¯é£ä¹å³é®ãä½ åºè¯¥éæ©å·æå¤ä¸ªåæ ¸çç°ä»£å¤çå¨ï¼å¸¸è§çéç¾¤ä½¿ç¨ 2 å° 8 ä¸ªæ ¸çæºå¨ãå¦æä½ è¦å¨æ´å¿«ç cpus åæ´å¤çæ ¸æ°ä¹é´éæ©ï¼éæ©æ´å¤çæ ¸æ°æ´å¥½ãå¤ä¸ªåæ ¸æä¾çé¢å¤å¹¶åè¿èè¿ç¨å¾®å¿«ä¸ç¹ç¹çæ¶éé¢çã\n\n\n# 1.2. åå­éç½®\n\nå¦ææä¸ç§èµæºæ¯æåè¢«èå°½çï¼å®å¯è½æ¯åå­ãæåºåèåé½å¾èåå­ï¼æä»¥æè¶³å¤çå ç©ºé´æ¥åºä»å®ä»¬æ¯å¾éè¦çãå³ä½¿å ç©ºé´æ¯æ¯è¾å°çæ¶åï¼ä¹è½ä¸ºæä½ç³»ç»æä»¶ç¼å­æä¾é¢å¤çåå­ãå ä¸º lucene ä½¿ç¨çè®¸å¤æ°æ®ç»ææ¯åºäºç£ççæ ¼å¼ï¼elasticsearch å©ç¨æä½ç³»ç»ç¼å­è½äº§çå¾å¤§ææã\n\n64 gb åå­çæºå¨æ¯éå¸¸çæ³çï¼ä½æ¯ 32 gb å 16 gb æºå¨ä¹æ¯å¾å¸¸è§çãå°äº 8 gb ä¼éå¾å¶åï¼ä½ æç»éè¦å¾å¤å¾å¤çå°æºå¨ï¼ï¼å¤§äº 64 gb çæºå¨ä¹ä¼æé®é¢ã\n\nç±äº es æå»ºåºäº luceneï¼è lucene è®¾è®¡å¼ºå¤§ä¹å¤å¨äº lucene è½å¤å¾å¥½çå©ç¨æä½ç³»ç»åå­æ¥ç¼å­ç´¢å¼æ°æ®ï¼ä»¥æä¾å¿«éçæ¥è¯¢æ§è½ãlucene çç´¢å¼æä»¶ segements æ¯å­å¨å¨åæä»¶ä¸­çï¼å¹¶ä¸ä¸å¯åï¼å¯¹äº os æ¥è¯´ï¼è½å¤å¾åå¥½å°å°ç´¢å¼æä»¶ä¿æå¨ cache ä¸­ï¼ä»¥ä¾¿å¿«éè®¿é®ï¼å æ­¤ï¼æä»¬å¾æå¿è¦å°ä¸åçç©çåå­çç» luceneï¼å¦ä¸åçç©çåå­çç» esï¼jvm heapï¼ã\n\n# åå­åé\n\nå½æºå¨åå­å°äº 64g æ¶ï¼éµå¾ªéç¨çååï¼50% ç» esï¼50% çç» luceneã\n\nå½æºå¨åå­å¤§äº 64g æ¶ï¼éµå¾ªä»¥ä¸ååï¼\n\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯å¨ææ£ç´¢ï¼é£ä¹å»ºè®®ç» es heap åé 4~32g çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼segments cacheï¼ï¼ä»¥æä¾æ´å¿«çæ¥è¯¢æ§è½ã\n * å¦æä¸»è¦çä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸å¤§å¤æ°æ¯ numericsï¼datesï¼geo_points ä»¥å not_analyzed çå­ç¬¦ç±»åï¼å»ºè®®åéç» es heap åé 4~32g çåå­å³å¯ï¼å¶å®åå­çç»æä½ç³»ç»ï¼ä¾ lucene ä½¿ç¨ï¼æä¾å¿«éçåºäºææ¡£çèç±»ãæåºæ§è½ã\n * å¦æä½¿ç¨åºæ¯æ¯èåææåºï¼å¹¶ä¸é½æ¯åºäº analyzed å­ç¬¦æ°æ®ï¼è¿æ¶éè¦æ´å¤ç heap sizeï¼å»ºè®®æºå¨ä¸è¿è¡å¤ es å®ä¾ï¼æ¯ä¸ªå®ä¾ä¿æä¸è¶è¿ 50% ç es heap è®¾ç½®ï¼ä½ä¸è¶è¿ 32 gï¼å åå­è®¾ç½® 32 g ä»¥ä¸æ¶ï¼jvm ä½¿ç¨å¯¹è±¡ææ åç¼©æå·§èçç©ºé´ï¼ï¼50% ä»¥ä¸çç» luceneã\n\n# ç¦æ­¢ swap\n\nç¦æ­¢ swapï¼ä¸æ¦åè®¸åå­ä¸ç£ççäº¤æ¢ï¼ä¼å¼èµ·è´å½çæ§è½é®é¢ãå¯ä»¥éè¿å¨ elasticsearch.yml ä¸­ bootstrap.memory_lock: trueï¼ä»¥ä¿æ jvm éå®åå­ï¼ä¿è¯ es çæ§è½ã\n\n# gc è®¾ç½®\n\nä¿æ gc çç°æè®¾ç½®ï¼é»è®¤è®¾ç½®ä¸ºï¼concurrent-mark and sweepï¼cmsï¼ï¼å«æ¢æ g1 gcï¼å ä¸ºç®å g1 è¿æå¾å¤ bugã\n\nä¿æçº¿ç¨æ± çç°æè®¾ç½®ï¼ç®å es ççº¿ç¨æ± è¾ 1.x æäºè¾å¤ä¼åè®¾ç½®ï¼ä¿æç°ç¶å³å¯ï¼é»è®¤çº¿ç¨æ± å¤§å°ç­äº cpu æ ¸å¿æ°ãå¦æä¸å®è¦æ¹ï¼æå¬å¼ ( ( cpu æ ¸å¿æ° * 3 ) / 2 ) + 1 è®¾ç½®ï¼ä¸è½è¶è¿ cpu æ ¸å¿æ°ç 2 åï¼ä½æ¯ä¸å»ºè®®ä¿®æ¹é»è®¤éç½®ï¼å¦åä¼å¯¹ cpu é æç¡¬ä¼¤ã\n\n\n# 1.3. ç£ç\n\nç¡¬çå¯¹ææçéç¾¤é½å¾éè¦ï¼å¯¹å¤§éåå¥çéç¾¤æ´æ¯å åéè¦ï¼ä¾å¦é£äºå­å¨æ¥å¿æ°æ®çï¼ãç¡¬çæ¯æå¡å¨ä¸ææ¢çå­ç³»ç»ï¼è¿æå³çé£äºåå¥éå¾å¤§çéç¾¤å¾å®¹æè®©ç¡¬çé¥±åï¼ä½¿å¾å®æä¸ºéç¾¤çç¶é¢ã\n\nå¨ç»æµååè½æ¿åçèå´ä¸ï¼å°½éä½¿ç¨åºæç¡¬çï¼ssdï¼ãåºæç¡¬çç¸æ¯äºä»»ä½æè½¬ä»è´¨ï¼æºæ¢°ç¡¬çï¼ç£å¸¦ç­ï¼ï¼æ è®ºéæºåè¿æ¯é¡ºåºåï¼é½ä¼å¯¹ io æè¾å¤§çæåã\n\n> å¦æä½ æ­£å¨ä½¿ç¨ ssdsï¼ç¡®ä¿ä½ çç³»ç» i/o è°åº¦ç¨åºæ¯éç½®æ­£ç¡®çãå½ä½ åç¡¬çåæ°æ®ï¼i/o è°åº¦ç¨åºå³å®ä½æ¶ææ°æ®å®éåéå°ç¡¬çãå¤§å¤æ°é»è®¤ *nix åè¡çä¸çè°åº¦ç¨åºé½å«å cfqï¼å®å¨å¬å¹³éåï¼ã\n> \n> è°åº¦ç¨åºåéæ¶é´çå°æ¯ä¸ªè¿ç¨ãå¹¶ä¸ä¼åè¿äºå°ç¡¬ççä¼å¤éåçä¼ éãä½å®æ¯ä¸ºæè½¬ä»è´¨ä¼åçï¼æºæ¢°ç¡¬ççåºæç¹æ§æå³çå®åå¥æ°æ®å°åºäºç©çå¸å±çç¡¬çä¼æ´é«æã\n> \n> è¿å¯¹ ssd æ¥è¯´æ¯ä½æçï¼å°½ç®¡è¿éæ²¡ææ¶åå°æºæ¢°ç¡¬çãä½æ¯ï¼deadline æè noop åºè¯¥è¢«ä½¿ç¨ãdeadline è°åº¦ç¨åºåºäºåå¥ç­å¾æ¶é´è¿è¡ä¼åï¼noop åªæ¯ä¸ä¸ªç®åç fifo éåã\n> \n> è¿ä¸ªç®åçæ´æ¹å¯ä»¥å¸¦æ¥æ¾èçå½±åãä»ä»æ¯ä½¿ç¨æ­£ç¡®çè°åº¦ç¨åºï¼æä»¬çå°äº 500 åçåå¥è½åæåã\n\nå¦æä½ ä½¿ç¨æè½¬ä»è´¨ï¼å¦æºæ¢°ç¡¬çï¼ï¼å°è¯è·åå°½å¯è½å¿«çç¡¬çï¼é«æ§è½æå¡å¨ç¡¬çï¼15k rpm é©±å¨å¨ï¼ã\n\nä½¿ç¨ raid0 æ¯æé«ç¡¬çéåº¦çææéå¾ï¼å¯¹æºæ¢°ç¡¬çå ssd æ¥è¯´é½æ¯å¦æ­¤ãæ²¡æå¿è¦ä½¿ç¨éåæå¶å® raid åä½ï¼å ä¸º elasticsearch å¨èªèº«å±é¢éè¿å¯æ¬ï¼å·²ç»æä¾äºå¤ä»½çåè½ï¼æä»¥ä¸éè¦å©ç¨ç£ççå¤ä»½åè½ï¼åæ¶å¦æä½¿ç¨ç£çå¤ä»½åè½çè¯ï¼å¯¹åå¥éåº¦æè¾å¤§çå½±åã\n\næåï¼é¿åä½¿ç¨ç½ç»éå å­å¨ï¼nasï¼ãäººä»¬å¸¸å£°ç§°ä»ä»¬ç nas è§£å³æ¹æ¡æ¯æ¬å°é©±å¨å¨æ´å¿«æ´å¯é ãé¤å´è¿äºå£°ç§°ï¼æä»¬ä»æ²¡çå° nas è½éå¾ä¸å®çå¤§èå®£ä¼ ãnas å¸¸å¸¸å¾æ¢ï¼æ¾é²åºæ´å¤§çå»¶æ¶åæ´å®½çå¹³åå»¶æ¶æ¹å·®ï¼èä¸å®æ¯åç¹æéçã\n\n\n# 2. ç´¢å¼ä¼åè®¾ç½®\n\nç´¢å¼ä¼åä¸»è¦æ¯å¨ elasticsearch çæå¥å±é¢ä¼åï¼elasticsearch æ¬èº«ç´¢å¼éåº¦å¶å®è¿æ¯è®å¿«çï¼å·ä½æ°æ®ï¼æä»¬å¯ä»¥åèå®æ¹ç benchmark æ°æ®ãæä»¬å¯ä»¥æ ¹æ®ä¸åçéæ±ï¼éå¯¹ç´¢å¼ä¼åã\n\n\n# 2.1. æ¹éæäº¤\n\nå½æå¤§éæ°æ®æäº¤çæ¶åï¼å»ºè®®éç¨æ¹éæäº¤ï¼bulk æä½ï¼ï¼æ­¤å¤ä½¿ç¨ bulk è¯·æ±æ¶ï¼æ¯ä¸ªè¯·æ±ä¸è¶è¿å å mï¼å ä¸ºå¤ªå¤§ä¼å¯¼è´åå­ä½¿ç¨è¿å¤§ã\n\næ¯å¦å¨å elk è¿ç¨ä¸­ï¼logstash indexer æäº¤æ°æ®å° elasticsearch ä¸­ï¼batch size å°±å¯ä»¥ä½ä¸ºä¸ä¸ªä¼ååè½ç¹ãä½æ¯ä¼å size å¤§å°éè¦æ ¹æ®ææ¡£å¤§å°åæå¡å¨æ§è½èå®ã\n\nå logstash ä¸­æäº¤ææ¡£å¤§å°è¶è¿ 20mbï¼logstash ä¼å°ä¸ä¸ªæ¹éè¯·æ±ååä¸ºå¤ä¸ªæ¹éè¯·æ±ã\n\nå¦æå¨æäº¤è¿ç¨ä¸­ï¼éå° esrejectedexecutionexception å¼å¸¸çè¯ï¼åè¯´æéç¾¤çç´¢å¼æ§è½å·²ç»è¾¾å°æéäºãè¿ç§æåµï¼è¦ä¹æé«æå¡å¨éç¾¤çèµæºï¼è¦ä¹æ ¹æ®ä¸å¡è§åï¼åå°æ°æ®æ¶ééåº¦ï¼æ¯å¦åªæ¶é warnãerror çº§å«ä»¥ä¸çæ¥å¿ã\n\n\n# 2.2. å¢å  refresh æ¶é´é´é\n\nä¸ºäºæé«ç´¢å¼æ§è½ï¼elasticsearch å¨åå¥æ°æ®çæ¶åï¼éç¨å»¶è¿åå¥çç­ç¥ï¼å³æ°æ®ååå°åå­ä¸­ï¼å½è¶è¿é»è®¤ 1 ç§ï¼index.refresh_intervalï¼ä¼è¿è¡ä¸æ¬¡åå¥æä½ï¼å°±æ¯å°åå­ä¸­ segment æ°æ®å·æ°å°ç£çä¸­ï¼æ­¤æ¶æä»¬æè½å°æ°æ®æç´¢åºæ¥ï¼æä»¥è¿å°±æ¯ä¸ºä»ä¹ elasticsearch æä¾çæ¯è¿å®æ¶æç´¢åè½ï¼èä¸æ¯å®æ¶æç´¢åè½ã\n\nå¦ææä»¬çç³»ç»å¯¹æ°æ®å»¶è¿è¦æ±ä¸é«çè¯ï¼æä»¬å¯ä»¥éè¿å»¶é¿ refresh æ¶é´é´éï¼å¯ä»¥ææå°åå° segment åå¹¶ååï¼æé«ç´¢å¼éåº¦ãæ¯å¦å¨åå¨é¾è·¯è·è¸ªçè¿ç¨ä¸­ï¼æä»¬å°±å° index.refresh_interval è®¾ç½®ä¸º 30sï¼åå° refresh æ¬¡æ°ãåå¦ï¼å¨è¿è¡å¨éç´¢å¼æ¶ï¼å¯ä»¥å° refresh æ¬¡æ°ä¸´æ¶å³é­ï¼å³ index.refresh_interval è®¾ç½®ä¸º-1ï¼æ°æ®å¯¼å¥æåååæå¼å°æ­£å¸¸æ¨¡å¼ï¼æ¯å¦ 30sã\n\n> å¨å è½½å¤§éæ°æ®æ¶åå¯ä»¥ææ¶ä¸ç¨ refresh å repliccasï¼index.refresh_interval è®¾ç½®ä¸º-1ï¼index.number_of_replicas è®¾ç½®ä¸º 0ã\n\n\n# 2.3. ä¿®æ¹ index_buffer_size çè®¾ç½®\n\nç´¢å¼ç¼å²çè®¾ç½®å¯ä»¥æ§å¶å¤å°åå­åéç»ç´¢å¼è¿ç¨ãè¿æ¯ä¸ä¸ªå¨å±éç½®ï¼ä¼åºç¨äºä¸ä¸ªèç¹ä¸ææä¸åçåçä¸ã\n\nindices.memory.index_buffer_size: 10%\nindices.memory.min_index_buffer_size: 48mb\n\n\nindices.memory.index_buffer_size æ¥åä¸ä¸ªç¾åæ¯æèä¸ä¸ªè¡¨ç¤ºå­èå¤§å°çå¼ãé»è®¤æ¯ 10%ï¼æå³çåéç»èç¹çæ»åå­ç 10%ç¨æ¥åç´¢å¼ç¼å²çå¤§å°ãè¿ä¸ªæ°å¼è¢«åå°ä¸åçåçï¼shardsï¼ä¸ãå¦æè®¾ç½®çæ¯ç¾åæ¯ï¼è¿å¯ä»¥è®¾ç½® min_index_buffer_size ï¼é»è®¤ 48mbï¼å max_index_buffer_sizeï¼é»è®¤æ²¡æä¸éï¼ã\n\n\n# 2.4. ä¿®æ¹ translog ç¸å³çè®¾ç½®\n\nä¸æ¯æ§å¶æ°æ®ä»åå­å°ç¡¬ççæä½é¢çï¼ä»¥åå°ç¡¬ç ioãå¯å° sync_interval çæ¶é´è®¾ç½®å¤§ä¸äºãé»è®¤ä¸º 5sã\n\nindex.translog.sync_interval: 5s\n\n\nä¹å¯ä»¥æ§å¶ tranlog æ°æ®åçå¤§å°ï¼è¾¾å° threshold å¤§å°æ¶ï¼æä¼ flush å° lucene ç´¢å¼æä»¶ãé»è®¤ä¸º 512mã\n\nindex.translog.flush_threshold_size: 512mb\n\n\n\n# 2.5. æ³¨æ _id å­æ®µçä½¿ç¨\n\n_id å­æ®µçä½¿ç¨ï¼åºå°½å¯è½é¿åèªå®ä¹ _idï¼ä»¥é¿åéå¯¹ id ççæ¬ç®¡çï¼å»ºè®®ä½¿ç¨ es çé»è®¤ id çæç­ç¥æä½¿ç¨æ°å­ç±»å id åä¸ºä¸»é®ã\n\n\n# 2.6. æ³¨æ _all å­æ®µå _source å­æ®µçä½¿ç¨\n\n**_**all å­æ®µå _source å­æ®µçä½¿ç¨ï¼åºè¯¥æ³¨æåºæ¯åéè¦ï¼_all å­æ®µåå«äºææçç´¢å¼å­æ®µï¼æ¹ä¾¿åå¨ææ£ç´¢ï¼å¦ææ æ­¤éæ±ï¼å¯ä»¥ç¦ç¨ï¼_source å­å¨äºåå§ç document åå®¹ï¼å¦ææ²¡æè·ååå§ææ¡£æ°æ®çéæ±ï¼å¯éè¿è®¾ç½® includesãexcludes å±æ§æ¥å®ä¹æ¾å¥ _source çå­æ®µã\n\n\n# 2.7. åççéç½®ä½¿ç¨ index å±æ§\n\nåççéç½®ä½¿ç¨ index å±æ§ï¼analyzed å not_analyzedï¼æ ¹æ®ä¸å¡éæ±æ¥æ§å¶å­æ®µæ¯å¦åè¯æä¸åè¯ãåªæ groupby éæ±çå­æ®µï¼éç½®æ¶å°±è®¾ç½®æ not_analyzedï¼ä»¥æé«æ¥è¯¢æèç±»çæçã\n\n\n# 2.8. åå°å¯æ¬æ°é\n\nelasticsearch é»è®¤å¯æ¬æ°éä¸º 3 ä¸ªï¼è½ç¶è¿æ ·ä¼æé«éç¾¤çå¯ç¨æ§ï¼å¢å æç´¢çå¹¶åæ°ï¼ä½æ¯åæ¶ä¹ä¼å½±ååå¥ç´¢å¼çæçã\n\nå¨ç´¢å¼è¿ç¨ä¸­ï¼éè¦ææ´æ°çææ¡£åå°å¯æ¬èç¹ä¸ï¼ç­å¯æ¬èç¹çæåå¨è¿è¡è¿åç»æãä½¿ç¨ elasticsearch åä¸å¡æç´¢çæ¶åï¼å»ºè®®å¯æ¬æ°ç®è¿æ¯è®¾ç½®ä¸º 3 ä¸ªï¼ä½æ¯ååé¨ elk æ¥å¿ç³»ç»ãåå¸å¼è·è¸ªç³»ç»ä¸­ï¼å®å¨å¯ä»¥å°å¯æ¬æ°ç®è®¾ç½®ä¸º 1 ä¸ªã\n\n\n# 3. æ¥è¯¢æ¹é¢ä¼å\n\nelasticsearch ä½ä¸ºä¸å¡æç´¢çè¿å®æ¶æ¥è¯¢æ¶ï¼æ¥è¯¢æççä¼åæ¾å¾å°¤ä¸ºéè¦ã\n\n\n# 3.1. è·¯ç±ä¼å\n\nå½æä»¬æ¥è¯¢ææ¡£çæ¶åï¼elasticsearch å¦ä½ç¥éä¸ä¸ªææ¡£åºè¯¥å­æ¾å°åªä¸ªåçä¸­å¢ï¼å®å¶å®æ¯éè¿ä¸é¢è¿ä¸ªå¬å¼æ¥è®¡ç®åºæ¥çã\n\nshard = hash(routing) % number_of_primary_shards\n\n\nrouting é»è®¤å¼æ¯ææ¡£ç idï¼ä¹å¯ä»¥éç¨èªå®ä¹å¼ï¼æ¯å¦ç¨æ· idã\n\n# ä¸å¸¦ routing æ¥è¯¢\n\nå¨æ¥è¯¢çæ¶åå ä¸ºä¸ç¥éè¦æ¥è¯¢çæ°æ®å·ä½å¨åªä¸ªåçä¸ï¼æä»¥æ´ä¸ªè¿ç¨åä¸º 2 ä¸ªæ­¥éª¤ï¼\n\n 1. ååï¼è¯·æ±å°è¾¾åè°èç¹åï¼åè°èç¹å°æ¥è¯¢è¯·æ±ååå°æ¯ä¸ªåçä¸ã\n 2. èåï¼åè°èç¹æéå°æ¯ä¸ªåçä¸æ¥è¯¢ç»æï¼åå°æ¥è¯¢çç»æè¿è¡æåºï¼ä¹åç»ç¨æ·è¿åç»æã\n\n# å¸¦ routing æ¥è¯¢\n\næ¥è¯¢çæ¶åï¼å¯ä»¥ç´æ¥æ ¹æ® routing ä¿¡æ¯å®ä½å°æä¸ªåéæ¥è¯¢ï¼ä¸éè¦æ¥è¯¢ææçåéï¼ç»è¿åè°èç¹æåºã\n\nåä¸é¢èªå®ä¹çç¨æ·æ¥è¯¢ï¼å¦æ routing è®¾ç½®ä¸º userid çè¯ï¼å°±å¯ä»¥ç´æ¥æ¥è¯¢åºæ°æ®æ¥ï¼æçæåå¾å¤ã\n\n\n# 3.2. filter vs query\n\nå°½å¯è½ä½¿ç¨è¿æ»¤å¨ä¸ä¸æï¼filterï¼æ¿ä»£æ¥è¯¢ä¸ä¸æï¼queryï¼\n\n * queryï¼æ­¤ææ¡£ä¸æ­¤æ¥è¯¢å­å¥çå¹éç¨åº¦å¦ä½ï¼\n * filterï¼æ­¤ææ¡£åæ¥è¯¢å­å¥å¹éåï¼\n\nelasticsearch éå¯¹ filter æ¥è¯¢åªéè¦åç­ãæ¯ãæèãå¦ãï¼ä¸éè¦å query æ¥è¯¢ä¸æ ·è®¡ç®ç¸å³æ§åæ°ï¼åæ¶ filter ç»æå¯ä»¥ç¼å­ã\n\n\n# 3.3. æ·±åº¦ç¿»é¡µ\n\nå¨ä½¿ç¨ elasticsearch è¿ç¨ä¸­ï¼åºå°½éé¿åå¤§ç¿»é¡µçåºç°ã\n\næ­£å¸¸ç¿»é¡µæ¥è¯¢é½æ¯ä» from å¼å§ size æ¡æ°æ®ï¼è¿æ ·å°±éè¦å¨æ¯ä¸ªåçä¸­æ¥è¯¢æåæåå¨åé¢ç from+size æ¡æ°æ®ãååèç¹æ¶éæ¯ä¸ªåéçå from+size æ¡æ°æ®ãååèç¹ä¸å±ä¼åå° n*(from+size) æ¡æ°æ®ï¼ç¶åè¿è¡æåºï¼åå°å¶ä¸­ from å° from+size æ¡æ°æ®è¿ååºå»ãå¦æ from æè size å¾å¤§çè¯ï¼å¯¼è´åå æåºçæ°éä¼åæ­¥æ©å¤§å¾å¤ï¼æç»ä¼å¯¼è´ cpu èµæºæ¶èå¢å¤§ã\n\nå¯ä»¥éè¿ä½¿ç¨ elasticsearch scroll å scroll-scan é«ææ»å¨çæ¹å¼æ¥è§£å³è¿æ ·çé®é¢ã\n\nä¹å¯ä»¥ç»åå®éä¸å¡ç¹ç¹ï¼ææ¡£ id å¤§å°å¦æåææ¡£åå»ºæ¶é´æ¯ä¸è´æåºçï¼å¯ä»¥ä»¥ææ¡£ id ä½ä¸ºåé¡µçåç§»éï¼å¹¶å°å¶ä½ä¸ºåé¡µæ¥è¯¢çä¸ä¸ªæ¡ä»¶ã\n\n\n# 3.4. èæ¬ï¼scriptï¼åçä½¿ç¨\n\næä»¬ç¥éèæ¬ä½¿ç¨ä¸»è¦æ 3 ç§å½¢å¼ï¼åèå¨æç¼è¯æ¹å¼ã_script ç´¢å¼åºä¸­å­å¨åæä»¶èæ¬å­å¨çå½¢å¼ï¼ä¸è¬èæ¬çä½¿ç¨åºæ¯æ¯ç²æï¼å°½éç¨ç¬¬äºç§æ¹å¼åå°èæ¬å­å¨å¨ _script ç´¢å¼åºä¸­ï¼èµ·å°æåç¼è¯ï¼ç¶åéè¿å¼ç¨èæ¬ idï¼å¹¶ç»å params åæ°ä½¿ç¨ï¼å³å¯ä»¥è¾¾å°æ¨¡åï¼é»è¾ï¼åæ°æ®è¿è¡äºåç¦»ï¼åæ¶åä¾¿äºèæ¬æ¨¡åçæ©å±ä¸ç»´æ¤ãå·ä½ es èæ¬çæ·±å¥åå®¹è¯·åè elasticsearch èæ¬æ¨¡åçè¯¦è§£ã\n\n\n# 4. æ°æ®ç»æä¼å\n\nåºäº elasticsearch çä½¿ç¨åºæ¯ï¼ææ¡£æ°æ®ç»æå°½éåä½¿ç¨åºæ¯è¿è¡ç»åï¼å»ææ²¡ç¨åä¸åççæ°æ®ã\n\n\n# 4.1. å°½éåå°ä¸éè¦çå­æ®µ\n\nå¦æ elasticsearch ç¨äºä¸å¡æç´¢æå¡ï¼ä¸äºä¸éè¦ç¨äºæç´¢çå­æ®µæå¥½ä¸å­å° es ä¸­ï¼è¿æ ·å³èçç©ºé´ï¼åæ¶å¨ç¸åçæ°æ®éä¸ï¼ä¹è½æé«æç´¢æ§è½ã\n\né¿åä½¿ç¨å¨æå¼ä½å­æ®µï¼å¨æéå¢ç mappingï¼ä¼å¯¼è´éç¾¤å´©æºï¼åæ ·ï¼ä¹éè¦æ§å¶å­æ®µçæ°éï¼ä¸å¡ä¸­ä¸ä½¿ç¨çå­æ®µï¼å°±ä¸è¦ç´¢å¼ãæ§å¶ç´¢å¼çå­æ®µæ°éãmapping æ·±åº¦ãç´¢å¼å­æ®µçç±»åï¼å¯¹äº es çæ§è½ä¼åæ¯éä¸­ä¹éã\n\nä»¥ä¸æ¯ es å³äºå­æ®µæ°ãmapping æ·±åº¦çä¸äºé»è®¤è®¾ç½®ï¼\n\nindex.mapping.nested_objects.limit: 10000\nindex.mapping.total_fields.limit: 1000\nindex.mapping.depth.limit: 20\n\n\n\n# 4.2. nested object vs parent/child\n\nå°½éé¿åä½¿ç¨ nested æ parent/child çå­æ®µï¼è½ä¸ç¨å°±ä¸ç¨ï¼nested query æ¢ï¼parent/child query æ´æ¢ï¼æ¯ nested query æ¢ä¸ç¾åï¼å æ­¤è½å¨ mapping è®¾è®¡é¶æ®µæå®çï¼å¤§å®½è¡¨è®¾è®¡æéç¨æ¯è¾ smart çæ°æ®ç»æï¼ï¼å°±ä¸è¦ç¨ç¶å­å³ç³»ç mappingã\n\nå¦æä¸å®è¦ä½¿ç¨ nested fieldsï¼ä¿è¯ nested fields å­æ®µä¸è½è¿å¤ï¼ç®å es é»è®¤éå¶æ¯ 50ãå ä¸ºéå¯¹ 1 ä¸ª documentï¼æ¯ä¸ä¸ª nested fieldï¼é½ä¼çæä¸ä¸ªç¬ç«ç documentï¼è¿å°ä½¿ doc æ°éå§å¢ï¼å½±åæ¥è¯¢æçï¼å°¤å¶æ¯ join çæçã\n\nindex.mapping.nested_fields.limit: 50\n\n\nå¯¹æ¯   nested object        parent/child\nä¼ç¹   ææ¡£å­å¨å¨ä¸èµ·ï¼å æ­¤è¯»åæ§é«       ç¶å­ææ¡£å¯ä»¥ç¬ç«æ´æ°ï¼äºä¸å½±å\nç¼ºç¹   æ´æ°ç¶ææ¡£æå­ææ¡£æ¶éè¦æ´æ°æ´ä¸ªææ¡£   ä¸ºäºç»´æ¤ join å³ç³»ï¼éè¦å ç¨é¨ååå­ï¼è¯»åæ§è½è¾å·®\nåºæ¯   å­ææ¡£å¶å°æ´æ°ï¼æ¥è¯¢é¢ç¹         å­ææ¡£æ´æ°é¢ç¹\n\n\n# 4.3. éæ©éææ å°ï¼éå¿éæ¶ï¼ç¦æ­¢å¨ææ å°\n\nå°½éé¿åä½¿ç¨å¨ææ å°ï¼è¿æ ·æå¯è½ä¼å¯¼è´éç¾¤å´©æºï¼æ­¤å¤ï¼å¨ææ å°æå¯è½ä¼å¸¦æ¥ä¸å¯æ§å¶çæ°æ®ç±»åï¼è¿èæå¯è½å¯¼è´å¨æ¥è¯¢ç«¯åºç°ç¸å³å¼å¸¸ï¼å½±åä¸å¡ã\n\næ­¤å¤ï¼elasticsearch ä½ä¸ºæç´¢å¼ææ¶ï¼ä¸»è¦æ¿è½½ query çå¹éåæåºçåè½ï¼é£æ°æ®çå­å¨ç±»ååºäºè¿ä¸¤ç§åè½çç¨éåä¸ºä¸¤ç±»ï¼ä¸æ¯éè¦å¹éçå­æ®µï¼ç¨æ¥å»ºç«åæç´¢å¼å¯¹ query å¹éç¨ï¼å¦ä¸ç±»å­æ®µæ¯ç¨åç²æç¨å°çç¹å¾å­æ®µï¼å¦ ctrãç¹å»æ°ãè¯è®ºæ°ç­ç­ã\n\n\n# 5. éç¾¤æ¶æè®¾è®¡\n\nåççé¨ç½² elasticsearch æå©äºæé«æå¡çæ´ä½å¯ç¨æ§ã\n\n\n# 5.1. ä¸»èç¹ãæ°æ®èç¹ååè°èç¹åç¦»\n\nelasticsearch éç¾¤å¨æ¶æææ´æ¶ï¼éç¨ä¸»èç¹ãæ°æ®èç¹åè´è½½åè¡¡èç¹åç¦»çæ¶æï¼å¨ 5.x çæ¬ä»¥åï¼åå¯å°æ°æ®èç¹åç»åä¸ºâhot-warmâçæ¶ææ¨¡å¼ã\n\nelasticsearch çéç½®æä»¶ä¸­æ 2 ä¸ªåæ°ï¼node.master å node.dataãè¿ä¸¤ä¸ªåæ°æ­éä½¿ç¨æ¶ï¼è½å¤å¸®å©æä¾æå¡å¨æ§è½ã\n\n# ä¸»ï¼masterï¼èç¹\n\néç½® node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ãæä»¬æ¨èæ¯ä¸ªéç¾¤è¿è¡ 3 ä¸ªä¸ç¨ç master èç¹æ¥æä¾æå¥½çå¼¹æ§ãä½¿ç¨æ¶ï¼ä½ è¿éè¦å° discovery.zen.minimum_master_nodes setting åæ°è®¾ç½®ä¸º 2ï¼ä»¥ååºç°èè£ï¼split-brainï¼çæåµãç¨ 3 ä¸ªä¸ç¨ç master èç¹ï¼ä¸é¨è´è´£å¤çéç¾¤çç®¡çä»¥åå å¼ºç¶æçæ´ä½ç¨³å®æ§ãå ä¸ºè¿ 3 ä¸ª master èç¹ä¸åå«æ°æ®ä¹ä¸ä¼å®éåä¸æç´¢ä»¥åç´¢å¼æä½ï¼å¨ jvm ä¸å®ä»¬ä¸ç¨åç¸åçäºï¼ä¾å¦ç¹éçç´¢å¼æèèæ¶ï¼èµæºèè´¹å¾å¤§çæç´¢ãå æ­¤ä¸å¤ªå¯è½ä¼å ä¸ºåå¾åæ¶èå¯¼è´åé¡¿ãå æ­¤ï¼master èç¹ç cpuï¼åå­ä»¥åç£çéç½®å¯ä»¥æ¯ data èç¹å°å¾å¤çã\n\n# æ°æ®ï¼dataï¼èç¹\n\néç½® node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n\nå¨ elasticsearch 5.x çæ¬ä¹åï¼data èç¹åå¯åç»åä¸ºâhot-warmâæ¶æï¼å³åä¸ºç­èç¹ï¼hot nodeï¼åæèç¹ï¼warm nodeï¼ã\n\nhot èç¹ï¼\n\nhot èç¹ä¸»è¦æ¯ç´¢å¼èç¹ï¼åèç¹ï¼ï¼åæ¶ä¼ä¿å­è¿æçä¸äºé¢ç¹è¢«æ¥è¯¢çç´¢å¼ãç±äºè¿è¡ç´¢å¼éå¸¸èè´¹ cpu å ioï¼å³å±äº io å cpu å¯éåæä½ï¼å»ºè®®ä½¿ç¨ ssd çç£çç±»åï¼ä¿æè¯å¥½çåæ§è½ï¼æä»¬æ¨èé¨ç½²æå°åç 3 ä¸ª hot èç¹æ¥ä¿è¯é«å¯ç¨æ§ãæ ¹æ®è¿æéè¦æ¶éä»¥åæ¥è¯¢çæ°æ®éï¼å¯ä»¥å¢å æå¡å¨æ°éæ¥è·å¾æ³è¦çæ§è½ã\n\nå°èç¹è®¾ç½®ä¸º hot ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: hot\n\n\nå¦ææ¯éå¯¹æå®ç index æä½ï¼å¯ä»¥éè¿ settings è®¾ç½® index.routing.allocation.require.box_type: hot å°ç´¢å¼åå¥ hot èç¹ã\n\nwarm èç¹ï¼\n\nè¿ç§ç±»åçèç¹æ¯ä¸ºäºå¤çå¤§éçï¼èä¸ä¸ç»å¸¸è®¿é®çåªè¯»ç´¢å¼èè®¾è®¡çãç±äºè¿äºç´¢å¼æ¯åªè¯»çï¼warm èç¹å¾åäºæè½½å¤§éç£çï¼æ®éç£çï¼æ¥æ¿ä»£ ssdãåå­ãcpu çéç½®è· hot èç¹ä¿æä¸è´å³å¯ï¼èç¹æ°éä¸è¬ä¹æ¯å¤§äºç­äº 3 ä¸ªã\n\nå°èç¹è®¾ç½®ä¸º warm ç±»åéè¦ elasticsearch.yml å¦ä¸éç½®ï¼\n\nnode.attr.box_type: warm\n\n\nåæ¶ï¼ä¹å¯ä»¥å¨ elasticsearch.yml ä¸­è®¾ç½® index.codec:best_compression ä¿è¯ warm èç¹çåç¼©éç½®ã\n\nå½ç´¢å¼ä¸åè¢«é¢ç¹æ¥è¯¢æ¶ï¼å¯éè¿ index.routing.allocation.require.box_type:warmï¼å°ç´¢å¼æ è®°ä¸º warmï¼ä»èä¿è¯ç´¢å¼ä¸åå¥ hot èç¹ï¼ä»¥ä¾¿å° ssd ç£çèµæºç¨å¨ååä¸ãä¸æ¦è®¾ç½®è¿ä¸ªå±æ§ï¼es ä¼èªå¨å°ç´¢å¼åå¹¶å° warm èç¹ã\n\n# åè°ï¼coordinatingï¼èç¹\n\nåè°èç¹ç¨äºååå¸å¼éçåè°ï¼å°ååçæèç¹è¿åçæ°æ®æ´ååè¿åãè¯¥èç¹ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ãå¨ es éç¾¤ä¸­ï¼ææçèç¹é½æå¯è½æ¯åè°èç¹ï¼ä½æ¯ï¼å¯ä»¥éè¿è®¾ç½® node.masterãnode.dataãnode.ingest é½ä¸º false æ¥è®¾ç½®ä¸é¨çåè°èç¹ãéè¦è¾å¥½ç cpu åè¾é«çåå­ã\n\n * node.master:false å node.data:trueï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªæ°æ®èç¹ï¼åªç¨äºå­å¨ç´¢å¼æ°æ®ï¼ä½¿è¯¥ node æå¡å¨åè½åä¸ï¼åªç¨äºæ°æ®å­å¨åæ°æ®æ¥è¯¢ï¼éä½å¶èµæºæ¶èçã\n * node.master:true å node.data:falseï¼è¯¥ node æå¡å¨åªä½ä¸ºä¸ä¸ªä¸»èç¹ï¼ä½ä¸å­å¨ä»»ä½ç´¢å¼æ°æ®ï¼è¯¥ node æå¡å¨å°ä½¿ç¨èªèº«ç©ºé²çèµæºï¼æ¥åè°åç§åå»ºç´¢å¼è¯·æ±æèæ¥è¯¢è¯·æ±ï¼å¹¶å°è¿äºè¯·æ±åçååå°ç¸å³ç node æå¡å¨ä¸ã\n * node.master:false å node.data:falseï¼è¯¥ node æå¡å¨å³ä¸ä¼è¢«éä½ä¸»èç¹ï¼ä¹ä¸ä¼å­å¨ä»»ä½ç´¢å¼æ°æ®ãè¯¥æå¡å¨ä¸»è¦ç¨äºæ¥è¯¢è´è½½åè¡¡ãå¨æ¥è¯¢çæ¶åï¼éå¸¸ä¼æ¶åå°ä»å¤ä¸ª node æå¡å¨ä¸æ¥è¯¢æ°æ®ï¼å¹¶å°è¯·æ±ååå°å¤ä¸ªæå®ç node æå¡å¨ï¼å¹¶å¯¹åä¸ª node æå¡å¨è¿åçç»æè¿è¡ä¸ä¸ªæ±æ»å¤çï¼æç»è¿åç»å®¢æ·ç«¯ã\n\n\n# 5.2. å³é­ data èç¹æå¡å¨ä¸­ç http åè½\n\néå¯¹ elasticsearch éç¾¤ä¸­çæææ°æ®èç¹ï¼ä¸ç¨å¼å¯ http æå¡ãå°å¶ä¸­çéç½®åæ°è¿æ ·è®¾ç½®ï¼http.enabled:falseï¼åæ¶ä¹ä¸è¦å®è£ head, bigdesk, marvel ç­çæ§æä»¶ï¼è¿æ ·ä¿è¯ data èç¹æå¡å¨åªéå¤çåå»º/æ´æ°/å é¤/æ¥è¯¢ç´¢å¼æ°æ®ç­æä½ã\n\nhttp åè½å¯ä»¥å¨éæ°æ®èç¹æå¡å¨ä¸å¼å¯ï¼ä¸è¿°ç¸å³ççæ§æä»¶ä¹å®è£å°è¿äºæå¡å¨ä¸ï¼ç¨äºçæ§ elasticsearch éç¾¤ç¶æç­æ°æ®ä¿¡æ¯ãè¿æ ·åä¸æ¥åºäºæ°æ®å®å¨èèï¼äºæ¥åºäºæå¡æ§è½èèã\n\n\n# 5.3. ä¸å°æå¡å¨ä¸æå¥½åªé¨ç½²ä¸ä¸ª node\n\nä¸å°ç©çæå¡å¨ä¸å¯ä»¥å¯å¨å¤ä¸ª node æå¡å¨èç¹ï¼éè¿è®¾ç½®ä¸åçå¯å¨ portï¼ï¼ä½ä¸å°æå¡å¨ä¸ç cpuãåå­ãç¡¬çç­èµæºæ¯ç«æéï¼ä»æå¡å¨æ§è½èèï¼ä¸å»ºè®®ä¸å°æå¡å¨ä¸å¯å¨å¤ä¸ª node èç¹ã\n\n\n# 5.4. éç¾¤åçè®¾ç½®\n\nes ä¸æ¦åå»ºå¥½ç´¢å¼åï¼å°±æ æ³è°æ´åççè®¾ç½®ï¼èå¨ es ä¸­ï¼ä¸ä¸ªåçå®éä¸å¯¹åºä¸ä¸ª lucene ç´¢å¼ï¼è lucene ç´¢å¼çè¯»åä¼å ç¨å¾å¤çç³»ç»èµæºï¼å æ­¤ï¼åçæ°ä¸è½è®¾ç½®è¿å¤§ï¼æä»¥ï¼å¨åå»ºç´¢å¼æ¶ï¼åçéç½®åçæ°æ¯éå¸¸éè¦çãä¸è¬æ¥è¯´ï¼æä»¬éµå¾ªä¸äºååï¼\n\n 1. æ§å¶æ¯ä¸ªåçå ç¨çç¡¬çå®¹éä¸è¶è¿ es çæå¤§ jvm çå ç©ºé´è®¾ç½®ï¼ä¸è¬è®¾ç½®ä¸è¶è¿ 32 gï¼åèä¸é¢ç jvm åå­è®¾ç½®ååï¼ï¼å æ­¤ï¼å¦æç´¢å¼çæ»å®¹éå¨ 500 g å·¦å³ï¼é£åçå¤§å°å¨ 16 ä¸ªå·¦å³å³å¯ï¼å½ç¶ï¼æå¥½åæ¶èèåå 2ã\n 2. èèä¸ä¸ node æ°éï¼ä¸è¬ä¸ä¸ªèç¹ææ¶åå°±æ¯ä¸å°ç©çæºï¼å¦æåçæ°è¿å¤ï¼å¤§å¤§è¶è¿äºèç¹æ°ï¼å¾å¯è½ä¼å¯¼è´ä¸ä¸ªèç¹ä¸å­å¨å¤ä¸ªåçï¼ä¸æ¦è¯¥èç¹æéï¼å³ä½¿ä¿æäº 1 ä¸ªä»¥ä¸çå¯æ¬ï¼åæ ·æå¯è½ä¼å¯¼è´æ°æ®ä¸¢å¤±ï¼éç¾¤æ æ³æ¢å¤ãæä»¥ï¼ä¸è¬é½è®¾ç½®åçæ°ä¸è¶è¿èç¹æ°ç 3 åã\n\n\n# 6. åèèµæ\n\n * elasticsearch æç¨",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch Rest API",frontmatter:{title:"Elasticsearch Rest API",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","API"],permalink:"/pages/1edd27/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/11.ElasticsearchRestApi.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/11.ElasticsearchRestApi.md",key:"v-eca4e092",path:"/pages/1edd27/",headers:[{level:2,title:"1. ElasticSearch Rest API è¯­æ³æ ¼å¼",slug:"_1-elasticsearch-rest-api-è¯­æ³æ ¼å¼",normalizedTitle:"1. elasticsearch rest api è¯­æ³æ ¼å¼",charIndex:311},{level:2,title:"2. ç´¢å¼ API",slug:"_2-ç´¢å¼-api",normalizedTitle:"2. ç´¢å¼ api",charIndex:879},{level:3,title:"2.1. åå»ºç´¢å¼",slug:"_2-1-åå»ºç´¢å¼",normalizedTitle:"2.1. åå»ºç´¢å¼",charIndex:930},{level:3,title:"2.2. å é¤ç´¢å¼",slug:"_2-2-å é¤ç´¢å¼",normalizedTitle:"2.2. å é¤ç´¢å¼",charIndex:1499},{level:3,title:"2.3. æ¥çç´¢å¼",slug:"_2-3-æ¥çç´¢å¼",normalizedTitle:"2.3. æ¥çç´¢å¼",charIndex:1617},{level:3,title:"2.4. ç´¢å¼å«å",slug:"_2-4-ç´¢å¼å«å",normalizedTitle:"2.4. ç´¢å¼å«å",charIndex:2103},{level:3,title:"2.5. æå¼/å³é­ç´¢å¼",slug:"_2-5-æå¼-å³é­ç´¢å¼",normalizedTitle:"2.5. æå¼/å³é­ç´¢å¼",charIndex:2729},{level:2,title:"3. ææ¡£",slug:"_3-ææ¡£",normalizedTitle:"3. ææ¡£",charIndex:2889},{level:3,title:"3.1. åå»ºææ¡£",slug:"_3-1-åå»ºææ¡£",normalizedTitle:"3.1. åå»ºææ¡£",charIndex:5488},{level:4,title:"æå® ID",slug:"æå®-id",normalizedTitle:"æå® id",charIndex:3274},{level:4,title:"èªå¨çæ ID",slug:"èªå¨çæ-id",normalizedTitle:"èªå¨çæ id",charIndex:5664},{level:3,title:"3.2. å é¤ææ¡£",slug:"_3-2-å é¤ææ¡£",normalizedTitle:"3.2. å é¤ææ¡£",charIndex:5817},{level:3,title:"3.3. æ´æ°ææ¡£",slug:"_3-3-æ´æ°ææ¡£",normalizedTitle:"3.3. æ´æ°ææ¡£",charIndex:5891},{level:4,title:"åå é¤ï¼ååå¥",slug:"åå é¤-ååå¥",normalizedTitle:"åå é¤ï¼ååå¥",charIndex:5904},{level:4,title:"å¨åææ¡£ä¸å¢å å­æ®µ",slug:"å¨åææ¡£ä¸å¢å å­æ®µ",normalizedTitle:"å¨åææ¡£ä¸å¢å å­æ®µ",charIndex:3611},{level:3,title:"3.4. æ¥è¯¢ææ¡£",slug:"_3-4-æ¥è¯¢ææ¡£",normalizedTitle:"3.4. æ¥è¯¢ææ¡£",charIndex:6145},{level:4,title:"æå® ID æ¥è¯¢",slug:"æå®-id-æ¥è¯¢",normalizedTitle:"æå® id æ¥è¯¢",charIndex:6158},{level:4,title:"æ¥è¯¢ææè®°å½",slug:"æ¥è¯¢ææè®°å½",normalizedTitle:"æ¥è¯¢ææè®°å½",charIndex:6519},{level:3,title:"3.5. å¨ææç´¢",slug:"_3-5-å¨ææç´¢",normalizedTitle:"3.5. å¨ææç´¢",charIndex:7515},{level:3,title:"3.6. é»è¾è¿ç®",slug:"_3-6-é»è¾è¿ç®",normalizedTitle:"3.6. é»è¾è¿ç®",charIndex:8688},{level:3,title:"3.7. æ¹éæ§è¡",slug:"_3-7-æ¹éæ§è¡",normalizedTitle:"3.7. æ¹éæ§è¡",charIndex:9098},{level:3,title:"3.8. æ¹éè¯»å",slug:"_3-8-æ¹éè¯»å",normalizedTitle:"3.8. æ¹éè¯»å",charIndex:9551},{level:3,title:"3.9. æ¹éæ¥è¯¢",slug:"_3-9-æ¹éæ¥è¯¢",normalizedTitle:"3.9. æ¹éæ¥è¯¢",charIndex:10366},{level:3,title:"3.10. URI Search æ¥è¯¢è¯­ä¹",slug:"_3-10-uri-search-æ¥è¯¢è¯­ä¹",normalizedTitle:"3.10. uri search æ¥è¯¢è¯­ä¹",charIndex:10549},{level:4,title:"Term å Phrase",slug:"term-å-phrase",normalizedTitle:"term å phrase",charIndex:10925},{level:4,title:"åç»ä¸å¼å·",slug:"åç»ä¸å¼å·",normalizedTitle:"åç»ä¸å¼å·",charIndex:11183},{level:4,title:"ANDãORãNOT æè &&ã||ã!",slug:"andãorãnot-æè-ã-ã",normalizedTitle:"andãorãnot æè &amp;&amp;ã||ã!",charIndex:null},{level:4,title:"èå´æ¥è¯¢",slug:"èå´æ¥è¯¢",normalizedTitle:"èå´æ¥è¯¢",charIndex:11444},{level:4,title:"ç®æ°ç¬¦å·",slug:"ç®æ°ç¬¦å·",normalizedTitle:"ç®æ°ç¬¦å·",charIndex:11665},{level:4,title:"ééç¬¦æ¥è¯¢",slug:"ééç¬¦æ¥è¯¢",normalizedTitle:"ééç¬¦æ¥è¯¢",charIndex:11919},{level:4,title:"æ­£åè¡¨è¾¾å¼",slug:"æ­£åè¡¨è¾¾å¼",normalizedTitle:"æ­£åè¡¨è¾¾å¼",charIndex:12075},{level:4,title:"æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢",slug:"æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢",normalizedTitle:"æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢",charIndex:12098},{level:3,title:"3.11. Request Body & DSL",slug:"_3-11-request-body-dsl",normalizedTitle:"3.11. request body &amp; dsl",charIndex:null},{level:4,title:"åé¡µ",slug:"åé¡µ",normalizedTitle:"åé¡µ",charIndex:10796},{level:4,title:"æåº",slug:"æåº",normalizedTitle:"æåº",charIndex:1927},{level:4,title:"_source è¿æ»¤",slug:"source-è¿æ»¤",normalizedTitle:"_source è¿æ»¤",charIndex:12931},{level:4,title:"èæ¬å­æ®µ",slug:"èæ¬å­æ®µ",normalizedTitle:"èæ¬å­æ®µ",charIndex:13245},{level:4,title:"ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - Match",slug:"ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼-match",normalizedTitle:"ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - match",charIndex:13568},{level:4,title:"ç­è¯­æç´¢ - Match Phrase",slug:"ç­è¯­æç´¢-match-phrase",normalizedTitle:"ç­è¯­æç´¢ - match phrase",charIndex:13833},{level:2,title:"4. éç¾¤ API",slug:"_4-éç¾¤-api",normalizedTitle:"4. éç¾¤ api",charIndex:13987},{level:3,title:"4.1. éç¾¤å¥åº· API",slug:"_4-1-éç¾¤å¥åº·-api",normalizedTitle:"4.1. éç¾¤å¥åº· api",charIndex:15284},{level:3,title:"4.2. éç¾¤ç¶æ API",slug:"_4-2-éç¾¤ç¶æ-api",normalizedTitle:"4.2. éç¾¤ç¶æ api",charIndex:15497},{level:2,title:"5. èç¹ API",slug:"_5-èç¹-api",normalizedTitle:"5. èç¹ api",charIndex:15563},{level:2,title:"6. åç API",slug:"_6-åç-api",normalizedTitle:"6. åç api",charIndex:15711},{level:2,title:"7. çæ§ API",slug:"_7-çæ§-api",normalizedTitle:"7. çæ§ api",charIndex:15974},{level:2,title:"8. åèèµæ",slug:"_8-åèèµæ",normalizedTitle:"8. åèèµæ",charIndex:16578}],headersStr:"1. ElasticSearch Rest API è¯­æ³æ ¼å¼ 2. ç´¢å¼ API 2.1. åå»ºç´¢å¼ 2.2. å é¤ç´¢å¼ 2.3. æ¥çç´¢å¼ 2.4. ç´¢å¼å«å 2.5. æå¼/å³é­ç´¢å¼ 3. ææ¡£ 3.1. åå»ºææ¡£ æå® ID èªå¨çæ ID 3.2. å é¤ææ¡£ 3.3. æ´æ°ææ¡£ åå é¤ï¼ååå¥ å¨åææ¡£ä¸å¢å å­æ®µ 3.4. æ¥è¯¢ææ¡£ æå® ID æ¥è¯¢ æ¥è¯¢ææè®°å½ 3.5. å¨ææç´¢ 3.6. é»è¾è¿ç® 3.7. æ¹éæ§è¡ 3.8. æ¹éè¯»å 3.9. æ¹éæ¥è¯¢ 3.10. URI Search æ¥è¯¢è¯­ä¹ Term å Phrase åç»ä¸å¼å· ANDãORãNOT æè &&ã||ã! èå´æ¥è¯¢ ç®æ°ç¬¦å· ééç¬¦æ¥è¯¢ æ­£åè¡¨è¾¾å¼ æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢ 3.11. Request Body & DSL åé¡µ æåº _source è¿æ»¤ èæ¬å­æ®µ ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - Match ç­è¯­æç´¢ - Match Phrase 4. éç¾¤ API 4.1. éç¾¤å¥åº· API 4.2. éç¾¤ç¶æ API 5. èç¹ API 6. åç API 7. çæ§ API 8. åèèµæ",content:'# ElasticSearch Rest API\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> Elasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° ESã\n> \n> REST API æè¯¦å°½çææ¡£åºè¯¥åèï¼ES å®æ¹ REST API\n\n\n# 1. ElasticSearch Rest API è¯­æ³æ ¼å¼\n\nå Elasticsearch ååºçè¯·æ±çç»æé¨åä¸å¶å®æ®éç HTTP è¯·æ±æ¯ä¸æ ·çï¼\n\ncurl -X<VERB> \'<PROTOCOL>://<HOST>:<PORT>/<PATH>?<QUERY_STRING>\' -d \'<BODY>\'\n\n\n * VERBï¼HTTP æ¹æ³ï¼æ¯æï¼GET, POST, PUT, HEAD, DELETE\n * PROTOCOLï¼http æè https åè®®ï¼åªæå¨ Elasticsearch åé¢æ https ä»£ççæ¶åå¯ç¨ï¼\n * HOSTï¼Elasticsearch éç¾¤ä¸­çä»»ä½ä¸ä¸ªèç¹çä¸»æºåï¼å¦ææ¯å¨æ¬å°çèç¹ï¼é£ä¹å°±å« localhost\n * PORTï¼Elasticsearch HTTP æå¡æå¨çç«¯å£ï¼é»è®¤ä¸º 9200 PATH API è·¯å¾ï¼ä¾å¦_count å°è¿åéç¾¤ä¸­ææ¡£çæ°éï¼ï¼\n * PATHï¼å¯ä»¥åå«å¤ä¸ªç»ä»¶ï¼ä¾å¦ _cluster/stats æè _nodes/stats/jvm\n * QUERY_STRINGï¼ä¸äºå¯éçæ¥è¯¢è¯·æ±åæ°ï¼ä¾å¦?pretty åæ°å°ä½¿è¯·æ±è¿åæ´å ç¾è§æè¯»ç JSON æ°æ®\n * BODYï¼ä¸ä¸ª JSON æ ¼å¼çè¯·æ±ä¸»ä½ï¼å¦æè¯·æ±éè¦çè¯ï¼\n\n\n# 2. ç´¢å¼ API\n\n> åèèµæï¼Elasticsearch å®æ¹ä¹ cat ç´¢å¼ API\n\n\n# 2.1. åå»ºç´¢å¼\n\næ°å»º Indexï¼å¯ä»¥ç´æ¥å ES æå¡å¨ååº PUT è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\nPUT /my_index\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\nç¤ºä¾ï¼\n\nPUT /user\n{\n  "settings": {\n    "index": {\n      "number_of_shards": 3,\n      "number_of_replicas": 2\n    }\n  }\n}\n\n\næå¡å¨è¿åä¸ä¸ª JSON å¯¹è±¡ï¼éé¢ç acknowledged å­æ®µè¡¨ç¤ºæä½æåã\n\n{"acknowledged":true,"shards_acknowledged":true,"index":"user"}\n\n\nå¦æä½ æ³ç¦æ­¢èªå¨åå»ºç´¢å¼ï¼å¯ä»¥éè¿å¨ config/elasticsearch.yml çæ¯ä¸ªèç¹ä¸æ·»å ä¸é¢çéç½®ï¼\n\naction.auto_create_index: false\n\n\n\n# 2.2. å é¤ç´¢å¼\n\nç¶åï¼æä»¬å¯ä»¥éè¿åé DELETE è¯·æ±ï¼å é¤è¿ä¸ª Indexã\n\nDELETE /user\n\n\nå é¤å¤ä¸ªç´¢å¼\n\nDELETE /index_one,index_two\nDELETE /index_*\n\n\n\n# 2.3. æ¥çç´¢å¼\n\nå¯ä»¥éè¿ GET è¯·æ±æ¥çç´¢å¼ä¿¡æ¯\n\n# æ¥çç´¢å¼ç¸å³ä¿¡æ¯\nGET kibana_sample_data_ecommerce\n\n# æ¥çç´¢å¼çææ¡£æ»æ°\nGET kibana_sample_data_ecommerce/_count\n\n# æ¥çå10æ¡ææ¡£ï¼äºè§£ææ¡£æ ¼å¼\nGET kibana_sample_data_ecommerce/_search\n\n# _cat indices API\n# æ¥çindices\nGET /_cat/indices/kibana*?v&s=index\n\n# æ¥çç¶æä¸ºç»¿çç´¢å¼\nGET /_cat/indices?v&health=green\n\n# æç§ææ¡£ä¸ªæ°æåº\nGET /_cat/indices?v&s=docs.count:desc\n\n# æ¥çå·ä½çå­æ®µ\nGET /_cat/indices/kibana*?pri&v&h=health,index,pri,rep,docs.count,mt\n\n# æ¥çç´¢å¼å ç¨çåå­\nGET /_cat/indices?v&h=i,tm&s=tm:desc\n\n\n\n# 2.4. ç´¢å¼å«å\n\nES çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nPUT /my_index\nPUT /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\nPOST /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º ES ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nES ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç Elasticsearchï¼ESï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# 2.5. æå¼/å³é­ç´¢å¼\n\néè¿å¨ POST ä¸­æ·»å  _close æ _open å¯ä»¥æå¼ãå³é­ç´¢å¼ã\n\næå¼ç´¢å¼\n\n# æå¼ç´¢å¼\nPOST kibana_sample_data_ecommerce/_open\n# å³é­ç´¢å¼\nPOST kibana_sample_data_ecommerce/_close\n\n\n\n# 3. ææ¡£\n\n############Create Document############\n#create document. èªå¨çæ _id\nPOST users/_doc\n{\n\t"user" : "Mike",\n    "post_date" : "2019-04-15T14:12:12",\n    "message" : "trying out Kibana"\n}\n\n#create document. æå®Idãå¦æidå·²ç»å­å¨ï¼æ¥é\nPUT users/_doc/1?op_type=create\n{\n    "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\n\n#create document. æå® ID å¦æå·²ç»å­å¨ï¼å°±æ¥é\nPUT users/_create/1\n{\n     "user" : "Jack",\n    "post_date" : "2019-05-15T14:12:12",\n    "message" : "trying out Elasticsearch"\n}\n\n### Get Document by ID\n#Get the document by ID\nGET users/_doc/1\n\n\n###  Index & Update\n#Update æå® ID  (åå é¤ï¼å¨åå¥)\nGET users/_doc/1\n\nPUT users/_doc/1\n{\n\t"user" : "Mike"\n\n}\n\n\n#GET users/_doc/1\n#å¨åææ¡£ä¸å¢å å­æ®µ\nPOST users/_update/1/\n{\n    "doc":{\n        "post_date" : "2019-05-15T14:12:12",\n        "message" : "trying out Elasticsearch"\n    }\n}\n\n\n\n### Delete by Id\n# å é¤ææ¡£\nDELETE users/_doc/1\n\n\n### Bulk æä½\n#æ§è¡ä¸¤æ¬¡ï¼æ¥çæ¯æ¬¡çç»æ\n\n#æ§è¡ç¬¬1æ¬¡\nPOST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n#æ§è¡ç¬¬2æ¬¡\nPOST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n### mget æä½\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\n#URIä¸­æå®index\nGET /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\n\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n### msearch æä½\nPOST kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n### æ¸é¤æµè¯æ°æ®\n#æ¸é¤æ°æ®\nDELETE users\nDELETE test\nDELETE test2\n\n\n\n# 3.1. åå»ºææ¡£\n\n# æå® ID\n\nè¯­æ³æ ¼å¼ï¼\n\nPUT /_index/_type/_create/_id\n\n\nç¤ºä¾ï¼\n\nPUT /user/_doc/_create/1\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "æ°æ®åºç®¡ç"\n}\n\n\n> æ³¨æï¼æå® Idï¼å¦æ id å·²ç»å­å¨ï¼åæ¥é\n\n# èªå¨çæ ID\n\næ°å¢è®°å½çæ¶åï¼ä¹å¯ä»¥ä¸æå® Idï¼è¿æ¶è¦æ¹æ POST è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\nPOST /_index/_type\n\n\nç¤ºä¾ï¼\n\nPOST /user/_doc\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n\n# 3.2. å é¤ææ¡£\n\nè¯­æ³æ ¼å¼ï¼\n\nDELETE /_index/_doc/_id\n\n\nç¤ºä¾ï¼\n\nDELETE /user/_doc/1\n\n\n\n# 3.3. æ´æ°ææ¡£\n\n# åå é¤ï¼ååå¥\n\nè¯­æ³æ ¼å¼ï¼\n\nPUT /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nPUT /user/_doc/1\n{\n  "user": "æå",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n# å¨åææ¡£ä¸å¢å å­æ®µ\n\nè¯­æ³æ ¼å¼ï¼\n\nPOST /_index/_update/_id\n\n\nç¤ºä¾ï¼\n\nPOST /user/_update/1\n{\n    "doc":{\n        "age" : "30"\n    }\n}\n\n\n\n# 3.4. æ¥è¯¢ææ¡£\n\n# æå® ID æ¥è¯¢\n\nè¯­æ³æ ¼å¼ï¼\n\nGET /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nGET /user/_doc/1\n\n\nç»æï¼\n\n{\n  "_index": "user",\n  "_type": "_doc",\n  "_id": "1",\n  "_version": 1,\n  "_seq_no": 536248,\n  "_primary_term": 2,\n  "found": true,\n  "_source": {\n    "user": "å¼ ä¸",\n    "title": "å·¥ç¨å¸",\n    "desc": "æ°æ®åºç®¡ç"\n  }\n}\n\n\nè¿åçæ°æ®ä¸­ï¼found å­æ®µè¡¨ç¤ºæ¥è¯¢æåï¼_source å­æ®µè¿ååå§è®°å½ã\n\nå¦æ id ä¸æ­£ç¡®ï¼å°±æ¥ä¸å°æ°æ®ï¼found å­æ®µå°±æ¯ false\n\n# æ¥è¯¢ææè®°å½\n\nä½¿ç¨ GET æ¹æ³ï¼ç´æ¥è¯·æ± /index/type/_searchï¼å°±ä¼è¿åææè®°å½ã\n\n$ curl \'localhost:9200/user/admin/_search?pretty\'\n{\n  "took" : 1,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 1.0,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "WWuoDG8BHwECs7SiYn93",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nä¸é¢ä»£ç ä¸­ï¼è¿åç»æç tookå­æ®µè¡¨ç¤ºè¯¥æä½çèæ¶ï¼åä½ä¸ºæ¯«ç§ï¼ï¼timed_outå­æ®µè¡¨ç¤ºæ¯å¦è¶æ¶ï¼hitså­æ®µè¡¨ç¤ºå½ä¸­çè®°å½ï¼éé¢å­å­æ®µçå«ä¹å¦ä¸ã\n\n * totalï¼è¿åè®°å½æ°ï¼æ¬ä¾æ¯ 2 æ¡ã\n * max_scoreï¼æé«çå¹éç¨åº¦ï¼æ¬ä¾æ¯1.0ã\n * hitsï¼è¿åçè®°å½ç»æçæ°ç»ã\n\nè¿åçè®°å½ä¸­ï¼æ¯æ¡è®°å½é½æä¸ä¸ª_scoreå­æ®µï¼è¡¨ç¤ºå¹éçç¨åºï¼é»è®¤æ¯æç§è¿ä¸ªå­æ®µéåºæåã\n\n\n# 3.5. å¨ææç´¢\n\nES çæ¥è¯¢éå¸¸ç¹å«ï¼ä½¿ç¨èªå·±çæ¥è¯¢è¯­æ³ï¼è¦æ± GET è¯·æ±å¸¦ææ°æ®ä½ã\n\n$ curl -H \'Content-Type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n"query" : { "match" : { "desc" : "ç®¡ç" }}\n}\'\n\n\nä¸é¢ä»£ç ä½¿ç¨ Match æ¥è¯¢ï¼æå®çå¹éæ¡ä»¶æ¯descå­æ®µéé¢åå«"è½¯ä»¶"è¿ä¸ªè¯ãè¿åç»æå¦ä¸ã\n\n{\n  "took" : 2,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 0.38200712,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "WWuoDG8BHwECs7SiYn93",\n        "_score" : 0.38200712,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 0.3487891,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nElastic é»è®¤ä¸æ¬¡è¿å 10 æ¡ç»æï¼å¯ä»¥éè¿sizeå­æ®µæ¹åè¿ä¸ªè®¾ç½®ï¼è¿å¯ä»¥éè¿fromå­æ®µï¼æå®ä½ç§»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n  "query" : { "match" : { "desc" : "ç®¡ç" }},\n  "from": 1,\n  "size": 1\n}\'\n\n\nä¸é¢ä»£ç æå®ï¼ä»ä½ç½® 1 å¼å§ï¼é»è®¤æ¯ä»ä½ç½® 0 å¼å§ï¼ï¼åªè¿åä¸æ¡ç»æã\n\n\n# 3.6. é»è¾è¿ç®\n\nå¦ææå¤ä¸ªæç´¢å³é®å­ï¼ Elastic è®¤ä¸ºå®ä»¬æ¯orå³ç³»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n"query" : { "match" : { "desc" : "è½¯ä»¶ ç³»ç»" }}\n}\'\n\n\nä¸é¢ä»£ç æç´¢çæ¯è½¯ä»¶ or ç³»ç»ã\n\nå¦æè¦æ§è¡å¤ä¸ªå³é®è¯çandæç´¢ï¼å¿é¡»ä½¿ç¨å¸å°æ¥è¯¢ã\n\n$ curl -H \'Content-Type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n "query": {\n  "bool": {\n   "must": [\n    { "match": { "desc": "ç®¡ç" } },\n    { "match": { "desc": "è¶çº§" } }\n   ]\n  }\n }\n}\'\n\n\n\n# 3.7. æ¹éæ§è¡\n\næ¯æå¨ä¸æ¬¡ API è°ç¨ä¸­ï¼å¯¹ä¸åçç´¢å¼è¿è¡æä½\n\næ¯æåç§ç±»åæä½\n\n * index\n * create\n * update\n * delete\n\næä½ä¸­åæ¡æä½å¤±è´¥ï¼å¹¶ä¸ä¼å½±åå¶ä»æä½ã\n\nè¿åç»æåæ¬äºæ¯ä¸æ¡æä½æ§è¡çç»æã\n\nPOST _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n> è¯´æï¼ä¸é¢çç¤ºä¾å¦ææ§è¡å¤æ¬¡ï¼æ§è¡ç»æé½ä¸ä¸æ ·ã\n\n\n# 3.8. æ¹éè¯»å\n\nè¯»å¤ä¸ªç´¢å¼\n\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\nè¯»ä¸ä¸ªç´¢å¼\n\nGET /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\nGET /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n\n\n# 3.9. æ¹éæ¥è¯¢\n\nPOST kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n\n# 3.10. URI Search æ¥è¯¢è¯­ä¹\n\nElasticsearch URI Search éµå¾ª QueryString æ¥è¯¢è¯­ä¹ï¼å¶å½¢å¼å¦ä¸ï¼\n\nGET /movies/_search?q=2012&df=title&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile": true\n}\n\n\n * q æå®æ¥è¯¢è¯­å¥ï¼ä½¿ç¨ QueryString è¯­ä¹\n * df é»è®¤å­æ®µï¼ä¸æå®æ¶\n * sort æåºï¼from å size ç¨äºåé¡µ\n * profile å¯ä»¥æ¥çæ¥è¯¢æ¶å¦ä½è¢«æ§è¡ç\n\nGET /movies/_search?q=title:2012&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile":"true"\n}\n\n\n# Term å Phrase\n\nBeautiful Mind ç­æäº Beautiful OR Mind\n\n"Beautiful Mind" ç­æäº Beautiful AND Mind\n\n# Term æ¥è¯¢\nGET /movies/_search?q=title:Beautiful Mind\n{\n\t"profile":"true"\n}\n\n# ä½¿ç¨å¼å·ï¼Phrase æ¥è¯¢\nGET /movies/_search?q=title:"Beautiful Mind"\n{\n\t"profile":"true"\n}\n\n\n# åç»ä¸å¼å·\n\ntitle:(Beautiful AND Mind)\n\ntitle="Beautiful Mind"\n\n# ANDãORãNOT æè &&ã||ã!\n\n> æ³¨æï¼ANDãORãNOT å¿é¡»å¤§å\n\n# å¸å°æä½ç¬¦\nGET /movies/_search?q=title:(Beautiful AND Mind)\n{\n\t"profile":"true"\n}\n\nGET /movies/_search?q=title:(Beautiful NOT Mind)\n{\n\t"profile":"true"\n}\n\n\n# èå´æ¥è¯¢\n\n * [] è¡¨ç¤ºé­åºé´\n * {} è¡¨ç¤ºå¼åºé´\n\nç¤ºä¾ï¼\n\n# èå´æ¥è¯¢ ,åºé´åæ³\nGET /movies/_search?q=title:beautiful AND year:{2010 TO 2018%7D\n{\n\t"profile":"true"\n}\n\nGET /movies/_search?q=title:beautiful AND year:[* TO 2018]\n{\n\t"profile":"true"\n}\n\n\n# ç®æ°ç¬¦å·\n\n# 2010 å¹´ä»¥åçè®°å½\nGET /movies/_search?q=year:>2010\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nGET /movies/_search?q=year:(>2010 && <=2018)\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nGET /movies/_search?q=year:(+>2010 +<=2018)\n{\n\t"profile":"true"\n}\n\n\n# ééç¬¦æ¥è¯¢\n\n * ? ä»£è¡¨ 1 ä¸ªå­ç¬¦\n * * ä»£è¡¨ 0 æå¤ä¸ªå­ç¬¦\n\nç¤ºä¾ï¼\n\nGET /movies/_search?q=title:mi?d\n{\n\t"profile":"true"\n}\n\nGET /movies/_search?q=title:b*\n{\n\t"profile":"true"\n}\n\n\n# æ­£åè¡¨è¾¾å¼\n\ntitle:[bt]oy\n\n# æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢\n\nç¤ºä¾ï¼\n\n# ç¸ä¼¼åº¦å¨ 1 ä¸ªå­ç¬¦ä»¥å\nGET /movies/_search?q=title:beautifl~1\n{\n\t"profile":"true"\n}\n\n# ç¸ä¼¼åº¦å¨ 2 ä¸ªå­ç¬¦ä»¥å\nGET /movies/_search?q=title:"Lord Rings"~2\n{\n\t"profile":"true"\n}\n\n\n\n# 3.11. Request Body & DSL\n\nElasticsearch é¤äº URI Search æ¥è¯¢æ¹å¼ï¼è¿æ¯æå°æ¥è¯¢è¯­å¥éè¿ Http Request Body åèµ·æ¥è¯¢ã\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n\t"profile":"true",\n\t"query": {\n\t  "match_all": {}\n\t}\n}\n\n\n# åé¡µ\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "from": 0,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# æåº\n\næå¥½å¨æ°å­åææ¥æåå­æ®µä¸æåº\n\nå ä¸ºå¯¹äºå¤å¼ç±»åæåæè¿çå­æ®µæåºï¼ç³»ç»ä¼éä¸ä¸ªå¼ï¼æ æ³å¾ç¥è¯¥å¼\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "sort": [\n    {\n      "order_date": "desc"\n    }\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# _source è¿æ»¤\n\nå¦æ _source æ²¡æå­å¨ï¼é£å°±åªè¿åå¹éçææ¡£çåæ°æ®\n\n_source æ¯æä½¿ç¨ééç¬¦ï¼å¦ï¼_source["name*", "desc*"]\n\nç¤ºä¾ï¼\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "_source": [\n    "order_date",\n    "category.keyword"\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# èæ¬å­æ®µ\n\nGET /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "script_fields": {\n    "new_field": {\n      "script": {\n        "lang": "painless",\n        "source":"doc[\'order_date\'].value+\' hello\'"\n      }\n    }\n  },\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n\n# ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - Match\n\nPOST movies/_search\n{\n  "query": {\n    "match": {\n      "title": "last christmas"\n    }\n  }\n}\n\nPOST movies/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "last christmas",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\n\n# ç­è¯­æç´¢ - Match Phrase\n\nPOST movies/_search\n{\n  "query": {\n    "match_phrase": {\n      "title":{\n        "query": "last christmas"\n\n      }\n    }\n  }\n}\n\n\n\n# 4. éç¾¤ API\n\n> Elasticsearch å®æ¹ä¹ Cluster API\n\nä¸äºéç¾¤çº§å«ç API å¯è½ä¼å¨èç¹çå­éä¸è¿è¡ï¼è¿äºèç¹å¯ä»¥ç¨èç¹è¿æ»¤å¨æå®ãä¾å¦ï¼ä»»å¡ç®¡çãèç¹ç»è®¡åèç¹ä¿¡æ¯ API é½å¯ä»¥æ¥åæ¥èªä¸ç»è¿æ»¤èç¹èä¸æ¯ææèç¹çç»æã\n\nèç¹è¿æ»¤å¨ä»¥éå·åéçåä¸ªè¿æ»¤å¨åè¡¨çå½¢å¼ç¼åï¼æ¯ä¸ªè¿æ»¤å¨ä»æéå­éä¸­æ·»å æå é¤èç¹ãæ¯ä¸ªè¿æ»¤å¨å¯ä»¥æ¯ä»¥ä¸ä¹ä¸ï¼\n\n * _allï¼å°ææèç¹æ·»å å°å­é\n * _localï¼å°æ¬å°èç¹æ·»å å°å­é\n * _masterï¼å°å½åä¸»èç¹æ·»å å°å­é\n * æ ¹æ®èç¹ ID æèç¹åå°å¹éèç¹æ·»å å°å­é\n * æ ¹æ® IP å°åæä¸»æºåå°å¹éèç¹æ·»å å°å­é\n * ä½¿ç¨ééç¬¦ï¼å°èç¹åãå°ååæä¸»æºåå¹éçèç¹æ·»å å°å­é\n * master:true, data:true, ingest:true, voting_only:true, ml:true æ coordinating_only:true, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æ·»å å°å­éä¸­ã\n * master:false, data:false, ingest:false, voting_only:true, ml:false æ coordinating_only:false, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æé¤å¨å­éå¤ã\n * éå¯¹æ¨¡å¼ï¼ä½¿ç¨ * ééç¬¦ï¼æ ¼å¼ä¸º attrname:attrvalueï¼å°ææå·æèªå®ä¹èç¹å±æ§çèç¹æ·»å å°å­éä¸­ï¼å¶åç§°åå¼ä¸ç¸åºçæ¨¡å¼å¹éãèªå®ä¹èç¹å±æ§æ¯éè¿ node.attr.attrname: attrvalue å½¢å¼å¨éç½®æä»¶ä¸­è®¾ç½®çã\n\n# å¦ææ²¡æç»åºè¿æ»¤å¨ï¼é»è®¤æ¯æ¥è¯¢ææèç¹\nGET /_nodes\n# æ¥è¯¢ææèç¹\nGET /_nodes/_all\n# æ¥è¯¢æ¬å°èç¹\nGET /_nodes/_local\n# æ¥è¯¢ä¸»èç¹\nGET /_nodes/_master\n# æ ¹æ®åç§°æ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nGET /_nodes/node_name_goes_here\nGET /_nodes/node_name_goes_*\n# æ ¹æ®å°åæ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nGET /_nodes/10.0.0.3,10.0.0.4\nGET /_nodes/10.0.0.*\n# æ ¹æ®è§åæ¥è¯¢èç¹\nGET /_nodes/_all,master:false\nGET /_nodes/data:true,ingest:true\nGET /_nodes/coordinating_only:true\nGET /_nodes/master:true,voting_only:false\n# æ ¹æ®èªå®ä¹å±æ§æ¥è¯¢èç¹ï¼å¦ï¼æ¥è¯¢éç½®æä»¶ä¸­å« node.attr.rack:2 å±æ§çèç¹ï¼\nGET /_nodes/rack:2\nGET /_nodes/ra*:2\nGET /_nodes/ra*:2*\n\n\n\n# 4.1. éç¾¤å¥åº· API\n\nGET /_cluster/health\nGET /_cluster/health?level=shards\nGET /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights\nGET /_cluster/health/kibana_sample_data_flights?level=shards\n\n\n\n# 4.2. éç¾¤ç¶æ API\n\néç¾¤ç¶æ API è¿åè¡¨ç¤ºæ´ä¸ªéç¾¤ç¶æçåæ°æ®ã\n\nGET /_cluster/state\n\n\n\n# 5. èç¹ API\n\n> Elasticsearch å®æ¹ä¹ cat Nodes APIââè¿åæå³éç¾¤èç¹çä¿¡æ¯ã\n\n# æ¥çé»è®¤çå­æ®µ\nGET /_cat/nodes?v=true\n# æ¥çæå®çå­æ®µ\nGET /_cat/nodes?v=true&h=id,ip,port,v,m\n\n\n\n# 6. åç API\n\n> Elasticsearch å®æ¹ä¹ cat Shards APIââshards å½ä»¤æ¯åªäºèç¹åå«åªäºåççè¯¦ç»è§å¾ãå®ä¼åè¯ä½ å®æ¯ä¸»è¿æ¯å¯æ¬ãææ¡£æ°éãå®å¨ç£çä¸å ç¨çå­èæ°ä»¥åå®æå¨çèç¹ã\n\n# æ¥çé»è®¤çå­æ®µ\nGET /_cat/shards\n# æ ¹æ®åç§°æ¥è¯¢åçï¼æ¯æééç¬¦ï¼\nGET /_cat/shards/my-index-*\n# æ¥çæå®çå­æ®µ\nGET /_cat/shards?h=index,shard,prirep,state,unassigned.reason\n\n\n\n# 7. çæ§ API\n\nElasticsearch ä¸­éç¾¤ç¸å³çå¥åº·ãç»è®¡ç­ç¸å³çä¿¡æ¯é½æ¯å´ç»ç cat API è¿è¡çã\n\néè¿ GET è¯·æ±åé catï¼ä¸é¢ååºäºææå¯ç¨ç APIï¼\n\nGET /_cat\n\n=^.^=\n/_cat/allocation\n/_cat/shards\n/_cat/shards/{index}\n/_cat/master\n/_cat/nodes\n/_cat/tasks\n/_cat/indices\n/_cat/indices/{index}\n/_cat/segments\n/_cat/segments/{index}\n/_cat/count\n/_cat/count/{index}\n/_cat/recovery\n/_cat/recovery/{index}\n/_cat/health\n/_cat/pending_tasks\n/_cat/aliases\n/_cat/aliases/{alias}\n/_cat/thread_pool\n/_cat/thread_pool/{thread_pools}\n/_cat/plugins\n/_cat/fielddata\n/_cat/fielddata/{fields}\n/_cat/nodeattrs\n/_cat/repositories\n/_cat/snapshots/{repository}\n/_cat/templates\n\n\n\n# 8. åèèµæ\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£',normalizedContent:'# elasticsearch rest api\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n> \n> elasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n> \n> ä»¥ä¸ç®ç§° esã\n> \n> rest api æè¯¦å°½çææ¡£åºè¯¥åèï¼es å®æ¹ rest api\n\n\n# 1. elasticsearch rest api è¯­æ³æ ¼å¼\n\nå elasticsearch ååºçè¯·æ±çç»æé¨åä¸å¶å®æ®éç http è¯·æ±æ¯ä¸æ ·çï¼\n\ncurl -x<verb> \'<protocol>://<host>:<port>/<path>?<query_string>\' -d \'<body>\'\n\n\n * verbï¼http æ¹æ³ï¼æ¯æï¼get, post, put, head, delete\n * protocolï¼http æè https åè®®ï¼åªæå¨ elasticsearch åé¢æ https ä»£ççæ¶åå¯ç¨ï¼\n * hostï¼elasticsearch éç¾¤ä¸­çä»»ä½ä¸ä¸ªèç¹çä¸»æºåï¼å¦ææ¯å¨æ¬å°çèç¹ï¼é£ä¹å°±å« localhost\n * portï¼elasticsearch http æå¡æå¨çç«¯å£ï¼é»è®¤ä¸º 9200 path api è·¯å¾ï¼ä¾å¦_count å°è¿åéç¾¤ä¸­ææ¡£çæ°éï¼ï¼\n * pathï¼å¯ä»¥åå«å¤ä¸ªç»ä»¶ï¼ä¾å¦ _cluster/stats æè _nodes/stats/jvm\n * query_stringï¼ä¸äºå¯éçæ¥è¯¢è¯·æ±åæ°ï¼ä¾å¦?pretty åæ°å°ä½¿è¯·æ±è¿åæ´å ç¾è§æè¯»ç json æ°æ®\n * bodyï¼ä¸ä¸ª json æ ¼å¼çè¯·æ±ä¸»ä½ï¼å¦æè¯·æ±éè¦çè¯ï¼\n\n\n# 2. ç´¢å¼ api\n\n> åèèµæï¼elasticsearch å®æ¹ä¹ cat ç´¢å¼ api\n\n\n# 2.1. åå»ºç´¢å¼\n\næ°å»º indexï¼å¯ä»¥ç´æ¥å es æå¡å¨ååº put è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\nput /my_index\n{\n    "settings": { ... any settings ... },\n    "mappings": {\n        "type_one": { ... any mappings ... },\n        "type_two": { ... any mappings ... },\n        ...\n    }\n}\n\n\nç¤ºä¾ï¼\n\nput /user\n{\n  "settings": {\n    "index": {\n      "number_of_shards": 3,\n      "number_of_replicas": 2\n    }\n  }\n}\n\n\næå¡å¨è¿åä¸ä¸ª json å¯¹è±¡ï¼éé¢ç acknowledged å­æ®µè¡¨ç¤ºæä½æåã\n\n{"acknowledged":true,"shards_acknowledged":true,"index":"user"}\n\n\nå¦æä½ æ³ç¦æ­¢èªå¨åå»ºç´¢å¼ï¼å¯ä»¥éè¿å¨ config/elasticsearch.yml çæ¯ä¸ªèç¹ä¸æ·»å ä¸é¢çéç½®ï¼\n\naction.auto_create_index: false\n\n\n\n# 2.2. å é¤ç´¢å¼\n\nç¶åï¼æä»¬å¯ä»¥éè¿åé delete è¯·æ±ï¼å é¤è¿ä¸ª indexã\n\ndelete /user\n\n\nå é¤å¤ä¸ªç´¢å¼\n\ndelete /index_one,index_two\ndelete /index_*\n\n\n\n# 2.3. æ¥çç´¢å¼\n\nå¯ä»¥éè¿ get è¯·æ±æ¥çç´¢å¼ä¿¡æ¯\n\n# æ¥çç´¢å¼ç¸å³ä¿¡æ¯\nget kibana_sample_data_ecommerce\n\n# æ¥çç´¢å¼çææ¡£æ»æ°\nget kibana_sample_data_ecommerce/_count\n\n# æ¥çå10æ¡ææ¡£ï¼äºè§£ææ¡£æ ¼å¼\nget kibana_sample_data_ecommerce/_search\n\n# _cat indices api\n# æ¥çindices\nget /_cat/indices/kibana*?v&s=index\n\n# æ¥çç¶æä¸ºç»¿çç´¢å¼\nget /_cat/indices?v&health=green\n\n# æç§ææ¡£ä¸ªæ°æåº\nget /_cat/indices?v&s=docs.count:desc\n\n# æ¥çå·ä½çå­æ®µ\nget /_cat/indices/kibana*?pri&v&h=health,index,pri,rep,docs.count,mt\n\n# æ¥çç´¢å¼å ç¨çåå­\nget /_cat/indices?v&h=i,tm&s=tm:desc\n\n\n\n# 2.4. ç´¢å¼å«å\n\nes çç´¢å¼å«åå°±æ¯ç»ä¸ä¸ªç´¢å¼æèå¤ä¸ªç´¢å¼èµ·çå¦ä¸ä¸ªåå­ï¼å¸åçåºç¨åºæ¯æ¯éå¯¹ç´¢å¼ä½¿ç¨çå¹³æ»åæ¢ã\n\né¦åï¼åå»ºç´¢å¼ my_indexï¼ç¶åå°å«å my_alias æåå®ï¼ç¤ºä¾å¦ä¸ï¼\n\nput /my_index\nput /my_index/_alias/my_alias\n\n\nä¹å¯ä»¥éè¿å¦ä¸å½¢å¼ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "add": { "index": "my_index", "alias": "my_alias" }}\n  ]\n}\n\n\nä¹å¯ä»¥å¨ä¸æ¬¡è¯·æ±ä¸­å¢å å«ååç§»é¤å«åæ··åä½¿ç¨ï¼\n\npost /_aliases\n{\n  "actions": [\n    { "remove": { "index": "my_index", "alias": "my_alias" }}\n    { "add": { "index": "my_index_v2", "alias": "my_alias" }}\n  ]\n}\n\n\n> éè¦æ³¨æçæ¯ï¼å¦æå«åä¸ç´¢å¼æ¯ä¸å¯¹ä¸çï¼ä½¿ç¨å«åç´¢å¼ææ¡£æèæ¥è¯¢ææ¡£æ¯å¯ä»¥çï¼ä½æ¯å¦æå«ååç´¢å¼æ¯ä¸å¯¹å¤çï¼ä½¿ç¨å«åä¼åçéè¯¯ï¼å ä¸º es ä¸ç¥éæææ¡£åå¥åªä¸ªç´¢å¼ä¸­å»æèä»åªä¸ªç´¢å¼ä¸­è¯»åææ¡£ã\n\nes ç´¢å¼å«åæä¸ªå¸åçåºç¨åºæ¯æ¯å¹³æ»åæ¢ï¼æ´å¤ç»èå¯ä»¥æ¥ç elasticsearchï¼esï¼ç´¢å¼é¶åæºï¼æ ééå¯ï¼æ ç¼å¹³æ»åæ¢çæ¹æ³ã\n\n\n# 2.5. æå¼/å³é­ç´¢å¼\n\néè¿å¨ post ä¸­æ·»å  _close æ _open å¯ä»¥æå¼ãå³é­ç´¢å¼ã\n\næå¼ç´¢å¼\n\n# æå¼ç´¢å¼\npost kibana_sample_data_ecommerce/_open\n# å³é­ç´¢å¼\npost kibana_sample_data_ecommerce/_close\n\n\n\n# 3. ææ¡£\n\n############create document############\n#create document. èªå¨çæ _id\npost users/_doc\n{\n\t"user" : "mike",\n    "post_date" : "2019-04-15t14:12:12",\n    "message" : "trying out kibana"\n}\n\n#create document. æå®idãå¦æidå·²ç»å­å¨ï¼æ¥é\nput users/_doc/1?op_type=create\n{\n    "user" : "jack",\n    "post_date" : "2019-05-15t14:12:12",\n    "message" : "trying out elasticsearch"\n}\n\n#create document. æå® id å¦æå·²ç»å­å¨ï¼å°±æ¥é\nput users/_create/1\n{\n     "user" : "jack",\n    "post_date" : "2019-05-15t14:12:12",\n    "message" : "trying out elasticsearch"\n}\n\n### get document by id\n#get the document by id\nget users/_doc/1\n\n\n###  index & update\n#update æå® id  (åå é¤ï¼å¨åå¥)\nget users/_doc/1\n\nput users/_doc/1\n{\n\t"user" : "mike"\n\n}\n\n\n#get users/_doc/1\n#å¨åææ¡£ä¸å¢å å­æ®µ\npost users/_update/1/\n{\n    "doc":{\n        "post_date" : "2019-05-15t14:12:12",\n        "message" : "trying out elasticsearch"\n    }\n}\n\n\n\n### delete by id\n# å é¤ææ¡£\ndelete users/_doc/1\n\n\n### bulk æä½\n#æ§è¡ä¸¤æ¬¡ï¼æ¥çæ¯æ¬¡çç»æ\n\n#æ§è¡ç¬¬1æ¬¡\npost _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n#æ§è¡ç¬¬2æ¬¡\npost _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n### mget æä½\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\n#uriä¸­æå®index\nget /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\n\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n### msearch æä½\npost kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n### æ¸é¤æµè¯æ°æ®\n#æ¸é¤æ°æ®\ndelete users\ndelete test\ndelete test2\n\n\n\n# 3.1. åå»ºææ¡£\n\n# æå® id\n\nè¯­æ³æ ¼å¼ï¼\n\nput /_index/_type/_create/_id\n\n\nç¤ºä¾ï¼\n\nput /user/_doc/_create/1\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "æ°æ®åºç®¡ç"\n}\n\n\n> æ³¨æï¼æå® idï¼å¦æ id å·²ç»å­å¨ï¼åæ¥é\n\n# èªå¨çæ id\n\næ°å¢è®°å½çæ¶åï¼ä¹å¯ä»¥ä¸æå® idï¼è¿æ¶è¦æ¹æ post è¯·æ±ã\n\nè¯­æ³æ ¼å¼ï¼\n\npost /_index/_type\n\n\nç¤ºä¾ï¼\n\npost /user/_doc\n{\n  "user": "å¼ ä¸",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n\n# 3.2. å é¤ææ¡£\n\nè¯­æ³æ ¼å¼ï¼\n\ndelete /_index/_doc/_id\n\n\nç¤ºä¾ï¼\n\ndelete /user/_doc/1\n\n\n\n# 3.3. æ´æ°ææ¡£\n\n# åå é¤ï¼ååå¥\n\nè¯­æ³æ ¼å¼ï¼\n\nput /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nput /user/_doc/1\n{\n  "user": "æå",\n  "title": "å·¥ç¨å¸",\n  "desc": "è¶çº§ç®¡çå"\n}\n\n\n# å¨åææ¡£ä¸å¢å å­æ®µ\n\nè¯­æ³æ ¼å¼ï¼\n\npost /_index/_update/_id\n\n\nç¤ºä¾ï¼\n\npost /user/_update/1\n{\n    "doc":{\n        "age" : "30"\n    }\n}\n\n\n\n# 3.4. æ¥è¯¢ææ¡£\n\n# æå® id æ¥è¯¢\n\nè¯­æ³æ ¼å¼ï¼\n\nget /_index/_type/_id\n\n\nç¤ºä¾ï¼\n\nget /user/_doc/1\n\n\nç»æï¼\n\n{\n  "_index": "user",\n  "_type": "_doc",\n  "_id": "1",\n  "_version": 1,\n  "_seq_no": 536248,\n  "_primary_term": 2,\n  "found": true,\n  "_source": {\n    "user": "å¼ ä¸",\n    "title": "å·¥ç¨å¸",\n    "desc": "æ°æ®åºç®¡ç"\n  }\n}\n\n\nè¿åçæ°æ®ä¸­ï¼found å­æ®µè¡¨ç¤ºæ¥è¯¢æåï¼_source å­æ®µè¿ååå§è®°å½ã\n\nå¦æ id ä¸æ­£ç¡®ï¼å°±æ¥ä¸å°æ°æ®ï¼found å­æ®µå°±æ¯ false\n\n# æ¥è¯¢ææè®°å½\n\nä½¿ç¨ get æ¹æ³ï¼ç´æ¥è¯·æ± /index/type/_searchï¼å°±ä¼è¿åææè®°å½ã\n\n$ curl \'localhost:9200/user/admin/_search?pretty\'\n{\n  "took" : 1,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 1.0,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "wwuodg8bhwecs7siyn93",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 1.0,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nä¸é¢ä»£ç ä¸­ï¼è¿åç»æç tookå­æ®µè¡¨ç¤ºè¯¥æä½çèæ¶ï¼åä½ä¸ºæ¯«ç§ï¼ï¼timed_outå­æ®µè¡¨ç¤ºæ¯å¦è¶æ¶ï¼hitså­æ®µè¡¨ç¤ºå½ä¸­çè®°å½ï¼éé¢å­å­æ®µçå«ä¹å¦ä¸ã\n\n * totalï¼è¿åè®°å½æ°ï¼æ¬ä¾æ¯ 2 æ¡ã\n * max_scoreï¼æé«çå¹éç¨åº¦ï¼æ¬ä¾æ¯1.0ã\n * hitsï¼è¿åçè®°å½ç»æçæ°ç»ã\n\nè¿åçè®°å½ä¸­ï¼æ¯æ¡è®°å½é½æä¸ä¸ª_scoreå­æ®µï¼è¡¨ç¤ºå¹éçç¨åºï¼é»è®¤æ¯æç§è¿ä¸ªå­æ®µéåºæåã\n\n\n# 3.5. å¨ææç´¢\n\nes çæ¥è¯¢éå¸¸ç¹å«ï¼ä½¿ç¨èªå·±çæ¥è¯¢è¯­æ³ï¼è¦æ± get è¯·æ±å¸¦ææ°æ®ä½ã\n\n$ curl -h \'content-type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n"query" : { "match" : { "desc" : "ç®¡ç" }}\n}\'\n\n\nä¸é¢ä»£ç ä½¿ç¨ match æ¥è¯¢ï¼æå®çå¹éæ¡ä»¶æ¯descå­æ®µéé¢åå«"è½¯ä»¶"è¿ä¸ªè¯ãè¿åç»æå¦ä¸ã\n\n{\n  "took" : 2,\n  "timed_out" : false,\n  "_shards" : {\n    "total" : 3,\n    "successful" : 3,\n    "skipped" : 0,\n    "failed" : 0\n  },\n  "hits" : {\n    "total" : 2,\n    "max_score" : 0.38200712,\n    "hits" : [\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "wwuodg8bhwecs7siyn93",\n        "_score" : 0.38200712,\n        "_source" : {\n          "user" : "æå",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "ç³»ç»ç®¡ç"\n        }\n      },\n      {\n        "_index" : "user",\n        "_type" : "admin",\n        "_id" : "1",\n        "_score" : 0.3487891,\n        "_source" : {\n          "user" : "å¼ ä¸",\n          "title" : "å·¥ç¨å¸",\n          "desc" : "è¶çº§ç®¡çå"\n        }\n      }\n    ]\n  }\n}\n\n\nelastic é»è®¤ä¸æ¬¡è¿å 10 æ¡ç»æï¼å¯ä»¥éè¿sizeå­æ®µæ¹åè¿ä¸ªè®¾ç½®ï¼è¿å¯ä»¥éè¿fromå­æ®µï¼æå®ä½ç§»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n  "query" : { "match" : { "desc" : "ç®¡ç" }},\n  "from": 1,\n  "size": 1\n}\'\n\n\nä¸é¢ä»£ç æå®ï¼ä»ä½ç½® 1 å¼å§ï¼é»è®¤æ¯ä»ä½ç½® 0 å¼å§ï¼ï¼åªè¿åä¸æ¡ç»æã\n\n\n# 3.6. é»è¾è¿ç®\n\nå¦ææå¤ä¸ªæç´¢å³é®å­ï¼ elastic è®¤ä¸ºå®ä»¬æ¯orå³ç³»ã\n\n$ curl \'localhost:9200/user/admin/_search\'  -d \'\n{\n"query" : { "match" : { "desc" : "è½¯ä»¶ ç³»ç»" }}\n}\'\n\n\nä¸é¢ä»£ç æç´¢çæ¯è½¯ä»¶ or ç³»ç»ã\n\nå¦æè¦æ§è¡å¤ä¸ªå³é®è¯çandæç´¢ï¼å¿é¡»ä½¿ç¨å¸å°æ¥è¯¢ã\n\n$ curl -h \'content-type: application/json\' \'localhost:9200/user/admin/_search?pretty\'  -d \'\n{\n "query": {\n  "bool": {\n   "must": [\n    { "match": { "desc": "ç®¡ç" } },\n    { "match": { "desc": "è¶çº§" } }\n   ]\n  }\n }\n}\'\n\n\n\n# 3.7. æ¹éæ§è¡\n\næ¯æå¨ä¸æ¬¡ api è°ç¨ä¸­ï¼å¯¹ä¸åçç´¢å¼è¿è¡æä½\n\næ¯æåç§ç±»åæä½\n\n * index\n * create\n * update\n * delete\n\næä½ä¸­åæ¡æä½å¤±è´¥ï¼å¹¶ä¸ä¼å½±åå¶ä»æä½ã\n\nè¿åç»æåæ¬äºæ¯ä¸æ¡æä½æ§è¡çç»æã\n\npost _bulk\n{ "index" : { "_index" : "test", "_id" : "1" } }\n{ "field1" : "value1" }\n{ "delete" : { "_index" : "test", "_id" : "2" } }\n{ "create" : { "_index" : "test2", "_id" : "3" } }\n{ "field1" : "value3" }\n{ "update" : {"_id" : "1", "_index" : "test"} }\n{ "doc" : {"field2" : "value2"} }\n\n\n> è¯´æï¼ä¸é¢çç¤ºä¾å¦ææ§è¡å¤æ¬¡ï¼æ§è¡ç»æé½ä¸ä¸æ ·ã\n\n\n# 3.8. æ¹éè¯»å\n\nè¯»å¤ä¸ªç´¢å¼\n\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1"\n        },\n        {\n            "_index" : "test",\n            "_id" : "2"\n        }\n    ]\n}\n\n\nè¯»ä¸ä¸ªç´¢å¼\n\nget /test/_mget\n{\n    "docs" : [\n        {\n\n            "_id" : "1"\n        },\n        {\n\n            "_id" : "2"\n        }\n    ]\n}\n\nget /_mget\n{\n    "docs" : [\n        {\n            "_index" : "test",\n            "_id" : "1",\n            "_source" : false\n        },\n        {\n            "_index" : "test",\n            "_id" : "2",\n            "_source" : ["field3", "field4"]\n        },\n        {\n            "_index" : "test",\n            "_id" : "3",\n            "_source" : {\n                "include": ["user"],\n                "exclude": ["user.location"]\n            }\n        }\n    ]\n}\n\n\n\n# 3.9. æ¹éæ¥è¯¢\n\npost kibana_sample_data_ecommerce/_msearch\n{}\n{"query" : {"match_all" : {}},"size":1}\n{"index" : "kibana_sample_data_flights"}\n{"query" : {"match_all" : {}},"size":2}\n\n\n\n# 3.10. uri search æ¥è¯¢è¯­ä¹\n\nelasticsearch uri search éµå¾ª querystring æ¥è¯¢è¯­ä¹ï¼å¶å½¢å¼å¦ä¸ï¼\n\nget /movies/_search?q=2012&df=title&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile": true\n}\n\n\n * q æå®æ¥è¯¢è¯­å¥ï¼ä½¿ç¨ querystring è¯­ä¹\n * df é»è®¤å­æ®µï¼ä¸æå®æ¶\n * sort æåºï¼from å size ç¨äºåé¡µ\n * profile å¯ä»¥æ¥çæ¥è¯¢æ¶å¦ä½è¢«æ§è¡ç\n\nget /movies/_search?q=title:2012&sort=year:desc&from=0&size=10&timeout=1s\n{\n\t"profile":"true"\n}\n\n\n# term å phrase\n\nbeautiful mind ç­æäº beautiful or mind\n\n"beautiful mind" ç­æäº beautiful and mind\n\n# term æ¥è¯¢\nget /movies/_search?q=title:beautiful mind\n{\n\t"profile":"true"\n}\n\n# ä½¿ç¨å¼å·ï¼phrase æ¥è¯¢\nget /movies/_search?q=title:"beautiful mind"\n{\n\t"profile":"true"\n}\n\n\n# åç»ä¸å¼å·\n\ntitle:(beautiful and mind)\n\ntitle="beautiful mind"\n\n# andãorãnot æè &&ã||ã!\n\n> æ³¨æï¼andãorãnot å¿é¡»å¤§å\n\n# å¸å°æä½ç¬¦\nget /movies/_search?q=title:(beautiful and mind)\n{\n\t"profile":"true"\n}\n\nget /movies/_search?q=title:(beautiful not mind)\n{\n\t"profile":"true"\n}\n\n\n# èå´æ¥è¯¢\n\n * [] è¡¨ç¤ºé­åºé´\n * {} è¡¨ç¤ºå¼åºé´\n\nç¤ºä¾ï¼\n\n# èå´æ¥è¯¢ ,åºé´åæ³\nget /movies/_search?q=title:beautiful and year:{2010 to 2018%7d\n{\n\t"profile":"true"\n}\n\nget /movies/_search?q=title:beautiful and year:[* to 2018]\n{\n\t"profile":"true"\n}\n\n\n# ç®æ°ç¬¦å·\n\n# 2010 å¹´ä»¥åçè®°å½\nget /movies/_search?q=year:>2010\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nget /movies/_search?q=year:(>2010 && <=2018)\n{\n\t"profile":"true"\n}\n\n# 2010 å¹´å° 2018 å¹´çè®°å½\nget /movies/_search?q=year:(+>2010 +<=2018)\n{\n\t"profile":"true"\n}\n\n\n# ééç¬¦æ¥è¯¢\n\n * ? ä»£è¡¨ 1 ä¸ªå­ç¬¦\n * * ä»£è¡¨ 0 æå¤ä¸ªå­ç¬¦\n\nç¤ºä¾ï¼\n\nget /movies/_search?q=title:mi?d\n{\n\t"profile":"true"\n}\n\nget /movies/_search?q=title:b*\n{\n\t"profile":"true"\n}\n\n\n# æ­£åè¡¨è¾¾å¼\n\ntitle:[bt]oy\n\n# æ¨¡ç³å¹éä¸è¿ä¼¼æ¥è¯¢\n\nç¤ºä¾ï¼\n\n# ç¸ä¼¼åº¦å¨ 1 ä¸ªå­ç¬¦ä»¥å\nget /movies/_search?q=title:beautifl~1\n{\n\t"profile":"true"\n}\n\n# ç¸ä¼¼åº¦å¨ 2 ä¸ªå­ç¬¦ä»¥å\nget /movies/_search?q=title:"lord rings"~2\n{\n\t"profile":"true"\n}\n\n\n\n# 3.11. request body & dsl\n\nelasticsearch é¤äº uri search æ¥è¯¢æ¹å¼ï¼è¿æ¯æå°æ¥è¯¢è¯­å¥éè¿ http request body åèµ·æ¥è¯¢ã\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n\t"profile":"true",\n\t"query": {\n\t  "match_all": {}\n\t}\n}\n\n\n# åé¡µ\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "from": 0,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# æåº\n\næå¥½å¨æ°å­åææ¥æåå­æ®µä¸æåº\n\nå ä¸ºå¯¹äºå¤å¼ç±»åæåæè¿çå­æ®µæåºï¼ç³»ç»ä¼éä¸ä¸ªå¼ï¼æ æ³å¾ç¥è¯¥å¼\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "sort": [\n    {\n      "order_date": "desc"\n    }\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# _source è¿æ»¤\n\nå¦æ _source æ²¡æå­å¨ï¼é£å°±åªè¿åå¹éçææ¡£çåæ°æ®\n\n_source æ¯æä½¿ç¨ééç¬¦ï¼å¦ï¼_source["name*", "desc*"]\n\nç¤ºä¾ï¼\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "_source": [\n    "order_date",\n    "category.keyword"\n  ],\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n# èæ¬å­æ®µ\n\nget /kibana_sample_data_ecommerce/_search?ignore_unavailable=true\n{\n  "profile": "true",\n  "script_fields": {\n    "new_field": {\n      "script": {\n        "lang": "painless",\n        "source":"doc[\'order_date\'].value+\' hello\'"\n      }\n    }\n  },\n  "from": 1,\n  "size": 10,\n  "query": {\n    "match_all": {}\n  }\n}\n\n\n\n# ä½¿ç¨æ¥è¯¢è¡¨è¾¾å¼ - match\n\npost movies/_search\n{\n  "query": {\n    "match": {\n      "title": "last christmas"\n    }\n  }\n}\n\npost movies/_search\n{\n  "query": {\n    "match": {\n      "title": {\n        "query": "last christmas",\n        "operator": "and"\n      }\n    }\n  }\n}\n\n\n\n# ç­è¯­æç´¢ - match phrase\n\npost movies/_search\n{\n  "query": {\n    "match_phrase": {\n      "title":{\n        "query": "last christmas"\n\n      }\n    }\n  }\n}\n\n\n\n# 4. éç¾¤ api\n\n> elasticsearch å®æ¹ä¹ cluster api\n\nä¸äºéç¾¤çº§å«ç api å¯è½ä¼å¨èç¹çå­éä¸è¿è¡ï¼è¿äºèç¹å¯ä»¥ç¨èç¹è¿æ»¤å¨æå®ãä¾å¦ï¼ä»»å¡ç®¡çãèç¹ç»è®¡åèç¹ä¿¡æ¯ api é½å¯ä»¥æ¥åæ¥èªä¸ç»è¿æ»¤èç¹èä¸æ¯ææèç¹çç»æã\n\nèç¹è¿æ»¤å¨ä»¥éå·åéçåä¸ªè¿æ»¤å¨åè¡¨çå½¢å¼ç¼åï¼æ¯ä¸ªè¿æ»¤å¨ä»æéå­éä¸­æ·»å æå é¤èç¹ãæ¯ä¸ªè¿æ»¤å¨å¯ä»¥æ¯ä»¥ä¸ä¹ä¸ï¼\n\n * _allï¼å°ææèç¹æ·»å å°å­é\n * _localï¼å°æ¬å°èç¹æ·»å å°å­é\n * _masterï¼å°å½åä¸»èç¹æ·»å å°å­é\n * æ ¹æ®èç¹ id æèç¹åå°å¹éèç¹æ·»å å°å­é\n * æ ¹æ® ip å°åæä¸»æºåå°å¹éèç¹æ·»å å°å­é\n * ä½¿ç¨ééç¬¦ï¼å°èç¹åãå°ååæä¸»æºåå¹éçèç¹æ·»å å°å­é\n * master:true, data:true, ingest:true, voting_only:true, ml:true æ coordinating_only:true, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æ·»å å°å­éä¸­ã\n * master:false, data:false, ingest:false, voting_only:true, ml:false æ coordinating_only:false, åå«æå³çå°ææä¸»èç¹ãæææ°æ®èç¹ãæææåèç¹ãææä»æç¥¨èç¹ãæææºå¨å­¦ä¹ èç¹åææåè°èç¹æé¤å¨å­éå¤ã\n * éå¯¹æ¨¡å¼ï¼ä½¿ç¨ * ééç¬¦ï¼æ ¼å¼ä¸º attrname:attrvalueï¼å°ææå·æèªå®ä¹èç¹å±æ§çèç¹æ·»å å°å­éä¸­ï¼å¶åç§°åå¼ä¸ç¸åºçæ¨¡å¼å¹éãèªå®ä¹èç¹å±æ§æ¯éè¿ node.attr.attrname: attrvalue å½¢å¼å¨éç½®æä»¶ä¸­è®¾ç½®çã\n\n# å¦ææ²¡æç»åºè¿æ»¤å¨ï¼é»è®¤æ¯æ¥è¯¢ææèç¹\nget /_nodes\n# æ¥è¯¢ææèç¹\nget /_nodes/_all\n# æ¥è¯¢æ¬å°èç¹\nget /_nodes/_local\n# æ¥è¯¢ä¸»èç¹\nget /_nodes/_master\n# æ ¹æ®åç§°æ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nget /_nodes/node_name_goes_here\nget /_nodes/node_name_goes_*\n# æ ¹æ®å°åæ¥è¯¢èç¹ï¼æ¯æééç¬¦ï¼\nget /_nodes/10.0.0.3,10.0.0.4\nget /_nodes/10.0.0.*\n# æ ¹æ®è§åæ¥è¯¢èç¹\nget /_nodes/_all,master:false\nget /_nodes/data:true,ingest:true\nget /_nodes/coordinating_only:true\nget /_nodes/master:true,voting_only:false\n# æ ¹æ®èªå®ä¹å±æ§æ¥è¯¢èç¹ï¼å¦ï¼æ¥è¯¢éç½®æä»¶ä¸­å« node.attr.rack:2 å±æ§çèç¹ï¼\nget /_nodes/rack:2\nget /_nodes/ra*:2\nget /_nodes/ra*:2*\n\n\n\n# 4.1. éç¾¤å¥åº· api\n\nget /_cluster/health\nget /_cluster/health?level=shards\nget /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights\nget /_cluster/health/kibana_sample_data_flights?level=shards\n\n\n\n# 4.2. éç¾¤ç¶æ api\n\néç¾¤ç¶æ api è¿åè¡¨ç¤ºæ´ä¸ªéç¾¤ç¶æçåæ°æ®ã\n\nget /_cluster/state\n\n\n\n# 5. èç¹ api\n\n> elasticsearch å®æ¹ä¹ cat nodes apiââè¿åæå³éç¾¤èç¹çä¿¡æ¯ã\n\n# æ¥çé»è®¤çå­æ®µ\nget /_cat/nodes?v=true\n# æ¥çæå®çå­æ®µ\nget /_cat/nodes?v=true&h=id,ip,port,v,m\n\n\n\n# 6. åç api\n\n> elasticsearch å®æ¹ä¹ cat shards apiââshards å½ä»¤æ¯åªäºèç¹åå«åªäºåççè¯¦ç»è§å¾ãå®ä¼åè¯ä½ å®æ¯ä¸»è¿æ¯å¯æ¬ãææ¡£æ°éãå®å¨ç£çä¸å ç¨çå­èæ°ä»¥åå®æå¨çèç¹ã\n\n# æ¥çé»è®¤çå­æ®µ\nget /_cat/shards\n# æ ¹æ®åç§°æ¥è¯¢åçï¼æ¯æééç¬¦ï¼\nget /_cat/shards/my-index-*\n# æ¥çæå®çå­æ®µ\nget /_cat/shards?h=index,shard,prirep,state,unassigned.reason\n\n\n\n# 7. çæ§ api\n\nelasticsearch ä¸­éç¾¤ç¸å³çå¥åº·ãç»è®¡ç­ç¸å³çä¿¡æ¯é½æ¯å´ç»ç cat api è¿è¡çã\n\néè¿ get è¯·æ±åé catï¼ä¸é¢ååºäºææå¯ç¨ç apiï¼\n\nget /_cat\n\n=^.^=\n/_cat/allocation\n/_cat/shards\n/_cat/shards/{index}\n/_cat/master\n/_cat/nodes\n/_cat/tasks\n/_cat/indices\n/_cat/indices/{index}\n/_cat/segments\n/_cat/segments/{index}\n/_cat/count\n/_cat/count/{index}\n/_cat/recovery\n/_cat/recovery/{index}\n/_cat/health\n/_cat/pending_tasks\n/_cat/aliases\n/_cat/aliases/{alias}\n/_cat/thread_pool\n/_cat/thread_pool/{thread_pools}\n/_cat/plugins\n/_cat/fielddata\n/_cat/fielddata/{fields}\n/_cat/nodeattrs\n/_cat/repositories\n/_cat/snapshots/{repository}\n/_cat/templates\n\n\n\n# 8. åèèµæ\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"ElasticSearch Java API ä¹ High Level REST Client",frontmatter:{title:"ElasticSearch Java API ä¹ High Level REST Client",date:"2022-03-01T18:55:46.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","API"],permalink:"/pages/baf137/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.md",key:"v-cd275a36",path:"/pages/baf137/",headers:[{level:2,title:"1. å¿«éå¼å§",slug:"_1-å¿«éå¼å§",normalizedTitle:"1. å¿«éå¼å§",charIndex:131},{level:3,title:"1.1. å¼å¥ä¾èµ",slug:"_1-1-å¼å¥ä¾èµ",normalizedTitle:"1.1. å¼å¥ä¾èµ",charIndex:143},{level:3,title:"1.2. åå»ºè¿æ¥åå³é­",slug:"_1-2-åå»ºè¿æ¥åå³é­",normalizedTitle:"1.2. åå»ºè¿æ¥åå³é­",charIndex:350},{level:2,title:"2. ç´¢å¼ API",slug:"_2-ç´¢å¼-api",normalizedTitle:"2. ç´¢å¼ api",charIndex:598},{level:3,title:"2.1. æµè¯åå¤",slug:"_2-1-æµè¯åå¤",normalizedTitle:"2.1. æµè¯åå¤",charIndex:612},{level:3,title:"2.2. åå»ºç´¢å¼",slug:"_2-2-åå»ºç´¢å¼",normalizedTitle:"2.2. åå»ºç´¢å¼",charIndex:1336},{level:3,title:"2.3. å é¤ç´¢å¼",slug:"_2-3-å é¤ç´¢å¼",normalizedTitle:"2.3. å é¤ç´¢å¼",charIndex:1901},{level:3,title:"2.4. å¤æ­ç´¢å¼æ¯å¦å­å¨",slug:"_2-4-å¤æ­ç´¢å¼æ¯å¦å­å¨",normalizedTitle:"2.4. å¤æ­ç´¢å¼æ¯å¦å­å¨",charIndex:2163},{level:2,title:"3. ææ¡£ API",slug:"_3-ææ¡£-api",normalizedTitle:"3. ææ¡£ api",charIndex:2507},{level:3,title:"3.1. ææ¡£æµè¯åå¤",slug:"_3-1-ææ¡£æµè¯åå¤",normalizedTitle:"3.1. ææ¡£æµè¯åå¤",charIndex:2521},{level:3,title:"3.2. åå»ºææ¡£",slug:"_3-2-åå»ºææ¡£",normalizedTitle:"3.2. åå»ºææ¡£",charIndex:4458},{level:3,title:"3.3. å é¤ææ¡£",slug:"_3-3-å é¤ææ¡£",normalizedTitle:"3.3. å é¤ææ¡£",charIndex:5228},{level:3,title:"3.4. æ´æ°ææ¡£",slug:"_3-4-æ´æ°ææ¡£",normalizedTitle:"3.4. æ´æ°ææ¡£",charIndex:5819},{level:3,title:"3.5. æ¥çææ¡£",slug:"_3-5-æ¥çææ¡£",normalizedTitle:"3.5. æ¥çææ¡£",charIndex:6650},{level:3,title:"3.6. è·åå¹éæ¡ä»¶çè®°å½æ»æ°",slug:"_3-6-è·åå¹éæ¡ä»¶çè®°å½æ»æ°",normalizedTitle:"3.6. è·åå¹éæ¡ä»¶çè®°å½æ»æ°",charIndex:7159},{level:3,title:"3.7. åé¡µæ¥è¯¢",slug:"_3-7-åé¡µæ¥è¯¢",normalizedTitle:"3.7. åé¡µæ¥è¯¢",charIndex:7720},{level:3,title:"3.8. æ¡ä»¶æ¥è¯¢",slug:"_3-8-æ¡ä»¶æ¥è¯¢",normalizedTitle:"3.8. æ¡ä»¶æ¥è¯¢",charIndex:8676},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:9588}],headersStr:"1. å¿«éå¼å§ 1.1. å¼å¥ä¾èµ 1.2. åå»ºè¿æ¥åå³é­ 2. ç´¢å¼ API 2.1. æµè¯åå¤ 2.2. åå»ºç´¢å¼ 2.3. å é¤ç´¢å¼ 2.4. å¤æ­ç´¢å¼æ¯å¦å­å¨ 3. ææ¡£ API 3.1. ææ¡£æµè¯åå¤ 3.2. åå»ºææ¡£ 3.3. å é¤ææ¡£ 3.4. æ´æ°ææ¡£ 3.5. æ¥çææ¡£ 3.6. è·åå¹éæ¡ä»¶çè®°å½æ»æ° 3.7. åé¡µæ¥è¯¢ 3.8. æ¡ä»¶æ¥è¯¢ 4. åèèµæ",content:'# ElasticSearch Java API ä¹ High Level REST Client\n\n> Elasticsearch å®æ¹ç High Level REST Client å¨ 7.1.5.0 çæ¬åºå¼ãæä»¥æ¬æä¸­ç API ä¸æ¨èä½¿ç¨ã\n\n\n# 1. å¿«éå¼å§\n\n\n# 1.1. å¼å¥ä¾èµ\n\nå¨ pom.xml ä¸­å¼å¥ä»¥ä¸ä¾èµï¼\n\n<dependency>\n    <groupId>org.elasticsearch.client</groupId>\n    <artifactId>elasticsearch-rest-high-level-client</artifactId>\n    <version>7.17.1</version>\n</dependency>\n\n\n\n# 1.2. åå»ºè¿æ¥åå³é­\n\n// åå»ºè¿æ¥\nRestHighLevelClient client = new RestHighLevelClient(\n        RestClient.builder(\n                new HttpHost("localhost", 9200, "http"),\n                new HttpHost("localhost", 9201, "http")));\n\n// å³é­\nclient.close();\n\n\n\n# 2. ç´¢å¼ API\n\n\n# 2.1. æµè¯åå¤\n\npublic static final String INDEX = "mytest";\npublic static final String INDEX_ALIAS = "mytest_alias";\n/**\n * {@link User} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final String MAPPING_JSON =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@Autowired\nprivate RestHighLevelClient client;\n\n\n\n# 2.2. åå»ºç´¢å¼\n\n// åå»ºç´¢å¼\nCreateIndexRequest createIndexRequest = new CreateIndexRequest(INDEX);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createIndexRequest.settings(\n  Settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createIndexRequest.mapping(MAPPING_JSON, XContentType.JSON);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createIndexRequest.alias(new Alias(INDEX_ALIAS));\n\n  AcknowledgedResponse createIndexResponse = client.indices().create(createIndexRequest, RequestOptions.DEFAULT);\n  Assertions.assertTrue(createIndexResponse.isAcknowledged());\n\n\n\n# 2.3. å é¤ç´¢å¼\n\n// å é¤ç´¢å¼\nDeleteIndexRequest deleteIndexRequest = new DeleteIndexRequest(INDEX);\n  AcknowledgedResponse deleteResponse = client.indices().delete(deleteIndexRequest, RequestOptions.DEFAULT);\n  Assertions.assertTrue(deleteResponse.isAcknowledged());\n\n\n\n# 2.4. å¤æ­ç´¢å¼æ¯å¦å­å¨\n\nGetIndexRequest getIndexRequest = new GetIndexRequest(INDEX);\n  Assertions.assertTrue(client.indices().exists(getIndexRequest, RequestOptions.DEFAULT));\n  GetIndexRequest getIndexAliasRequest = new GetIndexRequest(INDEX_ALIAS);\n  Assertions.assertTrue(client.indices().exists(getIndexAliasRequest, RequestOptions.DEFAULT));\n\n\n\n# 3. ææ¡£ API\n\n\n# 3.1. ææ¡£æµè¯åå¤\n\npublic static final String INDEX = "mytest";\npublic static final String INDEX_ALIAS = "mytest_alias";\n/**\n * {@link User} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final String MAPPING_JSON =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@Autowired\nprivate RestHighLevelClient client;\n\n@BeforeEach\npublic void init() throws IOException {\n\n  // åå»ºç´¢å¼\n  CreateIndexRequest createIndexRequest = new CreateIndexRequest(INDEX);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createIndexRequest.settings(\n  Settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createIndexRequest.mapping(MAPPING_JSON, XContentType.JSON);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createIndexRequest.alias(new Alias(INDEX_ALIAS));\n\n  AcknowledgedResponse response = client.indices().create(createIndexRequest, RequestOptions.DEFAULT);\n  Assertions.assertTrue(response.isAcknowledged());\n\n  // å¤æ­ç´¢å¼æ¯å¦å­å¨\n  GetIndexRequest getIndexRequest = new GetIndexRequest(INDEX_ALIAS);\n  Assertions.assertTrue(client.indices().exists(getIndexRequest, RequestOptions.DEFAULT));\n  GetIndexRequest getIndexAliasRequest = new GetIndexRequest(INDEX_ALIAS);\n  Assertions.assertTrue(client.indices().exists(getIndexAliasRequest, RequestOptions.DEFAULT));\n  }\n\n@AfterEach\npublic void destroy() throws IOException {\n  // å é¤ç´¢å¼\n  DeleteIndexRequest request = new DeleteIndexRequest(INDEX);\n  AcknowledgedResponse response = client.indices().delete(request, RequestOptions.DEFAULT);\n  Assertions.assertTrue(response.isAcknowledged());\n  }\n\n\n\n# 3.2. åå»ºææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ IndexRequest æ¥æå»ºåå»ºææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãåå»º id ä¸º 1 çææ¡£\n\nIndexRequest request = new IndexRequest("product");\n  request.id("1");\n  Product product = new Product();\n  product.setName("æºå¨äºº");\n  product.setDescription("äººå·¥æºè½æºå¨äºº");\n  product.setEnabled(true);\n  String jsonString = JSONUtil.toJsonStr(product);\n  request.source(jsonString, XContentType.JSON);\n\n\nåæ­¥æ§è¡\n\nIndexResponse indexResponse = client.index(request, RequestOptions.DEFAULT);\n\n\nå¼æ­¥æ§è¡\n\n// å¼æ­¥æ§è¡\nclient.indexAsync(request, RequestOptions.DEFAULT, new ActionListener<IndexResponse>() {\n@Override\npublic void onResponse(IndexResponse indexResponse) {\n  System.out.println(indexResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# 3.3. å é¤ææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ DeleteRequest æ¥æå»ºå é¤ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãå é¤ id ä¸º 1 çææ¡£\n\nDeleteRequest deleteRequest = new DeleteRequest(INDEX_ALIAS, "1");\n\n\nåæ­¥æ§è¡\n\nDeleteResponse deleteResponse = client.delete(deleteRequest, RequestOptions.DEFAULT);\n  System.out.println(deleteResponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.deleteAsync(deleteRequest, RequestOptions.DEFAULT, new ActionListener<DeleteResponse>() {\n@Override\npublic void onResponse(DeleteResponse deleteResponse) {\n  System.out.println(deleteResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# 3.4. æ´æ°ææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ UpdateRequest æ¥æå»ºæ´æ°ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ´æ° id ä¸º 1 çææ¡£\n\nUpdateRequest updateRequest = new UpdateRequest(INDEX_ALIAS, "1");\n  Product product3 = new Product();\n  product3.setName("æ«å°æºå¨äºº");\n  product3.setDescription("äººå·¥æºè½æ«å°æºå¨äºº");\n  product3.setEnabled(true);\n  String jsonString2 = JSONUtil.toJsonStr(product3);\n  updateRequest.doc(jsonString2, XContentType.JSON);\n\n\nåæ­¥æ§è¡\n\nUpdateResponse updateResponse = client.update(updateRequest, RequestOptions.DEFAULT);\n  System.out.println(updateResponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.updateAsync(updateRequest, RequestOptions.DEFAULT, new ActionListener<UpdateResponse>() {\n@Override\npublic void onResponse(UpdateResponse updateResponse) {\n  System.out.println(updateResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# 3.5. æ¥çææ¡£\n\nRestHighLevelClient Api ä½¿ç¨ GetRequest æ¥æå»ºæ¥çææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ¥ç id ä¸º 1 çææ¡£\n\nGetRequest getRequest = new GetRequest(INDEX_ALIAS, "1");\n\n\nåæ­¥æ§è¡\n\nGetResponse getResponse = client.get(getRequest, RequestOptions.DEFAULT);\n\n\nå¼æ­¥æ§è¡\n\nclient.getAsync(getRequest, RequestOptions.DEFAULT, new ActionListener<GetResponse>() {\n@Override\npublic void onResponse(GetResponse getResponse) {\n  System.out.println(getResponse);\n  }\n\n@Override\npublic void onFailure(Exception e) {\n  System.out.println("æ§è¡å¤±è´¥");\n  }\n});\n\n\n\n# 3.6. è·åå¹éæ¡ä»¶çè®°å½æ»æ°\n\n@Test\n@DisplayName("è·åå¹éæ¡ä»¶çè®°å½æ»æ°")\npublic void count() throws IOException {\n    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();\n    sourceBuilder.query(QueryBuilders.matchPhraseQuery("customer_gender", "MALE"));\n    sourceBuilder.trackTotalHits(true);\n\n    CountRequest countRequest = new CountRequest(INDEX);\n    countRequest.source(sourceBuilder);\n\n    CountResponse countResponse = client.count(countRequest, RequestOptions.DEFAULT);\n    long count = countResponse.getCount();\n    System.out.println("å½ä¸­è®°å½æ°ï¼" + count);\n}\n\n\n\n# 3.7. åé¡µæ¥è¯¢\n\n@ParameterizedTest\n@ValueSource(ints = {0, 1, 2, 3})\n@DisplayName("åé¡µæ¥è¯¢æµè¯")\npublic void pageTest(int page) throws IOException {\n\n    int size = 10;\n    int offset = page * size;\n    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();\n    sourceBuilder.query(QueryBuilders.matchPhraseQuery("customer_gender", "MALE"));\n    sourceBuilder.from(offset);\n    sourceBuilder.size(size);\n    sourceBuilder.trackTotalHits(true);\n\n    SearchRequest searchRequest = new SearchRequest(INDEX);\n    searchRequest.source(sourceBuilder);\n    SearchResponse response = client.search(searchRequest, RequestOptions.DEFAULT);\n    SearchHit[] hits = response.getHits().getHits();\n    for (SearchHit hit : hits) {\n        KibanaSampleDataEcommerceBean bean =\n            BeanUtil.mapToBean(hit.getSourceAsMap(), KibanaSampleDataEcommerceBean.class, true,\n                               CopyOptions.create());\n        System.out.println(bean);\n    }\n}\n\n\n\n# 3.8. æ¡ä»¶æ¥è¯¢\n\n@Test\n@DisplayName("æ¡ä»¶æ¥è¯¢")\npublic void matchPhraseQuery() throws IOException {\n    SearchRequest searchRequest = new SearchRequest(INDEX);\n    SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();\n\n    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();\n    boolQueryBuilder.must(QueryBuilders.matchPhraseQuery("customer_last_name", "Jensen"));\n    sourceBuilder.query(boolQueryBuilder);\n    sourceBuilder.trackTotalHits(true);\n    searchRequest.source(sourceBuilder);\n    SearchResponse response = client.search(searchRequest, RequestOptions.DEFAULT);\n    SearchHit[] hits = response.getHits().getHits();\n    for (SearchHit hit : hits) {\n        KibanaSampleDataEcommerceBean bean =\n            BeanUtil.mapToBean(hit.getSourceAsMap(), KibanaSampleDataEcommerceBean.class, true,\n                               CopyOptions.create());\n        System.out.println(bean);\n    }\n}\n\n\n\n# 4. åèèµæ\n\n * å®æ¹\n   * Java High Level REST Client',normalizedContent:'# elasticsearch java api ä¹ high level rest client\n\n> elasticsearch å®æ¹ç high level rest client å¨ 7.1.5.0 çæ¬åºå¼ãæä»¥æ¬æä¸­ç api ä¸æ¨èä½¿ç¨ã\n\n\n# 1. å¿«éå¼å§\n\n\n# 1.1. å¼å¥ä¾èµ\n\nå¨ pom.xml ä¸­å¼å¥ä»¥ä¸ä¾èµï¼\n\n<dependency>\n    <groupid>org.elasticsearch.client</groupid>\n    <artifactid>elasticsearch-rest-high-level-client</artifactid>\n    <version>7.17.1</version>\n</dependency>\n\n\n\n# 1.2. åå»ºè¿æ¥åå³é­\n\n// åå»ºè¿æ¥\nresthighlevelclient client = new resthighlevelclient(\n        restclient.builder(\n                new httphost("localhost", 9200, "http"),\n                new httphost("localhost", 9201, "http")));\n\n// å³é­\nclient.close();\n\n\n\n# 2. ç´¢å¼ api\n\n\n# 2.1. æµè¯åå¤\n\npublic static final string index = "mytest";\npublic static final string index_alias = "mytest_alias";\n/**\n * {@link user} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final string mapping_json =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@autowired\nprivate resthighlevelclient client;\n\n\n\n# 2.2. åå»ºç´¢å¼\n\n// åå»ºç´¢å¼\ncreateindexrequest createindexrequest = new createindexrequest(index);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createindexrequest.settings(\n  settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createindexrequest.mapping(mapping_json, xcontenttype.json);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createindexrequest.alias(new alias(index_alias));\n\n  acknowledgedresponse createindexresponse = client.indices().create(createindexrequest, requestoptions.default);\n  assertions.asserttrue(createindexresponse.isacknowledged());\n\n\n\n# 2.3. å é¤ç´¢å¼\n\n// å é¤ç´¢å¼\ndeleteindexrequest deleteindexrequest = new deleteindexrequest(index);\n  acknowledgedresponse deleteresponse = client.indices().delete(deleteindexrequest, requestoptions.default);\n  assertions.asserttrue(deleteresponse.isacknowledged());\n\n\n\n# 2.4. å¤æ­ç´¢å¼æ¯å¦å­å¨\n\ngetindexrequest getindexrequest = new getindexrequest(index);\n  assertions.asserttrue(client.indices().exists(getindexrequest, requestoptions.default));\n  getindexrequest getindexaliasrequest = new getindexrequest(index_alias);\n  assertions.asserttrue(client.indices().exists(getindexaliasrequest, requestoptions.default));\n\n\n\n# 3. ææ¡£ api\n\n\n# 3.1. ææ¡£æµè¯åå¤\n\npublic static final string index = "mytest";\npublic static final string index_alias = "mytest_alias";\n/**\n * {@link user} ç mapping ç»æï¼jsonå½¢å¼ï¼\n */\npublic static final string mapping_json =\n  "{\\n" + "  \\"properties\\": {\\n" + "    \\"_class\\": {\\n" + "      \\"type\\": \\"keyword\\",\\n"\n  + "      \\"index\\": false,\\n" + "      \\"doc_values\\": false\\n" + "    },\\n" + "    \\"description\\": {\\n"\n  + "      \\"type\\": \\"text\\",\\n" + "      \\"fielddata\\": true\\n" + "    },\\n" + "    \\"enabled\\": {\\n"\n  + "      \\"type\\": \\"boolean\\"\\n" + "    },\\n" + "    \\"name\\": {\\n" + "      \\"type\\": \\"text\\",\\n"\n  + "      \\"fielddata\\": true\\n" + "    }\\n" + "  }\\n" + "}";\n\n@autowired\nprivate resthighlevelclient client;\n\n@beforeeach\npublic void init() throws ioexception {\n\n  // åå»ºç´¢å¼\n  createindexrequest createindexrequest = new createindexrequest(index);\n\n  // è®¾ç½®ç´¢å¼ç settings\n  createindexrequest.settings(\n  settings.builder().put("index.number_of_shards", 3).put("index.number_of_replicas", 2));\n\n  // è®¾ç½®ç´¢å¼ç mapping\n  createindexrequest.mapping(mapping_json, xcontenttype.json);\n\n  // è®¾ç½®ç´¢å¼çå«å\n  createindexrequest.alias(new alias(index_alias));\n\n  acknowledgedresponse response = client.indices().create(createindexrequest, requestoptions.default);\n  assertions.asserttrue(response.isacknowledged());\n\n  // å¤æ­ç´¢å¼æ¯å¦å­å¨\n  getindexrequest getindexrequest = new getindexrequest(index_alias);\n  assertions.asserttrue(client.indices().exists(getindexrequest, requestoptions.default));\n  getindexrequest getindexaliasrequest = new getindexrequest(index_alias);\n  assertions.asserttrue(client.indices().exists(getindexaliasrequest, requestoptions.default));\n  }\n\n@aftereach\npublic void destroy() throws ioexception {\n  // å é¤ç´¢å¼\n  deleteindexrequest request = new deleteindexrequest(index);\n  acknowledgedresponse response = client.indices().delete(request, requestoptions.default);\n  assertions.asserttrue(response.isacknowledged());\n  }\n\n\n\n# 3.2. åå»ºææ¡£\n\nresthighlevelclient api ä½¿ç¨ indexrequest æ¥æå»ºåå»ºææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãåå»º id ä¸º 1 çææ¡£\n\nindexrequest request = new indexrequest("product");\n  request.id("1");\n  product product = new product();\n  product.setname("æºå¨äºº");\n  product.setdescription("äººå·¥æºè½æºå¨äºº");\n  product.setenabled(true);\n  string jsonstring = jsonutil.tojsonstr(product);\n  request.source(jsonstring, xcontenttype.json);\n\n\nåæ­¥æ§è¡\n\nindexresponse indexresponse = client.index(request, requestoptions.default);\n\n\nå¼æ­¥æ§è¡\n\n// å¼æ­¥æ§è¡\nclient.indexasync(request, requestoptions.default, new actionlistener<indexresponse>() {\n@override\npublic void onresponse(indexresponse indexresponse) {\n  system.out.println(indexresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# 3.3. å é¤ææ¡£\n\nresthighlevelclient api ä½¿ç¨ deleterequest æ¥æå»ºå é¤ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãå é¤ id ä¸º 1 çææ¡£\n\ndeleterequest deleterequest = new deleterequest(index_alias, "1");\n\n\nåæ­¥æ§è¡\n\ndeleteresponse deleteresponse = client.delete(deleterequest, requestoptions.default);\n  system.out.println(deleteresponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.deleteasync(deleterequest, requestoptions.default, new actionlistener<deleteresponse>() {\n@override\npublic void onresponse(deleteresponse deleteresponse) {\n  system.out.println(deleteresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# 3.4. æ´æ°ææ¡£\n\nresthighlevelclient api ä½¿ç¨ updaterequest æ¥æå»ºæ´æ°ææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ´æ° id ä¸º 1 çææ¡£\n\nupdaterequest updaterequest = new updaterequest(index_alias, "1");\n  product product3 = new product();\n  product3.setname("æ«å°æºå¨äºº");\n  product3.setdescription("äººå·¥æºè½æ«å°æºå¨äºº");\n  product3.setenabled(true);\n  string jsonstring2 = jsonutil.tojsonstr(product3);\n  updaterequest.doc(jsonstring2, xcontenttype.json);\n\n\nåæ­¥æ§è¡\n\nupdateresponse updateresponse = client.update(updaterequest, requestoptions.default);\n  system.out.println(updateresponse);\n\n\nå¼æ­¥æ§è¡\n\nclient.updateasync(updaterequest, requestoptions.default, new actionlistener<updateresponse>() {\n@override\npublic void onresponse(updateresponse updateresponse) {\n  system.out.println(updateresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n  });\n\n\n\n# 3.5. æ¥çææ¡£\n\nresthighlevelclient api ä½¿ç¨ getrequest æ¥æå»ºæ¥çææ¡£çè¯·æ±åæ°ã\n\nãç¤ºä¾ãæ¥ç id ä¸º 1 çææ¡£\n\ngetrequest getrequest = new getrequest(index_alias, "1");\n\n\nåæ­¥æ§è¡\n\ngetresponse getresponse = client.get(getrequest, requestoptions.default);\n\n\nå¼æ­¥æ§è¡\n\nclient.getasync(getrequest, requestoptions.default, new actionlistener<getresponse>() {\n@override\npublic void onresponse(getresponse getresponse) {\n  system.out.println(getresponse);\n  }\n\n@override\npublic void onfailure(exception e) {\n  system.out.println("æ§è¡å¤±è´¥");\n  }\n});\n\n\n\n# 3.6. è·åå¹éæ¡ä»¶çè®°å½æ»æ°\n\n@test\n@displayname("è·åå¹éæ¡ä»¶çè®°å½æ»æ°")\npublic void count() throws ioexception {\n    searchsourcebuilder sourcebuilder = new searchsourcebuilder();\n    sourcebuilder.query(querybuilders.matchphrasequery("customer_gender", "male"));\n    sourcebuilder.tracktotalhits(true);\n\n    countrequest countrequest = new countrequest(index);\n    countrequest.source(sourcebuilder);\n\n    countresponse countresponse = client.count(countrequest, requestoptions.default);\n    long count = countresponse.getcount();\n    system.out.println("å½ä¸­è®°å½æ°ï¼" + count);\n}\n\n\n\n# 3.7. åé¡µæ¥è¯¢\n\n@parameterizedtest\n@valuesource(ints = {0, 1, 2, 3})\n@displayname("åé¡µæ¥è¯¢æµè¯")\npublic void pagetest(int page) throws ioexception {\n\n    int size = 10;\n    int offset = page * size;\n    searchsourcebuilder sourcebuilder = new searchsourcebuilder();\n    sourcebuilder.query(querybuilders.matchphrasequery("customer_gender", "male"));\n    sourcebuilder.from(offset);\n    sourcebuilder.size(size);\n    sourcebuilder.tracktotalhits(true);\n\n    searchrequest searchrequest = new searchrequest(index);\n    searchrequest.source(sourcebuilder);\n    searchresponse response = client.search(searchrequest, requestoptions.default);\n    searchhit[] hits = response.gethits().gethits();\n    for (searchhit hit : hits) {\n        kibanasampledataecommercebean bean =\n            beanutil.maptobean(hit.getsourceasmap(), kibanasampledataecommercebean.class, true,\n                               copyoptions.create());\n        system.out.println(bean);\n    }\n}\n\n\n\n# 3.8. æ¡ä»¶æ¥è¯¢\n\n@test\n@displayname("æ¡ä»¶æ¥è¯¢")\npublic void matchphrasequery() throws ioexception {\n    searchrequest searchrequest = new searchrequest(index);\n    searchsourcebuilder sourcebuilder = new searchsourcebuilder();\n\n    boolquerybuilder boolquerybuilder = querybuilders.boolquery();\n    boolquerybuilder.must(querybuilders.matchphrasequery("customer_last_name", "jensen"));\n    sourcebuilder.query(boolquerybuilder);\n    sourcebuilder.tracktotalhits(true);\n    searchrequest.source(sourcebuilder);\n    searchresponse response = client.search(searchrequest, requestoptions.default);\n    searchhit[] hits = response.gethits().gethits();\n    for (searchhit hit : hits) {\n        kibanasampledataecommercebean bean =\n            beanutil.maptobean(hit.getsourceasmap(), kibanasampledataecommercebean.class, true,\n                               copyoptions.create());\n        system.out.println(bean);\n    }\n}\n\n\n\n# 4. åèèµæ\n\n * å®æ¹\n   * java high level rest client',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch éç¾¤ååç",frontmatter:{title:"Elasticsearch éç¾¤ååç",date:"2022-03-01T20:52:25.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","éç¾¤","åç"],permalink:"/pages/d894ac/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/13.Elasticsearch%E9%9B%86%E7%BE%A4%E5%92%8C%E5%88%86%E7%89%87.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/13.Elasticsearchéç¾¤ååç.md",key:"v-32b9bb54",path:"/pages/d894ac/",headers:[{level:2,title:"1. éç¾¤",slug:"_1-éç¾¤",normalizedTitle:"1. éç¾¤",charIndex:26},{level:3,title:"1.1. ç©ºéç¾¤",slug:"_1-1-ç©ºéç¾¤",normalizedTitle:"1.1. ç©ºéç¾¤",charIndex:37},{level:3,title:"1.2. éç¾¤å¥åº·",slug:"_1-2-éç¾¤å¥åº·",normalizedTitle:"1.2. éç¾¤å¥åº·",charIndex:51},{level:3,title:"1.3. æ·»å ç´¢å¼",slug:"_1-3-æ·»å ç´¢å¼",normalizedTitle:"1.3. æ·»å ç´¢å¼",charIndex:66},{level:3,title:"1.4. æ·»å æéè½¬ç§»",slug:"_1-4-æ·»å æéè½¬ç§»",normalizedTitle:"1.4. æ·»å æéè½¬ç§»",charIndex:81},{level:3,title:"1.5. æ°´å¹³æ©å®¹",slug:"_1-5-æ°´å¹³æ©å®¹",normalizedTitle:"1.5. æ°´å¹³æ©å®¹",charIndex:98},{level:3,title:"1.6. æ´å¤çæ©å®¹",slug:"_1-6-æ´å¤çæ©å®¹",normalizedTitle:"1.6. æ´å¤çæ©å®¹",charIndex:113},{level:3,title:"1.7. åºå¯¹æé",slug:"_1-7-åºå¯¹æé",normalizedTitle:"1.7. åºå¯¹æé",charIndex:129},{level:2,title:"2. åç",slug:"_2-åç",normalizedTitle:"2. åç",charIndex:142},{level:3,title:"2.1. ä½¿ææ¬å¯è¢«æç´¢",slug:"_2-1-ä½¿ææ¬å¯è¢«æç´¢",normalizedTitle:"2.1. ä½¿ææ¬å¯è¢«æç´¢",charIndex:153},{level:3,title:"2.2. ä¸åæ§",slug:"_2-2-ä¸åæ§",normalizedTitle:"2.2. ä¸åæ§",charIndex:171},{level:3,title:"2.3. å¨ææ´æ°ç´¢å¼",slug:"_2-3-å¨ææ´æ°ç´¢å¼",normalizedTitle:"2.3. å¨ææ´æ°ç´¢å¼",charIndex:185},{level:3,title:"2.4. å é¤åæ´æ°",slug:"_2-4-å é¤åæ´æ°",normalizedTitle:"2.4. å é¤åæ´æ°",charIndex:202},{level:3,title:"2.5. è¿å®æ¶æç´¢",slug:"_2-5-è¿å®æ¶æç´¢",normalizedTitle:"2.5. è¿å®æ¶æç´¢",charIndex:218},{level:3,title:"2.6. refresh API",slug:"_2-6-refresh-api",normalizedTitle:"2.6. refresh api",charIndex:234},{level:3,title:"2.7. æä¹ååæ´",slug:"_2-7-æä¹ååæ´",normalizedTitle:"2.7. æä¹ååæ´",charIndex:256},{level:3,title:"2.8. flush API",slug:"_2-8-flush-api",normalizedTitle:"2.8. flush api",charIndex:272},{level:3,title:"2.9. æ®µåå¹¶",slug:"_2-9-æ®µåå¹¶",normalizedTitle:"2.9. æ®µåå¹¶",charIndex:292},{level:3,title:"2.10. optimize API",slug:"_2-10-optimize-api",normalizedTitle:"2.10. optimize api",charIndex:306},{level:2,title:"3. åèèµæ",slug:"_3-åèèµæ",normalizedTitle:"3. åèèµæ",charIndex:328}],headersStr:"1. éç¾¤ 1.1. ç©ºéç¾¤ 1.2. éç¾¤å¥åº· 1.3. æ·»å ç´¢å¼ 1.4. æ·»å æéè½¬ç§» 1.5. æ°´å¹³æ©å®¹ 1.6. æ´å¤çæ©å®¹ 1.7. åºå¯¹æé 2. åç 2.1. ä½¿ææ¬å¯è¢«æç´¢ 2.2. ä¸åæ§ 2.3. å¨ææ´æ°ç´¢å¼ 2.4. å é¤åæ´æ° 2.5. è¿å®æ¶æç´¢ 2.6. refresh API 2.7. æä¹ååæ´ 2.8. flush API 2.9. æ®µåå¹¶ 2.10. optimize API 3. åèèµæ",content:'# Elasticsearch éç¾¤ååç\n\n * 1. éç¾¤\n   * 1.1. ç©ºéç¾¤\n   * 1.2. éç¾¤å¥åº·\n   * 1.3. æ·»å ç´¢å¼\n   * 1.4. æ·»å æéè½¬ç§»\n   * 1.5. æ°´å¹³æ©å®¹\n   * 1.6. æ´å¤çæ©å®¹\n   * 1.7. åºå¯¹æé\n * 2. åç\n   * 2.1. ä½¿ææ¬å¯è¢«æç´¢\n   * 2.2. ä¸åæ§\n   * 2.3. å¨ææ´æ°ç´¢å¼\n   * 2.4. å é¤åæ´æ°\n   * 2.5. è¿å®æ¶æç´¢\n   * 2.6. refresh API\n   * 2.7. æä¹ååæ´\n   * 2.8. flush API\n   * 2.9. æ®µåå¹¶\n   * 2.10. optimize API\n * 3. åèèµæ\n\n\n# 1. éç¾¤\n\n\n# 1.1. ç©ºéç¾¤\n\nå¦ææä»¬å¯å¨äºä¸ä¸ªåç¬çèç¹ï¼éé¢ä¸åå«ä»»ä½çæ°æ®åç´¢å¼ï¼é£æä»¬çéç¾¤çèµ·æ¥å°±æ¯ä¸ä¸ªåå«ç©ºåå®¹èç¹çéç¾¤ã\n\nFigure 1. åå«ç©ºåå®¹èç¹çéç¾¤\n\n\n\nå¾ 1ï¼åªæä¸ä¸ªç©ºèç¹çéç¾¤\n\nä¸ä¸ªè¿è¡ä¸­ç Elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ï¼èéç¾¤æ¯ç±ä¸ä¸ªæèå¤ä¸ªæ¥æç¸å cluster.name éç½®çèç¹ç»æï¼ å®ä»¬å±åæ¿ææ°æ®åè´è½½çååãå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼ å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéçå¢å å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ãæä»¬çç¤ºä¾éç¾¤å°±åªæä¸ä¸ªèç¹ï¼æä»¥å®åæ¶ä¹æä¸ºäºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã Elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n\n# 1.2. éç¾¤å¥åº·\n\nElasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nGET /_cluster/health\n\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 0,\n  "active_shards": 0,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# 1.3. æ·»å ç´¢å¼\n\næä»¬å¾ Elasticsearch æ·»å æ°æ®æ¶éè¦ç¨å° ç´¢å¼ ââ ä¿å­ç¸å³æ°æ®çå°æ¹ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ª åç æ¯ä¸ä¸ªåºå±ç å·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãç°å¨æä»¬åªéç¥éä¸ä¸ªåçæ¯ä¸ä¸ª Lucene çå®ä¾ï¼ä»¥åå®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nElasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ Elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\nä¸ä¸ªåçå¯ä»¥æ¯ ä¸» åçæè å¯æ¬ åçã ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçï¼æä»¥ä¸»åççæ°ç®å³å®çç´¢å¼è½å¤ä¿å­çæå¤§æ°æ®éã\n\n> ææ¯ä¸æ¥è¯´ï¼ä¸ä¸ªä¸»åçæå¤§è½å¤å­å¨ Integer.MAX_VALUE - 128 ä¸ªææ¡£ï¼ä½æ¯å®éæå¤§å¼è¿éè¦åèä½ çä½¿ç¨åºæ¯ï¼åæ¬ä½ ä½¿ç¨çç¡¬ä»¶ï¼ ææ¡£çå¤§å°åå¤æç¨åº¦ï¼ç´¢å¼åæ¥è¯¢ææ¡£çæ¹å¼ä»¥åä½ ææçååºæ¶é¿ã\n\nä¸ä¸ªå¯æ¬åçåªæ¯ä¸ä¸ªä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\nå¨ç´¢å¼å»ºç«çæ¶åå°±å·²ç»ç¡®å®äºä¸»åçæ°ï¼ä½æ¯å¯æ¬åçæ°å¯ä»¥éæ¶ä¿®æ¹ã\n\nè®©æä»¬å¨åå«ä¸ä¸ªç©ºèç¹çéç¾¤ååå»ºåä¸º blogs çç´¢å¼ã ç´¢å¼å¨é»è®¤æåµä¸ä¼è¢«åé 5 ä¸ªä¸»åçï¼ ä½æ¯ä¸ºäºæ¼ç¤ºç®çï¼æä»¬å°åé 3 ä¸ªä¸»åçåä¸ä»½å¯æ¬ï¼æ¯ä¸ªä¸»åçæ¥æä¸ä¸ªå¯æ¬åçï¼ï¼\n\nPUT /blogs\n{\n   "settings" : {\n      "number_of_shards" : 3,\n      "number_of_replicas" : 1\n   }\n}\n\n\næä»¬çéç¾¤ç°å¨æ¯ æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤ãææ 3 ä¸ªä¸»åçé½è¢«åéå¨ Node 1 ã\n\nFigure 2. æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤\n\n\n\nå¦ææä»¬ç°å¨æ¥çéç¾¤å¥åº·ï¼æä»¬å°çå°å¦ä¸åå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "yellow",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 3,\n  "active_shards": 3,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 3,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 50\n}\n\n\n * éç¾¤ status å¼ä¸º yellow\n * æ²¡æè¢«åéå°ä»»ä½èç¹çå¯æ¬æ°\n\néç¾¤çå¥åº·ç¶åµä¸º yellow åè¡¨ç¤ºå¨é¨ ä¸» åçé½æ­£å¸¸è¿è¡ï¼éç¾¤å¯ä»¥æ­£å¸¸æå¡ææè¯·æ±ï¼ï¼ä½æ¯ å¯æ¬ åçæ²¡æå¨é¨å¤å¨æ­£å¸¸ç¶æã å®éä¸ï¼ææ 3 ä¸ªå¯æ¬åçé½æ¯ unassigned ââ å®ä»¬é½æ²¡æè¢«åéå°ä»»ä½èç¹ã å¨åä¸ä¸ªèç¹ä¸æ¢ä¿å­åå§æ°æ®åä¿å­å¯æ¬æ¯æ²¡ææä¹çï¼å ä¸ºä¸æ¦å¤±å»äºé£ä¸ªèç¹ï¼æä»¬ä¹å°ä¸¢å¤±è¯¥èç¹ä¸çææå¯æ¬æ°æ®ã\n\nå½åæä»¬çéç¾¤æ¯æ­£å¸¸è¿è¡çï¼ä½æ¯å¨ç¡¬ä»¶æéæ¶æä¸¢å¤±æ°æ®çé£é©ã\n\n\n# 1.4. æ·»å æéè½¬ç§»\n\nå½éç¾¤ä¸­åªæä¸ä¸ªèç¹å¨è¿è¡æ¶ï¼æå³çä¼æä¸ä¸ªåç¹æéé®é¢ââæ²¡æåä½ã å¹¸è¿çæ¯ï¼æä»¬åªéåå¯å¨ä¸ä¸ªèç¹å³å¯é²æ­¢æ°æ®ä¸¢å¤±ã\n\n> ä¸ºäºæµè¯ç¬¬äºä¸ªèç¹å¯å¨åçæåµï¼ä½ å¯ä»¥å¨åä¸ä¸ªç®å½åï¼å®å¨ä¾ç§å¯å¨ç¬¬ä¸ä¸ªèç¹çæ¹å¼æ¥å¯å¨ä¸ä¸ªæ°èç¹ï¼åèå®è£å¹¶è¿è¡ Elasticsearchï¼ãå¤ä¸ªèç¹å¯ä»¥å±äº«åä¸ä¸ªç®å½ã\n> \n> å½ä½ å¨åä¸å°æºå¨ä¸å¯å¨äºç¬¬äºä¸ªèç¹æ¶ï¼åªè¦å®åç¬¬ä¸ä¸ªèç¹æåæ ·ç cluster.name éç½®ï¼å®å°±ä¼èªå¨åç°éç¾¤å¹¶å å¥å°å¶ä¸­ã ä½æ¯å¨ä¸åæºå¨ä¸å¯å¨èç¹çæ¶åï¼ä¸ºäºå å¥å°åä¸éç¾¤ï¼ä½ éè¦éç½®ä¸ä¸ªå¯è¿æ¥å°çåæ­ä¸»æºåè¡¨ã\n\nå¦æå¯å¨äºç¬¬äºä¸ªèç¹ï¼æä»¬çéç¾¤å°ä¼æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åéã\n\nFigure 3. æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åé\n\n\n\nå½ç¬¬äºä¸ªèç¹å å¥å°éç¾¤åï¼3 ä¸ª å¯æ¬åç å°ä¼åéå°è¿ä¸ªèç¹ä¸ââæ¯ä¸ªä¸»åçå¯¹åºä¸ä¸ªå¯æ¬åçã è¿æå³çå½éç¾¤åä»»ä½ä¸ä¸ªèç¹åºç°é®é¢æ¶ï¼æä»¬çæ°æ®é½å®å¥½æ æã\n\næææ°è¿è¢«ç´¢å¼çææ¡£é½å°ä¼ä¿å­å¨ä¸»åçä¸ï¼ç¶åè¢«å¹¶è¡çå¤å¶å°å¯¹åºçå¯æ¬åçä¸ãè¿å°±ä¿è¯äºæä»¬æ¢å¯ä»¥ä»ä¸»åçåå¯ä»¥ä»å¯æ¬åçä¸è·å¾ææ¡£ã\n\ncluster-health ç°å¨å±ç¤ºçç¶æä¸º green ï¼è¿è¡¨ç¤ºææ 6 ä¸ªåçï¼åæ¬ 3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼é½å¨æ­£å¸¸è¿è¡ã\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 2,\n  "number_of_data_nodes": 2,\n  "active_primary_shards": 3,\n  "active_shards": 6,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 100\n}\n\n\n * éç¾¤ status å¼ä¸º green\n\næä»¬çéç¾¤ç°å¨ä¸ä»ä»æ¯æ­£å¸¸è¿è¡çï¼å¹¶ä¸è¿å¤äº å§ç»å¯ç¨ çç¶æã\n\n\n# 1.5. æ°´å¹³æ©å®¹\n\nææ ·ä¸ºæä»¬çæ­£å¨å¢é¿ä¸­çåºç¨ç¨åºæéæ©å®¹å¢ï¼ å½å¯å¨äºç¬¬ä¸ä¸ªèç¹ï¼æä»¬çéç¾¤å°æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åéã\n\nFigure 4. æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åé\n\n\n\nNode 1 å Node 2 ä¸åæä¸ä¸ªåçè¢«è¿ç§»å°äºæ°ç Node 3 èç¹ï¼ç°å¨æ¯ä¸ªèç¹ä¸é½æ¥æ 2 ä¸ªåçï¼èä¸æ¯ä¹åç 3 ä¸ªã è¿è¡¨ç¤ºæ¯ä¸ªèç¹çç¡¬ä»¶èµæºï¼CPU, RAM, I/Oï¼å°è¢«æ´å°çåçæå±äº«ï¼æ¯ä¸ªåççæ§è½å°ä¼å¾å°æåã\n\nåçæ¯ä¸ä¸ªåè½å®æ´çæç´¢å¼æï¼å®æ¥æä½¿ç¨ä¸ä¸ªèç¹ä¸çææèµæºçè½åã æä»¬è¿ä¸ªæ¥æ 6 ä¸ªåçï¼3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼çç´¢å¼å¯ä»¥æå¤§æ©å®¹å° 6 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸å­å¨ä¸ä¸ªåçï¼å¹¶ä¸æ¯ä¸ªåçæ¥ææå¨èç¹çå¨é¨èµæºã\n\n\n# 1.6. æ´å¤çæ©å®¹\n\nä½æ¯å¦ææä»¬æ³è¦æ©å®¹è¶è¿ 6 ä¸ªèç¹æä¹åå¢ï¼\n\nä¸»åççæ°ç®å¨ç´¢å¼åå»ºæ¶å°±å·²ç»ç¡®å®äºä¸æ¥ãå®éä¸ï¼è¿ä¸ªæ°ç®å®ä¹äºè¿ä¸ªç´¢å¼è½å¤ å­å¨ çæå¤§æ°æ®éãï¼å®éå¤§å°åå³äºä½ çæ°æ®ãç¡¬ä»¶åä½¿ç¨åºæ¯ãï¼ ä½æ¯ï¼è¯»æä½ââæç´¢åè¿åæ°æ®ââå¯ä»¥åæ¶è¢«ä¸»åç æ å¯æ¬åçæå¤çï¼æä»¥å½ä½ æ¥æè¶å¤çå¯æ¬åçæ¶ï¼ä¹å°æ¥æè¶é«çååéã\n\nå¨è¿è¡ä¸­çéç¾¤ä¸æ¯å¯ä»¥å¨æè°æ´å¯æ¬åçæ°ç®çï¼æä»¬å¯ä»¥æéä¼¸ç¼©éç¾¤ãè®©æä»¬æå¯æ¬æ°ä»é»è®¤ç 1 å¢å å° 2 ï¼\n\nPUT /blogs/_settings\n{\n   "number_of_replicas" : 2\n}\n\n\nblogs ç´¢å¼ç°å¨æ¥æ 9 ä¸ªåçï¼3 ä¸ªä¸»åçå 6 ä¸ªå¯æ¬åçã è¿æå³çæä»¬å¯ä»¥å°éç¾¤æ©å®¹å° 9 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸ä¸ä¸ªåçãç¸æ¯åæ¥ 3 ä¸ªèç¹æ¶ï¼éç¾¤æç´¢æ§è½å¯ä»¥æå 3 åã\n\nFigure 5. å°åæ° number_of_replicas è°å¤§å° 2\n\n\n\n> å½ç¶ï¼å¦æåªæ¯å¨ç¸åèç¹æ°ç®çéç¾¤ä¸å¢å æ´å¤çå¯æ¬åçå¹¶ä¸è½æé«æ§è½ï¼å ä¸ºæ¯ä¸ªåçä»èç¹ä¸è·å¾çèµæºä¼åå°ã ä½ éè¦å¢å æ´å¤çç¡¬ä»¶èµæºæ¥æåååéã\n> \n> ä½æ¯æ´å¤çå¯æ¬åçæ°æé«äºæ°æ®åä½éï¼æç§ä¸é¢çèç¹éç½®ï¼æä»¬å¯ä»¥å¨å¤±å» 2 ä¸ªèç¹çæåµä¸ä¸ä¸¢å¤±ä»»ä½æ°æ®ã\n\n\n# 1.7. åºå¯¹æé\n\næä»¬ä¹åè¯´è¿ Elasticsearch å¯ä»¥åºå¯¹èç¹æéï¼æ¥ä¸æ¥è®©æä»¬å°è¯ä¸è¿ä¸ªåè½ã å¦ææä»¬å³é­ç¬¬ä¸ä¸ªèç¹ï¼è¿æ¶éç¾¤çç¶æä¸ºå³é­äºä¸ä¸ªèç¹åçéç¾¤ã\n\nFigure 6. å³é­äºä¸ä¸ªèç¹åçéç¾¤\n\n\n\næä»¬å³é­çèç¹æ¯ä¸ä¸ªä¸»èç¹ãèéç¾¤å¿é¡»æ¥æä¸ä¸ªä¸»èç¹æ¥ä¿è¯æ­£å¸¸å·¥ä½ï¼æä»¥åççç¬¬ä¸ä»¶äºæå°±æ¯éä¸¾ä¸ä¸ªæ°çä¸»èç¹ï¼ Node 2 ã\n\nå¨æä»¬å³é­ Node 1 çåæ¶ä¹å¤±å»äºä¸»åç 1 å 2 ï¼å¹¶ä¸å¨ç¼ºå¤±ä¸»åççæ¶åç´¢å¼ä¹ä¸è½æ­£å¸¸å·¥ä½ã å¦ææ­¤æ¶æ¥æ£æ¥éç¾¤çç¶åµï¼æä»¬çå°çç¶æå°ä¼ä¸º red ï¼ä¸æ¯ææä¸»åçé½å¨æ­£å¸¸å·¥ä½ã\n\nå¹¸è¿çæ¯ï¼å¨å¶å®èç¹ä¸å­å¨çè¿ä¸¤ä¸ªä¸»åççå®æ´å¯æ¬ï¼ æä»¥æ°çä¸»èç¹ç«å³å°è¿äºåçå¨ Node 2 å Node 3 ä¸å¯¹åºçå¯æ¬åçæåä¸ºä¸»åçï¼ æ­¤æ¶éç¾¤çç¶æå°ä¼ä¸º yellow ã è¿ä¸ªæåä¸»åççè¿ç¨æ¯ç¬é´åççï¼å¦åæä¸ä¸ä¸ªå¼å³ä¸è¬ã\n\nä¸ºä»ä¹æä»¬éç¾¤ç¶ææ¯ yellow èä¸æ¯ green å¢ï¼ è½ç¶æä»¬æ¥æææçä¸ä¸ªä¸»åçï¼ä½æ¯åæ¶è®¾ç½®äºæ¯ä¸ªä¸»åçéè¦å¯¹åº 2 ä»½å¯æ¬åçï¼èæ­¤æ¶åªå­å¨ä¸ä»½å¯æ¬åçã æä»¥éç¾¤ä¸è½ä¸º green çç¶æï¼ä¸è¿æä»¬ä¸å¿è¿äºæå¿ï¼å¦ææä»¬åæ ·å³é­äº Node 2 ï¼æä»¬çç¨åº ä¾ç¶ å¯ä»¥ä¿æå¨ä¸ä¸¢ä»»ä½æ°æ®çæåµä¸è¿è¡ï¼å ä¸º Node 3 ä¸ºæ¯ä¸ä¸ªåçé½ä¿ççä¸ä»½å¯æ¬ã\n\nå¦ææä»¬éæ°å¯å¨ Node 1 ï¼éç¾¤å¯ä»¥å°ç¼ºå¤±çå¯æ¬åçåæ¬¡è¿è¡åéï¼é£ä¹éç¾¤çç¶æä¹å°å¦ Figure 5. å°åæ° number_of_replicas è°å¤§å° 2 æç¤ºã å¦æ Node 1 ä¾ç¶æ¥æçä¹åçåçï¼å®å°å°è¯å»éç¨å®ä»¬ï¼åæ¶ä»ä»ä¸»åçå¤å¶åçäºä¿®æ¹çæ°æ®æä»¶ã\n\nå°ç®åä¸ºæ­¢ï¼ä½ åºè¯¥å¯¹åçå¦ä½ä½¿å¾ Elasticsearch è¿è¡æ°´å¹³æ©å®¹ä»¥åæ°æ®ä¿éç­ç¥è¯æäºä¸å®äºè§£ã æ¥ä¸æ¥æä»¬å°è®²è¿°å³äºåççå½å¨æçæ´å¤ç»èã\n\n\n# 2. åç\n\n>  * ä¸ºä»ä¹æç´¢æ¯ è¿ å®æ¶çï¼\n>  * ä¸ºä»ä¹ææ¡£ç CRUD (åå»º-è¯»å-æ´æ°-å é¤) æä½æ¯ å®æ¶ ç?\n>  * Elasticsearch æ¯ææ ·ä¿è¯æ´æ°è¢«æä¹åå¨æ­çµæ¶ä¹ä¸ä¸¢å¤±æ°æ®?\n>  * ä¸ºä»ä¹å é¤ææ¡£ä¸ä¼ç«å»éæ¾ç©ºé´ï¼\n>  * refresh, flush, å optimize API é½åäºä»ä¹, ä½ ä»ä¹æåµä¸åºè¯¥ä½¿ç¨ä»ä»¬ï¼\n\n\n# 2.1. ä½¿ææ¬å¯è¢«æç´¢\n\nå¿é¡»è§£å³çç¬¬ä¸ä¸ªæææ¯å¦ä½ä½¿ææ¬å¯è¢«æç´¢ã ä¼ ç»çæ°æ®åºæ¯ä¸ªå­æ®µå­å¨åä¸ªå¼ï¼ä½è¿å¯¹å¨ææ£ç´¢å¹¶ä¸å¤ãææ¬å­æ®µä¸­çæ¯ä¸ªåè¯éè¦è¢«æç´¢ï¼å¯¹æ°æ®åºæå³çéè¦åä¸ªå­æ®µæç´¢å¼å¤å¼(è¿éæåè¯)çè½åã\n\næå¥½çæ¯æ ä¸ä¸ªå­æ®µå¤ä¸ªå¼ éæ±çæ°æ®ç»ææ¯æä»¬å¨ åæç´¢å¼ ç« èä¸­ä»ç»è¿ç åæç´¢å¼ ã åæç´¢å¼åå«ä¸ä¸ªæåºåè¡¨ï¼åè¡¨åå«ææææ¡£åºç°è¿çä¸éå¤ä¸ªä½ï¼æç§°ä¸º è¯é¡¹ ï¼å¯¹äºæ¯ä¸ä¸ªè¯é¡¹ï¼åå«äºå®æææ¾åºç°è¿ææ¡£çåè¡¨ã\n\nTerm  | Doc 1 | Doc 2 | Doc 3 | ...\n------------------------------------\nbrown |   X   |       |  X    | ...\nfox   |   X   |   X   |  X    | ...\nquick |   X   |   X   |       | ...\nthe   |   X   |       |  X    | ...\n\n\n> å½è®¨è®ºåæç´¢å¼æ¶ï¼æä»¬ä¼è°å° ææ¡£ æ å¼ï¼å ä¸ºåå²åå ï¼åæç´¢å¼è¢«ç¨æ¥å¯¹æ´ä¸ªéç»æåææ¬ææ¡£è¿è¡æ å¼ã Elasticsearch ä¸­ç ææ¡£ æ¯æå­æ®µåå¼çç»æå JSON ææ¡£ãäºå®ä¸ï¼å¨ JSON ææ¡£ä¸­ï¼ æ¯ä¸ªè¢«ç´¢å¼çå­æ®µé½æèªå·±çåæç´¢å¼ã\n\nè¿ä¸ªåæç´¢å¼ç¸æ¯ç¹å®è¯é¡¹åºç°è¿çææ¡£åè¡¨ï¼ä¼åå«æ´å¤å¶å®ä¿¡æ¯ãå®ä¼ä¿å­æ¯ä¸ä¸ªè¯é¡¹åºç°è¿çææ¡£æ»æ°ï¼ å¨å¯¹åºçææ¡£ä¸­ä¸ä¸ªå·ä½è¯é¡¹åºç°çæ»æ¬¡æ°ï¼è¯é¡¹å¨ææ¡£ä¸­çé¡ºåºï¼æ¯ä¸ªææ¡£çé¿åº¦ï¼ææææ¡£çå¹³åé¿åº¦ï¼ç­ç­ãè¿äºç»è®¡ä¿¡æ¯åè®¸ Elasticsearch å³å®åªäºè¯æ¯å¶å®è¯æ´éè¦ï¼åªäºææ¡£æ¯å¶å®ææ¡£æ´éè¦ï¼è¿äºåå®¹å¨ ä»ä¹æ¯ç¸å³æ§? ä¸­ææè¿°ã\n\nä¸ºäºè½å¤å®ç°é¢æåè½ï¼åæç´¢å¼éè¦ç¥ééåä¸­ç ææ ææ¡£ï¼è¿æ¯éè¦è®¤è¯å°çå³é®é®é¢ã\n\næ©æçå¨ææ£ç´¢ä¼ä¸ºæ´ä¸ªææ¡£éåå»ºç«ä¸ä¸ªå¾å¤§çåæç´¢å¼å¹¶å°å¶åå¥å°ç£çã ä¸æ¦æ°çç´¢å¼å°±ç»ªï¼æ§çå°±ä¼è¢«å¶æ¿æ¢ï¼è¿æ ·æè¿çååä¾¿å¯ä»¥è¢«æ£ç´¢å°ã\n\n\n# 2.2. ä¸åæ§\n\nåæç´¢å¼è¢«åå¥ç£çåæ¯ ä¸å¯æ¹å ç:å®æ°¸è¿ä¸ä¼ä¿®æ¹ã ä¸åæ§æéè¦çä»·å¼ï¼\n\n * ä¸éè¦éãå¦æä½ ä»æ¥ä¸æ´æ°ç´¢å¼ï¼ä½ å°±ä¸éè¦æå¿å¤è¿ç¨åæ¶ä¿®æ¹æ°æ®çé®é¢ã\n * ä¸æ¦ç´¢å¼è¢«è¯»å¥åæ ¸çæä»¶ç³»ç»ç¼å­ï¼ä¾¿ä¼çå¨åªéï¼ç±äºå¶ä¸åæ§ãåªè¦æä»¶ç³»ç»ç¼å­ä¸­è¿æè¶³å¤çç©ºé´ï¼é£ä¹å¤§é¨åè¯»è¯·æ±ä¼ç´æ¥è¯·æ±åå­ï¼èä¸ä¼å½ä¸­ç£çãè¿æä¾äºå¾å¤§çæ§è½æåã\n * å¶å®ç¼å­(å filter ç¼å­)ï¼å¨ç´¢å¼ççå½å¨æåå§ç»ææãå®ä»¬ä¸éè¦å¨æ¯æ¬¡æ°æ®æ¹åæ¶è¢«éå»ºï¼å ä¸ºæ°æ®ä¸ä¼ååã\n * åå¥åä¸ªå¤§çåæç´¢å¼åè®¸æ°æ®è¢«åç¼©ï¼åå°ç£ç I/O å éè¦è¢«ç¼å­å°åå­çç´¢å¼çä½¿ç¨éã\n\nå½ç¶ï¼ä¸ä¸ªä¸åçç´¢å¼ä¹æä¸å¥½çå°æ¹ãä¸»è¦äºå®æ¯å®æ¯ä¸å¯åç! ä½ ä¸è½ä¿®æ¹å®ãå¦æä½ éè¦è®©ä¸ä¸ªæ°çææ¡£ å¯è¢«æç´¢ï¼ä½ éè¦éå»ºæ´ä¸ªç´¢å¼ãè¿è¦ä¹å¯¹ä¸ä¸ªç´¢å¼æè½åå«çæ°æ®éé æäºå¾å¤§çéå¶ï¼è¦ä¹å¯¹ç´¢å¼å¯è¢«æ´æ°çé¢çé æäºå¾å¤§çéå¶ã\n\n\n# 2.3. å¨ææ´æ°ç´¢å¼\n\nä¸ä¸ä¸ªéè¦è¢«è§£å³çé®é¢æ¯ææ ·å¨ä¿çä¸åæ§çåæä¸å®ç°åæç´¢å¼çæ´æ°ï¼ç­æ¡æ¯: ç¨æ´å¤çç´¢å¼ã\n\néè¿å¢å æ°çè¡¥åç´¢å¼æ¥åæ æ°è¿çä¿®æ¹ï¼èä¸æ¯ç´æ¥éåæ´ä¸ªåæç´¢å¼ãæ¯ä¸ä¸ªåæç´¢å¼é½ä¼è¢«è½®æµæ¥è¯¢å°âä»ææ©çå¼å§âæ¥è¯¢å®ååå¯¹ç»æè¿è¡åå¹¶ã\n\nElasticsearch åºäº Lucene, è¿ä¸ª java åºå¼å¥äº ææ®µæç´¢ çæ¦å¿µã æ¯ä¸ æ®µ æ¬èº«é½æ¯ä¸ä¸ªåæç´¢å¼ï¼ ä½ ç´¢å¼ å¨ Lucene ä¸­é¤è¡¨ç¤ºææ æ®µ çéåå¤ï¼ è¿å¢å äº æäº¤ç¹ çæ¦å¿µ â ä¸ä¸ªååºäºææå·²ç¥æ®µçæä»¶ï¼å°±åå¨ Figure 16, âä¸ä¸ª Lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µâ ä¸­æç»çé£æ ·ã å¦ Figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç Lucene ç´¢å¼â æç¤ºï¼æ°çææ¡£é¦åè¢«æ·»å å°åå­ç´¢å¼ç¼å­ä¸­ï¼ç¶ååå¥å°ä¸ä¸ªåºäºç£ççæ®µï¼å¦ Figure 18, âå¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºãâ æç¤ºã\n\nFigure 16. ä¸ä¸ª Lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µ\n\n\n\n> è¢«æ··æ·çæ¦å¿µæ¯ï¼ä¸ä¸ª Lucene ç´¢å¼ æä»¬å¨ Elasticsearch ç§°ä½ åç ã ä¸ä¸ª Elasticsearch ç´¢å¼ æ¯åççéåã å½ Elasticsearch å¨ç´¢å¼ä¸­æç´¢çæ¶åï¼ ä»åéæ¥è¯¢å°æ¯ä¸ä¸ªå±äºç´¢å¼çåç(Lucene ç´¢å¼)ï¼ç¶åå æ§è¡åå¸å¼æ£ç´¢ æå°çé£æ ·ï¼åå¹¶æ¯ä¸ªåççç»æå°ä¸ä¸ªå¨å±çç»æéã\n\néæ®µæç´¢ä¼ä»¥å¦ä¸æµç¨è¿è¡å·¥ä½ï¼\n\n 1. æ°ææ¡£è¢«æ¶éå°åå­ç´¢å¼ç¼å­ï¼ è§ Figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç Lucene ç´¢å¼â ã\n 2. ä¸æ¶å°, ç¼å­è¢« æäº¤ ï¼\n    * ä¸ä¸ªæ°çæ®µâä¸ä¸ªè¿½å çåæç´¢å¼âè¢«åå¥ç£çã\n    * ä¸ä¸ªæ°çåå«æ°æ®µåå­ç æäº¤ç¹ è¢«åå¥ç£çã\n    * ç£çè¿è¡ åæ­¥ â ææå¨æä»¶ç³»ç»ç¼å­ä¸­ç­å¾çåå¥é½å·æ°å°ç£çï¼ä»¥ç¡®ä¿å®ä»¬è¢«åå¥ç©çæä»¶ã\n 3. æ°çæ®µè¢«å¼å¯ï¼è®©å®åå«çææ¡£å¯è§ä»¥è¢«æç´¢ã\n 4. åå­ç¼å­è¢«æ¸ç©ºï¼ç­å¾æ¥æ¶æ°çææ¡£ã\n\nFigure 17. ä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç Lucene ç´¢å¼\n\n\n\nFigure 18. å¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºã\n\n\n\nå½ä¸ä¸ªæ¥è¯¢è¢«è§¦åï¼ææå·²ç¥çæ®µæé¡ºåºè¢«æ¥è¯¢ãè¯é¡¹ç»è®¡ä¼å¯¹æææ®µçç»æè¿è¡èåï¼ä»¥ä¿è¯æ¯ä¸ªè¯åæ¯ä¸ªææ¡£çå³èé½è¢«åç¡®è®¡ç®ã è¿ç§æ¹å¼å¯ä»¥ç¨ç¸å¯¹è¾ä½çææ¬å°æ°ææ¡£æ·»å å°ç´¢å¼ã\n\n\n# 2.4. å é¤åæ´æ°\n\næ®µæ¯ä¸å¯æ¹åçï¼æä»¥æ¢ä¸è½ä»æææ¡£ä»æ§çæ®µä¸­ç§»é¤ï¼ä¹ä¸è½ä¿®æ¹æ§çæ®µæ¥è¿è¡åæ ææ¡£çæ´æ°ã åèä»£ä¹çæ¯ï¼æ¯ä¸ªæäº¤ç¹ä¼åå«ä¸ä¸ª .del æä»¶ï¼æä»¶ä¸­ä¼ååºè¿äºè¢«å é¤ææ¡£çæ®µä¿¡æ¯ã\n\nå½ä¸ä¸ªææ¡£è¢« âå é¤â æ¶ï¼å®å®éä¸åªæ¯å¨ .del æä»¶ä¸­è¢« æ è®° å é¤ãä¸ä¸ªè¢«æ è®°å é¤çææ¡£ä»ç¶å¯ä»¥è¢«æ¥è¯¢å¹éå°ï¼ ä½å®ä¼å¨æç»ç»æè¢«è¿ååä»ç»æéä¸­ç§»é¤ã\n\nææ¡£æ´æ°ä¹æ¯ç±»ä¼¼çæä½æ¹å¼ï¼å½ä¸ä¸ªææ¡£è¢«æ´æ°æ¶ï¼æ§çæ¬ææ¡£è¢«æ è®°å é¤ï¼ææ¡£çæ°çæ¬è¢«ç´¢å¼å°ä¸ä¸ªæ°çæ®µä¸­ã å¯è½ä¸¤ä¸ªçæ¬çææ¡£é½ä¼è¢«ä¸ä¸ªæ¥è¯¢å¹éå°ï¼ä½è¢«å é¤çé£ä¸ªæ§çæ¬ææ¡£å¨ç»æéè¿ååå°±å·²ç»è¢«ç§»é¤ã\n\nå¨ æ®µåå¹¶ , æä»¬å±ç¤ºäºä¸ä¸ªè¢«å é¤çææ¡£æ¯ææ ·è¢«æä»¶ç³»ç»ç§»é¤çã\n\n\n# 2.5. è¿å®æ¶æç´¢\n\néçææ®µï¼per-segmentï¼æç´¢çåå±ï¼ä¸ä¸ªæ°çææ¡£ä»ç´¢å¼å°å¯è¢«æç´¢çå»¶è¿æ¾èéä½äºãæ°ææ¡£å¨å åéä¹åå³å¯è¢«æ£ç´¢ï¼ä½è¿æ ·è¿æ¯ä¸å¤å¿«ã\n\nç£çå¨è¿éæä¸ºäºç¶é¢ãæäº¤ï¼Commitingï¼ä¸ä¸ªæ°çæ®µå°ç£çéè¦ä¸ä¸ª fsync æ¥ç¡®ä¿æ®µè¢«ç©çæ§å°åå¥ç£çï¼è¿æ ·å¨æ­çµçæ¶åå°±ä¸ä¼ä¸¢å¤±æ°æ®ã ä½æ¯ fsync æä½ä»£ä»·å¾å¤§; å¦ææ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æ§è¡ä¸æ¬¡çè¯ä¼é æå¾å¤§çæ§è½é®é¢ã\n\næä»¬éè¦çæ¯ä¸ä¸ªæ´è½»éçæ¹å¼æ¥ä½¿ä¸ä¸ªææ¡£å¯è¢«æç´¢ï¼è¿æå³ç fsync è¦ä»æ´ä¸ªè¿ç¨ä¸­è¢«ç§»é¤ã\n\nå¨ Elasticsearch åç£çä¹é´æ¯æä»¶ç³»ç»ç¼å­ã åä¹åæè¿°çä¸æ ·ï¼ å¨åå­ç´¢å¼ç¼å²åºï¼ Figure 19, âå¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç Lucene ç´¢å¼â ï¼ä¸­çææ¡£ä¼è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ Figure 20, âç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤â ï¼ã ä½æ¯è¿éæ°æ®µä¼è¢«ååå¥å°æä»¶ç³»ç»ç¼å­âè¿ä¸æ­¥ä»£ä»·ä¼æ¯è¾ä½ï¼ç¨ååè¢«å·æ°å°ç£çâè¿ä¸æ­¥ä»£ä»·æ¯è¾é«ãä¸è¿åªè¦æä»¶å·²ç»å¨ç¼å­ä¸­ï¼ å°±å¯ä»¥åå¶å®æä»¶ä¸æ ·è¢«æå¼åè¯»åäºã\n\nFigure 19. å¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç Lucene ç´¢å¼\n\n\n\nLucene åè®¸æ°æ®µè¢«åå¥åæå¼âä½¿å¶åå«çææ¡£å¨æªè¿è¡ä¸æ¬¡å®æ´æäº¤æ¶ä¾¿å¯¹æç´¢å¯è§ã è¿ç§æ¹å¼æ¯è¿è¡ä¸æ¬¡æäº¤ä»£ä»·è¦å°å¾å¤ï¼å¹¶ä¸å¨ä¸å½±åæ§è½çåæä¸å¯ä»¥è¢«é¢ç¹å°æ§è¡ã\n\nFigure 20. ç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤\n\n\n\n\n# 2.6. refresh API\n\nå¨ Elasticsearch ä¸­ï¼åå¥åæå¼ä¸ä¸ªæ°æ®µçè½»éçè¿ç¨å«å refresh ã é»è®¤æåµä¸æ¯ä¸ªåçä¼æ¯ç§èªå¨å·æ°ä¸æ¬¡ãè¿å°±æ¯ä¸ºä»ä¹æä»¬è¯´ Elasticsearch æ¯ è¿ å®æ¶æç´¢: ææ¡£çååå¹¶ä¸æ¯ç«å³å¯¹æç´¢å¯è§ï¼ä½ä¼å¨ä¸ç§ä¹ååä¸ºå¯è§ã\n\nè¿äºè¡ä¸ºå¯è½ä¼å¯¹æ°ç¨æ·é æå°æ: ä»ä»¬ç´¢å¼äºä¸ä¸ªææ¡£ç¶åå°è¯æç´¢å®ï¼ä½å´æ²¡ææå°ãè¿ä¸ªé®é¢çè§£å³åæ³æ¯ç¨ refresh API æ§è¡ä¸æ¬¡æå¨å·æ°:\n\nPOST /_refresh\nPOST /blogs/_refresh\n\n\nå·æ°ï¼Refreshï¼ææçç´¢å¼\n\nåªå·æ°ï¼Refreshï¼ blogs ç´¢å¼\n\n> å°½ç®¡å·æ°æ¯æ¯æäº¤è½»éå¾å¤çæä½ï¼å®è¿æ¯ä¼ææ§è½å¼éãå½åæµè¯çæ¶åï¼ æå¨å·æ°å¾æç¨ï¼ä½æ¯ä¸è¦å¨çäº§ç¯å¢ä¸æ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æå¨å·æ°ã ç¸åï¼ä½ çåºç¨éè¦æè¯å° Elasticsearch çè¿å®æ¶çæ§è´¨ï¼å¹¶æ¥åå®çä¸è¶³ã\n\nå¹¶ä¸æ¯ææçæåµé½éè¦æ¯ç§å·æ°ãå¯è½ä½ æ­£å¨ä½¿ç¨ Elasticsearch ç´¢å¼å¤§éçæ¥å¿æä»¶ï¼ ä½ å¯è½æ³ä¼åç´¢å¼éåº¦èä¸æ¯è¿å®æ¶æç´¢ï¼ å¯ä»¥éè¿è®¾ç½® refresh_interval ï¼ éä½æ¯ä¸ªç´¢å¼çå·æ°é¢çï¼\n\nPUT /my_logs\n{\n  "settings": {\n    "refresh_interval": "30s"\n  }\n}\n\n\n> æ¯ 30 ç§å·æ° my_logs ç´¢å¼ã\n\nrefresh_interval å¯ä»¥å¨æ¢å­ç´¢å¼ä¸è¿è¡å¨ææ´æ°ã å¨çäº§ç¯å¢ä¸­ï¼å½ä½ æ­£å¨å»ºç«ä¸ä¸ªå¤§çæ°ç´¢å¼æ¶ï¼å¯ä»¥åå³é­èªå¨å·æ°ï¼å¾å¼å§ä½¿ç¨è¯¥ç´¢å¼æ¶ï¼åæå®ä»¬è°åæ¥ï¼\n\nPUT /my_logs/_settings\n{ "refresh_interval": -1 }\n\nPUT /my_logs/_settings\n{ "refresh_interval": "1s" }\n\n\n * å³é­èªå¨å·æ°ã\n\n * æ¯ç§èªå¨å·æ°ã\n\n> refresh_interval éè¦ä¸ä¸ª æç»­æ¶é´ å¼ï¼ ä¾å¦ 1s ï¼1 ç§ï¼ æ 2m ï¼2 åéï¼ã ä¸ä¸ªç»å¯¹å¼ 1 è¡¨ç¤ºçæ¯ 1 æ¯«ç§ --æ çä¼ä½¿ä½ çéç¾¤é·å¥ç«çªã\n\n\n# 2.7. æä¹ååæ´\n\nå¦ææ²¡æç¨ fsync ææ°æ®ä»æä»¶ç³»ç»ç¼å­å·ï¼flushï¼å°ç¡¬çï¼æä»¬ä¸è½ä¿è¯æ°æ®å¨æ­çµçè³æ¯ç¨åºæ­£å¸¸éåºä¹åä¾ç¶å­å¨ãä¸ºäºä¿è¯ Elasticsearch çå¯é æ§ï¼éè¦ç¡®ä¿æ°æ®ååè¢«æä¹åå°ç£çã\n\nå¨ å¨ææ´æ°ç´¢å¼ï¼æä»¬è¯´ä¸æ¬¡å®æ´çæäº¤ä¼å°æ®µå·å°ç£çï¼å¹¶åå¥ä¸ä¸ªåå«æææ®µåè¡¨çæäº¤ç¹ãElasticsearch å¨å¯å¨æéæ°æå¼ä¸ä¸ªç´¢å¼çè¿ç¨ä¸­ä½¿ç¨è¿ä¸ªæäº¤ç¹æ¥å¤æ­åªäºæ®µé¶å±äºå½ååçã\n\nå³ä½¿éè¿æ¯ç§å·æ°ï¼refreshï¼å®ç°äºè¿å®æ¶æç´¢ï¼æä»¬ä»ç¶éè¦ç»å¸¸è¿è¡å®æ´æäº¤æ¥ç¡®ä¿è½ä»å¤±è´¥ä¸­æ¢å¤ãä½å¨ä¸¤æ¬¡æäº¤ä¹é´åçååçææ¡£æä¹åï¼æä»¬ä¹ä¸å¸æä¸¢å¤±æè¿äºæ°æ®ã\n\nElasticsearch å¢å äºä¸ä¸ª translog ï¼æèå«äºå¡æ¥å¿ï¼å¨æ¯ä¸æ¬¡å¯¹ Elasticsearch è¿è¡æä½æ¶åè¿è¡äºæ¥å¿è®°å½ãéè¿ translog ï¼æ´ä¸ªæµç¨çèµ·æ¥æ¯ä¸é¢è¿æ ·ï¼\n\nä¸ä¸ªææ¡£è¢«ç´¢å¼ä¹åï¼å°±ä¼è¢«æ·»å å°åå­ç¼å²åºï¼å¹¶ä¸ è¿½å å°äº translog ï¼æ­£å¦ Figure 21, âæ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿â æè¿°çä¸æ ·ã\n\nFigure 21. æ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿\n\n\n\nå·æ°ï¼refreshï¼ä½¿åçå¤äº Figure 22, âå·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼â æè¿°çç¶æï¼åçæ¯ç§è¢«å·æ°ï¼refreshï¼ä¸æ¬¡ï¼\n\n * è¿äºå¨åå­ç¼å²åºçææ¡£è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ä¸æ²¡æè¿è¡ fsync æä½ã\n * è¿ä¸ªæ®µè¢«æå¼ï¼ä½¿å¶å¯è¢«æç´¢ã\n * åå­ç¼å²åºè¢«æ¸ç©ºã\n\nFigure 22. å·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼\n\n\n\nè¿ä¸ªè¿ç¨ç»§ç»­å·¥ä½ï¼æ´å¤çææ¡£è¢«æ·»å å°åå­ç¼å²åºåè¿½å å°äºå¡æ¥å¿ï¼è§ Figure 23, âäºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£â ï¼ã\n\nFigure 23. äºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£\n\n\n\n 1. æ¯éä¸æ®µæ¶é´âä¾å¦ translog åå¾è¶æ¥è¶å¤§âç´¢å¼è¢«å·æ°ï¼flushï¼ï¼ä¸ä¸ªæ°ç translog è¢«åå»ºï¼å¹¶ä¸ä¸ä¸ªå¨éæäº¤è¢«æ§è¡ï¼è§ Figure 24, âå¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©ºâ ï¼ï¼\n    * ææå¨åå­ç¼å²åºçææ¡£é½è¢«åå¥ä¸ä¸ªæ°çæ®µã\n    * ç¼å²åºè¢«æ¸ç©ºã\n    * ä¸ä¸ªæäº¤ç¹è¢«åå¥ç¡¬çã\n    * æä»¶ç³»ç»ç¼å­éè¿ fsync è¢«å·æ°ï¼flushï¼ã\n    * èç translog è¢«å é¤ã\n\ntranslog æä¾ææè¿æ²¡æè¢«å·å°ç£ççæä½çä¸ä¸ªæä¹åçºªå½ãå½ Elasticsearch å¯å¨çæ¶åï¼ å®ä¼ä»ç£çä¸­ä½¿ç¨æåä¸ä¸ªæäº¤ç¹å»æ¢å¤å·²ç¥çæ®µï¼å¹¶ä¸ä¼éæ¾ translog ä¸­ææå¨æåä¸æ¬¡æäº¤ååççåæ´æä½ã\n\ntranslog ä¹è¢«ç¨æ¥æä¾å®æ¶ CRUD ãå½ä½ è¯çéè¿ ID æ¥è¯¢ãæ´æ°ãå é¤ä¸ä¸ªææ¡£ï¼å®ä¼å¨å°è¯ä»ç¸åºçæ®µä¸­æ£ç´¢ä¹åï¼ é¦åæ£æ¥ translog ä»»ä½æè¿çåæ´ãè¿æå³çå®æ»æ¯è½å¤å®æ¶å°è·åå°ææ¡£çææ°çæ¬ã\n\nFigure 24. å¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©º\n\n\n\n\n# 2.8. flush API\n\nè¿ä¸ªæ§è¡ä¸ä¸ªæäº¤å¹¶ä¸æªæ­ translog çè¡ä¸ºå¨ Elasticsearch è¢«ç§°ä½ä¸æ¬¡ flush ã åçæ¯ 30 åéè¢«èªå¨å·æ°ï¼flushï¼ï¼æèå¨ translog å¤ªå¤§çæ¶åä¹ä¼å·æ°ãè¯·æ¥ç translog ææ¡£ æ¥è®¾ç½®ï¼å®å¯ä»¥ç¨æ¥ æ§å¶è¿äºéå¼ï¼\n\nflush API å¯ä»¥è¢«ç¨æ¥æ§è¡ä¸ä¸ªæå·¥çå·æ°ï¼flushï¼:\n\nPOST /blogs/_flush\nPOST /_flush?wait_for_ongoing\n\n\n * å·æ°ï¼flushï¼ blogs ç´¢å¼ã\n * å·æ°ï¼flushï¼ææçç´¢å¼å¹¶ä¸å¹¶ä¸ç­å¾ææå·æ°å¨è¿ååå®æã\n\nä½ å¾å°éè¦èªå·±æå¨æ§è¡ flush æä½ï¼éå¸¸æåµä¸ï¼èªå¨å·æ°å°±è¶³å¤äºã\n\nè¿å°±æ¯è¯´ï¼å¨éå¯èç¹æå³é­ç´¢å¼ä¹åæ§è¡ flush æçäºä½ çç´¢å¼ãå½ Elasticsearch å°è¯æ¢å¤æéæ°æå¼ä¸ä¸ªç´¢å¼ï¼ å®éè¦éæ¾ translog ä¸­ææçæä½ï¼æä»¥å¦ææ¥å¿è¶ç­ï¼æ¢å¤è¶å¿«ã\n\n> translog çç®çæ¯ä¿è¯æä½ä¸ä¼ä¸¢å¤±ãè¿å¼åºäºè¿ä¸ªé®é¢ï¼ Translog æå¤å®å¨ï¼\n> \n> å¨æä»¶è¢« fsync å°ç£çåï¼è¢«åå¥çæä»¶å¨éå¯ä¹åå°±ä¼ä¸¢å¤±ãé»è®¤ translog æ¯æ¯ 5 ç§è¢« fsync å·æ°å°ç¡¬çï¼ æèå¨æ¯æ¬¡åè¯·æ±å®æä¹åæ§è¡(e.g. index, delete, update, bulk)ãè¿ä¸ªè¿ç¨å¨ä¸»åçåå¤å¶åçé½ä¼åçãæç»ï¼ åºæ¬ä¸ï¼è¿æå³çå¨æ´ä¸ªè¯·æ±è¢« fsync å°ä¸»åçåå¤å¶åçç translog ä¹åï¼ä½ çå®¢æ·ç«¯ä¸ä¼å¾å°ä¸ä¸ª 200 OK ååºã\n> \n> å¨æ¯æ¬¡è¯·æ±åé½æ§è¡ä¸ä¸ª fsync ä¼å¸¦æ¥ä¸äºæ§è½æå¤±ï¼å°½ç®¡å®è·µè¡¨æè¿ç§æå¤±ç¸å¯¹è¾å°ï¼ç¹å«æ¯ bulk å¯¼å¥ï¼å®å¨ä¸æ¬¡è¯·æ±ä¸­å¹³æäºå¤§éææ¡£çå¼éï¼ã\n> \n> ä½æ¯å¯¹äºä¸äºå¤§å®¹éçå¶å°ä¸¢å¤±å ç§æ°æ®é®é¢ä¹å¹¶ä¸ä¸¥éçéç¾¤ï¼ä½¿ç¨å¼æ­¥ç fsync è¿æ¯æ¯è¾æççãæ¯å¦ï¼åå¥çæ°æ®è¢«ç¼å­å°åå­ä¸­ï¼åæ¯ 5 ç§æ§è¡ä¸æ¬¡ fsync ã\n> \n> è¿ä¸ªè¡ä¸ºå¯ä»¥éè¿è®¾ç½® durability åæ°ä¸º async æ¥å¯ç¨ï¼\n> \n> PUT /my_index/_settings\n> {\n>     "index.translog.durability": "async",\n>     "index.translog.sync_interval": "5s"\n> }\n> \n> \n> è¿ä¸ªéé¡¹å¯ä»¥éå¯¹ç´¢å¼åç¬è®¾ç½®ï¼å¹¶ä¸å¯ä»¥å¨æè¿è¡ä¿®æ¹ãå¦æä½ å³å®ä½¿ç¨å¼æ­¥ translog çè¯ï¼ä½ éè¦ ä¿è¯ å¨åç crash æ¶ï¼ä¸¢å¤±æ sync_interval æ¶é´æ®µçæ°æ®ä¹æ æè°ãè¯·å¨å³å®åç¥æè¿ä¸ªç¹æ§ã\n> \n> å¦æä½ ä¸ç¡®å®è¿ä¸ªè¡ä¸ºçåæï¼æå¥½æ¯ä½¿ç¨é»è®¤çåæ°ï¼ "index.translog.durability": "request" ï¼æ¥é¿åæ°æ®ä¸¢å¤±ã\n\n\n# 2.9. æ®µåå¹¶\n\nç±äºèªå¨å·æ°æµç¨æ¯ç§ä¼åå»ºä¸ä¸ªæ°çæ®µ ï¼è¿æ ·ä¼å¯¼è´ç­æ¶é´åçæ®µæ°éæ´å¢ãèæ®µæ°ç®å¤ªå¤ä¼å¸¦æ¥è¾å¤§çéº»ç¦ã æ¯ä¸ä¸ªæ®µé½ä¼æ¶èæä»¶å¥æãåå­å cpu è¿è¡å¨æãæ´éè¦çæ¯ï¼æ¯ä¸ªæç´¢è¯·æ±é½å¿é¡»è½®æµæ£æ¥æ¯ä¸ªæ®µï¼æä»¥æ®µè¶å¤ï¼æç´¢ä¹å°±è¶æ¢ã\n\nElasticsearch éè¿å¨åå°è¿è¡æ®µåå¹¶æ¥è§£å³è¿ä¸ªé®é¢ãå°çæ®µè¢«åå¹¶å°å¤§çæ®µï¼ç¶åè¿äºå¤§çæ®µåè¢«åå¹¶å°æ´å¤§çæ®µã\n\næ®µåå¹¶çæ¶åä¼å°é£äºæ§çå·²å é¤ææ¡£ä»æä»¶ç³»ç»ä¸­æ¸é¤ãè¢«å é¤çææ¡£ï¼æè¢«æ´æ°ææ¡£çæ§çæ¬ï¼ä¸ä¼è¢«æ·è´å°æ°çå¤§æ®µä¸­ã\n\nå¯å¨æ®µåå¹¶ä¸éè¦ä½ åä»»ä½äºãè¿è¡ç´¢å¼åæç´¢æ¶ä¼èªå¨è¿è¡ãè¿ä¸ªæµç¨åå¨ Figure 25, âä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µâ ä¸­æå°çä¸æ ·å·¥ä½ï¼\n\n1ã å½ç´¢å¼çæ¶åï¼å·æ°ï¼refreshï¼æä½ä¼åå»ºæ°çæ®µå¹¶å°æ®µæå¼ä»¥ä¾æç´¢ä½¿ç¨ã\n\n2ã åå¹¶è¿ç¨éæ©ä¸å°é¨åå¤§å°ç¸ä¼¼çæ®µï¼å¹¶ä¸å¨åå°å°å®ä»¬åå¹¶å°æ´å¤§çæ®µä¸­ãè¿å¹¶ä¸ä¼ä¸­æ­ç´¢å¼åæç´¢ã\n\nFigure 25. ä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µ\n\n\n\nFigure 26, âä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤â è¯´æåå¹¶å®ææ¶çæ´»å¨ï¼\n\n * æ°çæ®µè¢«å·æ°ï¼flushï¼å°äºç£çã ** åå¥ä¸ä¸ªåå«æ°æ®µä¸æé¤æ§çåè¾å°çæ®µçæ°æäº¤ç¹ã\n * æ°çæ®µè¢«æå¼ç¨æ¥æç´¢ã\n * èçæ®µè¢«å é¤ã\n\nFigure 26. ä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤\n\n\n\nåå¹¶å¤§çæ®µéè¦æ¶èå¤§éç I/O å CPU èµæºï¼å¦æä»»å¶åå±ä¼å½±åæç´¢æ§è½ãElasticsearch å¨é»è®¤æåµä¸ä¼å¯¹åå¹¶æµç¨è¿è¡èµæºéå¶ï¼æä»¥æç´¢ä»ç¶ æè¶³å¤çèµæºå¾å¥½å°æ§è¡ã\n\n\n# 2.10. optimize API\n\noptimize API å¤§å¯çåæ¯ å¼ºå¶åå¹¶ APIãå®ä¼å°ä¸ä¸ªåçå¼ºå¶åå¹¶å° max_num_segments åæ°æå®å¤§å°çæ®µæ°ç®ã è¿æ ·åçæå¾æ¯åå°æ®µçæ°éï¼éå¸¸åå°å°ä¸ä¸ªï¼ï¼æ¥æåæç´¢æ§è½ã\n\n> optimize API ä¸åºè¯¥ è¢«ç¨å¨ä¸ä¸ªæ´»è·çç´¢å¼ââââä¸ä¸ªæ­£ç§¯ææ´æ°çç´¢å¼ãåå°åå¹¶æµç¨å·²ç»å¯ä»¥å¾å¥½å°å®æå·¥ä½ã optimizing ä¼é»ç¢è¿ä¸ªè¿ç¨ãä¸è¦å¹²æ°å®ï¼\n\nå¨ç¹å®æåµä¸ï¼ä½¿ç¨ optimize API é¢æçå¤ãä¾å¦å¨æ¥å¿è¿ç§ç¨ä¾ä¸ï¼æ¯å¤©ãæ¯å¨ãæ¯æçæ¥å¿è¢«å­å¨å¨ä¸ä¸ªç´¢å¼ä¸­ã èçç´¢å¼å®è´¨ä¸æ¯åªè¯»çï¼å®ä»¬ä¹å¹¶ä¸å¤ªå¯è½ä¼åçååã\n\nå¨è¿ç§æåµä¸ï¼ä½¿ç¨ optimize ä¼åèçç´¢å¼ï¼å°æ¯ä¸ä¸ªåçåå¹¶ä¸ºä¸ä¸ªåç¬çæ®µå°±å¾æç¨äºï¼è¿æ ·æ¢å¯ä»¥èçèµæºï¼ä¹å¯ä»¥ä½¿æç´¢æ´å å¿«éï¼\n\nPOST /logstash-2014-10/_optimize?max_num_segments=1\n\n\nåå¹¶ç´¢å¼ä¸­çæ¯ä¸ªåçä¸ºä¸ä¸ªåç¬çæ®µ\n\n> è¯·æ³¨æï¼ä½¿ç¨ optimize API è§¦åæ®µåå¹¶çæä½ä¸ä¼åå°ä»»ä½èµæºä¸çéå¶ãè¿å¯è½ä¼æ¶èæä½ èç¹ä¸å¨é¨ç I/O èµæº, ä½¿å¶æ²¡æä½è£æ¥å¤çæç´¢è¯·æ±ï¼ä»èæå¯è½ä½¿éç¾¤å¤±å»ååºã å¦æä½ æ³è¦å¯¹ç´¢å¼æ§è¡ optimizeï¼ä½ éè¦åä½¿ç¨åçåéï¼æ¥ç è¿ç§»æ§ç´¢å¼ï¼æç´¢å¼ç§»å°ä¸ä¸ªå®å¨çèç¹ï¼åæ§è¡ã\n\n\n# 3. åèèµæ\n\n * Elasticsearch å®æ¹ææ¡£ä¹ éç¾¤åçåç',normalizedContent:'# elasticsearch éç¾¤ååç\n\n * 1. éç¾¤\n   * 1.1. ç©ºéç¾¤\n   * 1.2. éç¾¤å¥åº·\n   * 1.3. æ·»å ç´¢å¼\n   * 1.4. æ·»å æéè½¬ç§»\n   * 1.5. æ°´å¹³æ©å®¹\n   * 1.6. æ´å¤çæ©å®¹\n   * 1.7. åºå¯¹æé\n * 2. åç\n   * 2.1. ä½¿ææ¬å¯è¢«æç´¢\n   * 2.2. ä¸åæ§\n   * 2.3. å¨ææ´æ°ç´¢å¼\n   * 2.4. å é¤åæ´æ°\n   * 2.5. è¿å®æ¶æç´¢\n   * 2.6. refresh api\n   * 2.7. æä¹ååæ´\n   * 2.8. flush api\n   * 2.9. æ®µåå¹¶\n   * 2.10. optimize api\n * 3. åèèµæ\n\n\n# 1. éç¾¤\n\n\n# 1.1. ç©ºéç¾¤\n\nå¦ææä»¬å¯å¨äºä¸ä¸ªåç¬çèç¹ï¼éé¢ä¸åå«ä»»ä½çæ°æ®åç´¢å¼ï¼é£æä»¬çéç¾¤çèµ·æ¥å°±æ¯ä¸ä¸ªåå«ç©ºåå®¹èç¹çéç¾¤ã\n\nfigure 1. åå«ç©ºåå®¹èç¹çéç¾¤\n\n\n\nå¾ 1ï¼åªæä¸ä¸ªç©ºèç¹çéç¾¤\n\nä¸ä¸ªè¿è¡ä¸­ç elasticsearch å®ä¾ç§°ä¸ºä¸ä¸ªèç¹ï¼èéç¾¤æ¯ç±ä¸ä¸ªæèå¤ä¸ªæ¥æç¸å cluster.name éç½®çèç¹ç»æï¼ å®ä»¬å±åæ¿ææ°æ®åè´è½½çååãå½æèç¹å å¥éç¾¤ä¸­æèä»éç¾¤ä¸­ç§»é¤èç¹æ¶ï¼éç¾¤å°ä¼éæ°å¹³ååå¸ææçæ°æ®ã\n\nå½ä¸ä¸ªèç¹è¢«éä¸¾æä¸ºä¸»èç¹æ¶ï¼ å®å°è´è´£ç®¡çéç¾¤èå´åçææåæ´ï¼ä¾å¦å¢å ãå é¤ç´¢å¼ï¼æèå¢å ãå é¤èç¹ç­ã èä¸»èç¹å¹¶ä¸éè¦æ¶åå°ææ¡£çº§å«çåæ´åæç´¢ç­æä½ï¼æä»¥å½éç¾¤åªæ¥æä¸ä¸ªä¸»èç¹çæåµä¸ï¼å³ä½¿æµéçå¢å å®ä¹ä¸ä¼æä¸ºç¶é¢ã ä»»ä½èç¹é½å¯ä»¥æä¸ºä¸»èç¹ãæä»¬çç¤ºä¾éç¾¤å°±åªæä¸ä¸ªèç¹ï¼æä»¥å®åæ¶ä¹æä¸ºäºä¸»èç¹ã\n\nä½ä¸ºç¨æ·ï¼æä»¬å¯ä»¥å°è¯·æ±åéå°éç¾¤ä¸­çä»»ä½èç¹ï¼åæ¬ä¸»èç¹ã æ¯ä¸ªèç¹é½ç¥éä»»æææ¡£æå¤çä½ç½®ï¼å¹¶ä¸è½å¤å°æä»¬çè¯·æ±ç´æ¥è½¬åå°å­å¨æä»¬æéææ¡£çèç¹ã æ è®ºæä»¬å°è¯·æ±åéå°åªä¸ªèç¹ï¼å®é½è½è´è´£ä»åä¸ªåå«æä»¬æéææ¡£çèç¹æ¶éåæ°æ®ï¼å¹¶å°æç»ç»æè¿åçµ¦å®¢æ·ç«¯ã elasticsearch å¯¹è¿ä¸åçç®¡çé½æ¯éæçã\n\n\n# 1.2. éç¾¤å¥åº·\n\nelasticsearch çéç¾¤çæ§ä¿¡æ¯ä¸­åå«äºè®¸å¤çç»è®¡æ°æ®ï¼å¶ä¸­æä¸ºéè¦çä¸é¡¹å°±æ¯ éç¾¤å¥åº· ï¼ å®å¨ status å­æ®µä¸­å±ç¤ºä¸º green ã yellow æè red ã\n\nget /_cluster/health\n\n\nå¨ä¸ä¸ªä¸åå«ä»»ä½ç´¢å¼çç©ºéç¾¤ä¸­ï¼å®å°ä¼æä¸ä¸ªç±»ä¼¼äºå¦ä¸æç¤ºçè¿ååå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 0,\n  "active_shards": 0,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0\n}\n\n\nstatus å­æ®µæç¤ºçå½åéç¾¤å¨æ»ä½ä¸æ¯å¦å·¥ä½æ­£å¸¸ãå®çä¸ç§é¢è²å«ä¹å¦ä¸ï¼\n\n * greenï¼ææçä¸»åçåå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * yellowï¼ææçä¸»åçé½æ­£å¸¸è¿è¡ï¼ä½ä¸æ¯ææçå¯æ¬åçé½æ­£å¸¸è¿è¡ã\n * redï¼æä¸»åçæ²¡è½æ­£å¸¸è¿è¡ã\n\n\n# 1.3. æ·»å ç´¢å¼\n\næä»¬å¾ elasticsearch æ·»å æ°æ®æ¶éè¦ç¨å° ç´¢å¼ ââ ä¿å­ç¸å³æ°æ®çå°æ¹ãç´¢å¼å®éä¸æ¯æåä¸ä¸ªæèå¤ä¸ªç©çåççé»è¾å½åç©ºé´ ã\n\nä¸ä¸ª åç æ¯ä¸ä¸ªåºå±ç å·¥ä½åå ï¼å®ä»ä¿å­äºå¨é¨æ°æ®ä¸­çä¸é¨åãç°å¨æä»¬åªéç¥éä¸ä¸ªåçæ¯ä¸ä¸ª lucene çå®ä¾ï¼ä»¥åå®æ¬èº«å°±æ¯ä¸ä¸ªå®æ´çæç´¢å¼æã æä»¬çææ¡£è¢«å­å¨åç´¢å¼å°åçåï¼ä½æ¯åºç¨ç¨åºæ¯ç´æ¥ä¸ç´¢å¼èä¸æ¯ä¸åçè¿è¡äº¤äºã\n\nelasticsearch æ¯å©ç¨åçå°æ°æ®ååå°éç¾¤ååå¤çãåçæ¯æ°æ®çå®¹å¨ï¼ææ¡£ä¿å­å¨åçåï¼åçåè¢«åéå°éç¾¤åçåä¸ªèç¹éã å½ä½ çéç¾¤è§æ¨¡æ©å¤§æèç¼©å°æ¶ï¼ elasticsearch ä¼èªå¨çå¨åèç¹ä¸­è¿ç§»åçï¼ä½¿å¾æ°æ®ä»ç¶åååå¸å¨éç¾¤éã\n\nä¸ä¸ªåçå¯ä»¥æ¯ ä¸» åçæè å¯æ¬ åçã ç´¢å¼åä»»æä¸ä¸ªææ¡£é½å½å±äºä¸ä¸ªä¸»åçï¼æä»¥ä¸»åççæ°ç®å³å®çç´¢å¼è½å¤ä¿å­çæå¤§æ°æ®éã\n\n> ææ¯ä¸æ¥è¯´ï¼ä¸ä¸ªä¸»åçæå¤§è½å¤å­å¨ integer.max_value - 128 ä¸ªææ¡£ï¼ä½æ¯å®éæå¤§å¼è¿éè¦åèä½ çä½¿ç¨åºæ¯ï¼åæ¬ä½ ä½¿ç¨çç¡¬ä»¶ï¼ ææ¡£çå¤§å°åå¤æç¨åº¦ï¼ç´¢å¼åæ¥è¯¢ææ¡£çæ¹å¼ä»¥åä½ ææçååºæ¶é¿ã\n\nä¸ä¸ªå¯æ¬åçåªæ¯ä¸ä¸ªä¸»åççæ·è´ãå¯æ¬åçä½ä¸ºç¡¬ä»¶æéæ¶ä¿æ¤æ°æ®ä¸ä¸¢å¤±çåä½å¤ä»½ï¼å¹¶ä¸ºæç´¢åè¿åææ¡£ç­è¯»æä½æä¾æå¡ã\n\nå¨ç´¢å¼å»ºç«çæ¶åå°±å·²ç»ç¡®å®äºä¸»åçæ°ï¼ä½æ¯å¯æ¬åçæ°å¯ä»¥éæ¶ä¿®æ¹ã\n\nè®©æä»¬å¨åå«ä¸ä¸ªç©ºèç¹çéç¾¤ååå»ºåä¸º blogs çç´¢å¼ã ç´¢å¼å¨é»è®¤æåµä¸ä¼è¢«åé 5 ä¸ªä¸»åçï¼ ä½æ¯ä¸ºäºæ¼ç¤ºç®çï¼æä»¬å°åé 3 ä¸ªä¸»åçåä¸ä»½å¯æ¬ï¼æ¯ä¸ªä¸»åçæ¥æä¸ä¸ªå¯æ¬åçï¼ï¼\n\nput /blogs\n{\n   "settings" : {\n      "number_of_shards" : 3,\n      "number_of_replicas" : 1\n   }\n}\n\n\næä»¬çéç¾¤ç°å¨æ¯ æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤ãææ 3 ä¸ªä¸»åçé½è¢«åéå¨ node 1 ã\n\nfigure 2. æ¥æä¸ä¸ªç´¢å¼çåèç¹éç¾¤\n\n\n\nå¦ææä»¬ç°å¨æ¥çéç¾¤å¥åº·ï¼æä»¬å°çå°å¦ä¸åå®¹ï¼\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "yellow",\n  "timed_out": false,\n  "number_of_nodes": 1,\n  "number_of_data_nodes": 1,\n  "active_primary_shards": 3,\n  "active_shards": 3,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 3,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 50\n}\n\n\n * éç¾¤ status å¼ä¸º yellow\n * æ²¡æè¢«åéå°ä»»ä½èç¹çå¯æ¬æ°\n\néç¾¤çå¥åº·ç¶åµä¸º yellow åè¡¨ç¤ºå¨é¨ ä¸» åçé½æ­£å¸¸è¿è¡ï¼éç¾¤å¯ä»¥æ­£å¸¸æå¡ææè¯·æ±ï¼ï¼ä½æ¯ å¯æ¬ åçæ²¡æå¨é¨å¤å¨æ­£å¸¸ç¶æã å®éä¸ï¼ææ 3 ä¸ªå¯æ¬åçé½æ¯ unassigned ââ å®ä»¬é½æ²¡æè¢«åéå°ä»»ä½èç¹ã å¨åä¸ä¸ªèç¹ä¸æ¢ä¿å­åå§æ°æ®åä¿å­å¯æ¬æ¯æ²¡ææä¹çï¼å ä¸ºä¸æ¦å¤±å»äºé£ä¸ªèç¹ï¼æä»¬ä¹å°ä¸¢å¤±è¯¥èç¹ä¸çææå¯æ¬æ°æ®ã\n\nå½åæä»¬çéç¾¤æ¯æ­£å¸¸è¿è¡çï¼ä½æ¯å¨ç¡¬ä»¶æéæ¶æä¸¢å¤±æ°æ®çé£é©ã\n\n\n# 1.4. æ·»å æéè½¬ç§»\n\nå½éç¾¤ä¸­åªæä¸ä¸ªèç¹å¨è¿è¡æ¶ï¼æå³çä¼æä¸ä¸ªåç¹æéé®é¢ââæ²¡æåä½ã å¹¸è¿çæ¯ï¼æä»¬åªéåå¯å¨ä¸ä¸ªèç¹å³å¯é²æ­¢æ°æ®ä¸¢å¤±ã\n\n> ä¸ºäºæµè¯ç¬¬äºä¸ªèç¹å¯å¨åçæåµï¼ä½ å¯ä»¥å¨åä¸ä¸ªç®å½åï¼å®å¨ä¾ç§å¯å¨ç¬¬ä¸ä¸ªèç¹çæ¹å¼æ¥å¯å¨ä¸ä¸ªæ°èç¹ï¼åèå®è£å¹¶è¿è¡ elasticsearchï¼ãå¤ä¸ªèç¹å¯ä»¥å±äº«åä¸ä¸ªç®å½ã\n> \n> å½ä½ å¨åä¸å°æºå¨ä¸å¯å¨äºç¬¬äºä¸ªèç¹æ¶ï¼åªè¦å®åç¬¬ä¸ä¸ªèç¹æåæ ·ç cluster.name éç½®ï¼å®å°±ä¼èªå¨åç°éç¾¤å¹¶å å¥å°å¶ä¸­ã ä½æ¯å¨ä¸åæºå¨ä¸å¯å¨èç¹çæ¶åï¼ä¸ºäºå å¥å°åä¸éç¾¤ï¼ä½ éè¦éç½®ä¸ä¸ªå¯è¿æ¥å°çåæ­ä¸»æºåè¡¨ã\n\nå¦æå¯å¨äºç¬¬äºä¸ªèç¹ï¼æä»¬çéç¾¤å°ä¼æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åéã\n\nfigure 3. æ¥æä¸¤ä¸ªèç¹çéç¾¤ââææä¸»åçåå¯æ¬åçé½å·²è¢«åé\n\n\n\nå½ç¬¬äºä¸ªèç¹å å¥å°éç¾¤åï¼3 ä¸ª å¯æ¬åç å°ä¼åéå°è¿ä¸ªèç¹ä¸ââæ¯ä¸ªä¸»åçå¯¹åºä¸ä¸ªå¯æ¬åçã è¿æå³çå½éç¾¤åä»»ä½ä¸ä¸ªèç¹åºç°é®é¢æ¶ï¼æä»¬çæ°æ®é½å®å¥½æ æã\n\næææ°è¿è¢«ç´¢å¼çææ¡£é½å°ä¼ä¿å­å¨ä¸»åçä¸ï¼ç¶åè¢«å¹¶è¡çå¤å¶å°å¯¹åºçå¯æ¬åçä¸ãè¿å°±ä¿è¯äºæä»¬æ¢å¯ä»¥ä»ä¸»åçåå¯ä»¥ä»å¯æ¬åçä¸è·å¾ææ¡£ã\n\ncluster-health ç°å¨å±ç¤ºçç¶æä¸º green ï¼è¿è¡¨ç¤ºææ 6 ä¸ªåçï¼åæ¬ 3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼é½å¨æ­£å¸¸è¿è¡ã\n\n{\n  "cluster_name": "elasticsearch",\n  "status": "green",\n  "timed_out": false,\n  "number_of_nodes": 2,\n  "number_of_data_nodes": 2,\n  "active_primary_shards": 3,\n  "active_shards": 6,\n  "relocating_shards": 0,\n  "initializing_shards": 0,\n  "unassigned_shards": 0,\n  "delayed_unassigned_shards": 0,\n  "number_of_pending_tasks": 0,\n  "number_of_in_flight_fetch": 0,\n  "task_max_waiting_in_queue_millis": 0,\n  "active_shards_percent_as_number": 100\n}\n\n\n * éç¾¤ status å¼ä¸º green\n\næä»¬çéç¾¤ç°å¨ä¸ä»ä»æ¯æ­£å¸¸è¿è¡çï¼å¹¶ä¸è¿å¤äº å§ç»å¯ç¨ çç¶æã\n\n\n# 1.5. æ°´å¹³æ©å®¹\n\nææ ·ä¸ºæä»¬çæ­£å¨å¢é¿ä¸­çåºç¨ç¨åºæéæ©å®¹å¢ï¼ å½å¯å¨äºç¬¬ä¸ä¸ªèç¹ï¼æä»¬çéç¾¤å°æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åéã\n\nfigure 4. æ¥æä¸ä¸ªèç¹çéç¾¤ââä¸ºäºåæ£è´è½½èå¯¹åçè¿è¡éæ°åé\n\n\n\nnode 1 å node 2 ä¸åæä¸ä¸ªåçè¢«è¿ç§»å°äºæ°ç node 3 èç¹ï¼ç°å¨æ¯ä¸ªèç¹ä¸é½æ¥æ 2 ä¸ªåçï¼èä¸æ¯ä¹åç 3 ä¸ªã è¿è¡¨ç¤ºæ¯ä¸ªèç¹çç¡¬ä»¶èµæºï¼cpu, ram, i/oï¼å°è¢«æ´å°çåçæå±äº«ï¼æ¯ä¸ªåççæ§è½å°ä¼å¾å°æåã\n\nåçæ¯ä¸ä¸ªåè½å®æ´çæç´¢å¼æï¼å®æ¥æä½¿ç¨ä¸ä¸ªèç¹ä¸çææèµæºçè½åã æä»¬è¿ä¸ªæ¥æ 6 ä¸ªåçï¼3 ä¸ªä¸»åçå 3 ä¸ªå¯æ¬åçï¼çç´¢å¼å¯ä»¥æå¤§æ©å®¹å° 6 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸å­å¨ä¸ä¸ªåçï¼å¹¶ä¸æ¯ä¸ªåçæ¥ææå¨èç¹çå¨é¨èµæºã\n\n\n# 1.6. æ´å¤çæ©å®¹\n\nä½æ¯å¦ææä»¬æ³è¦æ©å®¹è¶è¿ 6 ä¸ªèç¹æä¹åå¢ï¼\n\nä¸»åççæ°ç®å¨ç´¢å¼åå»ºæ¶å°±å·²ç»ç¡®å®äºä¸æ¥ãå®éä¸ï¼è¿ä¸ªæ°ç®å®ä¹äºè¿ä¸ªç´¢å¼è½å¤ å­å¨ çæå¤§æ°æ®éãï¼å®éå¤§å°åå³äºä½ çæ°æ®ãç¡¬ä»¶åä½¿ç¨åºæ¯ãï¼ ä½æ¯ï¼è¯»æä½ââæç´¢åè¿åæ°æ®ââå¯ä»¥åæ¶è¢«ä¸»åç æ å¯æ¬åçæå¤çï¼æä»¥å½ä½ æ¥æè¶å¤çå¯æ¬åçæ¶ï¼ä¹å°æ¥æè¶é«çååéã\n\nå¨è¿è¡ä¸­çéç¾¤ä¸æ¯å¯ä»¥å¨æè°æ´å¯æ¬åçæ°ç®çï¼æä»¬å¯ä»¥æéä¼¸ç¼©éç¾¤ãè®©æä»¬æå¯æ¬æ°ä»é»è®¤ç 1 å¢å å° 2 ï¼\n\nput /blogs/_settings\n{\n   "number_of_replicas" : 2\n}\n\n\nblogs ç´¢å¼ç°å¨æ¥æ 9 ä¸ªåçï¼3 ä¸ªä¸»åçå 6 ä¸ªå¯æ¬åçã è¿æå³çæä»¬å¯ä»¥å°éç¾¤æ©å®¹å° 9 ä¸ªèç¹ï¼æ¯ä¸ªèç¹ä¸ä¸ä¸ªåçãç¸æ¯åæ¥ 3 ä¸ªèç¹æ¶ï¼éç¾¤æç´¢æ§è½å¯ä»¥æå 3 åã\n\nfigure 5. å°åæ° number_of_replicas è°å¤§å° 2\n\n\n\n> å½ç¶ï¼å¦æåªæ¯å¨ç¸åèç¹æ°ç®çéç¾¤ä¸å¢å æ´å¤çå¯æ¬åçå¹¶ä¸è½æé«æ§è½ï¼å ä¸ºæ¯ä¸ªåçä»èç¹ä¸è·å¾çèµæºä¼åå°ã ä½ éè¦å¢å æ´å¤çç¡¬ä»¶èµæºæ¥æåååéã\n> \n> ä½æ¯æ´å¤çå¯æ¬åçæ°æé«äºæ°æ®åä½éï¼æç§ä¸é¢çèç¹éç½®ï¼æä»¬å¯ä»¥å¨å¤±å» 2 ä¸ªèç¹çæåµä¸ä¸ä¸¢å¤±ä»»ä½æ°æ®ã\n\n\n# 1.7. åºå¯¹æé\n\næä»¬ä¹åè¯´è¿ elasticsearch å¯ä»¥åºå¯¹èç¹æéï¼æ¥ä¸æ¥è®©æä»¬å°è¯ä¸è¿ä¸ªåè½ã å¦ææä»¬å³é­ç¬¬ä¸ä¸ªèç¹ï¼è¿æ¶éç¾¤çç¶æä¸ºå³é­äºä¸ä¸ªèç¹åçéç¾¤ã\n\nfigure 6. å³é­äºä¸ä¸ªèç¹åçéç¾¤\n\n\n\næä»¬å³é­çèç¹æ¯ä¸ä¸ªä¸»èç¹ãèéç¾¤å¿é¡»æ¥æä¸ä¸ªä¸»èç¹æ¥ä¿è¯æ­£å¸¸å·¥ä½ï¼æä»¥åççç¬¬ä¸ä»¶äºæå°±æ¯éä¸¾ä¸ä¸ªæ°çä¸»èç¹ï¼ node 2 ã\n\nå¨æä»¬å³é­ node 1 çåæ¶ä¹å¤±å»äºä¸»åç 1 å 2 ï¼å¹¶ä¸å¨ç¼ºå¤±ä¸»åççæ¶åç´¢å¼ä¹ä¸è½æ­£å¸¸å·¥ä½ã å¦ææ­¤æ¶æ¥æ£æ¥éç¾¤çç¶åµï¼æä»¬çå°çç¶æå°ä¼ä¸º red ï¼ä¸æ¯ææä¸»åçé½å¨æ­£å¸¸å·¥ä½ã\n\nå¹¸è¿çæ¯ï¼å¨å¶å®èç¹ä¸å­å¨çè¿ä¸¤ä¸ªä¸»åççå®æ´å¯æ¬ï¼ æä»¥æ°çä¸»èç¹ç«å³å°è¿äºåçå¨ node 2 å node 3 ä¸å¯¹åºçå¯æ¬åçæåä¸ºä¸»åçï¼ æ­¤æ¶éç¾¤çç¶æå°ä¼ä¸º yellow ã è¿ä¸ªæåä¸»åççè¿ç¨æ¯ç¬é´åççï¼å¦åæä¸ä¸ä¸ªå¼å³ä¸è¬ã\n\nä¸ºä»ä¹æä»¬éç¾¤ç¶ææ¯ yellow èä¸æ¯ green å¢ï¼ è½ç¶æä»¬æ¥æææçä¸ä¸ªä¸»åçï¼ä½æ¯åæ¶è®¾ç½®äºæ¯ä¸ªä¸»åçéè¦å¯¹åº 2 ä»½å¯æ¬åçï¼èæ­¤æ¶åªå­å¨ä¸ä»½å¯æ¬åçã æä»¥éç¾¤ä¸è½ä¸º green çç¶æï¼ä¸è¿æä»¬ä¸å¿è¿äºæå¿ï¼å¦ææä»¬åæ ·å³é­äº node 2 ï¼æä»¬çç¨åº ä¾ç¶ å¯ä»¥ä¿æå¨ä¸ä¸¢ä»»ä½æ°æ®çæåµä¸è¿è¡ï¼å ä¸º node 3 ä¸ºæ¯ä¸ä¸ªåçé½ä¿ççä¸ä»½å¯æ¬ã\n\nå¦ææä»¬éæ°å¯å¨ node 1 ï¼éç¾¤å¯ä»¥å°ç¼ºå¤±çå¯æ¬åçåæ¬¡è¿è¡åéï¼é£ä¹éç¾¤çç¶æä¹å°å¦ figure 5. å°åæ° number_of_replicas è°å¤§å° 2 æç¤ºã å¦æ node 1 ä¾ç¶æ¥æçä¹åçåçï¼å®å°å°è¯å»éç¨å®ä»¬ï¼åæ¶ä»ä»ä¸»åçå¤å¶åçäºä¿®æ¹çæ°æ®æä»¶ã\n\nå°ç®åä¸ºæ­¢ï¼ä½ åºè¯¥å¯¹åçå¦ä½ä½¿å¾ elasticsearch è¿è¡æ°´å¹³æ©å®¹ä»¥åæ°æ®ä¿éç­ç¥è¯æäºä¸å®äºè§£ã æ¥ä¸æ¥æä»¬å°è®²è¿°å³äºåççå½å¨æçæ´å¤ç»èã\n\n\n# 2. åç\n\n>  * ä¸ºä»ä¹æç´¢æ¯ è¿ å®æ¶çï¼\n>  * ä¸ºä»ä¹ææ¡£ç crud (åå»º-è¯»å-æ´æ°-å é¤) æä½æ¯ å®æ¶ ç?\n>  * elasticsearch æ¯ææ ·ä¿è¯æ´æ°è¢«æä¹åå¨æ­çµæ¶ä¹ä¸ä¸¢å¤±æ°æ®?\n>  * ä¸ºä»ä¹å é¤ææ¡£ä¸ä¼ç«å»éæ¾ç©ºé´ï¼\n>  * refresh, flush, å optimize api é½åäºä»ä¹, ä½ ä»ä¹æåµä¸åºè¯¥ä½¿ç¨ä»ä»¬ï¼\n\n\n# 2.1. ä½¿ææ¬å¯è¢«æç´¢\n\nå¿é¡»è§£å³çç¬¬ä¸ä¸ªæææ¯å¦ä½ä½¿ææ¬å¯è¢«æç´¢ã ä¼ ç»çæ°æ®åºæ¯ä¸ªå­æ®µå­å¨åä¸ªå¼ï¼ä½è¿å¯¹å¨ææ£ç´¢å¹¶ä¸å¤ãææ¬å­æ®µä¸­çæ¯ä¸ªåè¯éè¦è¢«æç´¢ï¼å¯¹æ°æ®åºæå³çéè¦åä¸ªå­æ®µæç´¢å¼å¤å¼(è¿éæåè¯)çè½åã\n\næå¥½çæ¯æ ä¸ä¸ªå­æ®µå¤ä¸ªå¼ éæ±çæ°æ®ç»ææ¯æä»¬å¨ åæç´¢å¼ ç« èä¸­ä»ç»è¿ç åæç´¢å¼ ã åæç´¢å¼åå«ä¸ä¸ªæåºåè¡¨ï¼åè¡¨åå«ææææ¡£åºç°è¿çä¸éå¤ä¸ªä½ï¼æç§°ä¸º è¯é¡¹ ï¼å¯¹äºæ¯ä¸ä¸ªè¯é¡¹ï¼åå«äºå®æææ¾åºç°è¿ææ¡£çåè¡¨ã\n\nterm  | doc 1 | doc 2 | doc 3 | ...\n------------------------------------\nbrown |   x   |       |  x    | ...\nfox   |   x   |   x   |  x    | ...\nquick |   x   |   x   |       | ...\nthe   |   x   |       |  x    | ...\n\n\n> å½è®¨è®ºåæç´¢å¼æ¶ï¼æä»¬ä¼è°å° ææ¡£ æ å¼ï¼å ä¸ºåå²åå ï¼åæç´¢å¼è¢«ç¨æ¥å¯¹æ´ä¸ªéç»æåææ¬ææ¡£è¿è¡æ å¼ã elasticsearch ä¸­ç ææ¡£ æ¯æå­æ®µåå¼çç»æå json ææ¡£ãäºå®ä¸ï¼å¨ json ææ¡£ä¸­ï¼ æ¯ä¸ªè¢«ç´¢å¼çå­æ®µé½æèªå·±çåæç´¢å¼ã\n\nè¿ä¸ªåæç´¢å¼ç¸æ¯ç¹å®è¯é¡¹åºç°è¿çææ¡£åè¡¨ï¼ä¼åå«æ´å¤å¶å®ä¿¡æ¯ãå®ä¼ä¿å­æ¯ä¸ä¸ªè¯é¡¹åºç°è¿çææ¡£æ»æ°ï¼ å¨å¯¹åºçææ¡£ä¸­ä¸ä¸ªå·ä½è¯é¡¹åºç°çæ»æ¬¡æ°ï¼è¯é¡¹å¨ææ¡£ä¸­çé¡ºåºï¼æ¯ä¸ªææ¡£çé¿åº¦ï¼ææææ¡£çå¹³åé¿åº¦ï¼ç­ç­ãè¿äºç»è®¡ä¿¡æ¯åè®¸ elasticsearch å³å®åªäºè¯æ¯å¶å®è¯æ´éè¦ï¼åªäºææ¡£æ¯å¶å®ææ¡£æ´éè¦ï¼è¿äºåå®¹å¨ ä»ä¹æ¯ç¸å³æ§? ä¸­ææè¿°ã\n\nä¸ºäºè½å¤å®ç°é¢æåè½ï¼åæç´¢å¼éè¦ç¥ééåä¸­ç ææ ææ¡£ï¼è¿æ¯éè¦è®¤è¯å°çå³é®é®é¢ã\n\næ©æçå¨ææ£ç´¢ä¼ä¸ºæ´ä¸ªææ¡£éåå»ºç«ä¸ä¸ªå¾å¤§çåæç´¢å¼å¹¶å°å¶åå¥å°ç£çã ä¸æ¦æ°çç´¢å¼å°±ç»ªï¼æ§çå°±ä¼è¢«å¶æ¿æ¢ï¼è¿æ ·æè¿çååä¾¿å¯ä»¥è¢«æ£ç´¢å°ã\n\n\n# 2.2. ä¸åæ§\n\nåæç´¢å¼è¢«åå¥ç£çåæ¯ ä¸å¯æ¹å ç:å®æ°¸è¿ä¸ä¼ä¿®æ¹ã ä¸åæ§æéè¦çä»·å¼ï¼\n\n * ä¸éè¦éãå¦æä½ ä»æ¥ä¸æ´æ°ç´¢å¼ï¼ä½ å°±ä¸éè¦æå¿å¤è¿ç¨åæ¶ä¿®æ¹æ°æ®çé®é¢ã\n * ä¸æ¦ç´¢å¼è¢«è¯»å¥åæ ¸çæä»¶ç³»ç»ç¼å­ï¼ä¾¿ä¼çå¨åªéï¼ç±äºå¶ä¸åæ§ãåªè¦æä»¶ç³»ç»ç¼å­ä¸­è¿æè¶³å¤çç©ºé´ï¼é£ä¹å¤§é¨åè¯»è¯·æ±ä¼ç´æ¥è¯·æ±åå­ï¼èä¸ä¼å½ä¸­ç£çãè¿æä¾äºå¾å¤§çæ§è½æåã\n * å¶å®ç¼å­(å filter ç¼å­)ï¼å¨ç´¢å¼ççå½å¨æåå§ç»ææãå®ä»¬ä¸éè¦å¨æ¯æ¬¡æ°æ®æ¹åæ¶è¢«éå»ºï¼å ä¸ºæ°æ®ä¸ä¼ååã\n * åå¥åä¸ªå¤§çåæç´¢å¼åè®¸æ°æ®è¢«åç¼©ï¼åå°ç£ç i/o å éè¦è¢«ç¼å­å°åå­çç´¢å¼çä½¿ç¨éã\n\nå½ç¶ï¼ä¸ä¸ªä¸åçç´¢å¼ä¹æä¸å¥½çå°æ¹ãä¸»è¦äºå®æ¯å®æ¯ä¸å¯åç! ä½ ä¸è½ä¿®æ¹å®ãå¦æä½ éè¦è®©ä¸ä¸ªæ°çææ¡£ å¯è¢«æç´¢ï¼ä½ éè¦éå»ºæ´ä¸ªç´¢å¼ãè¿è¦ä¹å¯¹ä¸ä¸ªç´¢å¼æè½åå«çæ°æ®éé æäºå¾å¤§çéå¶ï¼è¦ä¹å¯¹ç´¢å¼å¯è¢«æ´æ°çé¢çé æäºå¾å¤§çéå¶ã\n\n\n# 2.3. å¨ææ´æ°ç´¢å¼\n\nä¸ä¸ä¸ªéè¦è¢«è§£å³çé®é¢æ¯ææ ·å¨ä¿çä¸åæ§çåæä¸å®ç°åæç´¢å¼çæ´æ°ï¼ç­æ¡æ¯: ç¨æ´å¤çç´¢å¼ã\n\néè¿å¢å æ°çè¡¥åç´¢å¼æ¥åæ æ°è¿çä¿®æ¹ï¼èä¸æ¯ç´æ¥éåæ´ä¸ªåæç´¢å¼ãæ¯ä¸ä¸ªåæç´¢å¼é½ä¼è¢«è½®æµæ¥è¯¢å°âä»ææ©çå¼å§âæ¥è¯¢å®ååå¯¹ç»æè¿è¡åå¹¶ã\n\nelasticsearch åºäº lucene, è¿ä¸ª java åºå¼å¥äº ææ®µæç´¢ çæ¦å¿µã æ¯ä¸ æ®µ æ¬èº«é½æ¯ä¸ä¸ªåæç´¢å¼ï¼ ä½ ç´¢å¼ å¨ lucene ä¸­é¤è¡¨ç¤ºææ æ®µ çéåå¤ï¼ è¿å¢å äº æäº¤ç¹ çæ¦å¿µ â ä¸ä¸ªååºäºææå·²ç¥æ®µçæä»¶ï¼å°±åå¨ figure 16, âä¸ä¸ª lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µâ ä¸­æç»çé£æ ·ã å¦ figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç lucene ç´¢å¼â æç¤ºï¼æ°çææ¡£é¦åè¢«æ·»å å°åå­ç´¢å¼ç¼å­ä¸­ï¼ç¶ååå¥å°ä¸ä¸ªåºäºç£ççæ®µï¼å¦ figure 18, âå¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºãâ æç¤ºã\n\nfigure 16. ä¸ä¸ª lucene ç´¢å¼åå«ä¸ä¸ªæäº¤ç¹åä¸ä¸ªæ®µ\n\n\n\n> è¢«æ··æ·çæ¦å¿µæ¯ï¼ä¸ä¸ª lucene ç´¢å¼ æä»¬å¨ elasticsearch ç§°ä½ åç ã ä¸ä¸ª elasticsearch ç´¢å¼ æ¯åççéåã å½ elasticsearch å¨ç´¢å¼ä¸­æç´¢çæ¶åï¼ ä»åéæ¥è¯¢å°æ¯ä¸ä¸ªå±äºç´¢å¼çåç(lucene ç´¢å¼)ï¼ç¶åå æ§è¡åå¸å¼æ£ç´¢ æå°çé£æ ·ï¼åå¹¶æ¯ä¸ªåççç»æå°ä¸ä¸ªå¨å±çç»æéã\n\néæ®µæç´¢ä¼ä»¥å¦ä¸æµç¨è¿è¡å·¥ä½ï¼\n\n 1. æ°ææ¡£è¢«æ¶éå°åå­ç´¢å¼ç¼å­ï¼ è§ figure 17, âä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç lucene ç´¢å¼â ã\n 2. ä¸æ¶å°, ç¼å­è¢« æäº¤ ï¼\n    * ä¸ä¸ªæ°çæ®µâä¸ä¸ªè¿½å çåæç´¢å¼âè¢«åå¥ç£çã\n    * ä¸ä¸ªæ°çåå«æ°æ®µåå­ç æäº¤ç¹ è¢«åå¥ç£çã\n    * ç£çè¿è¡ åæ­¥ â ææå¨æä»¶ç³»ç»ç¼å­ä¸­ç­å¾çåå¥é½å·æ°å°ç£çï¼ä»¥ç¡®ä¿å®ä»¬è¢«åå¥ç©çæä»¶ã\n 3. æ°çæ®µè¢«å¼å¯ï¼è®©å®åå«çææ¡£å¯è§ä»¥è¢«æç´¢ã\n 4. åå­ç¼å­è¢«æ¸ç©ºï¼ç­å¾æ¥æ¶æ°çææ¡£ã\n\nfigure 17. ä¸ä¸ªå¨åå­ç¼å­ä¸­åå«æ°ææ¡£ç lucene ç´¢å¼\n\n\n\nfigure 18. å¨ä¸æ¬¡æäº¤åï¼ä¸ä¸ªæ°çæ®µè¢«æ·»å å°æäº¤ç¹èä¸ç¼å­è¢«æ¸ç©ºã\n\n\n\nå½ä¸ä¸ªæ¥è¯¢è¢«è§¦åï¼ææå·²ç¥çæ®µæé¡ºåºè¢«æ¥è¯¢ãè¯é¡¹ç»è®¡ä¼å¯¹æææ®µçç»æè¿è¡èåï¼ä»¥ä¿è¯æ¯ä¸ªè¯åæ¯ä¸ªææ¡£çå³èé½è¢«åç¡®è®¡ç®ã è¿ç§æ¹å¼å¯ä»¥ç¨ç¸å¯¹è¾ä½çææ¬å°æ°ææ¡£æ·»å å°ç´¢å¼ã\n\n\n# 2.4. å é¤åæ´æ°\n\næ®µæ¯ä¸å¯æ¹åçï¼æä»¥æ¢ä¸è½ä»æææ¡£ä»æ§çæ®µä¸­ç§»é¤ï¼ä¹ä¸è½ä¿®æ¹æ§çæ®µæ¥è¿è¡åæ ææ¡£çæ´æ°ã åèä»£ä¹çæ¯ï¼æ¯ä¸ªæäº¤ç¹ä¼åå«ä¸ä¸ª .del æä»¶ï¼æä»¶ä¸­ä¼ååºè¿äºè¢«å é¤ææ¡£çæ®µä¿¡æ¯ã\n\nå½ä¸ä¸ªææ¡£è¢« âå é¤â æ¶ï¼å®å®éä¸åªæ¯å¨ .del æä»¶ä¸­è¢« æ è®° å é¤ãä¸ä¸ªè¢«æ è®°å é¤çææ¡£ä»ç¶å¯ä»¥è¢«æ¥è¯¢å¹éå°ï¼ ä½å®ä¼å¨æç»ç»æè¢«è¿ååä»ç»æéä¸­ç§»é¤ã\n\nææ¡£æ´æ°ä¹æ¯ç±»ä¼¼çæä½æ¹å¼ï¼å½ä¸ä¸ªææ¡£è¢«æ´æ°æ¶ï¼æ§çæ¬ææ¡£è¢«æ è®°å é¤ï¼ææ¡£çæ°çæ¬è¢«ç´¢å¼å°ä¸ä¸ªæ°çæ®µä¸­ã å¯è½ä¸¤ä¸ªçæ¬çææ¡£é½ä¼è¢«ä¸ä¸ªæ¥è¯¢å¹éå°ï¼ä½è¢«å é¤çé£ä¸ªæ§çæ¬ææ¡£å¨ç»æéè¿ååå°±å·²ç»è¢«ç§»é¤ã\n\nå¨ æ®µåå¹¶ , æä»¬å±ç¤ºäºä¸ä¸ªè¢«å é¤çææ¡£æ¯ææ ·è¢«æä»¶ç³»ç»ç§»é¤çã\n\n\n# 2.5. è¿å®æ¶æç´¢\n\néçææ®µï¼per-segmentï¼æç´¢çåå±ï¼ä¸ä¸ªæ°çææ¡£ä»ç´¢å¼å°å¯è¢«æç´¢çå»¶è¿æ¾èéä½äºãæ°ææ¡£å¨å åéä¹åå³å¯è¢«æ£ç´¢ï¼ä½è¿æ ·è¿æ¯ä¸å¤å¿«ã\n\nç£çå¨è¿éæä¸ºäºç¶é¢ãæäº¤ï¼commitingï¼ä¸ä¸ªæ°çæ®µå°ç£çéè¦ä¸ä¸ª fsync æ¥ç¡®ä¿æ®µè¢«ç©çæ§å°åå¥ç£çï¼è¿æ ·å¨æ­çµçæ¶åå°±ä¸ä¼ä¸¢å¤±æ°æ®ã ä½æ¯ fsync æä½ä»£ä»·å¾å¤§; å¦ææ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æ§è¡ä¸æ¬¡çè¯ä¼é æå¾å¤§çæ§è½é®é¢ã\n\næä»¬éè¦çæ¯ä¸ä¸ªæ´è½»éçæ¹å¼æ¥ä½¿ä¸ä¸ªææ¡£å¯è¢«æç´¢ï¼è¿æå³ç fsync è¦ä»æ´ä¸ªè¿ç¨ä¸­è¢«ç§»é¤ã\n\nå¨ elasticsearch åç£çä¹é´æ¯æä»¶ç³»ç»ç¼å­ã åä¹åæè¿°çä¸æ ·ï¼ å¨åå­ç´¢å¼ç¼å²åºï¼ figure 19, âå¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç lucene ç´¢å¼â ï¼ä¸­çææ¡£ä¼è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ figure 20, âç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤â ï¼ã ä½æ¯è¿éæ°æ®µä¼è¢«ååå¥å°æä»¶ç³»ç»ç¼å­âè¿ä¸æ­¥ä»£ä»·ä¼æ¯è¾ä½ï¼ç¨ååè¢«å·æ°å°ç£çâè¿ä¸æ­¥ä»£ä»·æ¯è¾é«ãä¸è¿åªè¦æä»¶å·²ç»å¨ç¼å­ä¸­ï¼ å°±å¯ä»¥åå¶å®æä»¶ä¸æ ·è¢«æå¼åè¯»åäºã\n\nfigure 19. å¨åå­ç¼å²åºä¸­åå«äºæ°ææ¡£ç lucene ç´¢å¼\n\n\n\nlucene åè®¸æ°æ®µè¢«åå¥åæå¼âä½¿å¶åå«çææ¡£å¨æªè¿è¡ä¸æ¬¡å®æ´æäº¤æ¶ä¾¿å¯¹æç´¢å¯è§ã è¿ç§æ¹å¼æ¯è¿è¡ä¸æ¬¡æäº¤ä»£ä»·è¦å°å¾å¤ï¼å¹¶ä¸å¨ä¸å½±åæ§è½çåæä¸å¯ä»¥è¢«é¢ç¹å°æ§è¡ã\n\nfigure 20. ç¼å²åºçåå®¹å·²ç»è¢«åå¥ä¸ä¸ªå¯è¢«æç´¢çæ®µä¸­ï¼ä½è¿æ²¡æè¿è¡æäº¤\n\n\n\n\n# 2.6. refresh api\n\nå¨ elasticsearch ä¸­ï¼åå¥åæå¼ä¸ä¸ªæ°æ®µçè½»éçè¿ç¨å«å refresh ã é»è®¤æåµä¸æ¯ä¸ªåçä¼æ¯ç§èªå¨å·æ°ä¸æ¬¡ãè¿å°±æ¯ä¸ºä»ä¹æä»¬è¯´ elasticsearch æ¯ è¿ å®æ¶æç´¢: ææ¡£çååå¹¶ä¸æ¯ç«å³å¯¹æç´¢å¯è§ï¼ä½ä¼å¨ä¸ç§ä¹ååä¸ºå¯è§ã\n\nè¿äºè¡ä¸ºå¯è½ä¼å¯¹æ°ç¨æ·é æå°æ: ä»ä»¬ç´¢å¼äºä¸ä¸ªææ¡£ç¶åå°è¯æç´¢å®ï¼ä½å´æ²¡ææå°ãè¿ä¸ªé®é¢çè§£å³åæ³æ¯ç¨ refresh api æ§è¡ä¸æ¬¡æå¨å·æ°:\n\npost /_refresh\npost /blogs/_refresh\n\n\nå·æ°ï¼refreshï¼ææçç´¢å¼\n\nåªå·æ°ï¼refreshï¼ blogs ç´¢å¼\n\n> å°½ç®¡å·æ°æ¯æ¯æäº¤è½»éå¾å¤çæä½ï¼å®è¿æ¯ä¼ææ§è½å¼éãå½åæµè¯çæ¶åï¼ æå¨å·æ°å¾æç¨ï¼ä½æ¯ä¸è¦å¨çäº§ç¯å¢ä¸æ¯æ¬¡ç´¢å¼ä¸ä¸ªææ¡£é½å»æå¨å·æ°ã ç¸åï¼ä½ çåºç¨éè¦æè¯å° elasticsearch çè¿å®æ¶çæ§è´¨ï¼å¹¶æ¥åå®çä¸è¶³ã\n\nå¹¶ä¸æ¯ææçæåµé½éè¦æ¯ç§å·æ°ãå¯è½ä½ æ­£å¨ä½¿ç¨ elasticsearch ç´¢å¼å¤§éçæ¥å¿æä»¶ï¼ ä½ å¯è½æ³ä¼åç´¢å¼éåº¦èä¸æ¯è¿å®æ¶æç´¢ï¼ å¯ä»¥éè¿è®¾ç½® refresh_interval ï¼ éä½æ¯ä¸ªç´¢å¼çå·æ°é¢çï¼\n\nput /my_logs\n{\n  "settings": {\n    "refresh_interval": "30s"\n  }\n}\n\n\n> æ¯ 30 ç§å·æ° my_logs ç´¢å¼ã\n\nrefresh_interval å¯ä»¥å¨æ¢å­ç´¢å¼ä¸è¿è¡å¨ææ´æ°ã å¨çäº§ç¯å¢ä¸­ï¼å½ä½ æ­£å¨å»ºç«ä¸ä¸ªå¤§çæ°ç´¢å¼æ¶ï¼å¯ä»¥åå³é­èªå¨å·æ°ï¼å¾å¼å§ä½¿ç¨è¯¥ç´¢å¼æ¶ï¼åæå®ä»¬è°åæ¥ï¼\n\nput /my_logs/_settings\n{ "refresh_interval": -1 }\n\nput /my_logs/_settings\n{ "refresh_interval": "1s" }\n\n\n * å³é­èªå¨å·æ°ã\n\n * æ¯ç§èªå¨å·æ°ã\n\n> refresh_interval éè¦ä¸ä¸ª æç»­æ¶é´ å¼ï¼ ä¾å¦ 1s ï¼1 ç§ï¼ æ 2m ï¼2 åéï¼ã ä¸ä¸ªç»å¯¹å¼ 1 è¡¨ç¤ºçæ¯ 1 æ¯«ç§ --æ çä¼ä½¿ä½ çéç¾¤é·å¥ç«çªã\n\n\n# 2.7. æä¹ååæ´\n\nå¦ææ²¡æç¨ fsync ææ°æ®ä»æä»¶ç³»ç»ç¼å­å·ï¼flushï¼å°ç¡¬çï¼æä»¬ä¸è½ä¿è¯æ°æ®å¨æ­çµçè³æ¯ç¨åºæ­£å¸¸éåºä¹åä¾ç¶å­å¨ãä¸ºäºä¿è¯ elasticsearch çå¯é æ§ï¼éè¦ç¡®ä¿æ°æ®ååè¢«æä¹åå°ç£çã\n\nå¨ å¨ææ´æ°ç´¢å¼ï¼æä»¬è¯´ä¸æ¬¡å®æ´çæäº¤ä¼å°æ®µå·å°ç£çï¼å¹¶åå¥ä¸ä¸ªåå«æææ®µåè¡¨çæäº¤ç¹ãelasticsearch å¨å¯å¨æéæ°æå¼ä¸ä¸ªç´¢å¼çè¿ç¨ä¸­ä½¿ç¨è¿ä¸ªæäº¤ç¹æ¥å¤æ­åªäºæ®µé¶å±äºå½ååçã\n\nå³ä½¿éè¿æ¯ç§å·æ°ï¼refreshï¼å®ç°äºè¿å®æ¶æç´¢ï¼æä»¬ä»ç¶éè¦ç»å¸¸è¿è¡å®æ´æäº¤æ¥ç¡®ä¿è½ä»å¤±è´¥ä¸­æ¢å¤ãä½å¨ä¸¤æ¬¡æäº¤ä¹é´åçååçææ¡£æä¹åï¼æä»¬ä¹ä¸å¸æä¸¢å¤±æè¿äºæ°æ®ã\n\nelasticsearch å¢å äºä¸ä¸ª translog ï¼æèå«äºå¡æ¥å¿ï¼å¨æ¯ä¸æ¬¡å¯¹ elasticsearch è¿è¡æä½æ¶åè¿è¡äºæ¥å¿è®°å½ãéè¿ translog ï¼æ´ä¸ªæµç¨çèµ·æ¥æ¯ä¸é¢è¿æ ·ï¼\n\nä¸ä¸ªææ¡£è¢«ç´¢å¼ä¹åï¼å°±ä¼è¢«æ·»å å°åå­ç¼å²åºï¼å¹¶ä¸ è¿½å å°äº translog ï¼æ­£å¦ figure 21, âæ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿â æè¿°çä¸æ ·ã\n\nfigure 21. æ°çææ¡£è¢«æ·»å å°åå­ç¼å²åºå¹¶ä¸è¢«è¿½å å°äºäºå¡æ¥å¿\n\n\n\nå·æ°ï¼refreshï¼ä½¿åçå¤äº figure 22, âå·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼â æè¿°çç¶æï¼åçæ¯ç§è¢«å·æ°ï¼refreshï¼ä¸æ¬¡ï¼\n\n * è¿äºå¨åå­ç¼å²åºçææ¡£è¢«åå¥å°ä¸ä¸ªæ°çæ®µä¸­ï¼ä¸æ²¡æè¿è¡ fsync æä½ã\n * è¿ä¸ªæ®µè¢«æå¼ï¼ä½¿å¶å¯è¢«æç´¢ã\n * åå­ç¼å²åºè¢«æ¸ç©ºã\n\nfigure 22. å·æ°ï¼refreshï¼å®æå, ç¼å­è¢«æ¸ç©ºä½æ¯äºå¡æ¥å¿ä¸ä¼\n\n\n\nè¿ä¸ªè¿ç¨ç»§ç»­å·¥ä½ï¼æ´å¤çææ¡£è¢«æ·»å å°åå­ç¼å²åºåè¿½å å°äºå¡æ¥å¿ï¼è§ figure 23, âäºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£â ï¼ã\n\nfigure 23. äºå¡æ¥å¿ä¸æ­ç§¯ç´¯ææ¡£\n\n\n\n 1. æ¯éä¸æ®µæ¶é´âä¾å¦ translog åå¾è¶æ¥è¶å¤§âç´¢å¼è¢«å·æ°ï¼flushï¼ï¼ä¸ä¸ªæ°ç translog è¢«åå»ºï¼å¹¶ä¸ä¸ä¸ªå¨éæäº¤è¢«æ§è¡ï¼è§ figure 24, âå¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©ºâ ï¼ï¼\n    * ææå¨åå­ç¼å²åºçææ¡£é½è¢«åå¥ä¸ä¸ªæ°çæ®µã\n    * ç¼å²åºè¢«æ¸ç©ºã\n    * ä¸ä¸ªæäº¤ç¹è¢«åå¥ç¡¬çã\n    * æä»¶ç³»ç»ç¼å­éè¿ fsync è¢«å·æ°ï¼flushï¼ã\n    * èç translog è¢«å é¤ã\n\ntranslog æä¾ææè¿æ²¡æè¢«å·å°ç£ççæä½çä¸ä¸ªæä¹åçºªå½ãå½ elasticsearch å¯å¨çæ¶åï¼ å®ä¼ä»ç£çä¸­ä½¿ç¨æåä¸ä¸ªæäº¤ç¹å»æ¢å¤å·²ç¥çæ®µï¼å¹¶ä¸ä¼éæ¾ translog ä¸­ææå¨æåä¸æ¬¡æäº¤ååççåæ´æä½ã\n\ntranslog ä¹è¢«ç¨æ¥æä¾å®æ¶ crud ãå½ä½ è¯çéè¿ id æ¥è¯¢ãæ´æ°ãå é¤ä¸ä¸ªææ¡£ï¼å®ä¼å¨å°è¯ä»ç¸åºçæ®µä¸­æ£ç´¢ä¹åï¼ é¦åæ£æ¥ translog ä»»ä½æè¿çåæ´ãè¿æå³çå®æ»æ¯è½å¤å®æ¶å°è·åå°ææ¡£çææ°çæ¬ã\n\nfigure 24. å¨å·æ°ï¼flushï¼ä¹åï¼æ®µè¢«å¨éæäº¤ï¼å¹¶ä¸äºå¡æ¥å¿è¢«æ¸ç©º\n\n\n\n\n# 2.8. flush api\n\nè¿ä¸ªæ§è¡ä¸ä¸ªæäº¤å¹¶ä¸æªæ­ translog çè¡ä¸ºå¨ elasticsearch è¢«ç§°ä½ä¸æ¬¡ flush ã åçæ¯ 30 åéè¢«èªå¨å·æ°ï¼flushï¼ï¼æèå¨ translog å¤ªå¤§çæ¶åä¹ä¼å·æ°ãè¯·æ¥ç translog ææ¡£ æ¥è®¾ç½®ï¼å®å¯ä»¥ç¨æ¥ æ§å¶è¿äºéå¼ï¼\n\nflush api å¯ä»¥è¢«ç¨æ¥æ§è¡ä¸ä¸ªæå·¥çå·æ°ï¼flushï¼:\n\npost /blogs/_flush\npost /_flush?wait_for_ongoing\n\n\n * å·æ°ï¼flushï¼ blogs ç´¢å¼ã\n * å·æ°ï¼flushï¼ææçç´¢å¼å¹¶ä¸å¹¶ä¸ç­å¾ææå·æ°å¨è¿ååå®æã\n\nä½ å¾å°éè¦èªå·±æå¨æ§è¡ flush æä½ï¼éå¸¸æåµä¸ï¼èªå¨å·æ°å°±è¶³å¤äºã\n\nè¿å°±æ¯è¯´ï¼å¨éå¯èç¹æå³é­ç´¢å¼ä¹åæ§è¡ flush æçäºä½ çç´¢å¼ãå½ elasticsearch å°è¯æ¢å¤æéæ°æå¼ä¸ä¸ªç´¢å¼ï¼ å®éè¦éæ¾ translog ä¸­ææçæä½ï¼æä»¥å¦ææ¥å¿è¶ç­ï¼æ¢å¤è¶å¿«ã\n\n> translog çç®çæ¯ä¿è¯æä½ä¸ä¼ä¸¢å¤±ãè¿å¼åºäºè¿ä¸ªé®é¢ï¼ translog æå¤å®å¨ï¼\n> \n> å¨æä»¶è¢« fsync å°ç£çåï¼è¢«åå¥çæä»¶å¨éå¯ä¹åå°±ä¼ä¸¢å¤±ãé»è®¤ translog æ¯æ¯ 5 ç§è¢« fsync å·æ°å°ç¡¬çï¼ æèå¨æ¯æ¬¡åè¯·æ±å®æä¹åæ§è¡(e.g. index, delete, update, bulk)ãè¿ä¸ªè¿ç¨å¨ä¸»åçåå¤å¶åçé½ä¼åçãæç»ï¼ åºæ¬ä¸ï¼è¿æå³çå¨æ´ä¸ªè¯·æ±è¢« fsync å°ä¸»åçåå¤å¶åçç translog ä¹åï¼ä½ çå®¢æ·ç«¯ä¸ä¼å¾å°ä¸ä¸ª 200 ok ååºã\n> \n> å¨æ¯æ¬¡è¯·æ±åé½æ§è¡ä¸ä¸ª fsync ä¼å¸¦æ¥ä¸äºæ§è½æå¤±ï¼å°½ç®¡å®è·µè¡¨æè¿ç§æå¤±ç¸å¯¹è¾å°ï¼ç¹å«æ¯ bulk å¯¼å¥ï¼å®å¨ä¸æ¬¡è¯·æ±ä¸­å¹³æäºå¤§éææ¡£çå¼éï¼ã\n> \n> ä½æ¯å¯¹äºä¸äºå¤§å®¹éçå¶å°ä¸¢å¤±å ç§æ°æ®é®é¢ä¹å¹¶ä¸ä¸¥éçéç¾¤ï¼ä½¿ç¨å¼æ­¥ç fsync è¿æ¯æ¯è¾æççãæ¯å¦ï¼åå¥çæ°æ®è¢«ç¼å­å°åå­ä¸­ï¼åæ¯ 5 ç§æ§è¡ä¸æ¬¡ fsync ã\n> \n> è¿ä¸ªè¡ä¸ºå¯ä»¥éè¿è®¾ç½® durability åæ°ä¸º async æ¥å¯ç¨ï¼\n> \n> put /my_index/_settings\n> {\n>     "index.translog.durability": "async",\n>     "index.translog.sync_interval": "5s"\n> }\n> \n> \n> è¿ä¸ªéé¡¹å¯ä»¥éå¯¹ç´¢å¼åç¬è®¾ç½®ï¼å¹¶ä¸å¯ä»¥å¨æè¿è¡ä¿®æ¹ãå¦æä½ å³å®ä½¿ç¨å¼æ­¥ translog çè¯ï¼ä½ éè¦ ä¿è¯ å¨åç crash æ¶ï¼ä¸¢å¤±æ sync_interval æ¶é´æ®µçæ°æ®ä¹æ æè°ãè¯·å¨å³å®åç¥æè¿ä¸ªç¹æ§ã\n> \n> å¦æä½ ä¸ç¡®å®è¿ä¸ªè¡ä¸ºçåæï¼æå¥½æ¯ä½¿ç¨é»è®¤çåæ°ï¼ "index.translog.durability": "request" ï¼æ¥é¿åæ°æ®ä¸¢å¤±ã\n\n\n# 2.9. æ®µåå¹¶\n\nç±äºèªå¨å·æ°æµç¨æ¯ç§ä¼åå»ºä¸ä¸ªæ°çæ®µ ï¼è¿æ ·ä¼å¯¼è´ç­æ¶é´åçæ®µæ°éæ´å¢ãèæ®µæ°ç®å¤ªå¤ä¼å¸¦æ¥è¾å¤§çéº»ç¦ã æ¯ä¸ä¸ªæ®µé½ä¼æ¶èæä»¶å¥æãåå­å cpu è¿è¡å¨æãæ´éè¦çæ¯ï¼æ¯ä¸ªæç´¢è¯·æ±é½å¿é¡»è½®æµæ£æ¥æ¯ä¸ªæ®µï¼æä»¥æ®µè¶å¤ï¼æç´¢ä¹å°±è¶æ¢ã\n\nelasticsearch éè¿å¨åå°è¿è¡æ®µåå¹¶æ¥è§£å³è¿ä¸ªé®é¢ãå°çæ®µè¢«åå¹¶å°å¤§çæ®µï¼ç¶åè¿äºå¤§çæ®µåè¢«åå¹¶å°æ´å¤§çæ®µã\n\næ®µåå¹¶çæ¶åä¼å°é£äºæ§çå·²å é¤ææ¡£ä»æä»¶ç³»ç»ä¸­æ¸é¤ãè¢«å é¤çææ¡£ï¼æè¢«æ´æ°ææ¡£çæ§çæ¬ï¼ä¸ä¼è¢«æ·è´å°æ°çå¤§æ®µä¸­ã\n\nå¯å¨æ®µåå¹¶ä¸éè¦ä½ åä»»ä½äºãè¿è¡ç´¢å¼åæç´¢æ¶ä¼èªå¨è¿è¡ãè¿ä¸ªæµç¨åå¨ figure 25, âä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µâ ä¸­æå°çä¸æ ·å·¥ä½ï¼\n\n1ã å½ç´¢å¼çæ¶åï¼å·æ°ï¼refreshï¼æä½ä¼åå»ºæ°çæ®µå¹¶å°æ®µæå¼ä»¥ä¾æç´¢ä½¿ç¨ã\n\n2ã åå¹¶è¿ç¨éæ©ä¸å°é¨åå¤§å°ç¸ä¼¼çæ®µï¼å¹¶ä¸å¨åå°å°å®ä»¬åå¹¶å°æ´å¤§çæ®µä¸­ãè¿å¹¶ä¸ä¼ä¸­æ­ç´¢å¼åæç´¢ã\n\nfigure 25. ä¸¤ä¸ªæäº¤äºçæ®µåä¸ä¸ªæªæäº¤çæ®µæ­£å¨è¢«åå¹¶å°ä¸ä¸ªæ´å¤§çæ®µ\n\n\n\nfigure 26, âä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤â è¯´æåå¹¶å®ææ¶çæ´»å¨ï¼\n\n * æ°çæ®µè¢«å·æ°ï¼flushï¼å°äºç£çã ** åå¥ä¸ä¸ªåå«æ°æ®µä¸æé¤æ§çåè¾å°çæ®µçæ°æäº¤ç¹ã\n * æ°çæ®µè¢«æå¼ç¨æ¥æç´¢ã\n * èçæ®µè¢«å é¤ã\n\nfigure 26. ä¸æ¦åå¹¶ç»æï¼èçæ®µè¢«å é¤\n\n\n\nåå¹¶å¤§çæ®µéè¦æ¶èå¤§éç i/o å cpu èµæºï¼å¦æä»»å¶åå±ä¼å½±åæç´¢æ§è½ãelasticsearch å¨é»è®¤æåµä¸ä¼å¯¹åå¹¶æµç¨è¿è¡èµæºéå¶ï¼æä»¥æç´¢ä»ç¶ æè¶³å¤çèµæºå¾å¥½å°æ§è¡ã\n\n\n# 2.10. optimize api\n\noptimize api å¤§å¯çåæ¯ å¼ºå¶åå¹¶ apiãå®ä¼å°ä¸ä¸ªåçå¼ºå¶åå¹¶å° max_num_segments åæ°æå®å¤§å°çæ®µæ°ç®ã è¿æ ·åçæå¾æ¯åå°æ®µçæ°éï¼éå¸¸åå°å°ä¸ä¸ªï¼ï¼æ¥æåæç´¢æ§è½ã\n\n> optimize api ä¸åºè¯¥ è¢«ç¨å¨ä¸ä¸ªæ´»è·çç´¢å¼ââââä¸ä¸ªæ­£ç§¯ææ´æ°çç´¢å¼ãåå°åå¹¶æµç¨å·²ç»å¯ä»¥å¾å¥½å°å®æå·¥ä½ã optimizing ä¼é»ç¢è¿ä¸ªè¿ç¨ãä¸è¦å¹²æ°å®ï¼\n\nå¨ç¹å®æåµä¸ï¼ä½¿ç¨ optimize api é¢æçå¤ãä¾å¦å¨æ¥å¿è¿ç§ç¨ä¾ä¸ï¼æ¯å¤©ãæ¯å¨ãæ¯æçæ¥å¿è¢«å­å¨å¨ä¸ä¸ªç´¢å¼ä¸­ã èçç´¢å¼å®è´¨ä¸æ¯åªè¯»çï¼å®ä»¬ä¹å¹¶ä¸å¤ªå¯è½ä¼åçååã\n\nå¨è¿ç§æåµä¸ï¼ä½¿ç¨ optimize ä¼åèçç´¢å¼ï¼å°æ¯ä¸ä¸ªåçåå¹¶ä¸ºä¸ä¸ªåç¬çæ®µå°±å¾æç¨äºï¼è¿æ ·æ¢å¯ä»¥èçèµæºï¼ä¹å¯ä»¥ä½¿æç´¢æ´å å¿«éï¼\n\npost /logstash-2014-10/_optimize?max_num_segments=1\n\n\nåå¹¶ç´¢å¼ä¸­çæ¯ä¸ªåçä¸ºä¸ä¸ªåç¬çæ®µ\n\n> è¯·æ³¨æï¼ä½¿ç¨ optimize api è§¦åæ®µåå¹¶çæä½ä¸ä¼åå°ä»»ä½èµæºä¸çéå¶ãè¿å¯è½ä¼æ¶èæä½ èç¹ä¸å¨é¨ç i/o èµæº, ä½¿å¶æ²¡æä½è£æ¥å¤çæç´¢è¯·æ±ï¼ä»èæå¯è½ä½¿éç¾¤å¤±å»ååºã å¦æä½ æ³è¦å¯¹ç´¢å¼æ§è¡ optimizeï¼ä½ éè¦åä½¿ç¨åçåéï¼æ¥ç è¿ç§»æ§ç´¢å¼ï¼æç´¢å¼ç§»å°ä¸ä¸ªå®å¨çèç¹ï¼åæ§è¡ã\n\n\n# 3. åèèµæ\n\n * elasticsearch å®æ¹ææ¡£ä¹ éç¾¤åçåç',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch è¿ç»´",frontmatter:{title:"Elasticsearch è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch","è¿ç»´"],permalink:"/pages/805d11/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/20.Elasticsearch%E8%BF%90%E7%BB%B4.html",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/20.Elasticsearchè¿ç»´.md",key:"v-4124258d",path:"/pages/805d11/",headers:[{level:2,title:"1. Elasticsearch å®è£",slug:"_1-elasticsearch-å®è£",normalizedTitle:"1. elasticsearch å®è£",charIndex:135},{level:2,title:"2. Elasticsearch éç¾¤è§å",slug:"_2-elasticsearch-éç¾¤è§å",normalizedTitle:"2. elasticsearch éç¾¤è§å",charIndex:339},{level:2,title:"3. Elasticsearch éç½®",slug:"_3-elasticsearch-éç½®",normalizedTitle:"3. elasticsearch éç½®",charIndex:726},{level:2,title:"4. Elasticsearch FAQ",slug:"_4-elasticsearch-faq",normalizedTitle:"4. elasticsearch faq",charIndex:3249},{level:3,title:"4.1. elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡",slug:"_4-1-elasticsearch-ä¸åè®¸ä»¥-root-æéæ¥è¿è¡",normalizedTitle:"4.1. elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡",charIndex:3274},{level:3,title:"4.2. vm.maxmapcount ä¸ä½äº 262144",slug:"_4-2-vm-max-map-count-ä¸ä½äº-262144",normalizedTitle:"4.2. vm.maxmapcount ä¸ä½äº 262144",charIndex:null},{level:3,title:"4.3. nofile ä¸ä½äº 65536",slug:"_4-3-nofile-ä¸ä½äº-65536",normalizedTitle:"4.3. nofile ä¸ä½äº 65536",charIndex:4183},{level:3,title:"4.4. nproc ä¸ä½äº 2048",slug:"_4-4-nproc-ä¸ä½äº-2048",normalizedTitle:"4.4. nproc ä¸ä½äº 2048",charIndex:4538},{level:2,title:"5. åèèµæ",slug:"_5-åèèµæ",normalizedTitle:"5. åèèµæ",charIndex:4859}],headersStr:"1. Elasticsearch å®è£ 2. Elasticsearch éç¾¤è§å 3. Elasticsearch éç½® 4. Elasticsearch FAQ 4.1. elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡ 4.2. vm.maxmapcount ä¸ä½äº 262144 4.3. nofile ä¸ä½äº 65536 4.4. nproc ä¸ä½äº 2048 5. åèèµæ",content:'# Elasticsearch è¿ç»´\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# 1. Elasticsearch å®è£\n\n> Elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n\nï¼1ï¼ä¸è½½è§£å\n\nè®¿é® å®æ¹ä¸è½½å°å ï¼éæ©éè¦ççæ¬ï¼ä¸è½½è§£åå°æ¬å°ã\n\nï¼2ï¼è¿è¡\n\nè¿è¡ bin/elasticsearch (Windows ç³»ç»ä¸è¿è¡ bin\\elasticsearch.bat )\n\nï¼3ï¼è®¿é®\n\næ§è¡ curl http://localhost:9200/ æµè¯æå¡æ¯å¦å¯å¨\n\n\n# 2. Elasticsearch éç¾¤è§å\n\nElasticSearch éç¾¤éè¦æ ¹æ®ä¸å¡å®éæåµå»åçè§åã\n\néè¦èèçé®é¢ç¹ï¼\n\n * éç¾¤é¨ç½²å ä¸ªèç¹ï¼\n * æå¤å°ä¸ªç´¢å¼ï¼\n * æ¯ä¸ªç´¢å¼æå¤å¤§æ°æ®éï¼\n * æ¯ä¸ªç´¢å¼æå¤å°ä¸ªåçï¼\n\nä¸ä¸ªåèè§åï¼\n\n * 3 å°æºå¨ï¼æ¯å°æºå¨æ¯ 6 æ ¸ 64G çã\n * æä»¬ es éç¾¤çæ¥å¢éæ°æ®å¤§æ¦æ¯ 2000 ä¸æ¡ï¼æ¯å¤©æ¥å¢éæ°æ®å¤§æ¦æ¯ 500MBï¼æ¯æå¢éæ°æ®å¤§æ¦æ¯ 6 äº¿ï¼15Gãç®åç³»ç»å·²ç»è¿è¡äºå ä¸ªæï¼ç°å¨ es éç¾¤éæ°æ®æ»éå¤§æ¦æ¯ 100G å·¦å³ã\n * ç®åçº¿ä¸æ 5 ä¸ªç´¢å¼ï¼è¿ä¸ªç»åä½ ä»¬èªå·±ä¸å¡æ¥ï¼ççèªå·±æåªäºæ°æ®å¯ä»¥æ¾ es çï¼ï¼æ¯ä¸ªç´¢å¼çæ°æ®éå¤§æ¦æ¯ 20Gï¼æä»¥è¿ä¸ªæ°æ®éä¹åï¼æä»¬æ¯ä¸ªç´¢å¼åéçæ¯ 8 ä¸ª shardï¼æ¯é»è®¤ç 5 ä¸ª shard å¤äº 3 ä¸ª shardã\n\n\n# 3. Elasticsearch éç½®\n\nES çé»è®¤éç½®æä»¶ä¸º config/elasticsearch.yml\n\nåºæ¬éç½®è¯´æå¦ä¸ï¼\n\ncluster.name: elasticsearch\n#éç½®esçéç¾¤åç§°ï¼é»è®¤æ¯elasticsearchï¼esä¼èªå¨åç°å¨åä¸ç½æ®µä¸çesï¼å¦æå¨åä¸ç½æ®µä¸æå¤ä¸ªéç¾¤ï¼å°±å¯ä»¥ç¨è¿ä¸ªå±æ§æ¥åºåä¸åçéç¾¤ã\nnode.name: \'Franz Kafka\'\n#èç¹åï¼é»è®¤éæºæå®ä¸ä¸ªnameåè¡¨ä¸­åå­ï¼è¯¥åè¡¨å¨esçjaråä¸­configæä»¶å¤¹éname.txtæä»¶ä¸­ï¼å¶ä¸­æå¾å¤ä½èæ·»å çæè¶£åå­ã\nnode.master: true\n#æå®è¯¥èç¹æ¯å¦æèµæ ¼è¢«éä¸¾æä¸ºnodeï¼é»è®¤æ¯trueï¼esæ¯é»è®¤éç¾¤ä¸­çç¬¬ä¸å°æºå¨ä¸ºmasterï¼å¦æè¿å°æºæäºå°±ä¼éæ°éä¸¾masterã\nnode.data: true\n#æå®è¯¥èç¹æ¯å¦å­å¨ç´¢å¼æ°æ®ï¼é»è®¤ä¸ºtrueã\nindex.number_of_shards: 5\n#è®¾ç½®é»è®¤ç´¢å¼åçä¸ªæ°ï¼é»è®¤ä¸º5çã\nindex.number_of_replicas: 1\n#è®¾ç½®é»è®¤ç´¢å¼å¯æ¬ä¸ªæ°ï¼é»è®¤ä¸º1ä¸ªå¯æ¬ã\npath.conf: /path/to/conf\n#è®¾ç½®éç½®æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çconfigæä»¶å¤¹ã\npath.data: /path/to/data\n#è®¾ç½®ç´¢å¼æ°æ®çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çdataæä»¶å¤¹ï¼å¯ä»¥è®¾ç½®å¤ä¸ªå­å¨è·¯å¾ï¼ç¨éå·éå¼ï¼ä¾ï¼\n#path.data: /path/to/data1,/path/to/data2\npath.work: /path/to/work\n#è®¾ç½®ä¸´æ¶æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çworkæä»¶å¤¹ã\npath.logs: /path/to/logs\n#è®¾ç½®æ¥å¿æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çlogsæä»¶å¤¹\npath.plugins: /path/to/plugins\n#è®¾ç½®æä»¶çå­æ¾è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çpluginsæä»¶å¤¹\nbootstrap.mlockall: true\n#è®¾ç½®ä¸ºtrueæ¥éä½åå­ãå ä¸ºå½jvmå¼å§swappingæ¶esçæçä¼éä½ï¼æä»¥è¦ä¿è¯å®ä¸swapï¼å¯ä»¥æ#ES_MIN_MEMåES_MAX_MEMä¸¤ä¸ªç¯å¢åéè®¾ç½®æåä¸ä¸ªå¼ï¼å¹¶ä¸ä¿è¯æºå¨æè¶³å¤çåå­åéç»esãåæ¶ä¹è¦#åè®¸elasticsearchçè¿ç¨å¯ä»¥éä½åå­ï¼linuxä¸å¯ä»¥éè¿`ulimit -l unlimited`å½ä»¤ã\nnetwork.bind_host: 192.168.0.1\n#è®¾ç½®ç»å®çipå°åï¼å¯ä»¥æ¯ipv4æipv6çï¼é»è®¤ä¸º0.0.0.0ã\nnetwork.publish_host: 192.168.0.1\n#è®¾ç½®å¶å®èç¹åè¯¥èç¹äº¤äºçipå°åï¼å¦æä¸è®¾ç½®å®ä¼èªå¨å¤æ­ï¼å¼å¿é¡»æ¯ä¸ªçå®çipå°åã\nnetwork.host: 192.168.0.1\n#è¿ä¸ªåæ°æ¯ç¨æ¥åæ¶è®¾ç½®bind_hoståpublish_hostä¸é¢ä¸¤ä¸ªåæ°ã\ntransport.tcp.port: 9300\n#è®¾ç½®èç¹é´äº¤äºçtcpç«¯å£ï¼é»è®¤æ¯9300ã\ntransport.tcp.compress: true\n#è®¾ç½®æ¯å¦åç¼©tcpä¼ è¾æ¶çæ°æ®ï¼é»è®¤ä¸ºfalseï¼ä¸åç¼©ã\nhttp.port: 9200\n#è®¾ç½®å¯¹å¤æå¡çhttpç«¯å£ï¼é»è®¤ä¸º9200ã\nhttp.max_content_length: 100mb\n#è®¾ç½®åå®¹çæå¤§å®¹éï¼é»è®¤100mb\nhttp.enabled: false\n#æ¯å¦ä½¿ç¨httpåè®®å¯¹å¤æä¾æå¡ï¼é»è®¤ä¸ºtrueï¼å¼å¯ã\ngateway.type: local\n#gatewayçç±»åï¼é»è®¤ä¸ºlocalå³ä¸ºæ¬å°æä»¶ç³»ç»ï¼å¯ä»¥è®¾ç½®ä¸ºæ¬å°æä»¶ç³»ç»ï¼åå¸å¼æä»¶ç³»ç»ï¼hadoopç#HDFSï¼åamazonçs3æå¡å¨ï¼å¶å®æä»¶ç³»ç»çè®¾ç½®æ¹æ³ä¸æ¬¡åè¯¦ç»è¯´ã\ngateway.recover_after_nodes: 1\n#è®¾ç½®éç¾¤ä¸­Nä¸ªèç¹å¯å¨æ¶è¿è¡æ°æ®æ¢å¤ï¼é»è®¤ä¸º1ã\ngateway.recover_after_time: 5m\n#è®¾ç½®åå§åæ°æ®æ¢å¤è¿ç¨çè¶æ¶æ¶é´ï¼é»è®¤æ¯5åéã\ngateway.expected_nodes: 2\n#è®¾ç½®è¿ä¸ªéç¾¤ä¸­èç¹çæ°éï¼é»è®¤ä¸º2ï¼ä¸æ¦è¿Nä¸ªèç¹å¯å¨ï¼å°±ä¼ç«å³è¿è¡æ°æ®æ¢å¤ã\ncluster.routing.allocation.node_initial_primaries_recoveries: 4\n#åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\ncluster.routing.allocation.node_concurrent_recoveries: 2\n#æ·»å å é¤èç¹æè´è½½åè¡¡æ¶å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\nindices.recovery.max_size_per_sec: 0\n#è®¾ç½®æ°æ®æ¢å¤æ¶éå¶çå¸¦å®½ï¼å¦å¥100mbï¼é»è®¤ä¸º0ï¼å³æ éå¶ã\nindices.recovery.concurrent_streams: 5\n#è®¾ç½®è¿ä¸ªåæ°æ¥éå¶ä»å¶å®åçæ¢å¤æ°æ®æ¶æå¤§åæ¶æå¼å¹¶åæµçä¸ªæ°ï¼é»è®¤ä¸º5ã\ndiscovery.zen.minimum_master_nodes: 1\n#è®¾ç½®è¿ä¸ªåæ°æ¥ä¿è¯éç¾¤ä¸­çèç¹å¯ä»¥ç¥éå¶å®Nä¸ªæmasterèµæ ¼çèç¹ãé»è®¤ä¸º1ï¼å¯¹äºå¤§çéç¾¤æ¥è¯´ï¼å¯ä»¥è®¾ç½®å¤§ä¸ç¹çå¼ï¼2-4ï¼\ndiscovery.zen.ping.timeout: 3s\n#è®¾ç½®éç¾¤ä¸­èªå¨åç°å¶å®èç¹æ¶pingè¿æ¥è¶æ¶æ¶é´ï¼é»è®¤ä¸º3ç§ï¼å¯¹äºæ¯è¾å·®çç½ç»ç¯å¢å¯ä»¥é«ç¹çå¼æ¥é²æ­¢èªå¨åç°æ¶åºéã\ndiscovery.zen.ping.multicast.enabled: false\n#è®¾ç½®æ¯å¦æå¼å¤æ­åç°èç¹ï¼é»è®¤æ¯trueã\ndiscovery.zen.ping.unicast.hosts: [\'host1\', \'host2:port\', \'host3[portX-portY]\']\n#è®¾ç½®éç¾¤ä¸­masterèç¹çåå§åè¡¨ï¼å¯ä»¥éè¿è¿äºèç¹æ¥èªå¨åç°æ°å å¥éç¾¤çèç¹ã\n\n\n\n# 4. Elasticsearch FAQ\n\n\n# 4.1. elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡\n\n**é®é¢ï¼**å¨ Linux ç¯å¢ä¸­ï¼elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡ã\n\nå¦æä»¥ root èº«ä»½è¿è¡ elasticsearchï¼ä¼æç¤ºè¿æ ·çéè¯¯ï¼\n\ncan not run elasticsearch as root\n\n\n**è§£å³æ¹æ³ï¼**ä½¿ç¨é root æéè´¦å·è¿è¡ elasticsearch\n\n# åå»ºç¨æ·ç»\ngroupadd elk\n# åå»ºæ°ç¨æ·ï¼-g elk è®¾ç½®å¶ç¨æ·ç»ä¸º elkï¼-p elk è®¾ç½®å¶å¯ç ä¸º elk\nuseradd elk -g elk -p elk\n# æ´æ¹ /opt æä»¶å¤¹ååé¨æä»¶çæå±ç¨æ·åç»ä¸º elk:elk\nchown -R elk:elk /opt # åè®¾ä½ ç elasticsearch å®è£å¨ opt ç®å½ä¸\n# åæ¢è´¦å·\nsu elk\n\n\n\n# 4.2. vm.max_map_count ä¸ä½äº 262144\n\né®é¢ï¼vm.max_map_count è¡¨ç¤ºèæåå­å¤§å°ï¼å®æ¯ä¸ä¸ªåæ ¸åæ°ãelasticsearch é»è®¤è¦æ± vm.max_map_count ä¸ä½äº 262144ã\n\nmax virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n\n\nè§£å³æ¹æ³ï¼\n\nä½ å¯ä»¥æ§è¡ä»¥ä¸å½ä»¤ï¼è®¾ç½® vm.max_map_count ï¼ä½æ¯éå¯ååä¼æ¢å¤ä¸ºåå¼ã\n\nsysctl -w vm.max_map_count=262144\n\n\næä¹æ§çåæ³æ¯å¨ /etc/sysctl.conf æä»¶ä¸­ä¿®æ¹ vm.max_map_count åæ°ï¼\n\necho "vm.max_map_count=262144" > /etc/sysctl.conf\nsysctl -p\n\n\n> æ³¨æ\n> \n> å¦æè¿è¡ç¯å¢ä¸º docker å®¹å¨ï¼å¯è½ä¼éå¶æ§è¡ sysctl æ¥ä¿®æ¹åæ ¸åæ°ã\n> \n> è¿ç§æåµä¸ï¼ä½ åªè½éæ©ç´æ¥ä¿®æ¹å®¿ä¸»æºä¸çåæ°äºã\n\n\n# 4.3. nofile ä¸ä½äº 65536\n\né®é¢ï¼ nofile è¡¨ç¤ºè¿ç¨åè®¸æå¼çæå¤§æä»¶æ°ãelasticsearch è¿ç¨è¦æ±å¯ä»¥æå¼çæå¤§æä»¶æ°ä¸ä½äº 65536ã\n\nmax file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nofile åæ°ï¼\n\necho "* soft nofile 65536" > /etc/security/limits.conf\necho "* hard nofile 131072" > /etc/security/limits.conf\n\n\n\n# 4.4. nproc ä¸ä½äº 2048\n\né®é¢ï¼ nproc è¡¨ç¤ºæå¤§çº¿ç¨æ°ãelasticsearch è¦æ±æå¤§çº¿ç¨æ°ä¸ä½äº 2048ã\n\nmax number of threads [1024] for user [user] is too low, increase to at least [2048]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nproc åæ°ï¼\n\necho "* soft nproc 2048" > /etc/security/limits.conf\necho "* hard nproc 4096" > /etc/security/limits.conf\n\n\n\n# 5. åèèµæ\n\n * Elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n * Install Elasticsearch with RPM\n * Elasticsearch ä½¿ç¨ç§¯ç´¯',normalizedContent:'# elasticsearch è¿ç»´\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# 1. elasticsearch å®è£\n\n> elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n\nï¼1ï¼ä¸è½½è§£å\n\nè®¿é® å®æ¹ä¸è½½å°å ï¼éæ©éè¦ççæ¬ï¼ä¸è½½è§£åå°æ¬å°ã\n\nï¼2ï¼è¿è¡\n\nè¿è¡ bin/elasticsearch (windows ç³»ç»ä¸è¿è¡ bin\\elasticsearch.bat )\n\nï¼3ï¼è®¿é®\n\næ§è¡ curl http://localhost:9200/ æµè¯æå¡æ¯å¦å¯å¨\n\n\n# 2. elasticsearch éç¾¤è§å\n\nelasticsearch éç¾¤éè¦æ ¹æ®ä¸å¡å®éæåµå»åçè§åã\n\néè¦èèçé®é¢ç¹ï¼\n\n * éç¾¤é¨ç½²å ä¸ªèç¹ï¼\n * æå¤å°ä¸ªç´¢å¼ï¼\n * æ¯ä¸ªç´¢å¼æå¤å¤§æ°æ®éï¼\n * æ¯ä¸ªç´¢å¼æå¤å°ä¸ªåçï¼\n\nä¸ä¸ªåèè§åï¼\n\n * 3 å°æºå¨ï¼æ¯å°æºå¨æ¯ 6 æ ¸ 64g çã\n * æä»¬ es éç¾¤çæ¥å¢éæ°æ®å¤§æ¦æ¯ 2000 ä¸æ¡ï¼æ¯å¤©æ¥å¢éæ°æ®å¤§æ¦æ¯ 500mbï¼æ¯æå¢éæ°æ®å¤§æ¦æ¯ 6 äº¿ï¼15gãç®åç³»ç»å·²ç»è¿è¡äºå ä¸ªæï¼ç°å¨ es éç¾¤éæ°æ®æ»éå¤§æ¦æ¯ 100g å·¦å³ã\n * ç®åçº¿ä¸æ 5 ä¸ªç´¢å¼ï¼è¿ä¸ªç»åä½ ä»¬èªå·±ä¸å¡æ¥ï¼ççèªå·±æåªäºæ°æ®å¯ä»¥æ¾ es çï¼ï¼æ¯ä¸ªç´¢å¼çæ°æ®éå¤§æ¦æ¯ 20gï¼æä»¥è¿ä¸ªæ°æ®éä¹åï¼æä»¬æ¯ä¸ªç´¢å¼åéçæ¯ 8 ä¸ª shardï¼æ¯é»è®¤ç 5 ä¸ª shard å¤äº 3 ä¸ª shardã\n\n\n# 3. elasticsearch éç½®\n\nes çé»è®¤éç½®æä»¶ä¸º config/elasticsearch.yml\n\nåºæ¬éç½®è¯´æå¦ä¸ï¼\n\ncluster.name: elasticsearch\n#éç½®esçéç¾¤åç§°ï¼é»è®¤æ¯elasticsearchï¼esä¼èªå¨åç°å¨åä¸ç½æ®µä¸çesï¼å¦æå¨åä¸ç½æ®µä¸æå¤ä¸ªéç¾¤ï¼å°±å¯ä»¥ç¨è¿ä¸ªå±æ§æ¥åºåä¸åçéç¾¤ã\nnode.name: \'franz kafka\'\n#èç¹åï¼é»è®¤éæºæå®ä¸ä¸ªnameåè¡¨ä¸­åå­ï¼è¯¥åè¡¨å¨esçjaråä¸­configæä»¶å¤¹éname.txtæä»¶ä¸­ï¼å¶ä¸­æå¾å¤ä½èæ·»å çæè¶£åå­ã\nnode.master: true\n#æå®è¯¥èç¹æ¯å¦æèµæ ¼è¢«éä¸¾æä¸ºnodeï¼é»è®¤æ¯trueï¼esæ¯é»è®¤éç¾¤ä¸­çç¬¬ä¸å°æºå¨ä¸ºmasterï¼å¦æè¿å°æºæäºå°±ä¼éæ°éä¸¾masterã\nnode.data: true\n#æå®è¯¥èç¹æ¯å¦å­å¨ç´¢å¼æ°æ®ï¼é»è®¤ä¸ºtrueã\nindex.number_of_shards: 5\n#è®¾ç½®é»è®¤ç´¢å¼åçä¸ªæ°ï¼é»è®¤ä¸º5çã\nindex.number_of_replicas: 1\n#è®¾ç½®é»è®¤ç´¢å¼å¯æ¬ä¸ªæ°ï¼é»è®¤ä¸º1ä¸ªå¯æ¬ã\npath.conf: /path/to/conf\n#è®¾ç½®éç½®æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çconfigæä»¶å¤¹ã\npath.data: /path/to/data\n#è®¾ç½®ç´¢å¼æ°æ®çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çdataæä»¶å¤¹ï¼å¯ä»¥è®¾ç½®å¤ä¸ªå­å¨è·¯å¾ï¼ç¨éå·éå¼ï¼ä¾ï¼\n#path.data: /path/to/data1,/path/to/data2\npath.work: /path/to/work\n#è®¾ç½®ä¸´æ¶æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çworkæä»¶å¤¹ã\npath.logs: /path/to/logs\n#è®¾ç½®æ¥å¿æä»¶çå­å¨è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çlogsæä»¶å¤¹\npath.plugins: /path/to/plugins\n#è®¾ç½®æä»¶çå­æ¾è·¯å¾ï¼é»è®¤æ¯esæ ¹ç®å½ä¸çpluginsæä»¶å¤¹\nbootstrap.mlockall: true\n#è®¾ç½®ä¸ºtrueæ¥éä½åå­ãå ä¸ºå½jvmå¼å§swappingæ¶esçæçä¼éä½ï¼æä»¥è¦ä¿è¯å®ä¸swapï¼å¯ä»¥æ#es_min_memåes_max_memä¸¤ä¸ªç¯å¢åéè®¾ç½®æåä¸ä¸ªå¼ï¼å¹¶ä¸ä¿è¯æºå¨æè¶³å¤çåå­åéç»esãåæ¶ä¹è¦#åè®¸elasticsearchçè¿ç¨å¯ä»¥éä½åå­ï¼linuxä¸å¯ä»¥éè¿`ulimit -l unlimited`å½ä»¤ã\nnetwork.bind_host: 192.168.0.1\n#è®¾ç½®ç»å®çipå°åï¼å¯ä»¥æ¯ipv4æipv6çï¼é»è®¤ä¸º0.0.0.0ã\nnetwork.publish_host: 192.168.0.1\n#è®¾ç½®å¶å®èç¹åè¯¥èç¹äº¤äºçipå°åï¼å¦æä¸è®¾ç½®å®ä¼èªå¨å¤æ­ï¼å¼å¿é¡»æ¯ä¸ªçå®çipå°åã\nnetwork.host: 192.168.0.1\n#è¿ä¸ªåæ°æ¯ç¨æ¥åæ¶è®¾ç½®bind_hoståpublish_hostä¸é¢ä¸¤ä¸ªåæ°ã\ntransport.tcp.port: 9300\n#è®¾ç½®èç¹é´äº¤äºçtcpç«¯å£ï¼é»è®¤æ¯9300ã\ntransport.tcp.compress: true\n#è®¾ç½®æ¯å¦åç¼©tcpä¼ è¾æ¶çæ°æ®ï¼é»è®¤ä¸ºfalseï¼ä¸åç¼©ã\nhttp.port: 9200\n#è®¾ç½®å¯¹å¤æå¡çhttpç«¯å£ï¼é»è®¤ä¸º9200ã\nhttp.max_content_length: 100mb\n#è®¾ç½®åå®¹çæå¤§å®¹éï¼é»è®¤100mb\nhttp.enabled: false\n#æ¯å¦ä½¿ç¨httpåè®®å¯¹å¤æä¾æå¡ï¼é»è®¤ä¸ºtrueï¼å¼å¯ã\ngateway.type: local\n#gatewayçç±»åï¼é»è®¤ä¸ºlocalå³ä¸ºæ¬å°æä»¶ç³»ç»ï¼å¯ä»¥è®¾ç½®ä¸ºæ¬å°æä»¶ç³»ç»ï¼åå¸å¼æä»¶ç³»ç»ï¼hadoopç#hdfsï¼åamazonçs3æå¡å¨ï¼å¶å®æä»¶ç³»ç»çè®¾ç½®æ¹æ³ä¸æ¬¡åè¯¦ç»è¯´ã\ngateway.recover_after_nodes: 1\n#è®¾ç½®éç¾¤ä¸­nä¸ªèç¹å¯å¨æ¶è¿è¡æ°æ®æ¢å¤ï¼é»è®¤ä¸º1ã\ngateway.recover_after_time: 5m\n#è®¾ç½®åå§åæ°æ®æ¢å¤è¿ç¨çè¶æ¶æ¶é´ï¼é»è®¤æ¯5åéã\ngateway.expected_nodes: 2\n#è®¾ç½®è¿ä¸ªéç¾¤ä¸­èç¹çæ°éï¼é»è®¤ä¸º2ï¼ä¸æ¦è¿nä¸ªèç¹å¯å¨ï¼å°±ä¼ç«å³è¿è¡æ°æ®æ¢å¤ã\ncluster.routing.allocation.node_initial_primaries_recoveries: 4\n#åå§åæ°æ®æ¢å¤æ¶ï¼å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\ncluster.routing.allocation.node_concurrent_recoveries: 2\n#æ·»å å é¤èç¹æè´è½½åè¡¡æ¶å¹¶åæ¢å¤çº¿ç¨çä¸ªæ°ï¼é»è®¤ä¸º4ã\nindices.recovery.max_size_per_sec: 0\n#è®¾ç½®æ°æ®æ¢å¤æ¶éå¶çå¸¦å®½ï¼å¦å¥100mbï¼é»è®¤ä¸º0ï¼å³æ éå¶ã\nindices.recovery.concurrent_streams: 5\n#è®¾ç½®è¿ä¸ªåæ°æ¥éå¶ä»å¶å®åçæ¢å¤æ°æ®æ¶æå¤§åæ¶æå¼å¹¶åæµçä¸ªæ°ï¼é»è®¤ä¸º5ã\ndiscovery.zen.minimum_master_nodes: 1\n#è®¾ç½®è¿ä¸ªåæ°æ¥ä¿è¯éç¾¤ä¸­çèç¹å¯ä»¥ç¥éå¶å®nä¸ªæmasterèµæ ¼çèç¹ãé»è®¤ä¸º1ï¼å¯¹äºå¤§çéç¾¤æ¥è¯´ï¼å¯ä»¥è®¾ç½®å¤§ä¸ç¹çå¼ï¼2-4ï¼\ndiscovery.zen.ping.timeout: 3s\n#è®¾ç½®éç¾¤ä¸­èªå¨åç°å¶å®èç¹æ¶pingè¿æ¥è¶æ¶æ¶é´ï¼é»è®¤ä¸º3ç§ï¼å¯¹äºæ¯è¾å·®çç½ç»ç¯å¢å¯ä»¥é«ç¹çå¼æ¥é²æ­¢èªå¨åç°æ¶åºéã\ndiscovery.zen.ping.multicast.enabled: false\n#è®¾ç½®æ¯å¦æå¼å¤æ­åç°èç¹ï¼é»è®¤æ¯trueã\ndiscovery.zen.ping.unicast.hosts: [\'host1\', \'host2:port\', \'host3[portx-porty]\']\n#è®¾ç½®éç¾¤ä¸­masterèç¹çåå§åè¡¨ï¼å¯ä»¥éè¿è¿äºèç¹æ¥èªå¨åç°æ°å å¥éç¾¤çèç¹ã\n\n\n\n# 4. elasticsearch faq\n\n\n# 4.1. elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡\n\n**é®é¢ï¼**å¨ linux ç¯å¢ä¸­ï¼elasticsearch ä¸åè®¸ä»¥ root æéæ¥è¿è¡ã\n\nå¦æä»¥ root èº«ä»½è¿è¡ elasticsearchï¼ä¼æç¤ºè¿æ ·çéè¯¯ï¼\n\ncan not run elasticsearch as root\n\n\n**è§£å³æ¹æ³ï¼**ä½¿ç¨é root æéè´¦å·è¿è¡ elasticsearch\n\n# åå»ºç¨æ·ç»\ngroupadd elk\n# åå»ºæ°ç¨æ·ï¼-g elk è®¾ç½®å¶ç¨æ·ç»ä¸º elkï¼-p elk è®¾ç½®å¶å¯ç ä¸º elk\nuseradd elk -g elk -p elk\n# æ´æ¹ /opt æä»¶å¤¹ååé¨æä»¶çæå±ç¨æ·åç»ä¸º elk:elk\nchown -r elk:elk /opt # åè®¾ä½ ç elasticsearch å®è£å¨ opt ç®å½ä¸\n# åæ¢è´¦å·\nsu elk\n\n\n\n# 4.2. vm.max_map_count ä¸ä½äº 262144\n\né®é¢ï¼vm.max_map_count è¡¨ç¤ºèæåå­å¤§å°ï¼å®æ¯ä¸ä¸ªåæ ¸åæ°ãelasticsearch é»è®¤è¦æ± vm.max_map_count ä¸ä½äº 262144ã\n\nmax virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\n\n\nè§£å³æ¹æ³ï¼\n\nä½ å¯ä»¥æ§è¡ä»¥ä¸å½ä»¤ï¼è®¾ç½® vm.max_map_count ï¼ä½æ¯éå¯ååä¼æ¢å¤ä¸ºåå¼ã\n\nsysctl -w vm.max_map_count=262144\n\n\næä¹æ§çåæ³æ¯å¨ /etc/sysctl.conf æä»¶ä¸­ä¿®æ¹ vm.max_map_count åæ°ï¼\n\necho "vm.max_map_count=262144" > /etc/sysctl.conf\nsysctl -p\n\n\n> æ³¨æ\n> \n> å¦æè¿è¡ç¯å¢ä¸º docker å®¹å¨ï¼å¯è½ä¼éå¶æ§è¡ sysctl æ¥ä¿®æ¹åæ ¸åæ°ã\n> \n> è¿ç§æåµä¸ï¼ä½ åªè½éæ©ç´æ¥ä¿®æ¹å®¿ä¸»æºä¸çåæ°äºã\n\n\n# 4.3. nofile ä¸ä½äº 65536\n\né®é¢ï¼ nofile è¡¨ç¤ºè¿ç¨åè®¸æå¼çæå¤§æä»¶æ°ãelasticsearch è¿ç¨è¦æ±å¯ä»¥æå¼çæå¤§æä»¶æ°ä¸ä½äº 65536ã\n\nmax file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nofile åæ°ï¼\n\necho "* soft nofile 65536" > /etc/security/limits.conf\necho "* hard nofile 131072" > /etc/security/limits.conf\n\n\n\n# 4.4. nproc ä¸ä½äº 2048\n\né®é¢ï¼ nproc è¡¨ç¤ºæå¤§çº¿ç¨æ°ãelasticsearch è¦æ±æå¤§çº¿ç¨æ°ä¸ä½äº 2048ã\n\nmax number of threads [1024] for user [user] is too low, increase to at least [2048]\n\n\nè§£å³æ¹æ³ï¼\n\nå¨ /etc/security/limits.conf æä»¶ä¸­ä¿®æ¹ nproc åæ°ï¼\n\necho "* soft nproc 2048" > /etc/security/limits.conf\necho "* hard nproc 4096" > /etc/security/limits.conf\n\n\n\n# 5. åèèµæ\n\n * elasticsearch å®æ¹ä¸è½½å®è£è¯´æ\n * install elasticsearch with rpm\n * elasticsearch ä½¿ç¨ç§¯ç´¯',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elasticsearch æç¨",frontmatter:{title:"Elasticsearch æç¨",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elasticsearch"],permalink:"/pages/7324df/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/01.Elasticsearch/",relativePath:"07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/README.md",key:"v-31b667fe",path:"/pages/7324df/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:128},{level:3,title:"Elasticsearch é¢è¯æ»ç» ð¯",slug:"elasticsearch-é¢è¯æ»ç»-ð¯",normalizedTitle:"elasticsearch é¢è¯æ»ç» ð¯",charIndex:138},{level:3,title:"Elasticsearch å¿«éå¥é¨",slug:"elasticsearch-å¿«éå¥é¨",normalizedTitle:"elasticsearch å¿«éå¥é¨",charIndex:164},{level:3,title:"Elasticsearch ç®ä»",slug:"elasticsearch-ç®ä»",normalizedTitle:"elasticsearch ç®ä»",charIndex:187},{level:3,title:"Elasticsearch Rest API",slug:"elasticsearch-rest-api",normalizedTitle:"elasticsearch rest api",charIndex:208},{level:3,title:"ElasticSearch Java API ä¹ High Level REST Client",slug:"elasticsearch-java-api-ä¹-high-level-rest-client",normalizedTitle:"elasticsearch java api ä¹ high level rest client",charIndex:235},{level:3,title:"Elasticsearch ç´¢å¼ç®¡ç",slug:"elasticsearch-ç´¢å¼ç®¡ç",normalizedTitle:"elasticsearch ç´¢å¼ç®¡ç",charIndex:287},{level:3,title:"Elasticsearch æ¥è¯¢",slug:"elasticsearch-æ¥è¯¢",normalizedTitle:"elasticsearch æ¥è¯¢",charIndex:310},{level:3,title:"Elasticsearch é«äº®",slug:"elasticsearch-é«äº®",normalizedTitle:"elasticsearch é«äº®",charIndex:331},{level:3,title:"Elasticsearch æåº",slug:"elasticsearch-æåº",normalizedTitle:"elasticsearch æåº",charIndex:352},{level:3,title:"Elasticsearch èå",slug:"elasticsearch-èå",normalizedTitle:"elasticsearch èå",charIndex:373},{level:3,title:"Elasticsearch åæå¨",slug:"elasticsearch-åæå¨",normalizedTitle:"elasticsearch åæå¨",charIndex:394},{level:3,title:"Elasticsearch éç¾¤ååç",slug:"elasticsearch-éç¾¤ååç",normalizedTitle:"elasticsearch éç¾¤ååç",charIndex:416},{level:3,title:"Elasticsearch è¿ç»´",slug:"elasticsearch-è¿ç»´",normalizedTitle:"elasticsearch è¿ç»´",charIndex:440},{level:3,title:"Elasticsearch æ§è½ä¼å",slug:"elasticsearch-æ§è½ä¼å",normalizedTitle:"elasticsearch æ§è½ä¼å",charIndex:461},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:484},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:1086}],headersStr:"ð åå®¹ Elasticsearch é¢è¯æ»ç» ð¯ Elasticsearch å¿«éå¥é¨ Elasticsearch ç®ä» Elasticsearch Rest API ElasticSearch Java API ä¹ High Level REST Client Elasticsearch ç´¢å¼ç®¡ç Elasticsearch æ¥è¯¢ Elasticsearch é«äº® Elasticsearch æåº Elasticsearch èå Elasticsearch åæå¨ Elasticsearch éç¾¤ååç Elasticsearch è¿ç»´ Elasticsearch æ§è½ä¼å ð èµæ ðª ä¼ é",content:"# Elasticsearch æç¨\n\n> Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n\n# ð åå®¹\n\n\n# Elasticsearch é¢è¯æ»ç» ð¯\n\n\n# Elasticsearch å¿«éå¥é¨\n\n\n# Elasticsearch ç®ä»\n\n\n# Elasticsearch Rest API\n\n\n# ElasticSearch Java API ä¹ High Level REST Client\n\n\n# Elasticsearch ç´¢å¼ç®¡ç\n\n\n# Elasticsearch æ¥è¯¢\n\n\n# Elasticsearch é«äº®\n\n\n# Elasticsearch æåº\n\n\n# Elasticsearch èå\n\n\n# Elasticsearch åæå¨\n\n\n# Elasticsearch éç¾¤ååç\n\n\n# Elasticsearch è¿ç»´\n\n\n# Elasticsearch æ§è½ä¼å\n\n\n# ð èµæ\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Elasticsearch: The Definitive Guide - ElasticSearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãElasticsearch å®æã\n * æç¨\n   * ELK Stack æå¨æå\n   * Elasticsearch æç¨\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * Elasticsearch Performance Tuning Practice at eBay\n     * Elasticsearch at Kickstarter\n     * 9 tips on ElasticSearch configuration for high performance\n     * Elasticsearch In Productionâ-âDeployment Best Practices\n * æ´å¤èµæº\n   * GitHub: Awesome ElasticSearch\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# elasticsearch æç¨\n\n> elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n\n# ð åå®¹\n\n\n# elasticsearch é¢è¯æ»ç» ð¯\n\n\n# elasticsearch å¿«éå¥é¨\n\n\n# elasticsearch ç®ä»\n\n\n# elasticsearch rest api\n\n\n# elasticsearch java api ä¹ high level rest client\n\n\n# elasticsearch ç´¢å¼ç®¡ç\n\n\n# elasticsearch æ¥è¯¢\n\n\n# elasticsearch é«äº®\n\n\n# elasticsearch æåº\n\n\n# elasticsearch èå\n\n\n# elasticsearch åæå¨\n\n\n# elasticsearch éç¾¤ååç\n\n\n# elasticsearch è¿ç»´\n\n\n# elasticsearch æ§è½ä¼å\n\n\n# ð èµæ\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * elasticsearch: the definitive guide - elasticsearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãelasticsearch å®æã\n * æç¨\n   * elk stack æå¨æå\n   * elasticsearch æç¨\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n     * elasticsearch performance tuning practice at ebay\n     * elasticsearch at kickstarter\n     * 9 tips on elasticsearch configuration for high performance\n     * elasticsearch in productionâ-âdeployment best practices\n * æ´å¤èµæº\n   * github: awesome elasticsearch\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elastic å¿«éå¥é¨",frontmatter:{title:"Elastic å¿«éå¥é¨",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],permalink:"/pages/d5bdd0/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/01.Elastic%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/01.Elasticå¿«éå¥é¨.md",key:"v-39fdaf1c",path:"/pages/d5bdd0/",headers:[{level:2,title:"1. ç®ä»",slug:"_1-ç®ä»",normalizedTitle:"1. ç®ä»",charIndex:38},{level:3,title:"1.1. Elastic Stack æ¯ä»ä¹",slug:"_1-1-elastic-stack-æ¯ä»ä¹",normalizedTitle:"1.1. elastic stack æ¯ä»ä¹",charIndex:48},{level:3,title:"1.2. ä¸ºä»ä¹ä½¿ç¨ Elastic Stack",slug:"_1-2-ä¸ºä»ä¹ä½¿ç¨-elastic-stack",normalizedTitle:"1.2. ä¸ºä»ä¹ä½¿ç¨ elastic stack",charIndex:397},{level:3,title:"1.3. Elastic Stack æ¶æ",slug:"_1-3-elastic-stack-æ¶æ",normalizedTitle:"1.3. elastic stack æ¶æ",charIndex:563},{level:2,title:"2. ElasticSearch",slug:"_2-elasticsearch",normalizedTitle:"2. elasticsearch",charIndex:972},{level:3,title:"2.1. ElasticSearch ç®ä»",slug:"_2-1-elasticsearch-ç®ä»",normalizedTitle:"2.1. elasticsearch ç®ä»",charIndex:1105},{level:4,title:"2.1.1. æ ¸å¿æ¦å¿µ",slug:"_2-1-1-æ ¸å¿æ¦å¿µ",normalizedTitle:"2.1.1. æ ¸å¿æ¦å¿µ",charIndex:1379},{level:3,title:"2.2. ElasticSearch åç",slug:"_2-2-elasticsearch-åç",normalizedTitle:"2.2. elasticsearch åç",charIndex:2042},{level:4,title:"2.2.1. ES åæ°æ®è¿ç¨",slug:"_2-2-1-es-åæ°æ®è¿ç¨",normalizedTitle:"2.2.1. es åæ°æ®è¿ç¨",charIndex:2067},{level:4,title:"2.2.2. es è¯»æ°æ®è¿ç¨",slug:"_2-2-2-es-è¯»æ°æ®è¿ç¨",normalizedTitle:"2.2.2. es è¯»æ°æ®è¿ç¨",charIndex:2350},{level:4,title:"2.2.3. åæ°æ®åºå±åç",slug:"_2-2-3-åæ°æ®åºå±åç",normalizedTitle:"2.2.3. åæ°æ®åºå±åç",charIndex:2699},{level:4,title:"2.2.4. å é¤/æ´æ°æ°æ®åºå±åç",slug:"_2-2-4-å é¤-æ´æ°æ°æ®åºå±åç",normalizedTitle:"2.2.4. å é¤/æ´æ°æ°æ®åºå±åç",charIndex:4961},{level:4,title:"2.2.5. åºå± lucene",slug:"_2-2-5-åºå±-lucene",normalizedTitle:"2.2.5. åºå± lucene",charIndex:5407},{level:4,title:"2.2.6. åæç´¢å¼",slug:"_2-2-6-åæç´¢å¼",normalizedTitle:"2.2.6. åæç´¢å¼",charIndex:5586},{level:2,title:"3. Logstash",slug:"_3-logstash",normalizedTitle:"3. logstash",charIndex:6504},{level:3,title:"3.1. Logstash ç®ä»",slug:"_3-1-logstash-ç®ä»",normalizedTitle:"3.1. logstash ç®ä»",charIndex:6587},{level:3,title:"3.2. Logstash åç",slug:"_3-2-logstash-åç",normalizedTitle:"3.2. logstash åç",charIndex:6747},{level:2,title:"4. Beats",slug:"_4-beats",normalizedTitle:"4. beats",charIndex:7025},{level:3,title:"4.1. Filebeat ç®ä»",slug:"_4-1-filebeat-ç®ä»",normalizedTitle:"4.1. filebeat ç®ä»",charIndex:7332},{level:3,title:"4.2. Filebeat åç",slug:"_4-2-filebeat-åç",normalizedTitle:"4.2. filebeat åç",charIndex:7704},{level:2,title:"5. è¿ç»´",slug:"_5-è¿ç»´",normalizedTitle:"5. è¿ç»´",charIndex:8111},{level:2,title:"6. åèèµæ",slug:"_6-åèèµæ",normalizedTitle:"6. åèèµæ",charIndex:8182}],headersStr:"1. ç®ä» 1.1. Elastic Stack æ¯ä»ä¹ 1.2. ä¸ºä»ä¹ä½¿ç¨ Elastic Stack 1.3. Elastic Stack æ¶æ 2. ElasticSearch 2.1. ElasticSearch ç®ä» 2.1.1. æ ¸å¿æ¦å¿µ 2.2. ElasticSearch åç 2.2.1. ES åæ°æ®è¿ç¨ 2.2.2. es è¯»æ°æ®è¿ç¨ 2.2.3. åæ°æ®åºå±åç 2.2.4. å é¤/æ´æ°æ°æ®åºå±åç 2.2.5. åºå± lucene 2.2.6. åæç´¢å¼ 3. Logstash 3.1. Logstash ç®ä» 3.2. Logstash åç 4. Beats 4.1. Filebeat ç®ä» 4.2. Filebeat åç 5. è¿ç»´ 6. åèèµæ",content:"# Elastic å¿«éå¥é¨\n\n> å¼æºåè®®ï¼Apache 2.0\n\n\n# 1. ç®ä»\n\n\n# 1.1. Elastic Stack æ¯ä»ä¹\n\nElastic Stack å³ ELK Stackã\n\nELK æ¯æ Elastic å¬å¸æä¸ä¸æ¬¾äº§å ElasticSearch ãLogstash ãKibana çé¦å­æ¯ç»åã\n\n * Elasticsearch æ¯ä¸ä¸ªæç´¢ååæå¼æã\n * Logstash æ¯æå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°è¯¸å¦ Elasticsearch ç­âå­å¨åºâä¸­ã\n * Kibana åå¯ä»¥è®©ç¨æ·å¨ Elasticsearch ä¸­ä½¿ç¨å¾å½¢åå¾è¡¨å¯¹æ°æ®è¿è¡å¯è§åã\n\nè Elastic Stack æ¯ ELK Stack çæ´æ°æ¢ä»£äº§åï¼ææ°äº§åå¼å¥äºè½»éåçåä¸åè½æ°æ®ééå¨ï¼å¹¶æå®ä»¬å«å Beatsã\n\n\n# 1.2. ä¸ºä»ä¹ä½¿ç¨ Elastic Stack\n\nå¯¹äºæä¸å®è§æ¨¡çå¬å¸æ¥è¯´ï¼éå¸¸ä¼å¾å¤ä¸ªåºç¨ï¼å¹¶é¨ç½²å¨å¤§éçæå¡å¨ä¸ãè¿ç»´åå¼åäººåå¸¸å¸¸éè¦éè¿æ¥çæ¥å¿æ¥å®ä½é®é¢ãå¦æåºç¨æ¯éç¾¤åé¨ç½²ï¼è¯æ³å¦æç»å½ä¸å°å°æå¡å¨å»æ¥çæ¥å¿ï¼æ¯å¤ä¹è´¹æ¶è´¹åã\n\nèéè¿ ELK è¿å¥è§£å³æ¹æ¡ï¼å¯ä»¥åæ¶å®ç°æ¥å¿æ¶éãæ¥å¿æç´¢åæ¥å¿åæçåè½ã\n\n\n# 1.3. Elastic Stack æ¶æ\n\n\n\n> è¯´æ\n> \n> ä»¥ä¸æ¯ Elastic Stack çä¸ä¸ªæ¶æå¾ãä»å¾ä¸­å¯ä»¥æ¸æ¥ççå°æ°æ®æµåã\n> \n>  * Beats æ¯åä¸ç¨éçæ°æ®ä¼ è¾å¹³å°ï¼å®å¯ä»¥å°å¤å°æºå¨çæ°æ®åéå° Logstash æ ElasticSearchãä½ Beats å¹¶ä¸æ¯ä¸å¯æç¼ºçä¸ç¯ï¼æä»¥æ¬æä¸­æä¸ä»ç»ã\n> \n>  * Logstash æ¯ä¸ä¸ªå¨ææ°æ®æ¶éç®¡éãæ¯æä»¥ TCP/UDP/HTTP å¤ç§æ¹å¼æ¶éæ°æ®ï¼ä¹å¯ä»¥æ¥å Beats ä¼ è¾æ¥çæ°æ®ï¼ï¼å¹¶å¯¹æ°æ®åè¿ä¸æ­¥ä¸°å¯ææåå­æ®µå¤çã\n> \n>  * ElasticSearch æ¯ä¸ä¸ªåºäº JSON çåå¸å¼çæç´¢ååæå¼æãä½ä¸º ELK çæ ¸å¿ï¼å®éä¸­å­å¨æ°æ®ã\n> \n>  * Kibana æ¯ ELK çç¨æ·çé¢ãå®å°æ¶éçæ°æ®è¿è¡å¯è§åå±ç¤ºï¼åç§æ¥è¡¨ãå¾å½¢åæ°æ®ï¼ï¼å¹¶æä¾éç½®ãç®¡ç ELK ççé¢ã\n\n\n# 2. ElasticSearch\n\n> Elasticsearch æ¯ä¸ä¸ªåå¸å¼ãRESTful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º Elastic Stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# 2.1. ElasticSearch ç®ä»\n\nElasticsearch åºäºæç´¢åº Lucene å¼åãElasticSearch éèäº Lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç REST API / Java API æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç API æ¥å£ï¼ã\n\nElasticSearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º JSON å­å¨ã\n\nElasticSearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº ES æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n# 2.1.1. æ ¸å¿æ¦å¿µ\n\n * ç´¢å¼ï¼Indexï¼ å¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n * æ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n * å­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n * é»è®¤æåµä¸ï¼Elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n * æ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ï¼\n * å½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼Elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n * ä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n\n# 2.2. ElasticSearch åç\n\n# 2.2.1. ES åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n# 2.2.2. es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n# 2.2.3. åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ NRTï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n# 2.2.4. å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n# 2.2.5. åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ Java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n# 2.2.6. åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ IDï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ ID çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\nDOCID   DOC\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook\n2       è°·æ­å°å¾ä¹ç¶å ç Facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç Facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ Facebook ä¸ Wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« Facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nWORDID   WORD       DOCIDS\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        Facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ Facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# 3. Logstash\n\n> Logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 3.1. Logstash ç®ä»\n\nLogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\nLogstash æ¯ Elasticsearch çæä½³æ°æ®ç®¡éã\n\nLogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãLogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# 3.2. Logstash åç\n\nLogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ Logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input - è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter - å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output - å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãLogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\n\n# 4. Beats\n\n> Beats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n> \n> Beats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° Elasticsearch æä¼ è¾å° Logstash ã\n\n\n\nBeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **Packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **Filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **Metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **Winlogbeatï¼**æä¾ Windows äºä»¶æ¥å¿ã\n\n\n# 4.1. Filebeat ç®ä»\n\n> ç±äºæ¬äººä»æ¥è§¦è¿ Filebeatï¼æä»¥æ¬æåªä»ç» Beats ç»ä»¶ä¸­ç Filebeatã\n\nç¸æ¯ Logstashï¼FileBeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã Filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nFilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼Apacheï¼Nginxï¼System å MySQLï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nFileBeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãFileBeat å¦ææ¯å Logstash ä¼ è¾æ°æ®ï¼å½ Logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# 4.2. Filebeat åç\n\nFilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\n * harvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n * prospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nFilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nFilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# 5. è¿ç»´\n\n * ElasticSearch è¿ç»´\n * Logstash è¿ç»´\n * Kibana è¿ç»´\n * Beats è¿ç»´\n\n\n# 6. åèèµæ\n\n * å®æ¹èµæº\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Logstash å®ç½\n   * Logstash Github\n   * Logstash å®æ¹ææ¡£\n   * Kibana å®ç½\n   * Kibana Github\n   * Kibana å®æ¹ææ¡£\n   * Beats å®ç½\n   * Beats Github\n   * Beats å®æ¹ææ¡£\n * æç« \n   * ä»ä¹æ¯ ELK Stackï¼\n   * https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/es-introduction.md\n   * es-write-query-search",normalizedContent:"# elastic å¿«éå¥é¨\n\n> å¼æºåè®®ï¼apache 2.0\n\n\n# 1. ç®ä»\n\n\n# 1.1. elastic stack æ¯ä»ä¹\n\nelastic stack å³ elk stackã\n\nelk æ¯æ elastic å¬å¸æä¸ä¸æ¬¾äº§å elasticsearch ãlogstash ãkibana çé¦å­æ¯ç»åã\n\n * elasticsearch æ¯ä¸ä¸ªæç´¢ååæå¼æã\n * logstash æ¯æå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°è¯¸å¦ elasticsearch ç­âå­å¨åºâä¸­ã\n * kibana åå¯ä»¥è®©ç¨æ·å¨ elasticsearch ä¸­ä½¿ç¨å¾å½¢åå¾è¡¨å¯¹æ°æ®è¿è¡å¯è§åã\n\nè elastic stack æ¯ elk stack çæ´æ°æ¢ä»£äº§åï¼ææ°äº§åå¼å¥äºè½»éåçåä¸åè½æ°æ®ééå¨ï¼å¹¶æå®ä»¬å«å beatsã\n\n\n# 1.2. ä¸ºä»ä¹ä½¿ç¨ elastic stack\n\nå¯¹äºæä¸å®è§æ¨¡çå¬å¸æ¥è¯´ï¼éå¸¸ä¼å¾å¤ä¸ªåºç¨ï¼å¹¶é¨ç½²å¨å¤§éçæå¡å¨ä¸ãè¿ç»´åå¼åäººåå¸¸å¸¸éè¦éè¿æ¥çæ¥å¿æ¥å®ä½é®é¢ãå¦æåºç¨æ¯éç¾¤åé¨ç½²ï¼è¯æ³å¦æç»å½ä¸å°å°æå¡å¨å»æ¥çæ¥å¿ï¼æ¯å¤ä¹è´¹æ¶è´¹åã\n\nèéè¿ elk è¿å¥è§£å³æ¹æ¡ï¼å¯ä»¥åæ¶å®ç°æ¥å¿æ¶éãæ¥å¿æç´¢åæ¥å¿åæçåè½ã\n\n\n# 1.3. elastic stack æ¶æ\n\n\n\n> è¯´æ\n> \n> ä»¥ä¸æ¯ elastic stack çä¸ä¸ªæ¶æå¾ãä»å¾ä¸­å¯ä»¥æ¸æ¥ççå°æ°æ®æµåã\n> \n>  * beats æ¯åä¸ç¨éçæ°æ®ä¼ è¾å¹³å°ï¼å®å¯ä»¥å°å¤å°æºå¨çæ°æ®åéå° logstash æ elasticsearchãä½ beats å¹¶ä¸æ¯ä¸å¯æç¼ºçä¸ç¯ï¼æä»¥æ¬æä¸­æä¸ä»ç»ã\n> \n>  * logstash æ¯ä¸ä¸ªå¨ææ°æ®æ¶éç®¡éãæ¯æä»¥ tcp/udp/http å¤ç§æ¹å¼æ¶éæ°æ®ï¼ä¹å¯ä»¥æ¥å beats ä¼ è¾æ¥çæ°æ®ï¼ï¼å¹¶å¯¹æ°æ®åè¿ä¸æ­¥ä¸°å¯ææåå­æ®µå¤çã\n> \n>  * elasticsearch æ¯ä¸ä¸ªåºäº json çåå¸å¼çæç´¢ååæå¼æãä½ä¸º elk çæ ¸å¿ï¼å®éä¸­å­å¨æ°æ®ã\n> \n>  * kibana æ¯ elk çç¨æ·çé¢ãå®å°æ¶éçæ°æ®è¿è¡å¯è§åå±ç¤ºï¼åç§æ¥è¡¨ãå¾å½¢åæ°æ®ï¼ï¼å¹¶æä¾éç½®ãç®¡ç elk ççé¢ã\n\n\n# 2. elasticsearch\n\n> elasticsearch æ¯ä¸ä¸ªåå¸å¼ãrestful é£æ ¼çæç´¢åæ°æ®åæå¼æï¼è½å¤è§£å³ä¸æ­æ¶ç°åºçåç§ç¨ä¾ã ä½ä¸º elastic stack çæ ¸å¿ï¼å®éä¸­å­å¨æ¨çæ°æ®ï¼å¸®å©æ¨åç°ææä¹ä¸­ä»¥åææä¹å¤çæåµã\n\n\n# 2.1. elasticsearch ç®ä»\n\nelasticsearch åºäºæç´¢åº lucene å¼åãelasticsearch éèäº lucene çå¤ææ§ï¼æä¾äºç®åæç¨ç rest api / java api æ¥å£ï¼å¦å¤è¿æå¶ä»è¯­è¨ç api æ¥å£ï¼ã\n\nelasticsearch å¯ä»¥è§ä¸ºä¸ä¸ªææ¡£å­å¨ï¼å®å°å¤ææ°æ®ç»æåºååä¸º json å­å¨ã\n\nelasticsearch æ¯è¿ä¹äºå®æ¶çå¨ææç´ ï¼è¿æ¯æï¼\n\n * ä»åå¥æ°æ®å°æ°æ®å¯ä»¥è¢«æç´¢ï¼å­å¨è¾å°çå»¶è¿ï¼å¤§æ¦æ¯ 1sï¼\n * åºäº es æ§è¡æç´¢ååæå¯ä»¥è¾¾å°ç§çº§\n\n# 2.1.1. æ ¸å¿æ¦å¿µ\n\n * ç´¢å¼ï¼indexï¼ å¯ä»¥è®¤ä¸ºæ¯ææ¡£ï¼documentï¼çä¼åéåã\n * æ¯ä¸ª ææ¡£ï¼documentï¼ é½æ¯å­æ®µï¼fieldï¼çéåã\n * å­æ®µï¼fieldï¼ æ¯åå«æ°æ®çé®å¼å¯¹ã\n * é»è®¤æåµä¸ï¼elasticsearch å¯¹æ¯ä¸ªå­æ®µä¸­çæææ°æ®å»ºç«ç´¢å¼ï¼å¹¶ä¸æ¯ä¸ªç´¢å¼å­æ®µé½å·æä¸ç¨çä¼åæ°æ®ç»æã\n * æ¯ä¸ªç´¢å¼éå¯ä»¥æä¸ä¸ªæèå¤ä¸ªç±»åï¼typeï¼ãç±»åï¼typeï¼ æ¯ index çä¸ä¸ªé»è¾åç±»ï¼\n * å½åå°æºå¨ä¸è¶³ä»¥å­å¨å¤§éæ°æ®æ¶ï¼elasticsearch å¯ä»¥å°ä¸ä¸ªç´¢å¼ä¸­çæ°æ®ååä¸ºå¤ä¸ª åçï¼shardï¼ ã åçï¼shardï¼ åå¸å¨å¤å°æå¡å¨ä¸å­å¨ãæäº shard å°±å¯ä»¥æ¨ªåæ©å±ï¼å­å¨æ´å¤æ°æ®ï¼è®©æç´¢ååæç­æä½åå¸å°å¤å°æå¡å¨ä¸å»æ§è¡ï¼æåååéåæ§è½ãæ¯ä¸ª shard é½æ¯ä¸ä¸ª lucene indexã\n * ä»»ä½ä¸ä¸ªæå¡å¨éæ¶å¯è½æéæå®æºï¼æ­¤æ¶ shard å¯è½å°±ä¼ä¸¢å¤±ï¼å æ­¤å¯ä»¥ä¸ºæ¯ä¸ª shard åå»ºå¤ä¸ª å¯æ¬ï¼replicaï¼ãreplica å¯ä»¥å¨ shard æéæ¶æä¾å¤ç¨æå¡ï¼ä¿è¯æ°æ®ä¸ä¸¢å¤±ï¼å¤ä¸ª replica è¿å¯ä»¥æåæç´¢æä½çååéåæ§è½ãprimary shardï¼å»ºç«ç´¢å¼æ¶ä¸æ¬¡è®¾ç½®ï¼ä¸è½ä¿®æ¹ï¼é»è®¤ 5 ä¸ªï¼ï¼replica shardï¼éæ¶ä¿®æ¹æ°éï¼é»è®¤ 1 ä¸ªï¼ï¼é»è®¤æ¯ä¸ªç´¢å¼ 10 ä¸ª shardï¼5 ä¸ª primary shardï¼5 ä¸ª replica shardï¼æå°çé«å¯ç¨éç½®ï¼æ¯ 2 å°æå¡å¨ã\n\n\n# 2.2. elasticsearch åç\n\n# 2.2.1. es åæ°æ®è¿ç¨\n\n * å®¢æ·ç«¯éæ©ä¸ä¸ª node åéè¯·æ±è¿å»ï¼è¿ä¸ª node å°±æ¯ coordinating nodeï¼åè°èç¹ï¼ã\n * coordinating node å¯¹ document è¿è¡è·¯ç±ï¼å°è¯·æ±è½¬åç»å¯¹åºç nodeï¼æ primary shardï¼ã\n * å®éç node ä¸ç primary shard å¤çè¯·æ±ï¼ç¶åå°æ°æ®åæ­¥å° replica nodeã\n * coordinating node å¦æåç° primary node åææ replica node é½æå®ä¹åï¼å°±è¿åååºç»æç»å®¢æ·ç«¯ã\n\n\n\n# 2.2.2. es è¯»æ°æ®è¿ç¨\n\nå¯ä»¥éè¿ doc id æ¥æ¥è¯¢ï¼ä¼æ ¹æ® doc id è¿è¡ hashï¼å¤æ­åºæ¥å½æ¶æ doc id åéå°äºåªä¸ª shard ä¸é¢å»ï¼ä»é£ä¸ª shard å»æ¥è¯¢ã\n\n * å®¢æ·ç«¯åéè¯·æ±å°ä»»æä¸ä¸ª nodeï¼æä¸º coordinate nodeã\n * coordinate node å¯¹ doc id è¿è¡åå¸è·¯ç±ï¼å°è¯·æ±è½¬åå°å¯¹åºç nodeï¼æ­¤æ¶ä¼ä½¿ç¨ round-robin éæºè½®è¯¢ç®æ³ï¼å¨ primary shard ä»¥åå¶ææ replica ä¸­éæºéæ©ä¸ä¸ªï¼è®©è¯»è¯·æ±è´è½½åè¡¡ã\n * æ¥æ¶è¯·æ±ç node è¿å document ç» coordinate nodeã\n * coordinate node è¿å document ç»å®¢æ·ç«¯ã\n\n# 2.2.3. åæ°æ®åºå±åç\n\n\n\nååå¥åå­ bufferï¼å¨ buffer éçæ¶åæ°æ®æ¯æç´¢ä¸å°çï¼åæ¶å°æ°æ®åå¥ translog æ¥å¿æä»¶ã\n\nå¦æ buffer å¿«æ»¡äºï¼æèå°ä¸å®æ¶é´ï¼å°±ä¼å°åå­ buffer æ°æ® refresh å°ä¸ä¸ªæ°ç segment file ä¸­ï¼ä½æ¯æ­¤æ¶æ°æ®ä¸æ¯ç´æ¥è¿å¥ segment file ç£çæä»¶ï¼èæ¯åè¿å¥ os cache ãè¿ä¸ªè¿ç¨å°±æ¯ refreshã\n\næ¯é 1 ç§éï¼es å° buffer ä¸­çæ°æ®åå¥ä¸ä¸ªæ°ç segment fileï¼æ¯ç§éä¼äº§çä¸ä¸ªæ°çç£çæä»¶ segment fileï¼è¿ä¸ª segment file ä¸­å°±å­å¨æè¿ 1 ç§å buffer ä¸­åå¥çæ°æ®ã\n\nä½æ¯å¦æ buffer éé¢æ­¤æ¶æ²¡ææ°æ®ï¼é£å½ç¶ä¸ä¼æ§è¡ refresh æä½ï¼å¦æ buffer éé¢ææ°æ®ï¼é»è®¤ 1 ç§éæ§è¡ä¸æ¬¡ refresh æä½ï¼å·å¥ä¸ä¸ªæ°ç segment file ä¸­ã\n\næä½ç³»ç»éé¢ï¼ç£çæä»¶å¶å®é½æä¸ä¸ªä¸è¥¿ï¼å«å os cacheï¼å³æä½ç³»ç»ç¼å­ï¼å°±æ¯è¯´æ°æ®åå¥ç£çæä»¶ä¹åï¼ä¼åè¿å¥ os cacheï¼åè¿å¥æä½ç³»ç»çº§å«çä¸ä¸ªåå­ç¼å­ä¸­å»ãåªè¦ buffer ä¸­çæ°æ®è¢« refresh æä½å·å¥ os cacheä¸­ï¼è¿ä¸ªæ°æ®å°±å¯ä»¥è¢«æç´¢å°äºã\n\nä¸ºä»ä¹å« es æ¯åå®æ¶çï¼ nrtï¼å¨ç§° near real-timeãé»è®¤æ¯æ¯é 1 ç§ refresh ä¸æ¬¡çï¼æä»¥ es æ¯åå®æ¶çï¼å ä¸ºåå¥çæ°æ® 1 ç§ä¹åæè½è¢«çå°ãå¯ä»¥éè¿ es ç restful api æè java apiï¼æå¨æ§è¡ä¸æ¬¡ refresh æä½ï¼å°±æ¯æå¨å° buffer ä¸­çæ°æ®å·å¥ os cacheä¸­ï¼è®©æ°æ®ç«é©¬å°±å¯ä»¥è¢«æç´¢å°ãåªè¦æ°æ®è¢«è¾å¥ os cache ä¸­ï¼buffer å°±ä¼è¢«æ¸ç©ºäºï¼å ä¸ºä¸éè¦ä¿ç buffer äºï¼æ°æ®å¨ translog éé¢å·²ç»æä¹åå°ç£çå»ä¸ä»½äºã\n\néå¤ä¸é¢çæ­¥éª¤ï¼æ°çæ°æ®ä¸æ­è¿å¥ buffer å translogï¼ä¸æ­å° buffer æ°æ®åå¥ä¸ä¸ªåä¸ä¸ªæ°ç segment file ä¸­å»ï¼æ¯æ¬¡ refresh å® buffer æ¸ç©ºï¼translog ä¿çãéçè¿ä¸ªè¿ç¨æ¨è¿ï¼translog ä¼åå¾è¶æ¥è¶å¤§ãå½ translog è¾¾å°ä¸å®é¿åº¦çæ¶åï¼å°±ä¼è§¦å commit æä½ã\n\ncommit æä½åçç¬¬ä¸æ­¥ï¼å°±æ¯å° buffer ä¸­ç°ææ°æ® refresh å° os cache ä¸­å»ï¼æ¸ç©º bufferãç¶åï¼å°ä¸ä¸ª commit point åå¥ç£çæä»¶ï¼éé¢æ è¯çè¿ä¸ª commit point å¯¹åºçææ segment fileï¼åæ¶å¼ºè¡å° os cache ä¸­ç®åææçæ°æ®é½ fsync å°ç£çæä»¶ä¸­å»ãæåæ¸ç©º ç°æ translog æ¥å¿æä»¶ï¼éå¯ä¸ä¸ª translogï¼æ­¤æ¶ commit æä½å®æã\n\nè¿ä¸ª commit æä½å«å flushãé»è®¤ 30 åéèªå¨æ§è¡ä¸æ¬¡ flushï¼ä½å¦æ translog è¿å¤§ï¼ä¹ä¼è§¦å flushãflush æä½å°±å¯¹åºç commit çå¨è¿ç¨ï¼æä»¬å¯ä»¥éè¿ es apiï¼æå¨æ§è¡ flush æä½ï¼æå¨å° os cache ä¸­çæ°æ® fsync å¼ºå·å°ç£çä¸å»ã\n\ntranslog æ¥å¿æä»¶çä½ç¨æ¯ä»ä¹ï¼ä½ æ§è¡ commit æä½ä¹åï¼æ°æ®è¦ä¹æ¯åçå¨ buffer ä¸­ï¼è¦ä¹æ¯åçå¨ os cache ä¸­ï¼æ è®ºæ¯ buffer è¿æ¯ os cache é½æ¯åå­ï¼ä¸æ¦è¿å°æºå¨æ­»äºï¼åå­ä¸­çæ°æ®å°±å¨ä¸¢äºãæä»¥éè¦å°æ°æ®å¯¹åºçæä½åå¥ä¸ä¸ªä¸é¨çæ¥å¿æä»¶ translog ä¸­ï¼ä¸æ¦æ­¤æ¶æºå¨å®æºï¼åæ¬¡éå¯çæ¶åï¼es ä¼èªå¨è¯»å translog æ¥å¿æä»¶ä¸­çæ°æ®ï¼æ¢å¤å°åå­ buffer å os cache ä¸­å»ã\n\ntranslog å¶å®ä¹æ¯ååå¥ os cache çï¼é»è®¤æ¯é 5 ç§å·ä¸æ¬¡å°ç£çä¸­å»ï¼æä»¥é»è®¤æåµä¸ï¼å¯è½æ 5 ç§çæ°æ®ä¼ä»ä»åçå¨ buffer æè translog æä»¶ç os cache ä¸­ï¼å¦ææ­¤æ¶æºå¨æäºï¼ä¼ä¸¢å¤± 5 ç§éçæ°æ®ãä½æ¯è¿æ ·æ§è½æ¯è¾å¥½ï¼æå¤ä¸¢ 5 ç§çæ°æ®ãä¹å¯ä»¥å° translog è®¾ç½®ææ¯æ¬¡åæä½å¿é¡»æ¯ç´æ¥ fsync å°ç£çï¼ä½æ¯æ§è½ä¼å·®å¾å¤ã\n\nå®éä¸ä½ å¨è¿éï¼å¦æé¢è¯å®æ²¡æé®ä½  es ä¸¢æ°æ®çé®é¢ï¼ä½ å¯ä»¥å¨è¿éç»é¢è¯å®ç«ä¸æï¼ä½ è¯´ï¼å¶å® es ç¬¬ä¸æ¯åå®æ¶çï¼æ°æ®åå¥ 1 ç§åå¯ä»¥æç´¢å°ï¼å¯è½ä¼ä¸¢å¤±æ°æ®çãæ 5 ç§çæ°æ®ï¼åçå¨ bufferãtranslog os cacheãsegment file os cache ä¸­ï¼èä¸å¨ç£çä¸ï¼æ­¤æ¶å¦æå®æºï¼ä¼å¯¼è´ 5 ç§çæ°æ®ä¸¢å¤±ã\n\næ»ç»ä¸ä¸ï¼æ°æ®ååå¥åå­ bufferï¼ç¶åæ¯é 1sï¼å°æ°æ® refresh å° os cacheï¼å°äº os cache æ°æ®å°±è½è¢«æç´¢å°ï¼æä»¥æä»¬æè¯´ es ä»åå¥å°è½è¢«æç´¢å°ï¼ä¸­é´æ 1s çå»¶è¿ï¼ãæ¯é 5sï¼å°æ°æ®åå¥ translog æä»¶ï¼è¿æ ·å¦ææºå¨å®æºï¼åå­æ°æ®å¨æ²¡ï¼æå¤ä¼æ 5s çæ°æ®ä¸¢å¤±ï¼ï¼translog å¤§å°ä¸å®ç¨åº¦ï¼æèé»è®¤æ¯é 30minsï¼ä¼è§¦å commit æä½ï¼å°ç¼å²åºçæ°æ®é½ flush å° segment file ç£çæä»¶ä¸­ã\n\n> æ°æ®åå¥ segment file ä¹åï¼åæ¶å°±å»ºç«å¥½äºåæç´¢å¼ã\n\n# 2.2.4. å é¤/æ´æ°æ°æ®åºå±åç\n\nå¦ææ¯å é¤æä½ï¼commit çæ¶åä¼çæä¸ä¸ª .del æä»¶ï¼éé¢å°æä¸ª doc æ è¯ä¸º deleted ç¶æï¼é£ä¹æç´¢çæ¶åæ ¹æ® .del æä»¶å°±ç¥éè¿ä¸ª doc æ¯å¦è¢«å é¤äºã\n\nå¦ææ¯æ´æ°æä½ï¼å°±æ¯å°åæ¥ç doc æ è¯ä¸º deleted ç¶æï¼ç¶åæ°åå¥ä¸æ¡æ°æ®ã\n\nbuffer æ¯ refresh ä¸æ¬¡ï¼å°±ä¼äº§çä¸ä¸ª segment fileï¼æä»¥é»è®¤æåµä¸æ¯ 1 ç§éä¸ä¸ª segment fileï¼è¿æ ·ä¸æ¥ segment file ä¼è¶æ¥è¶å¤ï¼æ­¤æ¶ä¼å®ææ§è¡ mergeãæ¯æ¬¡ merge çæ¶åï¼ä¼å°å¤ä¸ª segment file åå¹¶æä¸ä¸ªï¼åæ¶è¿éä¼å°æ è¯ä¸º deleted ç doc ç»ç©çå é¤æï¼ç¶åå°æ°ç segment file åå¥ç£çï¼è¿éä¼åä¸ä¸ª commit pointï¼æ è¯æææ°ç segment fileï¼ç¶åæå¼ segment file ä¾æç´¢ä½¿ç¨ï¼åæ¶å é¤æ§ç segment fileã\n\n# 2.2.5. åºå± lucene\n\nç®åæ¥è¯´ï¼lucene å°±æ¯ä¸ä¸ª jar åï¼éé¢åå«äºå°è£å¥½çåç§å»ºç«åæç´¢å¼çç®æ³ä»£ç ãæä»¬ç¨ java å¼åçæ¶åï¼å¼å¥ lucene jarï¼ç¶ååºäº lucene ç api å»å¼åå°±å¯ä»¥äºã\n\néè¿ luceneï¼æä»¬å¯ä»¥å°å·²æçæ°æ®å»ºç«ç´¢å¼ï¼lucene ä¼å¨æ¬å°ç£çä¸é¢ï¼ç»æä»¬ç»ç»ç´¢å¼çæ°æ®ç»æã\n\n# 2.2.6. åæç´¢å¼\n\nå¨æç´¢å¼æä¸­ï¼æ¯ä¸ªææ¡£é½æä¸ä¸ªå¯¹åºçææ¡£ idï¼ææ¡£åå®¹è¢«è¡¨ç¤ºä¸ºä¸ç³»åå³é®è¯çéåãä¾å¦ï¼ææ¡£ 1 ç»è¿åè¯ï¼æåäº 20 ä¸ªå³é®è¯ï¼æ¯ä¸ªå³é®è¯é½ä¼è®°å½å®å¨ææ¡£ä¸­åºç°çæ¬¡æ°ååºç°ä½ç½®ã\n\né£ä¹ï¼åæç´¢å¼å°±æ¯å³é®è¯å°ææ¡£ id çæ å°ï¼æ¯ä¸ªå³é®è¯é½å¯¹åºçä¸ç³»åçæä»¶ï¼è¿äºæä»¶ä¸­é½åºç°äºå³é®è¯ã\n\nä¸¾ä¸ªæ å­ã\n\næä»¥ä¸ææ¡£ï¼\n\ndocid   doc\n1       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook\n2       è°·æ­å°å¾ä¹ç¶å ç facebook\n3       è°·æ­å°å¾åå§äººææ¯ç¦»å¼è°·æ­å ç facebook\n4       è°·æ­å°å¾ä¹ç¶è·³æ§½ facebook ä¸ wave é¡¹ç®åæ¶æå³\n5       è°·æ­å°å¾ä¹ç¶ææ¯å çç¤¾äº¤ç½ç« facebook\n\nå¯¹ææ¡£è¿è¡åè¯ä¹åï¼å¾å°ä»¥ä¸åæç´¢å¼ã\n\nwordid   word       docids\n1        è°·æ­         1,2,3,4,5\n2        å°å¾         1,2,3,4,5\n3        ä¹ç¶         1,2,4,5\n4        è·³æ§½         1,4\n5        facebook   1,2,3,4,5\n6        å ç         2,3,5\n7        åå§äºº        3\n8        ææ¯         3,5\n9        ç¦»å¼         3\n10       ä¸          4\n..       ..         ..\n\nå¦å¤ï¼å®ç¨çåæç´¢å¼è¿å¯ä»¥è®°å½æ´å¤çä¿¡æ¯ï¼æ¯å¦ææ¡£é¢çä¿¡æ¯ï¼è¡¨ç¤ºå¨ææ¡£éåä¸­æå¤å°ä¸ªææ¡£åå«æä¸ªåè¯ã\n\né£ä¹ï¼æäºåæç´¢å¼ï¼æç´¢å¼æå¯ä»¥å¾æ¹ä¾¿å°ååºç¨æ·çæ¥è¯¢ãæ¯å¦ç¨æ·è¾å¥æ¥è¯¢ facebookï¼æç´¢ç³»ç»æ¥æ¾åæç´¢å¼ï¼ä»ä¸­è¯»åºåå«è¿ä¸ªåè¯çææ¡£ï¼è¿äºææ¡£å°±æ¯æä¾ç»ç¨æ·çæç´¢ç»æã\n\nè¦æ³¨æåæç´¢å¼çä¸¤ä¸ªéè¦ç»èï¼\n\n * åæç´¢å¼ä¸­çææè¯é¡¹å¯¹åºä¸ä¸ªæå¤ä¸ªææ¡£ï¼\n * åæç´¢å¼ä¸­çè¯é¡¹æ ¹æ®å­å¸é¡ºåºååºæå\n\n> ä¸é¢åªæ¯ä¸ä¸ªç®åçæ å­ï¼å¹¶æ²¡æä¸¥æ ¼æç§å­å¸é¡ºåºååºæåã\n\n\n# 3. logstash\n\n> logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 3.1. logstash ç®ä»\n\nlogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\nlogstash æ¯ elasticsearch çæä½³æ°æ®ç®¡éã\n\nlogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãlogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# 3.2. logstash åç\n\nlogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input - è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter - å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output - å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãlogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\n\n# 4. beats\n\n> beats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n> \n> beats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° elasticsearch æä¼ è¾å° logstash ã\n\n\n\nbeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **winlogbeatï¼**æä¾ windows äºä»¶æ¥å¿ã\n\n\n# 4.1. filebeat ç®ä»\n\n> ç±äºæ¬äººä»æ¥è§¦è¿ filebeatï¼æä»¥æ¬æåªä»ç» beats ç»ä»¶ä¸­ç filebeatã\n\nç¸æ¯ logstashï¼filebeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nfilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼apacheï¼nginxï¼system å mysqlï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nfilebeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãfilebeat å¦ææ¯å logstash ä¼ è¾æ°æ®ï¼å½ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# 4.2. filebeat åç\n\nfilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\n * harvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n * prospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nfilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nfilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# 5. è¿ç»´\n\n * elasticsearch è¿ç»´\n * logstash è¿ç»´\n * kibana è¿ç»´\n * beats è¿ç»´\n\n\n# 6. åèèµæ\n\n * å®æ¹èµæº\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * logstash å®ç½\n   * logstash github\n   * logstash å®æ¹ææ¡£\n   * kibana å®ç½\n   * kibana github\n   * kibana å®æ¹ææ¡£\n   * beats å®ç½\n   * beats github\n   * beats å®æ¹ææ¡£\n * æç« \n   * ä»ä¹æ¯ elk stackï¼\n   * https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/es-introduction.md\n   * es-write-query-search",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elastic ææ¯æ ä¹ Filebeat",frontmatter:{title:"Elastic ææ¯æ ä¹ Filebeat",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Filebeat"],permalink:"/pages/3efdd8/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/02.Elastic%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B9%8BFilebeat.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/02.Elasticææ¯æ ä¹Filebeat.md",key:"v-4bfc28c7",path:"/pages/3efdd8/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:28},{level:3,title:"FileBeat çä½ç¨",slug:"filebeat-çä½ç¨",normalizedTitle:"filebeat çä½ç¨",charIndex:421},{level:2,title:"å®è£",slug:"å®è£",normalizedTitle:"å®è£",charIndex:39},{level:2,title:"éç½®",slug:"éç½®",normalizedTitle:"éç½®",charIndex:963},{level:3,title:"éç½®æä»¶",slug:"éç½®æä»¶",normalizedTitle:"éç½®æä»¶",charIndex:970},{level:3,title:"éè¦éç½®é¡¹",slug:"éè¦éç½®é¡¹",normalizedTitle:"éè¦éç½®é¡¹",charIndex:1346},{level:4,title:"filebeat.prospectors",slug:"filebeat-prospectors",normalizedTitle:"filebeat.prospectors",charIndex:1355},{level:4,title:"output.elasticsearch",slug:"output-elasticsearch",normalizedTitle:"output.elasticsearch",charIndex:1494},{level:4,title:"output.logstash",slug:"output-logstash",normalizedTitle:"output.logstash",charIndex:1646},{level:4,title:"setup.kibana",slug:"setup-kibana",normalizedTitle:"setup.kibana",charIndex:2432},{level:4,title:"setup.template.settings",slug:"setup-template-settings",normalizedTitle:"setup.template.settings",charIndex:2545},{level:4,title:"setup.dashboards",slug:"setup-dashboards",normalizedTitle:"setup.dashboards",charIndex:2925},{level:2,title:"å½ä»¤",slug:"å½ä»¤",normalizedTitle:"å½ä»¤",charIndex:589},{level:2,title:"æ¨¡å",slug:"æ¨¡å",normalizedTitle:"æ¨¡å",charIndex:543},{level:3,title:"è¿è¡æ¨¡åçæ­¥éª¤",slug:"è¿è¡æ¨¡åçæ­¥éª¤",normalizedTitle:"è¿è¡æ¨¡åçæ­¥éª¤",charIndex:3647},{level:2,title:"åç",slug:"åç",normalizedTitle:"åç",charIndex:4094},{level:2,title:"èµæ",slug:"èµæ",normalizedTitle:"èµæ",charIndex:4482}],headersStr:"ç®ä» FileBeat çä½ç¨ å®è£ éç½® éç½®æä»¶ éè¦éç½®é¡¹ filebeat.prospectors output.elasticsearch output.logstash setup.kibana setup.template.settings setup.dashboards å½ä»¤ æ¨¡å è¿è¡æ¨¡åçæ­¥éª¤ åç èµæ",content:'# Elastic ææ¯æ ä¹ Filebeat\n\n\n# ç®ä»\n\nBeats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n\nBeats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° Elasticsearch æä¼ è¾å° Logstash ã\n\n\n\nBeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **Packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **Filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **Metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **Winlogbeatï¼**æä¾ Windows äºä»¶æ¥å¿ã\n\n> åè\n> \n> æ´å¤ Beats ç±»åå¯ä»¥åèï¼community-beats\n> \n> è¯´æ\n> \n> ç±äºæ¬äººå·¥ä½ä¸­åªåºç¨äº FileBeatï¼æä»¥åé¢åå®¹ä»ä»ç» FileBeat ã\n\n\n# FileBeat çä½ç¨\n\nç¸æ¯ Logstashï¼FileBeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã Filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nFilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼Apacheï¼Nginxï¼System å MySQLï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nFileBeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãFileBeat å¦ææ¯å Logstash ä¼ è¾æ°æ®ï¼å½ Logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# å®è£\n\nUnix / Linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# éç½®\n\n\n# éç½®æä»¶\n\né¦åï¼éè¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãéç½®æä»¶çè·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼çä¸åèååã\n\nBeat ææç³»åäº§åçéç½®æä»¶é½åºäº YAML æ ¼å¼ï¼FileBeat å½ç¶ä¹ä¸ä¾å¤ã\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n> åè\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n\n# éè¦éç½®é¡¹\n\n# filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# The filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# setup.kibana\n\nå¦ææç®ä½¿ç¨ Filebeat æä¾ç Kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# setup.template.settings\n\nå¨ Elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ Filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nFilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± Filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼Filebeat å¨æåè¿æ¥å° Elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ Filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ Filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# setup.dashboards\n\nFilebeat éå¸¦äºç¤ºä¾ Kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° Kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ Kibana ä¸­å è½½ Filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat COMMAND\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# æ¨¡å\n\nFilebeat æä¾äºä¸å¥é¢æå»ºçæ¨¡åï¼è®©æ¨å¯ä»¥å¿«éå®æ½åé¨ç½²æ¥å¿çè§è§£å³æ¹æ¡ï¼å¹¶éå¸¦ç¤ºä¾ä»ªè¡¨æ¿åæ°æ®å¯è§åãè¿äºæ¨¡åæ¯æå¸¸è§çæ¥å¿æ ¼å¼ï¼ä¾å¦ Nginxï¼Apache2 å MySQL ç­ã\n\n\n# è¿è¡æ¨¡åçæ­¥éª¤\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myEShost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼ éç½® filebeat æ¨¡å | filebeat æ¯ææ¨¡å\n\n\n# åç\n\nFilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\nharvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n\nprospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nFilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nFilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# èµæ\n\nBeats å®æ¹ææ¡£',normalizedContent:'# elastic ææ¯æ ä¹ filebeat\n\n\n# ç®ä»\n\nbeats æ¯å®è£å¨æå¡å¨ä¸çæ°æ®ä¸­è½¬ä»£çã\n\nbeats å¯ä»¥å°æ°æ®ç´æ¥ä¼ è¾å° elasticsearch æä¼ è¾å° logstash ã\n\n\n\nbeats æå¤ç§ç±»åï¼å¯ä»¥æ ¹æ®å®éåºç¨éè¦éæ©åéçç±»åã\n\nå¸¸ç¨çç±»åæï¼\n\n * **packetbeatï¼**ç½ç»æ°æ®ååæå¨ï¼æä¾æå³æ¨çåºç¨ç¨åºæå¡å¨ä¹é´äº¤æ¢çäºå¡çä¿¡æ¯ã\n * **filebeatï¼**ä»æ¨çæå¡å¨åéæ¥å¿æä»¶ã\n * **metricbeatï¼**æ¯ä¸ä¸ªæå¡å¨çè§ä»£çç¨åºï¼å®å®æä»æå¡å¨ä¸è¿è¡çæä½ç³»ç»åæå¡æ¶éææ ã\n * **winlogbeatï¼**æä¾ windows äºä»¶æ¥å¿ã\n\n> åè\n> \n> æ´å¤ beats ç±»åå¯ä»¥åèï¼community-beats\n> \n> è¯´æ\n> \n> ç±äºæ¬äººå·¥ä½ä¸­åªåºç¨äº filebeatï¼æä»¥åé¢åå®¹ä»ä»ç» filebeat ã\n\n\n# filebeat çä½ç¨\n\nç¸æ¯ logstashï¼filebeat æ´å è½»éåã\n\nå¨ä»»ä½ç¯å¢ä¸ï¼åºç¨ç¨åºé½æåæºçå¯è½æ§ã filebeat è¯»åå¹¶è½¬åæ¥å¿è¡ï¼å¦æä¸­æ­ï¼åä¼è®°ä½ææäºä»¶æ¢å¤èæºç¶ææ¶æå¨ä½ç½®ã\n\nfilebeat å¸¦æåé¨æ¨¡åï¼auditdï¼apacheï¼nginxï¼system å mysqlï¼ï¼å¯éè¿ä¸ä¸ªæå®å½ä»¤æ¥ç®åéç¨æ¥å¿æ ¼å¼çæ¶éï¼è§£æåå¯è§åã\n\nfilebeat ä¸ä¼è®©ä½ çç®¡éè¶è´è·ãfilebeat å¦ææ¯å logstash ä¼ è¾æ°æ®ï¼å½ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ã\n\n\n\n\n# å®è£\n\nunix / linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# éç½®\n\n\n# éç½®æä»¶\n\né¦åï¼éè¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãéç½®æä»¶çè·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼çä¸åèååã\n\nbeat ææç³»åäº§åçéç½®æä»¶é½åºäº yaml æ ¼å¼ï¼filebeat å½ç¶ä¹ä¸ä¾å¤ã\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n> åè\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n\n# éè¦éç½®é¡¹\n\n# filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# the filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+yyyy.mm.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# setup.kibana\n\nå¦ææç®ä½¿ç¨ filebeat æä¾ç kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# setup.template.settings\n\nå¨ elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nfilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼filebeat å¨æåè¿æ¥å° elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# setup.dashboards\n\nfilebeat éå¸¦äºç¤ºä¾ kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ kibana ä¸­å è½½ filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat command\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# æ¨¡å\n\nfilebeat æä¾äºä¸å¥é¢æå»ºçæ¨¡åï¼è®©æ¨å¯ä»¥å¿«éå®æ½åé¨ç½²æ¥å¿çè§è§£å³æ¹æ¡ï¼å¹¶éå¸¦ç¤ºä¾ä»ªè¡¨æ¿åæ°æ®å¯è§åãè¿äºæ¨¡åæ¯æå¸¸è§çæ¥å¿æ ¼å¼ï¼ä¾å¦ nginxï¼apache2 å mysql ç­ã\n\n\n# è¿è¡æ¨¡åçæ­¥éª¤\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myeshost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼ éç½® filebeat æ¨¡å | filebeat æ¯ææ¨¡å\n\n\n# åç\n\nfilebeat æä¸¤ä¸ªä¸»è¦ç»ä»¶ï¼\n\nharvesterï¼è´è´£è¯»åä¸ä¸ªæä»¶çåå®¹ãå®ä¼éè¡è¯»åæä»¶åå®¹ï¼å¹¶å°åå®¹åéå°è¾åºç®çå°ã\n\nprospectorï¼è´è´£ç®¡ç harvester å¹¶æ¾å°ææéè¦è¯»åçæä»¶æºãæ¯å¦ç±»åæ¯æ¥å¿ï¼prospector å°±ä¼éåå¶å®è·¯å¾ä¸çææå¹éè¦æ±çæä»¶ã\n\nfilebeat.prospectors:\n  - type: log\n    paths:\n      - /var/log/*.log\n      - /var/path2/*.log\n\n\nfilebeat ä¿ææ¯ä¸ªæä»¶çç¶æï¼å¹¶ç»å¸¸å·æ°æ³¨åè¡¨æä»¶ä¸­çç£çç¶æãç¶æç¨äºè®°ä½ harvester æ­£å¨è¯»åçæååç§»éï¼å¹¶ç¡®ä¿åéæææ¥å¿è¡ã\n\nfilebeat å°æ¯ä¸ªäºä»¶çä¼ éç¶æå­å¨å¨æ³¨åè¡¨æä»¶ä¸­ãæä»¥å®è½ä¿è¯äºä»¶è³å°ä¼ éä¸æ¬¡å°éç½®çè¾åºï¼æ²¡ææ°æ®ä¸¢å¤±ã\n\n\n# èµæ\n\nbeats å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Filebeat è¿ç»´",frontmatter:{title:"Filebeat è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Filebeat"],permalink:"/pages/43db0b/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/03.Filebeat%E8%BF%90%E7%BB%B4.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/03.Filebeatè¿ç»´.md",key:"v-58ce2686",path:"/pages/43db0b/",headers:[{level:2,title:"1. Filebeat å®è£",slug:"_1-filebeat-å®è£",normalizedTitle:"1. filebeat å®è£",charIndex:141},{level:3,title:"1.1. ç¯å¢è¦æ±",slug:"_1-1-ç¯å¢è¦æ±",normalizedTitle:"1.1. ç¯å¢è¦æ±",charIndex:160},{level:3,title:"1.2. å®è£æ­¥éª¤",slug:"_1-2-å®è£æ­¥éª¤",normalizedTitle:"1.2. å®è£æ­¥éª¤",charIndex:198},{level:2,title:"2. Filebeat éç½®",slug:"_2-filebeat-éç½®",normalizedTitle:"2. filebeat éç½®",charIndex:421},{level:3,title:"2.1. éè¦éç½®é¡¹",slug:"_2-1-éè¦éç½®é¡¹",normalizedTitle:"2.1. éè¦éç½®é¡¹",charIndex:803},{level:4,title:"2.1.1. filebeat.prospectors",slug:"_2-1-1-filebeat-prospectors",normalizedTitle:"2.1.1. filebeat.prospectors",charIndex:958},{level:4,title:"2.1.2. output.elasticsearch",slug:"_2-1-2-output-elasticsearch",normalizedTitle:"2.1.2. output.elasticsearch",charIndex:1104},{level:4,title:"2.1.3. output.logstash",slug:"_2-1-3-output-logstash",normalizedTitle:"2.1.3. output.logstash",charIndex:1263},{level:4,title:"2.1.4. setup.kibana",slug:"_2-1-4-setup-kibana",normalizedTitle:"2.1.4. setup.kibana",charIndex:2056},{level:4,title:"2.1.5. setup.template.settings",slug:"_2-1-5-setup-template-settings",normalizedTitle:"2.1.5. setup.template.settings",charIndex:2176},{level:4,title:"2.1.6. setup.dashboards",slug:"_2-1-6-setup-dashboards",normalizedTitle:"2.1.6. setup.dashboards",charIndex:2563},{level:2,title:"3. Filebeat å½ä»¤",slug:"_3-filebeat-å½ä»¤",normalizedTitle:"3. filebeat å½ä»¤",charIndex:2848},{level:2,title:"4. Filebeat æ¨¡å",slug:"_4-filebeat-æ¨¡å",normalizedTitle:"4. filebeat æ¨¡å",charIndex:3198},{level:2,title:"5. åèèµæ",slug:"_5-åèèµæ",normalizedTitle:"5. åèèµæ",charIndex:3757}],headersStr:"1. Filebeat å®è£ 1.1. ç¯å¢è¦æ± 1.2. å®è£æ­¥éª¤ 2. Filebeat éç½® 2.1. éè¦éç½®é¡¹ 2.1.1. filebeat.prospectors 2.1.2. output.elasticsearch 2.1.3. output.logstash 2.1.4. setup.kibana 2.1.5. setup.template.settings 2.1.6. setup.dashboards 3. Filebeat å½ä»¤ 4. Filebeat æ¨¡å 5. åèèµæ",content:'# Filebeat è¿ç»´\n\n> Beats å¹³å°éåäºå¤ç§åä¸ç¨éæ°æ®ééå¨ãå®ä»¬ä»æç¾ä¸åææåä¸ä¸å°æºå¨åç³»ç»å Logstash æ Elasticsearch åéæ°æ®ã\n> \n> å ä¸ºæåªæ¥è§¦è¿ Filebeatï¼æææ¬æä»ä»ç» Filebeat çæ¥å¸¸è¿ç»´ã\n\n\n# 1. Filebeat å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼Elastic Stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nUnix / Linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# 2. Filebeat éç½®\n\n> é¦åï¼å¿é¡»è¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãå¶è·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼èææä¸åã\n> \n> Beat ææç³»åäº§åçéç½®æä»¶é½åºäº YAML æ ¼å¼ï¼FileBeat å½ç¶ä¹ä¸ä¾å¤ã\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n\n# 2.1. éè¦éç½®é¡¹\n\n> ä¸é¢æå°åä¸¾ Filebeat çè¾ä¸ºéè¦çéç½®é¡¹ã\n> \n> å¦ææ³äºè§£æ´å¤éç½®ä¿¡æ¯ï¼å¯ä»¥åèï¼\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n# 2.1.1. filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# 2.1.2. output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# 2.1.3. output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ FileBeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼FileBeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# The filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# 2.1.4. setup.kibana\n\nå¦ææç®ä½¿ç¨ Filebeat æä¾ç Kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# 2.1.5. setup.template.settings\n\nå¨ Elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ Filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nFilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± Filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼Filebeat å¨æåè¿æ¥å° Elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ Filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ Filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# 2.1.6. setup.dashboards\n\nFilebeat éå¸¦äºç¤ºä¾ Kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° Kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ Kibana ä¸­å è½½ Filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# 3. Filebeat å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat COMMAND\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# 4. Filebeat æ¨¡å\n\n> Filebeat å Metricbeat åé¨éæäºä¸ç³»åæ¨¡åï¼ç¨ä»¥ç®åå¸¸è§æ¥å¿æ ¼å¼ï¼ä¾å¦ NGINXãApache æè¯¸å¦ Redis æ Docker ç­ç³»ç»ææ ï¼çæ¶éãè§£æåå¯è§åè¿ç¨ã\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myEShost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼\n> \n>  * éç½® filebeat æ¨¡å\n>  * filebeat æ¯ææ¨¡å\n\n\n# 5. åèèµæ\n\n * Beats å®ç½\n * Beats Github\n * Beats å®æ¹ææ¡£',normalizedContent:'# filebeat è¿ç»´\n\n> beats å¹³å°éåäºå¤ç§åä¸ç¨éæ°æ®ééå¨ãå®ä»¬ä»æç¾ä¸åææåä¸ä¸å°æºå¨åç³»ç»å logstash æ elasticsearch åéæ°æ®ã\n> \n> å ä¸ºæåªæ¥è§¦è¿ filebeatï¼æææ¬æä»ä»ç» filebeat çæ¥å¸¸è¿ç»´ã\n\n\n# 1. filebeat å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼elastic stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nunix / linux ç³»ç»å»ºè®®ä½¿ç¨ä¸é¢æ¹å¼å®è£ï¼å ä¸ºæ¯è¾éç¨ã\n\nwget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz\ntar -zxf filebeat-6.1.1-linux-x86_64.tar.gz\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-installation\n\n\n# 2. filebeat éç½®\n\n> é¦åï¼å¿é¡»è¦ç¥éçæ¯ï¼filebeat.yml æ¯ filebeat çéç½®æä»¶ãå¶è·¯å¾ä¼å ä¸ºä½ å®è£æ¹å¼èææä¸åã\n> \n> beat ææç³»åäº§åçéç½®æä»¶é½åºäº yaml æ ¼å¼ï¼filebeat å½ç¶ä¹ä¸ä¾å¤ã\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\nfilebeat.yml é¨åéç½®ç¤ºä¾ï¼\n\nfilebeat:\n  prospectors:\n    - type: log\n      paths:\n        - /var/log/*.log\n      multiline:\n        pattern: \'^[\'\n        match: after\n\n\n\n# 2.1. éè¦éç½®é¡¹\n\n> ä¸é¢æå°åä¸¾ filebeat çè¾ä¸ºéè¦çéç½®é¡¹ã\n> \n> å¦ææ³äºè§£æ´å¤éç½®ä¿¡æ¯ï¼å¯ä»¥åèï¼\n> \n> æ´å¤ filebeat éç½®åå®¹å¯ä»¥åèï¼éç½® filebeat\n> \n> æ´å¤ filebeat.yml æä»¶æ ¼å¼åå®¹å¯ä»¥åèï¼filebeat.yml æä»¶æ ¼å¼\n\n# 2.1.1. filebeat.prospectors\n\nï¼æä»¶çè§å¨ï¼ç¨äºæå®éè¦å³æ³¨çæä»¶ã\n\nç¤ºä¾\n\nfilebeat.prospectors:\n  - type: log\n    enabled: true\n    paths:\n      - /var/log/*.log\n\n\n# 2.1.2. output.elasticsearch\n\nå¦æä½ å¸æä½¿ç¨ filebeat ç´æ¥å elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.elasticsearch ã\n\nç¤ºä¾\n\noutput.elasticsearch:\n  hosts: [\'192.168.1.42:9200\']\n\n\n# 2.1.3. output.logstash\n\nå¦æä½ å¸æä½¿ç¨ filebeat å logstash è¾åºæ°æ®ï¼ç¶åç± logstash åå elasticsearch è¾åºæ°æ®ï¼éè¦éç½® output.logstashã\n\n> æ³¨æ\n> \n> ç¸æ¯äºå elasticsearch è¾åºæ°æ®ï¼ä¸ªäººæ´æ¨èå logstash è¾åºæ°æ®ã\n> \n> å ä¸º logstash å filebeat ä¸èµ·å·¥ä½æ¶ï¼å¦æ logstash å¿äºå¤çæ°æ®ï¼ä¼éç¥ filebeat æ¾æ¢è¯»åéåº¦ãä¸æ¦æ¥å¡å¾å°è§£å³ï¼filebeat å°æ¢å¤å°åæ¥çéåº¦å¹¶ç»§ç»­ä¼ æ­ãè¿æ ·ï¼å¯ä»¥åå°ç®¡éè¶è´è·çæåµã\n\nç¤ºä¾\n\noutput.logstash:\n  hosts: [\'127.0.0.1:5044\']\n\n\næ­¤å¤ï¼è¿éè¦å¨ logstash çéç½®æä»¶ï¼å¦ logstash.confï¼ä¸­æå® beats input æä»¶ï¼\n\ninput {\n  beats {\n    port => 5044 # æ­¤ç«¯å£éè¦ä¸ filebeat.yml ä¸­çç«¯å£ç¸å\n  }\n}\n\n# the filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\n\noutput {\n  elasticsearch {\n    hosts => "localhost:9200"\n    manage_template => false\n    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+yyyy.mm.dd}"\n    document_type => "%{[@metadata][type]}"\n  }\n}\n\n\n# 2.1.4. setup.kibana\n\nå¦ææç®ä½¿ç¨ filebeat æä¾ç kibana ä»ªè¡¨æ¿ï¼éè¦éç½® setup.kibana ã\n\nç¤ºä¾\n\nsetup.kibana:\n  host: \'localhost:5601\'\n\n\n# 2.1.5. setup.template.settings\n\nå¨ elasticsearch ä¸­ï¼ç´¢å¼æ¨¡æ¿ç¨äºå®ä¹è®¾ç½®åæ å°ï¼ä»¥ç¡®å®å¦ä½åæå­æ®µã\n\nå¨ filebeat ä¸­ï¼setup.template.settings ç¨äºéç½®ç´¢å¼æ¨¡æ¿ã\n\nfilebeat æ¨èçç´¢å¼æ¨¡æ¿æä»¶ç± filebeat è½¯ä»¶åå®è£ãå¦ææ¨æ¥å filebeat.yml éç½®æä»¶ä¸­çé»è®¤éç½®ï¼filebeat å¨æåè¿æ¥å° elasticsearch åèªå¨å è½½æ¨¡æ¿ã\n\næ¨å¯ä»¥éè¿å¨ filebeat éç½®æä»¶ä¸­éç½®æ¨¡æ¿å è½½éé¡¹æ¥ç¦ç¨èªå¨æ¨¡æ¿å è½½ï¼æå è½½èªå·±çæ¨¡æ¿ãæ¨è¿å¯ä»¥è®¾ç½®éé¡¹æ¥æ´æ¹ç´¢å¼åç´¢å¼æ¨¡æ¿çåç§°ã\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼filebeat-template\n> \n> è¯´æ\n> \n> å¦æ å¿è¦ï¼ä½¿ç¨ filebeat éç½®æä»¶ä¸­çé»è®¤ç´¢å¼æ¨¡æ¿å³å¯ã\n\n# 2.1.6. setup.dashboards\n\nfilebeat éå¸¦äºç¤ºä¾ kibana ä»ªè¡¨æ¿ãå¨ä½¿ç¨ä»ªè¡¨æ¿ä¹åï¼æ¨éè¦åå»ºç´¢å¼æ¨¡å¼ filebeat- *ï¼å¹¶å°ä»ªè¡¨æ¿å è½½å° kibana ä¸­ãä¸ºæ­¤ï¼æ¨å¯ä»¥è¿è¡ setup å½ä»¤æå¨ filebeat.yml éç½®æä»¶ä¸­éç½®ä»ªè¡¨æ¿å è½½ã\n\nä¸ºäºå¨ kibana ä¸­å è½½ filebeat çä»ªè¡¨çï¼éè¦å¨ filebeat.yml éç½®ä¸­å¯å¨å¼å³ï¼\n\nsetup.dashboards.enabled: true\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼configuration-dashboards\n\n\n# 3. filebeat å½ä»¤\n\nfilebeat æä¾äºä¸ç³»åå½ä»¤æ¥å®æåç§åè½ã\n\næ§è¡å½ä»¤æ¹å¼ï¼\n\n./filebeat command\n\n\n> åè\n> \n> æ´å¤åå®¹å¯ä»¥åèï¼command-line-options\n> \n> è¯´æ\n> \n> ä¸ªäººè®¤ä¸ºå½ä»¤è¡æ²¡æå¿è¦ä¸ä¸ææ¡ï¼å ä¸ºç»å¤§é¨ååè½é½å¯ä»¥éè¿éç½®æ¥å®æãä¸éè¿å½ä»¤è¡æå®åè½è¿ç§æ¹å¼è¦æ±æ¯æ¬¡è¾å¥åæ ·åæ°ï¼ä¸å©äºåºåå¯å¨æ¹å¼ã\n> \n> æéè¦çå½ç¶æ¯å¯å¨å½ä»¤ run äºã\n> \n> ç¤ºä¾ æå®éç½®æä»¶å¯å¨\n> \n> ./filebeat run -e -c filebeat.yml -d "publish"\n> ./filebeat -e -c filebeat.yml -d "publish" # run å¯ä»¥çç¥\n\n\n# 4. filebeat æ¨¡å\n\n> filebeat å metricbeat åé¨éæäºä¸ç³»åæ¨¡åï¼ç¨ä»¥ç®åå¸¸è§æ¥å¿æ ¼å¼ï¼ä¾å¦ nginxãapache æè¯¸å¦ redis æ docker ç­ç³»ç»ææ ï¼çæ¶éãè§£æåå¯è§åè¿ç¨ã\n\n * éç½® elasticsearch å kibana\n\noutput.elasticsearch:\n  hosts: ["myeshost:9200"]\n  username: "elastic"\n  password: "elastic"\nsetup.kibana:\n  host: "mykibanahost:5601"\n  username: "elastic"\n  password: "elastic\n\n\n> username å password æ¯å¯éçï¼å¦æä¸éè¦è®¤è¯åä¸å¡«ã\n\n * åå§åç¯å¢\n\næ§è¡ä¸é¢å½ä»¤ï¼filebeat ä¼å è½½æ¨èç´¢å¼æ¨¡æ¿ã\n\n./filebeat setup -e\n\n\n * æå®æ¨¡å\n\næ§è¡ä¸é¢å½ä»¤ï¼æå®å¸æå è½½çæ¨¡åã\n\n./filebeat -e --modules system,nginx,mysql\n\n\n> æ´å¤åå®¹å¯ä»¥åèï¼\n> \n>  * éç½® filebeat æ¨¡å\n>  * filebeat æ¯ææ¨¡å\n\n\n# 5. åèèµæ\n\n * beats å®ç½\n * beats github\n * beats å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elastic ææ¯æ ä¹ Kibana",frontmatter:{title:"Elastic ææ¯æ ä¹ Kibana",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Kibana"],permalink:"/pages/507fcc/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/04.Elastic%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B9%8BKibana.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/04.Elasticææ¯æ ä¹Kibana.md",key:"v-ed0e4772",path:"/pages/507fcc/",headers:[{level:2,title:"Discover",slug:"discover",normalizedTitle:"discover",charIndex:26},{level:3,title:"æ¥è¯¢è¯­ä¹",slug:"æ¥è¯¢è¯­ä¹",normalizedTitle:"æ¥è¯¢è¯­ä¹",charIndex:520},{level:4,title:"å­æ®µåç§°",slug:"å­æ®µåç§°",normalizedTitle:"å­æ®µåç§°",charIndex:311},{level:4,title:"ééç¬¦",slug:"ééç¬¦",normalizedTitle:"ééç¬¦",charIndex:1052},{level:4,title:"æ­£åè¡¨è¾¾å¼",slug:"æ­£åè¡¨è¾¾å¼",normalizedTitle:"æ­£åè¡¨è¾¾å¼",charIndex:1463},{level:4,title:"æ¨¡ç³æ¥è¯¢",slug:"æ¨¡ç³æ¥è¯¢",normalizedTitle:"æ¨¡ç³æ¥è¯¢",charIndex:1571},{level:4,title:"è¿ä¼¼æ£ç´¢",slug:"è¿ä¼¼æ£ç´¢",normalizedTitle:"è¿ä¼¼æ£ç´¢",charIndex:1840},{level:4,title:"èå´",slug:"èå´",normalizedTitle:"èå´",charIndex:2083},{level:4,title:"Boosting",slug:"boosting",normalizedTitle:"boosting",charIndex:2575},{level:4,title:"å¸å°æä½",slug:"å¸å°æä½",normalizedTitle:"å¸å°æä½",charIndex:2745},{level:4,title:"åç»",slug:"åç»",normalizedTitle:"åç»",charIndex:3162},{level:4,title:"ä¿çå­",slug:"ä¿çå­",normalizedTitle:"ä¿çå­",charIndex:3304},{level:4,title:"ç©ºæ¥è¯¢",slug:"ç©ºæ¥è¯¢",normalizedTitle:"ç©ºæ¥è¯¢",charIndex:3492},{level:2,title:"Visualize",slug:"visualize",normalizedTitle:"visualize",charIndex:144},{level:3,title:"Pie",slug:"pie",normalizedTitle:"pie",charIndex:3712},{level:3,title:"Vertical Bar",slug:"vertical-bar",normalizedTitle:"vertical bar",charIndex:4083},{level:2,title:"Dashboard",slug:"dashboard",normalizedTitle:"dashboard",charIndex:4324}],headersStr:"Discover æ¥è¯¢è¯­ä¹ å­æ®µåç§° ééç¬¦ æ­£åè¡¨è¾¾å¼ æ¨¡ç³æ¥è¯¢ è¿ä¼¼æ£ç´¢ èå´ Boosting å¸å°æä½ åç» ä¿çå­ ç©ºæ¥è¯¢ Visualize Pie Vertical Bar Dashboard",content:'# Elastic ææ¯æ ä¹ Kibana\n\n\n# Discover\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç Discover ï¼å¯ä»¥æ¾ç¤º Kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ Elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ Discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ Visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ Management/Kibana/Index Patterns å¹¶åå» Add Newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ ANDï¼OR å NOT é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\n\n# æ¥è¯¢è¯­ä¹\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ OR è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick OR brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"John Smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# ééç¬¦\n\nELK æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼Regular expression syntax\n\n# æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ Damerau-Levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min TO max] åå¼åºé´èå´ç¨è±æ¬å· {min TO max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 TO 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 TO 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha TO omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 TO *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* TO 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 TO 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ AND è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 AND <20)\nage:(+>=10 +<20)\n\n\n# Boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ ANDï¼OR å NOTï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼NOT ä¼åäº ANDï¼AND ä¼åäº ORãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ AND å OR ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick OR brown) AND fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active OR pending) title:(full text search)^2\n\n\n# ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# Visualize\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç Visualizeã\n\nVisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç Create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n\n# Pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ Elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» Split Slicesã\n 2. å¨ Aggregation åè¡¨ä¸­éæ© Termsãæ³¨æï¼è¿éç Terms æ¯ Elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ Field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n\n# Vertical Bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç Create a visualization æ + æé®ãéæ© Vertical Bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® Y è½´æä»£è¡¨çå­æ®µ\n 4. æå® X è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n\n# Dashboard\n\nDashboard å¯ä»¥æ´ååå±äº« Visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç Dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç Visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã',normalizedContent:'# elastic ææ¯æ ä¹ kibana\n\n\n# discover\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç discover ï¼å¯ä»¥æ¾ç¤º kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ management/kibana/index patterns å¹¶åå» add newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ andï¼or å not é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\n\n# æ¥è¯¢è¯­ä¹\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ or è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick or brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"john smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# ééç¬¦\n\nelk æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼regular expression syntax\n\n# æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ damerau-levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min to max] åå¼åºé´èå´ç¨è±æ¬å· {min to max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 to 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 to 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha to omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 to *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* to 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 to 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ and è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 and <20)\nage:(+>=10 +<20)\n\n\n# boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ andï¼or å notï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼not ä¼åäº andï¼and ä¼åäº orãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ and å or ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick or brown) and fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active or pending) title:(full text search)^2\n\n\n# ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# visualize\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç visualizeã\n\nvisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n\n# pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» split slicesã\n 2. å¨ aggregation åè¡¨ä¸­éæ© termsãæ³¨æï¼è¿éç terms æ¯ elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n\n# vertical bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç create a visualization æ + æé®ãéæ© vertical bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® y è½´æä»£è¡¨çå­æ®µ\n 4. æå® x è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n\n# dashboard\n\ndashboard å¯ä»¥æ´ååå±äº« visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Kibana è¿ç»´",frontmatter:{title:"Kibana è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Kibana"],permalink:"/pages/8d96f6/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/05.Kibana%E8%BF%90%E7%BB%B4.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/05.Kibanaè¿ç»´.md",key:"v-32457afd",path:"/pages/8d96f6/",headers:[{level:2,title:"1. å®è£",slug:"_1-å®è£",normalizedTitle:"1. å®è£",charIndex:128},{level:3,title:"1.1. ç¯å¢è¦æ±",slug:"_1-1-ç¯å¢è¦æ±",normalizedTitle:"1.1. ç¯å¢è¦æ±",charIndex:138},{level:3,title:"1.2. å®è£æ­¥éª¤",slug:"_1-2-å®è£æ­¥éª¤",normalizedTitle:"1.2. å®è£æ­¥éª¤",charIndex:176},{level:2,title:"2. ä½¿ç¨",slug:"_2-ä½¿ç¨",normalizedTitle:"2. ä½¿ç¨",charIndex:387},{level:3,title:"2.1. æ£ç´¢",slug:"_2-1-æ£ç´¢",normalizedTitle:"2.1. æ£ç´¢",charIndex:397},{level:4,title:"2.1.1. å­æ®µåç§°",slug:"_2-1-1-å­æ®µåç§°",normalizedTitle:"2.1.1. å­æ®µåç§°",charIndex:1062},{level:4,title:"2.1.2. ééç¬¦",slug:"_2-1-2-ééç¬¦",normalizedTitle:"2.1.2. ééç¬¦",charIndex:1498},{level:4,title:"2.1.3. æ­£åè¡¨è¾¾å¼",slug:"_2-1-3-æ­£åè¡¨è¾¾å¼",normalizedTitle:"2.1.3. æ­£åè¡¨è¾¾å¼",charIndex:1842},{level:4,title:"2.1.4. æ¨¡ç³æ¥è¯¢",slug:"_2-1-4-æ¨¡ç³æ¥è¯¢",normalizedTitle:"2.1.4. æ¨¡ç³æ¥è¯¢",charIndex:1957},{level:4,title:"2.1.5. è¿ä¼¼æ£ç´¢",slug:"_2-1-5-è¿ä¼¼æ£ç´¢",normalizedTitle:"2.1.5. è¿ä¼¼æ£ç´¢",charIndex:2233},{level:4,title:"2.1.6. èå´",slug:"_2-1-6-èå´",normalizedTitle:"2.1.6. èå´",charIndex:2483},{level:4,title:"2.1.7. Boosting",slug:"_2-1-7-boosting",normalizedTitle:"2.1.7. boosting",charIndex:2982},{level:4,title:"2.1.8. å¸å°æä½",slug:"_2-1-8-å¸å°æä½",normalizedTitle:"2.1.8. å¸å°æä½",charIndex:3159},{level:4,title:"2.1.9. åç»",slug:"_2-1-9-åç»",normalizedTitle:"2.1.9. åç»",charIndex:3583},{level:4,title:"2.1.10. ä¿çå­",slug:"_2-1-10-ä¿çå­",normalizedTitle:"2.1.10. ä¿çå­",charIndex:3732},{level:4,title:"2.1.11. ç©ºæ¥è¯¢",slug:"_2-1-11-ç©ºæ¥è¯¢",normalizedTitle:"2.1.11. ç©ºæ¥è¯¢",charIndex:3928},{level:3,title:"2.2. å¯è§å",slug:"_2-2-å¯è§å",normalizedTitle:"2.2. å¯è§å",charIndex:3976},{level:4,title:"2.2.1. Pie",slug:"_2-2-1-pie",normalizedTitle:"2.2.1. pie",charIndex:4159},{level:4,title:"2.2.2. Vertical Bar",slug:"_2-2-2-vertical-bar",normalizedTitle:"2.2.2. vertical bar",charIndex:4536},{level:3,title:"2.3. æ¥è¡¨",slug:"_2-3-æ¥è¡¨",normalizedTitle:"2.3. æ¥è¡¨",charIndex:4784},{level:2,title:"3. FAQ",slug:"_3-faq",normalizedTitle:"3. faq",charIndex:4971},{level:3,title:"3.1. Kibana No Default Index Pattern Warning",slug:"_3-1-kibana-no-default-index-pattern-warning",normalizedTitle:"3.1. kibana no default index pattern warning",charIndex:4982},{level:2,title:"4. åèèµæ",slug:"_4-åèèµæ",normalizedTitle:"4. åèèµæ",charIndex:5318}],headersStr:"1. å®è£ 1.1. ç¯å¢è¦æ± 1.2. å®è£æ­¥éª¤ 2. ä½¿ç¨ 2.1. æ£ç´¢ 2.1.1. å­æ®µåç§° 2.1.2. ééç¬¦ 2.1.3. æ­£åè¡¨è¾¾å¼ 2.1.4. æ¨¡ç³æ¥è¯¢ 2.1.5. è¿ä¼¼æ£ç´¢ 2.1.6. èå´ 2.1.7. Boosting 2.1.8. å¸å°æä½ 2.1.9. åç» 2.1.10. ä¿çå­ 2.1.11. ç©ºæ¥è¯¢ 2.2. å¯è§å 2.2.1. Pie 2.2.2. Vertical Bar 2.3. æ¥è¡¨ 3. FAQ 3.1. Kibana No Default Index Pattern Warning 4. åèèµæ",content:'# Kibana è¿ç»´\n\n> éè¿ Kibanaï¼æ¨å¯ä»¥å¯¹èªå·±ç Elasticsearch è¿è¡å¯è§åï¼è¿å¯ä»¥å¨ Elastic Stack ä¸­è¿è¡å¯¼èªï¼è¿æ ·æ¨ä¾¿å¯ä»¥è¿è¡åç§æä½äºï¼ä»è·è¸ªæ¥è¯¢è´è½½ï¼å°çè§£è¯·æ±å¦ä½æµç»æ¨çæ´ä¸ªåºç¨ï¼é½è½è½»æ¾å®æã\n\n\n# 1. å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼Elastic Stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\n 1. å¨ kibana å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n 2. ä¿®æ¹ config/kibana.yml éç½®æä»¶ï¼è®¾ç½® elasticsearch.url æå Elasticsearch å®ä¾ã\n 3. è¿è¡ bin/kibana ï¼Windows ä¸è¿è¡ bin\\kibana.batï¼\n 4. å¨æµè§å¨ä¸è®¿é® http://localhost:5601\n\n\n# 2. ä½¿ç¨\n\n\n# 2.1. æ£ç´¢\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç æ£ç´¢ï¼Discoverï¼ ï¼å¯ä»¥æ¾ç¤º Kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ Elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ Discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ Visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ Management/Kibana/Index Patterns å¹¶åå» Add Newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ ANDï¼OR å NOT é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# 2.1.1. å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ OR è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick OR brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"John Smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# 2.1.2. ééç¬¦\n\nELK æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# 2.1.3. æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼Regular expression syntax\n\n# 2.1.4. æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ Damerau-Levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# 2.1.5. è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# 2.1.6. èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min TO max] åå¼åºé´èå´ç¨è±æ¬å· {min TO max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 TO 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 TO 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha TO omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 TO *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* TO 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 TO 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ AND è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 AND <20)\nage:(+>=10 +<20)\n\n\n# 2.1.7. Boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# 2.1.8. å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ ANDï¼OR å NOTï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼NOT ä¼åäº ANDï¼AND ä¼åäº ORãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ AND å OR ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# 2.1.9. åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick OR brown) AND fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active OR pending) title:(full text search)^2\n\n\n# 2.1.10. ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# 2.1.11. ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# 2.2. å¯è§å\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç å¯è§åï¼Visualizeï¼ã\n\nVisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç Create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n# 2.2.1. Pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ Elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» Split Slicesã\n 2. å¨ Aggregation åè¡¨ä¸­éæ© Termsãæ³¨æï¼è¿éç Terms æ¯ Elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ Field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n# 2.2.2. Vertical Bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç Create a visualization æ + æé®ãéæ© Vertical Bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® Y è½´æä»£è¡¨çå­æ®µ\n 4. æå® X è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç Save æé®ã\n\n\n# 2.3. æ¥è¡¨\n\næ¥è¡¨ï¼Dashboardï¼ å¯ä»¥æ´ååå±äº« Visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç Dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç Visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã\n\n\n# 3. FAQ\n\n\n# 3.1. Kibana No Default Index Pattern Warning\n\n**é®é¢ï¼**å®è£ ELK åï¼è®¿é® kibana é¡µé¢æ¶ï¼æç¤ºä»¥ä¸éè¯¯ä¿¡æ¯ï¼\n\nWarning No default index pattern. You must select or create one to continue.\n...\nUnable to fetch mapping. Do you have indices matching the pattern?\n\n\nè¿å°±è¯´æ logstash æ²¡æææ¥å¿åå¥å° elasticsearchã\n\nè§£å³æ¹æ³ï¼\n\næ£æ¥ logstash ä¸ elasticsearch ä¹é´çéè®¯æ¯å¦æé®é¢ï¼ä¸è¬é®é¢å°±åºå¨è¿ã\n\n\n# 4. åèèµæ\n\n * Kibana å®ç½\n * Kibana Github\n * Kibana å®æ¹ææ¡£',normalizedContent:'# kibana è¿ç»´\n\n> éè¿ kibanaï¼æ¨å¯ä»¥å¯¹èªå·±ç elasticsearch è¿è¡å¯è§åï¼è¿å¯ä»¥å¨ elastic stack ä¸­è¿è¡å¯¼èªï¼è¿æ ·æ¨ä¾¿å¯ä»¥è¿è¡åç§æä½äºï¼ä»è·è¸ªæ¥è¯¢è´è½½ï¼å°çè§£è¯·æ±å¦ä½æµç»æ¨çæ´ä¸ªåºç¨ï¼é½è½è½»æ¾å®æã\n\n\n# 1. å®è£\n\n\n# 1.1. ç¯å¢è¦æ±\n\n> çæ¬ï¼elastic stack 7.4\n\n\n# 1.2. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\n 1. å¨ kibana å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n 2. ä¿®æ¹ config/kibana.yml éç½®æä»¶ï¼è®¾ç½® elasticsearch.url æå elasticsearch å®ä¾ã\n 3. è¿è¡ bin/kibana ï¼windows ä¸è¿è¡ bin\\kibana.batï¼\n 4. å¨æµè§å¨ä¸è®¿é® http://localhost:5601\n\n\n# 2. ä½¿ç¨\n\n\n# 2.1. æ£ç´¢\n\nåå»ä¾§é¢å¯¼èªæ ä¸­ç æ£ç´¢ï¼discoverï¼ ï¼å¯ä»¥æ¾ç¤º kibana çæ°æ®æ¥è¯¢åè½åè½ã\n\n\n\nå¨æç´¢æ ä¸­ï¼æ¨å¯ä»¥è¾å¥ elasticsearch æ¥è¯¢æ¡ä»¶æ¥æç´¢æ¨çæ°æ®ãæ¨å¯ä»¥å¨ discover é¡µé¢ä¸­æµè§ç»æå¹¶å¨ visualize é¡µé¢ä¸­åå»ºå·²ä¿å­æç´¢æ¡ä»¶çå¯è§åã\n\nå½åç´¢å¼æ¨¡å¼æ¾ç¤ºå¨æ¥è¯¢æ ä¸æ¹ãç´¢å¼æ¨¡å¼ç¡®å®æäº¤æ¥è¯¢æ¶æç´¢åªäºç´¢å¼ãè¦æç´¢ä¸ç»ä¸åçç´¢å¼ï¼è¯·ä»ä¸æèåä¸­éæ©ä¸åçæ¨¡å¼ãè¦æ·»å ç´¢å¼æ¨¡å¼ï¼index patternï¼ï¼è¯·è½¬è³ management/kibana/index patterns å¹¶åå» add newã\n\næ¨å¯ä»¥ä½¿ç¨å­æ®µåç§°åæ¨æå´è¶£çå¼æå»ºæç´¢ãå¯¹äºæ°å­å­æ®µï¼å¯ä»¥ä½¿ç¨æ¯è¾è¿ç®ç¬¦ï¼å¦å¤§äºï¼>ï¼ï¼å°äºï¼<ï¼æç­äºï¼=ï¼ãæ¨å¯ä»¥å°åç´ ä¸é»è¾è¿ç®ç¬¦ andï¼or å not é¾æ¥ï¼å¨é¨ä½¿ç¨å¤§åã\n\né»è®¤æåµä¸ï¼æ¯ä¸ªå¹éææ¡£é½æ¾ç¤ºææå­æ®µãè¦éæ©è¦æ¾ç¤ºçææ¡£å­æ®µï¼è¯·å°é¼ æ æ¬åå¨âå¯ç¨å­æ®µâåè¡¨ä¸ï¼ç¶ååå»è¦åå«çæ¯ä¸ªå­æ®µæè¾¹çæ·»å æé®ãä¾å¦ï¼å¦æåªæ·»å  account_numberï¼åæ¾ç¤ºå°æ´æ¹ä¸ºåå«äºä¸ªå¸å·çç®ååè¡¨ï¼\n\n\n\nkibana çæç´¢æ éµå¾ª query-string-syntax ææ¡£ä¸­æè¯´æçæ¥è¯¢è¯­ä¹ã\n\nè¿éè¯´æä¸äºæåºæ¬çæ¥è¯¢è¯­ä¹ã\n\næ¥è¯¢å­ç¬¦ä¸²ä¼è¢«è§£æä¸ºä¸ç³»åçæ¯è¯­åè¿ç®ç¬¦ãä¸ä¸ªæ¯è¯­å¯ä»¥æ¯ä¸ä¸ªåè¯ï¼å¦ï¼quickãbrownï¼æç¨åå¼å·åå´çç­è¯­ï¼å¦"quick brown"ï¼ã\n\næ¥è¯¢æä½åè®¸æ¨èªå®ä¹æç´¢ - ä¸é¢ä»ç»äºå¯ç¨çéé¡¹ã\n\n# 2.1.1. å­æ®µåç§°\n\næ­£å¦æ¥è¯¢å­ç¬¦ä¸²æ¥è¯¢ä¸­æè¿°ï¼å°å¨æç´¢æ¡ä»¶ä¸­æç´¢ default_fieldï¼ä½å¯ä»¥å¨æ¥è¯¢è¯­æ³ä¸­æå®å¶ä»å­æ®µï¼\n\nä¾å¦ï¼\n\n * æ¥è¯¢ status å­æ®µä¸­åå« active å³é®å­\n\nstatus:active\n\n\n * title å­æ®µåå« quick æ brown å³é®å­ãå¦ææ¨çç¥ or è¿ç®ç¬¦ï¼åå°ä½¿ç¨é»è®¤è¿ç®ç¬¦\n\ntitle:(quick or brown)\ntitle:(quick brown)\n\n\n * author å­æ®µæ¥æ¾ç²¾ç¡®çç­è¯­ "john smith"ï¼å³ç²¾ç¡®æ¥æ¾ã\n\nauthor:"john smith"\n\n\n * ä»»æå­æ®µ book.titleï¼book.content æ book.date é½åå« quick æ brownï¼æ³¨ææä»¬éè¦å¦ä½ä½¿ç¨ \\* è¡¨ç¤ºééç¬¦ï¼\n\nbook.\\*:(quick brown)\n\n\n * title å­æ®µåå«ä»»æé null å¼\n\n_exists_:title\n\n\n# 2.1.2. ééç¬¦\n\nelk æä¾äº ? å * ä¸¤ä¸ªééç¬¦ã\n\n * ? è¡¨ç¤ºä»»æåä¸ªå­ç¬¦ï¼\n * * è¡¨ç¤ºä»»æé¶ä¸ªæå¤ä¸ªå­ç¬¦ã\n\nqu?ck bro*\n\n\n> æ³¨æï¼ééç¬¦æ¥è¯¢ä¼ä½¿ç¨å¤§éçåå­å¹¶ä¸æ§è¡æ§è½è¾ä¸ºç³ç³ï¼æä»¥è¯·æç¨ã > æç¤ºï¼çº¯ééç¬¦ * è¢«åå¥ exsits æ¥è¯¢ï¼ä»èæé«äºæ¥è¯¢æçãå æ­¤ï¼ééç¬¦ fieldï¼* å°å¹éåå«ç©ºå¼çææ¡£ï¼å¦ï¼{âfieldâï¼ââ}ï¼ä½æ¯å¦æå­æ®µä¸¢å¤±ææ¾ç¤ºå°å¼ç½®ä¸º null åä¸å¹éï¼å¦ï¼âfieldâï¼null} > æç¤ºï¼å¨ä¸ä¸ªåè¯çå¼å¤´ï¼ä¾å¦ï¼*ingï¼ä½¿ç¨ééç¬¦è¿ç§æ¹å¼çæ¥è¯¢éç¹å«å¤§ï¼å ä¸ºç´¢å¼ä¸­çæææ¯è¯­é½éè¦æ£æ¥ï¼ä»¥é²ä¸ä¸å¹éãéè¿å° allow_leading_wildcard è®¾ç½®ä¸º falseï¼å¯ä»¥ç¦ç¨ã\n\n# 2.1.3. æ­£åè¡¨è¾¾å¼\n\nå¯ä»¥éè¿ / å°æ­£åè¡¨è¾¾å¼åè£¹å¨æ¥è¯¢å­ç¬¦ä¸²ä¸­è¿è¡æ¥è¯¢\n\nä¾ï¼\n\nname:/joh?n(ath[oa]n)/\n\n\næ¯æçæ­£åè¡¨è¾¾å¼è¯­ä¹å¯ä»¥åèï¼regular expression syntax\n\n# 2.1.4. æ¨¡ç³æ¥è¯¢\n\næä»¬å¯ä»¥ä½¿ç¨ ~ è¿ç®ç¬¦æ¥è¿è¡æ¨¡ç³æ¥è¯¢ã\n\nä¾ï¼\n\nåè®¾æä»¬å®éæ³æ¥è¯¢\n\nquick brown forks\n\n\nä½æ¯ï¼ç±äºæ¼åéè¯¯ï¼æä»¬çæ¥è¯¢å³é®å­åæå¦ä¸æåµï¼ä¾ç¶å¯ä»¥æ¥å°æ³è¦çç»æã\n\nquikc\\~ brwn\\~ foks\\~\n\n\nè¿ç§æ¨¡ç³æ¥è¯¢ä½¿ç¨ damerau-levenshtein è·ç¦»æ¥æ¥æ¾ææå¹éæå¤ä¸¤ä¸ªæ´æ¹çé¡¹ãæè°çæ´æ¹æ¯æåä¸ªå­ç¬¦çæå¥ï¼å é¤ææ¿æ¢ï¼æèä¸¤ä¸ªç¸é»å­ç¬¦çæ¢ä½ã\n\né»è®¤ç¼è¾è·ç¦»ä¸º 2ï¼ä½ç¼è¾è·ç¦»ä¸º 1 åºè¶³ä»¥ææææäººç±»æ¼åéè¯¯ç 80ï¼ãå®å¯ä»¥è¢«æå®ä¸ºï¼\n\nquikc\\~1\n\n\n# 2.1.5. è¿ä¼¼æ£ç´¢\n\nå°½ç®¡ç­è¯­æ¥è¯¢ï¼ä¾å¦ï¼john smithï¼ææææçè¯æ¡é½æ¯å®å¨ç¸åçé¡ºåºï¼ä½æ¯è¿ä¼¼æ¥è¯¢åè®¸æå®çåè¯è¿ä¸æ­¥åå¼æä»¥ä¸åçé¡ºåºæåãä¸æ¨¡ç³æ¥è¯¢å¯ä»¥ä¸ºåè¯ä¸­çå­ç¬¦æå®æå¤§ç¼è¾è·ç¦»ä¸æ ·ï¼è¿ä¼¼æç´¢ä¹åè®¸æä»¬æå®ç­è¯­ä¸­åè¯çæå¤§ç¼è¾è·ç¦»ï¼\n\nä¾\n\n"fox quick"\\~5\n\n\nå­æ®µä¸­çææ¬è¶æ¥è¿æ¥è¯¢å­ç¬¦ä¸²ä¸­æå®çåå§é¡ºåºï¼è¯¥ææ¡£å°±è¶è¢«è®¤ä¸ºæ¯ç¸å³çãå½ä¸ä¸é¢çç¤ºä¾æ¥è¯¢ç¸æ¯æ¶ï¼ç­è¯­ "quick fox" å°è¢«è®¤ä¸ºæ¯ "quick brown fox" æ´è¿ä¼¼æ¥è¯¢æ¡ä»¶ã\n\n# 2.1.6. èå´\n\nå¯ä»¥ä¸ºæ¥æï¼æ°å­æå­ç¬¦ä¸²å­æ®µæå®èå´ãé­åºé´èå´ç¨æ¹æ¬å· [min to max] åå¼åºé´èå´ç¨è±æ¬å· {min to max} æ¥æå®ã\n\næä»¬ä¸å¦¨æ¥çä¸äºç¤ºä¾ã\n\n * 2012 å¹´çæææ¥å­\n\ndate:[2012-01-01 to 2012-12-31]\n\n\n * æ°å­ 1 å° 5\n\ncount:[1 to 5]\n\n\n * å¨ alpha å omega ä¹é´çæ ç­¾ï¼ä¸åæ¬ alpha å omega\n\ntag:{alpha to omega}\n\n\n * 10 ä»¥ä¸çæ°å­\n\ncount:[10 to *]\n\n\n * 2012 å¹´ä»¥åçæææ¥æ\n\ndate:{* to 2012-01-01}\n\n\næ­¤å¤ï¼å¼åºé´åé­åºé´ä¹å¯ä»¥ç»åä½¿ç¨\n\n * æ°ç» 1 å° 5ï¼ä½ä¸åæ¬ 5\n\ncount:[1 to 5}\n\n\nä¸è¾¹æ ççèå´ä¹å¯ä»¥ä½¿ç¨ä»¥ä¸è¯­æ³ï¼\n\nage:>10\nage:>=10\nage:<10\nage:<=10\n\n\nå½ç¶ï¼ä½ ä¹å¯ä»¥ä½¿ç¨ and è¿ç®ç¬¦æ¥å¾å°è¿ä¸ªæ¥è¯¢ç»æçäº¤é\n\nage:(>=10 and <20)\nage:(+>=10 +<20)\n\n\n# 2.1.7. boosting\n\nä½¿ç¨æä½ç¬¦ ^ ä½¿ä¸ä¸ªæ¯è¯­æ¯å¦ä¸ä¸ªæ¯è¯­æ´ç¸å³ãä¾å¦ï¼å¦ææä»¬æ³æ¥æ¾æææå³çç¸çææ¡£ï¼ä½æä»¬å¯¹çç¸ç¹å«æå´è¶£ï¼\n\nquick^2 fox\n\n\né»è®¤æåå¼æ¯ 1ï¼ä½å¯ä»¥æ¯ä»»ä½æ­£æµ®ç¹æ°ã 0 å° 1 ä¹é´çæååå°äºç¸å³æ§ã\n\nå¢å¼ºä¹å¯ä»¥åºç¨äºç­è¯­æç»ï¼\n\n"john smith"^2   (foo bar)^4\n\n\n# 2.1.8. å¸å°æä½\n\né»è®¤æåµä¸ï¼åªè¦ä¸ä¸ªè¯å¹éï¼ææè¯é½æ¯å¯éçãæç´¢ foo bar baz å°æ¥æ¾åå« foo æ bar æ baz ä¸­çä¸ä¸ªæå¤ä¸ªçä»»ä½ææ¡£ãæä»¬å·²ç»è®¨è®ºäºä¸é¢çdefault_operatorï¼å®åè®¸ä½ å¼ºå¶è¦æ±ææçé¡¹ï¼ä½ä¹æå¸å°è¿ç®ç¬¦å¯ä»¥å¨æ¥è¯¢å­ç¬¦ä¸²æ¬èº«ä¸­ä½¿ç¨ï¼ä»¥æä¾æ´å¤çæ§å¶ã\n\né¦éçæä½ç¬¦æ¯ +ï¼æ­¤æ¯è¯­å¿é¡»å­å¨ï¼å - ï¼æ­¤æ¯è¯­ä¸å¾å­å¨ï¼ãææå¶ä»æ¡æ¬¾æ¯å¯éçãä¾å¦ï¼è¿ä¸ªæ¥è¯¢ï¼\n\nquick brown +fox -news\n\n\nè¿æ¡æ¥è¯¢æå³çï¼\n\n * fox å¿é¡»å­å¨\n * news å¿é¡»ä¸å­å¨\n * quick å brown æ¯å¯æå¯æ ç\n\nçæçè¿ç®ç¬¦ andï¼or å notï¼ä¹åæ &&ï¼|| å !ï¼ä¹è¢«æ¯æãç¶èï¼è¿äºæä½ç¬¦æä¸å®çä¼åçº§ï¼not ä¼åäº andï¼and ä¼åäº orãè½ç¶ + å - ä»å½±åè¿ç®ç¬¦å³ä¾§çæ¯è¯­ï¼ä½ and å or ä¼å½±åå·¦ä¾§åå³ä¾§çæ¯è¯­ã\n\n# 2.1.9. åç»\n\nå¤ä¸ªæ¯è¯­æå­å¥å¯ä»¥ç¨åæ¬å·ç»åå¨ä¸èµ·ï¼å½¢æå­æ¥è¯¢\n\n(quick or brown) and fox\n\n\nå¯ä»¥ä½¿ç¨ç»æ¥å®ä½ç¹å®çå­æ®µï¼æèå¢å¼ºå­æ¥è¯¢çç»æï¼\n\nstatus:(active or pending) title:(full text search)^2\n\n\n# 2.1.10. ä¿çå­\n\nå¦æä½ éè¦ä½¿ç¨ä»»ä½å¨ä½ çæ¥è¯¢æ¬èº«ä¸­ä½ä¸ºæä½ç¬¦çå­ç¬¦ï¼èä¸æ¯ä½ä¸ºæä½ç¬¦ï¼ï¼é£ä¹ä½ åºè¯¥ç¨ä¸ä¸ªåææ æ¥è½¬ä¹å®ä»¬ãä¾å¦ï¼è¦æç´¢ï¼1 + 1ï¼= 2ï¼æ¨éè¦å°æ¥è¯¢åä¸º \\(1\\+1\\)\\=2\n\nä¿çå­ç¬¦æ¯ï¼+ - = && || > < ! ( ) { } [ ] ^ " ~ * ? : \\ /\n\næ æ³æ­£ç¡®å°è½¬ä¹è¿äºç¹æ®å­ç¬¦å¯è½ä¼å¯¼è´è¯­æ³éè¯¯ï¼ä»èé»æ­¢æ¨çæ¥è¯¢è¿è¡ã\n\n# 2.1.11. ç©ºæ¥è¯¢\n\nå¦ææ¥è¯¢å­ç¬¦ä¸²ä¸ºç©ºæä»åå«ç©ºæ ¼ï¼åæ¥è¯¢å°çæä¸ä¸ªç©ºçç»æéã\n\n\n# 2.2. å¯è§å\n\nè¦æ³ä½¿ç¨å¯è§åçæ¹å¼å±ç¤ºæ¨çæ°æ®ï¼è¯·åå»ä¾§é¢å¯¼èªæ ä¸­ç å¯è§åï¼visualizeï¼ã\n\nvisualize å·¥å·ä½¿æ¨è½å¤ä»¥å¤ç§æ¹å¼ï¼å¦é¥¼å¾ãæ±ç¶å¾ãæ²çº¿å¾ãåå¸å¾ç­ï¼æ¥çæ°æ®ãè¦å¼å§ä½¿ç¨ï¼è¯·ç¹å»èè²ç create a visualization æ + æé®ã\n\n\n\næè®¸å¤å¯è§åç±»åå¯ä¾éæ©ã\n\n\n\nä¸é¢ï¼æä»¬æ¥çåå»ºå ä¸ªå¾æ ç¤ºä¾ï¼\n\n# 2.2.1. pie\n\næ¨å¯ä»¥ä»ä¿å­çæç´¢ä¸­æå»ºå¯è§åæä»¶ï¼ä¹å¯ä»¥è¾å¥æ°çæç´¢æ¡ä»¶ãè¦è¾å¥æ°çæç´¢æ¡ä»¶ï¼é¦åéè¦éæ©ä¸ä¸ªç´¢å¼æ¨¡å¼æ¥æå®è¦æç´¢çç´¢å¼ã\n\né»è®¤æç´¢å¹éææææ¡£ãæåï¼ä¸ä¸ªâåçâåå«æ´ä¸ªé¥¼å¾ï¼\n\n\n\nè¦æå®å¨å¾è¡¨ä¸­å±ç¤ºåªäºæ°æ®ï¼è¯·ä½¿ç¨ elasticsearch å­å¨æ¡¶èåãåç»æ±æ»åªæ¯å°ä¸æ¨çæç´¢æ¡ä»¶ç¸å¹éçææ¡£åç±»å°ä¸åçåç±»ä¸­ï¼ä¹ç§°ä¸ºåç»ã\n\nä¸ºæ¯ä¸ªèå´å®ä¹ä¸ä¸ªå­å¨æ¡¶ï¼\n\n 1. åå» split slicesã\n 2. å¨ aggregation åè¡¨ä¸­éæ© termsãæ³¨æï¼è¿éç terms æ¯ elk ééæ°æ®æ¶å®ä¹å¥½çå­æ®µææ ç­¾ã\n 3. å¨ field åè¡¨ä¸­éæ© level.keywordã\n 4. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n# 2.2.2. vertical bar\n\næä»¬å¨å±ç¤ºä¸ä¸å¦ä½åå»ºæ±ç¶å¾ã\n\n 1. ç¹å»èè²ç create a visualization æ + æé®ãéæ© vertical bar\n 2. éæ©ç´¢å¼æ¨¡å¼ãç±äºæ¨å°æªå®ä¹ä»»ä½ bucket ï¼å æ­¤æ¨ä¼çå°ä¸ä¸ªå¤§æ ï¼æ¾ç¤ºä¸é»è®¤ééç¬¦æ¥è¯¢å¹éçææ¡£æ»æ°ã\n 3. æå® y è½´æä»£è¡¨çå­æ®µ\n 4. æå® x è½´æä»£è¡¨çå­æ®µ\n 5. ç¹å» æé®æ¥æ´æ°å¾è¡¨ã\n\n\n\nå®æåï¼å¦ææ³è¦ä¿å­è¿ä¸ªå¾è¡¨ï¼å¯ä»¥ç¹å»é¡µé¢æä¸æ¹ä¸æ ä¸­ç save æé®ã\n\n\n# 2.3. æ¥è¡¨\n\næ¥è¡¨ï¼dashboardï¼ å¯ä»¥æ´ååå±äº« visualize éåã\n\n 1. ç¹å»ä¾§é¢å¯¼èªæ ä¸­ç dashboardã\n 2. ç¹å»æ·»å æ¾ç¤ºä¿å­çå¯è§ååè¡¨ã\n 3. ç¹å»ä¹åä¿å­ç visualizeï¼ç¶åç¹å»åè¡¨åºé¨çå°åä¸ç®­å¤´å³é­å¯è§ååè¡¨ã\n 4. å°é¼ æ æ¬åå¨å¯è§åå¯¹è±¡ä¸ä¼æ¾ç¤ºåè®¸æ¨ç¼è¾ï¼ç§»å¨ï¼å é¤åè°æ´å¯è§åå¯¹è±¡å¤§å°çå®¹å¨æ§ä»¶ã\n\n\n# 3. faq\n\n\n# 3.1. kibana no default index pattern warning\n\n**é®é¢ï¼**å®è£ elk åï¼è®¿é® kibana é¡µé¢æ¶ï¼æç¤ºä»¥ä¸éè¯¯ä¿¡æ¯ï¼\n\nwarning no default index pattern. you must select or create one to continue.\n...\nunable to fetch mapping. do you have indices matching the pattern?\n\n\nè¿å°±è¯´æ logstash æ²¡æææ¥å¿åå¥å° elasticsearchã\n\nè§£å³æ¹æ³ï¼\n\næ£æ¥ logstash ä¸ elasticsearch ä¹é´çéè®¯æ¯å¦æé®é¢ï¼ä¸è¬é®é¢å°±åºå¨è¿ã\n\n\n# 4. åèèµæ\n\n * kibana å®ç½\n * kibana github\n * kibana å®æ¹ææ¡£',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elastic ææ¯æ ä¹ Logstash",frontmatter:{title:"Elastic ææ¯æ ä¹ Logstash",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Logstash"],permalink:"/pages/0da19c/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/06.Elastic%E6%8A%80%E6%9C%AF%E6%A0%88%E4%B9%8BLogstash.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/06.Elasticææ¯æ ä¹Logstash.md",key:"v-9a9ffafe",path:"/pages/0da19c/",headers:[{level:2,title:"ç®ä»",slug:"ç®ä»",normalizedTitle:"ç®ä»",charIndex:117},{level:3,title:"åè½",slug:"åè½",normalizedTitle:"åè½",charIndex:155},{level:3,title:"å·¥ä½åç",slug:"å·¥ä½åç",normalizedTitle:"å·¥ä½åç",charIndex:270},{level:2,title:"è®¾ç½®",slug:"è®¾ç½®",normalizedTitle:"è®¾ç½®",charIndex:548},{level:3,title:"è®¾ç½®æä»¶",slug:"è®¾ç½®æä»¶",normalizedTitle:"è®¾ç½®æä»¶",charIndex:555},{level:3,title:"logstash.yml è®¾ç½®é¡¹",slug:"logstash-yml-è®¾ç½®é¡¹",normalizedTitle:"logstash.yml è®¾ç½®é¡¹",charIndex:801},{level:2,title:"å¯å¨",slug:"å¯å¨",normalizedTitle:"å¯å¨",charIndex:589},{level:3,title:"å½ä»¤è¡",slug:"å½ä»¤è¡",normalizedTitle:"å½ä»¤è¡",charIndex:4126},{level:3,title:"éç½®æä»¶",slug:"éç½®æä»¶",normalizedTitle:"éç½®æä»¶",charIndex:591},{level:4,title:"éç½®æä»¶ç»æ",slug:"éç½®æä»¶ç»æ",normalizedTitle:"éç½®æä»¶ç»æ",charIndex:4665},{level:4,title:"æä»¶éç½®",slug:"æä»¶éç½®",normalizedTitle:"æä»¶éç½®",charIndex:3062},{level:4,title:"å¼ç±»å",slug:"å¼ç±»å",normalizedTitle:"å¼ç±»å",charIndex:5145},{level:2,title:"æä»¶",slug:"æä»¶",normalizedTitle:"æä»¶",charIndex:204},{level:3,title:"input",slug:"input",normalizedTitle:"input",charIndex:293},{level:4,title:"å¸¸ç¨ input æä»¶",slug:"å¸¸ç¨-input-æä»¶",normalizedTitle:"å¸¸ç¨ input æä»¶",charIndex:5995},{level:3,title:"filter",slug:"filter",normalizedTitle:"filter",charIndex:316},{level:4,title:"å¸¸ç¨ filter æä»¶",slug:"å¸¸ç¨-filter-æä»¶",normalizedTitle:"å¸¸ç¨ filter æä»¶",charIndex:6356},{level:3,title:"output",slug:"output",normalizedTitle:"output",charIndex:301},{level:4,title:"å¸¸ç¨ output æä»¶",slug:"å¸¸ç¨-output-æä»¶",normalizedTitle:"å¸¸ç¨ output æä»¶",charIndex:6703},{level:3,title:"codec",slug:"codec",normalizedTitle:"codec",charIndex:5603},{level:4,title:"å¸¸ç¨ codec æä»¶",slug:"å¸¸ç¨-codec-æä»¶",normalizedTitle:"å¸¸ç¨ codec æä»¶",charIndex:7026},{level:2,title:"å®æ",slug:"å®æ",normalizedTitle:"å®æ",charIndex:7149},{level:3,title:"ä¼ è¾æ§å¶å°æ°æ®",slug:"ä¼ è¾æ§å¶å°æ°æ®",normalizedTitle:"ä¼ è¾æ§å¶å°æ°æ®",charIndex:7204},{level:3,title:"ä¼ è¾ logback æ¥å¿",slug:"ä¼ è¾-logback-æ¥å¿",normalizedTitle:"ä¼ è¾ logback æ¥å¿",charIndex:7584},{level:4,title:"TCP åºç¨",slug:"tcp-åºç¨",normalizedTitle:"tcp åºç¨",charIndex:7891},{level:4,title:"UDP åºç¨",slug:"udp-åºç¨",normalizedTitle:"udp åºç¨",charIndex:9420},{level:3,title:"ä¼ è¾æä»¶",slug:"ä¼ è¾æä»¶",normalizedTitle:"ä¼ è¾æä»¶",charIndex:10248},{level:2,title:"å°æå·§",slug:"å°æå·§",normalizedTitle:"å°æå·§",charIndex:10950},{level:3,title:"å¯å¨ãç»æ­¢åºç¨",slug:"å¯å¨ãç»æ­¢åºç¨",normalizedTitle:"å¯å¨ãç»æ­¢åºç¨",charIndex:10958},{level:2,title:"èµæ",slug:"èµæ",normalizedTitle:"èµæ",charIndex:11409},{level:2,title:"æ¨èéè¯»",slug:"æ¨èéè¯»",normalizedTitle:"æ¨èéè¯»",charIndex:11523}],headersStr:"ç®ä» åè½ å·¥ä½åç è®¾ç½® è®¾ç½®æä»¶ logstash.yml è®¾ç½®é¡¹ å¯å¨ å½ä»¤è¡ éç½®æä»¶ éç½®æä»¶ç»æ æä»¶éç½® å¼ç±»å æä»¶ input å¸¸ç¨ input æä»¶ filter å¸¸ç¨ filter æä»¶ output å¸¸ç¨ output æä»¶ codec å¸¸ç¨ codec æä»¶ å®æ ä¼ è¾æ§å¶å°æ°æ® ä¼ è¾ logback æ¥å¿ TCP åºç¨ UDP åºç¨ ä¼ è¾æä»¶ å°æå·§ å¯å¨ãç»æ­¢åºç¨ èµæ æ¨èéè¯»",content:'# Elastic ææ¯æ ä¹ Logstash\n\n> æ¬ææ¯ Elastic ææ¯æ ï¼ELKï¼ç Logstash åºç¨ã\n> \n> å¦æä¸äºè§£ Elastic çå®è£ãéç½®ãé¨ç½²ï¼å¯ä»¥åèï¼Elastic ææ¯æ ä¹å¿«éå¥é¨\n\n\n# ç®ä»\n\nLogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\n\n# åè½\n\nLogstash æ¯ Elasticsearch çæä½³æ°æ®ç®¡éã\n\nLogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãLogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# å·¥ä½åç\n\nLogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ Logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãLogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\nåé¢å°å¯¹æä»¶å±å¼è®²è§£ï¼æä¸ä¸è¡¨ã\n\n\n# è®¾ç½®\n\n\n# è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç JVM éç½®æä»¶ã\n * startup.options (Linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ Logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  Logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   LOGSTASH_HOME/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ CPU                                                      Number of the hostâs CPU cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           LS_HEAP_SIZE åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  JVM å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ Logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼Logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç Logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           Platform-specific. See [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               None\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã Logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å Logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ SIGHUP ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     Logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ YAML ç»æä¸­ã                                                                  None\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼JSON æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  Logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           LOGSTASH_HOME/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# å¯å¨\n\n\n# å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ Logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç Logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº Logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ Input Plugins, Output Plugins, Filter Plugins, å Codec Plugins ã\n\n# å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * Array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * Lists\n\n;(path) => [\'/var/log/messages\', \'/var/log/*.log\']\n;(uris) => [\'http://elastic.co\', \'http://example.net\']\n\n\n * Boolean\n\n;(ssl_enable) => true\n\n\n * Bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10MiB"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * Codec\n\n;(codec) => \'json\'\n\n\n * Hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * Number\n\n;(port) => 33\n\n\n * Password\n\n;(my_password) => \'password\'\n\n\n * URI\n\n;(my_uri) => \'http://foo:bar@example.net\'\n\n\n * Path\n\n;(my_path) => \'/tmp/logstash\'\n\n\n * String\n\n * è½¬ä¹å­ç¬¦\n\n\n# æä»¶\n\n\n# input\n\n> Logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãWeb åºç¨ãæ°æ®å­å¨ä»¥ååç§ AWS æå¡ééæ°æ®ã\n\n# å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å UNIX å½ä»¤ tail -0F ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® RFC3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã Redis ç»å¸¸ç¨ä½éä¸­å¼ Logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ Logstashâæè¿äººâç Logstash äºä»¶æéã\n * **beatsï¼**å¤çç± Filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼Input Plugins\n\n\n# filter\n\n> è¿æ»¤å¨æ¯ Logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã Grok ç®åæ¯ Logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n * **geoipï¼**æ·»å æå³ IP å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ Kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼Filter Plugins\n\n\n# output\n\n> è¾åºæ¯ Logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» Elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ UDP åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼Output Plugins\n\n\n# codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ JSON æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼Codec Plugins\n\n\n# å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ Logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç Java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº UDP / TCP / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# TCP åºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\ntcp {\n  port => 9251\n  codec => json_lines\n  mode => server\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupId>net.logstash.logback</groupId>\n <artifactId>logstash-logback-encoder</artifactId>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-core</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-classic</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-access</artifactId>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-TCP" class="net.logstash.logback.appender.LogstashTcpSocketAppender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n <appender-ref ref="ELK-TCP" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# UDP åºç¨\n\nUDP å TCP çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ TCP åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-UDP" class="net.logstash.logback.appender.LogstashSocketAppender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n  <appender-ref ref="ELK-UDP" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# ä¼ è¾æä»¶\n\n> å¨ Java Web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ Tomcat ãNginx ãMysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# å°æå·§\n\n\n# å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.sh\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.sh\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\nPID=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${PID}\n\n\n\n# èµæ\n\n * Logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * ELK Stack æå¨æå\n * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n\n\n# æ¨èéè¯»\n\n * Elastic ææ¯æ \n * JavaStack',normalizedContent:'# elastic ææ¯æ ä¹ logstash\n\n> æ¬ææ¯ elastic ææ¯æ ï¼elkï¼ç logstash åºç¨ã\n> \n> å¦æä¸äºè§£ elastic çå®è£ãéç½®ãé¨ç½²ï¼å¯ä»¥åèï¼elastic ææ¯æ ä¹å¿«éå¥é¨\n\n\n# ç®ä»\n\nlogstash å¯ä»¥ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n\n\n# åè½\n\nlogstash æ¯ elasticsearch çæä½³æ°æ®ç®¡éã\n\nlogstash æ¯æä»¶å¼ç®¡çæ¨¡å¼ï¼å¨è¾å¥ãè¿æ»¤ãè¾åºä»¥åç¼ç è¿ç¨ä¸­é½å¯ä»¥ä½¿ç¨æä»¶è¿è¡å®å¶ãlogstash ç¤¾åºæè¶è¿ 200 ç§å¯ç¨æä»¶ã\n\n\n# å·¥ä½åç\n\nlogstash æä¸¤ä¸ªå¿è¦åç´ ï¼input å output ï¼ä¸ä¸ªå¯éåç´ ï¼filterã\n\nè¿ä¸ä¸ªåç´ ï¼åå«ä»£è¡¨ logstash äºä»¶å¤ççä¸ä¸ªé¶æ®µï¼è¾å¥ > è¿æ»¤å¨ > è¾åºã\n\n\n\n * input è´è´£ä»æ°æ®æºééæ°æ®ã\n * filter å°æ°æ®ä¿®æ¹ä¸ºä½ æå®çæ ¼å¼æåå®¹ã\n * output å°æ°æ®ä¼ è¾å°ç®çå°ã\n\nå¨å®éåºç¨åºæ¯ä¸­ï¼éå¸¸è¾å¥ãè¾åºãè¿æ»¤å¨ä¸æ­¢ä¸ä¸ªãlogstash çè¿ä¸ä¸ªåç´ é½ä½¿ç¨æä»¶å¼ç®¡çæ¹å¼ï¼ç¨æ·å¯ä»¥æ ¹æ®åºç¨éè¦ï¼çµæ´»çéç¨åé¶æ®µéè¦çæä»¶ï¼å¹¶ç»åä½¿ç¨ã\n\nåé¢å°å¯¹æä»¶å±å¼è®²è§£ï¼æä¸ä¸è¡¨ã\n\n\n# è®¾ç½®\n\n\n# è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç jvm éç½®æä»¶ã\n * startup.options (linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   logstash_home/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ cpu                                                      number of the hostâs cpu cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           ls_heap_size åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  jvm å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           platform-specific. see [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               none\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ sighup ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ yaml ç»æä¸­ã                                                                  none\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼json æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           logstash_home/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# å¯å¨\n\n\n# å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ input plugins, output plugins, filter plugins, å codec plugins ã\n\n# å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * lists\n\n;(path) => [\'/var/log/messages\', \'/var/log/*.log\']\n;(uris) => [\'http://elastic.co\', \'http://example.net\']\n\n\n * boolean\n\n;(ssl_enable) => true\n\n\n * bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10mib"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * codec\n\n;(codec) => \'json\'\n\n\n * hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * number\n\n;(port) => 33\n\n\n * password\n\n;(my_password) => \'password\'\n\n\n * uri\n\n;(my_uri) => \'http://foo:bar@example.net\'\n\n\n * path\n\n;(my_path) => \'/tmp/logstash\'\n\n\n * string\n\n * è½¬ä¹å­ç¬¦\n\n\n# æä»¶\n\n\n# input\n\n> logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãweb åºç¨ãæ°æ®å­å¨ä»¥ååç§ aws æå¡ééæ°æ®ã\n\n# å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å unix å½ä»¤ tail -0f ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® rfc3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã redis ç»å¸¸ç¨ä½éä¸­å¼ logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ logstashâæè¿äººâç logstash äºä»¶æéã\n * **beatsï¼**å¤çç± filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼input plugins\n\n\n# filter\n\n> è¿æ»¤å¨æ¯ logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã grok ç®åæ¯ logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n * **geoipï¼**æ·»å æå³ ip å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼filter plugins\n\n\n# output\n\n> è¾åºæ¯ logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ udp åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼output plugins\n\n\n# codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ json æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼codec plugins\n\n\n# å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº udp / tcp / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# tcp åºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\ntcp {\n  port => 9251\n  codec => json_lines\n  mode => server\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupid>net.logstash.logback</groupid>\n <artifactid>logstash-logback-encoder</artifactid>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-core</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-classic</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-access</artifactid>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-tcp" class="net.logstash.logback.appender.logstashtcpsocketappender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="utf-8" class="net.logstash.logback.encoder.logstashencoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n <appender-ref ref="elk-tcp" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# udp åºç¨\n\nudp å tcp çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ tcp åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-udp" class="net.logstash.logback.appender.logstashsocketappender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n  <appender-ref ref="elk-udp" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# ä¼ è¾æä»¶\n\n> å¨ java web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ tomcat ãnginx ãmysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# å°æå·§\n\n\n# å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.sh\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.sh\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\npid=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${pid}\n\n\n\n# èµæ\n\n * logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * elk stack æå¨æå\n * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n\n\n# æ¨èéè¯»\n\n * elastic ææ¯æ \n * javastack',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Logstash è¿ç»´",frontmatter:{title:"Logstash è¿ç»´",date:"2020-06-16T07:10:44.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic","Logstash"],permalink:"/pages/ec3c6f/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/07.Logstash%E8%BF%90%E7%BB%B4.html",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/07.Logstashè¿ç»´.md",key:"v-2e4e7fc6",path:"/pages/ec3c6f/",headers:[{level:2,title:"1. å®è£",slug:"_1-å®è£",normalizedTitle:"1. å®è£",charIndex:85},{level:3,title:"1.1. å®è£æ­¥éª¤",slug:"_1-1-å®è£æ­¥éª¤",normalizedTitle:"1.1. å®è£æ­¥éª¤",charIndex:95},{level:2,title:"2. éç½®",slug:"_2-éç½®",normalizedTitle:"2. éç½®",charIndex:404},{level:3,title:"2.1. è®¾ç½®æä»¶",slug:"_2-1-è®¾ç½®æä»¶",normalizedTitle:"2.1. è®¾ç½®æä»¶",charIndex:414},{level:3,title:"2.2. logstash.yml è®¾ç½®é¡¹",slug:"_2-2-logstash-yml-è®¾ç½®é¡¹",normalizedTitle:"2.2. logstash.yml è®¾ç½®é¡¹",charIndex:665},{level:2,title:"3. å¯å¨",slug:"_3-å¯å¨",normalizedTitle:"3. å¯å¨",charIndex:3988},{level:3,title:"3.1. å½ä»¤è¡",slug:"_3-1-å½ä»¤è¡",normalizedTitle:"3.1. å½ä»¤è¡",charIndex:3998},{level:3,title:"3.2. éç½®æä»¶",slug:"_3-2-éç½®æä»¶",normalizedTitle:"3.2. éç½®æä»¶",charIndex:4414},{level:4,title:"3.2.1. éç½®æä»¶ç»æ",slug:"_3-2-1-éç½®æä»¶ç»æ",normalizedTitle:"3.2.1. éç½®æä»¶ç»æ",charIndex:4547},{level:4,title:"3.2.2. æä»¶éç½®",slug:"_3-2-2-æä»¶éç½®",normalizedTitle:"3.2.2. æä»¶éç½®",charIndex:4739},{level:4,title:"3.2.3. å¼ç±»å",slug:"_3-2-3-å¼ç±»å",normalizedTitle:"3.2.3. å¼ç±»å",charIndex:5041},{level:2,title:"4. æä»¶",slug:"_4-æä»¶",normalizedTitle:"4. æä»¶",charIndex:5784},{level:3,title:"4.1. input",slug:"_4-1-input",normalizedTitle:"4.1. input",charIndex:5794},{level:4,title:"4.1.1. å¸¸ç¨ input æä»¶",slug:"_4-1-1-å¸¸ç¨-input-æä»¶",normalizedTitle:"4.1.1. å¸¸ç¨ input æä»¶",charIndex:5902},{level:3,title:"4.2. filter",slug:"_4-2-filter",normalizedTitle:"4.2. filter",charIndex:6199},{level:4,title:"4.2.1. å¸¸ç¨ filter æä»¶",slug:"_4-2-1-å¸¸ç¨-filter-æä»¶",normalizedTitle:"4.2.1. å¸¸ç¨ filter æä»¶",charIndex:6275},{level:3,title:"4.3. output",slug:"_4-3-output",normalizedTitle:"4.3. output",charIndex:6563},{level:4,title:"4.3.1. å¸¸ç¨ output æä»¶",slug:"_4-3-1-å¸¸ç¨-output-æä»¶",normalizedTitle:"4.3.1. å¸¸ç¨ output æä»¶",charIndex:6638},{level:3,title:"4.4. codec",slug:"_4-4-codec",normalizedTitle:"4.4. codec",charIndex:6946},{level:4,title:"4.4.1. å¸¸ç¨ codec æä»¶",slug:"_4-4-1-å¸¸ç¨-codec-æä»¶",normalizedTitle:"4.4.1. å¸¸ç¨ codec æä»¶",charIndex:6973},{level:2,title:"5. å®æ",slug:"_5-å®æ",normalizedTitle:"5. å®æ",charIndex:7103},{level:3,title:"5.1. ä¼ è¾æ§å¶å°æ°æ®",slug:"_5-1-ä¼ è¾æ§å¶å°æ°æ®",normalizedTitle:"5.1. ä¼ è¾æ§å¶å°æ°æ®",charIndex:7161},{level:3,title:"5.2. ä¼ è¾ logback æ¥å¿",slug:"_5-2-ä¼ è¾-logback-æ¥å¿",normalizedTitle:"5.2. ä¼ è¾ logback æ¥å¿",charIndex:7546},{level:4,title:"5.2.1. TCP åºç¨",slug:"_5-2-1-tcp-åºç¨",normalizedTitle:"5.2.1. tcp åºç¨",charIndex:7858},{level:4,title:"5.2.2. UDP åºç¨",slug:"_5-2-2-udp-åºç¨",normalizedTitle:"5.2.2. udp åºç¨",charIndex:9613},{level:3,title:"5.3. ä¼ è¾æä»¶",slug:"_5-3-ä¼ è¾æä»¶",normalizedTitle:"5.3. ä¼ è¾æä»¶",charIndex:10450},{level:2,title:"6. å°æå·§",slug:"_6-å°æå·§",normalizedTitle:"6. å°æå·§",charIndex:11157},{level:3,title:"6.1. å¯å¨ãç»æ­¢åºç¨",slug:"_6-1-å¯å¨ãç»æ­¢åºç¨",normalizedTitle:"6.1. å¯å¨ãç»æ­¢åºç¨",charIndex:11168},{level:2,title:"7. åèèµæ",slug:"_7-åèèµæ",normalizedTitle:"7. åèèµæ",charIndex:11626}],headersStr:"1. å®è£ 1.1. å®è£æ­¥éª¤ 2. éç½® 2.1. è®¾ç½®æä»¶ 2.2. logstash.yml è®¾ç½®é¡¹ 3. å¯å¨ 3.1. å½ä»¤è¡ 3.2. éç½®æä»¶ 3.2.1. éç½®æä»¶ç»æ 3.2.2. æä»¶éç½® 3.2.3. å¼ç±»å 4. æä»¶ 4.1. input 4.1.1. å¸¸ç¨ input æä»¶ 4.2. filter 4.2.1. å¸¸ç¨ filter æä»¶ 4.3. output 4.3.1. å¸¸ç¨ output æä»¶ 4.4. codec 4.4.1. å¸¸ç¨ codec æä»¶ 5. å®æ 5.1. ä¼ è¾æ§å¶å°æ°æ® 5.2. ä¼ è¾ logback æ¥å¿ 5.2.1. TCP åºç¨ 5.2.2. UDP åºç¨ 5.3. ä¼ è¾æä»¶ 6. å°æå·§ 6.1. å¯å¨ãç»æ­¢åºç¨ 7. åèèµæ",content:'# Logstash è¿ç»´\n\n> Logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 1. å®è£\n\n\n# 1.1. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼å¨ logstash å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼æ·»å ä¸ä¸ª logstash.conf æä»¶ï¼æå®è¦ä½¿ç¨çæä»¶ä»¥åæ¯ä¸ªæä»¶çè®¾ç½®ãä¸¾ä¸ªç®åçä¾å­ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\nï¼3ï¼è¿è¡ bin/logstash -f logstash.conf ï¼Windows ä¸è¿è¡bin/logstash.bat -f logstash.confï¼\n\n\n# 2. éç½®\n\n\n# 2.1. è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç JVM éç½®æä»¶ã\n * startup.options (Linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ Logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# 2.2. logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  Logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   LOGSTASH_HOME/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ CPU                                                      Number of the hostâs CPU cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           LS_HEAP_SIZE åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  JVM å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ Logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼Logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç Logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           Platform-specific. See [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               None\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã Logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å Logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ SIGHUP ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     Logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ YAML ç»æä¸­ã                                                                  None\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼JSON æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  Logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           LOGSTASH_HOME/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# 3. å¯å¨\n\n\n# 3.1. å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ Logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç Logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# 3.2. éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# 3.2.1. éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº Logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# 3.2.2. æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ Input Plugins, Output Plugins, Filter Plugins, å Codec Plugins ã\n\n# 3.2.3. å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * Array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * Lists\n\n  path => [ "/var/log/messages", "/var/log/*.log" ]\n  uris => [ "http://elastic.co", "http://example.net" ]\n\n\n * Boolean\n\n  ssl_enable => true\n\n\n * Bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10MiB"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * Codec\n\n  codec => "json"\n\n\n * Hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * Number\n\n  port => 33\n\n\n * Password\n\n  my_password => "password"\n\n\n * URI\n\n  my_uri => "http://foo:bar@example.net"\n\n\n * Path\n\n  my_path => "/tmp/logstash"\n\n\n * String\n\n * è½¬ä¹å­ç¬¦\n\n\n# 4. æä»¶\n\n\n# 4.1. input\n\n> Logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãWeb åºç¨ãæ°æ®å­å¨ä»¥ååç§ AWS æå¡ééæ°æ®ã\n\n# 4.1.1. å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å UNIX å½ä»¤ tail -0F ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® RFC3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã Redis ç»å¸¸ç¨ä½éä¸­å¼ Logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ Logstashâæè¿äººâç Logstash äºä»¶æéã\n * **beatsï¼**å¤çç± Filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼Input Plugins\n\n\n# 4.2. filter\n\n> è¿æ»¤å¨æ¯ Logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# 4.2.1. å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã Grok ç®åæ¯ Logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n\n * **geoipï¼**æ·»å æå³ IP å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ Kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼Filter Plugins\n\n\n# 4.3. output\n\n> è¾åºæ¯ Logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# 4.3.1. å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» Elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ UDP åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼Output Plugins\n\n\n# 4.4. codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# 4.4.1. å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ JSON æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼Codec Plugins\n\n\n# 5. å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ Logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# 5.1. ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# 5.2. ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç Java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº UDP / TCP / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# 5.2.1. TCP åºç¨\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\n  # stdin { }\n  tcp {\n    # host:portå°±æ¯ä¸é¢appenderä¸­ç destinationï¼\n # è¿éå¶å®ælogstashä½ä¸ºæå¡ï¼å¼å¯9250ç«¯å£æ¥æ¶logbackååºçæ¶æ¯\n    host => "127.0.0.1" port => 9250 mode => "server" tags => ["tags"] codec => json_lines\n  }\n}\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupId>net.logstash.logback</groupId>\n <artifactId>logstash-logback-encoder</artifactId>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-core</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-classic</artifactId>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupId>ch.qos.logback</groupId>\n <artifactId>logback-access</artifactId>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-TCP" class="net.logstash.logback.appender.LogstashTcpSocketAppender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="UTF-8" class="net.logstash.logback.encoder.LogstashEncoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n <appender-ref ref="ELK-TCP" />\n</logger>\n\n\nå¤§ååæï¼æ­¤åï¼io.github.dunwu.spring åä¸­ç TRACE åä»¥ä¸çº§å«çæ¥å¿ä¿¡æ¯é½ä¼è¢«å®åè¾åºå° logstash æå¡ã\n\n\n\næ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# 5.2.2. UDP åºç¨\n\nUDP å TCP çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ Java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ TCP åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="ELK-UDP" class="net.logstash.logback.appender.LogstashSocketAppender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="TRACE" additivity="false">\n  <appender-ref ref="ELK-UDP" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ Java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# 5.3. ä¼ è¾æä»¶\n\n> å¨ Java Web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ Tomcat ãNginx ãMysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# 6. å°æå·§\n\n\n# 6.1. å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.shï¼\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.shï¼\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\nPID=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${PID}\n\n\n\n# 7. åèèµæ\n\n * Logstash å®ç½\n * Logstash Github\n * Logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * ELK Stack æå¨æå\n * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®',normalizedContent:'# logstash è¿ç»´\n\n> logstash æ¯å¼æºçæå¡å¨ç«¯æ°æ®å¤çç®¡éï¼è½å¤åæ¶ä»å¤ä¸ªæ¥æºééæ°æ®ï¼è½¬æ¢æ°æ®ï¼ç¶åå°æ°æ®åéå°æ¨æåæ¬¢çâå­å¨åºâä¸­ã\n\n\n# 1. å®è£\n\n\n# 1.1. å®è£æ­¥éª¤\n\nå®è£æ­¥éª¤å¦ä¸ï¼\n\nï¼1ï¼å¨ logstash å®æ¹ä¸è½½å°åä¸è½½æéçæ¬åå¹¶è§£åå°æ¬å°ã\n\nï¼2ï¼æ·»å ä¸ä¸ª logstash.conf æä»¶ï¼æå®è¦ä½¿ç¨çæä»¶ä»¥åæ¯ä¸ªæä»¶çè®¾ç½®ãä¸¾ä¸ªç®åçä¾å­ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\nï¼3ï¼è¿è¡ bin/logstash -f logstash.conf ï¼windows ä¸è¿è¡bin/logstash.bat -f logstash.confï¼\n\n\n# 2. éç½®\n\n\n# 2.1. è®¾ç½®æä»¶\n\n * logstash.ymlï¼logstash çé»è®¤å¯å¨éç½®æä»¶\n * jvm.optionsï¼logstash ç jvm éç½®æä»¶ã\n * startup.options (linux)ï¼åå«ç³»ç»å®è£èæ¬å¨ /usr/share/logstash/bin ä¸­ä½¿ç¨çéé¡¹ä¸ºæ¨çç³»ç»æå»ºéå½çå¯å¨èæ¬ãå®è£ logstash è½¯ä»¶åæ¶ï¼ç³»ç»å®è£èæ¬å°å¨å®è£è¿ç¨ç»ææ¶æ§è¡ï¼å¹¶ä½¿ç¨ startup.options ä¸­æå®çè®¾ç½®æ¥è®¾ç½®ç¨æ·ï¼ç»ï¼æå¡åç§°åæå¡æè¿°ç­éé¡¹ã\n\n\n# 2.2. logstash.yml è®¾ç½®é¡¹\n\nèéé¨åè®¾ç½®é¡¹ï¼æ´å¤é¡¹è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html\n\nåæ°                         æè¿°                                                                                           é»è®¤å¼\nnode.name                  èç¹å                                                                                          æºå¨çä¸»æºå\npath.data                  logstash åå¶æä»¶ç¨äºä»»ä½æä¹æ§éæ±çç®å½ã                                                                   logstash_home/data\npipeline.workers           åæ¶æ§è¡ç®¡éçè¿æ»¤å¨åè¾åºé¶æ®µçå·¥ä½ä»»å¡æ°éãå¦æåç°äºä»¶æ­£å¨å¤ä»½ï¼æ cpu                                                      number of the hostâs cpu cores\n                           æªé¥±åï¼è¯·èèå¢å æ­¤æ°å­ä»¥æ´å¥½å°å©ç¨æºå¨å¤çè½åã\npipeline.batch.size        å°è¯æ§è¡è¿æ»¤å¨åè¾åºä¹åï¼åä¸ªå·¥ä½çº¿ç¨ä»è¾å¥æ¶éçæå¤§äºä»¶æ°éãè¾å¤§çæ¹éå¤çå¤§å°ä¸è¬æ¥è¯´æçæ´é«ï¼ä½æ¯ä»¥å¢å çåå­å¼éä¸ºä»£ä»·ãæ¨å¯è½å¿é¡»éè¿è®¾ç½®                    125\n                           ls_heap_size åéæ¥ææä½¿ç¨è¯¥éé¡¹æ¥å¢å  jvm å å¤§å°ã\npipeline.batch.delay       åå»ºç®¡éäºä»¶æ¹å¤çæ¶ï¼å¨å°ä¸ä¸ªå°ºå¯¸è¿å°çæ¹æ¬¡åéç»ç®¡éå·¥ä½ä»»å¡ä¹åï¼ç­å¾æ¯ä¸ªäºä»¶éè¦å¤é¿æ¶é´ï¼æ¯«ç§ï¼ã                                          5\npipeline.unsafe_shutdown   å¦æè®¾ç½®ä¸º trueï¼åå³ä½¿å¨åå­ä¸­ä»å­å¨ inflight äºä»¶æ¶ï¼ä¹ä¼å¼ºå¶ logstash                                             false\n                           å¨å³é­æé´éåºãé»è®¤æåµä¸ï¼logstash\n                           å°æç»éåºï¼ç´å°æææ¥æ¶å°çäºä»¶é½è¢«æ¨éå°è¾åºãå¯ç¨æ­¤éé¡¹å¯è½ä¼å¯¼è´å³æºæé´æ°æ®ä¸¢å¤±ã\npath.config                ä¸»ç®¡éç logstash éç½®è·¯å¾ãå¦ææ¨æå®ä¸ä¸ªç®å½æééç¬¦ï¼éç½®æä»¶å°æå­æ¯é¡ºåºä»ç®å½ä¸­è¯»åã                                           platform-specific. see [dir-layout].\nconfig.string              åå«ç¨äºä¸»ç®¡éçç®¡ééç½®çå­ç¬¦ä¸²ãä½¿ç¨ä¸éç½®æä»¶ç¸åçè¯­æ³ã                                                               none\nconfig.test_and_exit       è®¾ç½®ä¸º true æ¶ï¼æ£æ¥éç½®æ¯å¦ææï¼ç¶åéåºãè¯·æ³¨æï¼ä½¿ç¨æ­¤è®¾ç½®ä¸ä¼æ£æ¥ grok æ¨¡å¼çæ­£ç¡®æ§ã logstash                                 false\n                           å¯ä»¥ä»ç®å½ä¸­è¯»åå¤ä¸ªéç½®æä»¶ãå¦æå°æ­¤è®¾ç½®ä¸ log.levelï¼debug ç»åä½¿ç¨ï¼å logstash\n                           å°è®°å½ç»åçéç½®æä»¶ï¼å¹¶æ³¨æå¶æºæä»¶çéç½®åã\nconfig.reload.automatic    è®¾ç½®ä¸º true æ¶ï¼å®ææ£æ¥éç½®æ¯å¦å·²æ´æ¹ï¼å¹¶å¨éç½®æ´æ¹æ¶éæ°å è½½éç½®ãè¿ä¹å¯ä»¥éè¿ sighup ä¿¡å·æå¨è§¦åã                                   false\nconfig.reload.interval     logstash æ£æ¥éç½®æä»¶æ´æ¹çæ¶é´é´éã                                                                      3s\nconfig.debug               è®¾ç½®ä¸º true                                                                                     false\n                           æ¶ï¼å°å®å¨ç¼è¯çéç½®æ¾ç¤ºä¸ºè°è¯æ¥å¿æ¶æ¯ãæ¨è¿å¿é¡»è®¾ç½®log.levelï¼debugãè­¦åï¼æ¥å¿æ¶æ¯å°åæ¬ä»»ä½ä¼ éç»æä»¶éç½®ä½ä¸ºææçâå¯ç âéé¡¹ï¼å¹¶å¯è½å¯¼è´ææå¯ç åºç°å¨æ¨çæ¥å¿ï¼\nconfig.support_escapes     å½è®¾ç½®ä¸º true æ¶ï¼å¸¦å¼å·çå­ç¬¦ä¸²å°å¤çè½¬ä¹å­ç¬¦ã                                                                  false\nmodules                    éç½®æ¶ï¼æ¨¡åå¿é¡»å¤äºä¸è¡¨æè¿°çåµå¥ yaml ç»æä¸­ã                                                                  none\nhttp.host                  ç»å®å°å                                                                                         "127.0.0.1"\nhttp.port                  ç»å®ç«¯å£                                                                                         9600\nlog.level                  æ¥å¿çº§å«ãææéé¡¹ï¼fatal > error > warn > info > debug > trace                                        info\nlog.format                 æ¥å¿æ ¼å¼ãjson ï¼json æ ¼å¼ï¼æ plain ï¼åå¯¹è±¡ï¼                                                             plain\npath.logs                  logstash èªèº«æ¥å¿çå­å¨è·¯å¾                                                                           logstash_home/logs\npath.plugins               å¨åªéå¯ä»¥æ¾å°èªå®ä¹çæä»¶ãæ¨å¯ä»¥å¤æ¬¡æå®æ­¤è®¾ç½®ä»¥åå«å¤ä¸ªè·¯å¾ã                                                             \n\n\n# 3. å¯å¨\n\n\n# 3.1. å½ä»¤è¡\n\néè¿å½ä»¤è¡å¯å¨ logstash çæ¹å¼å¦ä¸ï¼\n\nbin/logstash [options]\n\n\nå¶ä¸­ options æ¯æ¨å¯ä»¥æå®ç¨äºæ§å¶ logstash æ§è¡çå½ä»¤è¡æ å¿ã\n\nå¨å½ä»¤è¡ä¸è®¾ç½®çä»»ä½æ å¿é½ä¼è¦ç logstash è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çç¸åºè®¾ç½®ï¼ä½è®¾ç½®æä»¶æ¬èº«ä¸ä¼æ´æ¹ã\n\n> æ³¨\n> \n> è½ç¶å¯ä»¥éè¿æå®å½ä»¤è¡åæ°çæ¹å¼ï¼æ¥æ§å¶ logstash çè¿è¡æ¹å¼ï¼ä½æ¾ç¶è¿ä¹åå¾éº»ç¦ã\n> \n> å»ºè®®éè¿æå®éç½®æä»¶çæ¹å¼ï¼æ¥æ§å¶ logstash è¿è¡ï¼å¯å¨å½ä»¤å¦ä¸ï¼\n> \n> bin/logstash -f logstash.conf\n> \n> \n> è¥æ³äºè§£æ´å¤çå½ä»¤è¡åæ°ç»èï¼è¯·åèï¼https://www.elastic.co/guide/en/logstash/current/running-logstash-command-line.html\n\n\n# 3.2. éç½®æä»¶\n\nä¸èï¼æä»¬äºè§£å°ï¼logstash å¯ä»¥æ§è¡ bin/logstash -f logstash.conf ï¼æç§éç½®æä»¶ä¸­çåæ°å»è¦çé»è®¤è®¾ç½®æä»¶ï¼logstash.ymlï¼ä¸­çè®¾ç½®ã\n\nè¿èï¼æä»¬å°±æ¥å­¦ä¹ ä¸ä¸è¿ä¸ªéç½®æä»¶å¦ä½éç½®åæ°ã\n\n# 3.2.1. éç½®æä»¶ç»æ\n\nå¨å·¥ä½åçä¸èä¸­ï¼æä»¬å·²ç»ç¥éäº logstash ä¸»è¦æä¸ä¸ªå·¥ä½é¶æ®µ input ãfilterãoutputãè logstash éç½®æä»¶æä»¶ç»æä¹ä¸ä¹ç¸å¯¹åºï¼\n\ninput {}\n\nfilter {}\n\noutput {}\n\n\n> æ¯ä¸ªé¨åé½åå«ä¸ä¸ªæå¤ä¸ªæä»¶çéç½®éé¡¹ãå¦ææå®äºå¤ä¸ªè¿æ»¤å¨ï¼åä¼æç§å®ä»¬å¨éç½®æä»¶ä¸­çæ¾ç¤ºé¡ºåºåºç¨å®ä»¬ã\n\n# 3.2.2. æä»¶éç½®\n\næä»¶çéç½®ç±æä»¶åç§°åæä»¶çä¸ä¸ªè®¾ç½®åç»æã\n\nä¸é¢çä¾å­ä¸­éç½®äºä¸¤ä¸ªè¾å¥æä»¶éç½®ï¼\n\ninput {\n  file {\n    path => "/var/log/messages"\n    type => "syslog"\n  }\n\n  file {\n    path => "/var/log/apache/access.log"\n    type => "apache"\n  }\n}\n\n\næ¨å¯ä»¥éç½®çè®¾ç½®å æä»¶ç±»åèå¼ãä½ å¯ä»¥åèï¼ input plugins, output plugins, filter plugins, å codec plugins ã\n\n# 3.2.3. å¼ç±»å\n\nä¸ä¸ªæä»¶å¯ä»¥è¦æ±è®¾ç½®çå¼æ¯ä¸ä¸ªç¹å®çç±»åï¼æ¯å¦å¸å°å¼ï¼åè¡¨æåå¸å¼ãä»¥ä¸å¼ç±»ååæ¯æã\n\n * array\n\n  users => [ {id => 1, name => bob}, {id => 2, name => jane} ]\n\n\n * lists\n\n  path => [ "/var/log/messages", "/var/log/*.log" ]\n  uris => [ "http://elastic.co", "http://example.net" ]\n\n\n * boolean\n\n  ssl_enable => true\n\n\n * bytes\n\n  my_bytes => "1113"   # 1113 bytes\n  my_bytes => "10mib"  # 10485760 bytes\n  my_bytes => "100kib" # 102400 bytes\n  my_bytes => "180 mb" # 180000000 bytes\n\n\n * codec\n\n  codec => "json"\n\n\n * hash\n\nmatch => {\n  "field1" => "value1"\n  "field2" => "value2"\n  ...\n}\n\n\n * number\n\n  port => 33\n\n\n * password\n\n  my_password => "password"\n\n\n * uri\n\n  my_uri => "http://foo:bar@example.net"\n\n\n * path\n\n  my_path => "/tmp/logstash"\n\n\n * string\n\n * è½¬ä¹å­ç¬¦\n\n\n# 4. æä»¶\n\n\n# 4.1. input\n\n> logstash æ¯æåç§è¾å¥éæ© ï¼å¯ä»¥å¨åä¸æ¶é´ä»ä¼å¤å¸¸ç¨æ¥æºææäºä»¶ãè½å¤ä»¥è¿ç»­çæµå¼ä¼ è¾æ¹å¼ï¼è½»æ¾å°ä»æ¨çæ¥å¿ãææ ãweb åºç¨ãæ°æ®å­å¨ä»¥ååç§ aws æå¡ééæ°æ®ã\n\n# 4.1.1. å¸¸ç¨ input æä»¶\n\n * fileï¼ä»æä»¶ç³»ç»ä¸çæä»¶è¯»åï¼å°±å unix å½ä»¤ tail -0f ä¸æ ·\n * **syslogï¼**å¨ä¼æå¨ç¥çç«¯å£ 514 ä¸ä¾¦å¬ç³»ç»æ¥å¿æ¶æ¯ï¼å¹¶æ ¹æ® rfc3164 æ ¼å¼è¿è¡è§£æ\n * **redisï¼**ä» redis æå¡å¨è¯»åï¼ä½¿ç¨ redis ééå redis åè¡¨ã redis ç»å¸¸ç¨ä½éä¸­å¼ logstash å®è£ä¸­çâä»£çâï¼å®å°æ¥èªè¿ç¨ logstashâæè¿äººâç logstash äºä»¶æéã\n * **beatsï¼**å¤çç± filebeat åéçäºä»¶ã\n\næ´å¤è¯¦æè¯·è§ï¼input plugins\n\n\n# 4.2. filter\n\n> è¿æ»¤å¨æ¯ logstash ç®¡éä¸­çä¸­é´å¤çè®¾å¤ãå¦æç¬¦åç¹å®æ¡ä»¶ï¼æ¨å¯ä»¥å°æ¡ä»¶è¿æ»¤å¨ç»åå¨ä¸èµ·ï¼å¯¹äºä»¶æ§è¡æä½ã\n\n# 4.2.1. å¸¸ç¨ filter æä»¶\n\n * **grokï¼**è§£æåç»æä»»æææ¬ã grok ç®åæ¯ logstash ä¸­å°éç»æåæ¥å¿æ°æ®è§£æä¸ºç»æååå¯æ¥è¯¢çæä½³æ¹æ³ã\n\n * **mutateï¼**å¯¹äºä»¶å­æ®µæ§è¡ä¸è¬è½¬æ¢ãæ¨å¯ä»¥éå½åï¼å é¤ï¼æ¿æ¢åä¿®æ¹äºä»¶ä¸­çå­æ®µã\n\n * **dropï¼**å®å¨æ¾å¼ä¸ä¸ªäºä»¶ï¼ä¾å¦è°è¯äºä»¶ã\n\n * **cloneï¼**å¶ä½ä¸ä¸ªäºä»¶çå¯æ¬ï¼å¯è½ä¼æ·»å æå é¤å­æ®µã\n\n * **geoipï¼**æ·»å æå³ ip å°åçå°çä½ç½®çä¿¡æ¯ï¼ä¹å¯ä»¥å¨ kibana ä¸­æ¾ç¤ºæäººçå¾è¡¨ï¼ï¼\n\næ´å¤è¯¦æè¯·è§ï¼filter plugins\n\n\n# 4.3. output\n\n> è¾åºæ¯ logstash ç®¡éçæåé¶æ®µãä¸ä¸ªäºä»¶å¯ä»¥éè¿å¤ä¸ªè¾åºï¼ä½æ¯ä¸æ¦ææè¾åºå¤çå®æï¼äºä»¶å°±å®æäºæ§è¡ã\n\n# 4.3.1. å¸¸ç¨ output æä»¶\n\n * **elasticsearchï¼**å°äºä»¶æ°æ®åéç» elasticsearchï¼æ¨èæ¨¡å¼ï¼ã\n * **fileï¼**å°äºä»¶æ°æ®åå¥æä»¶æç£çã\n * **graphiteï¼**å°äºä»¶æ°æ®åéç» graphiteï¼ä¸ä¸ªæµè¡çå¼æºå·¥å·ï¼å­å¨åç»å¶ææ ã http://graphite.readthedocs.io/en/latest/ï¼ã\n * **statsdï¼**å°äºä»¶æ°æ®åéå° statsd ï¼è¿æ¯ä¸ç§ä¾¦å¬ç»è®¡æ°æ®çæå¡ï¼å¦è®¡æ°å¨åå®æ¶å¨ï¼éè¿ udp åéå¹¶å°èååéå°ä¸ä¸ªæå¤ä¸ªå¯æå¥çåç«¯æå¡ï¼ã\n\næ´å¤è¯¦æè¯·è§ï¼output plugins\n\n\n# 4.4. codec\n\nç¨äºæ ¼å¼åå¯¹åºçåå®¹ã\n\n# 4.4.1. å¸¸ç¨ codec æä»¶\n\n * **jsonï¼**ä»¥ json æ ¼å¼å¯¹æ°æ®è¿è¡ç¼ç æè§£ç ã\n * **multilineï¼**å°å¤è¡ææ¬äºä»¶ï¼å¦ java å¼å¸¸åå æ è·è¸ªæ¶æ¯ï¼åå¹¶ä¸ºåä¸ªäºä»¶ã\n\næ´å¤æä»¶è¯·è§ï¼codec plugins\n\n\n# 5. å®æ\n\nåé¢çåå®¹é½æ¯å¯¹ logstash çä»ç»ååçè¯´æãæ¥ä¸æ¥ï¼æä»¬æ¥å®æä¸äºå¸¸è§çåºç¨åºæ¯ã\n\n\n# 5.1. ä¼ è¾æ§å¶å°æ°æ®\n\n> stdin input æä»¶ä»æ åè¾å¥è¯»åäºä»¶ãè¿æ¯æç®åç input æä»¶ï¼ä¸è¬ç¨äºæµè¯åºæ¯ã\n\nåºç¨\n\nï¼1ï¼åå»º logstash-input-stdin.conf ï¼\n\ninput { stdin { } }\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-stdin.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼\n\nbin/logstash -f logstash-input-stdin.conf\n\n\n\n# 5.2. ä¼ è¾ logback æ¥å¿\n\n> elk é»è®¤ä½¿ç¨ç java æ¥å¿å·¥å·æ¯ log4j2 ï¼å¹¶ä¸æ¯æ logback å log4jã\n> \n> æ³ä½¿ç¨ logback + logstash ï¼å¯ä»¥ä½¿ç¨ logstash-logback-encoder ãlogstash-logback-encoder æä¾äº udp / tcp / å¼æ­¥æ¹å¼æ¥ä¼ è¾æ¥å¿æ°æ®å° logstashã\n> \n> å¦æä½ ä½¿ç¨çæ¯ log4j ï¼ä¹ä¸æ¯ä¸å¯ä»¥ç¨è¿ç§æ¹å¼ï¼åªè¦å¼å¥æ¡¥æ¥ jar åå³å¯ãå¦æä½ å¯¹ log4j ãlogback ï¼ææ¯æ¡¥æ¥ jar åä¸å¤ªäºè§£ï¼å¯ä»¥åèæçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\n# 5.2.1. tcp åºç¨\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-tcp.conf ï¼\n\ninput {\n  # stdin { }\n  tcp {\n    # host:portå°±æ¯ä¸é¢appenderä¸­ç destinationï¼\n # è¿éå¶å®ælogstashä½ä¸ºæå¡ï¼å¼å¯9250ç«¯å£æ¥æ¶logbackååºçæ¶æ¯\n    host => "127.0.0.1" port => 9250 mode => "server" tags => ["tags"] codec => json_lines\n  }\n}\noutput {\n  elasticsearch { hosts => ["localhost:9200"] }\n  stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-tcp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\n<dependency>\n <groupid>net.logstash.logback</groupid>\n <artifactid>logstash-logback-encoder</artifactid>\n <version>4.11</version>\n</dependency>\n\n\x3c!-- logback ä¾èµå --\x3e\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-core</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-classic</artifactid>\n <version>1.2.3</version>\n</dependency>\n<dependency>\n <groupid>ch.qos.logback</groupid>\n <artifactid>logback-access</artifactid>\n <version>1.2.3</version>\n</dependency>\n\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-tcp" class="net.logstash.logback.appender.logstashtcpsocketappender">\n \x3c!--\n destination æ¯ logstash æå¡ç host:portï¼\n ç¸å½äºå logstash å»ºç«äºç®¡éï¼å°æ¥å¿æ°æ®å®åä¼ è¾å° logstash\n --\x3e\n <destination>192.168.28.32:9251</destination>\n <encoder charset="utf-8" class="net.logstash.logback.encoder.logstashencoder"/>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n <appender-ref ref="elk-tcp" />\n</logger>\n\n\nå¤§ååæï¼æ­¤åï¼io.github.dunwu.spring åä¸­ç trace åä»¥ä¸çº§å«çæ¥å¿ä¿¡æ¯é½ä¼è¢«å®åè¾åºå° logstash æå¡ã\n\n\n\næ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n# 5.2.2. udp åºç¨\n\nudp å tcp çä½¿ç¨æ¹å¼å¤§åå°å¼ã\n\nlogstash éç½®ï¼\n\nï¼1ï¼åå»º logstash-input-udp.conf ï¼\n\ninput {\nudp {\n  port => 9250\n  codec => json\n}\n}\noutput {\n elasticsearch { hosts => ["localhost:9200"] }\n stdout { codec => rubydebug }\n}\n\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-udp.html\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-udp.conf\n\njava åºç¨éç½®ï¼\n\nï¼1ï¼å¨ java åºç¨ç pom.xml ä¸­å¼å¥ jar åï¼\n\nä¸ tcp åºç¨ ä¸èä¸­çå¼å¥ä¾èµåå®å¨ç¸åã\n\nï¼2ï¼æ¥çï¼å¨ logback.xml ä¸­æ·»å  appender\n\n<appender name="elk-udp" class="net.logstash.logback.appender.logstashsocketappender">\n  <host>192.168.28.32</host>\n  <port>9250</port>\n</appender>\n<logger name="io.github.dunwu.spring" level="trace" additivity="false">\n  <appender-ref ref="elk-udp" />\n</logger>\n\n\nï¼3ï¼æ¥ä¸æ¥ï¼å°±æ¯ logback çå·ä½ä½¿ç¨ ï¼å¦æå¯¹æ­¤ä¸äºè§£ï¼ä¸å¦¨åèä¸ä¸æçè¿ç¯åæï¼ç»è¯´ java ä¸»æµæ¥å¿å·¥å·åº ã\n\nå®ä¾ï¼æç logback.xml\n\n\n# 5.3. ä¼ è¾æä»¶\n\n> å¨ java web é¢åï¼éè¦ç¨å°ä¸äºéè¦çå·¥å·ï¼ä¾å¦ tomcat ãnginx ãmysql ç­ãè¿äºä¸å±äºä¸å¡åºç¨ï¼ä½æ¯å®ä»¬çæ¥å¿æ°æ®å¯¹äºå®ä½é®é¢ãåæç»è®¡åæ ·å¾éè¦ãè¿æ¶æ æ³ä½¿ç¨ logback æ¹å¼å°å®ä»¬çæ¥å¿ä¼ è¾å° logstashã\n> \n> å¦ä½ééè¿äºæ¥å¿æä»¶å¢ï¼å«æ¥ï¼ä½ å¯ä»¥ä½¿ç¨ logstash ç file input æä»¶ã\n> \n> éè¦æ³¨æçæ¯ï¼ä¼ è¾æä»¶è¿ç§æ¹å¼ï¼å¿é¡»å¨æ¥å¿æå¨çæºå¨ä¸é¨ç½² logstash ã\n\nåºç¨\n\nlogstash éç½®\n\nï¼1ï¼åå»º logstash-input-file.conf ï¼\n\ninput {\n file {\n  path => ["/var/log/nginx/access.log"]\n  type => "nginx-access-log"\n  start_position => "beginning"\n }\n}\n\noutput {\n if [type] == "nginx-access-log" {\n  elasticsearch {\n   hosts => ["localhost:9200"]\n   index => "nginx-access-log"\n  }\n }\n}\n\n\nï¼2ï¼æ§è¡ logstashï¼ä½¿ç¨ -f æ¥æå®ä½ çéç½®æä»¶ï¼bin/logstash -f logstash-input-file.conf\n\næ´å¤éç½®é¡¹å¯ä»¥åèï¼https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html\n\n\n# 6. å°æå·§\n\n\n# 6.1. å¯å¨ãç»æ­¢åºç¨\n\nå¦æä½ ç logstash æ¯æ¬¡é½æ¯éè¿æå®éç½®æä»¶æ¹å¼å¯å¨ãä¸å¦¨å»ºç«ä¸ä¸ªå¯å¨èæ¬ã\n\n# cd xxx è¿å¥ logstash å®è£ç®å½ä¸ç bin ç®å½\nlogstash -f logstash.conf\n\n\nå¦æä½ ç logstash è¿è¡å¨ linux ç³»ç»ä¸ï¼ä¸å¦¨ä½¿ç¨ nohup æ¥å¯å¨ä¸ä¸ªå®æ¤è¿ç¨ãè¿æ ·åçå¥½å¤å¨äºï¼å³ä½¿å³é­ç»ç«¯ï¼åºç¨ä»ä¼è¿è¡ã\n\nåå»º startup.shï¼\n\nnohup ./logstash -f logstash.conf >> nohup.out 2>&1 &\n\n\nç»æ­¢åºç¨æ²¡æä»ä¹å¥½æ¹æ³ï¼ä½ åªè½ä½¿ç¨ ps -ef | grep logstash ï¼æ¥åºè¿ç¨ï¼å°å¶ kill ãä¸è¿ï¼æä»¬å¯ä»¥åä¸ä¸ªèæ¬æ¥å¹²è¿ä»¶äºï¼\n\nåå»º shutdown.shï¼\n\nèæ¬ä¸å¤è§£éï¼è¯·èªè¡é¢ä¼ä½ç¨ã\n\npid=`ps -ef | grep logstash | awk \'{ print $2}\' | head -n 1`\nkill -9 ${pid}\n\n\n\n# 7. åèèµæ\n\n * logstash å®ç½\n * logstash github\n * logstash å®æ¹ææ¡£\n * logstash-logback-encoder\n * elk stack æå¨æå\n * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®',charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Elastic ææ¯æ ",frontmatter:{title:"Elastic ææ¯æ ",date:"2022-04-11T16:52:35.000Z",categories:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],tags:["æ°æ®åº","æç´¢å¼ææ°æ®åº","Elastic"],permalink:"/pages/976ee9/"},regularPath:"/07.%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E6%95%B0%E6%8D%AE%E5%BA%93/02.Elastic/",relativePath:"07.æç´¢å¼ææ°æ®åº/02.Elastic/README.md",key:"v-5f7d314c",path:"/pages/976ee9/",headers:[{level:2,title:"ð åå®¹",slug:"ð-åå®¹",normalizedTitle:"ð åå®¹",charIndex:258},{level:2,title:"ð èµæ",slug:"ð-èµæ",normalizedTitle:"ð èµæ",charIndex:401},{level:2,title:"ðª ä¼ é",slug:"ðª-ä¼ é",normalizedTitle:"ðª ä¼ é",charIndex:702}],headersStr:"ð åå®¹ ð èµæ ðª ä¼ é",content:"# Elastic ææ¯æ \n\n> Elastic ææ¯æ éå¸¸è¢«ç¨æ¥ä½ä¸ºæ¥å¿ééãæ£ç´¢ãå¯è§åçè§£å³æ¹æ¡ã\n> \n> ELK æ¯ elastic å¬å¸æä¸ä¸æ¬¾äº§å Elasticsearch ãLogstash ãKibana çé¦å­æ¯ç»åã\n> \n> Logstash ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n> \n> Kibana å° Elasticsearch çæ°æ®åæå¹¶æ¸²æä¸ºå¯è§åçæ¥è¡¨ã\n> \n> Elastic ææ¯æ ï¼å¨ ELK çåºç¡ä¸æ©å±äºä¸äºæ°çäº§åï¼å¦ï¼Beats ãX-Pack ã\n\n\n# ð åå®¹\n\n * Elastic å¿«éå¥é¨\n * Elastic ææ¯æ ä¹ Filebeat\n * Filebeat è¿ç»´\n * Elastic ææ¯æ ä¹ Kibana\n * Kibana è¿ç»´\n * Elastic ææ¯æ ä¹ Logstash\n * Logstash è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * Logstash å®ç½\n   * Logstash Github\n   * Logstash å®æ¹ææ¡£\n   * Kibana å®ç½\n   * Kibana Github\n   * Kibana å®æ¹ææ¡£\n   * Beats å®ç½\n   * Beats Github\n   * Beats å®æ¹ææ¡£\n * ç¬¬ä¸æ¹å·¥å·\n   * logstash-logback-encoder\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n\n\n# ðª ä¼ é\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"# elastic ææ¯æ \n\n> elastic ææ¯æ éå¸¸è¢«ç¨æ¥ä½ä¸ºæ¥å¿ééãæ£ç´¢ãå¯è§åçè§£å³æ¹æ¡ã\n> \n> elk æ¯ elastic å¬å¸æä¸ä¸æ¬¾äº§å elasticsearch ãlogstash ãkibana çé¦å­æ¯ç»åã\n> \n> logstash ä¼ è¾åå¤çä½ çæ¥å¿ãäºå¡æå¶ä»æ°æ®ã\n> \n> kibana å° elasticsearch çæ°æ®åæå¹¶æ¸²æä¸ºå¯è§åçæ¥è¡¨ã\n> \n> elastic ææ¯æ ï¼å¨ elk çåºç¡ä¸æ©å±äºä¸äºæ°çäº§åï¼å¦ï¼beats ãx-pack ã\n\n\n# ð åå®¹\n\n * elastic å¿«éå¥é¨\n * elastic ææ¯æ ä¹ filebeat\n * filebeat è¿ç»´\n * elastic ææ¯æ ä¹ kibana\n * kibana è¿ç»´\n * elastic ææ¯æ ä¹ logstash\n * logstash è¿ç»´\n\n\n# ð èµæ\n\n * å®æ¹\n   * logstash å®ç½\n   * logstash github\n   * logstash å®æ¹ææ¡£\n   * kibana å®ç½\n   * kibana github\n   * kibana å®æ¹ææ¡£\n   * beats å®ç½\n   * beats github\n   * beats å®æ¹ææ¡£\n * ç¬¬ä¸æ¹å·¥å·\n   * logstash-logback-encoder\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n\n\n# ðª ä¼ é\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"å½æ¡£",frontmatter:{archivesPage:!0,title:"å½æ¡£",permalink:"/archives/",article:!1},regularPath:"/@pages/archivesPage.html",relativePath:"@pages/archivesPage.md",key:"v-c7c85e2e",path:"/archives/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"åç±»",frontmatter:{categoriesPage:!0,title:"åç±»",permalink:"/categories/",article:!1},regularPath:"/@pages/categoriesPage.html",relativePath:"@pages/categoriesPage.md",key:"v-03067a49",path:"/categories/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"æ ç­¾",frontmatter:{tagsPage:!0,title:"æ ç­¾",permalink:"/tags/",article:!1},regularPath:"/@pages/tagsPage.html",relativePath:"@pages/tagsPage.md",key:"v-be824b2e",path:"/tags/",headersStr:null,content:"",normalizedContent:"",charsets:{},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3},{title:"Home",frontmatter:{home:!0,heroImage:"img/bg.gif",heroText:"DB-TUTORIAL",tagline:"â db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã",bannerBg:"none",postList:"none",footer:"CC-BY-SA-4.0 Licensed | Copyright Â© 2018-Now Dunwu"},regularPath:"/",relativePath:"README.md",key:"v-91a7d35c",path:"/",headers:[{level:2,title:"æ°æ®åºç»¼å",slug:"æ°æ®åºç»¼å",normalizedTitle:"æ°æ®åºç»¼å",charIndex:105},{level:3,title:"åå¸å¼å­å¨åç",slug:"åå¸å¼å­å¨åç",normalizedTitle:"åå¸å¼å­å¨åç",charIndex:115},{level:4,title:"åå¸å¼çè®º",slug:"åå¸å¼çè®º",normalizedTitle:"åå¸å¼çè®º",charIndex:126},{level:4,title:"åå¸å¼å³é®ææ¯",slug:"åå¸å¼å³é®ææ¯",normalizedTitle:"åå¸å¼å³é®ææ¯",charIndex:198},{level:5,title:"æµéè°åº¦",slug:"æµéè°åº¦",normalizedTitle:"æµéè°åº¦",charIndex:209},{level:5,title:"æ°æ®è°åº¦",slug:"æ°æ®è°åº¦",normalizedTitle:"æ°æ®è°åº¦",charIndex:259},{level:3,title:"å¶ä»",slug:"å¶ä»",normalizedTitle:"å¶ä»",charIndex:343},{level:2,title:"æ°æ®åºä¸­é´ä»¶",slug:"æ°æ®åºä¸­é´ä»¶",normalizedTitle:"æ°æ®åºä¸­é´ä»¶",charIndex:379},{level:2,title:"å³ç³»åæ°æ®åº",slug:"å³ç³»åæ°æ®åº",normalizedTitle:"å³ç³»åæ°æ®åº",charIndex:453},{level:3,title:"å¬å±ç¥è¯",slug:"å¬å±ç¥è¯",normalizedTitle:"å¬å±ç¥è¯",charIndex:489},{level:3,title:"Mysql",slug:"mysql",normalizedTitle:"mysql",charIndex:573},{level:3,title:"å¶ä»",slug:"å¶ä»-2",normalizedTitle:"å¶ä»",charIndex:343},{level:2,title:"ææ¡£æ°æ®åº",slug:"ææ¡£æ°æ®åº",normalizedTitle:"ææ¡£æ°æ®åº",charIndex:906},{level:3,title:"MongoDB",slug:"mongodb",normalizedTitle:"mongodb",charIndex:916},{level:2,title:"KV æ°æ®åº",slug:"kv-æ°æ®åº",normalizedTitle:"kv æ°æ®åº",charIndex:1349},{level:3,title:"Redis",slug:"redis",normalizedTitle:"redis",charIndex:1360},{level:2,title:"åå¼æ°æ®åº",slug:"åå¼æ°æ®åº",normalizedTitle:"åå¼æ°æ®åº",charIndex:1790},{level:3,title:"HBase",slug:"hbase",normalizedTitle:"hbase",charIndex:1800},{level:2,title:"æç´¢å¼ææ°æ®åº",slug:"æç´¢å¼ææ°æ®åº",normalizedTitle:"æç´¢å¼ææ°æ®åº",charIndex:1919},{level:3,title:"Elasticsearch",slug:"elasticsearch",normalizedTitle:"elasticsearch",charIndex:1931},{level:3,title:"Elastic",slug:"elastic",normalizedTitle:"elastic",charIndex:1931},{level:2,title:"èµæ ð",slug:"èµæ-ð",normalizedTitle:"èµæ ð",charIndex:2530},{level:3,title:"æ°æ®åºç»¼åèµæ",slug:"æ°æ®åºç»¼åèµæ",normalizedTitle:"æ°æ®åºç»¼åèµæ",charIndex:2540},{level:3,title:"å³ç³»åæ°æ®åºèµæ",slug:"å³ç³»åæ°æ®åºèµæ",normalizedTitle:"å³ç³»åæ°æ®åºèµæ",charIndex:2998},{level:4,title:"Mysql èµæ",slug:"mysql-èµæ",normalizedTitle:"mysql èµæ",charIndex:3125},{level:3,title:"Nosql æ°æ®åºç»¼å",slug:"nosql-æ°æ®åºç»¼å",normalizedTitle:"nosql æ°æ®åºç»¼å",charIndex:5451},{level:3,title:"åå¼æ°æ®åºèµæ",slug:"åå¼æ°æ®åºèµæ",normalizedTitle:"åå¼æ°æ®åºèµæ",charIndex:6456},{level:4,title:"Cassandra èµæ",slug:"cassandra-èµæ",normalizedTitle:"cassandra èµæ",charIndex:6467},{level:4,title:"HBase èµæ",slug:"hbase-èµæ",normalizedTitle:"hbase èµæ",charIndex:6995},{level:3,title:"KV æ°æ®åºèµæ",slug:"kv-æ°æ®åºèµæ",normalizedTitle:"kv æ°æ®åºèµæ",charIndex:7573},{level:4,title:"Redis èµæ",slug:"redis-èµæ",normalizedTitle:"redis èµæ",charIndex:7585},{level:3,title:"ææ¡£æ°æ®åºèµæ",slug:"ææ¡£æ°æ®åºèµæ",normalizedTitle:"ææ¡£æ°æ®åºèµæ",charIndex:8536},{level:4,title:"MongoDB èµæ",slug:"mongodb-èµæ",normalizedTitle:"mongodb èµæ",charIndex:8661},{level:3,title:"æç´¢å¼ææ°æ®åºèµæ",slug:"æç´¢å¼ææ°æ®åºèµæ",normalizedTitle:"æç´¢å¼ææ°æ®åºèµæ",charIndex:9058},{level:4,title:"ElasticSearch",slug:"elasticsearch-2",normalizedTitle:"elasticsearch",charIndex:2290},{level:3,title:"å¾æ°æ®åº",slug:"å¾æ°æ®åº",normalizedTitle:"å¾æ°æ®åº",charIndex:9673},{level:3,title:"æ¶åºæ°æ®åº",slug:"æ¶åºæ°æ®åº",normalizedTitle:"æ¶åºæ°æ®åº",charIndex:10240},{level:2,title:"ä¼ é ðª",slug:"ä¼ é-ðª",normalizedTitle:"ä¼ é ðª",charIndex:10743}],headersStr:"æ°æ®åºç»¼å åå¸å¼å­å¨åç åå¸å¼çè®º åå¸å¼å³é®ææ¯ æµéè°åº¦ æ°æ®è°åº¦ å¶ä» æ°æ®åºä¸­é´ä»¶ å³ç³»åæ°æ®åº å¬å±ç¥è¯ Mysql å¶ä» ææ¡£æ°æ®åº MongoDB KV æ°æ®åº Redis åå¼æ°æ®åº HBase æç´¢å¼ææ°æ®åº Elasticsearch Elastic èµæ ð æ°æ®åºç»¼åèµæ å³ç³»åæ°æ®åºèµæ Mysql èµæ Nosql æ°æ®åºç»¼å åå¼æ°æ®åºèµæ Cassandra èµæ HBase èµæ KV æ°æ®åºèµæ Redis èµæ ææ¡£æ°æ®åºèµæ MongoDB èµæ æç´¢å¼ææ°æ®åºèµæ ElasticSearch å¾æ°æ®åº æ¶åºæ°æ®åº ä¼ é ðª",content:"> ð¾ db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼Github | Gitee\n>  * ð çµå­ä¹¦éè¯»ï¼Github Pages | Gitee Pages\n\n\n# æ°æ®åºç»¼å\n\n\n# åå¸å¼å­å¨åç\n\n# åå¸å¼çè®º\n\n * åå¸å¼çè®º\n * æ·±å¥åæå±è¯æ§ç®æ³ Paxos\n * æ·±å¥åæå±è¯æ§ç®æ³ Raft\n * åå¸å¼ç®æ³ Gossip\n\n# åå¸å¼å³é®ææ¯\n\n# æµéè°åº¦\n\n * æµéæ§å¶\n * æ·±å¥æµåºè´è½½åè¡¡\n * æå¡è·¯ç±\n * åå¸å¼ä¼è¯åºæ¬åç\n\n# æ°æ®è°åº¦\n\n * ç¼å­åºæ¬åç\n * è¯»ååç¦»åºæ¬åç\n * ååºåè¡¨åºæ¬åç\n * åå¸å¼ ID åºæ¬åç\n * åå¸å¼äºå¡åºæ¬åç\n * åå¸å¼éåºæ¬åç\n\n\n# å¶ä»\n\n * Nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# æ°æ®åºä¸­é´ä»¶\n\n * ShardingSphere ç®ä»\n * ShardingSphere Jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ Flyway\n\n\n# å³ç³»åæ°æ®åº\n\n> å³ç³»åæ°æ®åº æ´çä¸»æµå³ç³»åæ°æ®åºç¥è¯ç¹ã\n\n\n# å¬å±ç¥è¯\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * SQL Cheat Sheet æ¯ä¸ä¸ª SQL å¥é¨æç¨ã\n * æ©å± SQL æ¯ä¸ä¸ª SQL å¥é¨æç¨ã\n\n\n# Mysql\n\n\n\n * Mysql åºç¨æå â¡\n * Mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * Mysql äºå¡ - å³é®è¯ï¼ACIDãAUTOCOMMITãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * Mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãMVCCãNext-key é\n * Mysql ç´¢å¼ - å³é®è¯ï¼HashãB æ ãèç°ç´¢å¼ãåè¡¨\n * Mysql æ§è½ä¼å\n * Mysql è¿ç»´ ð¨\n * Mysql éç½® ð¨\n * Mysql é®é¢\n\n\n# å¶ä»\n\n * PostgreSQL åºç¨æå\n * H2 åºç¨æå\n * SqLite åºç¨æå\n\n\n# ææ¡£æ°æ®åº\n\n\n# MongoDB\n\n> MongoDB æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± C++ è¯­è¨ç¼åãæ¨å¨ä¸º WEB åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> MongoDB æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> MongoDB æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n * MongoDB åºç¨æå\n * MongoDB ç CRUD æä½\n * MongoDB èåæä½\n * MongoDB äºå¡\n * MongoDB å»ºæ¨¡\n * MongoDB å»ºæ¨¡ç¤ºä¾\n * MongoDB ç´¢å¼\n * MongoDB å¤å¶\n * MongoDB åç\n * MongoDB è¿ç»´\n\n\n# KV æ°æ®åº\n\n\n# Redis\n\n\n\n * Redis é¢è¯æ»ç» ð¯\n * Redis åºç¨æå â¡ - å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n * Redis æ°æ®ç±»åååºç¨ - å³é®è¯ï¼STRINGãHASHãLISTãSETãZSETãBitMapãHyperLogLogãGeo\n * Redis æä¹å - å³é®è¯ï¼RDBãAOFãSAVEãBGSAVEãappendfsync\n * Redis å¤å¶ - å³é®è¯ï¼SLAVEOFãSYNCãPSYNCãREPLCONF ACK\n * Redis å¨åµ - å³é®è¯ï¼SentinelãPINGãINFOãRaft\n * Redis éç¾¤ - å³é®è¯ï¼CLUSTER MEETãHash slotãMOVEDãASKãSLAVEOF no oneãredis-trib\n * Redis å®æ - å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n * Redis è¿ç»´ ð¨ - å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# åå¼æ°æ®åº\n\n\n# HBase\n\n> HBase ð å ä¸ºå¸¸ç¨äºå¤§æ°æ®é¡¹ç®ï¼æä»¥å°å¶ææ¡£åæºç æ´çå¨ bigdata-tutorial é¡¹ç®ä¸­ã\n\n * HBase åç â¡\n * HBase å½ä»¤\n * HBase åºç¨\n * HBase è¿ç»´\n\n\n# æç´¢å¼ææ°æ®åº\n\n\n# Elasticsearch\n\n> Elasticsearch æ¯ä¸ä¸ªåºäº Lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãElasticsearch æ¯éµä» Apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n * Elasticsearch é¢è¯æ»ç» ð¯\n * Elasticsearch å¿«éå¥é¨\n * Elasticsearch ç®ä»\n * Elasticsearch ç´¢å¼\n * Elasticsearch æ¥è¯¢\n * Elasticsearch é«äº®\n * Elasticsearch æåº\n * Elasticsearch èå\n * Elasticsearch åæå¨\n * Elasticsearch æ§è½ä¼å\n * Elasticsearch Rest API\n * ElasticSearch Java API ä¹ High Level REST Client\n * Elasticsearch éç¾¤ååç\n * Elasticsearch è¿ç»´\n\n\n# Elastic\n\n * Elastic å¿«éå¥é¨\n * Elastic ææ¯æ ä¹ Filebeat\n * Filebeat è¿ç»´\n * Elastic ææ¯æ ä¹ Kibana\n * Kibana è¿ç»´\n * Elastic ææ¯æ ä¹ Logstash\n * Logstash è¿ç»´\n\n\n# èµæ ð\n\n\n# æ°æ®åºç»¼åèµæ\n\n * DB-Engines - æ°æ®åºæµè¡åº¦æå\n * ä¹¦ç±\n   * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã - è¿å¯è½æ¯ç®åæå¥½çåå¸å¼å­å¨ä¹¦ç±ï¼å¼ºåæ¨èãè¿é¶ã\n * æç¨\n   * CMU 15445 æ°æ®åºåºç¡è¯¾ç¨\n   * CMU 15721 æ°æ®åºé«çº§è¯¾ç¨\n   * æ£ç´¢ææ¯æ ¸å¿ 20 è®² - æå®¢æç¨ãè¿é¶ã\n   * åç«¯å­å¨å®æè¯¾ - æå®¢æç¨ãå¥é¨ãï¼è®²è§£å­å¨å¨çµåé¢åçç§ç§åºç¨åä¸äºåºæ¬ç¹æ§\n * è®ºæ\n   * Efficiency in the Columbia Database Query Optimizer\n   * How Good Are Query Optimizers, Really?\n   * Architecture of a Database System\n   * Data Structures for Databases\n * æç« \n   * Data Structures and Algorithms for Big Databases\n\n\n# å³ç³»åæ°æ®åºèµæ\n\n * ç»¼åèµæ\n   * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n   * ãSQL å¿ç¥å¿ä¼ã - SQL çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * Oracle èµæ\n   * ãOracle Database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n# Mysql èµæ\n\n * å®æ¹\n   * Mysql å®ç½\n   * Mysql å®æ¹ææ¡£\n   * å®æ¹ PPT\n     * How to Analyze and Tune MySQL Queries for Better Performance\n     * MySQL Performance Tuning 101\n     * MySQL Performance Schema & Sys Schema\n     * MySQL Performance: Demystified Tuning & Best Practices\n     * MySQL Security Best Practices\n     * MySQL Cluster Deployment Best Practices\n     * MySQL High Availability with InnoDB Cluster\n * ä¹¦ç±\n   * ãé«æ§è½ MySQLã - ç»å¸ï¼éå DBA æä½ä¸ºå¼åèçåèæåãè¿é¶ã\n   * ãMySQL ææ¯åå¹ï¼InnoDB å­å¨å¼æã\n   * ãMySQL å¿ç¥å¿ä¼ã - Mysql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * æç¨\n   * runoob.com MySQL æç¨ - å¥é¨çº§ SQL æç¨\n   * mysql-tutorial\n * æç« \n   * MySQL ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n   * Some study on database storage internals\n   * Sharding Pinterest: How we scaled our MySQL fleet\n   * Guide to MySQL High Availability\n   * Choosing MySQL High Availability Solutions\n   * High availability with MariaDB TX: The definitive guide\n   * Mysql ç¸å³ç»éª\n     * Booking.com: Evolution of MySQL System Design ï¼Booking.com ç MySQL æ°æ®åºä½¿ç¨çæ¼åï¼å¶ä¸­æå¾å¤ä¸éçç»éªåäº«ï¼æç¸ä¿¡ä¹æ¯å¾å¤å¬å¸ä¼éå°ççé®é¢ã\n     * Tracking the Moneyâ-âScaling Financial Reporting at Airbnb ï¼Airbnb çæ°æ®åºæ©å±çç»éªåäº«ã\n     * Why Uber Engineering Switched from Postgres to MySQL ï¼æ ææ¯è¾ä¸¤ä¸ªæ°æ®åºè°å¥½è°ä¸å¥½ï¼æ¨èè¿ç¯ Uber çé¿æï¼ä¸»è¦æ¯æ³è®©ä½ ä»ä¸­å­¦ä¹ å°ä¸äºç»éªåææ¯ç»èï¼è¿æ¯ä¸ç¯å¾ä¸éçæç« ã\n   * Mysql éç¾¤å¤å¶\n     * Monitoring Delayed Replication, With A Focus On MySQL\n     * Mitigating replication lag and reducing read load with freno\n     * Better Parallel Replication for MySQL\n     * Evaluating MySQL Parallel Replication Part 2: Slave Group Commit\n     * Evaluating MySQL Parallel Replication Part 3: Benchmarks in Production\n     * Evaluating MySQL Parallel Replication Part 4: More Benchmarks in Production\n     * Evaluating MySQL Parallel Replication Part 4, Annex: Under the Hood\n   * Mysql æ°æ®ååº\n     * StackOverflow: MySQL sharding approaches?\n     * Why you donât want to shard\n     * [How to Scale Big Data Applications](https://www.percona.com/sites/default/files/presentations/How to Scale Big Data Applications.pdf)\n     * MySQL Sharding with ProxySQL\n   * åå¬å¸ç Mysql æ°æ®ååºç»éªåäº«\n     * MailChimp: Using Shards to Accommodate Millions of Users\n     * Uber: Code Migration in Production: Rewriting the Sharding Layer of Uberâs Schemaless Datastore\n     * Sharding & IDs at Instagram\n     * Airbnb: How We Partitioned Airbnbâs Main Database in Two Weeks\n * æ´å¤èµæº\n   * awesome-mysql - MySQL çèµæºåè¡¨\n\n\n# Nosql æ°æ®åºç»¼å\n\n * Martin Fowler å¨ YouTube ä¸åäº«ç NoSQL ä»ç» Introduction To NoSQLï¼ ä»¥åä»åä¸ç¼åç NoSQL Distilled - NoSQL ç²¾ç²¹ï¼è¿æ¬ä¹¦æ 100 å¤é¡µï¼æ¯æ¬é¾å¾çå³äº NoSQL çä¹¦ï¼å¾ä¸éï¼éå¸¸æè¯»ã\n * NoSQL Databases: a Survey and Decision Guidanceï¼è¿ç¯æç« å¯ä»¥å¸¦ä½ èªä¸èä¸å°ä» CAP åçå°å¼å§äºè§£ NoSQL çç§ç§ææ¯ï¼æ¯ä¸ç¯éå¸¸ä¸éçæç« ã\n * Distribution, Data, Deployment: Software Architecture Convergence in Big Data Systemsï¼è¿æ¯å¡ååºÂ·æ¢éå¤§å­¦çä¸ç¯è®²åå¸å¼å¤§æ°æ®ç³»ç»çè®ºæãå¶ä¸­ä¸»è¦è®¨è®ºäºå¨å¤§æ°æ®æ¶ä»£ä¸çè½¯ä»¶å·¥ç¨ä¸­çä¸äºå³é®ç¹ï¼ä¹è¯´å°äº NoSQL æ°æ®åºã\n * No Relation: The Mixed Blessings of Non-Relational Databasesï¼è¿ç¯è®ºæè½ç¶æç¹å¹´ä»£ä¹è¿ãä½è¿ç¯è®ºææ¯ HBase çåºç¡ï¼ä½ è±ä¸ä¸ç¹æ¶é´æ¥è¯»è¯»ï¼å°±å¯ä»¥äºè§£å°ï¼å¯¹åç§éå³ç³»åæ°æ®å­å¨ä¼ç¼ºç¹çä¸ä¸ªå¾å¥½çæ¯è¾ã\n * NoSQL Data Modeling Techniques ï¼NoSQL å»ºæ¨¡ææ¯ãè¿ç¯æç« ææ¾ç»ç¿»è¯å¨äº CoolShell ä¸ï¼æ é¢ä¸º NoSQL æ°æ®å»ºæ¨¡ææ¯ï¼ä¾ä½ åèã\n   * MongoDB - Data Modeling Introduction ï¼è½ç¶è¿æ¯ MongoDB çæ°æ®å»ºæ¨¡ä»ç»ï¼ä½æ¯å¶å¾å¤è§ç¹å¯ä»¥ç¨äºå¶å®ç NoSQL æ°æ®åºã\n   * Firebase - Structure Your Database ï¼Google ç Firebase æ°æ®åºä½¿ç¨ JSON å»ºæ¨¡çä¸äºæä½³å®è·µã\n * å ä¸º CAP åçï¼æä»¥å½ä½ éè¦éæ©ä¸ä¸ª NoSQL æ°æ®åºçæ¶åï¼ä½ åºè¯¥ççè¿ç¯ææ¡£ Visual Guide to NoSQL Systemsã\n\né SQL è¿æ¯ NoSQLï¼è¿éæä¸¤ç¯æç« ï¼å¼å¾ä½ ççã\n\n * SQL vs. NoSQL Databases: Whatâs the Difference?\n * Salesforce: SQL or NoSQL\n\n\n# åå¼æ°æ®åºèµæ\n\n# Cassandra èµæ\n\n * æ²å°çå®éªå®¤æä¸¤ç¯æç« å¼å¾ä¸è¯»ã\n   * Avoid Pitfalls in Scaling Cassandra Cluster at Walmart\n   * Storing Images in Cassandra at Walmart\n * Yelp: How We Scaled Our Ad Analytics with Apache Cassandra ï¼Yelp çè¿ç¯åå®¢ä¹æä¸äºç¸å³çç»éªåæè®­ã\n * Discord: How Discord Stores Billions of Messages ï¼Discord å¬å¸åäº«çä¸ä¸ªå¦ä½å­å¨åäº¿çº§æ¶æ¯çææ¯æç« ã\n * Cassandra at Instagram ï¼Instagram çä¸ä¸ª PPTï¼å¶ä¸­ä»ç»äº Instagram ä¸­æ¯æä¹ä½¿ç¨ Cassandra çã\n * Netflix: Benchmarking Cassandra Scalability on AWSâ-âOver a million writes per second ï¼Netflix å¬å¸å¨ AWS ä¸ç» Cassandra åçä¸ä¸ª Benchmarkã\n\n# HBase èµæ\n\n * Imgur Notification: From MySQL to HBASE\n * Pinterest: Improving HBase Backup Efficiency\n * IBM : Tuning HBase performance\n * HBase File Locality in HDFS\n * Apache Hadoop Goes Realtime at Facebook\n * Storage Infrastructure Behind Facebook Messages: Using HBase at Scale\n * GitHub: Awesome HBase\n\néå¯¹äº HBase æä¸¤æ¬ä¹¦ä½ å¯ä»¥èèä¸ä¸ã\n\n * é¦åï¼åæ¨èä¸¤æ¬ä¹¦ï¼ä¸æ¬æ¯åå®è·µçãHBase å®æãï¼å¦ä¸æ¬æ¯åå¤§èå¨çæååçãHBase æå¨æåãã\n * å½ç¶ï¼ä½ ä¹å¯ä»¥ççå®æ¹ç The Apache HBaseâ¢ Reference Guide\n * å¦å¤ä¸¤ä¸ªåæ°æ®åºï¼\n   * ClickHouse - Open Source Distributed Column Database at Yandex\n   * Scaling Redshift without Scaling Costs at GIPHY\n\n\n# KV æ°æ®åºèµæ\n\n# Redis èµæ\n\n * å®ç½\n   * Redis å®ç½\n   * Redis github\n   * Redis å®æ¹ææ¡£ä¸­æç\n   * Redis å½ä»¤åè\n * ä¹¦ç±\n   * ãRedis å®æã\n   * ãRedis è®¾è®¡ä¸å®ç°ã\n * æºç \n   * ãRedis å®æãéå¥ Python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * Redis Client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * CRUG | Redisson PRO vs. Jedis: Which Is Faster? ç¿»è¯\n   * redis åå¸é Redisson æ§è½æµè¯\n * æç« \n   * Learn Redis the hard way (in production) at Trivago\n   * Twitter: How Twitter Uses Redis To Scale - 105TB RAM, 39MM QPS, 10,000+ Instances\n   * Slack: Scaling Slackâs Job Queue - Robustly Handling Billions of Tasks in Milliseconds Using Kafka and Redis\n   * GitHub: Moving persistent data out of Redis at GitHub\n   * Instagram: Storing Hundreds of Millions of Simple Key-Value Pairs in Redis\n   * Redis in Chat Architecture of Twitch (from 27:22)\n   * Deliveroo: Optimizing Session Key Storage in Redis\n   * Deliveroo: Optimizing Redis Storage\n   * GitHub: Awesome Redis\n\n\n# ææ¡£æ°æ®åºèµæ\n\n * Couchbase Ecosystem at LinkedIn\n * SimpleDB at Zendesk\n * Data Points - What the Heck Are Document Databases?\n\n# MongoDB èµæ\n\n * å®æ¹\n   * MongoDB å®ç½\n   * MongoDB Github\n   * MongoDB å®æ¹åè´¹æç¨\n * æç¨\n   * MongoDB æç¨\n   * MongoDB é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * Introduction to MongoDB\n * eBay: Building Mission-Critical Multi-Data Center Applications with MongoDB\n * The AWS and MongoDB Infrastructure of Parse: Lessons Learned\n * Migrating Mountains of Mongo Data\n * æ´å¤èµæº\n * Github: Awesome MongoDB\n\n\n# æç´¢å¼ææ°æ®åºèµæ\n\n# ElasticSearch\n\n * å®æ¹\n   * Elasticsearch å®ç½\n   * Elasticsearch Github\n   * Elasticsearch å®æ¹ææ¡£\n   * Elasticsearch: The Definitive Guide - ElasticSearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãElasticsearch å®æã\n * æç¨\n   * ELK Stack æå¨æå\n   * Elasticsearch æç¨\n * æç« \n   * Elasticsearch+Logstash+Kibana æç¨\n   * ELKï¼ElasticsearchãLogstashãKibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n   * Elasticsearch Performance Tuning Practice at eBay\n   * Elasticsearch at Kickstarter\n   * 9 tips on ElasticSearch configuration for high performance\n   * Elasticsearch In Productionâ-âDeployment Best Practices\n * æ´å¤èµæº\n   * GitHub: Awesome ElasticSearch\n\n\n# å¾æ°æ®åº\n\n * é¦åæ¯ IBM Devloperworks ä¸çä¸¤ä¸ªç®ä»æ§ç PPTã\n   * Intro to graph databases, Part 1, Graph databases and the CRUD operations\n   * Intro to graph databases, Part 2, Building a recommendation engine with a graph database\n * ç¶åæ¯ä¸æ¬åè´¹ççµå­ä¹¦ãGraph Databaseãã\n * æ¥ä¸æ¥æ¯ä¸äºå¾æ°æ®åºçä»ç»æç« ã\n   * Handling Billions of Edges in a Graph Database\n   * Neo4j case studies with Walmart, eBay, AirBnB, NASA, etc\n   * FlockDB: Distributed Graph Database for Storing Adjacency Lists at Twitter\n   * JanusGraph: Scalable Graph Database backed by Google, IBM and Hortonworks\n   * Amazon Neptune\n\n\n# æ¶åºæ°æ®åº\n\n * What is Time-Series Data & Why We Need a Time-Series Database\n * Time Series Data: Why and How to Use a Relational Database instead of NoSQL\n * Beringei: High-performance Time Series Storage Engine @Facebook\n * Introducing Atlas: Netflixâs Primary Telemetry Platform @Netflix\n * Building a Scalable Time Series Database on PostgreSQL\n * Scaling Time Series Data Storage - Part I @Netflix\n * Design of a Cost Efficient Time Series Store for Big Data\n * GitHub: Awesome Time-Series Database\n\n\n# ä¼ é ðª\n\nâ¾ ð  DB-TUTORIAL é¦é¡µ â¾ ð¯ æçåå®¢ â¾",normalizedContent:"> ð¾ db-tutorial æ¯ä¸ä¸ªæ°æ®åºæç¨ã\n> \n>  * ð é¡¹ç®åæ­¥ç»´æ¤ï¼github | gitee\n>  * ð çµå­ä¹¦éè¯»ï¼github pages | gitee pages\n\n\n# æ°æ®åºç»¼å\n\n\n# åå¸å¼å­å¨åç\n\n# åå¸å¼çè®º\n\n * åå¸å¼çè®º\n * æ·±å¥åæå±è¯æ§ç®æ³ paxos\n * æ·±å¥åæå±è¯æ§ç®æ³ raft\n * åå¸å¼ç®æ³ gossip\n\n# åå¸å¼å³é®ææ¯\n\n# æµéè°åº¦\n\n * æµéæ§å¶\n * æ·±å¥æµåºè´è½½åè¡¡\n * æå¡è·¯ç±\n * åå¸å¼ä¼è¯åºæ¬åç\n\n# æ°æ®è°åº¦\n\n * ç¼å­åºæ¬åç\n * è¯»ååç¦»åºæ¬åç\n * ååºåè¡¨åºæ¬åç\n * åå¸å¼ id åºæ¬åç\n * åå¸å¼äºå¡åºæ¬åç\n * åå¸å¼éåºæ¬åç\n\n\n# å¶ä»\n\n * nosql ææ¯éå\n * æ°æ®ç»æä¸æ°æ®åºç´¢å¼\n\n\n# æ°æ®åºä¸­é´ä»¶\n\n * shardingsphere ç®ä»\n * shardingsphere jdbc\n * çæ¬ç®¡çä¸­é´ä»¶ flyway\n\n\n# å³ç³»åæ°æ®åº\n\n> å³ç³»åæ°æ®åº æ´çä¸»æµå³ç³»åæ°æ®åºç¥è¯ç¹ã\n\n\n# å¬å±ç¥è¯\n\n * å³ç³»åæ°æ®åºé¢è¯æ»ç» ð¯\n * sql cheat sheet æ¯ä¸ä¸ª sql å¥é¨æç¨ã\n * æ©å± sql æ¯ä¸ä¸ª sql å¥é¨æç¨ã\n\n\n# mysql\n\n\n\n * mysql åºç¨æå â¡\n * mysql å·¥ä½æµ - å³é®è¯ï¼è¿æ¥ãç¼å­ãè¯­æ³åæãä¼åãæ§è¡å¼æãredo logãbin logãä¸¤é¶æ®µæäº¤\n * mysql äºå¡ - å³é®è¯ï¼acidãautocommitãäºå¡éç¦»çº§å«ãæ­»éãåå¸å¼äºå¡\n * mysql é - å³é®è¯ï¼ä¹è§éãè¡¨çº§éãè¡çº§éãæåéãmvccãnext-key é\n * mysql ç´¢å¼ - å³é®è¯ï¼hashãb æ ãèç°ç´¢å¼ãåè¡¨\n * mysql æ§è½ä¼å\n * mysql è¿ç»´ ð¨\n * mysql éç½® ð¨\n * mysql é®é¢\n\n\n# å¶ä»\n\n * postgresql åºç¨æå\n * h2 åºç¨æå\n * sqlite åºç¨æå\n\n\n# ææ¡£æ°æ®åº\n\n\n# mongodb\n\n> mongodb æ¯ä¸ä¸ªåºäºææ¡£çåå¸å¼æ°æ®åºï¼ç± c++ è¯­è¨ç¼åãæ¨å¨ä¸º web åºç¨æä¾å¯æ©å±çé«æ§è½æ°æ®å­å¨è§£å³æ¹æ¡ã\n> \n> mongodb æ¯ä¸ä¸ªä»äºå³ç³»åæ°æ®åºåéå³ç³»åæ°æ®åºä¹é´çäº§åãå®æ¯éå³ç³»æ°æ®åºå½ä¸­åè½æä¸°å¯ï¼æåå³ç³»æ°æ®åºçãå®æ¯æçæ°æ®ç»æéå¸¸æ¾æ£ï¼æ¯ç±»ä¼¼ json ç bson æ ¼å¼ï¼å æ­¤å¯ä»¥å­å¨æ¯è¾å¤æçæ°æ®ç±»åã\n> \n> mongodb æå¤§çç¹ç¹æ¯å®æ¯æçæ¥è¯¢è¯­è¨éå¸¸å¼ºå¤§ï¼å¶è¯­æ³æç¹ç±»ä¼¼äºé¢åå¯¹è±¡çæ¥è¯¢è¯­è¨ï¼å ä¹å¯ä»¥å®ç°ç±»ä¼¼å³ç³»æ°æ®åºåè¡¨æ¥è¯¢çç»å¤§é¨ååè½ï¼èä¸è¿æ¯æå¯¹æ°æ®å»ºç«ç´¢å¼ã\n\n * mongodb åºç¨æå\n * mongodb ç crud æä½\n * mongodb èåæä½\n * mongodb äºå¡\n * mongodb å»ºæ¨¡\n * mongodb å»ºæ¨¡ç¤ºä¾\n * mongodb ç´¢å¼\n * mongodb å¤å¶\n * mongodb åç\n * mongodb è¿ç»´\n\n\n# kv æ°æ®åº\n\n\n# redis\n\n\n\n * redis é¢è¯æ»ç» ð¯\n * redis åºç¨æå â¡ - å³é®è¯ï¼åå­æ·æ±°ãäºä»¶ãäºå¡ãç®¡éãåå¸ä¸è®¢é\n * redis æ°æ®ç±»åååºç¨ - å³é®è¯ï¼stringãhashãlistãsetãzsetãbitmapãhyperloglogãgeo\n * redis æä¹å - å³é®è¯ï¼rdbãaofãsaveãbgsaveãappendfsync\n * redis å¤å¶ - å³é®è¯ï¼slaveofãsyncãpsyncãreplconf ack\n * redis å¨åµ - å³é®è¯ï¼sentinelãpingãinfoãraft\n * redis éç¾¤ - å³é®è¯ï¼cluster meetãhash slotãmovedãaskãslaveof no oneãredis-trib\n * redis å®æ - å³é®è¯ï¼ç¼å­ãåå¸å¼éãå¸éè¿æ»¤å¨\n * redis è¿ç»´ ð¨ - å³é®è¯ï¼å®è£ãå½ä»¤ãéç¾¤ãå®¢æ·ç«¯\n\n\n# åå¼æ°æ®åº\n\n\n# hbase\n\n> hbase ð å ä¸ºå¸¸ç¨äºå¤§æ°æ®é¡¹ç®ï¼æä»¥å°å¶ææ¡£åæºç æ´çå¨ bigdata-tutorial é¡¹ç®ä¸­ã\n\n * hbase åç â¡\n * hbase å½ä»¤\n * hbase åºç¨\n * hbase è¿ç»´\n\n\n# æç´¢å¼ææ°æ®åº\n\n\n# elasticsearch\n\n> elasticsearch æ¯ä¸ä¸ªåºäº lucene çæç´¢åæ°æ®åæå·¥å·ï¼å®æä¾äºä¸ä¸ªåå¸å¼æå¡ãelasticsearch æ¯éµä» apache å¼æºæ¡æ¬¾çä¸æ¬¾å¼æºäº§åï¼æ¯å½åä¸»æµçä¼ä¸çº§æç´¢å¼æã\n\n * elasticsearch é¢è¯æ»ç» ð¯\n * elasticsearch å¿«éå¥é¨\n * elasticsearch ç®ä»\n * elasticsearch ç´¢å¼\n * elasticsearch æ¥è¯¢\n * elasticsearch é«äº®\n * elasticsearch æåº\n * elasticsearch èå\n * elasticsearch åæå¨\n * elasticsearch æ§è½ä¼å\n * elasticsearch rest api\n * elasticsearch java api ä¹ high level rest client\n * elasticsearch éç¾¤ååç\n * elasticsearch è¿ç»´\n\n\n# elastic\n\n * elastic å¿«éå¥é¨\n * elastic ææ¯æ ä¹ filebeat\n * filebeat è¿ç»´\n * elastic ææ¯æ ä¹ kibana\n * kibana è¿ç»´\n * elastic ææ¯æ ä¹ logstash\n * logstash è¿ç»´\n\n\n# èµæ ð\n\n\n# æ°æ®åºç»¼åèµæ\n\n * db-engines - æ°æ®åºæµè¡åº¦æå\n * ä¹¦ç±\n   * ãæ°æ®å¯éååºç¨ç³»ç»è®¾è®¡ã - è¿å¯è½æ¯ç®åæå¥½çåå¸å¼å­å¨ä¹¦ç±ï¼å¼ºåæ¨èãè¿é¶ã\n * æç¨\n   * cmu 15445 æ°æ®åºåºç¡è¯¾ç¨\n   * cmu 15721 æ°æ®åºé«çº§è¯¾ç¨\n   * æ£ç´¢ææ¯æ ¸å¿ 20 è®² - æå®¢æç¨ãè¿é¶ã\n   * åç«¯å­å¨å®æè¯¾ - æå®¢æç¨ãå¥é¨ãï¼è®²è§£å­å¨å¨çµåé¢åçç§ç§åºç¨åä¸äºåºæ¬ç¹æ§\n * è®ºæ\n   * efficiency in the columbia database query optimizer\n   * how good are query optimizers, really?\n   * architecture of a database system\n   * data structures for databases\n * æç« \n   * data structures and algorithms for big databases\n\n\n# å³ç³»åæ°æ®åºèµæ\n\n * ç»¼åèµæ\n   * ãæ°æ®åºçç´¢å¼è®¾è®¡ä¸ä¼åã\n   * ãsql å¿ç¥å¿ä¼ã - sql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * oracle èµæ\n   * ãoracle database 9i/10g/11g ç¼ç¨èºæ¯ã\n\n# mysql èµæ\n\n * å®æ¹\n   * mysql å®ç½\n   * mysql å®æ¹ææ¡£\n   * å®æ¹ ppt\n     * how to analyze and tune mysql queries for better performance\n     * mysql performance tuning 101\n     * mysql performance schema & sys schema\n     * mysql performance: demystified tuning & best practices\n     * mysql security best practices\n     * mysql cluster deployment best practices\n     * mysql high availability with innodb cluster\n * ä¹¦ç±\n   * ãé«æ§è½ mysqlã - ç»å¸ï¼éå dba æä½ä¸ºå¼åèçåèæåãè¿é¶ã\n   * ãmysql ææ¯åå¹ï¼innodb å­å¨å¼æã\n   * ãmysql å¿ç¥å¿ä¼ã - mysql çåºæ¬æ¦å¿µåè¯­æ³ãå¥é¨ã\n * æç¨\n   * runoob.com mysql æç¨ - å¥é¨çº§ sql æç¨\n   * mysql-tutorial\n * æç« \n   * mysql ç´¢å¼èåçæ°æ®ç»æåç®æ³åç\n   * some study on database storage internals\n   * sharding pinterest: how we scaled our mysql fleet\n   * guide to mysql high availability\n   * choosing mysql high availability solutions\n   * high availability with mariadb tx: the definitive guide\n   * mysql ç¸å³ç»éª\n     * booking.com: evolution of mysql system design ï¼booking.com ç mysql æ°æ®åºä½¿ç¨çæ¼åï¼å¶ä¸­æå¾å¤ä¸éçç»éªåäº«ï¼æç¸ä¿¡ä¹æ¯å¾å¤å¬å¸ä¼éå°ççé®é¢ã\n     * tracking the moneyâ-âscaling financial reporting at airbnb ï¼airbnb çæ°æ®åºæ©å±çç»éªåäº«ã\n     * why uber engineering switched from postgres to mysql ï¼æ ææ¯è¾ä¸¤ä¸ªæ°æ®åºè°å¥½è°ä¸å¥½ï¼æ¨èè¿ç¯ uber çé¿æï¼ä¸»è¦æ¯æ³è®©ä½ ä»ä¸­å­¦ä¹ å°ä¸äºç»éªåææ¯ç»èï¼è¿æ¯ä¸ç¯å¾ä¸éçæç« ã\n   * mysql éç¾¤å¤å¶\n     * monitoring delayed replication, with a focus on mysql\n     * mitigating replication lag and reducing read load with freno\n     * better parallel replication for mysql\n     * evaluating mysql parallel replication part 2: slave group commit\n     * evaluating mysql parallel replication part 3: benchmarks in production\n     * evaluating mysql parallel replication part 4: more benchmarks in production\n     * evaluating mysql parallel replication part 4, annex: under the hood\n   * mysql æ°æ®ååº\n     * stackoverflow: mysql sharding approaches?\n     * why you donât want to shard\n     * [how to scale big data applications](https://www.percona.com/sites/default/files/presentations/how to scale big data applications.pdf)\n     * mysql sharding with proxysql\n   * åå¬å¸ç mysql æ°æ®ååºç»éªåäº«\n     * mailchimp: using shards to accommodate millions of users\n     * uber: code migration in production: rewriting the sharding layer of uberâs schemaless datastore\n     * sharding & ids at instagram\n     * airbnb: how we partitioned airbnbâs main database in two weeks\n * æ´å¤èµæº\n   * awesome-mysql - mysql çèµæºåè¡¨\n\n\n# nosql æ°æ®åºç»¼å\n\n * martin fowler å¨ youtube ä¸åäº«ç nosql ä»ç» introduction to nosqlï¼ ä»¥åä»åä¸ç¼åç nosql distilled - nosql ç²¾ç²¹ï¼è¿æ¬ä¹¦æ 100 å¤é¡µï¼æ¯æ¬é¾å¾çå³äº nosql çä¹¦ï¼å¾ä¸éï¼éå¸¸æè¯»ã\n * nosql databases: a survey and decision guidanceï¼è¿ç¯æç« å¯ä»¥å¸¦ä½ èªä¸èä¸å°ä» cap åçå°å¼å§äºè§£ nosql çç§ç§ææ¯ï¼æ¯ä¸ç¯éå¸¸ä¸éçæç« ã\n * distribution, data, deployment: software architecture convergence in big data systemsï¼è¿æ¯å¡ååºÂ·æ¢éå¤§å­¦çä¸ç¯è®²åå¸å¼å¤§æ°æ®ç³»ç»çè®ºæãå¶ä¸­ä¸»è¦è®¨è®ºäºå¨å¤§æ°æ®æ¶ä»£ä¸çè½¯ä»¶å·¥ç¨ä¸­çä¸äºå³é®ç¹ï¼ä¹è¯´å°äº nosql æ°æ®åºã\n * no relation: the mixed blessings of non-relational databasesï¼è¿ç¯è®ºæè½ç¶æç¹å¹´ä»£ä¹è¿ãä½è¿ç¯è®ºææ¯ hbase çåºç¡ï¼ä½ è±ä¸ä¸ç¹æ¶é´æ¥è¯»è¯»ï¼å°±å¯ä»¥äºè§£å°ï¼å¯¹åç§éå³ç³»åæ°æ®å­å¨ä¼ç¼ºç¹çä¸ä¸ªå¾å¥½çæ¯è¾ã\n * nosql data modeling techniques ï¼nosql å»ºæ¨¡ææ¯ãè¿ç¯æç« ææ¾ç»ç¿»è¯å¨äº coolshell ä¸ï¼æ é¢ä¸º nosql æ°æ®å»ºæ¨¡ææ¯ï¼ä¾ä½ åèã\n   * mongodb - data modeling introduction ï¼è½ç¶è¿æ¯ mongodb çæ°æ®å»ºæ¨¡ä»ç»ï¼ä½æ¯å¶å¾å¤è§ç¹å¯ä»¥ç¨äºå¶å®ç nosql æ°æ®åºã\n   * firebase - structure your database ï¼google ç firebase æ°æ®åºä½¿ç¨ json å»ºæ¨¡çä¸äºæä½³å®è·µã\n * å ä¸º cap åçï¼æä»¥å½ä½ éè¦éæ©ä¸ä¸ª nosql æ°æ®åºçæ¶åï¼ä½ åºè¯¥ççè¿ç¯ææ¡£ visual guide to nosql systemsã\n\né sql è¿æ¯ nosqlï¼è¿éæä¸¤ç¯æç« ï¼å¼å¾ä½ ççã\n\n * sql vs. nosql databases: whatâs the difference?\n * salesforce: sql or nosql\n\n\n# åå¼æ°æ®åºèµæ\n\n# cassandra èµæ\n\n * æ²å°çå®éªå®¤æä¸¤ç¯æç« å¼å¾ä¸è¯»ã\n   * avoid pitfalls in scaling cassandra cluster at walmart\n   * storing images in cassandra at walmart\n * yelp: how we scaled our ad analytics with apache cassandra ï¼yelp çè¿ç¯åå®¢ä¹æä¸äºç¸å³çç»éªåæè®­ã\n * discord: how discord stores billions of messages ï¼discord å¬å¸åäº«çä¸ä¸ªå¦ä½å­å¨åäº¿çº§æ¶æ¯çææ¯æç« ã\n * cassandra at instagram ï¼instagram çä¸ä¸ª pptï¼å¶ä¸­ä»ç»äº instagram ä¸­æ¯æä¹ä½¿ç¨ cassandra çã\n * netflix: benchmarking cassandra scalability on awsâ-âover a million writes per second ï¼netflix å¬å¸å¨ aws ä¸ç» cassandra åçä¸ä¸ª benchmarkã\n\n# hbase èµæ\n\n * imgur notification: from mysql to hbase\n * pinterest: improving hbase backup efficiency\n * ibm : tuning hbase performance\n * hbase file locality in hdfs\n * apache hadoop goes realtime at facebook\n * storage infrastructure behind facebook messages: using hbase at scale\n * github: awesome hbase\n\néå¯¹äº hbase æä¸¤æ¬ä¹¦ä½ å¯ä»¥èèä¸ä¸ã\n\n * é¦åï¼åæ¨èä¸¤æ¬ä¹¦ï¼ä¸æ¬æ¯åå®è·µçãhbase å®æãï¼å¦ä¸æ¬æ¯åå¤§èå¨çæååçãhbase æå¨æåãã\n * å½ç¶ï¼ä½ ä¹å¯ä»¥ççå®æ¹ç the apache hbaseâ¢ reference guide\n * å¦å¤ä¸¤ä¸ªåæ°æ®åºï¼\n   * clickhouse - open source distributed column database at yandex\n   * scaling redshift without scaling costs at giphy\n\n\n# kv æ°æ®åºèµæ\n\n# redis èµæ\n\n * å®ç½\n   * redis å®ç½\n   * redis github\n   * redis å®æ¹ææ¡£ä¸­æç\n   * redis å½ä»¤åè\n * ä¹¦ç±\n   * ãredis å®æã\n   * ãredis è®¾è®¡ä¸å®ç°ã\n * æºç \n   * ãredis å®æãéå¥ python æºç \n * èµæºæ±æ»\n   * awesome-redis\n * redis client\n   * spring-data-redis å®æ¹ææ¡£\n   * redisson å®æ¹ææ¡£(ä¸­æ,ç¥ææ»å)\n   * redisson å®æ¹ææ¡£(è±æ)\n   * crug | redisson pro vs. jedis: which is faster? ç¿»è¯\n   * redis åå¸é redisson æ§è½æµè¯\n * æç« \n   * learn redis the hard way (in production) at trivago\n   * twitter: how twitter uses redis to scale - 105tb ram, 39mm qps, 10,000+ instances\n   * slack: scaling slackâs job queue - robustly handling billions of tasks in milliseconds using kafka and redis\n   * github: moving persistent data out of redis at github\n   * instagram: storing hundreds of millions of simple key-value pairs in redis\n   * redis in chat architecture of twitch (from 27:22)\n   * deliveroo: optimizing session key storage in redis\n   * deliveroo: optimizing redis storage\n   * github: awesome redis\n\n\n# ææ¡£æ°æ®åºèµæ\n\n * couchbase ecosystem at linkedin\n * simpledb at zendesk\n * data points - what the heck are document databases?\n\n# mongodb èµæ\n\n * å®æ¹\n   * mongodb å®ç½\n   * mongodb github\n   * mongodb å®æ¹åè´¹æç¨\n * æç¨\n   * mongodb æç¨\n   * mongodb é«æè¯¾\n * æ°æ®\n   * mongodb-json-files\n * æç« \n   * introduction to mongodb\n * ebay: building mission-critical multi-data center applications with mongodb\n * the aws and mongodb infrastructure of parse: lessons learned\n * migrating mountains of mongo data\n * æ´å¤èµæº\n * github: awesome mongodb\n\n\n# æç´¢å¼ææ°æ®åºèµæ\n\n# elasticsearch\n\n * å®æ¹\n   * elasticsearch å®ç½\n   * elasticsearch github\n   * elasticsearch å®æ¹ææ¡£\n   * elasticsearch: the definitive guide - elasticsearch å®æ¹å­¦ä¹ èµæ\n * ä¹¦ç±\n   * ãelasticsearch å®æã\n * æç¨\n   * elk stack æå¨æå\n   * elasticsearch æç¨\n * æç« \n   * elasticsearch+logstash+kibana æç¨\n   * elkï¼elasticsearchãlogstashãkibanaï¼å®è£åéç½®\n   * æ§è½è°ä¼ç¸å³çå·¥ç¨å®è·µ\n   * elasticsearch performance tuning practice at ebay\n   * elasticsearch at kickstarter\n   * 9 tips on elasticsearch configuration for high performance\n   * elasticsearch in productionâ-âdeployment best practices\n * æ´å¤èµæº\n   * github: awesome elasticsearch\n\n\n# å¾æ°æ®åº\n\n * é¦åæ¯ ibm devloperworks ä¸çä¸¤ä¸ªç®ä»æ§ç pptã\n   * intro to graph databases, part 1, graph databases and the crud operations\n   * intro to graph databases, part 2, building a recommendation engine with a graph database\n * ç¶åæ¯ä¸æ¬åè´¹ççµå­ä¹¦ãgraph databaseãã\n * æ¥ä¸æ¥æ¯ä¸äºå¾æ°æ®åºçä»ç»æç« ã\n   * handling billions of edges in a graph database\n   * neo4j case studies with walmart, ebay, airbnb, nasa, etc\n   * flockdb: distributed graph database for storing adjacency lists at twitter\n   * janusgraph: scalable graph database backed by google, ibm and hortonworks\n   * amazon neptune\n\n\n# æ¶åºæ°æ®åº\n\n * what is time-series data & why we need a time-series database\n * time series data: why and how to use a relational database instead of nosql\n * beringei: high-performance time series storage engine @facebook\n * introducing atlas: netflixâs primary telemetry platform @netflix\n * building a scalable time series database on postgresql\n * scaling time series data storage - part i @netflix\n * design of a cost efficient time series store for big data\n * github: awesome time-series database\n\n\n# ä¼ é ðª\n\nâ¾ ð  db-tutorial é¦é¡µ â¾ ð¯ æçåå®¢ â¾",charsets:{cjk:!0},lastUpdated:"2022/05/26, 20:28:39",lastUpdatedTimestamp:1653568119e3}],themeConfig:{nav:[{text:"æ°æ®åºç»¼å",link:"/01.æ°æ®åºç»¼å/"},{text:"æ°æ®åºä¸­é´ä»¶",link:"/02.æ°æ®åºä¸­é´ä»¶/"},{text:"å³ç³»åæ°æ®åº",link:"/03.å³ç³»åæ°æ®åº/",items:[{text:"ç»¼å",link:"/03.å³ç³»åæ°æ®åº/01.ç»¼å/"},{text:"Mysql",link:"/03.å³ç³»åæ°æ®åº/02.Mysql/"},{text:"å¶ä»",link:"/03.å³ç³»åæ°æ®åº/99.å¶ä»/"}]},{text:"ææ¡£æ°æ®åº",items:[{text:"MongoDB",link:"/04.ææ¡£æ°æ®åº/01.MongoDB/"}]},{text:"KVæ°æ®åº",items:[{text:"Redis",link:"/05.KVæ°æ®åº/01.Redis/"}]},{text:"æç´¢å¼ææ°æ®åº",items:[{text:"Elasticsearch",link:"/07.æç´¢å¼ææ°æ®åº/01.Elasticsearch/"},{text:"Elasticææ¯æ ",link:"/07.æç´¢å¼ææ°æ®åº/02.Elastic/"}]}],sidebarDepth:2,logo:"https://raw.githubusercontent.com/dunwu/images/dev/common/dunwu-logo.png",repo:"dunwu/db-tutorial",searchMaxSuggestions:10,lastUpdated:"ä¸æ¬¡æ´æ°",docsDir:"docs",editLinks:!0,editLinkText:"ð å¸®å©æ¹åæ­¤é¡µé¢ï¼",sidebar:{"/01.æ°æ®åºç»¼å/":[["01.Nosqlææ¯éå.md","Nosqlææ¯éå","/pages/4a5e3f/"],["02.æ°æ®ç»æä¸æ°æ®åºç´¢å¼.md","æ°æ®ç»æä¸æ°æ®åºç´¢å¼","/pages/4702da/"]],catalogue:{},"/02.æ°æ®åºä¸­é´ä»¶/":[{title:"Shardingsphere",collapsable:!1,children:[["01.Shardingsphere/01.ShardingSphereç®ä».md","ShardingSphere ç®ä»","/pages/560051/"],["01.Shardingsphere/02.ShardingSphereJdbc.md","ShardingSphere Jdbc","/pages/a9584d/"]]},["02.Flyway.md","çæ¬ç®¡çä¸­é´ä»¶ Flyway","/pages/9f8daf/"]],"/03.å³ç³»åæ°æ®åº/":[{title:"ç»¼å",collapsable:!1,children:[["01.ç»¼å/01.å³ç³»åæ°æ®åºé¢è¯.md","å³ç³»åæ°æ®åºé¢è¯","/pages/c798e3/"],["01.ç»¼å/02.SqlCheatSheet.md","sql-cheat-sheet","/pages/f1c77c/"],["01.ç»¼å/03.æ©å±SQL.md","æ©å± SQL","/pages/0f3524/"]]},{title:"Mysql",collapsable:!1,children:[["02.Mysql/01.Mysqlåºç¨æå.md","Mysql åºç¨æå","/pages/0b2452/"],["02.Mysql/02.MySQLå·¥ä½æµ.md","MySQL å·¥ä½æµ","/pages/0a031b/"],["02.Mysql/03.Mysqläºå¡.md","Mysql äºå¡","/pages/f3295c/"],["02.Mysql/04.Mysqlé.md","Mysql é","/pages/86db3b/"],["02.Mysql/05.Mysqlç´¢å¼.md","Mysql ç´¢å¼","/pages/516ac6/"],["02.Mysql/06.Mysqlæ§è½ä¼å.md","Mysql æ§è½ä¼å","/pages/8c404f/"],["02.Mysql/20.Mysqlè¿ç»´.md","Mysql è¿ç»´","/pages/ada3b2/"],["02.Mysql/21.Mysqléç½®.md","Mysql éç½®","/pages/6ed8d9/"],["02.Mysql/99.Mysqlå¸¸è§é®é¢.md","Mysql å¸¸è§é®é¢","/pages/5885bb/"]]},{title:"å¶ä»",collapsable:!1,children:[["99.å¶ä»/01.PostgreSQL.md","PostgreSQL åºç¨æå","/pages/1d898b/"],["99.å¶ä»/02.H2.md","H2 åºç¨æå","/pages/87d312/"],["99.å¶ä»/03.Sqlite.md","sqlite","/pages/d024ff/"]]}],"/04.ææ¡£æ°æ®åº/":[{title:"MongoDB",collapsable:!1,children:[["01.MongoDB/01.MongoDBåºç¨æå.md","MongoDB åºç¨æå","/pages/56d5b6/"],["01.MongoDB/02.MongoDBçCRUDæä½.md","MongoDB ç CRUD æä½","/pages/d69d64/"],["01.MongoDB/03.MongoDBçèåæä½.md","MongoDB çèåæä½","/pages/2698b2/"],["01.MongoDB/04.MongoDBäºå¡.md","MongoDB äºå¡","/pages/3287fa/"],["01.MongoDB/05.MongoDBå»ºæ¨¡.md","MongoDB å»ºæ¨¡","/pages/c154c4/"],["01.MongoDB/06.MongoDBå»ºæ¨¡ç¤ºä¾.md","MongoDB å»ºæ¨¡ç¤ºä¾","/pages/646187/"],["01.MongoDB/07.MongoDBç´¢å¼.md","MongoDB ç´¢å¼","/pages/1c75d4/"],["01.MongoDB/08.MongoDBå¤å¶.md","MongoDB å¤å¶","/pages/e0b65c/"],["01.MongoDB/09.MongoDBåç.md","MongoDB åç","/pages/34b182/"],["01.MongoDB/20.MongoDBè¿ç»´.md","MongoDB è¿ç»´","/pages/ce58ab/"]]}],"/05.KVæ°æ®åº/":[{title:"Redis",collapsable:!1,children:[["01.Redis/01.Redisé¢è¯æ»ç».md","Redis é¢è¯æ»ç»","/pages/c3ce07/"],["01.Redis/02.Redisåºç¨æå.md","Redis åºç¨æå","/pages/5cd883/"],["01.Redis/03.Redisæ°æ®ç±»åååºç¨.md","Redis æ°æ®ç±»åååºç¨","/pages/5d2de2/"],["01.Redis/04.Redisæä¹å.md","Redis æä¹å","/pages/d61faa/"],["01.Redis/05.Rediså¤å¶.md","Redis å¤å¶","/pages/0de16b/"],["01.Redis/06.Rediså¨åµ.md","Redis å¨åµ","/pages/5e23fc/"],["01.Redis/07.Rediséç¾¤.md","Redis éç¾¤","/pages/6b0eb1/"],["01.Redis/08.Rediså®æ.md","Redis å®æ","/pages/199c5a/"],["01.Redis/20.Redisè¿ç»´.md","Redis è¿ç»´","/pages/8f1824/"]]}],"/06.åå¼æ°æ®åº/":[["01.Hbase.md","Hbase","/pages/b570af/"],["02.Cassandra.md","Cassandra","/pages/4c58c2/"]],"/07.æç´¢å¼ææ°æ®åº/":[{title:"Elasticsearch",collapsable:!1,children:[["01.Elasticsearch/01.Elasticsearché¢è¯æ»ç».md","Elasticsearch é¢è¯æ»ç»","/pages/1f9edc/"],["01.Elasticsearch/02.Elasticsearchå¿«éå¥é¨.md","Elasticsearch å¿«éå¥é¨","/pages/37b739/"],["01.Elasticsearch/03.Elasticsearchç®ä».md","Elasticsearch ç®ä»","/pages/6f7391/"],["01.Elasticsearch/04.Elasticsearchç´¢å¼.md","Elasticsearch ç´¢å¼","/pages/5291b4/"],["01.Elasticsearch/05.Elasticsearchæ¥è¯¢.md","Elasticsearch æ¥è¯¢","/pages/478bb5/"],["01.Elasticsearch/06.Elasticsearché«äº®.md","Elasticsearch é«äº®æç´¢åæ¾ç¤º","/pages/4ae35a/"],["01.Elasticsearch/07.Elasticsearchæåº.md","Elasticsearch æåº","/pages/44ca8e/"],["01.Elasticsearch/08.Elasticsearchèå.md","Elasticsearch èå","/pages/93fa2a/"],["01.Elasticsearch/09.Elasticsearchåæå¨.md","Elasticsearch åæå¨","/pages/c04143/"],["01.Elasticsearch/10.Elasticsearchæ§è½ä¼å.md","Elasticsearch æ§è½ä¼å","/pages/dc6b0f/"],["01.Elasticsearch/11.ElasticsearchRestApi.md","Elasticsearch Rest API","/pages/1edd27/"],["01.Elasticsearch/12.ElasticsearchHighLevelRestJavaApi.md","ElasticSearch Java API ä¹ High Level REST Client","/pages/baf137/"],["01.Elasticsearch/13.Elasticsearchéç¾¤ååç.md","Elasticsearch éç¾¤ååç","/pages/d894ac/"],["01.Elasticsearch/20.Elasticsearchè¿ç»´.md","Elasticsearch è¿ç»´","/pages/805d11/"]]},{title:"Elastic",collapsable:!1,children:[["02.Elastic/01.Elasticå¿«éå¥é¨.md","Elastic å¿«éå¥é¨","/pages/d5bdd0/"],["02.Elastic/02.Elasticææ¯æ ä¹Filebeat.md","Elastic ææ¯æ ä¹ Filebeat","/pages/3efdd8/"],["02.Elastic/03.Filebeatè¿ç»´.md","Filebeat è¿ç»´","/pages/43db0b/"],["02.Elastic/04.Elasticææ¯æ ä¹Kibana.md","Elastic ææ¯æ ä¹ Kibana","/pages/507fcc/"],["02.Elastic/05.Kibanaè¿ç»´.md","Kibana è¿ç»´","/pages/8d96f6/"],["02.Elastic/06.Elasticææ¯æ ä¹Logstash.md","Elastic ææ¯æ ä¹ Logstash","/pages/0da19c/"],["02.Elastic/07.Logstashè¿ç»´.md","Logstash è¿ç»´","/pages/ec3c6f/"]]}]},updateBar:{showToArticle:!0},category:!0,tag:!0,archive:!0,author:{name:"dunwu",href:"https://github.com/dunwu"},social:{icons:[{iconClass:"icon-youjian",title:"åé®ä»¶",link:"mailto:forbreak@163.com"},{iconClass:"icon-github",title:"GitHub",link:"https://github.com/dunwu"}]},footer:{createYear:2019,copyrightInfo:"éæï¼dunwuï¼ | CC-BY-SA-4.0"},htmlModules:{pageB:'\n  <div class="wwads-cn wwads-horizontal pageB" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>\n  <style>\n    .pageB img{width:80px!important;}\n    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{line-height:1;}\n  </style>\n  ',windowRB:'\n    <div class="wwads-cn wwads-vertical windowRB" data-id="136" style="max-width:160px;\n    min-width: auto;min-height:auto;"></div>\n    <style>\n      .windowRB{ padding: 0;}\n      .windowRB .wwads-img{margin-top: 10px;}\n      .windowRB .wwads-content{margin: 0 10px 10px 10px;}\n      .custom-html-window-rb .close-but{\n        display: none;\n      }\n    </style>\n  '}}};function cl(n){var e=document.createElement("link");e.href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css",e.rel="stylesheet",document.body.appendChild(e);var t=document.createElement("script");function a(n){var e=document.getElementById("gitalk-container");e||((e=document.createElement("div")).id="gitalk-container",e.classList.add("content"));var t,a=document.querySelector(".page");a&&(a.appendChild(e),"undefined"!=typeof Gitalk&&Gitalk instanceof Function&&(t=n.fullPath,console.info(t),new Gitalk({clientID:"7dd8c87a20cff437d2ed",clientSecret:"4e28d81a9a0280796b2b45ce2944424c6f2c1531",repo:"blog",owner:"dunwu",admin:["dunwu"],id:"comment",distractionFreeMode:!1,language:"zh-CN"}).render("gitalk-container")))}t.src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js",document.body.appendChild(t),n.afterEach((function(n){t.onload?a(n):t.onload=function(){a(n)}}))}t(161),t(217),t(150);var dl=t(226),ul=t(227),ml=(t(398),t(242),t(45));var pl={computed:{$filterPosts:function(){return this.$site.pages.filter((function(n){var e=n.frontmatter,t=e.pageComponent,a=e.article,r=e.home;return!(t||!1===a||!0===r)}))},$sortPosts:function(){return(n=this.$filterPosts).sort((function(n,e){var t=n.frontmatter.sticky,a=e.frontmatter.sticky;return t&&a?t==a?Object(ml.a)(n,e):t-a:t&&!a?-1:!t&&a?1:Object(ml.a)(n,e)})),n;var n},$sortPostsByDate:function(){return(n=this.$filterPosts).sort((function(n,e){return Object(ml.a)(n,e)})),n;var n},$groupPosts:function(){return function(n){for(var e={},t={},a=function(a,r){var i=n[a].frontmatter,s=i.categories,o=i.tags;"array"===Object(ml.n)(s)&&s.forEach((function(t){t&&(e[t]||(e[t]=[]),e[t].push(n[a]))})),"array"===Object(ml.n)(o)&&o.forEach((function(e){e&&(t[e]||(t[e]=[]),t[e].push(n[a]))}))},r=0,i=n.length;r<i;r++)a(r);return{categories:e,tags:t}}(this.$sortPosts)},$categoriesAndTags:function(){return function(n){var e=[],t=[];for(var a in n.categories)e.push({key:a,length:n.categories[a].length});for(var r in n.tags)t.push({key:r,length:n.tags[r].length});return{categories:e,tags:t}}(this.$groupPosts)}}};Dr.component(dl.default),Dr.component(ul.default);function hl(n){return n.toString().padStart(2,"0")}t(402);Dr.component("Badge",(function(){return Promise.all([t.e(0),t.e(3)]).then(t.bind(null,578))})),Dr.component("CodeBlock",(function(){return Promise.resolve().then(t.bind(null,226))})),Dr.component("CodeGroup",(function(){return Promise.resolve().then(t.bind(null,227))}));t(403),t(404);var gl=[function(n){n.Vue,n.options;var e=n.router;n.siteData;n.isServer||e.afterEach((function(){var n;n=function(){},"complete"===document.readyState||"interactive"===document.readyState?setTimeout(n,1):document.addEventListener("DOMContentLoaded",n),setTimeout((function(){var n=document.querySelector(".pageB");if(n){var t=n.querySelector(".wwads-hide");t&&(t.onclick=function(){n.style.display="none"}),n.style.display="flex",cl(e)}}),0)}));try{document&&cl(e)}catch(n){console.error(n.message)}},function(n){var e=n.Vue,t=(n.options,n.router,n.siteData);t.pages.map((function(n){var e=n.frontmatter,a=e.date,r=e.author;"string"==typeof a&&"Z"===a.charAt(a.length-1)&&(n.frontmatter.date=function(n){n instanceof Date||(n=new Date(n));return"".concat(n.getUTCFullYear(),"-").concat(hl(n.getUTCMonth()+1),"-").concat(hl(n.getUTCDate())," ").concat(hl(n.getUTCHours()),":").concat(hl(n.getUTCMinutes()),":").concat(hl(n.getUTCSeconds()))}(a)),r?n.author=r:t.themeConfig.author&&(n.author=t.themeConfig.author)})),e.mixin(pl)},{},function(n){n.Vue.mixin({computed:{$dataBlock:function(){return this.$options.__data__block__}}})},{},{},function(){"undefined"!=typeof window&&function(n,e,t){function a(n){var t=e.createElement("div");t.className="heart",r.push({el:t,x:n.clientX-5,y:n.clientY-5,scale:1,alpha:1,color:"#11a8cd"}),e.body.appendChild(t)}var r=[];n.requestAnimationFrame=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){setTimeout(n,1e3/60)},function(n){var t=e.createElement("style");t.type="text/css";try{t.appendChild(e.createTextNode(n))}catch(e){t.styleSheet.cssText=n}e.getElementsByTagName("head")[0].appendChild(t)}(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),function(){var e="function"==typeof n.onclick&&n.onclick;n.onclick=function(n){var t=!0;n.path&&n.path.forEach((function(n){1===n.nodeType&&"string"==typeof n.className&&n.className.indexOf("theme-vdoing-content")>-1&&(t=!1)})),t&&(e&&e(),a(n))}}(),function n(){for(var t=0;t<r.length;t++)r[t].alpha<=0?(e.body.removeChild(r[t].el),r.splice(t,1)):(r[t].y--,r[t].scale+=.004,r[t].alpha-=.013,r[t].el.style.cssText="left:"+r[t].x+"px;top:"+r[t].y+"px;opacity:"+r[t].alpha+";transform:scale("+r[t].scale+","+r[t].scale+") rotate(45deg);background:"+r[t].color+";z-index:99999");requestAnimationFrame(n)}()}(window,document)}],fl=[];t(65),t(78);t(133);function bl(n,e){return(bl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n})(n,e)}t(220),t(221);function yl(n){return(yl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)})(n)}function vl(n,e){if(e&&("object"===Object(Ss.a)(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(void 0===n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(n)}function _l(n){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}();return function(){var t,a=yl(n);if(e){var r=yl(this).constructor;t=Reflect.construct(a,arguments,r)}else t=a.apply(this,arguments);return vl(this,t)}}var xl=function(n){!function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&bl(n,e)}(t,n);var e=_l(t);function t(){return co(this,t),e.apply(this,arguments)}return mo(t)}(function(){function n(){co(this,n),this.store=new Dr({data:{state:{}}})}return mo(n,[{key:"$get",value:function(n){return this.store.state[n]}},{key:"$set",value:function(n,e){Dr.set(this.store.state,n,e)}},{key:"$emit",value:function(){var n;(n=this.store).$emit.apply(n,arguments)}},{key:"$on",value:function(){var n;(n=this.store).$on.apply(n,arguments)}}]),n}());Object.assign(xl.prototype,{getPageAsyncComponent:Fs,getLayoutAsyncComponent:$s,getAsyncComponent:Gs,getVueComponent:Hs});var El={install:function(n){var e=new xl;n.$vuepress=e,n.prototype.$vuepress=e}};function Tl(n){n.beforeEach((function(e,t,a){if(Il(n,e.path))a();else if(/(\/|\.html)$/.test(e.path))if(/\/$/.test(e.path)){var r=e.path.replace(/\/$/,"")+".html";Il(n,r)?a(r):a()}else a();else{var i=e.path+"/",s=e.path+".html";Il(n,s)?a(s):Il(n,i)?a(i):a()}}))}function Il(n,e){var t=e.toLowerCase();return n.options.routes.some((function(n){return n.path.toLowerCase()===t}))}var kl={props:{pageKey:String,slotKey:{type:String,default:"default"}},render:function(n){var e=this.pageKey||this.$parent.$page.key;return Vs("pageKey",e),Dr.component(e)||Dr.component(e,Fs(e)),Dr.component(e)?n(e):n("")}},Sl={functional:!0,props:{slotKey:String,required:!0},render:function(n,e){var t=e.props,a=e.slots;return n("div",{class:["content__".concat(t.slotKey)]},a()[t.slotKey])}},ql={computed:{openInNewWindowTitle:function(){return this.$themeLocaleConfig.openNewWindowText||"(opens new window)"}}},wl=(t(405),t(406),Object(il.a)(ql,(function(){var n=this.$createElement,e=this._self._c||n;return e("span",[e("svg",{staticClass:"icon outbound",attrs:{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"}},[e("path",{attrs:{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}}),this._v(" "),e("polygon",{attrs:{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"}})]),this._v(" "),e("span",{staticClass:"sr-only"},[this._v(this._s(this.openInNewWindowTitle))])])}),[],!1,null,null,null).exports);function Rl(){return(Rl=Object(r.a)(Object(a.a)().mark((function n(e){var t,r,i,s;return Object(a.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t="undefined"!=typeof window&&window.__VUEPRESS_ROUTER_BASE__?window.__VUEPRESS_ROUTER_BASE__:ll.routerBase||ll.base,Tl(r=new Is({base:t,mode:"history",fallback:!1,routes:ol,scrollBehavior:function(n,e,t){return t||(n.hash?!Dr.$vuepress.$get("disableScrollBehavior")&&{selector:decodeURIComponent(n.hash)}:{x:0,y:0})}})),i={},n.prev=4,n.next=7,Promise.all(gl.filter((function(n){return"function"==typeof n})).map((function(n){return n({Vue:Dr,options:i,router:r,siteData:ll,isServer:e})})));case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(4),console.error(n.t0);case 12:return s=new Dr(Object.assign(i,{router:r,render:function(n){return n("div",{attrs:{id:"app"}},[n("RouterView",{ref:"layout"}),n("div",{class:"global-ui"},fl.map((function(e){return n(e)})))])}})),n.abrupt("return",{app:s,router:r});case 14:case"end":return n.stop()}}),n,null,[[4,9]])})))).apply(this,arguments)}Dr.config.productionTip=!1,Dr.use(Is),Dr.use(El),Dr.mixin(function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Dr;ks(e),t.$vuepress.$set("siteData",e);var a=n(t.$vuepress.$get("siteData")),r=new a,i=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(r)),s={};return Object.keys(i).reduce((function(n,e){return e.startsWith("$")&&(n[e]=i[e].get),n}),s),{computed:s}}((function(n){return function(){function e(){co(this,e)}return mo(e,[{key:"setPage",value:function(n){this.__page=n}},{key:"$site",get:function(){return n}},{key:"$themeConfig",get:function(){return this.$site.themeConfig}},{key:"$frontmatter",get:function(){return this.$page.frontmatter}},{key:"$localeConfig",get:function(){var n,e,t=this.$site.locales,a=void 0===t?{}:t;for(var r in a)"/"===r?e=a[r]:0===this.$page.path.indexOf(r)&&(n=a[r]);return n||e||{}}},{key:"$siteTitle",get:function(){return this.$localeConfig.title||this.$site.title||""}},{key:"$canonicalUrl",get:function(){var n=this.$page.frontmatter.canonicalUrl;return"string"==typeof n&&n}},{key:"$title",get:function(){var n=this.$page,e=this.$page.frontmatter.metaTitle;if("string"==typeof e)return e;var t=this.$siteTitle,a=n.frontmatter.home?null:n.frontmatter.title||n.title;return t?a?a+" | "+t:t:a||"VuePress"}},{key:"$description",get:function(){var n=function(n){if(n){var e=n.filter((function(n){return"description"===n.name}))[0];if(e)return e.content}}(this.$page.frontmatter.meta);return n||(this.$page.frontmatter.description||this.$localeConfig.description||this.$site.description||"")}},{key:"$lang",get:function(){return this.$page.frontmatter.lang||this.$localeConfig.lang||"en-US"}},{key:"$localePath",get:function(){return this.$localeConfig.path||"/"}},{key:"$themeLocaleConfig",get:function(){return(this.$site.themeConfig.locales||{})[this.$localePath]||{}}},{key:"$page",get:function(){return this.__page?this.__page:function(n,e){for(var t=0;t<n.length;t++){var a=n[t];if(a.path.toLowerCase()===e.toLowerCase())return a}return{path:"",frontmatter:{}}}(this.$site.pages,this.$route.path)}}]),e}()}),ll)),Dr.component("Content",kl),Dr.component("ContentSlotsDistributor",Sl),Dr.component("OutboundLink",wl),Dr.component("ClientOnly",{functional:!0,render:function(n,e){var t=e.parent,a=e.children;if(t._isMounted)return a;t.$once("hook:mounted",(function(){t.$forceUpdate()}))}}),Dr.component("Layout",$s("Layout")),Dr.component("NotFound",$s("NotFound")),Dr.prototype.$withBase=function(n){var e=this.$site.base;return"/"===n.charAt(0)?e+n.slice(1):n},window.__VUEPRESS__={version:"1.9.2",hash:"7c791cd"},function(n){return Rl.apply(this,arguments)}(!1).then((function(n){var e=n.app;n.router.onReady((function(){e.$mount("#app")}))}))}]);